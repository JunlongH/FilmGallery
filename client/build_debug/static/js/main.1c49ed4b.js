/*! For license information please see main.1c49ed4b.js.LICENSE.txt */
!function(){var e={54:function(e,t,n){"use strict";n.d(t,{$:function(){return c}});const r=new Set(["id"]),i=new Set(["aria-label","aria-labelledby","aria-describedby","aria-details"]),a=new Set(["href","hrefLang","target","rel","download","ping","referrerPolicy"]),o=new Set(["dir","lang","hidden","inert","translate"]),s=new Set(["onClick","onAuxClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onGotPointerCapture","onLostPointerCapture","onScroll","onWheel","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionCancel","onTransitionEnd","onTransitionRun","onTransitionStart"]),l=/^(data-.*)$/;function c(e,t={}){let{labelable:n,isLink:c,global:u,events:d=u,propNames:h}=t,p={};for(const f in e)Object.prototype.hasOwnProperty.call(e,f)&&(r.has(f)||n&&i.has(f)||c&&a.has(f)||u&&o.has(f)||d&&(s.has(f)||f.endsWith("Capture")&&s.has(f.slice(0,-7)))||(null===h||void 0===h?void 0:h.has(f))||l.test(f))&&(p[f]=e[f]);return p}},60:function(e,t,n){"use strict";n.d(t,{Cc:function(){return c},wR:function(){return p}});var r=n(5043);const i={prefix:String(Math.round(1e10*Math.random())),current:0},a=r.createContext(i),o=r.createContext(!1);Boolean("undefined"!==typeof window&&window.document&&window.document.createElement);let s=new WeakMap;function l(e=!1){let t=(0,r.useContext)(a),n=(0,r.useRef)(null);if(null===n.current&&!e){var i,o;let e=null===(o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)||void 0===o||null===(i=o.ReactCurrentOwner)||void 0===i?void 0:i.current;if(e){let n=s.get(e);null==n?s.set(e,{id:t.current,state:e.memoizedState}):e.memoizedState!==n.state&&(t.current=n.id,s.delete(e))}n.current=++t.current}return n.current}const c="function"===typeof r.useId?function(e){let t=r.useId(),[n]=(0,r.useState)(p());return e||`${n?"react-aria":`react-aria${i.prefix}`}-${t}`}:function(e){let t=(0,r.useContext)(a),n=l(!!e),i=`react-aria${t.prefix}`;return e||`${i}-${n}`};function u(){return!1}function d(){return!0}function h(e){return()=>{}}function p(){return"function"===typeof r.useSyncExternalStore?r.useSyncExternalStore(h,u,d):(0,r.useContext)(o)}},76:function(e,t,n){"use strict";n.d(t,{U:function(){return i}});var r=n(5043),i=Boolean(null==globalThis?void 0:globalThis.document)?r.useLayoutEffect:r.useEffect},106:function(e,t,n){"use strict";n.d(t,{D:function(){return i},I:function(){return r}});const r={x:!1,y:!1};function i(){return r.x||r.y}},114:function(e,t,n){const{DEFAULT_CURVES:r}=n(5121);function i(e,t,n={}){const r=e.length,i=n.monotoneClamp??!1;if(r<2)return e=>1===r?t[0]:e;if(2===r){const n=(t[1]-t[0])/(e[1]-e[0]);return r=>t[0]+n*(r-e[0])}const a=new Array(r-1),o=new Array(r-1);for(let f=0;f<r-1;f++)a[f]=e[f+1]-e[f],o[f]=(t[f+1]-t[f])/a[f];const s=new Array(r),l=new Array(r),c=new Array(r),u=new Array(r);s[0]=0,l[0]=2,c[0]=1,u[0]=3*o[0];for(let f=1;f<r-1;f++)s[f]=a[f],l[f]=2*(a[f-1]+a[f]),c[f]=a[f-1],u[f]=3*(a[f]*o[f-1]+a[f-1]*o[f]);s[r-1]=1,l[r-1]=2,c[r-1]=0,u[r-1]=3*o[r-2];for(let f=1;f<r;f++){const e=s[f]/l[f-1];l[f]-=e*c[f-1],u[f]-=e*u[f-1]}const d=new Array(r);d[r-1]=u[r-1]/l[r-1];for(let f=r-2;f>=0;f--)d[f]=(u[f]-c[f]*d[f+1])/l[f];if(i)for(let f=0;f<r-1;f++)if(0===o[f])d[f]=0,d[f+1]=0;else{const e=d[f]/o[f],t=d[f+1]/o[f],n=e*e+t*t;if(n>9){const r=3/Math.sqrt(n);d[f]=r*e*o[f],d[f+1]=r*t*o[f]}}const h=new Array(r-1),p=new Array(r-1);for(let f=0;f<r-1;f++){const e=1/a[f];h[f]=(3*o[f]-2*d[f]-d[f+1])*e,p[f]=(d[f]+d[f+1]-2*o[f])*e*e}return n=>{let i=0,a=r-2;for(;i<a;){const t=i+a>>1;e[t+1]<n?i=t+1:a=t}const o=n-e[i];return t[i]+d[i]*o+h[i]*o*o+p[i]*o*o*o}}function a(e,t={}){const n=new Uint8Array(256),r=Array.isArray(e)&&e.length>0?[...e].sort((e,t)=>e.x-t.x):[{x:0,y:0},{x:255,y:255}];if(r.length<2){for(let e=0;e<256;e++)n[e]=e;return n}const a=i(r.map(e=>e.x),r.map(e=>e.y),t);for(let i=0;i<256;i++){let e;e=i<=r[0].x?r[0].y:i>=r[r.length-1].x?r[r.length-1].y:a(i),n[i]=Math.min(255,Math.max(0,Math.round(e)))}return n}function o(e,t={}){const n=t.resolution??1024,r=new Float32Array(n),a=Array.isArray(e)&&e.length>0?[...e].sort((e,t)=>e.x-t.x):[{x:0,y:0},{x:255,y:255}];if(a.length<2){for(let e=0;e<n;e++)r[e]=e/(n-1);return r}const o=i(a.map(e=>e.x),a.map(e=>e.y),{monotoneClamp:t.monotoneClamp});for(let i=0;i<n;i++){const e=i/(n-1)*255;let t;t=e<=a[0].x?a[0].y:e>=a[a.length-1].x?a[a.length-1].y:o(e),r[i]=Math.max(0,Math.min(1,t/255))}return r}function s(e,t){const n=t.length-1,r=Math.max(0,Math.min(1,e))*n,i=Math.floor(r),a=Math.min(n,i+1),o=r-i;return(1-o)*t[i]+o*t[a]}e.exports={createSpline:i,buildCurveLUT:a,buildCurveLUTFloat:o,buildAllCurveLUTs:function(e={}){const t={...r,...e};return{lutRGB:a(t.rgb),lutR:a(t.red),lutG:a(t.green),lutB:a(t.blue)}},buildAllCurveLUTsFloat:function(e={},t={}){const n={...r,...e};return{lutRGB:o(n.rgb,t),lutR:o(n.red,t),lutG:o(n.green,t),lutB:o(n.blue,t)}},buildCompositeFloatCurveLUT:function(e={},t={}){const n=t.resolution??1024,i=r.rgb,a=o(e.rgb||i,{resolution:n}),l=o(e.red||i,{resolution:n}),c=o(e.green||i,{resolution:n}),u=o(e.blue||i,{resolution:n}),d=new Float32Array(4*n);for(let r=0;r<n;r++){const e=a[r];d[4*r+0]=s(e,l),d[4*r+1]=s(e,c),d[4*r+2]=s(e,u),d[4*r+3]=1}return d},applyCurve:function(e,t){return a(t)[Math.min(255,Math.max(0,Math.round(e)))]}}},151:function(e,t,n){"use strict";n.d(t,{q:function(){return i}});var r=n(5043);function i(e={}){const{strict:t=!0,errorMessage:n="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:i}=e,a=r.createContext(void 0);return a.displayName=i,[a.Provider,function e(){var i;const o=r.useContext(a);if(!o&&t){const t=new Error(n);throw t.name="ContextError",null==(i=Error.captureStackTrace)||i.call(Error,t,e),t}return o},a]}},171:function(e,t,n){"use strict";n.d(t,{LE:function(){return h},eg:function(){return l},lR:function(){return d},o1:function(){return c},yB:function(){return u}});var r=n(8493),i=n(4595),a=n(6650),o=n(587),s=n(5043);function l(e){let t=e;return t.nativeEvent=e,t.isDefaultPrevented=()=>t.defaultPrevented,t.isPropagationStopped=()=>t.cancelBubble,t.persist=()=>{},t}function c(e,t){Object.defineProperty(e,"target",{value:t}),Object.defineProperty(e,"currentTarget",{value:t})}function u(e){let t=(0,s.useRef)({isFocused:!1,observer:null});return(0,a.N)(()=>{const e=t.current;return()=>{e.observer&&(e.observer.disconnect(),e.observer=null)}},[]),(0,s.useCallback)(n=>{if(n.target instanceof HTMLButtonElement||n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLSelectElement){t.current.isFocused=!0;let r=n.target,i=n=>{if(t.current.isFocused=!1,r.disabled){let t=l(n);null===e||void 0===e||e(t)}t.current.observer&&(t.current.observer.disconnect(),t.current.observer=null)};r.addEventListener("focusout",i,{once:!0}),t.current.observer=new MutationObserver(()=>{if(t.current.isFocused&&r.disabled){var e;null===(e=t.current.observer)||void 0===e||e.disconnect();let n=r===document.activeElement?null:document.activeElement;r.dispatchEvent(new FocusEvent("blur",{relatedTarget:n})),r.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:n}))}}),t.current.observer.observe(r,{attributes:!0,attributeFilter:["disabled"]})}},[e])}let d=!1;function h(e){for(;e&&!(0,o.t)(e);)e=e.parentElement;let t=(0,r.mD)(e),n=t.document.activeElement;if(!n||n===e)return;d=!0;let a=!1,s=e=>{(e.target===n||a)&&e.stopImmediatePropagation()},l=t=>{(t.target===n||a)&&(t.stopImmediatePropagation(),e||a||(a=!0,(0,i.e)(n),h()))},c=t=>{(t.target===e||a)&&t.stopImmediatePropagation()},u=t=>{(t.target===e||a)&&(t.stopImmediatePropagation(),a||(a=!0,(0,i.e)(n),h()))};t.addEventListener("blur",s,!0),t.addEventListener("focusout",l,!0),t.addEventListener("focusin",u,!0),t.addEventListener("focus",c,!0);let h=()=>{cancelAnimationFrame(p),t.removeEventListener("blur",s,!0),t.removeEventListener("focusout",l,!0),t.removeEventListener("focusin",u,!0),t.removeEventListener("focus",c,!0),d=!1,a=!1},p=requestAnimationFrame(h);return h}},217:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});const r=(e,t,n)=>n>t?t:n<e?e:n},228:function(e,t){!function(e){"use strict";var t="1.9.4";function n(e){var t,n,r,i;for(n=1,r=arguments.length;n<r;n++)for(t in i=arguments[n])e[t]=i[t];return e}var r=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function i(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var r=n.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(n.call(arguments)):arguments)}}var a=0;function o(e){return"_leaflet_id"in e||(e._leaflet_id=++a),e._leaflet_id}function s(e,t,n){var r,i,a,o;return o=function(){r=!1,i&&(a.apply(n,i),i=!1)},a=function(){r?i=arguments:(e.apply(n,arguments),setTimeout(o,t),r=!0)},a}function l(e,t,n){var r=t[1],i=t[0],a=r-i;return e===r&&n?e:((e-i)%a+a)%a+i}function c(){return!1}function u(e,t){if(!1===t)return e;var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function d(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function h(e){return d(e).split(/\s+/)}function p(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?r(e.options):{}),t)e.options[n]=t[n];return e.options}function f(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}var m=/\{ *([\w_ -]+) *\}/g;function g(e,t){return e.replace(m,function(e,n){var r=t[n];if(void 0===r)throw new Error("No value provided for variable "+e);return"function"===typeof r&&(r=r(t)),r})}var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function A(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var x=0;function _(e){var t=+new Date,n=Math.max(0,16-(t-x));return x=t+n,window.setTimeout(e,n)}var w=window.requestAnimationFrame||b("RequestAnimationFrame")||_,S=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function T(e,t,n){if(!n||w!==_)return w.call(window,i(e,t));e.call(t)}function C(e){e&&S.call(window,e)}var M={__proto__:null,extend:n,create:r,bind:i,get lastId(){return a},stamp:o,throttle:s,wrapNum:l,falseFn:c,formatNum:u,trim:d,splitWords:h,setOptions:p,getParamString:f,template:g,isArray:v,indexOf:A,emptyImageUrl:y,requestFn:w,cancelFn:S,requestAnimFrame:T,cancelAnimFrame:C};function E(){}function P(e){if("undefined"!==typeof L&&L&&L.Mixin){e=v(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}E.extend=function(e){var t=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=t.__super__=this.prototype,a=r(i);for(var o in a.constructor=t,t.prototype=a,this)Object.prototype.hasOwnProperty.call(this,o)&&"prototype"!==o&&"__super__"!==o&&(t[o]=this[o]);return e.statics&&n(t,e.statics),e.includes&&(P(e.includes),n.apply(null,[a].concat(e.includes))),n(a,e),delete a.statics,delete a.includes,a.options&&(a.options=i.options?r(i.options):{},n(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=a._initHooks.length;e<t;e++)a._initHooks[e].call(this)}},t},E.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},E.mergeOptions=function(e){return n(this.prototype.options,e),this},E.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var N={on:function(e,t,n){if("object"===typeof e)for(var r in e)this._on(r,e[r],t);else for(var i=0,a=(e=h(e)).length;i<a;i++)this._on(e[i],t,n);return this},off:function(e,t,n){if(arguments.length)if("object"===typeof e)for(var r in e)this._off(r,e[r],t);else{e=h(e);for(var i=1===arguments.length,a=0,o=e.length;a<o;a++)i?this._off(e[a]):this._off(e[a],t,n)}else delete this._events;return this},_on:function(e,t,n,r){if("function"===typeof t){if(!1===this._listens(e,t,n)){n===this&&(n=void 0);var i={fn:t,ctx:n};r&&(i.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(i)}}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,n){var r,i,a;if(this._events&&(r=this._events[e]))if(1!==arguments.length)if("function"===typeof t){var o=this._listens(e,t,n);if(!1!==o){var s=r[o];this._firingCount&&(s.fn=c,this._events[e]=r=r.slice()),r.splice(o,1)}}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(i=0,a=r.length;i<a;i++)r[i].fn=c;delete this._events[e]}},fire:function(e,t,r){if(!this.listens(e,r))return this;var i=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var a=this._events[e];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var l=a[o],c=l.fn;l.once&&this.off(e,c,l.ctx),c.call(l.ctx||this,i)}this._firingCount--}}return r&&this._propagateEvent(i),this},listens:function(e,t,n,r){"string"!==typeof e&&console.warn('"string" type argument expected');var i=t;"function"!==typeof t&&(r=!!t,i=void 0,n=void 0);var a=this._events&&this._events[e];if(a&&a.length&&!1!==this._listens(e,i,n))return!0;if(r)for(var o in this._eventParents)if(this._eventParents[o].listens(e,t,n,r))return!0;return!1},_listens:function(e,t,n){if(!this._events)return!1;var r=this._events[e]||[];if(!t)return!!r.length;n===this&&(n=void 0);for(var i=0,a=r.length;i<a;i++)if(r[i].fn===t&&r[i].ctx===n)return i;return!1},once:function(e,t,n){if("object"===typeof e)for(var r in e)this._on(r,e[r],t,!0);else for(var i=0,a=(e=h(e)).length;i<a;i++)this._on(e[i],t,n,!0);return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[o(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[o(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};N.addEventListener=N.on,N.removeEventListener=N.clearAllEventListeners=N.off,N.addOneTimeEventListener=N.once,N.fireEvent=N.fire,N.hasEventListeners=N.listens;var k=E.extend(N);function R(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var O=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function j(e,t,n){return e instanceof R?e:v(e)?new R(e[0],e[1]):void 0===e||null===e?e:"object"===typeof e&&"x"in e&&"y"in e?new R(e.x,e.y):new R(e,t,n)}function D(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}function I(e,t){return!e||e instanceof D?e:new D(e,t)}function B(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}function F(e,t){return e instanceof B?e:new B(e,t)}function z(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function U(e,t,n){return e instanceof z?e:v(e)&&"object"!==typeof e[0]?3===e.length?new z(e[0],e[1],e[2]):2===e.length?new z(e[0],e[1]):null:void 0===e||null===e?e:"object"===typeof e&&"lat"in e?new z(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new z(e,t,n)}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(e){return this.clone()._add(j(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(j(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new R(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new R(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=O(this.x),this.y=O(this.y),this},distanceTo:function(e){var t=(e=j(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=j(e)).x===this.x&&e.y===this.y},contains:function(e){return e=j(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},D.prototype={extend:function(e){var t,n;if(!e)return this;if(e instanceof R||"number"===typeof e[0]||"x"in e)t=n=j(e);else if(t=(e=I(e)).min,n=e.max,!t||!n)return this;return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=t.clone(),this.max=n.clone()),this},getCenter:function(e){return j((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return j(this.min.x,this.max.y)},getTopRight:function(){return j(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"===typeof e[0]||e instanceof R?j(e):I(e))instanceof D?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=I(e);var t=this.min,n=this.max,r=e.min,i=e.max,a=i.x>=t.x&&r.x<=n.x,o=i.y>=t.y&&r.y<=n.y;return a&&o},overlaps:function(e){e=I(e);var t=this.min,n=this.max,r=e.min,i=e.max,a=i.x>t.x&&r.x<n.x,o=i.y>t.y&&r.y<n.y;return a&&o},isValid:function(){return!(!this.min||!this.max)},pad:function(e){var t=this.min,n=this.max,r=Math.abs(t.x-n.x)*e,i=Math.abs(t.y-n.y)*e;return I(j(t.x-r,t.y-i),j(n.x+r,n.y+i))},equals:function(e){return!!e&&(e=I(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight()))}},B.prototype={extend:function(e){var t,n,r=this._southWest,i=this._northEast;if(e instanceof z)t=e,n=e;else{if(!(e instanceof B))return e?this.extend(U(e)||F(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return r||i?(r.lat=Math.min(t.lat,r.lat),r.lng=Math.min(t.lng,r.lng),i.lat=Math.max(n.lat,i.lat),i.lng=Math.max(n.lng,i.lng)):(this._southWest=new z(t.lat,t.lng),this._northEast=new z(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,r=Math.abs(t.lat-n.lat)*e,i=Math.abs(t.lng-n.lng)*e;return new B(new z(t.lat-r,t.lng-i),new z(n.lat+r,n.lng+i))},getCenter:function(){return new z((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new z(this.getNorth(),this.getWest())},getSouthEast:function(){return new z(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"===typeof e[0]||e instanceof z||"lat"in e?U(e):F(e);var t,n,r=this._southWest,i=this._northEast;return e instanceof B?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=r.lat&&n.lat<=i.lat&&t.lng>=r.lng&&n.lng<=i.lng},intersects:function(e){e=F(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),a=i.lat>=t.lat&&r.lat<=n.lat,o=i.lng>=t.lng&&r.lng<=n.lng;return a&&o},overlaps:function(e){e=F(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),a=i.lat>t.lat&&r.lat<n.lat,o=i.lng>t.lng&&r.lng<n.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=F(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},z.prototype={equals:function(e,t){return!!e&&(e=U(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+u(this.lat,e)+", "+u(this.lng,e)+")"},distanceTo:function(e){return G.distance(this,U(e))},wrap:function(){return G.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return F([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new z(this.lat,this.lng,this.alt)}};var V={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new D(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?l(e.lng,this.wrapLng,!0):e.lng;return new z(this.wrapLat?l(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),r=t.lat-n.lat,i=t.lng-n.lng;if(0===r&&0===i)return e;var a=e.getSouthWest(),o=e.getNorthEast();return new B(new z(a.lat-r,a.lng-i),new z(o.lat-r,o.lng-i))}},G=n({},V,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,r=e.lat*n,i=t.lat*n,a=Math.sin((t.lat-e.lat)*n/2),o=Math.sin((t.lng-e.lng)*n/2),s=a*a+Math.cos(r)*Math.cos(i)*o*o,l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*l}}),q=6378137,W={R:q,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),i=Math.sin(r*t);return new R(this.R*e.lng*t,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(e){var t=180/Math.PI;return new z((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=q*Math.PI;return new D([-e,-e],[e,e])}()};function H(e,t,n,r){if(v(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=r}function $(e,t,n,r){return new H(e,t,n,r)}H.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new R((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var K=n({},G,{code:"EPSG:3857",projection:W,transformation:function(){var e=.5/(Math.PI*W.R);return $(e,.5,-e,.5)}()}),X=n({},K,{code:"EPSG:900913"});function Y(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Q(e,t){var n,r,i,a,o,s,l="";for(n=0,i=e.length;n<i;n++){for(r=0,a=(o=e[n]).length;r<a;r++)l+=(r?"L":"M")+(s=o[r]).x+" "+s.y;l+=t?De.svg?"z":"x":""}return l||"M0 0"}var Z=document.documentElement.style,J="ActiveXObject"in window,ee=J&&!document.addEventListener,te="msLaunchUri"in navigator&&!("documentMode"in document),ne=je("webkit"),re=je("android"),ie=je("android 2")||je("android 3"),ae=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),oe=re&&je("Google")&&ae<537&&!("AudioNode"in window),se=!!window.opera,le=!te&&je("chrome"),ce=je("gecko")&&!ne&&!se&&!J,ue=!le&&je("safari"),de=je("phantom"),he="OTransition"in Z,pe=0===navigator.platform.indexOf("Win"),fe=J&&"transition"in Z,me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ie,ge="MozPerspective"in Z,ve=!window.L_DISABLE_3D&&(fe||me||ge)&&!he&&!de,Ae="undefined"!==typeof orientation||je("mobile"),ye=Ae&&ne,be=Ae&&me,xe=!window.PointerEvent&&window.MSPointerEvent,_e=!(!window.PointerEvent&&!xe),we="ontouchstart"in window||!!window.TouchEvent,Se=!window.L_NO_TOUCH&&(we||_e),Te=Ae&&se,Ce=Ae&&ce,Me=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ee=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",c,t),window.removeEventListener("testPassiveEventSupport",c,t)}catch(n){}return e}(),Pe=!!document.createElement("canvas").getContext,Ne=!(!document.createElementNS||!Y("svg").createSVGRect),ke=!!Ne&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(e.firstChild&&e.firstChild.namespaceURI)}(),Re=!Ne&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(n){return!1}}(),Le=0===navigator.platform.indexOf("Mac"),Oe=0===navigator.platform.indexOf("Linux");function je(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var De={ie:J,ielt9:ee,edge:te,webkit:ne,android:re,android23:ie,androidStock:oe,opera:se,chrome:le,gecko:ce,safari:ue,phantom:de,opera12:he,win:pe,ie3d:fe,webkit3d:me,gecko3d:ge,any3d:ve,mobile:Ae,mobileWebkit:ye,mobileWebkit3d:be,msPointer:xe,pointer:_e,touch:Se,touchNative:we,mobileOpera:Te,mobileGecko:Ce,retina:Me,passiveEvents:Ee,canvas:Pe,svg:Ne,vml:Re,inlineSvg:ke,mac:Le,linux:Oe},Ie=De.msPointer?"MSPointerDown":"pointerdown",Be=De.msPointer?"MSPointerMove":"pointermove",Fe=De.msPointer?"MSPointerUp":"pointerup",ze=De.msPointer?"MSPointerCancel":"pointercancel",Ue={touchstart:Ie,touchmove:Be,touchend:Fe,touchcancel:ze},Ve={touchstart:Ze,touchmove:Qe,touchend:Qe,touchcancel:Qe},Ge={},qe=!1;function We(e,t,n){return"touchstart"===t&&Ye(),Ve[t]?(n=Ve[t].bind(this,n),e.addEventListener(Ue[t],n,!1),n):(console.warn("wrong event specified:",t),c)}function He(e,t,n){Ue[t]?e.removeEventListener(Ue[t],n,!1):console.warn("wrong event specified:",t)}function $e(e){Ge[e.pointerId]=e}function Ke(e){Ge[e.pointerId]&&(Ge[e.pointerId]=e)}function Xe(e){delete Ge[e.pointerId]}function Ye(){qe||(document.addEventListener(Ie,$e,!0),document.addEventListener(Be,Ke,!0),document.addEventListener(Fe,Xe,!0),document.addEventListener(ze,Xe,!0),qe=!0)}function Qe(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in t.touches=[],Ge)t.touches.push(Ge[n]);t.changedTouches=[t],e(t)}}function Ze(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&$t(t),Qe(e,t)}function Je(e){var t,n,r={};for(n in e)t=e[n],r[n]=t&&t.bind?t.bind(e):t;return e=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var et=200;function tt(e,t){e.addEventListener("dblclick",t);var n,r=0;function i(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var i=Xt(e);if(!i.some(function(e){return e instanceof HTMLLabelElement&&e.attributes.for})||i.some(function(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement})){var a=Date.now();a-r<=et?2===++n&&t(Je(e)):n=1,r=a}}}else n=e.detail}return e.addEventListener("click",i),{dblclick:t,simDblclick:i}}function nt(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var rt,it,at,ot,st,lt=Tt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ct=Tt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ut="webkitTransition"===ct||"OTransition"===ct?ct+"End":"transitionend";function dt(e){return"string"===typeof e?document.getElementById(e):e}function ht(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return"auto"===n?null:n}function pt(e,t,n){var r=document.createElement(e);return r.className=t||"",n&&n.appendChild(r),r}function ft(e){var t=e.parentNode;t&&t.removeChild(e)}function mt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function gt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function vt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function At(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=_t(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function yt(e,t){if(void 0!==e.classList)for(var n=h(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!At(e,t)){var a=_t(e);xt(e,(a?a+" ":"")+t)}}function bt(e,t){void 0!==e.classList?e.classList.remove(t):xt(e,d((" "+_t(e)+" ").replace(" "+t+" "," ")))}function xt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function _t(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function wt(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&St(e,t)}function St(e,t){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(r)}catch(i){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}function Tt(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function Ct(e,t,n){var r=t||new R(0,0);e.style[lt]=(De.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(n?" scale("+n+")":"")}function Mt(e,t){e._leaflet_pos=t,De.any3d?Ct(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Et(e){return e._leaflet_pos||new R(0,0)}if("onselectstart"in document)rt=function(){It(window,"selectstart",$t)},it=function(){Ft(window,"selectstart",$t)};else{var Pt=Tt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);rt=function(){if(Pt){var e=document.documentElement.style;at=e[Pt],e[Pt]="none"}},it=function(){Pt&&(document.documentElement.style[Pt]=at,at=void 0)}}function Nt(){It(window,"dragstart",$t)}function kt(){Ft(window,"dragstart",$t)}function Rt(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(Lt(),ot=e,st=e.style.outlineStyle,e.style.outlineStyle="none",It(window,"keydown",Lt))}function Lt(){ot&&(ot.style.outlineStyle=st,ot=void 0,st=void 0,Ft(window,"keydown",Lt))}function Ot(e){do{e=e.parentNode}while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function jt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Dt={__proto__:null,TRANSFORM:lt,TRANSITION:ct,TRANSITION_END:ut,get:dt,getStyle:ht,create:pt,remove:ft,empty:mt,toFront:gt,toBack:vt,hasClass:At,addClass:yt,removeClass:bt,setClass:xt,getClass:_t,setOpacity:wt,testProp:Tt,setTransform:Ct,setPosition:Mt,getPosition:Et,get disableTextSelection(){return rt},get enableTextSelection(){return it},disableImageDrag:Nt,enableImageDrag:kt,preventOutline:Rt,restoreOutline:Lt,getSizedParentNode:Ot,getScale:jt};function It(e,t,n,r){if(t&&"object"===typeof t)for(var i in t)Vt(e,i,t[i],n);else for(var a=0,o=(t=h(t)).length;a<o;a++)Vt(e,t[a],n,r);return this}var Bt="_leaflet_events";function Ft(e,t,n,r){if(1===arguments.length)zt(e),delete e[Bt];else if(t&&"object"===typeof t)for(var i in t)Gt(e,i,t[i],n);else if(t=h(t),2===arguments.length)zt(e,function(e){return-1!==A(t,e)});else for(var a=0,o=t.length;a<o;a++)Gt(e,t[a],n,r);return this}function zt(e,t){for(var n in e[Bt]){var r=n.split(/\d/)[0];t&&!t(r)||Gt(e,r,null,null,n)}}var Ut={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Vt(e,t,n,r){var i=t+o(n)+(r?"_"+o(r):"");if(e[Bt]&&e[Bt][i])return this;var a=function(t){return n.call(r||e,t||window.event)},s=a;!De.touchNative&&De.pointer&&0===t.indexOf("touch")?a=We(e,t,a):De.touch&&"dblclick"===t?a=tt(e,a):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(Ut[t]||t,a,!!De.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(a=function(t){t=t||window.event,Jt(e,t)&&s(t)},e.addEventListener(Ut[t],a,!1)):e.addEventListener(t,s,!1):e.attachEvent("on"+t,a),e[Bt]=e[Bt]||{},e[Bt][i]=a}function Gt(e,t,n,r,i){i=i||t+o(n)+(r?"_"+o(r):"");var a=e[Bt]&&e[Bt][i];if(!a)return this;!De.touchNative&&De.pointer&&0===t.indexOf("touch")?He(e,t,a):De.touch&&"dblclick"===t?nt(e,a):"removeEventListener"in e?e.removeEventListener(Ut[t]||t,a,!1):e.detachEvent("on"+t,a),e[Bt][i]=null}function qt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Wt(e){return Vt(e,"wheel",qt),this}function Ht(e){return It(e,"mousedown touchstart dblclick contextmenu",qt),e._leaflet_disable_click=!0,this}function $t(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Kt(e){return $t(e),qt(e),this}function Xt(e){if(e.composedPath)return e.composedPath();for(var t=[],n=e.target;n;)t.push(n),n=n.parentNode;return t}function Yt(e,t){if(!t)return new R(e.clientX,e.clientY);var n=jt(t),r=n.boundingClientRect;return new R((e.clientX-r.left)/n.x-t.clientLeft,(e.clientY-r.top)/n.y-t.clientTop)}var Qt=De.linux&&De.chrome?window.devicePixelRatio:De.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Zt(e){return De.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Qt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function Jt(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(r){return!1}return n!==e}var en={__proto__:null,on:It,off:Ft,stopPropagation:qt,disableScrollPropagation:Wt,disableClickPropagation:Ht,preventDefault:$t,stop:Kt,getPropagationPath:Xt,getMousePosition:Yt,getWheelDelta:Zt,isExternalTarget:Jt,addListener:It,removeListener:Ft},tn=k.extend({run:function(e,t,n,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Et(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=T(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),Mt(this._el,n),this.fire("step")},_complete:function(){C(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),nn=k.extend({options:{crs:K,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=p(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(U(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ct&&De.any3d&&!De.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),It(this._proxy,ut,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,r){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(U(e),t,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=n({animate:r.animate},r.zoom),r.pan=n({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom):this._tryAnimatedPan(e,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t,r.pan&&r.pan.noMoveStart),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(De.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(De.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var r=this.getZoomScale(t),i=this.getSize().divideBy(2),a=(e instanceof R?e:this.latLngToContainerPoint(e)).subtract(i).multiplyBy(1-1/r),o=this.containerPointToLatLng(i.add(a));return this.setView(o,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():F(e);var n=j(t.paddingTopLeft||t.padding||[0,0]),r=j(t.paddingBottomRight||t.padding||[0,0]),i=this.getBoundsZoom(e,!1,n.add(r));if((i="number"===typeof t.maxZoom?Math.min(t.maxZoom,i):i)===1/0)return{center:e.getCenter(),zoom:i};var a=r.subtract(n).divideBy(2),o=this.project(e.getSouthWest(),i),s=this.project(e.getNorthEast(),i);return{center:this.unproject(o.add(s).divideBy(2).add(a),i),zoom:i}},fitBounds:function(e,t){if(!(e=F(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=j(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new tn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){yt(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!De.any3d)return this.setView(e,t,n);this._stop();var r=this.project(this.getCenter()),i=this.project(e),a=this.getSize(),o=this._zoom;e=U(e),t=void 0===t?o:t;var s=Math.max(a.x,a.y),l=s*this.getZoomScale(o,t),c=i.distanceTo(r)||1,u=1.42,d=u*u;function h(e){var t=(l*l-s*s+(e?-1:1)*d*d*c*c)/(2*(e?l:s)*d*c),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function p(e){return(Math.exp(e)-Math.exp(-e))/2}function f(e){return(Math.exp(e)+Math.exp(-e))/2}function m(e){return p(e)/f(e)}var g=h(0);function v(e){return s*(f(g)/f(g+u*e))}function A(e){return s*(f(g)*m(g+u*e)-p(g))/d}function y(e){return 1-Math.pow(1-e,1.5)}var b=Date.now(),x=(h(1)-g)/u,_=n.duration?1e3*n.duration:1e3*x*.8;function w(){var n=(Date.now()-b)/_,a=y(n)*x;n<=1?(this._flyToFrame=T(w,this),this._move(this.unproject(r.add(i.subtract(r).multiplyBy(A(a)/c)),o),this.getScaleZoom(s/v(a),o),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),w.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return e=F(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),r=this._limitCenter(n,this._zoom,F(e));return n.equals(r)||this.panTo(r,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=j((t=t||{}).paddingTopLeft||t.padding||[0,0]),r=j(t.paddingBottomRight||t.padding||[0,0]),i=this.project(this.getCenter()),a=this.project(e),o=this.getPixelBounds(),s=I([o.min.add(n),o.max.subtract(r)]),l=s.getSize();if(!s.contains(a)){this._enforcingBounds=!0;var c=a.subtract(s.getCenter()),u=s.extend(a).getSize().subtract(l);i.x+=c.x<0?-u.x:u.x,i.y+=c.y<0?-u.y:u.y,this.panTo(this.unproject(i),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),a=t.divideBy(2).round(),o=r.divideBy(2).round(),s=a.subtract(o);return s.x||s.y?(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,r,e):navigator.geolocation.getCurrentPosition(t,r,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new z(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),r=this._locateOptions;if(r.setView){var i=this.getBoundsZoom(n);this.setView(t,r.maxZoom?Math.min(i,r.maxZoom):i)}var a={latlng:t,bounds:n,timestamp:e.timestamp};for(var o in e.coords)"number"===typeof e.coords[o]&&(a[o]=e.coords[o]);this.fire("locationfound",a)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),ft(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(C(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)ft(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=pt("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new B(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=F(e),n=j(n||[0,0]);var r=this.getZoom()||0,i=this.getMinZoom(),a=this.getMaxZoom(),o=e.getNorthWest(),s=e.getSouthEast(),l=this.getSize().subtract(n),c=I(this.project(s,r),this.project(o,r)).getSize(),u=De.any3d?this.options.zoomSnap:1,d=l.x/c.x,h=l.y/c.y,p=t?Math.max(d,h):Math.min(d,h);return r=this.getScaleZoom(p,r),u&&(r=Math.round(r/(u/100))*(u/100),r=t?Math.ceil(r/u)*u:Math.floor(r/u)*u),Math.max(i,Math.min(a,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new R(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new D(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"===typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var r=n.zoom(e*n.scale(t));return isNaN(r)?1/0:r},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(U(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(j(e),t)},layerPointToLatLng:function(e){var t=j(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(U(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(U(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(F(e))},distance:function(e,t){return this.options.crs.distance(U(e),U(t))},containerPointToLayerPoint:function(e){return j(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return j(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(j(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(U(e)))},mouseEventToContainerPoint:function(e){return Yt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=dt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");It(t,"scroll",this._onScroll,this),this._containerId=o(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&De.any3d,yt(e,"leaflet-container"+(De.touch?" leaflet-touch":"")+(De.retina?" leaflet-retina":"")+(De.ielt9?" leaflet-oldie":"")+(De.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ht(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&"sticky"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Mt(this._mapPane,new R(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(yt(e.markerPane,"leaflet-zoom-hide"),yt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,n){Mt(this._mapPane,new R(0,0));var r=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var i=this._zoom!==t;this._moveStart(i,n)._move(e,t)._moveEnd(i),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n,r){void 0===t&&(t=this._zoom);var i=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),r?n&&n.pinch&&this.fire("zoom",n):((i||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return C(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Mt(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[o(this._container)]=this;var t=e?Ft:It;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),De.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){C(this._resizeRequest),this._resizeRequest=T(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,r=[],i="mouseout"===t||"mouseover"===t,a=e.target||e.srcElement,s=!1;a;){if((n=this._targets[o(a)])&&("click"===t||"preclick"===t)&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(t,!0)){if(i&&!Jt(a,e))break;if(r.push(n),i)break}if(a===this._container)break;a=a.parentNode}return r.length||s||i||!this.listens(t,!0)||(r=[this]),r},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var n=e.type;"mousedown"===n&&Rt(t),this._fireDOMEvent(e,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,r){if("click"===e.type){var i=n({},e);i.type="preclick",this._fireDOMEvent(i,i.type,r)}var a=this._findEventTargets(e,t);if(r){for(var o=[],s=0;s<r.length;s++)r[s].listens(t,!0)&&o.push(r[s]);a=o.concat(a)}if(a.length){"contextmenu"===t&&$t(e);var l=a[0],c={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var u=l.getLatLng&&(!l._radius||l._radius<=10);c.containerPoint=u?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(e),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=u?l.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(s=0;s<a.length;s++)if(a[s].fire(t,c,!0),c.originalEvent._stopped||!1===a[s].options.bubblingMouseEvents&&-1!==A(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Et(this._mapPane)||new R(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(r)},_latLngBoundsToNewLayerBounds:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return I([this.project(e.getSouthWest(),t)._subtract(r),this.project(e.getNorthWest(),t)._subtract(r),this.project(e.getSouthEast(),t)._subtract(r),this.project(e.getNorthEast(),t)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var r=this.project(e,t),i=this.getSize().divideBy(2),a=new D(r.subtract(i),r.add(i)),o=this._getBoundsOffset(a,n,t);return Math.abs(o.x)<=1&&Math.abs(o.y)<=1?e:this.unproject(r.add(o),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),r=new D(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(r,t))},_getBoundsOffset:function(e,t,n){var r=I(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),i=r.min.subtract(e.min),a=r.max.subtract(e.max);return new R(this._rebound(i.x,-a.x),this._rebound(i.y,-a.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),r=De.any3d?this.options.zoomSnap:1;return r&&(e=Math.round(e/r)*r),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){bt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n))&&(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=pt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(e){var t=lt,n=this._proxy.style[t];Ct(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ft(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Ct(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r);return!(!0!==n.animate&&!this.getSize().contains(i))&&(T(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,yt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&bt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function rn(e,t){return new nn(e,t)}var an=E.extend({options:{position:"topright"},initialize:function(e){p(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),r=e._controlCorners[n];return yt(t,"leaflet-control"),-1!==n.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ft(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),on=function(e){return new an(e)};nn.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=pt("div",t+"control-container",this._container);function r(r,i){var a=t+r+" "+t+i;e[r+i]=pt("div",a,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)ft(this._controlCorners[e]);ft(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var sn=an.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,r){return n<r?-1:r<n?1:0}},initialize:function(e,t,n){for(var r in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,e)this._addLayer(e[r],r);for(r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return an.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(o(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){yt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(yt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):bt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return bt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=pt("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Ht(t),Wt(t);var r=this._section=pt("section",e+"-list");n&&(this._map.on("click",this.collapse,this),It(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var i=this._layersLink=pt("a",e+"-toggle",t);i.href="#",i.title="Layers",i.setAttribute("role","button"),It(i,{keydown:function(e){13===e.keyCode&&this._expandSafely()},click:function(e){$t(e),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=pt("div",e+"-base",r),this._separator=pt("div",e+"-separator",r),this._overlaysList=pt("div",e+"-overlays",r),t.appendChild(r)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&o(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;mt(this._baseLayersList),mt(this._overlaysList),this._layerControlInputs=[];var e,t,n,r,i=0;for(n=0;n<this._layers.length;n++)r=this._layers[n],this._addItem(r),t=t||r.overlay,e=e||!r.overlay,i+=r.overlay?0:1;return this.options.hideSingleBase&&(e=e&&i>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(o(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(e){var t,n=document.createElement("label"),r=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=r):t=this._createRadioElement("leaflet-base-layers_"+o(this),r),this._layerControlInputs.push(t),t.layerId=o(e.layer),It(t,"click",this._onInputClick,this);var i=document.createElement("span");i.innerHTML=" "+e.name;var a=document.createElement("span");return n.appendChild(a),a.appendChild(t),a.appendChild(i),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var e,t,n=this._layerControlInputs,r=[],i=[];this._handlingClick=!0;for(var a=n.length-1;a>=0;a--)e=n[a],t=this._getLayer(e.layerId).layer,e.checked?r.push(t):e.checked||i.push(t);for(a=0;a<i.length;a++)this._map.hasLayer(i[a])&&this._map.removeLayer(i[a]);for(a=0;a<r.length;a++)this._map.hasLayer(r[a])||this._map.addLayer(r[a]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,r=this._map.getZoom(),i=n.length-1;i>=0;i--)e=n[i],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&r<t.options.minZoom||void 0!==t.options.maxZoom&&r>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,It(e,"click",$t),this.expand();var t=this;setTimeout(function(){Ft(e,"click",$t),t._preventClick=!1})}}),ln=function(e,t,n){return new sn(e,t,n)},cn=an.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=pt("div",t+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,r,i){var a=pt("a",n,r);return a.innerHTML=e,a.href="#",a.title=t,a.setAttribute("role","button"),a.setAttribute("aria-label",t),Ht(a),It(a,"click",Kt),It(a,"click",i,this),It(a,"click",this._refocusOnMap,this),a},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";bt(this._zoomInButton,t),bt(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(yt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(yt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});nn.mergeOptions({zoomControl:!0}),nn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new cn,this.addControl(this.zoomControl))});var un=function(e){return new cn(e)},dn=an.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=pt("div",t),r=this.options;return this._addScales(r,t+"-line",n),e.on(r.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=pt("div",t,n)),e.imperial&&(this._iScale=pt("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(r=this._getRoundNum(i),this._updateScale(this._iScale,r+" ft",r/i))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),hn=function(e){return new dn(e)},pn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',fn=an.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(De.inlineSvg?pn+" ":"")+"Leaflet</a>"},initialize:function(e){p(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=pt("div","leaflet-control-attribution"),Ht(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});nn.mergeOptions({attributionControl:!0}),nn.addInitHook(function(){this.options.attributionControl&&(new fn).addTo(this)});var mn=function(e){return new fn(e)};an.Layers=sn,an.Zoom=cn,an.Scale=dn,an.Attribution=fn,on.layers=ln,on.zoom=un,on.scale=hn,on.attribution=mn;var gn=E.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gn.addTo=function(e,t){return e.addHandler(t,this),this};var vn={Events:N},An=De.touch?"touchstart mousedown":"mousedown",yn=k.extend({options:{clickTolerance:3},initialize:function(e,t,n,r){p(this,r),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(It(this._dragStartTarget,An,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(yn._dragging===this&&this.finishDrag(!0),Ft(this._dragStartTarget,An,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!At(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)yn._dragging===this&&this.finishDrag();else if(!(yn._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)&&(yn._dragging=this,this._preventOutline&&Rt(this._element),Nt(),rt(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,n=Ot(this._element);this._startPoint=new R(t.clientX,t.clientY),this._startPos=Et(this._element),this._parentScale=jt(n);var r="mousedown"===e.type;It(document,r?"mousemove":"touchmove",this._onMove,this),It(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new R(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,$t(e),this._moved||(this.fire("dragstart"),this._moved=!0,yt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),yt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Mt(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){bt(document.body,"leaflet-dragging"),this._lastTarget&&(bt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ft(document,"mousemove touchmove",this._onMove,this),Ft(document,"mouseup touchend touchcancel",this._onUp,this),kt(),it();var t=this._moved&&this._moving;this._moving=!1,yn._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function bn(e,t,n){var r,i,a,o,s,l,c,u,d,h=[1,4,2,8];for(i=0,c=e.length;i<c;i++)e[i]._code=Ln(e[i],t);for(o=0;o<4;o++){for(u=h[o],r=[],i=0,a=(c=e.length)-1;i<c;a=i++)s=e[i],l=e[a],s._code&u?l._code&u||((d=Rn(l,s,u,t,n))._code=Ln(d,t),r.push(d)):(l._code&u&&((d=Rn(l,s,u,t,n))._code=Ln(d,t),r.push(d)),r.push(s));e=r}return e}function xn(e,t){var n,r,i,a,o,s,l,c,u;if(!e||0===e.length)throw new Error("latlngs not passed");Dn(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var d=U([0,0]),h=F(e);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(d=_n(e));var p=e.length,f=[];for(n=0;n<p;n++){var m=U(e[n]);f.push(t.project(U([m.lat-d.lat,m.lng-d.lng])))}for(s=l=c=0,n=0,r=p-1;n<p;r=n++)i=f[n],a=f[r],o=i.y*a.x-a.y*i.x,l+=(i.x+a.x)*o,c+=(i.y+a.y)*o,s+=3*o;u=0===s?f[0]:[l/s,c/s];var g=t.unproject(j(u));return U([g.lat+d.lat,g.lng+d.lng])}function _n(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var a=U(e[i]);t+=a.lat,n+=a.lng,r++}return U([t/r,n/r])}var wn,Sn={__proto__:null,clipPolygon:bn,polygonCenter:xn,centroid:_n};function Tn(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=En(e=Nn(e,n),n)}function Cn(e,t,n){return Math.sqrt(jn(e,t,n,!0))}function Mn(e,t,n){return jn(e,t,n)}function En(e,t){var n=e.length,r=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);r[0]=r[n-1]=1,Pn(e,r,t,0,n-1);var i,a=[];for(i=0;i<n;i++)r[i]&&a.push(e[i]);return a}function Pn(e,t,n,r,i){var a,o,s,l=0;for(o=r+1;o<=i-1;o++)(s=jn(e[o],e[r],e[i],!0))>l&&(a=o,l=s);l>n&&(t[a]=1,Pn(e,t,n,r,a),Pn(e,t,n,a,i))}function Nn(e,t){for(var n=[e[0]],r=1,i=0,a=e.length;r<a;r++)On(e[r],e[i])>t&&(n.push(e[r]),i=r);return i<a-1&&n.push(e[a-1]),n}function kn(e,t,n,r,i){var a,o,s,l=r?wn:Ln(e,n),c=Ln(t,n);for(wn=c;;){if(!(l|c))return[e,t];if(l&c)return!1;s=Ln(o=Rn(e,t,a=l||c,n,i),n),a===l?(e=o,l=s):(t=o,c=s)}}function Rn(e,t,n,r,i){var a,o,s=t.x-e.x,l=t.y-e.y,c=r.min,u=r.max;return 8&n?(a=e.x+s*(u.y-e.y)/l,o=u.y):4&n?(a=e.x+s*(c.y-e.y)/l,o=c.y):2&n?(a=u.x,o=e.y+l*(u.x-e.x)/s):1&n&&(a=c.x,o=e.y+l*(c.x-e.x)/s),new R(a,o,i)}function Ln(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function On(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function jn(e,t,n,r){var i,a=t.x,o=t.y,s=n.x-a,l=n.y-o,c=s*s+l*l;return c>0&&((i=((e.x-a)*s+(e.y-o)*l)/c)>1?(a=n.x,o=n.y):i>0&&(a+=s*i,o+=l*i)),s=e.x-a,l=e.y-o,r?s*s+l*l:new R(a,o)}function Dn(e){return!v(e[0])||"object"!==typeof e[0][0]&&"undefined"!==typeof e[0][0]}function In(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Dn(e)}function Bn(e,t){var n,r,i,a,o,s,l,c;if(!e||0===e.length)throw new Error("latlngs not passed");Dn(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var u=U([0,0]),d=F(e);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(u=_n(e));var h=e.length,p=[];for(n=0;n<h;n++){var f=U(e[n]);p.push(t.project(U([f.lat-u.lat,f.lng-u.lng])))}for(n=0,r=0;n<h-1;n++)r+=p[n].distanceTo(p[n+1])/2;if(0===r)c=p[0];else for(n=0,a=0;n<h-1;n++)if(o=p[n],s=p[n+1],(a+=i=o.distanceTo(s))>r){l=(a-r)/i,c=[s.x-l*(s.x-o.x),s.y-l*(s.y-o.y)];break}var m=t.unproject(j(c));return U([m.lat+u.lat,m.lng+u.lng])}var Fn={__proto__:null,simplify:Tn,pointToSegmentDistance:Cn,closestPointOnSegment:Mn,clipSegment:kn,_getEdgeIntersection:Rn,_getBitCode:Ln,_sqClosestPointOnSegment:jn,isFlat:Dn,_flat:In,polylineCenter:Bn},zn={project:function(e){return new R(e.lng,e.lat)},unproject:function(e){return new z(e.y,e.x)},bounds:new D([-180,-90],[180,90])},Un={R:6378137,R_MINOR:6356752.314245179,bounds:new D([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,r=e.lat*t,i=this.R_MINOR/n,a=Math.sqrt(1-i*i),o=a*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/Math.pow((1-o)/(1+o),a/2);return r=-n*Math.log(Math.max(s,1e-10)),new R(e.lng*t*n,r)},unproject:function(e){for(var t,n=180/Math.PI,r=this.R,i=this.R_MINOR/r,a=Math.sqrt(1-i*i),o=Math.exp(-e.y/r),s=Math.PI/2-2*Math.atan(o),l=0,c=.1;l<15&&Math.abs(c)>1e-7;l++)t=a*Math.sin(s),t=Math.pow((1-t)/(1+t),a/2),s+=c=Math.PI/2-2*Math.atan(o*t)-s;return new z(s*n,e.x*n/r)}},Vn={__proto__:null,LonLat:zn,Mercator:Un,SphericalMercator:W},Gn=n({},G,{code:"EPSG:3395",projection:Un,transformation:function(){var e=.5/(Math.PI*Un.R);return $(e,.5,-e,.5)}()}),qn=n({},G,{code:"EPSG:4326",projection:zn,transformation:$(1/180,1,-1/180,.5)}),Wn=n({},V,{projection:zn,transformation:$(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0});V.Earth=G,V.EPSG3395=Gn,V.EPSG3857=K,V.EPSG900913=X,V.EPSG4326=qn,V.Simple=Wn;var Hn=k.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[o(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[o(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",function(){t.off(n,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});nn.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=o(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=o(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return o(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?v(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[o(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=o(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var r in this._zoomBoundLayers){var i=this._zoomBoundLayers[r].options;e=void 0===i.minZoom?e:Math.min(e,i.minZoom),t=void 0===i.maxZoom?t:Math.max(t,i.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var $n=Hn.extend({initialize:function(e,t){var n,r;if(p(this,t),this._layers={},e)for(n=0,r=e.length;n<r;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"===typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,r=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,r);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return o(e)}}),Kn=function(e,t){return new $n(e,t)},Xn=$n.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),$n.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),$n.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new B;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),Yn=function(e,t){return new Xn(e,t)},Qn=E.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){p(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(r,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(e,t){var n=this.options,r=n[t+"Size"];"number"===typeof r&&(r=[r,r]);var i=j(r),a=j("shadow"===t&&n.shadowAnchor||n.iconAnchor||i&&i.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),a&&(e.style.marginLeft=-a.x+"px",e.style.marginTop=-a.y+"px"),i&&(e.style.width=i.x+"px",e.style.height=i.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return De.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Zn(e){return new Qn(e)}var Jn=Qn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!==typeof Jn.imagePath&&(Jn.imagePath=this._detectIconPath()),(this.options.imagePath||Jn.imagePath)+Qn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var r=t.exec(e);return r&&r[n]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=pt("div","leaflet-default-icon-path",document.body),t=ht(e,"background-image")||ht(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),er=gn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new yn(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),yt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&bt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,r=this._marker.options.autoPanSpeed,i=this._marker.options.autoPanPadding,a=Et(t._icon),o=n.getPixelBounds(),s=n.getPixelOrigin(),l=I(o.min._subtract(s).add(i),o.max._subtract(s).subtract(i));if(!l.contains(a)){var c=j((Math.max(l.max.x,a.x)-l.max.x)/(o.max.x-l.max.x)-(Math.min(l.min.x,a.x)-l.min.x)/(o.min.x-l.min.x),(Math.max(l.max.y,a.y)-l.max.y)/(o.max.y-l.max.y)-(Math.min(l.min.y,a.y)-l.min.y)/(o.min.y-l.min.y)).multiplyBy(r);n.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),Mt(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=T(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(C(this._panRequest),this._panRequest=T(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,r=Et(t._icon),i=t._map.layerPointToLatLng(r);n&&Mt(n,r),t._latlng=i,e.latlng=i,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){C(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),tr=Hn.extend({options:{icon:new Jn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){p(this,t),this._latlng=U(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=U(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),r=!1;n!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),yt(n,t),e.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&It(n,"focus",this._panOnFocus,this);var i=e.icon.createShadow(this._shadow),a=!1;i!==this._shadow&&(this._removeShadow(),a=!0),i&&(yt(i,t),i.alt=""),this._shadow=i,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),i&&a&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ft(this._icon,"focus",this._panOnFocus,this),ft(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ft(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Mt(this._icon,e),this._shadow&&Mt(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(yt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),er)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new er(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&wt(this._icon,e),this._shadow&&wt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?j(t.iconSize):j(0,0),r=t.iconAnchor?j(t.iconAnchor):j(0,0);e.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:n.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function nr(e,t){return new tr(e,t)}var rr=Hn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return p(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ir=rr.extend({options:{fill:!0,radius:10},initialize:function(e,t){p(this,t),this._latlng=U(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=U(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return rr.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),r=[e+n,t+n];this._pxBounds=new D(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ar(e,t){return new ir(e,t)}var or=ir.extend({initialize:function(e,t,r){if("number"===typeof t&&(t=n({},r,{radius:t})),p(this,t),this._latlng=U(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new B(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:rr.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,r=n.options.crs;if(r.distance===G.distance){var i=Math.PI/180,a=this._mRadius/G.R/i,o=n.project([t+a,e]),s=n.project([t-a,e]),l=o.add(s).divideBy(2),c=n.unproject(l).lat,u=Math.acos((Math.cos(a*i)-Math.sin(t*i)*Math.sin(c*i))/(Math.cos(t*i)*Math.cos(c*i)))/i;(isNaN(u)||0===u)&&(u=a/Math.cos(Math.PI/180*t)),this._point=l.subtract(n.getPixelOrigin()),this._radius=isNaN(u)?0:l.x-n.project([c,e-u]).x,this._radiusY=l.y-o.y}else{var d=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(d).x}this._updateBounds()}});function sr(e,t,n){return new or(e,t,n)}var lr=rr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){p(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,r=1/0,i=null,a=jn,o=0,s=this._parts.length;o<s;o++)for(var l=this._parts[o],c=1,u=l.length;c<u;c++){var d=a(e,t=l[c-1],n=l[c],!0);d<r&&(r=d,i=a(e,t,n))}return i&&(i.distance=Math.sqrt(r)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=U(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new B,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Dn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=Dn(e),r=0,i=e.length;r<i;r++)n?(t[r]=U(e[r]),this._bounds.extend(t[r])):t[r]=this._convertLatLngs(e[r]);return t},_project:function(){var e=new D;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new R(e,e);this._rawPxBounds&&(this._pxBounds=new D([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var r,i,a=e[0]instanceof z,o=e.length;if(a){for(i=[],r=0;r<o;r++)i[r]=this._map.latLngToLayerPoint(e[r]),n.extend(i[r]);t.push(i)}else for(r=0;r<o;r++)this._projectLatlngs(e[r],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,r,i,a,o,s,l=this._parts;for(t=0,r=0,i=this._rings.length;t<i;t++)for(n=0,a=(s=this._rings[t]).length;n<a-1;n++)(o=kn(s[n],s[n+1],e,n,!0))&&(l[r]=l[r]||[],l[r].push(o[0]),o[1]===s[n+1]&&n!==a-2||(l[r].push(o[1]),r++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,r=e.length;n<r;n++)e[n]=Tn(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,r,i,a,o,s,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,a=this._parts.length;n<a;n++)for(r=0,i=(o=(s=this._parts[n]).length)-1;r<o;i=r++)if((t||0!==r)&&Cn(e,s[i],s[r])<=l)return!0;return!1}});function cr(e,t){return new lr(e,t)}lr._flat=In;var ur=lr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return xn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=lr.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof z&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){lr.prototype._setLatLngs.call(this,e),Dn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Dn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new R(t,t);if(e=new D(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var r,i=0,a=this._rings.length;i<a;i++)(r=bn(this._rings[i],e,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,r,i,a,o,s,l,c=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,s=this._parts.length;i<s;i++)for(a=0,o=(l=(t=this._parts[i]).length)-1;a<l;o=a++)n=t[a],r=t[o],n.y>e.y!==r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(c=!c);return c||lr.prototype._containsPoint.call(this,e,!0)}});function dr(e,t){return new ur(e,t)}var hr=Xn.extend({initialize:function(e,t){p(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,r,i=v(e)?e:e.features;if(i){for(t=0,n=i.length;t<n;t++)((r=i[t]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var a=this.options;if(a.filter&&!a.filter(e))return this;var o=pr(e,a);return o?(o.feature=br(e),o.defaultOptions=o.options,this.resetStyle(o),a.onEachFeature&&a.onEachFeature(e,o),this.addLayer(o)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&("function"===typeof t&&(t=t(e.feature)),e.setStyle(t))}});function pr(e,t){var n,r,i,a,o="Feature"===e.type?e.geometry:e,s=o?o.coordinates:null,l=[],c=t&&t.pointToLayer,u=t&&t.coordsToLatLng||mr;if(!s&&!o)return null;switch(o.type){case"Point":return fr(c,e,n=u(s),t);case"MultiPoint":for(i=0,a=s.length;i<a;i++)n=u(s[i]),l.push(fr(c,e,n,t));return new Xn(l);case"LineString":case"MultiLineString":return r=gr(s,"LineString"===o.type?0:1,u),new lr(r,t);case"Polygon":case"MultiPolygon":return r=gr(s,"Polygon"===o.type?1:2,u),new ur(r,t);case"GeometryCollection":for(i=0,a=o.geometries.length;i<a;i++){var d=pr({geometry:o.geometries[i],type:"Feature",properties:e.properties},t);d&&l.push(d)}return new Xn(l);case"FeatureCollection":for(i=0,a=o.features.length;i<a;i++){var h=pr(o.features[i],t);h&&l.push(h)}return new Xn(l);default:throw new Error("Invalid GeoJSON object.")}}function fr(e,t,n,r){return e?e(t,n):new tr(n,r&&r.markersInheritOptions&&r)}function mr(e){return new z(e[1],e[0],e[2])}function gr(e,t,n){for(var r,i=[],a=0,o=e.length;a<o;a++)r=t?gr(e[a],t-1,n):(n||mr)(e[a]),i.push(r);return i}function vr(e,t){return void 0!==(e=U(e)).alt?[u(e.lng,t),u(e.lat,t),u(e.alt,t)]:[u(e.lng,t),u(e.lat,t)]}function Ar(e,t,n,r){for(var i=[],a=0,o=e.length;a<o;a++)i.push(t?Ar(e[a],Dn(e[a])?0:t-1,n,r):vr(e[a],r));return!t&&n&&i.length>0&&i.push(i[0].slice()),i}function yr(e,t){return e.feature?n({},e.feature,{geometry:t}):br(t)}function br(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var xr={toGeoJSON:function(e){return yr(this,{type:"Point",coordinates:vr(this.getLatLng(),e)})}};function _r(e,t){return new hr(e,t)}tr.include(xr),or.include(xr),ir.include(xr),lr.include({toGeoJSON:function(e){var t=!Dn(this._latlngs);return yr(this,{type:(t?"Multi":"")+"LineString",coordinates:Ar(this._latlngs,t?1:0,!1,e)})}}),ur.include({toGeoJSON:function(e){var t=!Dn(this._latlngs),n=t&&!Dn(this._latlngs[0]),r=Ar(this._latlngs,n?2:t?1:0,!0,e);return t||(r=[r]),yr(this,{type:(n?"Multi":"")+"Polygon",coordinates:r})}}),$n.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(n){t.push(n.toGeoJSON(e).geometry.coordinates)}),yr(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,r=[];return this.eachLayer(function(t){if(t.toGeoJSON){var i=t.toGeoJSON(e);if(n)r.push(i.geometry);else{var a=br(i);"FeatureCollection"===a.type?r.push.apply(r,a.features):r.push(a)}}}),n?yr(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var wr=_r,Sr=Hn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=F(t),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(yt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ft(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&gt(this._image),this},bringToBack:function(){return this._map&&vt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=F(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:pt("img");yt(t,"leaflet-image-layer"),this._zoomAnimated&&yt(t,"leaflet-zoom-animated"),this.options.className&&yt(t,this.options.className),t.onselectstart=c,t.onmousemove=c,t.onload=i(this.fire,this,"load"),t.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Ct(this._image,n,t)},_reset:function(){var e=this._image,t=new D(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();Mt(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){wt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Tr=function(e,t,n){return new Sr(e,t,n)},Cr=Sr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:pt("video");if(yt(t,"leaflet-image-layer"),this._zoomAnimated&&yt(t,"leaflet-zoom-animated"),this.options.className&&yt(t,this.options.className),t.onselectstart=c,t.onmousemove=c,t.onloadeddata=i(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),r=[],a=0;a<n.length;a++)r.push(n[a].src);this._url=n.length>0?r:[t.src]}else{v(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var o=0;o<this._url.length;o++){var s=pt("source");s.src=this._url[o],t.appendChild(s)}}}});function Mr(e,t,n){return new Cr(e,t,n)}var Er=Sr.extend({_initImage:function(){var e=this._image=this._url;yt(e,"leaflet-image-layer"),this._zoomAnimated&&yt(e,"leaflet-zoom-animated"),this.options.className&&yt(e,this.options.className),e.onselectstart=c,e.onmousemove=c}});function Pr(e,t,n){return new Er(e,t,n)}var Nr=Hn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof z||v(e))?(this._latlng=U(e),p(this,t)):(p(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&wt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&wt(this._container,1),this.bringToFront(),this.options.interactive&&(yt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(wt(this._container,0),this._removeTimeout=setTimeout(i(ft,void 0,this._container),200)):ft(this._container),this.options.interactive&&(bt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=U(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&gt(this._container),this},bringToBack:function(){return this._map&&vt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Xn){t=null;var n=this._source._layers;for(var r in n)if(n[r]._map){t=n[r];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=j(this.options.offset),n=this._getAnchor();this._zoomAnimated?Mt(this._container,e.add(n)):t=t.add(e).add(n);var r=this._containerBottom=-t.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=r+"px",this._container.style.left=i+"px"}},_getAnchor:function(){return[0,0]}});nn.include({_initOverlay:function(e,t,n,r){var i=t;return i instanceof e||(i=new e(r).setContent(t)),n&&i.setLatLng(n),i}}),Hn.include({_initOverlay:function(e,t,n,r){var i=n;return i instanceof e?(p(i,r),i._source=this):(i=t&&!r?t:new e(r,this)).setContent(n),i}});var kr=Nr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Nr.prototype.openOn.call(this,e)},onAdd:function(e){Nr.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof rr||this._source.on("preclick",qt))},onRemove:function(e){Nr.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof rr||this._source.off("preclick",qt))},getEvents:function(){var e=Nr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=pt("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=pt("div",e+"-content-wrapper",t);if(this._contentNode=pt("div",e+"-content",n),Ht(t),Wt(this._contentNode),It(t,"contextmenu",qt),this._tipContainer=pt("div",e+"-tip-container",t),this._tip=pt("div",e+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=pt("a",e+"-close-button",t);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',It(r,"click",function(e){$t(e),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var r=e.offsetHeight,i=this.options.maxHeight,a="leaflet-popup-scrolled";i&&r>i?(t.height=i+"px",yt(e,a)):bt(e,a),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();Mt(this._container,t.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var e=this._map,t=parseInt(ht(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+t,r=this._containerWidth,i=new R(this._containerLeft,-n-this._containerBottom);i._add(Et(this._container));var a=e.layerPointToContainerPoint(i),o=j(this.options.autoPanPadding),s=j(this.options.autoPanPaddingTopLeft||o),l=j(this.options.autoPanPaddingBottomRight||o),c=e.getSize(),u=0,d=0;a.x+r+l.x>c.x&&(u=a.x+r-c.x+l.x),a.x-u-s.x<0&&(u=a.x-s.x),a.y+n+l.y>c.y&&(d=a.y+n-c.y+l.y),a.y-d-s.y<0&&(d=a.y-s.y),(u||d)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([u,d]))}},_getAnchor:function(){return j(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Rr=function(e,t){return new kr(e,t)};nn.mergeOptions({closePopupOnClick:!0}),nn.include({openPopup:function(e,t,n){return this._initOverlay(kr,e,t,n).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),Hn.include({bindPopup:function(e,t){return this._popup=this._initOverlay(kr,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Xn||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Kt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof rr?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Lr=Nr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Nr.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Nr.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Nr.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=pt("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,r=this._map,i=this._container,a=r.latLngToContainerPoint(r.getCenter()),o=r.layerPointToContainerPoint(e),s=this.options.direction,l=i.offsetWidth,c=i.offsetHeight,u=j(this.options.offset),d=this._getAnchor();"top"===s?(t=l/2,n=c):"bottom"===s?(t=l/2,n=0):"center"===s?(t=l/2,n=c/2):"right"===s?(t=0,n=c/2):"left"===s?(t=l,n=c/2):o.x<a.x?(s="right",t=0,n=c/2):(s="left",t=l+2*(u.x+d.x),n=c/2),e=e.subtract(j(t,n,!0)).add(u).add(d),bt(i,"leaflet-tooltip-right"),bt(i,"leaflet-tooltip-left"),bt(i,"leaflet-tooltip-top"),bt(i,"leaflet-tooltip-bottom"),yt(i,"leaflet-tooltip-"+s),Mt(i,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&wt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return j(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Or=function(e,t){return new Lr(e,t)};nn.include({openTooltip:function(e,t,n){return this._initOverlay(Lr,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Hn.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Lr,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Xn||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&(It(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),It(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)})}else this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var t,n,r=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),r=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(r)}});var jr=Qn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(mt(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var r=j(n.bgPos);t.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Dr(e){return new jr(e)}Qn.Default=Jn;var Ir=Hn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:De.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){p(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),ft(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(gt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(vt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof R?e:new R(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,r=-e(-1/0,1/0),i=0,a=n.length;i<a;i++)t=n[i].style.zIndex,n[i]!==this._container&&t&&(r=e(r,+t));isFinite(r)&&(this.options.zIndex=r+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!De.ielt9){wt(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var r in this._tiles){var i=this._tiles[r];if(i.current&&i.loaded){var a=Math.min(1,(e-i.loaded)/200);wt(i.el,a),a<1?t=!0:(i.active?n=!0:this._onOpaqueTile(i),i.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(C(this._fadeFrame),this._fadeFrame=T(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=pt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(ft(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var r=this._levels[e],i=this._map;return r||((r=this._levels[e]={}).el=pt("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=t,r.origin=i.project(i.unproject(i.getPixelOrigin()),e).round(),r.zoom=e,this._setZoomTransform(r,i.getCenter(),i.getZoom()),c(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var r=t.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)ft(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,r){var i=Math.floor(e/2),a=Math.floor(t/2),o=n-1,s=new R(+i,+a);s.z=+o;var l=this._tileCoordsToKey(s),c=this._tiles[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),o>r&&this._retainParent(i,a,o,r))},_retainChildren:function(e,t,n,r){for(var i=2*e;i<2*e+2;i++)for(var a=2*t;a<2*t+2;a++){var o=new R(i,a);o.z=n+1;var s=this._tileCoordsToKey(o),l=this._tiles[s];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),n+1<r&&this._retainChildren(i,a,n+1,r))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,r){var i=Math.round(t);i=void 0!==this.options.maxZoom&&i>this.options.maxZoom||void 0!==this.options.minZoom&&i<this.options.minZoom?void 0:this._clampZoom(i);var a=this.options.updateWhenZooming&&i!==this._tileZoom;r&&!a||(this._tileZoom=i,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==i&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var r=this._map.getZoomScale(n,e.zoom),i=e.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(t,n)).round();De.any3d?Ct(e.el,i,r):Mt(e.el,i)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),r=this._tileZoom,i=this._map.getPixelWorldBounds(this._tileZoom);i&&(this._globalTileRange=this._pxBoundsToTileRange(i)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],r).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],r).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],r).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],r).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),r=t.getZoomScale(n,this._tileZoom),i=t.project(e,this._tileZoom).floor(),a=t.getSize().divideBy(2*r);return new D(i.subtract(a),i.add(a))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(e),i=this._pxBoundsToTileRange(r),a=i.getCenter(),o=[],s=this.options.keepBuffer,l=new D(i.getBottomLeft().subtract([s,-s]),i.getTopRight().add([s,-s]));if(!(isFinite(i.min.x)&&isFinite(i.min.y)&&isFinite(i.max.x)&&isFinite(i.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var u=this._tiles[c].coords;u.z===this._tileZoom&&l.contains(new R(u.x,u.y))||(this._tiles[c].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var d=i.min.y;d<=i.max.y;d++)for(var h=i.min.x;h<=i.max.x;h++){var p=new R(h,d);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:o.push(p)}}if(o.sort(function(e,t){return e.distanceTo(a)-t.distanceTo(a)}),0!==o.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(h=0;h<o.length;h++)this._addTile(o[h],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(e);return F(this.options.bounds).overlaps(r)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),r=e.scaleBy(n),i=r.add(n);return[t.unproject(r,e.z),t.unproject(i,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new B(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new R(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(ft(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){yt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=c,e.onmousemove=c,De.ielt9&&this.options.opacity<1&&wt(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),r=this._tileCoordsToKey(e),a=this.createTile(this._wrapCoords(e),i(this._tileReady,this,e));this._initTile(a),this.createTile.length<2&&T(i(this._tileReady,this,e,null,a)),Mt(a,n),this._tiles[r]={el:a,coords:e,current:!0},t.appendChild(a),this.fire("tileloadstart",{tile:a,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var r=this._tileCoordsToKey(e);(n=this._tiles[r])&&(n.loaded=+new Date,this._map._fadeAnimated?(wt(n.el,0),C(this._fadeFrame),this._fadeFrame=T(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(yt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),De.ielt9||!this._map._fadeAnimated?T(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new R(this._wrapX?l(e.x,this._wrapX):e.x,this._wrapY?l(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new D(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Br(e){return new Ir(e)}var Fr=Ir.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=p(this,t)).detectRetina&&De.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return It(n,"load",i(this._tileOnLoad,this,t,n)),It(n,"error",i(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:De.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=r),t["-y"]=r}return g(this._url,n(t,this.options))},_tileOnLoad:function(e,t){De.ielt9?setTimeout(i(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var r=this.options.errorTileUrl;r&&t.getAttribute("src")!==r&&(t.src=r),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=c,t.onerror=c,!t.complete)){t.src=y;var n=this._tiles[e].coords;ft(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",y),Ir.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==y))return Ir.prototype._tileReady.call(this,e,t,n)}});function zr(e,t){return new Fr(e,t)}var Ur=Fr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var r=n({},this.defaultWmsParams);for(var i in t)i in this.options||(r[i]=t[i]);var a=(t=p(this,t)).detectRetina&&De.retina?2:1,o=this.getTileSize();r.width=o.x*a,r.height=o.y*a,this.wmsParams=r},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Fr.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,r=I(n.project(t[0]),n.project(t[1])),i=r.min,a=r.max,o=(this._wmsVersion>=1.3&&this._crs===qn?[i.y,i.x,a.y,a.x]:[i.x,i.y,a.x,a.y]).join(","),s=Fr.prototype.getTileUrl.call(this,e);return s+f(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function Vr(e,t){return new Ur(e,t)}Fr.WMS=Ur,zr.wms=Vr;var Gr=Hn.extend({options:{padding:.1},initialize:function(e){p(this,e),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),yt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),i=this._map.project(this._center,t),a=r.multiplyBy(-n).add(i).subtract(this._map._getNewPixelOrigin(e,t));De.any3d?Ct(this._container,a,n):Mt(this._container,a)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new D(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),qr=Gr.extend({options:{tolerance:0},getEvents:function(){var e=Gr.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Gr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");It(e,"mousemove",this._onMouseMove,this),It(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),It(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){C(this._redrawRequest),delete this._ctx,ft(this._container),Ft(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Gr.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),r=De.retina?2:1;Mt(t,e.min),t.width=r*n.x,t.height=r*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",De.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){Gr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[o(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,r=t.prev;n?n.prev=r:this._drawLast=r,r?r.next=n:this._drawFirst=n,delete e._order,delete this._layers[o(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"===typeof e.options.dashArray){var t,n,r=e.options.dashArray.split(/[, ]+/),i=[];for(n=0;n<r.length;n++){if(t=Number(r[n]),isNaN(t))return;i.push(t)}e.options._dashArray=i}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||T(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new D,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)e=r.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,r,i,a,o=e._parts,s=o.length,l=this._ctx;if(s){for(l.beginPath(),n=0;n<s;n++){for(r=0,i=o[n].length;r<i;r++)a=o[n][r],l[r?"lineTo":"moveTo"](a.x,a.y);t&&l.closePath()}this._fillStroke(l,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,r=Math.max(Math.round(e._radius),1),i=(Math.max(Math.round(e._radiusY),1)||r)/r;1!==i&&(n.save(),n.scale(1,i)),n.beginPath(),n.arc(t.x,t.y/i,r,0,2*Math.PI,!1),1!==i&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,r=this._map.mouseEventToLayerPoint(e),i=this._drawFirst;i;i=i.next)(t=i.layer).options.interactive&&t._containsPoint(r)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(n=t);this._fireEvent(!!n&&[n],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(bt(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,r,a=this._drawFirst;a;a=a.next)(n=a.layer).options.interactive&&n._containsPoint(t)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(e),r&&(yt(this._container,"leaflet-interactive"),this._fireEvent([r],e,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(i(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;n&&(n.prev=r,r?r.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;r&&(r.next=n,n?n.prev=r:r&&(this._drawLast=r),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function Wr(e){return De.canvas?new qr(e):null}var Hr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),$r={_initContainer:function(){this._container=pt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Gr.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=Hr("shape");yt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=Hr("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;ft(t),e.removeInteractiveTarget(t),delete this._layers[o(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,r=e.options,i=e._container;i.stroked=!!r.stroke,i.filled=!!r.fill,r.stroke?(t||(t=e._stroke=Hr("stroke")),i.appendChild(t),t.weight=r.weight+"px",t.color=r.color,t.opacity=r.opacity,r.dashArray?t.dashStyle=v(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=r.lineCap.replace("butt","flat"),t.joinstyle=r.lineJoin):t&&(i.removeChild(t),e._stroke=null),r.fill?(n||(n=e._fill=Hr("fill")),i.appendChild(n),n.color=r.fillColor||r.color,n.opacity=r.fillOpacity):n&&(i.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),r=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+r+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){gt(e._container)},_bringToBack:function(e){vt(e._container)}},Kr=De.vml?Hr:Y,Xr=Gr.extend({_initContainer:function(){this._container=Kr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Kr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ft(this._container),Ft(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Gr.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),Mt(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Kr("path");e.options.className&&yt(t,e.options.className),e.options.interactive&&yt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){ft(e._path),e.removeInteractiveTarget(e._path),delete this._layers[o(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Q(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),r="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",i=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+r+2*n+",0 "+r+2*-n+",0 ";this._setPath(e,i)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){gt(e._path)},_bringToBack:function(e){vt(e._path)}});function Yr(e){return De.svg||De.vml?new Xr(e):null}De.vml&&Xr.include($r),nn.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Wr(e)||Yr(e)}});var Qr=ur.extend({initialize:function(e,t){ur.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=F(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Zr(e,t){return new Qr(e,t)}Xr.create=Kr,Xr.pointsToPath=Q,hr.geometryToLayer=pr,hr.coordsToLatLng=mr,hr.coordsToLatLngs=gr,hr.latLngToCoords=vr,hr.latLngsToCoords=Ar,hr.getFeature=yr,hr.asFeature=br,nn.mergeOptions({boxZoom:!0});var Jr=gn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){It(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ft(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ft(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),rt(),Nt(),this._startPoint=this._map.mouseEventToContainerPoint(e),It(document,{contextmenu:Kt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=pt("div","leaflet-zoom-box",this._container),yt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new D(this._point,this._startPoint),n=t.getSize();Mt(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(ft(this._box),bt(this._container,"leaflet-crosshair")),it(),kt(),Ft(document,{contextmenu:Kt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var t=new B(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nn.addInitHook("addHandler","boxZoom",Jr),nn.mergeOptions({doubleClickZoom:!0});var ei=gn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),r=t.options.zoomDelta,i=e.originalEvent.shiftKey?n-r:n+r;"center"===t.options.doubleClickZoom?t.setZoom(i):t.setZoomAround(e.containerPoint,i)}});nn.addInitHook("addHandler","doubleClickZoom",ei),nn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ti=gn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new yn(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}yt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){bt(this._map._container,"leaflet-grab"),bt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=F(this._map.options.maxBounds);this._offsetLimit=I(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,a=(r+t+n)%e-t-n,o=Math.abs(i+n)<Math.abs(a+n)?i:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,n=t.options,r=!n.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),r)t.fire("moveend");else{this._prunePositions(+new Date);var i=this._lastPos.subtract(this._positions[0]),a=(this._lastTime-this._times[0])/1e3,o=n.easeLinearity,s=i.multiplyBy(o/a),l=s.distanceTo([0,0]),c=Math.min(n.inertiaMaxSpeed,l),u=s.multiplyBy(c/l),d=c/(n.inertiaDeceleration*o),h=u.multiplyBy(-d/2).round();h.x||h.y?(h=t._limitOffset(h,t.options.maxBounds),T(function(){t.panBy(h,{duration:d,easeLinearity:o,noMoveStart:!0,animate:!0})})):t.fire("moveend")}}});nn.addInitHook("addHandler","dragging",ti),nn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ni=gn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),It(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ft(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,r=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(r,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,r=this._panKeys={},i=this.keyCodes;for(t=0,n=i.left.length;t<n;t++)r[i.left[t]]=[-1*e,0];for(t=0,n=i.right.length;t<n;t++)r[i.right[t]]=[e,0];for(t=0,n=i.down.length;t<n;t++)r[i.down[t]]=[0,e];for(t=0,n=i.up.length;t<n;t++)r[i.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,r=this._zoomKeys={},i=this.keyCodes;for(t=0,n=i.zoomIn.length;t<n;t++)r[i.zoomIn[t]]=e;for(t=0,n=i.zoomOut.length;t<n;t++)r[i.zoomOut[t]]=-e},_addHooks:function(){It(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ft(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,r=this._map;if(n in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(t=this._panKeys[n],e.shiftKey&&(t=j(t).multiplyBy(3)),r.options.maxBounds&&(t=r._limitOffset(j(t),r.options.maxBounds)),r.options.worldCopyJump){var i=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(t)));r.panTo(i)}else r.panBy(t)}else if(n in this._zoomKeys)r.setZoom(r.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}Kt(e)}}});nn.addInitHook("addHandler","keyboard",ni),nn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ri=gn.extend({addHooks:function(){It(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ft(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Zt(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),Kt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),i=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,a=n?Math.ceil(i/n)*n:i,o=e._limitZoom(t+(this._delta>0?a:-a))-t;this._delta=0,this._startTime=null,o&&("center"===e.options.scrollWheelZoom?e.setZoom(t+o):e.setZoomAround(this._lastMousePos,t+o))}});nn.addInitHook("addHandler","scrollWheelZoom",ri);var ii=600;nn.mergeOptions({tapHold:De.touchNative&&De.safari&&De.mobile,tapTolerance:15});var ai=gn.extend({addHooks:function(){It(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ft(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new R(t.clientX,t.clientY),this._holdTimeout=setTimeout(i(function(){this._cancel(),this._isTapValid()&&(It(document,"touchend",$t),It(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),ii),It(document,"touchend touchcancel contextmenu",this._cancel,this),It(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Ft(document,"touchend",$t),Ft(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Ft(document,"touchend touchcancel contextmenu",this._cancel,this),Ft(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new R(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});nn.addInitHook("addHandler","tapHold",ai),nn.mergeOptions({touchZoom:De.touch,bounceAtZoomLimits:!0});var oi=gn.extend({addHooks:function(){yt(this._map._container,"leaflet-touch-zoom"),It(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){bt(this._map._container,"leaflet-touch-zoom"),Ft(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(r)._divideBy(2))),this._startDist=n.distanceTo(r),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),It(document,"touchmove",this._onTouchMove,this),It(document,"touchend touchcancel",this._onTouchEnd,this),$t(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]),a=n.distanceTo(r)/this._startDist;if(this._zoom=t.getScaleZoom(a,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&a<1||this._zoom>t.getMaxZoom()&&a>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===a)return}else{var o=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===a&&0===o.x&&0===o.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),C(this._animRequest);var s=i(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=T(s,this,!0),$t(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,C(this._animRequest),Ft(document,"touchmove",this._onTouchMove,this),Ft(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});nn.addInitHook("addHandler","touchZoom",oi),nn.BoxZoom=Jr,nn.DoubleClickZoom=ei,nn.Drag=ti,nn.Keyboard=ni,nn.ScrollWheelZoom=ri,nn.TapHold=ai,nn.TouchZoom=oi,e.Bounds=D,e.Browser=De,e.CRS=V,e.Canvas=qr,e.Circle=or,e.CircleMarker=ir,e.Class=E,e.Control=an,e.DivIcon=jr,e.DivOverlay=Nr,e.DomEvent=en,e.DomUtil=Dt,e.Draggable=yn,e.Evented=k,e.FeatureGroup=Xn,e.GeoJSON=hr,e.GridLayer=Ir,e.Handler=gn,e.Icon=Qn,e.ImageOverlay=Sr,e.LatLng=z,e.LatLngBounds=B,e.Layer=Hn,e.LayerGroup=$n,e.LineUtil=Fn,e.Map=nn,e.Marker=tr,e.Mixin=vn,e.Path=rr,e.Point=R,e.PolyUtil=Sn,e.Polygon=ur,e.Polyline=lr,e.Popup=kr,e.PosAnimation=tn,e.Projection=Vn,e.Rectangle=Qr,e.Renderer=Gr,e.SVG=Xr,e.SVGOverlay=Er,e.TileLayer=Fr,e.Tooltip=Lr,e.Transformation=H,e.Util=M,e.VideoOverlay=Cr,e.bind=i,e.bounds=I,e.canvas=Wr,e.circle=sr,e.circleMarker=ar,e.control=on,e.divIcon=Dr,e.extend=n,e.featureGroup=Yn,e.geoJSON=_r,e.geoJson=wr,e.gridLayer=Br,e.icon=Zn,e.imageOverlay=Tr,e.latLng=U,e.latLngBounds=F,e.layerGroup=Kn,e.map=rn,e.marker=nr,e.point=j,e.polygon=dr,e.polyline=cr,e.popup=Rr,e.rectangle=Zr,e.setOptions=p,e.stamp=o,e.svg=Yr,e.svgOverlay=Pr,e.tileLayer=zr,e.tooltip=Or,e.transformation=$,e.version=t,e.videoOverlay=Mr;var si=window.L;e.noConflict=function(){return window.L=si,this},window.L=e}(t)},269:function(e,t,n){"use strict";n.d(t,{C:function(){return v},Y:function(){return A}});const r=new Set(["Arab","Syrc","Samr","Mand","Thaa","Mend","Nkoo","Adlm","Rohg","Hebr"]),i=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]);function a(e){if(Intl.Locale){let t=new Intl.Locale(e).maximize(),n="function"===typeof t.getTextInfo?t.getTextInfo():t.textInfo;if(n)return"rtl"===n.direction;if(t.script)return r.has(t.script)}let t=e.split("-")[0];return i.has(t)}var o=n(5043),s=n(60);const l=Symbol.for("react-aria.i18n.locale");function c(){let e="undefined"!==typeof window&&window[l]||"undefined"!==typeof navigator&&(navigator.language||navigator.userLanguage)||"en-US";try{Intl.DateTimeFormat.supportedLocalesOf([e])}catch{e="en-US"}return{locale:e,direction:a(e)?"rtl":"ltr"}}let u=c(),d=new Set;function h(){u=c();for(let e of d)e(u)}function p(){let e=(0,s.wR)(),[t,n]=(0,o.useState)(u);if((0,o.useEffect)(()=>(0===d.size&&window.addEventListener("languagechange",h),d.add(n),()=>{d.delete(n),0===d.size&&window.removeEventListener("languagechange",h)}),[]),e){return{locale:"undefined"!==typeof window&&window[l]||"en-US",direction:"ltr"}}return t}const f=o.createContext(null);function m(e){let{locale:t,children:n}=e,r=o.useMemo(()=>({locale:t,direction:a(t)?"rtl":"ltr"}),[t]);return o.createElement(f.Provider,{value:r},n)}function g(e){let{children:t}=e,n=p();return o.createElement(f.Provider,{value:n},t)}function v(e){let{locale:t,children:n}=e;return t?o.createElement(m,{locale:t,children:n}):o.createElement(g,{children:n})}function A(){let e=p();return(0,o.useContext)(f)||e}},293:function(e,t,n){"use strict";n.d(t,{E:function(){return i}});var r=n(5043);const i=n(4735).B?r.useLayoutEffect:r.useEffect},356:function(e,t,n){e.exports=n(9645).last},368:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});let r=new Map,i=new Set;function a(){if("undefined"===typeof window)return;function e(e){return"propertyName"in e}let t=n=>{if(!e(n)||!n.target)return;let a=r.get(n.target);if(a&&(a.delete(n.propertyName),0===a.size&&(n.target.removeEventListener("transitioncancel",t),r.delete(n.target)),0===r.size)){for(let e of i)e();i.clear()}};document.body.addEventListener("transitionrun",n=>{if(!e(n)||!n.target)return;let i=r.get(n.target);i||(i=new Set,r.set(n.target,i),n.target.addEventListener("transitioncancel",t,{once:!0})),i.add(n.propertyName)}),document.body.addEventListener("transitionend",t)}function o(e){requestAnimationFrame(()=>{!function(){for(const[e]of r)"isConnected"in e&&!e.isConnected&&r.delete(e)}(),0===r.size?e():i.add(e)})}"undefined"!==typeof document&&("loading"!==document.readyState?a():document.addEventListener("DOMContentLoaded",a))},381:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});var r=n(708);const i={...r.ai,transform:Math.round};var a=n(7449);const o={rotate:a.uj,rotateX:a.uj,rotateY:a.uj,rotateZ:a.uj,scale:r.hs,scaleX:r.hs,scaleY:r.hs,scaleZ:r.hs,skew:a.uj,skewX:a.uj,skewY:a.uj,distance:a.px,translateX:a.px,translateY:a.px,translateZ:a.px,x:a.px,y:a.px,z:a.px,perspective:a.px,transformPerspective:a.px,opacity:r.X4,originX:a.gQ,originY:a.gQ,originZ:a.px},s={borderWidth:a.px,borderTopWidth:a.px,borderRightWidth:a.px,borderBottomWidth:a.px,borderLeftWidth:a.px,borderRadius:a.px,radius:a.px,borderTopLeftRadius:a.px,borderTopRightRadius:a.px,borderBottomRightRadius:a.px,borderBottomLeftRadius:a.px,width:a.px,maxWidth:a.px,height:a.px,maxHeight:a.px,top:a.px,right:a.px,bottom:a.px,left:a.px,padding:a.px,paddingTop:a.px,paddingRight:a.px,paddingBottom:a.px,paddingLeft:a.px,margin:a.px,marginTop:a.px,marginRight:a.px,marginBottom:a.px,marginLeft:a.px,backgroundPositionX:a.px,backgroundPositionY:a.px,...o,zIndex:i,fillOpacity:r.X4,strokeOpacity:r.X4,numOctaves:i}},418:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toString=function e(t){if(null==t)return"";if("string"===typeof t)return t;if(Array.isArray(t))return t.map(e).join(",");const n=String(t);return"0"===n&&Object.is(Number(t),-0)?"-0":n}},462:function(e,t,n){"use strict";n.d(t,{$:function(){return i}});var r=n(8689);const i=new Set(["width","height","top","left","right","bottom",...r.U])},579:function(e,t,n){"use strict";e.exports=n(1153)},587:function(e,t,n){"use strict";n.d(t,{t:function(){return c},A:function(){return u}});var r=n(8493);const i="undefined"!==typeof Element&&"checkVisibility"in Element.prototype;function a(e,t){return i?e.checkVisibility({visibilityProperty:!0})&&!e.closest("[data-react-aria-prevent-focus]"):"#comment"!==e.nodeName&&function(e){const t=(0,r.mD)(e);if(!(e instanceof t.HTMLElement)&&!(e instanceof t.SVGElement))return!1;let{display:n,visibility:i}=e.style,a="none"!==n&&"hidden"!==i&&"collapse"!==i;if(a){const{getComputedStyle:t}=e.ownerDocument.defaultView;let{display:n,visibility:r}=t(e);a="none"!==n&&"hidden"!==r&&"collapse"!==r}return a}(e)&&function(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&("DETAILS"!==e.nodeName||!t||"SUMMARY"===t.nodeName||e.hasAttribute("open"))}(e,t)&&(!e.parentElement||a(e.parentElement,e))}const o=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable^="false"])',"permission"],s=o.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";o.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const l=o.join(':not([hidden]):not([tabindex="-1"]),');function c(e){return e.matches(s)&&a(e)&&!d(e)}function u(e){return e.matches(l)&&a(e)&&!d(e)}function d(e){let t=e;for(;null!=t;){if(t instanceof t.ownerDocument.defaultView.HTMLElement&&t.inert)return!0;t=t.parentElement}return!1}},619:function(e){e.exports={COLOR_MATH_GLSL:"\n// ============================================================================\n// RGB <-> HSL Conversion\n// ============================================================================\n\nvec3 rgb2hsl(vec3 c) {\n  float maxC = max(max(c.r, c.g), c.b);\n  float minC = min(min(c.r, c.g), c.b);\n  float l = (maxC + minC) / 2.0;\n  \n  if (maxC == minC) {\n    return vec3(0.0, 0.0, l);\n  }\n  \n  float d = maxC - minC;\n  float s = l > 0.5 ? d / (2.0 - maxC - minC) : d / (maxC + minC);\n  \n  float h;\n  if (maxC == c.r) {\n    h = (c.g - c.b) / d + (c.g < c.b ? 6.0 : 0.0);\n  } else if (maxC == c.g) {\n    h = (c.b - c.r) / d + 2.0;\n  } else {\n    h = (c.r - c.g) / d + 4.0;\n  }\n  h /= 6.0;\n  \n  return vec3(h * 360.0, s, l);\n}\n\nfloat hue2rgb(float p, float q, float t) {\n  if (t < 0.0) t += 1.0;\n  if (t > 1.0) t -= 1.0;\n  if (t < 1.0/6.0) return p + (q - p) * 6.0 * t;\n  if (t < 1.0/2.0) return q;\n  if (t < 2.0/3.0) return p + (q - p) * (2.0/3.0 - t) * 6.0;\n  return p;\n}\n\nvec3 hsl2rgb(vec3 hsl) {\n  float h = mod(hsl.x, 360.0) / 360.0;\n  float s = clamp(hsl.y, 0.0, 1.0);\n  float l = clamp(hsl.z, 0.0, 1.0);\n  \n  if (s == 0.0) {\n    return vec3(l);\n  }\n  \n  float q = l < 0.5 ? l * (1.0 + s) : l + s - l * s;\n  float p = 2.0 * l - q;\n  \n  float r = hue2rgb(p, q, h + 1.0/3.0);\n  float g = hue2rgb(p, q, h);\n  float b = hue2rgb(p, q, h - 1.0/3.0);\n  \n  return vec3(r, g, b);\n}\n\n// ============================================================================\n// Luminance Calculation\n// ============================================================================\n\n// Rec. 709 luminance coefficients\nfloat calcLuminance(vec3 c) {\n  return 0.2126 * c.r + 0.7152 * c.g + 0.0722 * c.b;\n}\n\n// Alternative: Rec. 601 coefficients (legacy)\nfloat calcLuminance601(vec3 c) {\n  return 0.299 * c.r + 0.587 * c.g + 0.114 * c.b;\n}\n"}},681:function(e,t,n){"use strict";n.d(t,{T:function(){return a}});var r=n(5043),i=n(8987);function a(e){let[t,n]=(0,i.P)(e.isOpen,e.defaultOpen||!1,e.onOpenChange);const a=(0,r.useCallback)(()=>{n(!0)},[n]),o=(0,r.useCallback)(()=>{n(!1)},[n]),s=(0,r.useCallback)(()=>{n(!t)},[n,t]);return{isOpen:t,setOpen:n,open:a,close:o,toggle:s}}},708:function(e,t,n){"use strict";n.d(t,{X4:function(){return a},ai:function(){return i},hs:function(){return o}});var r=n(217);const i={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},a={...i,transform:e=>(0,r.q)(0,1,e)},o={...i,default:1}},724:function(e){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1),i=function(){function e(e,t,n){void 0===e&&(e=NaN),void 0===t&&(t=NaN),void 0===n&&(n=!1),this._minFPS=t,this._maxFPS=e,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._maxInterval=isNaN(this._minFPS)?NaN:1e3/this._minFPS,this._minInterval=isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=new r.default,this._onPause=new r.default,this._onTick=new r.default,this._onTickOncePerFrame=new r.default,n||this.resume()}return e.prototype.updateOnce=function(e){e(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},e.prototype.resume=function(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=this.getTimer(),this._onResume.dispatch(),this.animateOnce())},e.prototype.pause=function(){this._isRunning&&(this._isRunning=!1,this._onPause.dispatch(),window.cancelAnimationFrame(this._animationFrameHandle))},e.prototype.dispose=function(){this.pause(),this._onResume.removeAll(),this._onPause.removeAll(),this._onTick.removeAll()},Object.defineProperty(e.prototype,"currentTick",{get:function(){return this._currentTick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTimeSeconds",{get:function(){return this._currentTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tickDeltaTimeSeconds",{get:function(){return this._tickDeltaTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){this._timeScale!==e&&(this._timeScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onResume",{get:function(){return this._onResume},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onPause",{get:function(){return this._onPause},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTick",{get:function(){return this._onTick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTickOncePerFrame",{get:function(){return this._onTickOncePerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),e.prototype.animateOnce=function(){var e=this;this._animationFrameHandle=window.requestAnimationFrame(function(){return e.onFrame()})},e.prototype.onFrame=function(){if(this._now=this.getTimer(),this._frameDeltaTime=this._now-this._lastTimeUpdated,isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)if(isNaN(this._maxInterval))this.update(this._frameDeltaTime*this._timeScale,!0),this._lastTimeUpdated=this._now;else for(this._interval=Math.min(this._frameDeltaTime,this._maxInterval);this._now>=this._lastTimeUpdated+this._interval;)this.update(this._interval*this._timeScale,this._now<=this._lastTimeUpdated+2*this._maxInterval),this._lastTimeUpdated+=this._interval;this._isRunning&&this.animateOnce()},e.prototype.update=function(e,t){void 0===t&&(t=!0),this._currentTick++,this._currentTime+=e,this._tickDeltaTime=e,this._onTick.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),t&&this._onTickOncePerFrame.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},e.prototype.getTimer=function(){return Date.now()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";var n=function(){function e(){this.functions=[]}return e.prototype.add=function(e){return-1===this.functions.indexOf(e)&&(this.functions.push(e),!0)},e.prototype.remove=function(e){var t=this.functions.indexOf(e);return t>-1&&(this.functions.splice(t,1),!0)},e.prototype.removeAll=function(){return this.functions.length>0&&(this.functions.length=0,!0)},e.prototype.dispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.functions.concat().forEach(function(t){t.apply(void 0,e)})},Object.defineProperty(e.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}])})}])},775:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var r=n(5043),i=n(8624),a=n(6770),o=n(4375),s=n(4640),l=(n(1997),n(579));const c={camera:{fetchAll:i.RS,create:i.Wt,label:"Camera",placeholder:"Select camera...",icon:"\ud83d\udcf7"},lens:{fetchAll:i.Tu,create:i.zX,label:"Lens",placeholder:"Select lens...",icon:"\ud83d\udd2d"},flash:{fetchAll:i.Lu,create:i.Ns,label:"Flash",placeholder:"Select flash...",icon:"\u26a1"},scanner:{fetchAll:i.Qp,create:i.z1,label:"Scanner",placeholder:"Select scanner...",icon:"\ud83d\udda8\ufe0f"},"film-back":{fetchAll:i.fO,create:i.n3,label:"Film Back",placeholder:"Select film back...",icon:"\ud83d\udce6"}};function u({type:e="camera",value:t=null,onChange:n,cameraId:u=null,disabled:d=!1,showQuickAdd:h=!0,className:p="",style:f={}}){const m=c[e],[g,v]=(0,r.useState)([]),[A,y]=(0,r.useState)(!0),[b,x]=(0,r.useState)(!1),[_,w]=(0,r.useState)(""),[S,T]=(0,r.useState)(!1),[C,M]=(0,r.useState)(""),[E,P]=(0,r.useState)(null),[N,k]=(0,r.useState)(!1),[R,L]=(0,r.useState)(null),O=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t=!0;return(async()=>{y(!0);try{let n;if("lens"===e&&u){const e=await(0,i.$N)(u);if(e.fixed_lens)return P({focal_length:e.focal_length,max_aperture:e.max_aperture}),L(null),v([]),void(t&&y(!1));P(null),L(e.camera_mount||null),n=N?await m.fetchAll():e.lenses||[],t&&v(Array.isArray(n)?n:[])}else n=await m.fetchAll(),t&&(v(Array.isArray(n)?n:[]),P(null),L(null))}catch(n){console.error(`[EquipmentSelector] Failed to load ${e}:`,n),t&&v([])}finally{t&&y(!1)}})(),()=>{t=!1}},[e,u,m,N]);const j=(0,r.useMemo)(()=>t&&g.find(e=>e.id===t)||null,[t,g]),D=(0,r.useMemo)(()=>{if(!_.trim())return g;const e=_.toLowerCase();return g.filter(t=>{var n,r,i;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(r=t.brand)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(i=t.model)||void 0===i?void 0:i.toLowerCase().includes(e))})},[g,_]),I=async()=>{if(C.trim())try{const e=await m.create({name:C.trim()});v(t=>[...t,e]),null===n||void 0===n||n(e.id,e),M(""),T(!1),x(!1)}catch(t){console.error(`[EquipmentSelector] Failed to create ${e}:`,t),alert(`Failed to create ${m.label}`)}},B=(t,n=!1)=>{const r=t.image_path?(0,i.FH)(t.image_path):null;return(0,l.jsxs)("div",{className:"equip-item "+(n?"equip-item-dropdown":"equip-item-selected"),children:[r?(0,l.jsx)("img",{src:r,alt:t.name,className:"equip-thumb"}):(0,l.jsx)("span",{className:"equip-icon",children:m.icon}),(0,l.jsxs)("div",{className:"equip-info",children:[(0,l.jsx)("span",{className:"equip-name",children:t.name}),t.brand&&(0,l.jsx)("span",{className:"equip-brand",children:t.brand}),"lens"===e&&t.focal_length_min&&(0,l.jsxs)("span",{className:"equip-spec",children:[t.focal_length_min===t.focal_length_max?`${t.focal_length_min}mm`:`${t.focal_length_min}-${t.focal_length_max}mm`,t.max_aperture&&` f/${t.max_aperture}`]}),"camera"===e&&t.mount&&(0,l.jsxs)("span",{className:"equip-spec",children:[t.mount," mount"]})]})]})};return"lens"===e&&E?(0,l.jsx)("div",{className:`equip-selector equip-selector-fixed ${p}`,style:f,children:(0,l.jsxs)("div",{className:"equip-fixed-lens",children:[(0,l.jsx)("span",{className:"equip-icon",children:"\ud83d\udd12"}),(0,l.jsxs)("span",{children:["Fixed Lens: ",E.focal_length,"mm f/",E.max_aperture]})]})}):(0,l.jsx)("div",{className:`equip-selector ${p}`,style:f,ref:O,children:(0,l.jsxs)(a.y,{isOpen:b,onOpenChange:e=>!d&&x(e),placement:"bottom",triggerScaleOnOpen:!1,offset:4,classNames:{content:"bg-transparent p-0 shadow-none border-none overflow-visible"},children:[(0,l.jsx)(o.T,{children:(0,l.jsxs)("div",{className:`equip-trigger ${b?"open":""} ${d?"disabled":""}`,role:"button",tabIndex:0,children:[A?(0,l.jsx)("span",{className:"equip-loading",children:"Loading..."}):j?(0,l.jsxs)(l.Fragment,{children:[B(j),(0,l.jsx)("button",{className:"equip-clear",onClick:e=>{e.stopPropagation(),null===n||void 0===n||n(null,null)},title:"Clear",children:"\xd7"})]}):(0,l.jsx)("span",{className:"equip-placeholder",children:m.placeholder}),(0,l.jsx)("span",{className:"equip-arrow",children:b?"\u25b2":"\u25bc"})]})}),(0,l.jsx)(s.C,{className:"w-[300px]",children:(0,l.jsxs)("div",{className:"equip-dropdown",style:{position:"relative",top:0,width:"100%",maxWidth:"100%",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,l.jsx)("input",{type:"text",className:"equip-search",placeholder:`Search ${m.label.toLowerCase()}...`,value:_,onChange:e=>w(e.target.value),autoFocus:!0}),"lens"===e&&u&&R&&(0,l.jsxs)("div",{className:"equip-adapter-toggle",children:[(0,l.jsxs)("label",{className:"equip-adapter-label",children:[(0,l.jsx)("input",{type:"checkbox",checked:N,onChange:e=>k(e.target.checked)}),(0,l.jsx)("span",{children:"Use Adapter (show all lenses)"})]}),(0,l.jsxs)("span",{className:"equip-mount-info",children:["Camera mount: ",R]})]}),(0,l.jsx)("div",{className:"equip-list",children:0===D.length?(0,l.jsx)("div",{className:"equip-empty",children:_?`No ${m.label.toLowerCase()} found`:`No ${m.label.toLowerCase()} in library`}):D.map(r=>(0,l.jsxs)("div",{className:`equip-option ${r.id===t?"selected":""} ${"lens"===e&&N&&r.mount&&r.mount!==R?"adapted":""}`,onClick:()=>(e=>{null===n||void 0===n||n(e.id,e),x(!1),w("")})(r),children:[B(r,!0),"lens"===e&&N&&r.mount&&r.mount!==R&&(0,l.jsx)("span",{className:"equip-adapter-badge",children:"Adapter"})]},r.id))}),h&&(0,l.jsx)("div",{className:"equip-add-section",children:S?(0,l.jsxs)("div",{className:"equip-add-form",children:[(0,l.jsx)("input",{type:"text",className:"equip-add-input",placeholder:`New ${m.label.toLowerCase()} name...`,value:C,onChange:e=>M(e.target.value),onKeyDown:e=>"Enter"===e.key&&I()}),(0,l.jsx)("button",{className:"equip-add-btn",onClick:I,children:"Add"}),(0,l.jsx)("button",{className:"equip-add-cancel",onClick:()=>T(!1),children:"\xd7"})]}):(0,l.jsxs)("button",{className:"equip-add-trigger",onClick:()=>T(!0),children:["+ Add New ",m.label]})})]})})]})})}},870:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObject=function(e){return null!==e&&("object"===typeof e||"function"===typeof e)}},935:function(e,t,n){"use strict";n.d(t,{E4:function(){return s},Hr:function(){return d},W9:function(){return u}});var r=n(2667),i=n(8689),a=n(708),o=n(7449);const s=e=>e===a.ai||e===o.px,l=new Set(["x","y","z"]),c=i.U.filter(e=>!l.has(e));function u(e){const t=[];return c.forEach(n=>{const r=e.getValue(n);void 0!==r&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),t}const d={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>(0,r.ry)(t,"x"),y:(e,{transform:t})=>(0,r.ry)(t,"y")};d.translateX=d.x,d.translateY=d.y},971:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});const r="data-"+(0,n(2093).I)("framerAppearId")},1051:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});const r=(0,n(5043).createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"})},1071:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC"},1153:function(e,t,n){"use strict";var r=n(5043),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:a,_owner:s.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},1203:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8420);t.isArrayLike=function(e){return null!=e&&"function"!==typeof e&&r.isLength(e.length)}},1248:function(e,t,n){"use strict";n.d(t,{x:function(){return o}});var r=n(8689),i=n(3964),a=n(7457);function o(e,t,n){const o=(0,a.x)(e,t,n);for(const a in e)if((0,i.S)(e[a])||(0,i.S)(t[a])){o[-1!==r.U.indexOf(a)?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a]=e[a]}return o}},1293:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4830);t.debounce=function(e,t=0,n={}){"object"!==typeof n&&(n={});const{leading:i=!1,trailing:a=!0,maxWait:o}=n,s=Array(2);let l;i&&(s[0]="leading"),a&&(s[1]="trailing");let c=null;const u=r.debounce(function(...t){l=e.apply(this,t),c=null},t,{edges:s}),d=function(...t){return null!=o&&(null===c&&(c=Date.now()),Date.now()-c>=o)?(l=e.apply(this,t),c=Date.now(),u.cancel(),u.schedule(),l):(u.apply(this,t),l)};return d.cancel=u.cancel,d.flush=()=>(u.flush(),l),d}},1321:function(e,t,n){"use strict";n.d(t,{T:function(){return y}});var r=n(7287),i=n(4906),a=n(3779),o=n(5043),s=n(8184),l=n(6838),c=n(9015),u=n(2700),d=n(9184),h=n(9161),p=n(5773);var f=n(6764),m=n(7157),g=n(2795),v=n(579),A=(0,g.Rf)((e,t)=>{const{Component:n,domRef:g,children:A,spinnerSize:y,spinner:b=(0,v.jsx)(f.o,{color:"current",size:y}),spinnerPlacement:x,startContent:_,endContent:w,isLoading:S,disableRipple:T,getButtonProps:C,getRippleProps:M,isIconOnly:E}=function(e){var t,n,f,m,g,v,A,y,b;const x=(0,r.C)(),_=(0,i.o)(),w=!!x,{ref:S,as:T,children:C,startContent:M,endContent:E,autoFocus:P,className:N,spinner:k,isLoading:R=!1,disableRipple:L=!1,fullWidth:O=null!=(t=null==x?void 0:x.fullWidth)&&t,radius:j=(null==x?void 0:x.radius),size:D=(null!=(n=null==x?void 0:x.size)?n:"md"),color:I=(null!=(f=null==x?void 0:x.color)?f:"default"),variant:B=(null!=(m=null==x?void 0:x.variant)?m:"solid"),disableAnimation:F=null!=(v=null!=(g=null==x?void 0:x.disableAnimation)?g:null==_?void 0:_.disableAnimation)&&v,isDisabled:z=null!=(A=null==x?void 0:x.isDisabled)&&A,isIconOnly:U=null!=(y=null==x?void 0:x.isIconOnly)&&y,spinnerPlacement:V="start",onPress:G,onClick:q,...W}=e,H=T||"button",$="string"===typeof H,K=(0,l.zD)(S),X=null!=(b=L||(null==_?void 0:_.disableRipple))?b:F,{isFocusVisible:Y,isFocused:Q,focusProps:Z}=(0,s.o)({autoFocus:P}),J=z||R,ee=(0,o.useMemo)(()=>(0,u.x6)({size:D,color:I,variant:B,radius:j,fullWidth:O,isDisabled:J,isInGroup:w,disableAnimation:F,isIconOnly:U,className:N}),[D,I,B,j,O,J,w,U,F,N]),{onPress:te,onClear:ne,ripples:re}=(0,p.k)(),ie=(0,o.useCallback)(e=>{X||J||F||K.current&&te(e)},[X,J,F,K,te]),{buttonProps:ae,isPressed:oe}=(0,d.l)({elementType:T,isDisabled:J,onPress:(0,a.cy)(G,ie),onClick:q,...W},K),{isHovered:se,hoverProps:le}=(0,h.M)({isDisabled:J}),ce=(0,o.useCallback)((e={})=>({"data-disabled":(0,a.sE)(J),"data-focus":(0,a.sE)(Q),"data-pressed":(0,a.sE)(oe),"data-focus-visible":(0,a.sE)(Y),"data-hover":(0,a.sE)(se),"data-loading":(0,a.sE)(R),...(0,a.v6)(ae,Z,le,(0,c.$)(W,{enabled:$}),(0,c.$)(e)),className:ee}),[R,J,Q,oe,$,Y,se,ae,Z,le,W,ee]),ue=e=>(0,o.isValidElement)(e)?(0,o.cloneElement)(e,{"aria-hidden":!0,focusable:!1}):null,de=ue(M),he=ue(E),pe=(0,o.useMemo)(()=>({sm:"sm",md:"sm",lg:"md"}[D]),[D]),fe=(0,o.useCallback)(()=>({ripples:re,onClear:ne}),[re,ne]);return{Component:H,children:C,domRef:K,spinner:k,styles:ee,startContent:de,endContent:he,isLoading:R,spinnerPlacement:V,spinnerSize:pe,disableRipple:X,getButtonProps:ce,getRippleProps:fe,isIconOnly:U}}({...e,ref:t});return(0,v.jsxs)(n,{ref:g,...C(),children:[_,S&&"start"===x&&b,S&&E?null:A,S&&"end"===x&&b,w,!T&&(0,v.jsx)(m.j,{...M()})]})});A.displayName="HeroUI.Button";var y=A},1389:function(e,t,n){"use strict";n.d(t,{Tw:function(){return d},Bi:function(){return u},X1:function(){return h}});var r=n(6650),i=n(5043);function a(e){let[t,n]=(0,i.useState)(e),a=(0,i.useRef)(t),o=(0,i.useRef)(null),s=(0,i.useRef)(()=>{if(!o.current)return;let e=o.current.next();e.done?o.current=null:a.current===e.value?s.current():n(e.value)});(0,r.N)(()=>{a.current=t,o.current&&s.current()});let l=(0,i.useCallback)(e=>{o.current=e(a.current),s.current()},[s]);return[t,l]}var o=n(60);let s,l=Boolean("undefined"!==typeof window&&window.document&&window.document.createElement),c=new Map;function u(e){let[t,n]=(0,i.useState)(e),a=(0,i.useRef)(null),u=(0,o.Cc)(t),d=(0,i.useRef)(null);if(s&&s.register(d,u),l){const e=c.get(u);e&&!e.includes(a)?e.push(a):c.set(u,[a])}return(0,r.N)(()=>{let e=u;return()=>{s&&s.unregister(d),c.delete(e)}},[u]),(0,i.useEffect)(()=>{let e=a.current;return e&&n(e),()=>{e&&(a.current=null)}}),u}function d(e,t){if(e===t)return e;let n=c.get(e);if(n)return n.forEach(e=>e.current=t),t;let r=c.get(t);return r?(r.forEach(t=>t.current=e),e):t}function h(e=[]){let t=u(),[n,o]=a(t),s=(0,i.useCallback)(()=>{o(function*(){yield t,yield document.getElementById(t)?t:void 0})},[t,o]);return(0,r.N)(s,[t,s,...e]),n}"undefined"!==typeof FinalizationRegistry&&(s=new FinalizationRegistry(e=>{c.delete(e)}))},1391:function(e,t,n){"use strict";n.d(t,{n:function(){return R}});var r=n(8412),i=n(106);function a(e,t){const n=function(e,t,n){if(e instanceof EventTarget)return[e];if("string"===typeof e){let r=document;t&&(r=t.current);const i=n?.[e]??r.querySelectorAll(e);return i?Array.from(i):[]}return Array.from(e)}(e),r=new AbortController;return[n,{passive:!0,...t,signal:r.signal},()=>r.abort()]}function o(e){return!("touch"===e.pointerType||(0,i.D)())}var s=n(8945),l=n(3965);function c(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===n);const a=i["onHover"+n];a&&r.Gt.postRender(()=>a(t,(0,s.e)(t)))}class u extends l.X{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,n={}){const[r,i,s]=a(e,n),l=e=>{if(!o(e))return;const{target:n}=e,r=t(n,e);if("function"!==typeof r||!n)return;const a=e=>{o(e)&&(r(e),n.removeEventListener("pointerleave",a))};n.addEventListener("pointerleave",a,i)};return r.forEach(e=>{e.addEventListener("pointerenter",l,i)}),s}(e,(e,t)=>(c(this.node,t,"Start"),e=>c(this.node,e,"End"))))}unmount(){}}var d=n(8560),h=n(3861);class p extends l.X{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=(0,d.F)((0,h.k)(this.node.current,"focus",()=>this.onFocus()),(0,h.k)(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}var f=n(8676);const m=(e,t)=>!!t&&(e===t||m(e,t.parentElement));var g=n(7475);const v=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const A=new WeakSet;function y(e){return t=>{"Enter"===t.key&&e(t)}}function b(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function x(e){return(0,g.M)(e)&&!(0,i.D)()}function _(e,t,n={}){const[r,i,o]=a(e,n),s=e=>{const r=e.currentTarget;if(!x(e))return;A.add(r);const a=t(r,e),o=(e,t)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",l),A.has(r)&&A.delete(r),x(e)&&"function"===typeof a&&a(e,{success:t})},s=e=>{o(e,r===window||r===document||n.useGlobalTarget||m(r,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",s,i),window.addEventListener("pointercancel",l,i)};return r.forEach(e=>{var t;(n.useGlobalTarget?window:e).addEventListener("pointerdown",s,i),(0,f.s)(e)&&(e.addEventListener("focus",e=>((e,t)=>{const n=e.currentTarget;if(!n)return;const r=y(()=>{if(A.has(n))return;b(n,"down");const e=y(()=>{b(n,"up")});n.addEventListener("keyup",e,t),n.addEventListener("blur",()=>b(n,"cancel"),t)});n.addEventListener("keydown",r,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),t)})(e,i)),t=e,v.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),o}function w(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===n);const a=i["onTap"+("End"===n?"":n)];a&&r.Gt.postRender(()=>a(t,(0,s.e)(t)))}class S extends l.X{mount(){const{current:e}=this.node;e&&(this.unmount=_(e,(e,t)=>(w(this.node,t,"Start"),(e,{success:t})=>w(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const T=new WeakMap,C=new WeakMap,M=e=>{const t=T.get(e.target);t&&t(e)},E=e=>{e.forEach(M)};function P(e,t,n){const r=function({root:e,...t}){const n=e||document;C.has(n)||C.set(n,{});const r=C.get(n),i=JSON.stringify(t);return r[i]||(r[i]=new IntersectionObserver(E,{root:e,...t})),r[i]}(t);return T.set(e,n),r.observe(e),()=>{T.delete(e),r.unobserve(e)}}const N={some:0,all:1};class k extends l.X{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:i}=e,a={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof r?r:N[r]};return P(this.node.current,a,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,i&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:r}=this.node.getProps(),a=t?n:r;a&&a(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}(e,t))&&this.startObserver()}unmount(){}}const R={inView:{Feature:k},tap:{Feature:S},focus:{Feature:p},hover:{Feature:u}}},1422:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var r=n(2896);const i=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];var a=n(7151);const o=40;function s(e,t){let n=!1,s=!0;const l={delta:0,timestamp:0,isProcessing:!1},c=()=>n=!0,u=i.reduce((e,n)=>(e[n]=function(e,t){let n=new Set,r=new Set,i=!1,o=!1;const s=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1},c=0;function u(t){s.has(t)&&(d.schedule(t),e()),c++,t(l)}const d={schedule:(e,t=!1,a=!1)=>{const o=a&&i?n:r;return t&&s.add(e),o.has(e)||o.add(e),e},cancel:e=>{r.delete(e),s.delete(e)},process:e=>{l=e,i?o=!0:(i=!0,[n,r]=[r,n],n.forEach(u),t&&a.Q.value&&a.Q.value.frameloop[t].push(c),c=0,n.clear(),i=!1,o&&(o=!1,d.process(e)))}};return d}(c,t?n:void 0),e),{}),{setup:d,read:h,resolveKeyframes:p,preUpdate:f,update:m,preRender:g,render:v,postRender:A}=u,y=()=>{const i=r.W.useManualTiming?l.timestamp:performance.now();n=!1,r.W.useManualTiming||(l.delta=s?1e3/60:Math.max(Math.min(i-l.timestamp,o),1)),l.timestamp=i,l.isProcessing=!0,d.process(l),h.process(l),p.process(l),f.process(l),m.process(l),g.process(l),v.process(l),A.process(l),l.isProcessing=!1,n&&t&&(s=!1,e(y))};return{schedule:i.reduce((t,r)=>{const i=u[r];return t[r]=(t,r=!1,a=!1)=>(n||(n=!0,s=!0,l.isProcessing||e(y)),i.schedule(t,r,a)),t},{}),cancel:e=>{for(let t=0;t<i.length;t++)u[i[t]].cancel(e)},state:l,steps:u}}},1444:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(418),i=n(3272);t.toPath=function(e){if(Array.isArray(e))return e.map(i.toKey);if("symbol"===typeof e)return[e];const t=[],n=(e=r.toString(e)).length;if(0===n)return t;let a=0,o="",s="",l=!1;for(46===e.charCodeAt(0)&&(t.push(""),a++);a<n;){const r=e[a];s?"\\"===r&&a+1<n?(a++,o+=e[a]):r===s?s="":o+=r:l?'"'===r||"'"===r?s=r:"]"===r?(l=!1,t.push(o),o=""):o+=r:"["===r?(l=!0,o&&(t.push(o),o="")):"."===r?o&&(t.push(o),o=""):o+=r,a++}return o&&t.push(o),t}},1468:function(e,t,n){"use strict";n.d(t,{J:function(){return s}});var r,i=n(6650),a=n(5043);const o=null!==(r=a.useInsertionEffect)&&void 0!==r?r:i.N;function s(e){const t=(0,a.useRef)(null);return o(()=>{t.current=e},[e]),(0,a.useCallback)((...e)=>{const n=t.current;return null===n||void 0===n?void 0:n(...e)},[])}},1497:function(e,t,n){"use strict";var r=n(3218);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},1595:function(e,t,n){"use strict";n.d(t,{hJ:function(){return h},Se:function(){return p}});var r=n(5481),i=n(1673),a=n(5043);function o({children:e}){let t=(0,a.useMemo)(()=>({register:()=>{}}),[]);return a.createElement(i.F.Provider,{value:t},e)}var s=n(7508),l=n(7950),c=n(60),u=n(6650);const d=a.createContext(null);function h(e){let t=(0,c.wR)(),{portalContainer:n=(t?null:document.body),isExiting:i}=e,[u,h]=(0,a.useState)(!1),p=(0,a.useMemo)(()=>({contain:u,setContain:h}),[u,h]),{getContainer:f}=(0,r.gX)();if(!e.portalContainer&&f&&(n=f()),!n)return null;let m=e.children;return e.disableFocusManagement||(m=a.createElement(s.n1,{restoreFocus:!0,contain:(e.shouldContainFocus||u)&&!i},m)),m=a.createElement(d.Provider,{value:p},a.createElement(o,null,m)),l.createPortal(m,n)}function p(){let e=(0,a.useContext)(d),t=null===e||void 0===e?void 0:e.setContain;(0,u.N)(()=>{null===t||void 0===t||t(!0)},[t])}},1628:function(e){e.exports={LUT3D_GLSL:'\n// ============================================================================\n// 3D LUT Sampling (Packed 2D Texture)\n// ============================================================================\n\n// Sample a 3D LUT that has been packed into a 2D texture\n// \n// Packing format:\n// - Width: LUT size (e.g., 33 for a 33x33x33 LUT)\n// - Height: size * size\n// - Each row contains one "slice" of the blue channel\n//\n// Trilinear interpolation for smooth color transitions\n//\nvec3 sampleLUT3D(vec3 c) {\n  float sz = u_lutSize;\n  \n  // Map input to [0, size-1] range\n  float rf = c.r * (sz - 1.0);\n  float gf = c.g * (sz - 1.0);\n  float bf = c.b * (sz - 1.0);\n  \n  // Floor values for grid positions\n  float r0 = floor(rf);\n  float g0 = floor(gf);\n  float b0 = floor(bf);\n  float r1 = min(sz - 1.0, r0 + 1.0);\n  float g1 = min(sz - 1.0, g0 + 1.0);\n  float b1 = min(sz - 1.0, b0 + 1.0);\n  \n  // Fractional parts for interpolation\n  float fr = rf - r0;\n  float fg = gf - g0;\n  float fb = bf - b0;\n  \n  // Sample 8 corners of the cube\n  vec3 c000, c100, c010, c110, c001, c101, c011, c111;\n  vec2 uv;\n  \n  // Helper: UV for packed LUT\n  // x = (r + 0.5) / size\n  // y = (g + b * size + 0.5) / (size * size)\n  \n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g0 + b0 * sz + 0.5) / (sz * sz);\n  c000 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g0 + b0 * sz + 0.5) / (sz * sz);\n  c100 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g1 + b0 * sz + 0.5) / (sz * sz);\n  c010 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g1 + b0 * sz + 0.5) / (sz * sz);\n  c110 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g0 + b1 * sz + 0.5) / (sz * sz);\n  c001 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g0 + b1 * sz + 0.5) / (sz * sz);\n  c101 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g1 + b1 * sz + 0.5) / (sz * sz);\n  c011 = texture2D(u_lut3d, uv).rgb;\n  \n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g1 + b1 * sz + 0.5) / (sz * sz);\n  c111 = texture2D(u_lut3d, uv).rgb;\n  \n  // Trilinear interpolation\n  vec3 c00 = mix(c000, c100, fr);\n  vec3 c10 = mix(c010, c110, fr);\n  vec3 c01 = mix(c001, c101, fr);\n  vec3 c11 = mix(c011, c111, fr);\n  \n  vec3 c0 = mix(c00, c10, fg);\n  vec3 c1 = mix(c01, c11, fg);\n  \n  return mix(c0, c1, fb);\n}\n'}},1673:function(e,t,n){"use strict";n.d(t,{F:function(){return r}});const r=n(5043).createContext({register:()=>{}});r.displayName="PressResponderContext"},1697:function(e,t,n){"use strict";function r(e,t){if(!e)return!1;let n=window.getComputedStyle(e),r=/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY);return r&&t&&(r=e.scrollHeight!==e.clientHeight||e.scrollWidth!==e.clientWidth),r}n.d(t,{o:function(){return r}})},1709:function(e,t,n){"use strict";n.d(t,{B:function(){return i},o:function(){return o}});var r=n(9427);function i(e){return(0,r.cX)()?e.metaKey:e.ctrlKey}const a=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function o(e){return e instanceof HTMLInputElement&&!a.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}},1809:function(e,t,n){"use strict";n.d(t,{R:function(){return l}});var r={};r={"ar-AE":{dismiss:"\u062a\u062c\u0627\u0647\u0644"},"bg-BG":{dismiss:"\u041e\u0442\u0445\u0432\u044a\u0440\u043b\u044f\u043d\u0435"},"cs-CZ":{dismiss:"Odstranit"},"da-DK":{dismiss:"Luk"},"de-DE":{dismiss:"Schlie\xdfen"},"el-GR":{dismiss:"\u0391\u03c0\u03cc\u03c1\u03c1\u03b9\u03c8\u03b7"},"en-US":{dismiss:"Dismiss"},"es-ES":{dismiss:"Descartar"},"et-EE":{dismiss:"L\xf5peta"},"fi-FI":{dismiss:"Hylk\xe4\xe4"},"fr-FR":{dismiss:"Rejeter"},"he-IL":{dismiss:"\u05d4\u05ea\u05e2\u05dc\u05dd"},"hr-HR":{dismiss:"Odbaci"},"hu-HU":{dismiss:"Elutas\xedt\xe1s"},"it-IT":{dismiss:"Ignora"},"ja-JP":{dismiss:"\u9589\u3058\u308b"},"ko-KR":{dismiss:"\ubb34\uc2dc"},"lt-LT":{dismiss:"Atmesti"},"lv-LV":{dismiss:"Ner\u0101d\u012bt"},"nb-NO":{dismiss:"Lukk"},"nl-NL":{dismiss:"Negeren"},"pl-PL":{dismiss:"Zignoruj"},"pt-BR":{dismiss:"Descartar"},"pt-PT":{dismiss:"Dispensar"},"ro-RO":{dismiss:"Revocare"},"ru-RU":{dismiss:"\u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c"},"sk-SK":{dismiss:"Zru\u0161i\u0165"},"sl-SI":{dismiss:"Opusti"},"sr-SP":{dismiss:"Odbaci"},"sv-SE":{dismiss:"Avvisa"},"tr-TR":{dismiss:"Kapat"},"uk-UA":{dismiss:"\u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438"},"zh-CN":{dismiss:"\u53d6\u6d88"},"zh-TW":{dismiss:"\u95dc\u9589"}};var i=n(5043),a=n(4962),o=n(5529),s=n(3194);function l(e){let{onDismiss:t,...n}=e,l=(0,o.o)((c=r)&&c.__esModule?c.default:c,"@react-aria/overlays");var c;let u=(0,a.b)(n,l.format("dismiss"));return i.createElement(s.s,null,i.createElement("button",{...u,tabIndex:-1,onClick:()=>{t&&t()},style:{width:1,height:1}}))}},1827:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});const r=e=>t=>1-e(1-t)},1848:function(e,t,n){"use strict";n(5043);var r=n(7950),i=n(579);t.A=({isOpen:e,type:t="alert",title:n,message:a,onConfirm:o,onCancel:s,confirmText:l="OK",cancelText:c="Cancel"})=>{if(!e)return null;const u=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme");return r.createPortal((0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:u?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:11e3},children:(0,i.jsxs)("div",{style:{backgroundColor:u?"#18181b":"#ffffff",border:u?"1px solid #27272a":"1px solid #e4e4e7",borderRadius:8,padding:24,minWidth:300,maxWidth:400,boxShadow:u?"0 4px 12px rgba(0,0,0,0.5)":"0 4px 12px rgba(0,0,0,0.15)",color:u?"#ECEDEE":"#11181C"},children:[n&&(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:12,fontSize:18,color:u?"#ECEDEE":"#11181C"},children:n}),(0,i.jsx)("div",{style:{marginBottom:24,fontSize:14,lineHeight:1.5,color:u?"#a1a1aa":"#71717a"},children:a}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:12},children:["confirm"===t&&(0,i.jsx)("button",{onClick:s,style:{background:"transparent",border:u?"1px solid #3f3f46":"1px solid #e4e4e7",color:u?"#a1a1aa":"#71717a",padding:"6px 16px",borderRadius:4,cursor:"pointer"},children:c}),(0,i.jsx)("button",{onClick:o,style:{background:"#007acc",border:"none",color:"#fff",padding:"6px 16px",borderRadius:4,cursor:"pointer",fontWeight:500},children:l})]})]})}),document.body)}},1853:function(e,t,n){"use strict";n.d(t,{k:function(){return r}});const r=(e,t,n)=>e+(t-e)*n},1972:function(){},1997:function(){},2001:function(e,t,n){"use strict";n.d(t,{j:function(){return i},p:function(){return o}});const r=e=>t=>"string"===typeof t&&t.startsWith(e),i=r("--"),a=r("var(--"),o=e=>!!a(e)&&s.test(e.split("/*")[0].trim()),s=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu},2086:function(e,t,n){"use strict";e.exports=n(5082)},2093:function(e,t,n){"use strict";n.d(t,{I:function(){return r}});const r=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase()},2104:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(1203),i=n(9921);t.isArrayLikeObject=function(e){return i.isObjectLike(e)&&r.isArrayLike(e)}},2116:function(e,t,n){"use strict";n.d(t,{Q:function(){return i}});const r=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function i(e){return"string"===typeof e&&!e.includes("-")&&!!(r.indexOf(e)>-1||/[A-Z]/u.test(e))}},2132:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(870),i=n(4803),a=n(9972);function o(e,t,n,c){if(t===e)return!0;switch(typeof t){case"object":return function(e,t,n,r){if(null==t)return!0;if(Array.isArray(t))return s(e,t,n,r);if(t instanceof Map)return function(e,t,n,r){if(0===t.size)return!0;if(!(e instanceof Map))return!1;for(const[i,a]of t.entries()){if(!1===n(e.get(i),a,i,e,t,r))return!1}return!0}(e,t,n,r);if(t instanceof Set)return l(e,t,n,r);const a=Object.keys(t);if(null==e)return 0===a.length;if(0===a.length)return!0;if(r?.has(t))return r.get(t)===e;r?.set(t,e);try{for(let o=0;o<a.length;o++){const s=a[o];if(!i.isPrimitive(e)&&!(s in e))return!1;if(void 0===t[s]&&void 0!==e[s])return!1;if(null===t[s]&&null!==e[s])return!1;if(!n(e[s],t[s],s,e,t,r))return!1}return!0}finally{r?.delete(t)}}(e,t,n,c);case"function":return Object.keys(t).length>0?o(e,{...t},n,c):a.eq(e,t);default:return r.isObject(e)?"string"!==typeof t||""===t:a.eq(e,t)}}function s(e,t,n,r){if(0===t.length)return!0;if(!Array.isArray(e))return!1;const i=new Set;for(let a=0;a<t.length;a++){const o=t[a];let s=!1;for(let l=0;l<e.length;l++){if(i.has(l))continue;let c=!1;if(n(e[l],o,a,e,t,r)&&(c=!0),c){i.add(l),s=!0;break}}if(!s)return!1}return!0}function l(e,t,n,r){return 0===t.size||e instanceof Set&&s([...e],[...t],n,r)}t.isMatchWith=function e(t,n,r){return"function"!==typeof r?e(t,n,()=>{}):o(t,n,function e(t,n,i,a,s,l){const c=r(t,n,i,a,s,l);return void 0!==c?Boolean(c):o(t,n,e,l)},new Map)},t.isSetMatch=l},2190:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});const r=(0,n(5043).createContext)({})},2196:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var r=n(5033),i=n(1389),a=n(8387);function o(...e){let t={...e[0]};for(let n=1;n<e.length;n++){let o=e[n];for(let e in o){let n=t[e],s=o[e];"function"===typeof n&&"function"===typeof s&&"o"===e[0]&&"n"===e[1]&&e.charCodeAt(2)>=65&&e.charCodeAt(2)<=90?t[e]=(0,r.c)(n,s):"className"!==e&&"UNSAFE_className"!==e||"string"!==typeof n||"string"!==typeof s?"id"===e&&n&&s?t.id=(0,i.Tw)(n,s):t[e]=void 0!==s?s:n:t[e]=(0,a.A)(n,s)}}return t}},2204:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(5316),i=n(7312),a=n(3799);t.sortBy=function(e,...t){const n=t.length;return n>1&&a.isIterateeCall(e,t[0],t[1])?t=[]:n>2&&a.isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),r.orderBy(e,i.flatten(t),["asc"])}},2220:function(e,t,n){"use strict";n.d(t,{J:function(){return ce}});var r=n(5043),i=n(8689),a=n(2667),o=n(2001),s=n(6358),l=n(462);var c=n(708),u=n(7449);const d=e=>t=>t.test(e),h=[c.ai,u.px,u.KN,u.uj,u.vw,u.vh,{test:e=>"auto"===e,parse:e=>e}],p=e=>h.find(d(e));var f=n(9565);const m=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),g=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function v(e,t,n=1){(0,f.V)(n<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`,"max-css-var-depth");const[r,i]=function(e){const t=g.exec(e);if(!t)return[,];const[,n,r,i]=t;return[`--${n??r}`,i]}(e);if(!r)return;const a=window.getComputedStyle(t).getPropertyValue(r);if(a){const e=a.trim();return m(e)?parseFloat(e):e}return(0,o.p)(i)?v(i,t,n+1):i}var A=n(5583);const y=e=>/^0[^.\s]+$/u.test(e);function b(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||y(e))}var x=n(2326),_=n(8085);const w=new Set(["brightness","contrast","saturate","opacity"]);function S(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[r]=n.match(_.S)||[];if(!r)return e;const i=n.replace(r,"");let a=w.has(t)?1:0;return r!==n&&(a*=100),t+"("+a+i+")"}const T=/\b([a-z-]*)\(.*?\)/gu,C={...x.f,getAnimatableNone:e=>{const t=e.match(T);return t?t.map(S).join(" "):e}};var M=n(6087);const E={...n(381).W,color:M.y,backgroundColor:M.y,outlineColor:M.y,fill:M.y,stroke:M.y,borderColor:M.y,borderTopColor:M.y,borderRightColor:M.y,borderBottomColor:M.y,borderLeftColor:M.y,filter:C,WebkitFilter:C},P=e=>E[e];function N(e,t){let n=P(e);return n!==C&&(n=x.f),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const k=new Set(["auto","none","0"]);var R=n(935);class L extends A.h{constructor(e,t,n,r,i){super(e,t,n,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let n=e[l];if("string"===typeof n&&(n=n.trim(),(0,o.p)(n))){const r=v(n,t.current);void 0!==r&&(e[l]=r),l===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!l.$.has(n)||2!==e.length)return;const[r,i]=e,a=p(r),s=p(i);if(a!==s)if((0,R.E4)(a)&&(0,R.E4)(s))for(let o=0;o<e.length;o++){const t=e[o];"string"===typeof t&&(e[o]=parseFloat(t))}else R.Hr[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)(null===e[r]||b(e[r]))&&n.push(r);n.length&&function(e,t,n){let r,i=0;for(;i<e.length&&!r;){const t=e[i];"string"===typeof t&&!k.has(t)&&(0,x.V)(t).values.length&&(r=e[i]),i++}if(r&&n)for(const a of t)e[a]=N(n,r)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=R.Hr[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];void 0!==r&&e.getValue(n,r).jump(r,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const i=n.length-1,a=n[i];n[i]=R.Hr[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==a&&void 0===this.finalKeyframe&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([t,n])=>{e.getValue(t).set(n)}),this.resolveNoneKeyframes()}}var O=n(3964),j=n(7178),D=n(8412),I=n(7189);const B=[...h,M.y,x.f];var F=n(2408),z=n(6317),U=n(9601),V=n(8093),G=n(4735);const q={current:null},W={current:!1};const H=new WeakMap;var $=n(9426);var K=n(5859);const X=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Y{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:i,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=A.h,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=j.k.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,D.Gt.render(this.render,!1,!0))};const{latestValues:s,renderState:l}=a;this.latestValues=s,this.baseTarget={...s},this.initialValues=t.initial?{...s}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=(0,$.e)(t),this.isVariantNode=(0,$.O)(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(t,{},this);for(const d in u){const e=u[d];void 0!==s[d]&&(0,O.S)(e)&&e.set(s[d])}}mount(e){this.current=e,H.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),W.current||function(){if(W.current=!0,G.B)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>q.current=e.matches;e.addEventListener("change",t),t()}else q.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||q.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),(0,D.WG)(this.notifyUpdate),(0,D.WG)(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=i.f.has(e);n&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&D.Gt.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in U.B){const t=U.B[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):(0,V.ge)()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<X.length;n++){const t=X[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const r=e["on"+t];r&&(this.propEventSubscriptions[t]=this.on(t,r))}this.prevMotionValues=function(e,t,n){for(const r in t){const i=t[r],a=n[r];if((0,O.S)(i))e.addValue(r,i);else if((0,O.S)(a))e.addValue(r,(0,I.OQ)(i,{owner:e}));else if(a!==i)if(e.hasValue(r)){const t=e.getValue(r);!0===t.liveStyle?t.jump(i):t.hasAnimated||t.set(i)}else{const t=e.getStaticValue(r);e.addValue(r,(0,I.OQ)(void 0!==t?t:i,{owner:e}))}}for(const r in n)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=(0,I.OQ)(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return void 0!==n&&null!==n&&("string"===typeof n&&(m(n)||y(n))?n=parseFloat(n):(r=n,!B.find(d(r))&&x.f.test(t)&&(n=N(e,t))),this.setBaseTarget(e,(0,O.S)(n)?n.get():n)),(0,O.S)(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let n;if("string"===typeof t||"object"===typeof t){const r=(0,K.a)(this.props,t,this.presenceContext?.custom);r&&(n=r[e])}if(t&&void 0!==n)return n;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||(0,O.S)(r)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new z.v),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){F.k.render(this.render)}}class Q extends Y{constructor(){super(...arguments),this.KeyframeResolver=L}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;(0,O.S)(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}var Z=n(6189);function J(e,{style:t,vars:n},r,i){const a=e.style;let o;for(o in t)a[o]=t[o];for(o in i?.applyProjectionStyles(a,r),n)a.setProperty(o,n[o])}var ee=n(7457);class te extends Q{constructor(){super(...arguments),this.type="html",this.renderInstance=J}readValueFromInstance(e,t){if(i.f.has(t))return this.projection?.isProjecting?(0,a.zs)(t):(0,a.Ib)(e,t);{const r=(n=e,window.getComputedStyle(n)),i=((0,o.j)(t)?r.getPropertyValue(t):r[t])||0;return"string"===typeof i?i.trim():i}var n}measureInstanceViewportBox(e,{transformPagePoint:t}){return(0,s.m)(e,t)}build(e,t,n){(0,Z.O)(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return(0,ee.x)(e,t,n)}}var ne=n(2093),re=n(9954);const ie=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);var ae=n(9420);var oe=n(1248);class se extends Q{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=V.ge}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(i.f.has(t)){const e=P(t);return e&&e.default||0}return t=ie.has(t)?t:(0,ne.I)(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return(0,oe.x)(e,t,n)}build(e,t,n){(0,re.B)(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,r){!function(e,t,n,r){J(e,t,void 0,r);for(const i in t.attrs)e.setAttribute(ie.has(i)?i:(0,ne.I)(i),t.attrs[i])}(e,t,0,r)}mount(e){this.isSVGTag=(0,ae.n)(e.tagName),super.mount(e)}}var le=n(2116);const ce=(e,t)=>(0,le.Q)(e)?new se(t):new te(t,{allowProjection:e!==r.Fragment})},2326:function(e,t,n){"use strict";n.d(t,{V:function(){return p},f:function(){return v}});var r=n(6087);const i=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;var a=n(8085),o=n(5330);const s="number",l="color",c="var",u="var(",d="${}",h=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function p(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},a=[];let o=0;const p=t.replace(h,e=>(r.y.test(e)?(i.color.push(o),a.push(l),n.push(r.y.parse(e))):e.startsWith(u)?(i.var.push(o),a.push(c),n.push(e)):(i.number.push(o),a.push(s),n.push(parseFloat(e))),++o,d)).split(d);return{values:n,split:p,indexes:i,types:a}}function f(e){return p(e).values}function m(e){const{split:t,types:n}=p(e),i=t.length;return e=>{let a="";for(let c=0;c<i;c++)if(a+=t[c],void 0!==e[c]){const t=n[c];a+=t===s?(0,o.a)(e[c]):t===l?r.y.transform(e[c]):e[c]}return a}}const g=e=>"number"===typeof e?0:r.y.test(e)?r.y.getAnimatableNone(e):e;const v={test:function(e){return isNaN(e)&&"string"===typeof e&&(e.match(a.S)?.length||0)+(e.match(i)?.length||0)>0},parse:f,createTransformer:m,getAnimatableNone:function(e){const t=f(e);return m(e)(t.map(g))}}},2330:function(e,t,n){"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},a=r.useState,o=r.useEffect,s=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(r){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),i=r[0].inst,u=r[1];return s(function(){i.value=n,i.getSnapshot=t,c(i)&&u({inst:i})},[e,n,t]),o(function(){return c(i)&&u({inst:i}),e(function(){c(i)&&u({inst:i})})},[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},2349:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});const r=(e,t,n)=>{const r=t-e;return 0===r?1:(n-e)/r}},2351:function(e){const t={ORIGINAL:"original",NEGATIVE:"negative",POSITIVE:"positive"},n={[t.ORIGINAL]:"original_rel_path",[t.NEGATIVE]:"negative_rel_path",[t.POSITIVE]:"positive_rel_path"};e.exports={SOURCE_TYPE:t,SOURCE_PATH_FIELDS:n,getStrictSourcePath:function(e,n,r={}){const{allowFallbackWithinType:i=!0,allowCrossTypeFallback:a=!1}=r;if(!e)return{path:null,actualType:null,matched:!1,warning:"Photo object is null or undefined"};switch((n||"").toLowerCase()){case t.POSITIVE:if(e.positive_rel_path)return{path:e.positive_rel_path,actualType:t.POSITIVE,matched:!0,warning:null};if(a){const n=e.full_rel_path||e.negative_rel_path||e.original_rel_path;if(n){const r=e.full_rel_path?"full":e.negative_rel_path?t.NEGATIVE:t.ORIGINAL;return{path:n,actualType:r,matched:!1,warning:`Positive file not found, falling back to ${r} (DANGEROUS)`}}}return{path:null,actualType:null,matched:!1,warning:"No positive file available for positive mode"};case t.NEGATIVE:return e.negative_rel_path?{path:e.negative_rel_path,actualType:t.NEGATIVE,matched:!0,warning:null}:i&&e.original_rel_path?{path:e.original_rel_path,actualType:t.ORIGINAL,matched:!0,warning:"Using original file as negative source"}:i&&e.full_rel_path?{path:e.full_rel_path,actualType:"full",matched:!0,warning:"Using full_rel_path as negative source (legacy)"}:{path:null,actualType:null,matched:!1,warning:"No negative/original file available"};default:return e.original_rel_path?{path:e.original_rel_path,actualType:t.ORIGINAL,matched:!0,warning:null}:i&&e.negative_rel_path?{path:e.negative_rel_path,actualType:t.NEGATIVE,matched:!0,warning:"Using negative file as original source"}:i&&e.full_rel_path?{path:e.full_rel_path,actualType:"full",matched:!0,warning:"Using full_rel_path as source (legacy)"}:{path:null,actualType:null,matched:!1,warning:"No source file available"}}},getEffectiveInverted:function(e,n){return e!==t.POSITIVE&&Boolean(n)},validateSourceMatch:function(e,n,r){if(!n)return{valid:!1,message:"No file loaded"};const i=(e||"").toLowerCase();return i===t.POSITIVE?n===r.positive_rel_path?{valid:!0,message:"Positive file correctly loaded"}:{valid:!1,message:"MISMATCH: sourceType=positive but loaded file is not positive_rel_path"}:i===t.NEGATIVE?n===r.negative_rel_path||n===r.original_rel_path?{valid:!0,message:"Negative/Original file correctly loaded"}:n===r.full_rel_path?{valid:!0,message:"Legacy full_rel_path used as negative"}:{valid:!1,message:"Unexpected file for negative mode"}:{valid:!0,message:"Original mode - any source acceptable"}},canUseSourceType:function(e,n){if(!e)return!1;switch((n||"").toLowerCase()){case t.POSITIVE:return Boolean(e.positive_rel_path);case t.NEGATIVE:return Boolean(e.negative_rel_path||e.original_rel_path||e.full_rel_path);default:return Boolean(e.original_rel_path||e.negative_rel_path||e.full_rel_path)}},getAvailableSourceTypes:function(e){const n=[];return e?(e.positive_rel_path&&n.push(t.POSITIVE),(e.negative_rel_path||e.original_rel_path||e.full_rel_path)&&(n.push(t.NEGATIVE),n.push(t.ORIGINAL)),n):n}}},2408:function(e,t,n){"use strict";n.d(t,{k:function(){return i}});var r=n(1422);const{schedule:i,cancel:a}=(0,r.I)(queueMicrotask,!1)},2417:function(e,t,n){"use strict";n.d(t,{A:function(){return i}});var r=n(5043);function i(){let e=(0,r.useRef)(new Map),t=(0,r.useCallback)((t,n,r,i)=>{let a=(null===i||void 0===i?void 0:i.once)?(...t)=>{e.current.delete(r),r(...t)}:r;e.current.set(r,{type:n,eventTarget:t,fn:a,options:i}),t.addEventListener(n,a,i)},[]),n=(0,r.useCallback)((t,n,r,i)=>{var a;let o=(null===(a=e.current.get(r))||void 0===a?void 0:a.fn)||r;t.removeEventListener(n,o,i),e.current.delete(r)},[]),i=(0,r.useCallback)(()=>{e.current.forEach((e,t)=>{n(e.eventTarget,e.type,t,e.options)})},[n]);return(0,r.useEffect)(()=>i,[i]),{addGlobalListener:t,removeGlobalListener:n,removeAllGlobalListeners:i}}},2420:function(e,t,n){"use strict";n.d(t,{z:function(){return a}});var r=n(8689),i=n(4886);function a(e,{layout:t,layoutId:n}){return r.f.has(e)||e.startsWith("origin")||(t||void 0!==n)&&(!!i.H[e]||"opacity"===e)}},2425:function(e,t,n){"use strict";n.d(t,{f:function(){return _}});var r=n(6280),i=new WeakMap,a=[];var o=n(3735),s=n(5043),l=n(3779),c=n(76),u=n(6452);function d(e,t){const{groupRef:n,triggerRef:d,popoverRef:h,showArrow:p,offset:f=7,crossOffset:m=0,scrollRef:g,shouldFlip:v,boundaryElement:A,isDismissable:y=!0,shouldCloseOnBlur:b=!0,shouldCloseOnScroll:x=!0,placement:_="top",containerPadding:w,shouldCloseOnInteractOutside:S,isNonModal:T,isKeyboardDismissDisabled:C,updatePositionDeps:M=[],...E}=e,P=null==T||T,N="SubmenuTrigger"===E.trigger,{overlayProps:k,underlayProps:R}=(0,u.P)({isOpen:t.isOpen,onClose:t.close,shouldCloseOnBlur:b,isDismissable:y||N,isKeyboardDismissDisabled:C,shouldCloseOnInteractOutside:S||(e=>{var t;return!(null==(t=d.current)?void 0:t.contains(e))}),disableOutsideEvents:!P},h),{overlayProps:L,arrowProps:O,placement:j,updatePosition:D,triggerAnchorPoint:I}=(0,o.v)({...E,shouldFlip:v,crossOffset:m,targetRef:d,overlayRef:h,isOpen:t.isOpen,scrollRef:g,boundaryElement:A,containerPadding:w,placement:(0,r.VO)(_),offset:p?f+3:f,onClose:P&&!N&&x?t.close:()=>{}});return(0,c.U)(()=>{M.length&&D()},M),(0,s.useEffect)(()=>{var e,r;if(t.isOpen&&h.current)return P?function(e){let t=a[a.length-1];if(t&&!t.visibleNodes.has(e))return t.visibleNodes.add(e),()=>{t.visibleNodes.delete(e)}}(null!=(e=null==n?void 0:n.current)?e:h.current):function(e,t=document.body){let n=new Set(e),r=new Set,o=e=>{for(let r of e.querySelectorAll("[data-live-announcer], [data-react-aria-top-layer]"))n.add(r);let t=e=>{if(n.has(e)||e.parentElement&&r.has(e.parentElement)&&"row"!==e.parentElement.getAttribute("role"))return NodeFilter.FILTER_REJECT;for(let t of n)if(e.contains(t))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t}),a=t(e);if(a===NodeFilter.FILTER_ACCEPT&&s(e),a!==NodeFilter.FILTER_REJECT){let e=i.nextNode();for(;null!=e;)s(e),e=i.nextNode()}},s=e=>{var t;let n=null!=(t=i.get(e))?t:0;"true"===e.getAttribute("aria-hidden")&&0===n||(0===n&&e.setAttribute("aria-hidden","true"),r.add(e),i.set(e,n+1))};a.length&&a[a.length-1].disconnect(),o(t);let l=new MutationObserver(e=>{for(let t of e)if("childList"===t.type&&0!==t.addedNodes.length&&![...n,...r].some(e=>e.contains(t.target))){for(let e of t.removedNodes)e instanceof Element&&(n.delete(e),r.delete(e));for(let e of t.addedNodes)!(e instanceof HTMLElement||e instanceof SVGElement)||"true"!==e.dataset.liveAnnouncer&&"true"!==e.dataset.reactAriaTopLayer?e instanceof Element&&o(e):n.add(e)}});l.observe(t,{childList:!0,subtree:!0});let c={visibleNodes:n,hiddenNodes:r,observe(){l.observe(t,{childList:!0,subtree:!0})},disconnect(){l.disconnect()}};return a.push(c),()=>{l.disconnect();for(let e of r){let t=i.get(e);null!=t&&(1===t?(e.removeAttribute("aria-hidden"),i.delete(e)):i.set(e,t-1))}c===a[a.length-1]?(a.pop(),a.length&&a[a.length-1].observe()):a.splice(a.indexOf(c),1)}}([null!=(r=null==n?void 0:n.current)?r:h.current])},[P,t.isOpen,h,n]),{popoverProps:(0,l.v6)(k,L),arrowProps:O,underlayProps:R,placement:j,triggerAnchorPoint:I}}var h=n(6838),p=n(681),f=n(8184),m=n(8225),g=n(8416),v=n(4906),A=n(2795),y=n(2700),b=n(2927),x="top";function _(e){var t,n,i;const a=(0,v.o)(),[o,c]=(0,A.rE)(e,y.oO.variantKeys),{as:u,ref:_,children:w,state:S,triggerRef:T,scrollRef:C,defaultOpen:M,onOpenChange:E,isOpen:P,isNonModal:N=!0,shouldFlip:k=!0,containerPadding:R=12,shouldBlockScroll:L=!1,isDismissable:O=!0,shouldCloseOnBlur:j,portalContainer:D,updatePositionDeps:I,dialogProps:B,placement:F=x,triggerType:z="dialog",showArrow:U=!1,offset:V=7,crossOffset:G=0,boundaryElement:q,isKeyboardDismissDisabled:W,shouldCloseOnInteractOutside:H,shouldCloseOnScroll:$,triggerAnchorPoint:K,motionProps:X,className:Y,classNames:Q,onClose:Z,...J}=o,ee=u||"div",te=(0,h.zD)(_),ne=(0,s.useRef)(null),re=(0,s.useRef)(!1),ie=T||ne,ae=null!=(n=null!=(t=e.disableAnimation)?t:null==a?void 0:a.disableAnimation)&&n,oe=(0,p.T)({isOpen:P,defaultOpen:M,onOpenChange:e=>{null==E||E(e),e||null==Z||Z()}}),se=S||oe,{popoverProps:le,underlayProps:ce,placement:ue}=d({triggerRef:ie,isNonModal:N,popoverRef:te,placement:F,offset:V,scrollRef:C,isDismissable:O,shouldCloseOnBlur:j,boundaryElement:q,crossOffset:G,shouldFlip:k,containerPadding:R,updatePositionDeps:I,isKeyboardDismissDisabled:W,shouldCloseOnScroll:$,shouldCloseOnInteractOutside:H,triggerAnchorPoint:K},se),de=(0,s.useMemo)(()=>ue?(0,r.p8)(ue,F)?ue:F:null,[ue,F]),{triggerProps:he}=(0,m.o)({type:z},se,ie),{isFocusVisible:pe,isFocused:fe,focusProps:me}=(0,f.o)(),ge=(0,s.useMemo)(()=>(0,y.oO)({...c}),[(0,l.t6)(c)]),ve=(0,b.cn)(null==Q?void 0:Q.base,Y),Ae={"--trigger-anchor-point":K?`${K.x}px ${K.y}px`:void 0};(0,g.H)({isDisabled:!(L&&se.isOpen)});const ye=(0,s.useCallback)((e={})=>({"data-slot":"content","data-open":(0,l.sE)(se.isOpen),"data-arrow":(0,l.sE)(U),"data-placement":ue?(0,r.Fh)(ue,F):void 0,className:ge.content({class:(0,b.cn)(null==Q?void 0:Q.content,e.className)})}),[ge,se.isOpen,U,de,F,Q,ue]),be=(0,s.useCallback)(t=>{var n;let r;return"touch"!==t.pointerType||"blur"!==(null==e?void 0:e.backdrop)&&"opaque"!==(null==e?void 0:e.backdrop)?re.current=!0:r=setTimeout(()=>{re.current=!0},100),null==(n=he.onPress)||n.call(he,t),()=>{clearTimeout(r)}},[null==he?void 0:he.onPress]),xe=(0,s.useCallback)((e={},t=null)=>{const{isDisabled:n,...r}=e;return{"data-slot":"trigger",...(0,l.v6)({"aria-haspopup":"dialog"},he,r),onPress:be,isDisabled:n,className:ge.trigger({class:(0,b.cn)(null==Q?void 0:Q.trigger,e.className),isTriggerDisabled:n}),ref:(0,l.Px)(t,ie)}},[se,he,be,ie]),_e=(0,s.useCallback)((e={})=>({"data-slot":"backdrop",className:ge.backdrop({class:null==Q?void 0:Q.backdrop}),onClick:e=>{re.current?(se.close(),re.current=!1):e.preventDefault()},...ce,...e}),[ge,se.isOpen,Q,ce]);return{state:se,Component:ee,children:w,classNames:Q,showArrow:U,triggerRef:ie,placement:de,isNonModal:N,popoverRef:te,portalContainer:D,isOpen:se.isOpen,onClose:se.close,disableAnimation:ae,shouldBlockScroll:L,backdrop:null!=(i=e.backdrop)?i:"transparent",motionProps:X,getBackdropProps:_e,getPopoverProps:(e={})=>({ref:te,...(0,l.v6)(le,J,e),style:(0,l.v6)(le.style,J.style,e.style)}),getTriggerProps:xe,getDialogProps:(e={})=>({"data-slot":"base","data-open":(0,l.sE)(se.isOpen),"data-focus":(0,l.sE)(fe),"data-arrow":(0,l.sE)(U),"data-focus-visible":(0,l.sE)(pe),"data-placement":ue?(0,r.Fh)(ue,F):void 0,...(0,l.v6)(me,B,e),className:ge.base({class:(0,b.cn)(ve)}),style:{outline:"none",...Ae}}),getContentProps:ye}}},2427:function(e,t,n){"use strict";n.d(t,{po:function(){return a},tn:function(){return s},yT:function(){return o}});var r=n(9086),i=n(1827);const a=e=>1-Math.sin(Math.acos(e)),o=(0,i.G)(a),s=(0,r.V)(a)},2489:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isDeepKey=function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}},2598:function(e,t,n){"use strict";n.d(t,{R:function(){return l}});var r=n(171),i=n(5043),a=n(3941),o=n(8493),s=n(2417);function l(e){let{isDisabled:t,onBlurWithin:n,onFocusWithin:l,onFocusWithinChange:c}=e,u=(0,i.useRef)({isFocusWithin:!1}),{addGlobalListener:d,removeAllGlobalListeners:h}=(0,s.A)(),p=(0,i.useCallback)(e=>{e.currentTarget.contains(e.target)&&u.current.isFocusWithin&&!e.currentTarget.contains(e.relatedTarget)&&(u.current.isFocusWithin=!1,h(),n&&n(e),c&&c(!1))},[n,c,u,h]),f=(0,r.yB)(p),m=(0,i.useCallback)(e=>{if(!e.currentTarget.contains(e.target))return;const t=(0,o.TW)(e.target),n=(0,a.bq)(t);if(!u.current.isFocusWithin&&n===(0,a.wt)(e.nativeEvent)){l&&l(e),c&&c(!0),u.current.isFocusWithin=!0,f(e);let n=e.currentTarget;d(t,"focus",e=>{if(u.current.isFocusWithin&&!(0,a.sD)(n,e.target)){let i=new t.defaultView.FocusEvent("blur",{relatedTarget:e.target});(0,r.o1)(i,n);let a=(0,r.eg)(i);p(a)}},{capture:!0})}},[l,c,f,d,p]);return t?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:m,onBlur:p}}}},2667:function(e,t,n){"use strict";n.d(t,{Ib:function(){return h},ry:function(){return d},zs:function(){return u}});const r=e=>180*e/Math.PI,i=e=>{const t=r(Math.atan2(e[1],e[0]));return o(t)},a={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:i,rotateZ:i,skewX:e=>r(Math.atan(e[1])),skewY:e=>r(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},o=e=>((e%=360)<0&&(e+=360),e),s=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),c={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:s,scaleY:l,scale:e=>(s(e)+l(e))/2,rotateX:e=>o(r(Math.atan2(e[6],e[5]))),rotateY:e=>o(r(Math.atan2(-e[2],e[0]))),rotateZ:i,rotate:i,skewX:e=>r(Math.atan(e[4])),skewY:e=>r(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function u(e){return e.includes("scale")?1:0}function d(e,t){if(!e||"none"===e)return u(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(n)r=c,i=n;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=a,i=t}if(!i)return u(t);const o=r[t],s=i[1].split(",").map(p);return"function"===typeof o?o(s):s[o]}const h=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return d(n,t)};function p(e){return parseFloat(e.trim())}},2682:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPlainObject=function(e){if("object"!==typeof e)return!1;if(null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){const t=e[Symbol.toStringTag];if(null==t)return!1;return!!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},2700:function(e,t,n){"use strict";n.d(t,{JC:function(){return w},et:function(){return S},x6:function(){return A},GC:function(){return y},Nr:function(){return v},jw:function(){return x},Wm:function(){return C},hF:function(){return T},MK:function(){return N},j$:function(){return k},Dt:function(){return R},zP:function(){return L},yl:function(){return M},oO:function(){return b},Lt:function(){return P},vR:function(){return E},L$:function(){return _}});var r={default:"bg-default text-default-foreground",primary:"bg-primary text-primary-foreground",secondary:"bg-secondary text-secondary-foreground",success:"bg-success text-success-foreground",warning:"bg-warning text-warning-foreground",danger:"bg-danger text-danger-foreground",foreground:"bg-foreground text-background"},i={default:"shadow-lg shadow-default/50 bg-default text-default-foreground",primary:"shadow-lg shadow-primary/40 bg-primary text-primary-foreground",secondary:"shadow-lg shadow-secondary/40 bg-secondary text-secondary-foreground",success:"shadow-lg shadow-success/40 bg-success text-success-foreground",warning:"shadow-lg shadow-warning/40 bg-warning text-warning-foreground",danger:"shadow-lg shadow-danger/40 bg-danger text-danger-foreground",foreground:"shadow-lg shadow-foreground/40 bg-foreground text-background"},a={default:"bg-transparent border-default text-foreground",primary:"bg-transparent border-primary text-primary",secondary:"bg-transparent border-secondary text-secondary",success:"bg-transparent border-success text-success",warning:"bg-transparent border-warning text-warning",danger:"bg-transparent border-danger text-danger",foreground:"bg-transparent border-foreground text-foreground"},o={default:"bg-default/40 text-default-700",primary:"bg-primary/20 text-primary-600",secondary:"bg-secondary/20 text-secondary-600",success:"bg-success/20 text-success-700 dark:text-success",warning:"bg-warning/20 text-warning-700 dark:text-warning",danger:"bg-danger/20 text-danger-600 dark:text-danger-500",foreground:"bg-foreground/10 text-foreground"},s={default:"border-default bg-default-100 text-default-foreground",primary:"border-default bg-default-100 text-primary",secondary:"border-default bg-default-100 text-secondary",success:"border-default bg-default-100 text-success",warning:"border-default bg-default-100 text-warning",danger:"border-default bg-default-100 text-danger",foreground:"border-default bg-default-100 text-foreground"},l={default:"bg-transparent text-default-foreground",primary:"bg-transparent text-primary",secondary:"bg-transparent text-secondary",success:"bg-transparent text-success",warning:"bg-transparent text-warning",danger:"bg-transparent text-danger",foreground:"bg-transparent text-foreground"},c={default:"border-default text-default-foreground",primary:"border-primary text-primary",secondary:"border-secondary text-secondary",success:"border-success text-success",warning:"border-warning text-warning",danger:"border-danger text-danger",foreground:"border-foreground text-foreground hover:!bg-foreground"},u=n(2927),d=n(9265),h=["outline-solid outline-transparent","data-[focus-visible=true]:z-10","data-[focus-visible=true]:outline-2","data-[focus-visible=true]:outline-focus","data-[focus-visible=true]:outline-offset-2"],p=["outline-solid outline-transparent","group-data-[focus-visible=true]:z-10","group-data-[focus-visible=true]:ring-2","group-data-[focus-visible=true]:ring-focus","group-data-[focus-visible=true]:ring-offset-2","group-data-[focus-visible=true]:ring-offset-background"],f=["absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],m={default:["[&+.border-medium.border-default]:ms-[calc(var(--heroui-border-width-medium)*-1)]"],primary:["[&+.border-medium.border-primary]:ms-[calc(var(--heroui-border-width-medium)*-1)]"],secondary:["[&+.border-medium.border-secondary]:ms-[calc(var(--heroui-border-width-medium)*-1)]"],success:["[&+.border-medium.border-success]:ms-[calc(var(--heroui-border-width-medium)*-1)]"],warning:["[&+.border-medium.border-warning]:ms-[calc(var(--heroui-border-width-medium)*-1)]"],danger:["[&+.border-medium.border-danger]:ms-[calc(var(--heroui-border-width-medium)*-1)]"]},g=["font-inherit","text-[100%]","leading-[1.15]","m-0","p-0","overflow-visible","box-border","absolute","top-0","w-full","h-full","opacity-[0.0001]","z-[1]","cursor-pointer","disabled:cursor-default"],v=((0,d.tv)({slots:{base:["flex","relative","justify-center","items-center","box-border","overflow-hidden","align-middle","text-white","z-0",...h],img:["flex","object-cover","w-full","h-full","transition-opacity","!duration-500","opacity-0","data-[loaded=true]:opacity-100"],fallback:[...f,"flex","items-center","justify-center"],name:[...f,"font-normal","text-center","text-inherit"],icon:[...f,"flex","items-center","justify-center","text-inherit","w-full","h-full"]},variants:{size:{sm:{base:"w-8 h-8 text-tiny"},md:{base:"w-10 h-10 text-tiny"},lg:{base:"w-14 h-14 text-small"}},color:{default:{base:r.default},primary:{base:r.primary},secondary:{base:r.secondary},success:{base:r.success},warning:{base:r.warning},danger:{base:r.danger}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"},full:{base:"rounded-full"}},isBordered:{true:{base:"ring-2 ring-offset-2 ring-offset-background dark:ring-offset-background-dark"}},isDisabled:{true:{base:"opacity-disabled"}},isInGroup:{true:{base:["-ms-2 data-[hover=true]:-translate-x-3 rtl:data-[hover=true]:translate-x-3 transition-transform","data-[focus-visible=true]:-translate-x-3 rtl:data-[focus-visible=true]:translate-x-3"]}},isInGridGroup:{true:{base:"m-0 data-[hover=true]:translate-x-0"}},disableAnimation:{true:{base:"transition-none",img:"transition-none"},false:{}}},defaultVariants:{size:"md",color:"default",radius:"full"},compoundVariants:[{color:"default",isBordered:!0,class:{base:"ring-default"}},{color:"primary",isBordered:!0,class:{base:"ring-primary"}},{color:"secondary",isBordered:!0,class:{base:"ring-secondary"}},{color:"success",isBordered:!0,class:{base:"ring-success"}},{color:"warning",isBordered:!0,class:{base:"ring-warning"}},{color:"danger",isBordered:!0,class:{base:"ring-danger"}}]}),(0,d.tv)({slots:{base:"flex items-center justify-center h-auto w-max",count:"hover:-translate-x-0"},variants:{isGrid:{true:"inline-grid grid-cols-4 gap-3"}}}),(0,d.tv)({slots:{base:["flex","flex-col","relative","overflow-hidden","h-auto","outline-solid outline-transparent","text-foreground","box-border","bg-content1",...h],header:["flex","p-3","z-10","w-full","justify-start","items-center","shrink-0","overflow-inherit","color-inherit","subpixel-antialiased"],body:["relative","flex","flex-1","w-full","p-3","flex-auto","flex-col","place-content-inherit","align-items-inherit","h-auto","break-words","text-left","overflow-y-auto","subpixel-antialiased"],footer:["p-3","h-auto","flex","w-full","items-center","overflow-hidden","color-inherit","subpixel-antialiased"]},variants:{shadow:{none:{base:"shadow-none"},sm:{base:"shadow-small"},md:{base:"shadow-medium"},lg:{base:"shadow-large"}},radius:{none:{base:"rounded-none",header:"rounded-none",footer:"rounded-none"},sm:{base:"rounded-small",header:"rounded-t-small",footer:"rounded-b-small"},md:{base:"rounded-medium",header:"rounded-t-medium",footer:"rounded-b-medium"},lg:{base:"rounded-large",header:"rounded-t-large",footer:"rounded-b-large"}},fullWidth:{true:{base:"w-full"}},isHoverable:{true:{base:"data-[hover=true]:bg-content2 dark:data-[hover=true]:bg-content2"}},isPressable:{true:{base:"cursor-pointer"}},isBlurred:{true:{base:["bg-background/80","dark:bg-background/20","backdrop-blur-md","backdrop-saturate-150"]}},isFooterBlurred:{true:{footer:["bg-background/10","backdrop-blur","backdrop-saturate-150"]}},isDisabled:{true:{base:"opacity-disabled cursor-not-allowed"}},disableAnimation:{true:"",false:{base:"transition-transform-background motion-reduce:transition-none"}}},compoundVariants:[{isPressable:!0,class:"data-[pressed=true]:scale-[0.97] tap-highlight-transparent"}],defaultVariants:{radius:"lg",shadow:"md",fullWidth:!1,isHoverable:!1,isPressable:!1,isDisabled:!1,isFooterBlurred:!1}})),A=((0,d.tv)({base:["relative inline-flex items-center outline-solid outline-transparent tap-highlight-transparent",...h],variants:{size:{sm:"text-small",md:"text-medium",lg:"text-large"},color:{foreground:"text-foreground",primary:"text-primary",secondary:"text-secondary",success:"text-success",warning:"text-warning",danger:"text-danger"},underline:{none:"no-underline",hover:"hover:underline",always:"underline",active:"active:underline",focus:"focus:underline"},isBlock:{true:["px-2","py-1","hover:after:opacity-100","after:content-['']","after:inset-0","after:opacity-0","after:w-full","after:h-full","after:rounded-xl","after:transition-background","after:absolute"],false:"hover:opacity-hover active:opacity-disabled transition-opacity"},isDisabled:{true:"opacity-disabled cursor-default pointer-events-none"},disableAnimation:{true:"after:transition-none transition-none"}},compoundVariants:[{isBlock:!0,color:"foreground",class:"hover:after:bg-foreground/10"},{isBlock:!0,color:"primary",class:"hover:after:bg-primary/20"},{isBlock:!0,color:"secondary",class:"hover:after:bg-secondary/20"},{isBlock:!0,color:"success",class:"hover:after:bg-success/20"},{isBlock:!0,color:"warning",class:"hover:after:bg-warning/20"},{isBlock:!0,color:"danger",class:"hover:after:bg-danger/20"},{underline:["hover","always","active","focus"],class:"underline-offset-4"}],defaultVariants:{color:"primary",size:"md",isBlock:!1,underline:"none",isDisabled:!1}}),(0,d.tv)({slots:{base:["inline-flex items-center justify-center gap-2 rounded-small outline-solid outline-transparent",...h],wrapper:"inline-flex flex-col items-start",name:"text-small text-inherit",description:"text-tiny text-foreground-400"}}),(0,d.tv)({base:["z-0","group","relative","inline-flex","items-center","justify-center","box-border","appearance-none","outline-solid outline-transparent","select-none","whitespace-nowrap","min-w-max","font-normal","subpixel-antialiased","overflow-hidden","tap-highlight-transparent","transform-gpu data-[pressed=true]:scale-[0.97]","cursor-pointer",...h],variants:{variant:{solid:"",bordered:"border-medium bg-transparent",light:"bg-transparent",flat:"",faded:"border-medium",shadow:"",ghost:"border-medium bg-transparent"},size:{sm:"px-3 min-w-16 h-8 text-tiny gap-2 rounded-small",md:"px-4 min-w-20 h-10 text-small gap-2 rounded-medium",lg:"px-6 min-w-24 h-12 text-medium gap-3 rounded-large"},color:{default:"",primary:"",secondary:"",success:"",warning:"",danger:""},radius:{none:"rounded-none",sm:"rounded-small",md:"rounded-medium",lg:"rounded-large",full:"rounded-full"},fullWidth:{true:"w-full"},isDisabled:{true:"opacity-disabled pointer-events-none"},isInGroup:{true:"[&:not(:first-child):not(:last-child)]:rounded-none"},isIconOnly:{true:"px-0 !gap-0",false:"[&>svg]:max-w-[theme(spacing.8)]"},disableAnimation:{true:"!transition-none data-[pressed=true]:scale-100",false:"transition-transform-colors-opacity motion-reduce:transition-none"}},defaultVariants:{size:"md",variant:"solid",color:"default",fullWidth:!1,isDisabled:!1,isInGroup:!1},compoundVariants:[{variant:"solid",color:"default",class:r.default},{variant:"solid",color:"primary",class:r.primary},{variant:"solid",color:"secondary",class:r.secondary},{variant:"solid",color:"success",class:r.success},{variant:"solid",color:"warning",class:r.warning},{variant:"solid",color:"danger",class:r.danger},{variant:"shadow",color:"default",class:i.default},{variant:"shadow",color:"primary",class:i.primary},{variant:"shadow",color:"secondary",class:i.secondary},{variant:"shadow",color:"success",class:i.success},{variant:"shadow",color:"warning",class:i.warning},{variant:"shadow",color:"danger",class:i.danger},{variant:"bordered",color:"default",class:a.default},{variant:"bordered",color:"primary",class:a.primary},{variant:"bordered",color:"secondary",class:a.secondary},{variant:"bordered",color:"success",class:a.success},{variant:"bordered",color:"warning",class:a.warning},{variant:"bordered",color:"danger",class:a.danger},{variant:"flat",color:"default",class:o.default},{variant:"flat",color:"primary",class:o.primary},{variant:"flat",color:"secondary",class:o.secondary},{variant:"flat",color:"success",class:o.success},{variant:"flat",color:"warning",class:o.warning},{variant:"flat",color:"danger",class:o.danger},{variant:"faded",color:"default",class:s.default},{variant:"faded",color:"primary",class:s.primary},{variant:"faded",color:"secondary",class:s.secondary},{variant:"faded",color:"success",class:s.success},{variant:"faded",color:"warning",class:s.warning},{variant:"faded",color:"danger",class:s.danger},{variant:"light",color:"default",class:[l.default,"data-[hover=true]:bg-default/40"]},{variant:"light",color:"primary",class:[l.primary,"data-[hover=true]:bg-primary/20"]},{variant:"light",color:"secondary",class:[l.secondary,"data-[hover=true]:bg-secondary/20"]},{variant:"light",color:"success",class:[l.success,"data-[hover=true]:bg-success/20"]},{variant:"light",color:"warning",class:[l.warning,"data-[hover=true]:bg-warning/20"]},{variant:"light",color:"danger",class:[l.danger,"data-[hover=true]:bg-danger/20"]},{variant:"ghost",color:"default",class:[c.default,"data-[hover=true]:!bg-default"]},{variant:"ghost",color:"primary",class:[c.primary,"data-[hover=true]:!bg-primary data-[hover=true]:!text-primary-foreground"]},{variant:"ghost",color:"secondary",class:[c.secondary,"data-[hover=true]:!bg-secondary data-[hover=true]:!text-secondary-foreground"]},{variant:"ghost",color:"success",class:[c.success,"data-[hover=true]:!bg-success data-[hover=true]:!text-success-foreground"]},{variant:"ghost",color:"warning",class:[c.warning,"data-[hover=true]:!bg-warning data-[hover=true]:!text-warning-foreground"]},{variant:"ghost",color:"danger",class:[c.danger,"data-[hover=true]:!bg-danger data-[hover=true]:!text-danger-foreground"]},{isInGroup:!0,class:"rounded-none first:rounded-s-medium last:rounded-e-medium"},{isInGroup:!0,size:"sm",class:"rounded-none first:rounded-s-small last:rounded-e-small"},{isInGroup:!0,size:"md",class:"rounded-none first:rounded-s-medium last:rounded-e-medium"},{isInGroup:!0,size:"lg",class:"rounded-none first:rounded-s-large last:rounded-e-large"},{isInGroup:!0,isRounded:!0,class:"rounded-none first:rounded-s-full last:rounded-e-full"},{isInGroup:!0,radius:"none",class:"rounded-none first:rounded-s-none last:rounded-e-none"},{isInGroup:!0,radius:"sm",class:"rounded-none first:rounded-s-small last:rounded-e-small"},{isInGroup:!0,radius:"md",class:"rounded-none first:rounded-s-medium last:rounded-e-medium"},{isInGroup:!0,radius:"lg",class:"rounded-none first:rounded-s-large last:rounded-e-large"},{isInGroup:!0,radius:"full",class:"rounded-none first:rounded-s-full last:rounded-e-full"},{isInGroup:!0,variant:["ghost","bordered"],color:"default",className:m.default},{isInGroup:!0,variant:["ghost","bordered"],color:"primary",className:m.primary},{isInGroup:!0,variant:["ghost","bordered"],color:"secondary",className:m.secondary},{isInGroup:!0,variant:["ghost","bordered"],color:"success",className:m.success},{isInGroup:!0,variant:["ghost","bordered"],color:"warning",className:m.warning},{isInGroup:!0,variant:["ghost","bordered"],color:"danger",className:m.danger},{isIconOnly:!0,size:"sm",class:"min-w-8 w-8 h-8"},{isIconOnly:!0,size:"md",class:"min-w-10 w-10 h-10"},{isIconOnly:!0,size:"lg",class:"min-w-12 w-12 h-12"},{variant:["solid","faded","flat","bordered","shadow"],class:"data-[hover=true]:opacity-hover"}]})),y=(0,d.tv)({base:"inline-flex items-center justify-center h-auto",variants:{fullWidth:{true:"w-full"}},defaultVariants:{fullWidth:!1}}),b=((0,d.tv)({base:["px-2","py-1","h-fit","font-mono","font-normal","inline-block","whitespace-nowrap"],variants:{color:{default:o.default,primary:o.primary,secondary:o.secondary,success:o.success,warning:o.warning,danger:o.danger},size:{sm:"text-small",md:"text-medium",lg:"text-large"},radius:{none:"rounded-none",sm:"rounded-small",md:"rounded-medium",lg:"rounded-large",full:"rounded-full"}},defaultVariants:{color:"default",size:"sm",radius:"sm"}}),(0,d.tv)({slots:{base:["z-0","relative","bg-transparent","[transform-origin:var(--trigger-anchor-point)]","before:content-['']","before:hidden","before:z-[-1]","before:absolute","before:rotate-45","before:w-2.5","before:h-2.5","before:rounded-sm","data-[arrow=true]:before:block","data-[placement=top]:before:-bottom-[calc(theme(spacing.5)/4_-_1.5px)]","data-[placement=top]:before:left-1/2","data-[placement=top]:before:-translate-x-1/2","data-[placement=top-start]:before:-bottom-[calc(theme(spacing.5)/4_-_1.5px)]","data-[placement=top-start]:before:left-3","data-[placement=top-end]:before:-bottom-[calc(theme(spacing.5)/4_-_1.5px)]","data-[placement=top-end]:before:right-3","data-[placement=bottom]:before:-top-[calc(theme(spacing.5)/4_-_1.5px)]","data-[placement=bottom]:before:left-1/2","data-[placement=bottom]:before:-translate-x-1/2","data-[placement=bottom-start]:before:-top-[calc(theme(spacing.5)/4_-_1.5px)]","data-[placement=bottom-start]:before:left-3","data-[placement=bottom-end]:before:-top-[calc(theme(spacing.5)/4_-_1.5px)]","data-[placement=bottom-end]:before:right-3","data-[placement=left]:before:-right-[calc(theme(spacing.5)/4_-_2px)]","data-[placement=left]:before:top-1/2","data-[placement=left]:before:-translate-y-1/2","data-[placement=left-start]:before:-right-[calc(theme(spacing.5)/4_-_3px)]","data-[placement=left-start]:before:top-1/4","data-[placement=left-end]:before:-right-[calc(theme(spacing.5)/4_-_3px)]","data-[placement=left-end]:before:bottom-1/4","data-[placement=right]:before:-left-[calc(theme(spacing.5)/4_-_2px)]","data-[placement=right]:before:top-1/2","data-[placement=right]:before:-translate-y-1/2","data-[placement=right-start]:before:-left-[calc(theme(spacing.5)/4_-_3px)]","data-[placement=right-start]:before:top-1/4","data-[placement=right-end]:before:-left-[calc(theme(spacing.5)/4_-_3px)]","data-[placement=right-end]:before:bottom-1/4",...h],content:["z-10","px-2.5","py-1","w-full","inline-flex","flex-col","items-center","justify-center","box-border","subpixel-antialiased","outline-solid outline-transparent","box-border"],trigger:["z-10"],backdrop:["hidden"],arrow:[]},variants:{size:{sm:{content:"text-tiny"},md:{content:"text-small"},lg:{content:"text-medium"}},color:{default:{base:"before:bg-content1 before:shadow-small",content:"bg-content1"},foreground:{base:"before:bg-foreground",content:r.foreground},primary:{base:"before:bg-primary",content:r.primary},secondary:{base:"before:bg-secondary",content:r.secondary},success:{base:"before:bg-success",content:r.success},warning:{base:"before:bg-warning",content:r.warning},danger:{base:"before:bg-danger",content:r.danger}},radius:{none:{content:"rounded-none"},sm:{content:"rounded-small"},md:{content:"rounded-medium"},lg:{content:"rounded-large"},full:{content:"rounded-full"}},shadow:{none:{content:"shadow-none"},sm:{content:"shadow-small"},md:{content:"shadow-medium"},lg:{content:"shadow-large"}},backdrop:{transparent:{},opaque:{backdrop:"bg-overlay/50 backdrop-opacity-disabled"},blur:{backdrop:"backdrop-blur-sm backdrop-saturate-150 bg-overlay/30"}},triggerScaleOnOpen:{true:{trigger:["aria-expanded:scale-[0.97]","aria-expanded:opacity-70","subpixel-antialiased"]},false:{}},disableAnimation:{true:{base:"animate-none"}},isTriggerDisabled:{true:{trigger:"opacity-disabled pointer-events-none"},false:{}}},defaultVariants:{color:"default",radius:"lg",size:"md",shadow:"md",backdrop:"transparent",triggerScaleOnOpen:!0},compoundVariants:[{backdrop:["opaque","blur"],class:{backdrop:"block w-full h-full fixed inset-0 -z-30"}}]})),x=((0,d.tv)({slots:{base:"inline-flex items-center justify-between h-fit rounded-large gap-2",pre:"bg-transparent text-inherit font-mono font-normal inline-block whitespace-nowrap",content:"flex flex-col",symbol:"select-none",copyButton:["group","relative","z-10","text-large","text-inherit","data-[hover=true]:bg-transparent"],copyIcon:["absolute text-inherit opacity-100 scale-100 group-data-[copied=true]:opacity-0 group-data-[copied=true]:scale-50"],checkIcon:["absolute text-inherit opacity-0 scale-50 group-data-[copied=true]:opacity-100 group-data-[copied=true]:scale-100"]},variants:{variant:{flat:"",solid:"",bordered:"border-medium bg-transparent",shadow:""},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{base:"px-1.5 py-0.5 text-tiny rounded-small"},md:{base:"px-3 py-1.5 text-small rounded-medium"},lg:{base:"px-4 py-2 text-medium rounded-large"}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"}},fullWidth:{true:{base:"w-full"}},disableAnimation:{true:{},false:{copyIcon:"transition-transform-opacity",checkIcon:"transition-transform-opacity"}}},defaultVariants:{color:"default",variant:"flat",size:"md",fullWidth:!1},compoundVariants:[{variant:["solid","shadow"],color:"default",class:{copyButton:"data-[focus-visible]:outline-default-foreground"}},{variant:["solid","shadow"],color:"primary",class:{copyButton:"data-[focus-visible]:outline-primary-foreground"}},{variant:["solid","shadow"],color:"secondary",class:{copyButton:"data-[focus-visible]:outline-secondary-foreground"}},{variant:["solid","shadow"],color:"success",class:{copyButton:"data-[focus-visible]:outline-success-foreground"}},{variant:["solid","shadow"],color:"warning",class:{copyButton:"data-[focus-visible]:outline-warning-foreground"}},{variant:["solid","shadow"],color:"danger",class:{copyButton:"data-[focus-visible]:outline-danger-foreground"}},{variant:"flat",color:"default",class:{base:o.default}},{variant:"flat",color:"primary",class:{base:o.primary}},{variant:"flat",color:"secondary",class:{base:o.secondary}},{variant:"flat",color:"success",class:{base:o.success}},{variant:"flat",color:"warning",class:{base:o.warning}},{variant:"flat",color:"danger",class:{base:o.danger}},{variant:"solid",color:"default",class:{base:r.default}},{variant:"solid",color:"primary",class:{base:r.primary}},{variant:"solid",color:"secondary",class:{base:r.secondary}},{variant:"solid",color:"success",class:{base:r.success}},{variant:"solid",color:"warning",class:{base:r.warning}},{variant:"solid",color:"danger",class:{base:r.danger}},{variant:"shadow",color:"default",class:{base:i.default}},{variant:"shadow",color:"primary",class:{base:i.primary}},{variant:"shadow",color:"secondary",class:{base:i.secondary}},{variant:"shadow",color:"success",class:{base:i.success}},{variant:"shadow",color:"warning",class:{base:i.warning}},{variant:"shadow",color:"danger",class:{base:i.danger}},{variant:"bordered",color:"default",class:{base:a.default}},{variant:"bordered",color:"primary",class:{base:a.primary}},{variant:"bordered",color:"secondary",class:{base:a.secondary}},{variant:"bordered",color:"success",class:{base:a.success}},{variant:"bordered",color:"warning",class:{base:a.warning}},{variant:"bordered",color:"danger",class:{base:a.danger}}]}),(0,d.tv)({slots:{base:["relative","max-w-fit","min-w-min","inline-flex","items-center","justify-between","box-border","whitespace-nowrap"],content:"flex-1 text-inherit font-normal",dot:["w-2","h-2","ml-1","rounded-full"],avatar:"shrink-0",closeButton:["z-10","appearance-none","outline-solid outline-transparent","select-none","transition-opacity","opacity-70","hover:opacity-100","cursor-pointer","active:opacity-disabled","tap-highlight-transparent"]},variants:{variant:{solid:{},bordered:{base:"border-medium bg-transparent"},light:{base:"bg-transparent"},flat:{},faded:{base:"border-medium"},shadow:{},dot:{base:"border-medium border-default text-foreground bg-transparent"}},color:{default:{dot:"bg-default-400"},primary:{dot:"bg-primary"},secondary:{dot:"bg-secondary"},success:{dot:"bg-success"},warning:{dot:"bg-warning"},danger:{dot:"bg-danger"}},size:{sm:{base:"px-1 h-6 text-tiny",content:"px-1",closeButton:"text-medium",avatar:"w-4 h-4"},md:{base:"px-1 h-7 text-small",content:"px-2",closeButton:"text-large",avatar:"w-5 h-5"},lg:{base:"px-2 h-8 text-medium",content:"px-2",closeButton:"text-xl",avatar:"w-6 h-6"}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"},full:{base:"rounded-full"}},isOneChar:{true:{},false:{}},isCloseable:{true:{},false:{}},hasStartContent:{true:{}},hasEndContent:{true:{}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},isCloseButtonFocusVisible:{true:{closeButton:["outline-solid outline-transparent","ring-2","ring-focus","ring-offset-2","ring-offset-background","ring-1","rounded-full"]}}},defaultVariants:{variant:"solid",color:"default",size:"md",radius:"full",isDisabled:!1},compoundVariants:[{variant:"solid",color:"default",class:{base:r.default}},{variant:"solid",color:"primary",class:{base:r.primary}},{variant:"solid",color:"secondary",class:{base:r.secondary}},{variant:"solid",color:"success",class:{base:r.success}},{variant:"solid",color:"warning",class:{base:r.warning}},{variant:"solid",color:"danger",class:{base:r.danger}},{variant:"shadow",color:"default",class:{base:i.default}},{variant:"shadow",color:"primary",class:{base:i.primary}},{variant:"shadow",color:"secondary",class:{base:i.secondary}},{variant:"shadow",color:"success",class:{base:i.success}},{variant:"shadow",color:"warning",class:{base:i.warning}},{variant:"shadow",color:"danger",class:{base:i.danger}},{variant:"bordered",color:"default",class:{base:a.default}},{variant:"bordered",color:"primary",class:{base:a.primary}},{variant:"bordered",color:"secondary",class:{base:a.secondary}},{variant:"bordered",color:"success",class:{base:a.success}},{variant:"bordered",color:"warning",class:{base:a.warning}},{variant:"bordered",color:"danger",class:{base:a.danger}},{variant:"flat",color:"default",class:{base:o.default}},{variant:"flat",color:"primary",class:{base:o.primary}},{variant:"flat",color:"secondary",class:{base:o.secondary}},{variant:"flat",color:"success",class:{base:o.success}},{variant:"flat",color:"warning",class:{base:o.warning}},{variant:"flat",color:"danger",class:{base:o.danger}},{variant:"faded",color:"default",class:{base:s.default}},{variant:"faded",color:"primary",class:{base:s.primary}},{variant:"faded",color:"secondary",class:{base:s.secondary}},{variant:"faded",color:"success",class:{base:s.success}},{variant:"faded",color:"warning",class:{base:s.warning}},{variant:"faded",color:"danger",class:{base:s.danger}},{variant:"light",color:"default",class:{base:l.default}},{variant:"light",color:"primary",class:{base:l.primary}},{variant:"light",color:"secondary",class:{base:l.secondary}},{variant:"light",color:"success",class:{base:l.success}},{variant:"light",color:"warning",class:{base:l.warning}},{variant:"light",color:"danger",class:{base:l.danger}},{isOneChar:!0,hasStartContent:!1,hasEndContent:!1,size:"sm",class:{base:"w-5 h-5 min-w-5 min-h-5"}},{isOneChar:!0,hasStartContent:!1,hasEndContent:!1,size:"md",class:{base:"w-6 h-6 min-w-6 min-h-6"}},{isOneChar:!0,hasStartContent:!1,hasEndContent:!1,size:"lg",class:{base:"w-7 h-7 min-w-7 min-h-7"}},{isOneChar:!0,isCloseable:!1,hasStartContent:!1,hasEndContent:!1,class:{base:"px-0 justify-center",content:"px-0 flex-none"}},{isOneChar:!0,isCloseable:!0,hasStartContent:!1,hasEndContent:!1,class:{base:"w-auto"}},{isOneChar:!0,variant:"dot",class:{base:"w-auto h-7 px-1 items-center",content:"px-2"}},{hasStartContent:!0,size:"sm",class:{content:"pl-0.5"}},{hasStartContent:!0,size:["md","lg"],class:{content:"pl-1"}},{hasEndContent:!0,size:"sm",class:{content:"pr-0.5"}},{hasEndContent:!0,size:["md","lg"],class:{content:"pr-1"}}]})),_=((0,d.tv)({slots:{base:["relative","inline-flex","shrink-0"],badge:["flex","z-10","flex-wrap","absolute","box-border","rounded-full","whitespace-nowrap","place-content-center","origin-center","items-center","text-inherit","select-none","font-regular","scale-100","opacity-100","subpixel-antialiased","data-[invisible=true]:scale-0","data-[invisible=true]:opacity-0"]},variants:{variant:{solid:{},flat:{},faded:{badge:"border-medium"},shadow:{}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{badge:"px-1 text-tiny"},md:{badge:"px-1 text-small"},lg:{badge:"px-1 text-small"}},placement:{"top-right":{},"top-left":{},"bottom-right":{},"bottom-left":{}},shape:{circle:{},rectangle:{}},isInvisible:{true:{}},isOneChar:{true:{badge:"px-0"}},isDot:{true:{}},disableAnimation:{true:{badge:"transition-none"},false:{badge:"transition-transform-opacity !ease-soft-spring !duration-300"}},showOutline:{true:{badge:"border-2 border-background"},false:{badge:"border-transparent border-0"}}},defaultVariants:{variant:"solid",color:"default",size:"md",shape:"rectangle",placement:"top-right",showOutline:!0,isInvisible:!1},compoundVariants:[{variant:"solid",color:"default",class:{badge:r.default}},{variant:"solid",color:"primary",class:{badge:r.primary}},{variant:"solid",color:"secondary",class:{badge:r.secondary}},{variant:"solid",color:"success",class:{badge:r.success}},{variant:"solid",color:"warning",class:{badge:r.warning}},{variant:"solid",color:"danger",class:{badge:r.danger}},{variant:"shadow",color:"default",class:{badge:i.default}},{variant:"shadow",color:"primary",class:{badge:i.primary}},{variant:"shadow",color:"secondary",class:{badge:i.secondary}},{variant:"shadow",color:"success",class:{badge:i.success}},{variant:"shadow",color:"warning",class:{badge:i.warning}},{variant:"shadow",color:"danger",class:{badge:i.danger}},{variant:"flat",color:"default",class:{badge:o.default}},{variant:"flat",color:"primary",class:{badge:o.primary}},{variant:"flat",color:"secondary",class:{badge:o.secondary}},{variant:"flat",color:"success",class:{badge:o.success}},{variant:"flat",color:"warning",class:{badge:o.warning}},{variant:"flat",color:"danger",class:{badge:o.danger}},{variant:"faded",color:"default",class:{badge:s.default}},{variant:"faded",color:"primary",class:{badge:s.primary}},{variant:"faded",color:"secondary",class:{badge:s.secondary}},{variant:"faded",color:"success",class:{badge:s.success}},{variant:"faded",color:"warning",class:{badge:s.warning}},{variant:"faded",color:"danger",class:{badge:s.danger}},{isOneChar:!0,size:"sm",class:{badge:"w-4 h-4 min-w-4 min-h-4"}},{isOneChar:!0,size:"md",class:{badge:"w-5 h-5 min-w-5 min-h-5"}},{isOneChar:!0,size:"lg",class:{badge:"w-6 h-6 min-w-6 min-h-6"}},{isDot:!0,size:"sm",class:{badge:"w-3 h-3 min-w-3 min-h-3"}},{isDot:!0,size:"md",class:{badge:"w-3.5 h-3.5 min-w-3.5 min-h-3.5"}},{isDot:!0,size:"lg",class:{badge:"w-4 h-4 min-w-4 min-h-4"}},{placement:"top-right",shape:"rectangle",class:{badge:"top-[5%] right-[5%] translate-x-1/2 -translate-y-1/2"}},{placement:"top-left",shape:"rectangle",class:{badge:"top-[5%] left-[5%] -translate-x-1/2 -translate-y-1/2"}},{placement:"bottom-right",shape:"rectangle",class:{badge:"bottom-[5%] right-[5%] translate-x-1/2 translate-y-1/2"}},{placement:"bottom-left",shape:"rectangle",class:{badge:"bottom-[5%] left-[5%] -translate-x-1/2 translate-y-1/2"}},{placement:"top-right",shape:"circle",class:{badge:"top-[10%] right-[10%] translate-x-1/2 -translate-y-1/2"}},{placement:"top-left",shape:"circle",class:{badge:"top-[10%] left-[10%] -translate-x-1/2 -translate-y-1/2"}},{placement:"bottom-right",shape:"circle",class:{badge:"bottom-[10%] right-[10%] translate-x-1/2 translate-y-1/2"}},{placement:"bottom-left",shape:"circle",class:{badge:"bottom-[10%] left-[10%] -translate-x-1/2 translate-y-1/2"}}]}),(0,d.tv)({slots:{base:"group relative max-w-fit inline-flex items-center justify-start cursor-pointer tap-highlight-transparent p-2 -m-2 select-none",wrapper:["relative","inline-flex","items-center","justify-center","shrink-0","overflow-hidden","before:content-['']","before:absolute","before:inset-0","before:border-solid","before:border-2","before:box-border","before:border-default","after:content-['']","after:absolute","after:inset-0","after:scale-50","after:opacity-0","after:origin-center","group-data-[selected=true]:after:scale-100","group-data-[selected=true]:after:opacity-100","group-data-[hover=true]:before:bg-default-100",...p],hiddenInput:g,icon:"z-10 w-4 h-3 opacity-0 group-data-[selected=true]:opacity-100 pointer-events-none",label:"relative text-foreground select-none"},variants:{color:{default:{wrapper:"after:bg-default after:text-default-foreground text-default-foreground"},primary:{wrapper:"after:bg-primary after:text-primary-foreground text-primary-foreground"},secondary:{wrapper:"after:bg-secondary after:text-secondary-foreground text-secondary-foreground"},success:{wrapper:"after:bg-success after:text-success-foreground text-success-foreground"},warning:{wrapper:"after:bg-warning after:text-warning-foreground text-warning-foreground"},danger:{wrapper:"after:bg-danger after:text-danger-foreground text-danger-foreground"}},size:{sm:{wrapper:["w-4 h-4 me-2","rounded-[calc(var(--heroui-radius-medium)*0.5)]","before:rounded-[calc(var(--heroui-radius-medium)*0.5)]","after:rounded-[calc(var(--heroui-radius-medium)*0.5)]"],label:"text-small",icon:"w-3 h-2"},md:{wrapper:["w-5 h-5 me-2","rounded-[calc(var(--heroui-radius-medium)*0.6)]","before:rounded-[calc(var(--heroui-radius-medium)*0.6)]","after:rounded-[calc(var(--heroui-radius-medium)*0.6)]"],label:"text-medium",icon:"w-4 h-3"},lg:{wrapper:["w-6 h-6 me-2","rounded-[calc(var(--heroui-radius-medium)*0.7)]","before:rounded-[calc(var(--heroui-radius-medium)*0.7)]","after:rounded-[calc(var(--heroui-radius-medium)*0.7)]"],label:"text-large",icon:"w-5 h-4"}},radius:{none:{wrapper:"rounded-none before:rounded-none after:rounded-none"},sm:{wrapper:["rounded-[calc(var(--heroui-radius-medium)*0.5)]","before:rounded-[calc(var(--heroui-radius-medium)*0.5)]","after:rounded-[calc(var(--heroui-radius-medium)*0.5)]"]},md:{wrapper:["rounded-[calc(var(--heroui-radius-medium)*0.6)]","before:rounded-[calc(var(--heroui-radius-medium)*0.6)]","after:rounded-[calc(var(--heroui-radius-medium)*0.6)]"]},lg:{wrapper:["rounded-[calc(var(--heroui-radius-medium)*0.7)]","before:rounded-[calc(var(--heroui-radius-medium)*0.7)]","after:rounded-[calc(var(--heroui-radius-medium)*0.7)]"]},full:{wrapper:"rounded-full before:rounded-full after:rounded-full"}},lineThrough:{true:{label:["inline-flex","items-center","justify-center","before:content-['']","before:absolute","before:bg-foreground","before:w-0","before:h-0.5","group-data-[selected=true]:opacity-60","group-data-[selected=true]:before:w-full"]}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},isInvalid:{true:{wrapper:"before:border-danger",label:"text-danger"}},disableAnimation:{true:{wrapper:"transition-none",icon:"transition-none",label:"transition-none"},false:{wrapper:["before:transition-colors","group-data-[pressed=true]:scale-95","transition-transform","after:transition-transform-opacity","after:!ease-linear","after:!duration-200","motion-reduce:transition-none"],icon:"transition-opacity motion-reduce:transition-none",label:"transition-colors-opacity before:transition-width motion-reduce:transition-none"}}},defaultVariants:{color:"primary",size:"md",isDisabled:!1,lineThrough:!1}}),(0,d.tv)({slots:{base:"relative flex flex-col gap-2",label:"relative text-medium text-foreground-500",wrapper:"flex flex-col flex-wrap gap-2 data-[orientation=horizontal]:flex-row",description:"text-small text-foreground-400",errorMessage:"text-small text-danger"},variants:{isRequired:{true:{label:"after:content-['*'] after:text-danger after:ml-0.5"}},isInvalid:{true:{description:"text-danger"}},disableAnimation:{true:{},false:{description:"transition-colors !duration-150 motion-reduce:transition-none"}}},defaultVariants:{isInvalid:!1,isRequired:!1}}),(0,d.tv)({slots:{base:"group relative max-w-fit inline-flex items-center justify-start cursor-pointer tap-highlight-transparent p-2 -m-2 select-none",wrapper:["relative","inline-flex","items-center","justify-center","shrink-0","overflow-hidden","border-solid","border-medium","box-border","border-default","rounded-full","group-data-[hover-unselected=true]:bg-default-100",...p],hiddenInput:g,labelWrapper:"flex flex-col ml-1",control:["z-10","w-2","h-2","opacity-0","scale-0","origin-center","rounded-full","group-data-[selected=true]:opacity-100","group-data-[selected=true]:scale-100"],label:"relative text-foreground select-none",description:"relative text-foreground-400"},variants:{color:{default:{control:"bg-default-500 text-default-foreground",wrapper:"group-data-[selected=true]:border-default-500"},primary:{control:"bg-primary text-primary-foreground",wrapper:"group-data-[selected=true]:border-primary"},secondary:{control:"bg-secondary text-secondary-foreground",wrapper:"group-data-[selected=true]:border-secondary"},success:{control:"bg-success text-success-foreground",wrapper:"group-data-[selected=true]:border-success"},warning:{control:"bg-warning text-warning-foreground",wrapper:"group-data-[selected=true]:border-warning"},danger:{control:"bg-danger text-danger-foreground",wrapper:"group-data-[selected=true]:border-danger"}},size:{sm:{wrapper:"w-4 h-4",control:"w-1.5 h-1.5",labelWrapper:"ml-1",label:"text-small",description:"text-tiny"},md:{wrapper:"w-5 h-5",control:"w-2 h-2",labelWrapper:"ms-2",label:"text-medium",description:"text-small"},lg:{wrapper:"w-6 h-6",control:"w-2.5 h-2.5",labelWrapper:"ms-2",label:"text-large",description:"text-medium"}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},isInvalid:{true:{control:"bg-danger text-danger-foreground",wrapper:"border-danger group-data-[selected=true]:border-danger",label:"text-danger",description:"text-danger-300"}},disableAnimation:{true:{},false:{wrapper:["group-data-[pressed=true]:scale-95","transition-transform-colors","motion-reduce:transition-none"],control:"transition-transform-opacity motion-reduce:transition-none",label:"transition-colors motion-reduce:transition-none",description:"transition-colors motion-reduce:transition-none"}}},defaultVariants:{color:"primary",size:"md",isDisabled:!1,isInvalid:!1}}),(0,d.tv)({slots:{base:"relative flex flex-col gap-2",label:"relative text-foreground-500",wrapper:"flex flex-col flex-wrap gap-2 data-[orientation=horizontal]:flex-row",description:"text-tiny text-foreground-400",errorMessage:"text-tiny text-danger"},variants:{isRequired:{true:{label:"after:content-['*'] after:text-danger after:ml-0.5"}},isInvalid:{true:{description:"text-danger"}},disableAnimation:{true:{},false:{description:"transition-colors !duration-150 motion-reduce:transition-none"}}},defaultVariants:{isInvalid:!1,isRequired:!1}}),(0,d.tv)({slots:{base:["p-2.5","-m-2.5","overflow-x-scroll","scrollbar-hide"],wrapper:["flex","flex-nowrap","h-fit","max-w-fit","relative","gap-1","items-center","overflow-visible"],item:["tap-highlight-transparent","select-none","touch-none"],prev:"",next:"",cursor:["absolute","flex","overflow-visible","items-center","justify-center","origin-center","left-0","select-none","touch-none","pointer-events-none","z-20"],forwardIcon:["hidden","group-hover:block","group-data-[focus-visible=true]:block","data-[before=true]:rotate-180"],ellipsis:"group-hover:hidden group-data-[focus-visible=true]:hidden",chevronNext:"rotate-180"},variants:{variant:{bordered:{item:["border-medium","border-default","bg-transparent","data-[hover=true]:bg-default-100"]},light:{item:"bg-transparent"},flat:{},faded:{item:["border-medium","border-default"]}},color:{default:{cursor:r.default},primary:{cursor:r.primary},secondary:{cursor:r.secondary},success:{cursor:r.success},warning:{cursor:r.warning},danger:{cursor:r.danger}},size:{sm:{},md:{},lg:{}},radius:{none:{},sm:{},md:{},lg:{},full:{}},isCompact:{true:{wrapper:"gap-0 shadow-xs",item:["shadow-none","first-of-type:rounded-e-none","last-of-type:rounded-s-none","[&:not(:first-of-type):not(:last-of-type)]:rounded-none"],prev:"!rounded-e-none",next:"!rounded-s-none"}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},showShadow:{true:{}},disableCursorAnimation:{true:{cursor:"hidden"}},disableAnimation:{true:{item:"transition-none",cursor:"transition-none"},false:{item:["data-[pressed=true]:scale-[0.97]","transition-transform-background"],cursor:["data-[moving=true]:transition-transform","!data-[moving=true]:duration-300","opacity-0","data-[moving]:opacity-100"]}}},defaultVariants:{variant:"flat",color:"primary",size:"md",radius:"md",isCompact:!1,isDisabled:!1,showShadow:!1,disableCursorAnimation:!1},compoundVariants:[{showShadow:!0,color:"default",class:{cursor:[i.default,"shadow-md"]}},{showShadow:!0,color:"primary",class:{cursor:[i.primary,"shadow-md"]}},{showShadow:!0,color:"secondary",class:{cursor:[i.secondary,"shadow-md"]}},{showShadow:!0,color:"success",class:{cursor:[i.success,"shadow-md"]}},{showShadow:!0,color:"warning",class:{cursor:[i.warning,"shadow-md"]}},{showShadow:!0,color:"danger",class:{cursor:[i.danger,"shadow-md"]}},{isCompact:!0,variant:"bordered",class:{item:"[&:not(:first-of-type)]:ms-[calc(theme(borderWidth.2)*-1)]"}},{disableCursorAnimation:!0,color:"default",class:{item:["data-[active=true]:bg-default-400","data-[active=true]:border-default-400","data-[active=true]:text-default-foreground"]}},{disableCursorAnimation:!0,color:"primary",class:{item:["data-[active=true]:bg-primary","data-[active=true]:border-primary","data-[active=true]:text-primary-foreground"]}},{disableCursorAnimation:!0,color:"secondary",class:{item:["data-[active=true]:bg-secondary","data-[active=true]:border-secondary","data-[active=true]:text-secondary-foreground"]}},{disableCursorAnimation:!0,color:"success",class:{item:["data-[active=true]:bg-success","data-[active=true]:border-success","data-[active=true]:text-success-foreground"]}},{disableCursorAnimation:!0,color:"warning",class:{item:["data-[active=true]:bg-warning","data-[active=true]:border-warning","data-[active=true]:text-warning-foreground"]}},{disableCursorAnimation:!0,color:"danger",class:{item:["data-[active=true]:bg-danger","data-[active=true]:border-danger","data-[active=true]:text-danger-foreground"]}},{disableCursorAnimation:!0,showShadow:!0,color:"default",class:{item:["data-[active=true]:shadow-md","data-[active=true]:shadow-default/50"]}},{disableCursorAnimation:!0,showShadow:!0,color:"primary",class:{item:["data-[active=true]:shadow-md","data-[active=true]:shadow-primary/40"]}},{disableCursorAnimation:!0,showShadow:!0,color:"secondary",class:{item:["data-[active=true]:shadow-md","data-[active=true]:shadow-secondary/40"]}},{disableCursorAnimation:!0,showShadow:!0,color:"success",class:{item:["data-[active=true]:shadow-md","data-[active=true]:shadow-success/40"]}},{disableCursorAnimation:!0,showShadow:!0,color:"warning",class:{item:["data-[active=true]:shadow-md","data-[active=true]:shadow-warning/40"]}},{disableCursorAnimation:!0,showShadow:!0,color:"danger",class:{item:["data-[active=true]:shadow-md","data-[active=true]:shadow-danger/40"]}}],compoundSlots:[{slots:["item","prev","next"],class:["flex","flex-wrap","truncate","box-border","outline-solid outline-transparent","items-center","justify-center","text-default-foreground",...h,"data-[disabled=true]:text-default-300","data-[disabled=true]:pointer-events-none"]},{slots:["item","prev","next"],variant:["flat","bordered","faded"],class:["shadow-xs"]},{slots:["item","prev","next"],variant:"flat",class:["bg-default-100","[&[data-hover=true]:not([data-active=true])]:bg-default-200","active:bg-default-300"]},{slots:["item","prev","next"],variant:"faded",class:["bg-default-50","[&[data-hover=true]:not([data-active=true])]:bg-default-100","active:bg-default-200"]},{slots:["item","prev","next"],variant:"light",class:["[&[data-hover=true]:not([data-active=true])]:bg-default-100","active:bg-default-200"]},{slots:["item","cursor","prev","next"],size:"sm",class:"min-w-8 w-8 h-8 text-tiny"},{slots:["item","cursor","prev","next"],size:"md",class:"min-w-9 w-9 h-9 text-small"},{slots:["item","cursor","prev","next"],size:"lg",class:"min-w-10 w-10 h-10 text-medium"},{slots:["wrapper","item","cursor","prev","next"],radius:"none",class:"rounded-none"},{slots:["wrapper","item","cursor","prev","next"],radius:"sm",class:"rounded-small"},{slots:["wrapper","item","cursor","prev","next"],radius:"md",class:"rounded-medium"},{slots:["wrapper","item","cursor","prev","next"],radius:"lg",class:"rounded-large"},{slots:["wrapper","item","cursor","prev","next"],radius:"full",class:"rounded-full"}]}),(0,d.tv)({slots:{base:"group relative max-w-fit inline-flex items-center justify-start cursor-pointer touch-none tap-highlight-transparent select-none",wrapper:["px-1","relative","inline-flex","items-center","justify-start","shrink-0","overflow-hidden","bg-default-200","rounded-full",...p],thumb:["z-10","flex","items-center","justify-center","bg-white","shadow-small","rounded-full","origin-right","pointer-events-none"],hiddenInput:g,startContent:"z-0 absolute start-1.5 text-current",endContent:"z-0 absolute end-1.5 text-default-600",thumbIcon:"text-black",label:"relative text-foreground select-none ms-2"},variants:{color:{default:{wrapper:["group-data-[selected=true]:bg-default-400","group-data-[selected=true]:text-default-foreground"]},primary:{wrapper:["group-data-[selected=true]:bg-primary","group-data-[selected=true]:text-primary-foreground"]},secondary:{wrapper:["group-data-[selected=true]:bg-secondary","group-data-[selected=true]:text-secondary-foreground"]},success:{wrapper:["group-data-[selected=true]:bg-success","group-data-[selected=true]:text-success-foreground"]},warning:{wrapper:["group-data-[selected=true]:bg-warning","group-data-[selected=true]:text-warning-foreground"]},danger:{wrapper:["group-data-[selected=true]:bg-danger","data-[selected=true]:text-danger-foreground"]}},size:{sm:{wrapper:"w-10 h-6",thumb:["w-4 h-4 text-tiny","group-data-[selected=true]:ms-4"],endContent:"text-tiny",startContent:"text-tiny",label:"text-small"},md:{wrapper:"w-12 h-7",thumb:["w-5 h-5 text-small","group-data-[selected=true]:ms-5"],endContent:"text-small",startContent:"text-small",label:"text-medium"},lg:{wrapper:"w-14 h-8",thumb:["w-6 h-6 text-medium","group-data-[selected=true]:ms-6"],endContent:"text-medium",startContent:"text-medium",label:"text-large"}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},disableAnimation:{true:{wrapper:"transition-none",thumb:"transition-none"},false:{wrapper:"transition-background",thumb:"transition-all",startContent:["opacity-0","scale-50","transition-transform-opacity","group-data-[selected=true]:scale-100","group-data-[selected=true]:opacity-100"],endContent:["opacity-100","transition-transform-opacity","group-data-[selected=true]:translate-x-3","group-data-[selected=true]:opacity-0"]}}},defaultVariants:{color:"primary",size:"md",isDisabled:!1},compoundVariants:[{disableAnimation:!1,size:"sm",class:{thumb:["group-data-[pressed=true]:w-5","group-data-[selected]:group-data-[pressed]:ml-3"]}},{disableAnimation:!1,size:"md",class:{thumb:["group-data-[pressed=true]:w-6","group-data-[selected]:group-data-[pressed]:ml-4"]}},{disableAnimation:!1,size:"lg",class:{thumb:["group-data-[pressed=true]:w-7","group-data-[selected]:group-data-[pressed]:ml-5"]}}]})),w=(0,d.tv)({base:"px-2",variants:{variant:{light:"",shadow:"px-4 shadow-medium rounded-medium bg-content1",bordered:"px-4 border-medium border-divider rounded-medium",splitted:"flex flex-col gap-2"},fullWidth:{true:"w-full"}},defaultVariants:{variant:"light",fullWidth:!0}}),S=(0,d.tv)({slots:{base:"",heading:"",trigger:["flex py-4 w-full h-full gap-3 outline-solid outline-transparent items-center tap-highlight-transparent",...h],startContent:"shrink-0",indicator:"text-default-400",titleWrapper:"flex-1 flex flex-col text-start",title:"text-foreground text-medium",subtitle:"text-small text-foreground-500 font-normal",content:"py-2"},variants:{variant:{splitted:{base:"px-4 bg-content1 shadow-medium rounded-medium"}},isCompact:{true:{trigger:"py-2",title:"text-medium",subtitle:"text-small",indicator:"text-medium",content:"py-1"}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},hideIndicator:{true:{indicator:"hidden"}},disableAnimation:{true:{content:"hidden data-[open=true]:block"},false:{indicator:"transition-transform",trigger:"transition-opacity"}},disableIndicatorAnimation:{true:{indicator:"transition-none"},false:{indicator:"rotate-0 data-[open=true]:-rotate-90 rtl:-rotate-180 rtl:data-[open=true]:-rotate-90"}}},defaultVariants:{size:"md",radius:"lg",isDisabled:!1,hideIndicator:!1,disableIndicatorAnimation:!1}}),T=((0,d.tv)({slots:{base:["relative","flex","flex-col","w-fit"],wrapper:["group","flex items-center","has-[:disabled]:opacity-60"],input:["absolute","inset-0","border-none","outline-solid outline-transparent","bg-transparent","text-transparent"],segmentWrapper:["inline-flex","gap-x-1","py-2"],segment:["h-10","w-10","font-semibold","flex","justify-center","items-center","border-default-200","data-[active=true]:border-default-400","data-[active=true]:scale-110","shadow-xs","hover:bg-danger",...h],passwordChar:["w-1","h-1","bg-default-800","rounded-full"],caret:["animate-[appearance-in_1s_infinite]","font-extralight","h-full","w-full","flex","justify-center","items-center","text-2xl","h-[50%]","w-px","bg-foreground"],helperWrapper:["text-tiny","mt-0.5","font-extralight",""],errorMessage:["text-tiny text-danger w-full"],description:["text-tiny text-foreground-400"]},variants:{variant:{flat:{segment:["border-transparent","bg-default-100","data-[active=true]:bg-default-200"]},faded:{segment:["bg-default-100","border-medium"]},bordered:{segment:["bg-background","border-medium"]},underlined:{segment:["bg-background","shadow-none","relative","box-border","!rounded-none","border-b-medium","shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]","border-default-200","after:content-['']","after:w-0","after:origin-center","after:bg-default-foreground","after:absolute","after:left-1/2","after:-translate-x-1/2","after:-bottom-[2px]","after:h-[2px]","data-[active=true]:border-default-300","data-[active=true]:after:w-full","data-[active=true]:scale-100"]}},isDisabled:{true:{segment:"opacity-disabled pointer-events-none",input:"pointer-events-none"}},isInvalid:{true:{}},isReadOnly:{true:{caret:"bg-transparent",segment:"transition-none data-[active=true]:scale-100"}},fullWidth:{true:{base:"w-full"}},radius:{none:{segment:"rounded-none"},sm:{segment:"rounded-sm"},md:{segment:"rounded-md"},lg:{segment:"rounded-lg"},full:{segment:"rounded-full"}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{segment:"h-8 min-h-8 w-8 min-w-8 text-small"},md:{segment:"h-10 min-h-10 w-10 min-w-10 text-small"},lg:{segment:"h-12 min-h-12 w-12 min-w-12 text-medium"}},disableAnimation:{true:{segment:"transition-none",caret:"animate-none"},false:{segment:"transition duration-150"}}},defaultVariants:{variant:"flat",color:"default",radius:"md",size:"md"},compoundVariants:[{variant:"flat",color:"default",class:{segment:["bg-default-100","data-[active=true]:bg-default-200"]}},{variant:"flat",color:"primary",class:{segment:["bg-primary-100","data-[active=true]:bg-primary-200","text-primary"],caret:["bg-primary"],passwordChar:["bg-primary"]}},{variant:"flat",color:"secondary",class:{segment:["bg-secondary-100","data-[active=true]:bg-secondary-200","text-secondary"],caret:["bg-secondary"],passwordChar:["bg-secondary"]}},{variant:"flat",color:"success",class:{segment:["bg-success-100","data-[active=true]:bg-success-200","text-success"],caret:["bg-success"],passwordChar:["bg-success"]}},{variant:"flat",color:"warning",class:{segment:["bg-warning-100","data-[active=true]:bg-warning-200","text-warning"],caret:["bg-warning"],passwordChar:["bg-warning"]}},{variant:"flat",color:"danger",class:{segment:["bg-danger-100","data-[active=true]:bg-danger-200","text-danger"],caret:["bg-danger"],passwordChar:["bg-danger"]}},{variant:"faded",color:"default",class:{segment:""}},{variant:"faded",color:"primary",class:{segment:["bg-primary-100","text-primary","border-primary-200","data-[active=true]:border-primary"],caret:["bg-primary"],passwordChar:["bg-primary"]}},{variant:"faded",color:"secondary",class:{segment:["bg-secondary-100","text-secondary","border-secondary-200","data-[active=true]:border-secondary"],caret:["bg-secondary"],passwordChar:["bg-secondary"]}},{variant:"faded",color:"success",class:{segment:["bg-success-100","text-success","border-success-200","data-[active=true]:border-success"],caret:["bg-success"],passwordChar:["bg-success"]}},{variant:"faded",color:"warning",class:{segment:["bg-warning-100","text-warning","border-warning-200","data-[active=true]:border-warning"],caret:["bg-warning"],passwordChar:["bg-warning"]}},{variant:"faded",color:"danger",class:{segment:["bg-danger-100","text-danger","border-danger-200","data-[active=true]:border-danger"],caret:["bg-danger"],passwordChar:["bg-danger"]}},{variant:"bordered",color:"default",class:{segment:"data-[has-value=true]:text-default-foreground data-[active=true]:border-foreground"}},{variant:"bordered",color:"primary",class:{segment:["border-primary-200","text-primary","data-[active=true]:border-primary"],caret:["bg-primary"],passwordChar:["bg-primary"]}},{variant:"bordered",color:"secondary",class:{segment:["border-secondary-200","text-secondary","data-[active=true]:border-secondary"],caret:["bg-secondary"],passwordChar:["bg-secondary"]}},{variant:"bordered",color:"success",class:{segment:["border-success-200","text-success","data-[active=true]:border-success"],caret:["bg-success"],passwordChar:["bg-success"]}},{variant:"bordered",color:"warning",class:{segment:["border-warning-200","text-warning","data-[active=true]:border-warning"],caret:["bg-warning"],passwordChar:["bg-warning"]}},{variant:"bordered",color:"danger",class:{segment:["border-danger-200","text-danger","data-[active=true]:border-danger"],caret:["bg-danger"],passwordChar:["bg-danger"]}},{variant:"underlined",color:"default",class:{segment:"data-[has-value=true]:text-default-foreground after:bg-foreground"}},{variant:"underlined",color:"primary",class:{segment:["border-primary-200","text-primary","after:bg-primary"],caret:["bg-primary"],passwordChar:["bg-primary"]}},{variant:"underlined",color:"secondary",class:{segment:["border-secondary-200","text-secondary","after:bg-secondary"],caret:["bg-secondary"],passwordChar:["bg-secondary"]}},{variant:"underlined",color:"success",class:{segment:["border-success-200","text-success","after:bg-success"],caret:["bg-success"],passwordChar:["bg-success"]}},{variant:"underlined",color:"warning",class:{segment:["border-warning-200","text-warning","after:bg-warning"],caret:["bg-warning"],passwordChar:["bg-warning"]}},{variant:"underlined",color:"danger",class:{segment:["border-danger-200","text-danger","after:bg-danger"],caret:["bg-danger"],passwordChar:["bg-danger"]}},{variant:"flat",isInvalid:!0,class:{segment:["bg-danger-50","data-[active=true]:bg-danger-100","text-danger"],caret:["bg-danger"]}},{variant:"faded",isInvalid:!0,class:{segment:["text-danger"],caret:["bg-danger"]}},{variant:"bordered",isInvalid:!0,class:{segment:["border-danger-200","text-danger","data-[active=true]:border-danger-400"],caret:["bg-danger"]}},{variant:"underlined",isInvalid:!0,class:{segment:["border-danger-200","text-danger","data-[active=true]:after:bg-danger-400"],caret:["bg-danger"]}},{disableAnimation:!1,variant:"underlined",class:{segment:"after:transition-width motion-reduce:after:transition-none"}}]}),(0,d.tv)({slots:{base:"group flex flex-col data-[hidden=true]:hidden",label:["absolute","z-10","pointer-events-none","origin-top-left","shrink-0","rtl:origin-top-right","subpixel-antialiased","block","text-small","text-foreground-500"],mainWrapper:"h-full",inputWrapper:"relative w-full inline-flex tap-highlight-transparent flex-row items-center shadow-xs px-3 gap-3",innerWrapper:"inline-flex w-full items-center h-full box-border",input:["w-full font-normal bg-transparent !outline-solid outline-transparent placeholder:text-foreground-500 focus-visible:outline-solid outline-transparent","data-[has-start-content=true]:ps-1.5","data-[has-end-content=true]:pe-1.5","data-[type=color]:rounded-none","file:cursor-pointer file:bg-transparent file:border-0","autofill:bg-transparent bg-clip-text","dark:autofill:[-webkit-text-fill-color:hsl(var(--heroui-foreground))]","[&::-ms-reveal]:hidden"],clearButton:["p-2","-m-2","z-10","absolute","end-3","start-auto","pointer-events-none","appearance-none","outline-solid outline-transparent","select-none","opacity-0","cursor-pointer","active:!opacity-70","rounded-full",...h],helperWrapper:"hidden group-data-[has-helper=true]:flex p-1 relative flex-col gap-1.5",description:"text-tiny text-foreground-400",errorMessage:"text-tiny text-danger"},variants:{variant:{flat:{inputWrapper:["bg-default-100","data-[hover=true]:bg-default-200","group-data-[focus=true]:bg-default-100"]},faded:{inputWrapper:["bg-default-100","border-medium","border-default-200","data-[hover=true]:border-default-400 focus-within:border-default-400"],value:"group-data-[has-value=true]:text-default-foreground"},bordered:{inputWrapper:["border-medium","border-default-200","data-[hover=true]:border-default-400","group-data-[focus=true]:border-default-foreground","group-data-[focus=true]:data-[hover=true]:border-default-foreground"]},underlined:{inputWrapper:["!px-1","!pb-0","!gap-0","relative","box-border","border-b-medium","shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]","border-default-200","!rounded-none","hover:border-default-300","after:content-['']","after:w-0","after:origin-center","after:bg-default-foreground","after:absolute","after:left-1/2","after:-translate-x-1/2","after:-bottom-[2px]","after:h-[2px]","group-data-[focus=true]:after:w-full"],innerWrapper:"pb-1",label:"group-data-[filled-within=true]:text-foreground"}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{label:"text-tiny",inputWrapper:"h-8 min-h-8 px-2 rounded-small",input:"text-small",clearButton:"text-medium"},md:{inputWrapper:"h-10 min-h-10 rounded-medium",input:"text-small",clearButton:"text-large hover:!opacity-100"},lg:{label:"text-medium",inputWrapper:"h-12 min-h-12 rounded-large",input:"text-medium",clearButton:"text-large hover:!opacity-100"}},radius:{none:{inputWrapper:"rounded-none"},sm:{inputWrapper:"rounded-small"},md:{inputWrapper:"rounded-medium"},lg:{inputWrapper:"rounded-large"},full:{inputWrapper:"rounded-full"}},labelPlacement:{outside:{mainWrapper:"flex flex-col"},"outside-left":{base:"flex-row items-center flex-nowrap data-[has-helper=true]:items-start",inputWrapper:"flex-1",mainWrapper:"flex flex-col",label:"relative text-foreground pe-2 ps-2 pointer-events-auto"},"outside-top":{mainWrapper:"flex flex-col",label:"relative text-foreground pb-2 pointer-events-auto"},inside:{label:"cursor-text",inputWrapper:"flex-col items-start justify-center gap-0",innerWrapper:"group-data-[has-label=true]:items-end"}},fullWidth:{true:{base:"w-full"},false:{}},isClearable:{true:{input:"peer pe-6 input-search-cancel-button-none",clearButton:["peer-data-[filled=true]:pointer-events-auto","peer-data-[filled=true]:opacity-70 peer-data-[filled=true]:block","peer-data-[filled=true]:scale-100"]}},isDisabled:{true:{base:"opacity-disabled pointer-events-none",inputWrapper:"pointer-events-none",label:"pointer-events-none"}},isInvalid:{true:{label:"!text-danger",input:"!placeholder:text-danger !text-danger"}},isRequired:{true:{label:"after:content-['*'] after:text-danger after:ms-0.5"}},isMultiline:{true:{label:"relative",inputWrapper:"!h-auto",innerWrapper:"items-start group-data-[has-label=true]:items-start",input:"resize-none data-[hide-scroll=true]:scrollbar-hide",clearButton:"absolute top-2 right-2 rtl:right-auto rtl:left-2 z-10"}},disableAnimation:{true:{input:"transition-none",inputWrapper:"transition-none",label:"transition-none"},false:{inputWrapper:"transition-background motion-reduce:transition-none !duration-150",label:["will-change-auto","!duration-200","!ease-out","motion-reduce:transition-none","transition-[transform,color,left,opacity,translate,scale]"],clearButton:["scale-90","ease-out","duration-150","transition-[opacity,transform]","motion-reduce:transition-none","motion-reduce:scale-100"]}}},defaultVariants:{variant:"flat",color:"default",size:"md",fullWidth:!0,isDisabled:!1,isMultiline:!1},compoundVariants:[{variant:"flat",color:"default",class:{input:"group-data-[has-value=true]:text-default-foreground"}},{variant:"flat",color:"primary",class:{inputWrapper:["bg-primary-100","data-[hover=true]:bg-primary-50","text-primary","group-data-[focus=true]:bg-primary-50","placeholder:text-primary"],input:"placeholder:text-primary",label:"text-primary"}},{variant:"flat",color:"secondary",class:{inputWrapper:["bg-secondary-100","text-secondary","data-[hover=true]:bg-secondary-50","group-data-[focus=true]:bg-secondary-50","placeholder:text-secondary"],input:"placeholder:text-secondary",label:"text-secondary"}},{variant:"flat",color:"success",class:{inputWrapper:["bg-success-100","text-success-600","dark:text-success","placeholder:text-success-600","dark:placeholder:text-success","data-[hover=true]:bg-success-50","group-data-[focus=true]:bg-success-50"],input:"placeholder:text-success-600 dark:placeholder:text-success",label:"text-success-600 dark:text-success"}},{variant:"flat",color:"warning",class:{inputWrapper:["bg-warning-100","text-warning-600","dark:text-warning","placeholder:text-warning-600","dark:placeholder:text-warning","data-[hover=true]:bg-warning-50","group-data-[focus=true]:bg-warning-50"],input:"placeholder:text-warning-600 dark:placeholder:text-warning",label:"text-warning-600 dark:text-warning"}},{variant:"flat",color:"danger",class:{inputWrapper:["bg-danger-100","text-danger","dark:text-danger-500","placeholder:text-danger","dark:placeholder:text-danger-500","data-[hover=true]:bg-danger-50","group-data-[focus=true]:bg-danger-50"],input:"placeholder:text-danger dark:placeholder:text-danger-500",label:"text-danger dark:text-danger-500"}},{variant:"faded",color:"primary",class:{label:"text-primary",inputWrapper:"data-[hover=true]:border-primary focus-within:border-primary"}},{variant:"faded",color:"secondary",class:{label:"text-secondary",inputWrapper:"data-[hover=true]:border-secondary focus-within:border-secondary"}},{variant:"faded",color:"success",class:{label:"text-success",inputWrapper:"data-[hover=true]:border-success focus-within:border-success"}},{variant:"faded",color:"warning",class:{label:"text-warning",inputWrapper:"data-[hover=true]:border-warning focus-within:border-warning"}},{variant:"faded",color:"danger",class:{label:"text-danger",inputWrapper:"data-[hover=true]:border-danger focus-within:border-danger"}},{variant:"underlined",color:"default",class:{input:"group-data-[has-value=true]:text-foreground"}},{variant:"underlined",color:"primary",class:{inputWrapper:"after:bg-primary",label:"text-primary"}},{variant:"underlined",color:"secondary",class:{inputWrapper:"after:bg-secondary",label:"text-secondary"}},{variant:"underlined",color:"success",class:{inputWrapper:"after:bg-success",label:"text-success"}},{variant:"underlined",color:"warning",class:{inputWrapper:"after:bg-warning",label:"text-warning"}},{variant:"underlined",color:"danger",class:{inputWrapper:"after:bg-danger",label:"text-danger"}},{variant:"bordered",color:"primary",class:{inputWrapper:["group-data-[focus=true]:border-primary","group-data-[focus=true]:data-[hover=true]:border-primary"],label:"text-primary"}},{variant:"bordered",color:"secondary",class:{inputWrapper:["group-data-[focus=true]:border-secondary","group-data-[focus=true]:data-[hover=true]:border-secondary"],label:"text-secondary"}},{variant:"bordered",color:"success",class:{inputWrapper:["group-data-[focus=true]:border-success","group-data-[focus=true]:data-[hover=true]:border-success"],label:"text-success"}},{variant:"bordered",color:"warning",class:{inputWrapper:["group-data-[focus=true]:border-warning","group-data-[focus=true]:data-[hover=true]:border-warning"],label:"text-warning"}},{variant:"bordered",color:"danger",class:{inputWrapper:["group-data-[focus=true]:border-danger","group-data-[focus=true]:data-[hover=true]:border-danger"],label:"text-danger"}},{labelPlacement:"inside",color:"default",class:{label:"group-data-[filled-within=true]:text-default-600"}},{labelPlacement:"outside",color:"default",class:{label:"group-data-[filled-within=true]:text-foreground"}},{radius:"full",size:["sm"],class:{inputWrapper:"px-3"}},{radius:"full",size:"md",class:{inputWrapper:"px-4"}},{radius:"full",size:"lg",class:{inputWrapper:"px-5"}},{disableAnimation:!1,variant:["faded","bordered"],class:{inputWrapper:"transition-colors motion-reduce:transition-none"}},{disableAnimation:!1,variant:"underlined",class:{inputWrapper:"after:transition-width motion-reduce:after:transition-none"}},{variant:["flat","faded"],class:{inputWrapper:[...p]}},{isInvalid:!0,variant:"flat",class:{inputWrapper:["!bg-danger-50","data-[hover=true]:!bg-danger-100","group-data-[focus=true]:!bg-danger-50"]}},{isInvalid:!0,variant:"bordered",class:{inputWrapper:"!border-danger group-data-[focus=true]:!border-danger"}},{isInvalid:!0,variant:"underlined",class:{inputWrapper:"after:!bg-danger"}},{labelPlacement:"inside",size:"sm",class:{inputWrapper:"h-12 py-1.5 px-3"}},{labelPlacement:"inside",size:"md",class:{inputWrapper:"h-14 py-2"}},{labelPlacement:"inside",size:"lg",class:{inputWrapper:"h-16 py-2.5 gap-0"}},{labelPlacement:"inside",size:"sm",variant:["bordered","faded"],class:{inputWrapper:"py-1"}},{labelPlacement:["inside","outside"],class:{label:["group-data-[filled-within=true]:pointer-events-auto"]}},{labelPlacement:"outside",isMultiline:!1,class:{base:"relative justify-end",label:["pb-0","z-20","top-1/2","-translate-y-1/2","group-data-[filled-within=true]:start-0"]}},{labelPlacement:["inside"],class:{label:["group-data-[filled-within=true]:scale-85"]}},{labelPlacement:["inside"],variant:"flat",class:{innerWrapper:"pb-0.5"}},{variant:"underlined",size:"sm",class:{innerWrapper:"pb-1"}},{variant:"underlined",size:["md","lg"],class:{innerWrapper:"pb-1.5"}},{labelPlacement:"inside",size:["sm","md"],class:{label:"text-small"}},{labelPlacement:"inside",isMultiline:!1,size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_8px)]"]}},{labelPlacement:"inside",isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_6px)]"]}},{labelPlacement:"inside",isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_8px)]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_8px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_6px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_8px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_5px)]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_3.5px)]"]}},{labelPlacement:"inside",variant:"underlined",size:"lg",isMultiline:!1,class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_4px)]"]}},{labelPlacement:"outside",size:"sm",isMultiline:!1,class:{label:["start-2","text-tiny","group-data-[filled-within=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-tiny)/2_+_16px)]"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_8px)]"}},{labelPlacement:"outside",size:"md",isMultiline:!1,class:{label:["start-3","end-auto","text-small","group-data-[filled-within=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-small)/2_+_20px)]"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_10px)]"}},{labelPlacement:"outside",size:"lg",isMultiline:!1,class:{label:["start-3","end-auto","text-medium","group-data-[filled-within=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-small)/2_+_24px)]"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_12px)]"}},{labelPlacement:"outside-left",size:"sm",class:{label:"group-data-[has-helper=true]:pt-2"}},{labelPlacement:"outside-left",size:"md",class:{label:"group-data-[has-helper=true]:pt-3"}},{labelPlacement:"outside-left",size:"lg",class:{label:"group-data-[has-helper=true]:pt-4"}},{labelPlacement:["outside","outside-left"],isMultiline:!0,class:{inputWrapper:"py-2"}},{labelPlacement:"outside",isMultiline:!0,class:{label:"pb-1.5"}},{labelPlacement:"inside",isMultiline:!0,class:{label:"pb-0.5",input:"pt-0"}},{isMultiline:!0,disableAnimation:!1,class:{input:"transition-height !duration-100 motion-reduce:transition-none"}},{labelPlacement:["inside","outside"],class:{label:["pe-2","max-w-full","text-ellipsis","overflow-hidden"]}},{isMultiline:!0,radius:"full",class:{inputWrapper:"data-[has-multiple-rows=true]:rounded-large"}},{isClearable:!0,isMultiline:!0,class:{clearButton:["group-data-[has-value=true]:opacity-70 group-data-[has-value=true]:block","group-data-[has-value=true]:scale-100","group-data-[has-value=true]:pointer-events-auto"]}},{isClearable:!0,isDisabled:!0,class:{clearButton:"peer-data-[filled=true]:pointer-events-none"}}]})),C=(0,d.tv)({base:["w-full","p-1","min-w-[200px]"]}),M=((0,d.tv)({slots:{base:["flex","group","gap-2","items-center","justify-between","relative","px-2","py-1.5","w-full","h-full","box-border","rounded-small","outline-solid outline-transparent","cursor-pointer","tap-highlight-transparent","data-[pressed=true]:opacity-70",...h,"data-[focus-visible=true]:dark:ring-offset-background-content1"],wrapper:"w-full flex flex-col items-start justify-center",title:"flex-1 text-small font-normal truncate",description:["w-full","text-tiny","text-foreground-500","group-hover:text-current"],selectedIcon:["text-inherit","w-3","h-3","shrink-0"],shortcut:["px-1","py-0.5","rounded-sm","font-sans","text-foreground-500","text-tiny","border-small","border-default-300","group-hover:border-current"]},variants:{variant:{solid:{base:""},bordered:{base:"border-medium border-transparent bg-transparent"},light:{base:"bg-transparent"},faded:{base:"border-small border-transparent hover:border-default data-[hover=true]:bg-default-100"},flat:{base:""},shadow:{base:"data-[hover=true]:shadow-lg"}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},disableAnimation:{true:{},false:{}}},defaultVariants:{variant:"solid",color:"default"},compoundVariants:[{variant:"solid",color:"default",class:{base:"data-[hover=true]:bg-default data-[hover=true]:text-default-foreground"}},{variant:"solid",color:"primary",class:{base:"data-[hover=true]:bg-primary data-[hover=true]:text-primary-foreground"}},{variant:"solid",color:"secondary",class:{base:"data-[hover=true]:bg-secondary data-[hover=true]:text-secondary-foreground"}},{variant:"solid",color:"success",class:{base:"data-[hover=true]:bg-success data-[hover=true]:text-success-foreground"}},{variant:"solid",color:"warning",class:{base:"data-[hover=true]:bg-warning data-[hover=true]:text-warning-foreground"}},{variant:"solid",color:"danger",class:{base:"data-[hover=true]:bg-danger data-[hover=true]:text-danger-foreground"}},{variant:"shadow",color:"default",class:{base:"data-[hover=true]:shadow-default/50 data-[hover=true]:bg-default data-[hover=true]:text-default-foreground"}},{variant:"shadow",color:"primary",class:{base:"data-[hover=true]:shadow-primary/30 data-[hover=true]:bg-primary data-[hover=true]:text-primary-foreground"}},{variant:"shadow",color:"secondary",class:{base:"data-[hover=true]:shadow-secondary/30 data-[hover=true]:bg-secondary data-[hover=true]:text-secondary-foreground"}},{variant:"shadow",color:"success",class:{base:"data-[hover=true]:shadow-success/30 data-[hover=true]:bg-success data-[hover=true]:text-success-foreground"}},{variant:"shadow",color:"warning",class:{base:"data-[hover=true]:shadow-warning/30 data-[hover=true]:bg-warning data-[hover=true]:text-warning-foreground"}},{variant:"shadow",color:"danger",class:{base:"data-[hover=true]:shadow-danger/30 data-[hover=true]:bg-danger data-[hover=true]:text-danger-foreground"}},{variant:"bordered",color:"default",class:{base:"data-[hover=true]:border-default"}},{variant:"bordered",color:"primary",class:{base:"data-[hover=true]:border-primary data-[hover=true]:text-primary"}},{variant:"bordered",color:"secondary",class:{base:"data-[hover=true]:border-secondary data-[hover=true]:text-secondary"}},{variant:"bordered",color:"success",class:{base:"data-[hover=true]:border-success data-[hover=true]:text-success"}},{variant:"bordered",color:"warning",class:{base:"data-[hover=true]:border-warning data-[hover=true]:text-warning"}},{variant:"bordered",color:"danger",class:{base:"data-[hover=true]:border-danger data-[hover=true]:text-danger"}},{variant:"flat",color:"default",class:{base:"data-[hover=true]:bg-default/40 data-[hover=true]:text-default-foreground"}},{variant:"flat",color:"primary",class:{base:"data-[hover=true]:bg-primary/20 data-[hover=true]:text-primary"}},{variant:"flat",color:"secondary",class:{base:"data-[hover=true]:bg-secondary/20 data-[hover=true]:text-secondary"}},{variant:"flat",color:"success",class:{base:"data-[hover=true]:bg-success/20 data-[hover=true]:text-success "}},{variant:"flat",color:"warning",class:{base:"data-[hover=true]:bg-warning/20 data-[hover=true]:text-warning"}},{variant:"flat",color:"danger",class:{base:"data-[hover=true]:bg-danger/20 data-[hover=true]:text-danger"}},{variant:"faded",color:"default",class:{base:"data-[hover=true]:text-default-foreground"}},{variant:"faded",color:"primary",class:{base:"data-[hover=true]:text-primary"}},{variant:"faded",color:"secondary",class:{base:"data-[hover=true]:text-secondary"}},{variant:"faded",color:"success",class:{base:"data-[hover=true]:text-success"}},{variant:"faded",color:"warning",class:{base:"data-[hover=true]:text-warning"}},{variant:"faded",color:"danger",class:{base:"data-[hover=true]:text-danger"}},{variant:"light",color:"default",class:{base:"data-[hover=true]:text-default-500"}},{variant:"light",color:"primary",class:{base:"data-[hover=true]:text-primary"}},{variant:"light",color:"secondary",class:{base:"data-[hover=true]:text-secondary"}},{variant:"light",color:"success",class:{base:"data-[hover=true]:text-success"}},{variant:"light",color:"warning",class:{base:"data-[hover=true]:text-warning"}},{variant:"light",color:"danger",class:{base:"data-[hover=true]:text-danger"}}]}),(0,d.tv)({slots:{base:"relative mb-2",heading:"pl-1 text-tiny text-foreground-500",group:"data-[has-title=true]:pt-1",divider:"mt-2"}}),(0,d.tv)({base:"w-full flex flex-col gap-0.5 p-1"}),(0,d.tv)({slots:{wrapper:["flex","w-screen","h-[100dvh]","fixed","inset-0","z-50","overflow-x-auto","justify-center","h-(--visual-viewport-height)"],base:["flex","flex-col","relative","bg-white","z-50","w-full","box-border","bg-content1","outline-solid outline-transparent","mx-1","my-1","sm:mx-6","sm:my-16"],backdrop:"z-50",header:"flex py-4 px-6 flex-initial text-large font-semibold",body:"flex flex-1 flex-col gap-3 px-6 py-2",footer:"flex flex-row gap-2 px-6 py-4 justify-end",closeButton:["absolute","appearance-none","outline-solid outline-transparent","select-none","top-1","end-1","p-2","text-foreground-500","rounded-full","hover:bg-default-100","active:bg-default-200","tap-highlight-transparent",...h]},variants:{size:{xs:{base:"max-w-xs"},sm:{base:"max-w-sm"},md:{base:"max-w-md"},lg:{base:"max-w-lg"},xl:{base:"max-w-xl"},"2xl":{base:"max-w-2xl"},"3xl":{base:"max-w-3xl"},"4xl":{base:"max-w-4xl"},"5xl":{base:"max-w-5xl"},full:{base:"my-0 mx-0 sm:mx-0 sm:my-0 max-w-full h-[100dvh] min-h-[100dvh] !rounded-none"}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"}},placement:{auto:{wrapper:"items-end sm:items-center"},center:{wrapper:"items-center sm:items-center"},top:{wrapper:"items-start sm:items-start"},"top-center":{wrapper:"items-start sm:items-center"},bottom:{wrapper:"items-end sm:items-end"},"bottom-center":{wrapper:"items-end sm:items-center"}},shadow:{none:{base:"shadow-none"},sm:{base:"shadow-small"},md:{base:"shadow-medium"},lg:{base:"shadow-large"}},backdrop:{transparent:{backdrop:"hidden"},opaque:{backdrop:"bg-overlay/50 backdrop-opacity-disabled"},blur:{backdrop:"backdrop-blur-md backdrop-saturate-150 bg-overlay/30"}},scrollBehavior:{normal:{base:"overflow-y-hidden"},inside:{base:"max-h-[calc(100%_-_8rem)]",body:"overflow-y-auto"},outside:{wrapper:"items-start sm:items-start overflow-y-auto",base:"my-16"}},disableAnimation:{false:{wrapper:["[--scale-enter:100%]","[--scale-exit:100%]","[--slide-enter:0px]","[--slide-exit:80px]","sm:[--scale-enter:100%]","sm:[--scale-exit:103%]","sm:[--slide-enter:0px]","sm:[--slide-exit:0px]"]}}},defaultVariants:{size:"md",radius:"lg",shadow:"sm",placement:"auto",backdrop:"opaque",scrollBehavior:"normal"},compoundVariants:[{backdrop:["opaque","blur"],class:{backdrop:"w-screen h-screen fixed inset-0"}}]})),E=((0,d.tv)({slots:{base:["flex","z-40","w-full","h-auto","items-center","justify-center","data-[menu-open=true]:border-none"],wrapper:["z-40","flex","px-6","gap-4","w-full","flex-row","relative","flex-nowrap","items-center","justify-between","h-[var(--navbar-height)]"],toggle:["group","flex","items-center","justify-center","w-6","h-full","outline-solid outline-transparent","rounded-small","tap-highlight-transparent",...h],srOnly:["sr-only"],toggleIcon:["w-full","h-full","pointer-events-none","flex","flex-col","items-center","justify-center","text-inherit","group-data-[pressed=true]:opacity-70","transition-opacity","before:content-['']","before:block","before:h-px","before:w-6","before:bg-current","before:transition-transform","before:duration-150","before:-translate-y-1","before:rotate-0","group-data-[open=true]:before:translate-y-px","group-data-[open=true]:before:rotate-45","after:content-['']","after:block","after:h-px","after:w-6","after:bg-current","after:transition-transform","after:duration-150","after:translate-y-1","after:rotate-0","group-data-[open=true]:after:translate-y-0","group-data-[open=true]:after:-rotate-45"],brand:["flex","basis-0","flex-row","flex-grow","flex-nowrap","justify-start","bg-transparent","items-center","no-underline","text-medium","whitespace-nowrap","box-border"],content:["flex","gap-4","h-full","flex-row","flex-nowrap","items-center","data-[justify=start]:justify-start","data-[justify=start]:flex-grow","data-[justify=start]:basis-0","data-[justify=center]:justify-center","data-[justify=end]:justify-end","data-[justify=end]:flex-grow","data-[justify=end]:basis-0"],item:["text-medium","whitespace-nowrap","box-border","list-none","data-[active=true]:font-semibold"],menu:["z-30","px-6","pt-2","fixed","flex","max-w-full","top-[var(--navbar-height)]","inset-x-0","bottom-0","w-screen","flex-col","gap-2","overflow-y-auto"],menuItem:["text-large","data-[active=true]:font-semibold"]},variants:{position:{static:{base:"static"},sticky:{base:"sticky top-0 inset-x-0"}},maxWidth:{sm:{wrapper:"max-w-[640px]"},md:{wrapper:"max-w-[768px]"},lg:{wrapper:"max-w-[1024px]"},xl:{wrapper:"max-w-[1280px]"},"2xl":{wrapper:"max-w-[1536px]"},full:{wrapper:"max-w-full"}},hideOnScroll:{true:{base:["sticky","top-0","inset-x-0"]}},isBordered:{true:{base:["border-b","border-divider"]}},isBlurred:{false:{base:"bg-background",menu:"bg-background"},true:{base:["backdrop-blur-lg","data-[menu-open=true]:backdrop-blur-xl","backdrop-saturate-150","bg-background/70"],menu:["backdrop-blur-xl","backdrop-saturate-150","bg-background/70"]}},disableAnimation:{true:{menu:["hidden","h-[calc(100dvh_-_var(--navbar-height))]","data-[open=true]:flex"]}}},defaultVariants:{maxWidth:"lg",position:"sticky",isBlurred:!0}}),(0,d.tv)({slots:{base:"flex flex-col relative gap-4",wrapper:["p-4","z-0","flex","flex-col","relative","justify-between","gap-4","shadow-small","bg-content1","overflow-auto"],table:"min-w-full h-auto",thead:"[&>tr]:first:rounded-lg after:content-[''] after:table-row after:h-[5px]",tbody:"after:block",tr:["group/tr","outline-solid outline-transparent",...h],th:["group/th","px-3","h-10","text-start","align-middle","bg-default-100","whitespace-nowrap","text-foreground-500","text-tiny","font-semibold","first:rounded-s-lg","last:rounded-e-lg","outline-solid outline-transparent","data-[sortable=true]:cursor-pointer","data-[hover=true]:text-foreground-400",...h],td:["py-2","px-3","relative","align-middle","whitespace-normal","text-small","font-normal","outline-solid outline-transparent","[&>*]:z-1","[&>*]:relative",...h,"before:pointer-events-none","before:content-['']","before:absolute","before:z-0","before:inset-0","before:opacity-0","data-[selected=true]:before:opacity-100","group-data-[disabled=true]/tr:text-foreground-300","group-data-[disabled=true]/tr:cursor-not-allowed"],tfoot:"",sortIcon:["ms-2","mb-px","opacity-0","text-inherit","inline-block","transition-transform-opacity","data-[visible=true]:opacity-100","group-data-[hover=true]/th:opacity-100","data-[direction=ascending]:rotate-180"],emptyWrapper:"text-foreground-400 align-middle text-center h-40",loadingWrapper:"absolute inset-0 flex items-center justify-center"},variants:{color:{default:{td:"before:bg-default/60 data-[selected=true]:text-default-foreground"},primary:{td:"before:bg-primary/20 data-[selected=true]:text-primary"},secondary:{td:"before:bg-secondary/20 data-[selected=true]:text-secondary"},success:{td:"before:bg-success/20 data-[selected=true]:text-success-600 dark:data-[selected=true]:text-success"},warning:{td:"before:bg-warning/20 data-[selected=true]:text-warning-600 dark:data-[selected=true]:text-warning"},danger:{td:"before:bg-danger/20 data-[selected=true]:text-danger dark:data-[selected=true]:text-danger-500"}},layout:{auto:{table:"table-auto"},fixed:{table:"table-fixed"}},shadow:{none:{wrapper:"shadow-none"},sm:{wrapper:"shadow-small"},md:{wrapper:"shadow-medium"},lg:{wrapper:"shadow-large"}},hideHeader:{true:{thead:"hidden"}},isStriped:{true:{td:["group-data-[odd=true]/tr:before:bg-default-100","group-data-[odd=true]/tr:before:opacity-100","group-data-[odd=true]/tr:before:-z-10"]}},isCompact:{true:{td:"py-1"},false:{}},isHeaderSticky:{true:{thead:"sticky top-0 z-20 [&>tr]:first:shadow-small"}},isSelectable:{true:{tr:"cursor-default",td:["group-aria-[selected=false]/tr:group-data-[hover=true]/tr:before:bg-default-100","group-aria-[selected=false]/tr:group-data-[hover=true]/tr:before:opacity-70"]}},isMultiSelectable:{true:{td:["group-data-[first=true]/tr:first:before:rounded-ss-lg","group-data-[first=true]/tr:last:before:rounded-se-lg","group-data-[middle=true]/tr:before:rounded-none","group-data-[last=true]/tr:first:before:rounded-es-lg","group-data-[last=true]/tr:last:before:rounded-ee-lg"]},false:{td:["first:before:rounded-s-lg","last:before:rounded-e-lg"]}},radius:{none:{wrapper:"rounded-none",th:["first:rounded-s-none","first:before:rounded-s-none","last:rounded-e-none","last:before:rounded-e-none"],td:["first:before:rounded-s-none","last:before:rounded-e-none","group-data-[first=true]/tr:first:before:rounded-ss-none","group-data-[first=true]/tr:last:before:rounded-se-none","group-data-[last=true]/tr:first:before:rounded-es-none","group-data-[last=true]/tr:last:before:rounded-ee-none"]},sm:{wrapper:"rounded-small"},md:{wrapper:"rounded-medium"},lg:{wrapper:"rounded-large"}},fullWidth:{true:{base:"w-full",wrapper:"w-full",table:"w-full"}},align:{start:{th:"text-start",td:"text-start"},center:{th:"text-center",td:"text-center"},end:{th:"text-end",td:"text-end"}}},defaultVariants:{layout:"auto",shadow:"sm",radius:"lg",color:"default",isCompact:!1,hideHeader:!1,isStriped:!1,fullWidth:!0,align:"start"},compoundVariants:[{isStriped:!0,color:"default",class:{td:"group-data-[odd=true]/tr:data-[selected=true]/tr:before:bg-default/60"}},{isStriped:!0,color:"primary",class:{td:"group-data-[odd=true]/tr:data-[selected=true]/tr:before:bg-primary/20"}},{isStriped:!0,color:"secondary",class:{td:"group-data-[odd=true]/tr:data-[selected=true]/tr:before:bg-secondary/20"}},{isStriped:!0,color:"success",class:{td:"group-data-[odd=true]/tr:data-[selected=true]/tr:before:bg-success/20"}},{isStriped:!0,color:"warning",class:{td:"group-data-[odd=true]/tr:data-[selected=true]/tr:before:bg-warning/20"}},{isStriped:!0,color:"danger",class:{td:"group-data-[odd=true]/tr:data-[selected=true]/tr:before:bg-danger/20"}}]}),(0,d.tv)({slots:{base:"inline-flex",tabList:["relative","flex","p-1","h-fit","gap-2","items-center","flex-nowrap","overflow-x-scroll","scrollbar-hide","bg-default-100"],tab:["z-0","w-full","px-3","py-1","flex","group","relative","justify-center","items-center","outline-solid outline-transparent","cursor-pointer","transition-opacity","tap-highlight-transparent","data-[disabled=true]:cursor-not-allowed","data-[disabled=true]:opacity-30","data-[hover-unselected=true]:opacity-disabled",...h],tabContent:["relative","z-10","text-inherit","whitespace-nowrap","transition-colors","text-default-500","group-data-[selected=true]:text-foreground"],cursor:["absolute","z-0","bg-white","will-change-[transform,width,height]","invisible","data-[initialized=true]:visible","data-[animated=true]:transition-[left,top,width,height]","data-[animated=true]:duration-250","data-[animated=true]:ease-out"],panel:["py-3","px-1","outline-solid outline-transparent","data-[inert=true]:hidden",...h],tabWrapper:[]},variants:{variant:{solid:{},light:{tabList:"bg-transparent dark:bg-transparent"},underlined:{tabList:"bg-transparent dark:bg-transparent",cursor:"h-[2px] w-[80%] bottom-0 shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]"},bordered:{tabList:"bg-transparent dark:bg-transparent border-medium border-default-200 shadow-xs"}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{tabList:"rounded-medium",tab:"h-7 text-tiny rounded-small",cursor:"rounded-small"},md:{tabList:"rounded-medium",tab:"h-8 text-small rounded-small",cursor:"rounded-small"},lg:{tabList:"rounded-large",tab:"h-9 text-medium rounded-medium",cursor:"rounded-medium"}},radius:{none:{tabList:"rounded-none",tab:"rounded-none",cursor:"rounded-none"},sm:{tabList:"rounded-medium",tab:"rounded-small",cursor:"rounded-small"},md:{tabList:"rounded-medium",tab:"rounded-small",cursor:"rounded-small"},lg:{tabList:"rounded-large",tab:"rounded-medium",cursor:"rounded-medium"},full:{tabList:"rounded-full",tab:"rounded-full",cursor:"rounded-full"}},fullWidth:{true:{base:"w-full",tabList:"w-full"}},isDisabled:{true:{tabList:"opacity-disabled pointer-events-none"}},disableAnimation:{true:{tab:"transition-none",tabContent:"transition-none"}},placement:{top:{},start:{tabList:"flex-col",panel:"py-0 px-3",tabWrapper:"flex"},end:{tabList:"flex-col",panel:"py-0 px-3",tabWrapper:"flex flex-row-reverse"},bottom:{tabWrapper:"flex flex-col-reverse"}}},defaultVariants:{color:"default",variant:"solid",size:"md",fullWidth:!1,isDisabled:!1},compoundVariants:[{variant:["solid","bordered","light"],color:"default",class:{cursor:["bg-background","dark:bg-default","shadow-small"],tabContent:"group-data-[selected=true]:text-default-foreground"}},{variant:["solid","bordered","light"],color:"primary",class:{cursor:r.primary,tabContent:"group-data-[selected=true]:text-primary-foreground"}},{variant:["solid","bordered","light"],color:"secondary",class:{cursor:r.secondary,tabContent:"group-data-[selected=true]:text-secondary-foreground"}},{variant:["solid","bordered","light"],color:"success",class:{cursor:r.success,tabContent:"group-data-[selected=true]:text-success-foreground"}},{variant:["solid","bordered","light"],color:"warning",class:{cursor:r.warning,tabContent:"group-data-[selected=true]:text-warning-foreground"}},{variant:["solid","bordered","light"],color:"danger",class:{cursor:r.danger,tabContent:"group-data-[selected=true]:text-danger-foreground"}},{variant:"underlined",color:"default",class:{cursor:"bg-foreground",tabContent:"group-data-[selected=true]:text-foreground"}},{variant:"underlined",color:"primary",class:{cursor:"bg-primary",tabContent:"group-data-[selected=true]:text-primary"}},{variant:"underlined",color:"secondary",class:{cursor:"bg-secondary",tabContent:"group-data-[selected=true]:text-secondary"}},{variant:"underlined",color:"success",class:{cursor:"bg-success",tabContent:"group-data-[selected=true]:text-success"}},{variant:"underlined",color:"warning",class:{cursor:"bg-warning",tabContent:"group-data-[selected=true]:text-warning"}},{variant:"underlined",color:"danger",class:{cursor:"bg-danger",tabContent:"group-data-[selected=true]:text-danger"}},{disableAnimation:!0,variant:"underlined",class:{tab:["after:content-['']","after:absolute","after:bottom-0","after:h-[2px]","after:w-[80%]","after:opacity-0","after:shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]","data-[selected=true]:after:opacity-100"]}},{disableAnimation:!0,color:"default",variant:["solid","bordered","light"],class:{tab:"data-[selected=true]:bg-default data-[selected=true]:text-default-foreground"}},{disableAnimation:!0,color:"primary",variant:["solid","bordered","light"],class:{tab:"data-[selected=true]:bg-primary data-[selected=true]:text-primary-foreground"}},{disableAnimation:!0,color:"secondary",variant:["solid","bordered","light"],class:{tab:"data-[selected=true]:bg-secondary data-[selected=true]:text-secondary-foreground"}},{disableAnimation:!0,color:"success",variant:["solid","bordered","light"],class:{tab:"data-[selected=true]:bg-success data-[selected=true]:text-success-foreground"}},{disableAnimation:!0,color:"warning",variant:["solid","bordered","light"],class:{tab:"data-[selected=true]:bg-warning data-[selected=true]:text-warning-foreground"}},{disableAnimation:!0,color:"danger",variant:["solid","bordered","light"],class:{tab:"data-[selected=true]:bg-danger data-[selected=true]:text-danger-foreground"}},{disableAnimation:!0,color:"default",variant:"underlined",class:{tab:"data-[selected=true]:after:bg-foreground"}},{disableAnimation:!0,color:"primary",variant:"underlined",class:{tab:"data-[selected=true]:after:bg-primary"}},{disableAnimation:!0,color:"secondary",variant:"underlined",class:{tab:"data-[selected=true]:after:bg-secondary"}},{disableAnimation:!0,color:"success",variant:"underlined",class:{tab:"data-[selected=true]:after:bg-success"}},{disableAnimation:!0,color:"warning",variant:"underlined",class:{tab:"data-[selected=true]:after:bg-warning"}},{disableAnimation:!0,color:"danger",variant:"underlined",class:{tab:"data-[selected=true]:after:bg-danger"}}],compoundSlots:[{variant:"underlined",slots:["tab","tabList","cursor"],class:["rounded-none"]}]})),P=(0,d.tv)({slots:{base:["group inline-flex flex-col relative"],label:["block","absolute","z-10","origin-top-left","flex-shrink-0","rtl:origin-top-right","subpixel-antialiased","text-small","text-foreground-500","pointer-events-none","group-data-[has-label-outside=true]:pointer-events-auto"],mainWrapper:"w-full flex flex-col",trigger:"relative px-3 gap-3 w-full inline-flex flex-row items-center shadow-xs outline-solid outline-transparent tap-highlight-transparent",innerWrapper:"inline-flex h-fit w-[calc(100%_-theme(spacing.6))] min-h-4 items-center gap-1.5 box-border",selectorIcon:"absolute end-3 w-4 h-4",spinner:"absolute end-3",value:["text-foreground-500","font-normal","w-full","text-start"],listboxWrapper:"scroll-py-6 w-full",listbox:"",popoverContent:"w-full p-1 overflow-hidden",clearButton:["w-4","h-4","z-10","mb-4","relative","start-auto","appearance-none","outline-none","select-none","opacity-70","hover:!opacity-100","cursor-pointer","active:!opacity-70","rounded-full",...h],helperWrapper:"p-1 flex relative flex-col gap-1.5 group-data-[has-helper=true]:flex",description:"text-tiny text-foreground-400",errorMessage:"text-tiny text-danger",endWrapper:"flex end-18",endContent:"mb-4"},variants:{variant:{flat:{trigger:["bg-default-100","data-[hover=true]:bg-default-200","group-data-[focus=true]:bg-default-200"],clearButton:"mb-4"},faded:{trigger:["bg-default-100","border-medium","border-default-200","data-[hover=true]:border-default-400 data-[focus=true]:border-default-400 data-[open=true]:border-default-400"],value:"group-data-[has-value=true]:text-default-foreground",clearButton:"mb-4"},bordered:{trigger:["border-medium","border-default-200","data-[hover=true]:border-default-400","data-[open=true]:border-default-foreground","data-[focus=true]:border-default-foreground","data-[focus=true]:data-[hover=true]:border-default-foreground"],value:"group-data-[has-value=true]:text-default-foreground",clearButton:"mb-4"},underlined:{trigger:["!px-1","!pb-0","!gap-0","relative","box-border","border-b-medium","shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]","border-default-200","!rounded-none","hover:border-default-300","after:content-['']","after:w-0","after:origin-center","after:bg-default-foreground","after:absolute","after:left-1/2","after:-translate-x-1/2","after:-bottom-[2px]","after:h-[2px]","data-[open=true]:after:w-full","data-[focus=true]:after:w-full"],value:"group-data-[has-value=true]:text-default-foreground",clearButton:"mb-4 me-2"}},color:{default:{},primary:{selectorIcon:"text-primary"},secondary:{selectorIcon:"text-secondary"},success:{selectorIcon:"text-success"},warning:{selectorIcon:"text-warning"},danger:{selectorIcon:"text-danger"}},size:{sm:{label:"text-tiny",trigger:"h-8 min-h-8 px-2 rounded-small",value:"text-small",clearButton:"text-medium"},md:{trigger:"h-10 min-h-10 rounded-medium",value:"text-small",clearButton:"text-large"},lg:{trigger:"h-12 min-h-12 rounded-large",value:"text-medium",clearButton:"mb-5 text-large"}},radius:{none:{trigger:"rounded-none"},sm:{trigger:"rounded-small"},md:{trigger:"rounded-medium"},lg:{trigger:"rounded-large"},full:{trigger:"rounded-full"}},labelPlacement:{outside:{base:"flex flex-col",clearButton:"mb-0"},"outside-left":{base:"flex-row items-center flex-nowrap data-[has-helper=true]:items-start",label:"relative pe-2 text-foreground",clearButton:"mb-0"},"outside-top":{base:"flex flex-col",label:"relative text-foreground pb-2 pointer-events-auto",clearButton:"mb-0"},inside:{label:"text-tiny cursor-pointer",trigger:"flex-col items-start justify-center gap-0"}},fullWidth:{true:{base:"w-full"},false:{base:"min-w-40"}},isClearable:{true:{clearButton:"peer-data-[filled=true]:opacity-70 peer-data-[filled=true]:block",endContent:"ms-3"}},isDisabled:{true:{base:"opacity-disabled pointer-events-none",trigger:"pointer-events-none"}},isInvalid:{true:{label:"!text-danger",value:"!text-danger",selectorIcon:"text-danger"}},isRequired:{true:{label:"after:content-['*'] after:text-danger after:ms-0.5"}},isMultiline:{true:{label:"relative",trigger:"!h-auto"},false:{value:"truncate"}},disableAnimation:{true:{trigger:"after:transition-none",base:"transition-none",label:"transition-none",selectorIcon:"transition-none"},false:{base:"transition-background motion-reduce:transition-none !duration-150",label:["will-change-auto","origin-top-left","rtl:origin-top-right","!duration-200","!ease-out","transition-[transform,color,left,opacity,translate,scale]","motion-reduce:transition-none"],selectorIcon:"transition-transform duration-150 ease motion-reduce:transition-none",clearButton:["transition-opacity","motion-reduce:transition-none"]}},disableSelectorIconRotation:{true:{},false:{selectorIcon:"data-[open=true]:rotate-180"}}},defaultVariants:{variant:"flat",color:"default",size:"md",fullWidth:!0,isDisabled:!1,isMultiline:!1,disableSelectorIconRotation:!1},compoundVariants:[{variant:"flat",color:"default",class:{value:"group-data-[has-value=true]:text-default-foreground",trigger:["bg-default-100","data-[hover=true]:bg-default-200"]}},{variant:"flat",color:"primary",class:{trigger:["bg-primary-100","text-primary","data-[hover=true]:bg-primary-50","group-data-[focus=true]:bg-primary-50"],value:"text-primary",label:"text-primary"}},{variant:"flat",color:"secondary",class:{trigger:["bg-secondary-100","text-secondary","data-[hover=true]:bg-secondary-50","group-data-[focus=true]:bg-secondary-50"],value:"text-secondary",label:"text-secondary"}},{variant:"flat",color:"success",class:{trigger:["bg-success-100","text-success-600","dark:text-success","data-[hover=true]:bg-success-50","group-data-[focus=true]:bg-success-50"],value:"text-success-600 dark:text-success",label:"text-success-600 dark:text-success"}},{variant:"flat",color:"warning",class:{trigger:["bg-warning-100","text-warning-600","dark:text-warning","data-[hover=true]:bg-warning-50","group-data-[focus=true]:bg-warning-50"],value:"text-warning-600 dark:text-warning",label:"text-warning-600 dark:text-warning"}},{variant:"flat",color:"danger",class:{trigger:["bg-danger-100","text-danger","dark:text-danger-500","data-[hover=true]:bg-danger-50","group-data-[focus=true]:bg-danger-50"],value:"text-danger dark:text-danger-500",label:"text-danger dark:text-danger-500"}},{variant:"faded",color:"primary",class:{trigger:"data-[hover=true]:border-primary data-[focus=true]:border-primary data-[open=true]:border-primary",label:"text-primary"}},{variant:"faded",color:"secondary",class:{trigger:"data-[hover=true]:border-secondary data-[focus=true]:border-secondary data-[open=true]:border-secondary",label:"text-secondary"}},{variant:"faded",color:"success",class:{trigger:"data-[hover=true]:border-success data-[focus=true]:border-success data-[open=true]:border-success",label:"text-success"}},{variant:"faded",color:"warning",class:{trigger:"data-[hover=true]:border-warning data-[focus=true]:border-warning data-[open=true]:border-warning",label:"text-warning"}},{variant:"faded",color:"danger",class:{trigger:"data-[hover=true]:border-danger data-[focus=true]:border-danger data-[open=true]:border-danger",label:"text-danger"}},{variant:"underlined",color:"default",class:{value:"group-data-[has-value=true]:text-foreground"}},{variant:"underlined",color:"primary",class:{trigger:"after:bg-primary",label:"text-primary"}},{variant:"underlined",color:"secondary",class:{trigger:"after:bg-secondary",label:"text-secondary"}},{variant:"underlined",color:"success",class:{trigger:"after:bg-success",label:"text-success"}},{variant:"underlined",color:"warning",class:{trigger:"after:bg-warning",label:"text-warning"}},{variant:"underlined",color:"danger",class:{trigger:"after:bg-danger",label:"text-danger"}},{variant:"bordered",color:"primary",class:{trigger:["data-[open=true]:border-primary","data-[focus=true]:border-primary","data-[focus=true]:data-[hover=true]:border-primary"],label:"text-primary"}},{variant:"bordered",color:"secondary",class:{trigger:["data-[open=true]:border-secondary","data-[focus=true]:border-secondary","data-[focus=true]:data-[hover=true]:border-secondary"],label:"text-secondary"}},{variant:"bordered",color:"success",class:{trigger:["data-[open=true]:border-success","data-[focus=true]:border-success","data-[focus=true]:data-[hover=true]:border-success"],label:"text-success"}},{variant:"bordered",color:"warning",class:{trigger:["data-[open=true]:border-warning","data-[focus=true]:border-warning","data-[focus=true]:data-[hover=true]:border-warning"],label:"text-warning"}},{variant:"bordered",color:"danger",class:{trigger:["data-[open=true]:border-danger","data-[focus=true]:border-danger","data-[focus=true]:data-[hover=true]:border-danger"],label:"text-danger"}},{labelPlacement:"inside",color:"default",class:{label:"group-data-[filled=true]:text-default-600"}},{labelPlacement:"outside",color:"default",class:{label:"group-data-[filled=true]:text-foreground"}},{radius:"full",size:["sm"],class:{trigger:"px-3"}},{radius:"full",size:"md",class:{trigger:"px-4"}},{radius:"full",size:"lg",class:{trigger:"px-5"}},{disableAnimation:!1,variant:["faded","bordered"],class:{trigger:"transition-colors motion-reduce:transition-none"}},{disableAnimation:!1,variant:"underlined",class:{trigger:"after:transition-width motion-reduce:after:transition-none"}},{variant:["flat","faded"],class:{trigger:[...h]}},{isInvalid:!0,variant:"flat",class:{trigger:["bg-danger-50","data-[hover=true]:bg-danger-100","group-data-[focus=true]:bg-danger-50"]}},{isInvalid:!0,variant:"bordered",class:{trigger:"!border-danger group-data-[focus=true]:border-danger"}},{isInvalid:!0,variant:"underlined",class:{trigger:"after:bg-danger"}},{labelPlacement:"inside",size:"sm",class:{trigger:"h-12 min-h-12 py-1.5 px-3"}},{labelPlacement:"inside",size:"md",class:{trigger:"h-14 min-h-14 py-2"}},{labelPlacement:"inside",size:"lg",class:{label:"text-medium",trigger:"h-16 min-h-16 py-2.5 gap-0"}},{labelPlacement:"outside",isMultiline:!1,class:{base:"group relative justify-end",label:["pb-0","z-20","top-1/2","-translate-y-1/2","group-data-[filled=true]:start-0"]}},{labelPlacement:["inside"],class:{label:"group-data-[filled=true]:scale-85"}},{labelPlacement:"inside",size:["sm","md"],class:{label:"text-small"}},{labelPlacement:"inside",isMultiline:!1,size:"sm",class:{label:["group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_8px)]"],innerWrapper:"group-data-[has-label=true]:pt-4"}},{labelPlacement:"inside",isMultiline:!1,size:"md",class:{label:["group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_6px)]"],innerWrapper:"group-data-[has-label=true]:pt-4"}},{labelPlacement:"inside",isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_8px)]"],innerWrapper:"group-data-[has-label=true]:pt-5"}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"sm",class:{label:["group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_8px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"md",class:{label:["group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_6px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_8px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"sm",class:{label:["group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_5px)]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"md",class:{label:["group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_3.5px)]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_4px)]"]}},{labelPlacement:"outside",size:"sm",isMultiline:!1,class:{label:["start-2","text-tiny","group-data-[filled=true]:-translate-y-[calc(100%_+var(--heroui-font-size-tiny)/2_+_16px)]","group-data-[has-helper=true]:-translate-y-0","group-data-[has-helper=true]:relative","group-data-[has-helper=true]:pe-2","group-data-[has-helper=true]:pb-1.5"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_8px)]"}},{labelPlacement:"outside",isMultiline:!1,size:"md",class:{label:["start-3","text-small","group-data-[filled=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-small)/2_+_20px)]","group-data-[has-helper=true]:-translate-y-0","group-data-[has-helper=true]:relative","group-data-[has-helper=true]:pe-2","group-data-[has-helper=true]:pb-1.5"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_10px)]"}},{labelPlacement:"outside",isMultiline:!1,size:"lg",class:{label:["start-3","text-medium","group-data-[filled=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-small)/2_+_24px)]","group-data-[has-helper=true]:-translate-y-0","group-data-[has-helper=true]:relative","group-data-[has-helper=true]:pe-2","group-data-[has-helper=true]:pb-1.5"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_12px)]"}},{labelPlacement:"outside-left",size:"sm",class:{label:"group-data-[has-helper=true]:pt-2"}},{labelPlacement:"outside-left",size:"md",class:{label:"group-data-[has-helper=true]:pt-3"}},{labelPlacement:"outside-left",size:"lg",class:{label:"group-data-[has-helper=true]:pt-4"}},{labelPlacement:"outside",isMultiline:!0,class:{label:"pb-1.5"}},{labelPlacement:["inside","outside"],class:{label:["pe-2","max-w-full","text-ellipsis","overflow-hidden"]}},{labelPlacement:["outside","outside-left"],isClearable:!0,class:{endContent:["mt-4"],clearButton:["group-data-[has-end-content=true]:mt-4"]}},{isClearable:!1,labelPlacement:["outside","outside-left"],class:{endContent:["mt-4"]}},{isClearable:!0,variant:["underlined"],class:{clearButton:["relative group-data-[has-end-content=true]:left-2"],endContent:["me-2"]}},{isClearable:!1,variant:["underlined"],class:{endContent:["me-2"]}},{isClearable:!0,size:"sm",class:{endContent:"ms-2"}}]}),N=(0,d.tv)({slots:{base:"w-full relative flex flex-col gap-1 p-1 overflow-clip",list:"w-full flex flex-col gap-0.5 outline-solid outline-transparent",emptyContent:["h-10","px-2","py-1.5","w-full","h-full","text-foreground-400","text-start"]}}),k=(0,d.tv)({slots:{base:["flex","group","gap-2","items-center","justify-between","relative","px-2","py-1.5","w-full","h-full","box-border","rounded-small","subpixel-antialiased","outline-solid outline-transparent","cursor-pointer","tap-highlight-transparent",...h,"data-[focus-visible=true]:dark:ring-offset-background-content1"],wrapper:"w-full flex flex-col items-start justify-center min-w-0",title:"flex-1 text-small font-normal w-full",description:["w-full","text-tiny","text-foreground-500","group-hover:text-current"],selectedIcon:["text-inherit","w-3","h-3","shrink-0"],shortcut:["px-1","py-0.5","rounded-sm","font-sans","text-foreground-500","text-tiny","border-small","border-default-300","group-hover:border-current"]},variants:{variant:{solid:{base:""},bordered:{base:"border-medium border-transparent bg-transparent"},light:{base:"bg-transparent"},faded:{base:["border-small border-transparent hover:border-default data-[hover=true]:bg-default-100","data-[selectable=true]:focus:border-default data-[selectable=true]:focus:bg-default-100"]},flat:{base:""},shadow:{base:"data-[hover=true]:shadow-lg"}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},showDivider:{true:{base:["mb-1.5","after:content-['']","after:absolute","after:-bottom-1","after:left-0","after:right-0","after:h-divider","after:bg-divider"]},false:{}},isDisabled:{true:{base:"opacity-disabled pointer-events-none"}},disableAnimation:{true:{},false:{base:"data-[hover=true]:transition-colors"}},hasTitleTextChild:{true:{title:"truncate"}},hasDescriptionTextChild:{true:{description:"truncate"}}},defaultVariants:{variant:"solid",color:"default",showDivider:!1},compoundVariants:[{variant:"solid",color:"default",class:{base:["data-[hover=true]:bg-default","data-[hover=true]:text-default-foreground","data-[selectable=true]:focus:bg-default","data-[selectable=true]:focus:text-default-foreground"]}},{variant:"solid",color:"primary",class:{base:["data-[hover=true]:bg-primary data-[hover=true]:text-primary-foreground","data-[selectable=true]:focus:bg-primary data-[selectable=true]:focus:text-primary-foreground"]}},{variant:"solid",color:"secondary",class:{base:["data-[hover=true]:bg-secondary data-[hover=true]:text-secondary-foreground","data-[selectable=true]:focus:bg-secondary data-[selectable=true]:focus:text-secondary-foreground"]}},{variant:"solid",color:"success",class:{base:["data-[hover=true]:bg-success data-[hover=true]:text-success-foreground","data-[selectable=true]:focus:bg-success data-[selectable=true]:focus:text-success-foreground"]}},{variant:"solid",color:"warning",class:{base:["data-[hover=true]:bg-warning data-[hover=true]:text-warning-foreground","data-[selectable=true]:focus:bg-warning data-[selectable=true]:focus:text-warning-foreground"]}},{variant:"solid",color:"danger",class:{base:["data-[hover=true]:bg-danger data-[hover=true]:text-danger-foreground","data-[selectable=true]:focus:bg-danger data-[selectable=true]:focus:text-danger-foreground"]}},{variant:"shadow",color:"default",class:{base:["data-[hover=true]:shadow-default/50 data-[hover=true]:bg-default data-[hover=true]:text-default-foreground","data-[selectable=true]:focus:shadow-default/50 data-[selectable=true]:focus:bg-default data-[selectable=true]:focus:text-default-foreground"]}},{variant:"shadow",color:"primary",class:{base:["data-[hover=true]:shadow-primary/30 data-[hover=true]:bg-primary data-[hover=true]:text-primary-foreground","data-[selectable=true]:focus:shadow-primary/30 data-[selectable=true]:focus:bg-primary data-[selectable=true]:focus:text-primary-foreground"]}},{variant:"shadow",color:"secondary",class:{base:["data-[hover=true]:shadow-secondary/30 data-[hover=true]:bg-secondary data-[hover=true]:text-secondary-foreground","data-[selectable=true]:focus:shadow-secondary/30 data-[selectable=true]:focus:bg-secondary data-[selectable=true]:focus:text-secondary-foreground"]}},{variant:"shadow",color:"success",class:{base:["data-[hover=true]:shadow-success/30 data-[hover=true]:bg-success data-[hover=true]:text-success-foreground","data-[selectable=true]:focus:shadow-success/30 data-[selectable=true]:focus:bg-success data-[selectable=true]:focus:text-success-foreground"]}},{variant:"shadow",color:"warning",class:{base:["data-[hover=true]:shadow-warning/30 data-[hover=true]:bg-warning data-[hover=true]:text-warning-foreground","data-[selectable=true]:focus:shadow-warning/30 data-[selectable=true]:focus:bg-warning data-[selectable=true]:focus:text-warning-foreground"]}},{variant:"shadow",color:"danger",class:{base:["data-[hover=true]:shadow-danger/30 data-[hover=true]:bg-danger data-[hover=true]:text-danger-foreground","data-[selectable=true]:focus:shadow-danger/30 data-[selectable=true]:focus:bg-danger data-[selectable=true]:focus:text-danger-foreground"]}},{variant:"bordered",color:"default",class:{base:["data-[hover=true]:border-default","data-[selectable=true]:focus:border-default"]}},{variant:"bordered",color:"primary",class:{base:["data-[hover=true]:border-primary data-[hover=true]:text-primary","data-[selectable=true]:focus:border-primary data-[selectable=true]:focus:text-primary"]}},{variant:"bordered",color:"secondary",class:{base:["data-[hover=true]:border-secondary data-[hover=true]:text-secondary","data-[selectable=true]:focus:border-secondary data-[selectable=true]:focus:text-secondary"]}},{variant:"bordered",color:"success",class:{base:["data-[hover=true]:border-success data-[hover=true]:text-success","data-[selectable=true]:focus:border-success data-[selectable=true]:focus:text-success"]}},{variant:"bordered",color:"warning",class:{base:["data-[hover=true]:border-warning data-[hover=true]:text-warning","data-[selectable=true]:focus:border-warning data-[selectable=true]:focus:text-warning"]}},{variant:"bordered",color:"danger",class:{base:["data-[hover=true]:border-danger data-[hover=true]:text-danger","data-[selectable=true]:focus:border-danger data-[selectable=true]:focus:text-danger"]}},{variant:"flat",color:"default",class:{base:["data-[hover=true]:bg-default/40","data-[hover=true]:text-default-foreground","data-[selectable=true]:focus:bg-default/40","data-[selectable=true]:focus:text-default-foreground"]}},{variant:"flat",color:"primary",class:{base:["data-[hover=true]:bg-primary/20 data-[hover=true]:text-primary","data-[selectable=true]:focus:bg-primary/20 data-[selectable=true]:focus:text-primary"]}},{variant:"flat",color:"secondary",class:{base:["data-[hover=true]:bg-secondary/20 data-[hover=true]:text-secondary","data-[selectable=true]:focus:bg-secondary/20 data-[selectable=true]:focus:text-secondary"]}},{variant:"flat",color:"success",class:{base:["data-[hover=true]:bg-success/20 data-[hover=true]:text-success","data-[selectable=true]:focus:bg-success/20 data-[selectable=true]:focus:text-success"]}},{variant:"flat",color:"warning",class:{base:["data-[hover=true]:bg-warning/20 data-[hover=true]:text-warning","data-[selectable=true]:focus:bg-warning/20 data-[selectable=true]:focus:text-warning"]}},{variant:"flat",color:"danger",class:{base:["data-[hover=true]:bg-danger/20 data-[hover=true]:text-danger","data-[selectable=true]:focus:bg-danger/20 data-[selectable=true]:focus:text-danger"]}},{variant:"faded",color:"default",class:{base:["data-[hover=true]:text-default-foreground","data-[selectable=true]:focus:text-default-foreground"]}},{variant:"faded",color:"primary",class:{base:["data-[hover=true]:text-primary","data-[selectable=true]:focus:text-primary"]}},{variant:"faded",color:"secondary",class:{base:["data-[hover=true]:text-secondary","data-[selectable=true]:focus:text-secondary"]}},{variant:"faded",color:"success",class:{base:["data-[hover=true]:text-success","data-[selectable=true]:focus:text-success"]}},{variant:"faded",color:"warning",class:{base:["data-[hover=true]:text-warning","data-[selectable=true]:focus:text-warning"]}},{variant:"faded",color:"danger",class:{base:["data-[hover=true]:text-danger","data-[selectable=true]:focus:text-danger"]}},{variant:"light",color:"default",class:{base:["data-[hover=true]:text-default-500","data-[selectable=true]:focus:text-default-500"]}},{variant:"light",color:"primary",class:{base:["data-[hover=true]:text-primary","data-[selectable=true]:focus:text-primary"]}},{variant:"light",color:"secondary",class:{base:["data-[hover=true]:text-secondary","data-[selectable=true]:focus:text-secondary"]}},{variant:"light",color:"success",class:{base:["data-[hover=true]:text-success","data-[selectable=true]:focus:text-success"]}},{variant:"light",color:"warning",class:{base:["data-[hover=true]:text-warning","data-[selectable=true]:focus:text-warning"]}},{variant:"light",color:"danger",class:{base:["data-[hover=true]:text-danger","data-[selectable=true]:focus:text-danger"]}}]}),R=(0,d.tv)({slots:{base:"relative mb-2",heading:"pl-1 text-tiny text-foreground-500",group:"data-[has-title=true]:pt-1",divider:"mt-2"}}),L=((0,d.tv)({slots:{base:"flex flex-col w-full gap-1",labelWrapper:"w-full flex justify-between items-center",label:"",value:"",step:["h-1.5","w-1.5","absolute","rounded-full","bg-default-300/50","data-[in-range=true]:bg-background/50"],mark:["absolute","text-small","cursor-default","opacity-50","data-[in-range=true]:opacity-100"],trackWrapper:"relative flex gap-2",track:["flex","w-full","relative","rounded-full","bg-default-300/50"],filler:"h-full absolute",thumb:["flex","justify-center","items-center","before:absolute","before:w-11","before:h-11","before:rounded-full","after:shadow-small","after:shadow-small","after:bg-background","data-[focused=true]:z-10",h],startContent:[],endContent:[]},variants:{size:{sm:{label:"text-small",value:"text-small",thumb:"w-5 h-5 after:w-4 after:h-4",step:"data-[in-range=false]:bg-default-200"},md:{thumb:"w-6 h-6 after:w-5 after:h-5",label:"text-small",value:"text-small"},lg:{thumb:"h-7 w-7 after:w-5 after:h-5",step:"w-2 h-2",label:"text-medium",value:"text-medium",mark:"mt-2"}},radius:{none:{thumb:"rounded-none after:rounded-none"},sm:{thumb:"rounded-[calc(var(--heroui-radius-small)/2)] after:rounded-[calc(var(--heroui-radius-small)/3)]"},md:{thumb:"rounded-[calc(var(--heroui-radius-medium)/2)] after:rounded-[calc(var(--heroui-radius-medium)/3)]"},lg:{thumb:"rounded-[calc(var(--heroui-radius-large)/1.5)] after:rounded-[calc(var(--heroui-radius-large)/2)]"},full:{thumb:"rounded-full after:rounded-full"}},color:{foreground:{filler:"bg-foreground",thumb:"bg-foreground"},primary:{filler:"bg-primary",thumb:"bg-primary"},secondary:{filler:"bg-secondary",thumb:"bg-secondary"},success:{filler:"bg-success",thumb:"bg-success"},warning:{filler:"bg-warning",thumb:"bg-warning"},danger:{filler:"bg-danger",thumb:"bg-danger"}},isVertical:{true:{base:"w-auto h-full flex-col-reverse items-center",trackWrapper:"flex-col h-full justify-center items-center",filler:"w-full h-auto",thumb:"left-1/2",track:"h-full border-y-transparent",labelWrapper:"flex-col justify-center items-center",step:["left-1/2","-translate-x-1/2","translate-y-1/2"],mark:["left-1/2","ml-1","translate-x-1/2","translate-y-1/2"]},false:{thumb:"top-1/2",trackWrapper:"items-center",track:"border-x-transparent",step:["top-1/2","-translate-x-1/2","-translate-y-1/2"],mark:["top-1/2","mt-1","-translate-x-1/2","translate-y-1/2"]}},isDisabled:{false:{thumb:["cursor-grab","data-[dragging=true]:cursor-grabbing"]},true:{base:"opacity-disabled",thumb:"cursor-default"}},hasMarks:{true:{base:"mb-5",mark:"cursor-pointer"},false:{}},showOutline:{true:{thumb:"ring-2 ring-background"},false:{thumb:"ring-transparent border-0"}},hideValue:{true:{value:"sr-only"}},hideThumb:{true:{thumb:"sr-only",track:"cursor-pointer"}},hasSingleThumb:{true:{},false:{}},disableAnimation:{true:{thumb:"data-[dragging=true]:after:scale-100"},false:{thumb:"after:transition-all motion-reduce:after:transition-none",mark:"transition-opacity motion-reduce:transition-none"}},disableThumbScale:{true:{},false:{thumb:"data-[dragging=true]:after:scale-80"}}},compoundVariants:[{size:["sm","md"],showOutline:!1,class:{thumb:"shadow-small"}},{size:"sm",color:"foreground",class:{step:"data-[in-range=true]:bg-foreground"}},{size:"sm",color:"primary",class:{step:"data-[in-range=true]:bg-primary"}},{size:"sm",color:"secondary",class:{step:"data-[in-range=true]:bg-secondary"}},{size:"sm",color:"success",class:{step:"data-[in-range=true]:bg-success"}},{size:"sm",color:"warning",class:{step:"data-[in-range=true]:bg-warning"}},{size:"sm",color:"danger",class:{step:"data-[in-range=true]:bg-danger"}},{size:"sm",isVertical:!1,class:{track:"h-1 my-[calc((theme(spacing.5)-theme(spacing.1))/2)] border-x-[calc(theme(spacing.5)/2)]"}},{size:"md",isVertical:!1,class:{track:"h-3 my-[calc((theme(spacing.6)-theme(spacing.3))/2)] border-x-[calc(theme(spacing.6)/2)]"}},{size:"lg",isVertical:!1,class:{track:"h-7 my-[calc((theme(spacing.7)-theme(spacing.5))/2)] border-x-[calc(theme(spacing.7)/2)]"}},{size:"sm",isVertical:!0,class:{track:"w-1 mx-[calc((theme(spacing.5)-theme(spacing.1))/2)] border-y-[calc(theme(spacing.5)/2)]"}},{size:"md",isVertical:!0,class:{track:"w-3 mx-[calc((theme(spacing.6)-theme(spacing.3))/2)] border-y-[calc(theme(spacing.6)/2)]"}},{size:"lg",isVertical:!0,class:{track:"w-7 mx-[calc((theme(spacing.7)-theme(spacing.5))/2)] border-y-[calc(theme(spacing.7)/2)]"}},{color:"foreground",isVertical:!1,class:{track:"data-[fill-start=true]:border-s-foreground data-[fill-end=true]:border-e-foreground"}},{color:"primary",isVertical:!1,class:{track:"data-[fill-start=true]:border-s-primary data-[fill-end=true]:border-e-primary"}},{color:"secondary",isVertical:!1,class:{track:"data-[fill-start=true]:border-s-secondary data-[fill-end=true]:border-e-secondary"}},{color:"success",isVertical:!1,class:{track:"data-[fill-start=true]:border-s-success data-[fill-end=true]:border-e-success"}},{color:"warning",isVertical:!1,class:{track:"data-[fill-start=true]:border-s-warning data-[fill-end=true]:border-e-warning"}},{color:"danger",isVertical:!1,class:{track:"data-[fill-start=true]:border-s-danger data-[fill-end=true]:border-e-danger"}},{color:"foreground",isVertical:!0,class:{track:"data-[fill-start=true]:border-b-foreground data-[fill-end=true]:border-t-foreground"}},{color:"primary",isVertical:!0,class:{track:"data-[fill-start=true]:border-b-primary data-[fill-end=true]:border-t-primary"}},{color:"secondary",isVertical:!0,class:{track:"data-[fill-start=true]:border-b-secondary data-[fill-end=true]:border-t-secondary"}},{color:"success",isVertical:!0,class:{track:"data-[fill-start=true]:border-b-success data-[fill-end=true]:border-t-success"}},{color:"warning",isVertical:!0,class:{track:"data-[fill-start=true]:border-b-warning data-[fill-end=true]:border-t-warning"}},{color:"danger",isVertical:!0,class:{track:"data-[fill-start=true]:border-b-danger data-[fill-end=true]:border-t-danger"}}],defaultVariants:{size:"md",color:"primary",radius:"full",hideValue:!1,hideThumb:!1,isDisabled:!1,disableThumbScale:!1,showOutline:!1}}),(0,d.tv)({slots:{base:"flex items-center",item:["flex gap-1 items-center","cursor-pointer","whitespace-nowrap","outline-solid outline-transparent","tap-highlight-transparent",...h],separator:"text-default-400 px-1 rtl:rotate-180"},variants:{color:{foreground:{item:"text-foreground/50",separator:"text-foreground/50"},primary:{item:"text-primary/80",separator:"text-primary/80"},secondary:{item:"text-secondary/80",separator:"text-secondary/80"},success:{item:"text-success/80",separator:"text-success/80"},warning:{item:"text-warning/80",separator:"text-warning/80"},danger:{item:"text-danger/80",separator:"text-danger/80"}},size:{sm:{item:"text-tiny"},md:{item:"text-small"},lg:{item:"text-medium"}},underline:{none:{item:"no-underline"},hover:{item:"hover:underline"},always:{item:"underline"},active:{item:"active:underline"},focus:{item:"focus:underline"}},isCurrent:{true:{item:"cursor-default"},false:{item:["hover:opacity-hover","active:opacity-disabled"]}},isDisabled:{true:{item:"opacity-disabled pointer-events-none",separator:"opacity-disabled"}},disableAnimation:{false:{item:"transition-opacity"},true:{item:"transition-none"}}},defaultVariants:{size:"md",color:"foreground",underline:"hover",isDisabled:!1},compoundVariants:[{isCurrent:!0,color:"foreground",class:{item:"text-foreground"}},{isCurrent:!0,color:"primary",class:{item:"text-primary"}},{isCurrent:!0,color:"secondary",class:{item:"text-secondary"}},{isCurrent:!0,color:"success",class:{item:"text-success"}},{isCurrent:!0,color:"warning",class:{item:"text-warning"}},{isCurrent:!0,color:"danger",class:{item:"text-danger"}},{isCurrent:!1,underline:"none",class:{item:"no-underline"}},{underline:["hover","always","active","focus"],class:"underline-offset-4"}]}),(0,d.tv)({slots:{base:"",list:"flex flex-wrap list-none",ellipsis:"text-medium",separator:"text-default-400 px-1"},variants:{size:{sm:{},md:{},lg:{}},radius:{none:{list:"rounded-none"},sm:{list:"rounded-small"},md:{list:"rounded-medium"},lg:{list:"rounded-large"},full:{list:"rounded-full"}},variant:{solid:{list:"bg-default-100"},bordered:{list:"border-medium border-default-200 shadow-xs"},light:{}}},defaultVariants:{size:"md",radius:"sm",variant:"light"},compoundVariants:[{variant:["solid","bordered"],class:{list:"max-w-fit"}},{variant:["solid","bordered"],size:"sm",class:{list:"px-2 py-1"}},{variant:["solid","bordered"],size:"md",class:{list:"px-2.5 py-1.5"}},{variant:["solid","bordered"],size:"lg",class:{list:"px-3 py-2"}}]}),(0,d.tv)({slots:{base:["relative w-fit max-w-full shadow-small inline-block overflow-y-hidden","rounded-large overflow-x-auto bg-default-50 dark:bg-background","w-[calc(var(--visible-months)_*_var(--calendar-width))]"],prevButton:["order-1"],nextButton:["order-3"],headerWrapper:["px-4 py-2 flex items-center justify-between gap-2 bg-content1 overflow-hidden rtl:flex-row-reverse","[&_.chevron-icon]:flex-none","after:content-['']","after:bg-content1 origin-top","after:w-full after:h-0","after:absolute after:top-0 after:left-0"],header:"flex w-full items-center justify-center gap-2 z-10 order-2",title:"text-default-500 text-small font-medium",content:"w-[calc(var(--visible-months)_*_var(--calendar-width))]",gridWrapper:"flex max-w-full overflow-hidden pb-2 h-auto relative",grid:"w-full border-collapse z-0",gridHeader:"bg-content1 shadow-[0px_20px_20px_0px_rgb(0_0_0/0.05)]",gridHeaderRow:"px-4 pb-2 flex justify-center text-default-400",gridHeaderCell:"flex w-8 justify-center items-center font-medium text-small",gridBody:"",gridBodyRow:"flex justify-center items-center first:mt-2",cell:"py-0.5 px-0",cellButton:["w-8 h-8 flex items-center text-foreground justify-center rounded-full","box-border appearance-none select-none whitespace-nowrap font-normal","subpixel-antialiased overflow-hidden tap-highlight-transparent","data-[disabled=true]:text-default-300","data-[disabled=true]:cursor-default","data-[readonly=true]:cursor-default","data-[disabled=true]:transition-none","data-[unavailable=true]:text-default-300","data-[unavailable=true]:cursor-default","data-[unavailable=true]:line-through",...h],pickerWrapper:"absolute inset-x-0 top-0 flex w-full h-[var(--picker-height)] justify-center opacity-0 pointer-events-none",pickerMonthList:"items-start",pickerYearList:"items-center",pickerHighlight:"h-8 bg-default-200 absolute w-[calc(100%_-_16px)] rounded-medium z-0 top-1/2 -translate-y-1/2 pointer-events-none",pickerItem:["w-full flex text-foreground items-center h-8 leading-[32px] min-h-[32px] snap-center text-large z-20","data-[pressed=true]:opacity-50",...h],helperWrapper:"px-4 pb-2 max-w-[270px] flex justify-start flex-wrap items-center",errorMessage:"text-small text-danger break-words max-w-full"},variants:{color:{foreground:{},primary:{},secondary:{},success:{},warning:{},danger:{}},isRange:{true:{cellButton:["relative","overflow-visible","before:content-[''] before:absolute before:inset-0 before:z-[-1] before:rounded-none","data-[outside-month=true]:before:hidden","data-[selected=true]:data-[range-selection=true]:data-[outside-month=true]:bg-transparent","data-[selected=true]:data-[range-selection=true]:data-[outside-month=true]:text-default-300","data-[range-start=true]:before:rounded-s-full","data-[selection-start=true]:before:rounded-s-full","data-[range-end=true]:before:rounded-e-full","data-[selection-end=true]:before:rounded-e-full","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:rounded-full","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:rounded-full"]},false:{}},hideDisabledDates:{true:{cellButton:"data-[disabled=true]:data-[outside-month=true]:opacity-0"},false:{}},isHeaderWrapperExpanded:{true:{headerWrapper:["[&_.chevron-icon]:rotate-180","after:h-full","after:z-0"],pickerWrapper:"opacity-100 pointer-events-auto z-10",gridWrapper:"h-[var(--picker-height)] overflow-y-hidden",grid:"opacity-0 pointer-events-none",nextButton:"opacity-0 pointer-events-none",prevButton:"opacity-0 pointer-events-none"},false:{}},showMonthAndYearPickers:{true:{base:"[--picker-height:224px]",header:"h-8 bg-default-100 rounded-full"},false:{}},showShadow:{true:{cellButton:"data-[selected=true]:shadow-md"},false:{cellButton:"shadow-none data-[selected=true]:shadow-none"}},disableAnimation:{true:{cellButton:"transition-none"},false:{headerWrapper:["[&_.chevron-icon]:transition-transform","after:transition-height"],grid:"transition-opacity",cellButton:["origin-center transition-[transform,background-color,color] !duration-150"],pickerWrapper:"transition-opacity !duration-250",pickerItem:"transition-opacity"}},isRTL:{true:{nextButton:"order-1",prevButton:"order-3"},false:{}}},defaultVariants:{color:"primary",showShadow:!1,hideDisabledDates:!1,showMonthAndYearPickers:!1,isRTL:!1},compoundVariants:[{isRange:!1,color:"foreground",class:{cellButton:["data-[hover=true]:bg-default-200","data-[selected=true]:bg-foreground","data-[selected=true]:text-background","data-[hover=true]:bg-foreground-200","data-[hover=true]:text-foreground-600","data-[selected=true]:data-[hover=true]:bg-foreground","data-[selected=true]:data-[hover=true]:text-background"]}},{isRange:!1,color:"primary",class:{cellButton:["data-[selected=true]:bg-primary","data-[selected=true]:text-primary-foreground","data-[hover=true]:bg-primary-50","data-[hover=true]:text-primary-400","data-[selected=true]:data-[hover=true]:bg-primary","data-[selected=true]:data-[hover=true]:text-primary-foreground"]}},{isRange:!1,color:"secondary",class:{cellButton:["data-[selected=true]:bg-secondary","data-[selected=true]:text-secondary-foreground","data-[hover=true]:bg-secondary-50","data-[hover=true]:text-secondary-400","data-[selected=true]:data-[hover=true]:bg-secondary","data-[selected=true]:data-[hover=true]:text-secondary-foreground"]}},{isRange:!1,color:"success",class:{cellButton:["data-[selected=true]:bg-success","data-[selected=true]:text-success-foreground","data-[hover=true]:bg-success-100","data-[hover=true]:text-success-600","dark:data-[hover=true]:bg-success-50","dark:data-[hover=true]:text-success-500","data-[selected=true]:data-[hover=true]:bg-success","dark:data-[selected=true]:data-[hover=true]:bg-success","dark:data-[selected=true]:data-[hover=true]:text-success-foreground","data-[selected=true]:data-[hover=true]:text-success-foreground"]}},{isRange:!1,color:"warning",class:{cellButton:["data-[selected=true]:bg-warning","data-[selected=true]:text-warning-foreground","data-[hover=true]:bg-warning-100","data-[hover=true]:text-warning-600","dark:data-[hover=true]:bg-warning-50","dark:data-[hover=true]:text-warning-500","data-[selected=true]:data-[hover=true]:bg-warning","dark:data-[selected=true]:data-[hover=true]:bg-warning","dark:data-[selected=true]:data-[hover=true]:text-warning-foreground","data-[selected=true]:data-[hover=true]:text-warning-foreground"]}},{isRange:!1,color:"danger",class:{cellButton:["data-[selected=true]:bg-danger","data-[selected=true]:text-danger-foreground","data-[hover=true]:bg-danger-100","data-[hover=true]:text-danger-500","dark:data-[hover=true]:bg-danger-50","dark:data-[hover=true]:text-danger-500","data-[selected=true]:data-[hover=true]:bg-danger","dark:data-[selected=true]:data-[hover=true]:bg-danger","dark:data-[selected=true]:data-[hover=true]:text-danger-foreground","data-[selected=true]:data-[hover=true]:text-danger-foreground"]}},{isRange:!0,color:"foreground",class:{cellButton:["data-[selected=true]:data-[range-selection=true]:before:bg-foreground/10","data-[selected=true]:data-[range-selection=true]:text-foreground","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:bg-foreground","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-background","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:bg-foreground","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-background"]}},{isRange:!0,color:"primary",class:{cellButton:["data-[selected=true]:data-[range-selection=true]:before:bg-primary-50","data-[selected=true]:data-[range-selection=true]:text-primary","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:bg-primary","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-primary-foreground","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:bg-primary","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-primary-foreground"]}},{isRange:!0,color:"secondary",class:{cellButton:["data-[selected=true]:data-[range-selection=true]:before:bg-secondary-50","data-[selected=true]:data-[range-selection=true]:text-secondary","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:bg-secondary","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-secondary-foreground","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:bg-secondary","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-secondary-foreground"]}},{isRange:!0,color:"success",class:{cellButton:["data-[selected=true]:data-[range-selection=true]:before:bg-success-100","data-[selected=true]:data-[range-selection=true]:text-success-600","dark:data-[selected=true]:data-[range-selection=true]:before:bg-success-50","dark:data-[selected=true]:data-[range-selection=true]:text-success-500","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:bg-success","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-success-foreground","dark:data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-success-foreground","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:bg-success","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-success-foreground","dark:data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-success-foreground"]}},{isRange:!0,color:"warning",class:{cellButton:["data-[selected=true]:data-[range-selection=true]:before:bg-warning-100","dark:data-[selected=true]:data-[range-selection=true]:before:bg-warning-50","data-[selected=true]:data-[range-selection=true]:text-warning-500","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:bg-warning","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-warning-foreground","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:bg-warning","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-warning-foreground"]}},{isRange:!0,color:"danger",class:{cellButton:["data-[selected=true]:data-[range-selection=true]:before:bg-danger-50","data-[selected=true]:data-[range-selection=true]:text-danger-500","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:bg-danger","data-[selected=true]:data-[selection-start=true]:data-[range-selection=true]:text-danger-foreground","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:bg-danger","data-[selected=true]:data-[selection-end=true]:data-[range-selection=true]:text-danger-foreground"]}},{showShadow:!0,color:"foreground",class:{cellButton:"data-[selected=true]:shadow-foreground/40"}},{showShadow:!0,color:"primary",class:{cellButton:"data-[selected=true]:shadow-primary/40"}},{showShadow:!0,color:"secondary",class:{cellButton:"data-[selected=true]:shadow-secondary/40"}},{showShadow:!0,color:"success",class:{cellButton:"data-[selected=true]:shadow-success/40"}},{showShadow:!0,color:"warning",class:{cellButton:"data-[selected=true]:shadow-warning/40"}},{showShadow:!0,color:"danger",class:{cellButton:"data-[selected=true]:shadow-danger/40"}},{showShadow:!0,isRange:!0,class:{cellButton:["data-[selected=true]:shadow-none","data-[selected=true]:data-[selection-start=true]:shadow-md","data-[selected=true]:data-[selection-end=true]:shadow-md"]}}],compoundSlots:[{slots:["prevButton","nextButton"],class:["text-medium","text-default-400"]},{slots:["pickerMonthList","pickerYearList"],class:["flex flex-col px-4 overflow-y-scroll scrollbar-hide snap-y snap-mandatory","[--scroll-shadow-size:100px]","[mask-image:linear-gradient(#000,#000,transparent_0,#000_var(--scroll-shadow-size),#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]"]}]}),(0,d.tv)({slots:{base:"flex flex-grow flex-row w-full items-center py-3 px-4 gap-x-1",mainWrapper:"h-full flex-grow min-h-10 ms-2 flex flex-col box-border items-start text-inherit justify-center",title:"text-small w-full font-medium block text-inherit leading-5",description:"pl-[1px] text-small font-normal text-inherit",closeButton:"relative text-inherit translate-x-1 -translate-y-1",iconWrapper:"flex-none relative w-9 h-9 rounded-full grid place-items-center",alertIcon:"fill-current w-6 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},variants:{color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},variant:{solid:{},flat:{},faded:{base:"border-small"},bordered:{base:"border-small bg-transparent"}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"},full:{base:"rounded-full"}},hideIcon:{true:{iconWrapper:"hidden"}},hideIconWrapper:{true:{base:"gap-x-0",iconWrapper:"!bg-transparent !shadow-none !border-none"}},hasContent:{false:{base:"items-center",mainWrapper:"justify-center items-center"}}},defaultVariants:{color:"default",variant:"flat",radius:"md",hideIcon:!1,hideIconWrapper:!1},compoundVariants:[{variant:"solid",color:"default",class:{base:r.default,closeButton:"data-[hover]:bg-default-100",alertIcon:"text-default-foreground"}},{variant:"solid",color:"primary",class:{base:r.primary}},{variant:"solid",color:"secondary",class:{base:r.secondary}},{variant:"solid",color:"success",class:{base:r.success}},{variant:"solid",color:"warning",class:{base:r.warning}},{variant:"solid",color:"danger",class:{base:r.danger}},{variant:["flat","faded"],color:"default",class:{base:[o.default,"bg-default-100 dark:bg-default-50/50","text-default-foreground"],description:"text-default-600",closeButton:"text-default-400",iconWrapper:"bg-default-50 dark:bg-default-100 border-default-200"}},{variant:["flat","faded"],color:"primary",class:{base:[o.primary,"bg-primary-50 dark:bg-primary-50/50"],closeButton:"text-primary-500 data-[hover]:bg-primary-200",iconWrapper:"bg-primary-50 dark:bg-primary-100 border-primary-100"}},{variant:["flat","faded"],color:"secondary",class:{base:[o.secondary,"bg-secondary-50 dark:bg-secondary-50/50"],closeButton:"text-secondary-500 data-[hover]:bg-secondary-200",iconWrapper:"bg-secondary-50 dark:bg-secondary-100 border-secondary-100"}},{variant:["flat","faded"],color:"success",class:{base:[o.success,"bg-success-50 dark:bg-success-50/50"],closeButton:"text-success-500 data-[hover]:bg-success-200",iconWrapper:"bg-success-50 dark:bg-success-100 border-success-100"}},{variant:["flat","faded"],color:"warning",class:{base:[o.warning,"bg-warning-50 dark:bg-warning-50/50"],closeButton:"text-warning-500 data-[hover]:bg-warning-200",iconWrapper:"bg-warning-50 dark:bg-warning-100 border-warning-100"}},{variant:["flat","faded"],color:"danger",class:{base:[o.danger,"bg-danger-50 dark:bg-danger-50/50"],closeButton:"text-danger-500 data-[hover]:bg-danger-200",iconWrapper:"bg-danger-50 dark:bg-danger-100 border-danger-100"}},{variant:"faded",color:"default",class:{base:"border-default-300 dark:border-default-200"}},{variant:"faded",color:"primary",class:{base:"border-primary-200 dark:border-primary-100"}},{variant:"faded",color:"secondary",class:{base:"border-secondary-200"}},{variant:"faded",color:"success",class:{base:"border-success-300 dark:border-success-100"}},{variant:"faded",color:"warning",class:{base:"border-warning-300 dark:border-warning-100"}},{variant:"faded",color:"danger",class:{base:"border-danger-200 dark:border-danger-100"}},{variant:"bordered",color:"default",class:{base:[a.default],description:"text-default-600",closeButton:"text-default-400"}},{variant:"bordered",color:"primary",class:{base:[a.primary],closeButton:"data-[hover]:bg-primary-50"}},{variant:"bordered",color:"secondary",class:{base:[a.secondary],closeButton:"data-[hover]:bg-secondary-50"}},{variant:"bordered",color:"success",class:{base:[a.success],closeButton:"data-[hover]:bg-success-50"}},{variant:"bordered",color:"warning",class:{base:[a.warning],closeButton:"data-[hover]:bg-warning-100"}},{variant:"bordered",color:"danger",class:{base:[a.danger],closeButton:"data-[hover]:bg-danger-50"}},{variant:["flat","bordered","faded"],class:{iconWrapper:"shadow-small"}},{variant:["flat","faded"],class:{iconWrapper:"shadow-small border-1"}},{variant:"bordered",color:"default",class:{iconWrapper:"bg-default-200 dark:bg-default-100"}},{variant:"bordered",color:"primary",class:{iconWrapper:"bg-primary-100 dark:bg-primary-50"}},{variant:"bordered",color:"secondary",class:{iconWrapper:"bg-secondary-100 dark:bg-secondary-50"}},{variant:"bordered",color:"success",class:{iconWrapper:"bg-success-100 dark:bg-success-50"}},{variant:"bordered",color:"warning",class:{iconWrapper:"bg-warning-100 dark:bg-warning-50"}},{variant:"bordered",color:"danger",class:{iconWrapper:"bg-danger-100 dark:bg-danger-50"}}]}),(0,d.tv)({slots:{base:"group flex flex-col data-[hidden=true]:hidden",label:["absolute","z-10","pointer-events-none","origin-top-left","flex-shrink-0","rtl:origin-top-right","subpixel-antialiased","block","text-small","text-foreground-500"],mainWrapper:"h-full",inputWrapper:"relative w-full inline-flex tap-highlight-transparent flex-row items-center shadow-sm px-3 gap-3",innerWrapper:"inline-flex w-full items-center h-full box-border",input:["w-full font-normal bg-transparent !outline-solid outline-transparent placeholder:text-foreground-500 focus-visible:outline-solid outline-transparent","data-[has-start-content=true]:ps-1.5","data-[has-end-content=true]:pe-1.5","autofill:bg-transparent bg-clip-text","dark:autofill:[-webkit-text-fill-color:hsl(var(--heroui-foreground))]"],clearButton:["p-2","-m-2","z-10","end-3","start-auto","pointer-events-none","appearance-none","outline-solid outline-transparent","select-none","opacity-0","hover:!opacity-100","cursor-pointer","active:!opacity-70","rounded-full",...h],stepperButton:["bg-transparent","flex","justify-center","items-center","before:absolute","before:w-8","before:h-8","before:rounded-full","after:shadow-small","after:bg-background","data-[focused=true]:z-10","min-w-5","w-5","h-5","overflow-visible","transition-opacity","data-[hover=true]:opacity-70","data-[pressed=true]:opacity-disabled"],stepperWrapper:["flex","flex-col","ps-1","h-full","justify-center"],helperWrapper:"hidden group-data-[has-helper=true]:flex p-1 relative flex-col gap-1.5",description:"text-tiny text-foreground-400",errorMessage:"text-tiny text-danger"},variants:{variant:{flat:{inputWrapper:["bg-default-100","data-[hover=true]:bg-default-200","group-data-[focus=true]:bg-default-100"]},faded:{inputWrapper:["bg-default-100","border-medium","border-default-200","data-[hover=true]:border-default-400 focus-within:border-default-400"],value:"group-data-[has-value=true]:text-default-foreground"},bordered:{inputWrapper:["border-medium","border-default-200","data-[hover=true]:border-default-400","group-data-[focus=true]:border-default-foreground","group-data-[focus=true]:data-[hover=true]:border-default-foreground"]},underlined:{inputWrapper:["!px-1","!pb-0","!gap-0","relative","box-border","border-b-medium","shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]","border-default-200","!rounded-none","hover:border-default-300","after:content-['']","after:w-0","after:origin-center","after:bg-default-foreground","after:absolute","after:left-1/2","after:-translate-x-1/2","after:-bottom-[2px]","after:h-[2px]","group-data-[focus=true]:after:w-full"],innerWrapper:"pb-1",label:"group-data-[filled-within=true]:text-foreground"}},color:{default:{},primary:{stepperButton:"text-primary"},secondary:{stepperButton:"text-secondary"},success:{stepperButton:"text-success"},warning:{stepperButton:"text-warning"},danger:{stepperButton:"text-danger"}},size:{sm:{label:"text-tiny",inputWrapper:"h-8 min-h-8 px-2 rounded-small",input:"text-small",clearButton:"text-medium"},md:{inputWrapper:"h-10 min-h-10 rounded-medium",input:"text-small",clearButton:"text-large"},lg:{label:"text-medium",inputWrapper:"h-12 min-h-12 rounded-large",input:"text-medium",clearButton:"text-large"}},radius:{none:{inputWrapper:"rounded-none"},sm:{inputWrapper:"rounded-small"},md:{inputWrapper:"rounded-medium"},lg:{inputWrapper:"rounded-large"},full:{inputWrapper:"rounded-full"}},labelPlacement:{outside:{mainWrapper:"flex flex-col",stepperButton:"min-w-3 w-3 h-3"},"outside-left":{base:"flex-row items-center flex-nowrap data-[has-helper=true]:items-start",inputWrapper:"flex-1",mainWrapper:"flex flex-col",label:"relative text-foreground pe-2 ps-2 pointer-events-auto",stepperButton:"min-w-3 w-3 h-3"},"outside-top":{mainWrapper:"flex flex-col",label:"relative text-foreground pb-2 pointer-events-auto",stepperButton:"min-w-3 w-3 h-3"},inside:{label:"cursor-text",inputWrapper:"flex-col items-start justify-center gap-0",innerWrapper:"group-data-[has-label=true]:items-end"}},fullWidth:{true:{base:"w-full"},false:{}},isClearable:{true:{input:"peer pe-6 input-search-cancel-button-none",clearButton:["peer-data-[filled=true]:pointer-events-auto","peer-data-[filled=true]:opacity-70 peer-data-[filled=true]:block","peer-data-[filled=true]:scale-100"]}},isDisabled:{true:{base:"opacity-disabled pointer-events-none",inputWrapper:"pointer-events-none",label:"pointer-events-none"}},isInvalid:{true:{label:"!text-danger",input:"!placeholder:text-danger !text-danger"}},isRequired:{true:{label:"after:content-['*'] after:text-danger after:ms-0.5"}},disableAnimation:{true:{input:"transition-none",inputWrapper:"transition-none",label:"transition-none"},false:{inputWrapper:"transition-background motion-reduce:transition-none !duration-150",label:["will-change-auto","!duration-200","!ease-out","motion-reduce:transition-none","transition-[transform,color,left,opacity,translate,scale]"],clearButton:["scale-90","ease-out","duration-150","transition-[opacity,transform]","motion-reduce:transition-none","motion-reduce:scale-100"]}}},defaultVariants:{variant:"flat",color:"default",size:"md",fullWidth:!0,labelPlacement:"inside",isDisabled:!1},compoundVariants:[{variant:"flat",color:"default",class:{input:"group-data-[has-value=true]:text-default-foreground"}},{variant:"flat",color:"primary",class:{inputWrapper:["bg-primary-100","data-[hover=true]:bg-primary-50","text-primary","group-data-[focus=true]:bg-primary-50","placeholder:text-primary"],input:"placeholder:text-primary",label:"text-primary"}},{variant:"flat",color:"secondary",class:{inputWrapper:["bg-secondary-100","text-secondary","data-[hover=true]:bg-secondary-50","group-data-[focus=true]:bg-secondary-50","placeholder:text-secondary"],input:"placeholder:text-secondary",label:"text-secondary"}},{variant:"flat",color:"success",class:{inputWrapper:["bg-success-100","text-success-600","dark:text-success","placeholder:text-success-600","dark:placeholder:text-success","data-[hover=true]:bg-success-50","group-data-[focus=true]:bg-success-50"],input:"placeholder:text-success-600 dark:placeholder:text-success",label:"text-success-600 dark:text-success"}},{variant:"flat",color:"warning",class:{inputWrapper:["bg-warning-100","text-warning-600","dark:text-warning","placeholder:text-warning-600","dark:placeholder:text-warning","data-[hover=true]:bg-warning-50","group-data-[focus=true]:bg-warning-50"],input:"placeholder:text-warning-600 dark:placeholder:text-warning",label:"text-warning-600 dark:text-warning"}},{variant:"flat",color:"danger",class:{inputWrapper:["bg-danger-100","text-danger","dark:text-danger-500","placeholder:text-danger","dark:placeholder:text-danger-500","data-[hover=true]:bg-danger-50","group-data-[focus=true]:bg-danger-50"],input:"placeholder:text-danger dark:placeholder:text-danger-500",label:"text-danger dark:text-danger-500"}},{variant:"faded",color:"primary",class:{label:"text-primary",inputWrapper:"data-[hover=true]:border-primary focus-within:border-primary"}},{variant:"faded",color:"secondary",class:{label:"text-secondary",inputWrapper:"data-[hover=true]:border-secondary focus-within:border-secondary"}},{variant:"faded",color:"success",class:{label:"text-success",inputWrapper:"data-[hover=true]:border-success focus-within:border-success"}},{variant:"faded",color:"warning",class:{label:"text-warning",inputWrapper:"data-[hover=true]:border-warning focus-within:border-warning"}},{variant:"faded",color:"danger",class:{label:"text-danger",inputWrapper:"data-[hover=true]:border-danger focus-within:border-danger"}},{variant:"underlined",color:"default",class:{input:"group-data-[has-value=true]:text-foreground"}},{variant:"underlined",color:"primary",class:{inputWrapper:"after:bg-primary",label:"text-primary"}},{variant:"underlined",color:"secondary",class:{inputWrapper:"after:bg-secondary",label:"text-secondary"}},{variant:"underlined",color:"success",class:{inputWrapper:"after:bg-success",label:"text-success"}},{variant:"underlined",color:"warning",class:{inputWrapper:"after:bg-warning",label:"text-warning"}},{variant:"underlined",color:"danger",class:{inputWrapper:"after:bg-danger",label:"text-danger"}},{variant:"bordered",color:"primary",class:{inputWrapper:["group-data-[focus=true]:border-primary","group-data-[focus=true]:data-[hover=true]:border-primary"],label:"text-primary"}},{variant:"bordered",color:"secondary",class:{inputWrapper:["group-data-[focus=true]:border-secondary","group-data-[focus=true]:data-[hover=true]:border-secondary"],label:"text-secondary"}},{variant:"bordered",color:"success",class:{inputWrapper:["group-data-[focus=true]:border-success","group-data-[focus=true]:data-[hover=true]:border-success"],label:"text-success"}},{variant:"bordered",color:"warning",class:{inputWrapper:["group-data-[focus=true]:border-warning","group-data-[focus=true]:data-[hover=true]:border-warning"],label:"text-warning"}},{variant:"bordered",color:"danger",class:{inputWrapper:["group-data-[focus=true]:border-danger","group-data-[focus=true]:data-[hover=true]:border-danger"],label:"text-danger"}},{labelPlacement:"inside",color:"default",class:{label:"group-data-[filled-within=true]:text-default-600"}},{labelPlacement:"outside",color:"default",class:{label:"group-data-[filled-within=true]:text-foreground"}},{radius:"full",size:["sm"],class:{inputWrapper:"px-3"}},{radius:"full",size:"md",class:{inputWrapper:"px-4"}},{radius:"full",size:"lg",class:{inputWrapper:"px-5"}},{disableAnimation:!1,variant:["faded","bordered"],class:{inputWrapper:"transition-colors motion-reduce:transition-none"}},{disableAnimation:!1,variant:"underlined",class:{inputWrapper:"after:transition-width motion-reduce:after:transition-none"}},{variant:["flat","faded"],class:{inputWrapper:[...p]}},{isInvalid:!0,variant:"flat",class:{inputWrapper:["!bg-danger-50","data-[hover=true]:!bg-danger-100","group-data-[focus=true]:!bg-danger-50"]}},{isInvalid:!0,variant:"bordered",class:{inputWrapper:"!border-danger group-data-[focus=true]:!border-danger"}},{isInvalid:!0,variant:"underlined",class:{inputWrapper:"after:!bg-danger"}},{labelPlacement:"inside",size:"sm",class:{inputWrapper:"h-12 py-1.5 px-3"}},{labelPlacement:"inside",size:"md",class:{inputWrapper:"h-14 py-2"}},{labelPlacement:"inside",size:"lg",class:{inputWrapper:"h-16 py-2.5 gap-0"}},{labelPlacement:"inside",size:"sm",variant:["bordered","faded"],class:{inputWrapper:"py-1"}},{labelPlacement:["inside","outside"],class:{label:["group-data-[filled-within=true]:pointer-events-auto"]}},{labelPlacement:"outside",class:{base:"relative justify-end",label:["pb-0","z-20","top-1/2","-translate-y-1/2","group-data-[filled-within=true]:start-0"]}},{labelPlacement:["inside"],class:{label:["group-data-[filled-within=true]:scale-85"]}},{labelPlacement:"inside",size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_8px)]"]}},{labelPlacement:"inside",size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_6px)]"]}},{labelPlacement:"inside",size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_8px)]"]}},{labelPlacement:["inside"],variant:"flat",class:{innerWrapper:"pb-0.5"}},{variant:"underlined",size:"sm",class:{innerWrapper:"pb-1"}},{variant:"underlined",size:["md","lg"],class:{innerWrapper:"pb-1.5"}},{labelPlacement:"inside",size:["sm","md"],class:{label:"text-small",stepperButton:"before:h-6"}},{labelPlacement:"inside",variant:["faded","bordered"],size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_8px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_6px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_8px_-_var(--heroui-border-width-medium))]"]}},{labelPlacement:"inside",variant:"underlined",size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-tiny)/2_-_5px)]"]}},{labelPlacement:"inside",variant:"underlined",size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_3.5px)]"]}},{labelPlacement:"inside",variant:"underlined",size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_var(--heroui-font-size-small)/2_-_4px)]"]}},{labelPlacement:"outside",size:"sm",class:{label:["start-2","text-tiny","group-data-[filled-within=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-tiny)/2_+_16px)]"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_8px)]",stepperButton:"before:h-4"}},{labelPlacement:"outside",size:"md",class:{label:["start-3","end-auto","text-small","group-data-[filled-within=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-small)/2_+_20px)]"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_10px)]",stepperButton:"before:h-4"}},{labelPlacement:"outside",size:"lg",class:{label:["start-3","end-auto","text-medium","group-data-[filled-within=true]:-translate-y-[calc(100%_+_var(--heroui-font-size-small)/2_+_24px)]"],base:"data-[has-label=true]:mt-[calc(var(--heroui-font-size-small)_+_12px)]",stepperButton:"min-4 w-4 h-4 before:h-6"}},{labelPlacement:"outside-left",size:"sm",class:{label:"group-data-[has-helper=true]:pt-2",stepperButton:"before:h-4"}},{labelPlacement:"outside-left",size:"md",class:{label:"group-data-[has-helper=true]:pt-3",stepperButton:"before:h-4"}},{labelPlacement:"outside-left",size:"lg",class:{label:"group-data-[has-helper=true]:pt-4",stepperButton:"min-4 w-4 h-4 before:h-6"}},{labelPlacement:["inside","outside"],class:{label:["pe-2","max-w-full","text-ellipsis","overflow-hidden"]}},{isClearable:!0,isDisabled:!0,class:{clearButton:"peer-data-[filled=true]:pointer-events-none"}}]}),(0,d.tv)({slots:{base:"relative z-[100]"},variants:{disableAnimation:{false:{base:""},true:{base:["data-[placement=bottom-right]:bottom-0 data-[placement=bottom-right]:right-0 w-full px-2 sm:w-auto sm:px-0 data-[placement=bottom-right]:fixed data-[placement=bottom-right]:flex data-[placement=bottom-right]:flex-col","data-[placement=bottom-left]:bottom-0 data-[placement=bottom-left]:left-0 w-full px-2 sm:w-auto sm:px-0 data-[placement=bottom-left]:fixed data-[placement=bottom-left]:flex data-[placement=bottom-left]:flex-col","data-[placement=bottom-center]:bottom-0 data-[placement=bottom-center]:fixed w-full px-2 sm:w-auto sm:px-0 data-[placement=bottom-center]:flex data-[placement=bottom-center]:flex-col data-[placement=bottom-center]:left-1/2 data-[placement=bottom-center]:-translate-x-1/2","data-[placement=top-right]:top-0 data-[placement=top-right]:right-0 w-full px-2 sm:w-auto sm:px-0 data-[placement=top-right]:fixed data-[placement=top-right]:flex data-[placement=top-right]:flex-col","data-[placement=top-left]:top-0 data-[placement=top-left]:left-0 w-full px-2 sm:w-auto sm:px-0 data-[placement=top-left]:fixed data-[placement=top-left]:flex data-[placement=top-left]:flex-col","data-[placement=top-center]:top-0 data-[placement=top-center]:fixed w-full px-2 sm:w-auto sm:px-0 data-[placement=top-center]:flex data-[placement=top-center]:flex-col data-[placement=top-center]:left-1/2 data-[placement=top-center]:-translate-x-1/2"]}}},defaultVariants:{disableAnimation:!1}}),(0,d.tv)({slots:{base:["flex gap-x-4 items-center","group","cursor-pointer","relative","z-50","box-border","outline-solid outline-transparent","p-3 sm:mx-1","my-1","w-full sm:w-[356px]","min-h-4","before:content-['']","before:absolute","before:left-0","before:right-0","data-[placement=bottom-right]:before:h-[var(--top-extension,16px)]","data-[placement=bottom-left]:before:h-[var(--top-extension,16px)]","data-[placement=bottom-center]:before:h-[var(--top-extension,16px)]","data-[placement=bottom-right]:before:top-[calc(-1*var(--top-extension,16px))]","data-[placement=bottom-left]:before:top-[calc(-1*var(--top-extension,16px))]","data-[placement=bottom-center]:before:top-[calc(-1*var(--top-extension,16px))]","before:z-[-1]","before:pointer-events-auto","before:bg-transparent","after:content-['']","after:absolute","after:left-0","after:right-0","data-[placement=bottom-right]:after:h-[var(--bottom-extension,16px)]","data-[placement=bottom-left]:after:h-[var(--bottom-extension,16px)]","data-[placement=bottom-center]:after:h-[var(--bottom-extension,16px)]","data-[placement=bottom-right]:after:bottom-[calc(-1*var(--bottom-extension,16px))]","data-[placement=bottom-left]:after:bottom-[calc(-1*var(--bottom-extension,16px))]","data-[placement=bottom-center]:after:bottom-[calc(-1*var(--bottom-extension,16px))]","after:z-[-1]","after:pointer-events-auto","after:bg-transparent","transform-gpu","will-change-transform","backface-visibility-hidden"],wrapper:["flex flex-col gap-y-0 min-w-0"],title:["text-sm","me-4","font-medium","text-foreground","truncate"],description:["text-sm","me-4","text-default-500","break-words"],icon:["w-6 h-6 flex-none fill-current"],loadingComponent:["w-6 h-6 flex-none fill-current"],content:["flex flex-grow flex-row gap-x-4 items-center relative min-w-0"],progressTrack:["absolute inset-0 pointer-events-none bg-transparent overflow-hidden"],progressIndicator:["h-full bg-default-400 opacity-20"],motionDiv:["fixed","px-4 sm:px-0","data-[placement=bottom-right]:bottom-0 data-[placement=bottom-right]:right-0 data-[placement=bottom-right]:mx-auto w-full sm:data-[placement=bottom-right]:w-max mb-1 sm:data-[placement=bottom-right]:mr-2","data-[placement=bottom-left]:bottom-0 data-[placement=bottom-left]:left-0 data-[placement=bottom-left]:mx-auto w-full sm:data-[placement=bottom-left]:w-max mb-1 sm:data-[placement=bottom-left]:ml-2","data-[placement=bottom-center]:bottom-0 data-[placement=bottom-center]:left-0 data-[placement=bottom-center]:right-0 w-full sm:data-[placement=bottom-center]:w-max sm:data-[placement=bottom-center]:mx-auto","data-[placement=top-right]:top-0 data-[placement=top-right]:right-0 data-[placement=top-right]:mx-auto w-full sm:data-[placement=top-right]:w-max sm:data-[placement=top-right]:mr-2","data-[placement=top-left]:top-0 data-[placement=top-left]:left-0 data-[placement=top-left]:mx-auto w-full sm:data-[placement=top-left]:w-max sm:data-[placement=top-left]:ml-2","data-[placement=top-center]:top-0 data-[placement=top-center]:left-0 data-[placement=top-center]:right-0 w-full sm:data-[placement=top-center]:w-max sm:data-[placement=top-center]:mx-auto"],closeButton:["opacity-0 group-hover:opacity-100","transform-gpu","transition-all duration-200 ease-out","will-change-opacity will-change-transform","p-0 group-hover:pointer-events-auto w-6 h-6 min-w-4 absolute -right-2 -top-2 items-center justify-center bg-transparent text-default-400 hover:text-default-600 border border-3 border-transparent","data-[hidden=true]:hidden"],closeIcon:["rounded-full w-full h-full p-0.5 border border-default-400 bg-default-100"]},variants:{size:{sm:{icon:"w-5 h-5",loadingComponent:"w-5 h-5"},md:{},lg:{}},variant:{flat:"bg-content1 border border-default-100",solid:r.default,bordered:"bg-background border border-default-200"},color:{default:"",foreground:{progressIndicator:"h-full opacity-20 bg-foreground-400"},primary:{progressIndicator:"h-full opacity-20 bg-primary-400"},secondary:{progressIndicator:"h-full opacity-20 bg-secondary-400"},success:{progressIndicator:"h-full opacity-20 bg-success-400"},warning:{progressIndicator:"h-full opacity-20 bg-warning-400"},danger:{progressIndicator:"h-full opacity-20 bg-danger-400"}},radius:{none:{base:"rounded-none",progressTrack:"rounded-none"},sm:{base:"rounded-small",progressTrack:"rounded-small"},md:{base:"rounded-medium",progressTrack:"rounded-medium"},lg:{base:"rounded-large",progressTrack:"rounded-large"},full:{base:"rounded-full",closeButton:"-top-px -right-px",progressTrack:"rounded-full"}},disableAnimation:{true:{closeButton:"transition-none",base:"data-[animation=exiting]:opacity-0 transition-none"},false:{closeButton:"transition-all ease-out duration-200",base:["data-[toast-exiting=true]:transform-gpu","data-[toast-exiting=true]:will-change-transform","data-[toast-exiting=true]:transition-all","data-[toast-exiting=true]:ease-out","data-[toast-exiting=true]:data-[placement=bottom-right]:translate-x-full","data-[toast-exiting=true]:data-[placement=bottom-left]:-translate-x-full","data-[toast-exiting=true]:data-[placement=bottom-center]:translate-y-full","data-[toast-exiting=true]:data-[placement=top-right]:translate-x-full","data-[toast-exiting=true]:data-[placement=top-left]:-translate-x-full","data-[toast-exiting=true]:data-[placement=top-center]:-translate-y-full","data-[toast-exiting=true]:opacity-0","data-[toast-exiting=true]:duration-300","data-[toast-exiting=true]:ease-out"]}},shadow:{none:{base:"shadow-none"},sm:{base:"shadow-small"},md:{base:"shadow-medium"},lg:{base:"shadow-large"}}},defaultVariants:{size:"md",variant:"flat",radius:"md",shadow:"sm"},compoundVariants:[{variant:"flat",color:"foreground",class:{base:"bg-foreground text-background",closeButton:"text-foreground-400 hover:text-foreground-600",closeIcon:"border border-foreground-400 bg-foreground-100",title:"text-background-600",description:"text-background-500"}},{variant:"flat",color:"primary",class:{base:"bg-primary-50 text-primary-600 border-primary-100",closeButton:"text-primary-400 hover:text-primary-600",closeIcon:"border border-primary-400 bg-primary-100",title:"text-primary-600",description:"text-primary-500"}},{variant:"flat",color:"secondary",class:{base:"bg-secondary-50 text-secondary-600 border-secondary-100",closeButton:"text-secondary-400 hover:text-secondary-600",closeIcon:"border border-secondary-400 bg-secondary-100",title:"text-secondary-600",description:"text-secondary-500"}},{variant:"flat",color:"success",class:{base:"bg-success-50 text-success-600 border-success-100",closeButton:"text-success-400 hover:text-success-600",closeIcon:"border border-success-400 bg-success-100",title:"text-success-600",description:"text-success-500"}},{variant:"flat",color:"warning",class:{base:"bg-warning-50 text-warning-600 border-warning-100",closeButton:"text-warning-400 hover:text-warning-600",closeIcon:"border border-warning-400 bg-warning-100",title:"text-warning-600",description:"text-warning-500"}},{variant:"flat",color:"danger",class:{base:"bg-danger-50 text-danger-600 border-danger-100",closeButton:"text-danger-400 hover:text-danger-600",closeIcon:"border border-danger-400 bg-danger-100",title:"text-danger-600",description:"text-danger-500"}},{variant:"bordered",color:"foreground",class:{base:"bg-foreground border-foreground-400 text-background",closeButton:"text-foreground-400 hover:text-foreground-600",closeIcon:"border border-foreground-400 bg-foreground-100",title:"text-background-600",description:"text-background-500"}},{variant:"bordered",color:"primary",class:{base:"border-primary-400 text-primary-600",closeButton:"text-primary-400 hover:text-primary-600",closeIcon:"border border-primary-400 bg-primary-100",title:"text-primary-600",description:"text-primary-500"}},{variant:"bordered",color:"secondary",class:{base:"border-secondary-400 text-secondary-600",closeButton:"text-secondary-400 hover:text-secondary-600",closeIcon:"border border-secondary-400 bg-secondary-100",title:"text-secondary-600",description:"text-secondary-500"}},{variant:"bordered",color:"success",class:{base:"border-success-400 text-success-600",closeButton:"text-success-400 hover:text-success-600",closeIcon:"border border-success-400 bg-success-100",title:"text-success-600",description:"text-success-500"}},{variant:"bordered",color:"warning",class:{base:"border-warning-400 text-warning-600",closeButton:"text-warning-400 hover:text-warning-600",closeIcon:"border border-warning-400 bg-warning-100",title:"text-warning-600",description:"text-warning-500"}},{variant:"bordered",color:"danger",class:{base:"border-danger-400 text-danger-600",closeButton:"text-danger-400 hover:text-danger-600",closeIcon:"border border-danger-400 bg-danger-100",title:"text-danger-600",description:"text-danger-500"}},{variant:"solid",color:"foreground",class:{base:r.foreground,closeButton:"text-foreground-400 hover:text-foreground-600",closeIcon:"border border-foreground-400 bg-foreground-100",title:"text-background",description:"text-background"}},{variant:"solid",color:"primary",class:{base:r.primary,closeButton:"text-primary-400 hover:text-primary-600",closeIcon:"border border-primary-400 bg-primary-100",title:"text-primary-foreground",description:"text-primary-foreground"}},{variant:"solid",color:"secondary",class:{base:r.secondary,closeButton:"text-secondary-400 hover:text-secondary-600",closeIcon:"border border-secondary-400 bg-secondary-100",title:"text-secondary-foreground",description:"text-secondary-foreground"}},{variant:"solid",color:"success",class:{base:r.success,closeButton:"text-success-400 hover:text-success-600",closeIcon:"border border-success-400 bg-success-100",title:"text-success-foreground",description:"text-success-foreground"}},{variant:"solid",color:"warning",class:{base:r.warning,closeButton:"text-warning-400 hover:text-warning-600",closeIcon:"border border-warning-400 bg-warning-100",title:"text-warning-foreground",description:"text-warning-foreground"}},{variant:"solid",color:"danger",class:{base:r.danger,closeButton:"text-danger-400 hover:text-danger-600",closeIcon:"border border-danger-400 bg-danger-100",title:"text-danger-foreground",description:"text-danger-foreground"}}]}),(e,t)=>{if(!e&&!t)return{};const n=new Set([...Object.keys(e||{}),...Object.keys(t||{})]);return Array.from(n).reduce((n,r)=>({...n,[r]:(0,u.cn)(null==e?void 0:e[r],null==t?void 0:t[r])}),{})})},2715:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9599),i=n(7330),a=n(3808),o=n(8845);t.iteratee=function(e){if(null==e)return r.identity;switch(typeof e){case"function":return e;case"object":return Array.isArray(e)&&2===e.length?o.matchesProperty(e[0],e[1]):a.matches(e);case"string":case"symbol":case"number":return i.property(e)}}},2730:function(e,t,n){"use strict";var r=n(5043),i=n(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function A(e){return e[1].toUpperCase()}function y(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,A);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,A);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,A);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),_=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),M=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function j(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var D,I=Object.assign;function B(e){if(void 0===D)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);D=t&&t[1]||""}return"\n"+D+e}var F=!1;function z(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var l="\n"+i[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function U(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case _:return"Portal";case T:return"Profiler";case S:return"StrictMode";case P:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function $(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return I({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=q(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function J(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return I({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function ae(e,t){var n=q(t.value),r=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ve=I({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ae(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,we=null,Se=null;function Te(e){if(e=yi(e)){if("function"!==typeof _e)throw Error(a(280));var t=e.stateNode;t&&(t=xi(t),_e(e.stateNode,e.type,t))}}function Ce(e){we?Se?Se.push(e):Se=[e]:we=e}function Me(){if(we){var e=we,t=Se;if(Se=we=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Ee(e,t){return e(t)}function Pe(){}var Ne=!1;function ke(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ee(e,t,n)}finally{Ne=!1,(null!==we||null!==Se)&&(Pe(),Me())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=xi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Le=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){Le=!1}function je(e,t,n,r,i,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var De=!1,Ie=null,Be=!1,Fe=null,ze={onError:function(e){De=!0,Ie=e}};function Ue(e,t,n,r,i,a,o,s,l){De=!1,Ie=null,je.apply(ze,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Ve(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return qe(i),e;if(o===r)return qe(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var $e=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Ye=i.unstable_requestPaint,Qe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,Je=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=dt(s):0!==(a&=o)&&(r=dt(a))}else 0!==(o=n&~i)?r=dt(o):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function At(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var yt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,_t,wt,St,Tt,Ct=!1,Mt=[],Et=null,Pt=null,Nt=null,kt=new Map,Rt=new Map,Lt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Dt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=yi(t))&&_t(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function It(e){var t=Ai(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Tt(e.priority,function(){wt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yi(n))&&_t(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Ft(e,t,n){Bt(e)&&n.delete(t)}function zt(){Ct=!1,null!==Et&&Bt(Et)&&(Et=null),null!==Pt&&Bt(Pt)&&(Pt=null),null!==Nt&&Bt(Nt)&&(Nt=null),kt.forEach(Ft),Rt.forEach(Ft)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,zt)))}function Vt(e){function t(t){return Ut(t,e)}if(0<Mt.length){Ut(Mt[0],e);for(var n=1;n<Mt.length;n++){var r=Mt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&Ut(Et,e),null!==Pt&&Ut(Pt,e),null!==Nt&&Ut(Nt,e),kt.forEach(t),Rt.forEach(t),n=0;n<Lt.length;n++)(r=Lt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)It(n),null===n.blockedOn&&Lt.shift()}var Gt=b.ReactCurrentBatchConfig,qt=!0;function Wt(e,t,n,r){var i=yt,a=Gt.transition;Gt.transition=null;try{yt=1,$t(e,t,n,r)}finally{yt=i,Gt.transition=a}}function Ht(e,t,n,r){var i=yt,a=Gt.transition;Gt.transition=null;try{yt=4,$t(e,t,n,r)}finally{yt=i,Gt.transition=a}}function $t(e,t,n,r){if(qt){var i=Xt(e,t,n,r);if(null===i)qr(e,t,r,Kt,n),jt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Et=Dt(Et,e,t,n,r,i),!0;case"dragenter":return Pt=Dt(Pt,e,t,n,r,i),!0;case"mouseover":return Nt=Dt(Nt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return kt.set(a,Dt(kt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Rt.set(a,Dt(Rt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(jt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var a=yi(i);if(null!==a&&xt(a),null===(a=Xt(e,t,n,r))&&qr(e,t,r,Kt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else qr(e,t,r,null,n)}}var Kt=null;function Xt(e,t,n,r){if(Kt=null,null!==(e=Ai(e=xe(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,Jt=null;function en(){if(Jt)return Jt;var e,t,n=Zt,r=n.length,i="value"in Qt?Qt.value:Qt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Jt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return I(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),dn=I({},cn,{view:0,detail:0}),hn=an(dn),pn=I({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=an(pn),mn=an(I({},pn,{dataTransfer:0})),gn=an(I({},dn,{relatedTarget:0})),vn=an(I({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),An=I({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(An),bn=an(I({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function Tn(){return Sn}var Cn=I({},dn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mn=an(Cn),En=an(I({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=an(I({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Nn=an(I({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=I({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=an(kn),Ln=[9,13,27,32],On=u&&"CompositionEvent"in window,jn=null;u&&"documentMode"in document&&(jn=document.documentMode);var Dn=u&&"TextEvent"in window&&!jn,In=u&&(!On||jn&&8<jn&&11>=jn),Bn=String.fromCharCode(32),Fn=!1;function zn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ce(r),0<(t=Hr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,$n=null;function Kn(e){Br(e,0)}function Xn(e){if($(bi(e)))return e}function Yn(e,t){if("change"===e)return t}var Qn=!1;if(u){var Zn;if(u){var Jn="oninput"in document;if(!Jn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Jn="function"===typeof er.oninput}Zn=Jn}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),$n=Hn=null)}function nr(e){if("value"===e.propertyName&&Xn($n)){var t=[];Wn(t,$n,e,xe(e)),ke(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),$n=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn($n)}function ar(e,t){if("click"===e)return Xn(t)}function or(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=ur(n,a);var o=ur(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,Ar=null,yr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==gr||gr!==K(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Ar&&lr(Ar,r)||(Ar=r,0<(r=Hr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _r={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},wr={},Sr={};function Tr(e){if(wr[e])return wr[e];if(!_r[e])return e;var t,n=_r[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return wr[e]=n[t];return e}u&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete _r.animationend.animation,delete _r.animationiteration.animation,delete _r.animationstart.animation),"TransitionEvent"in window||delete _r.transitionend.transition);var Cr=Tr("animationend"),Mr=Tr("animationiteration"),Er=Tr("animationstart"),Pr=Tr("transitionend"),Nr=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){Nr.set(e,t),l(t,[e])}for(var Lr=0;Lr<kr.length;Lr++){var Or=kr[Lr];Rr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Rr(Cr,"onAnimationEnd"),Rr(Mr,"onAnimationIteration"),Rr(Er,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Pr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dr=new Set("cancel close invalid load scroll toggle".split(" ").concat(jr));function Ir(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,l,c){if(Ue.apply(this,arguments),De){if(!De)throw Error(a(198));var u=Ie;De=!1,Ie=null,Be||(Be=!0,Fe=u)}}(r,t,void 0,e),e.currentTarget=null}function Br(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;Ir(i,s,c),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;Ir(i,s,c),a=l}}}if(Be)throw e=Fe,Be=!1,Fe=null,e}function Fr(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Ur]){e[Ur]=!0,o.forEach(function(t){"selectionchange"!==t&&(Dr.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,zr("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Yt(t)){case 1:var i=Wt;break;case 4:i=Ht;break;default:i=$t}n=i.bind(null,t,n,e),i=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function qr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=Ai(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}ke(function(){var r=a,i=xe(n),o=[];e:{var s=Nr.get(e);if(void 0!==s){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Mn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Cr:case Mr:case Er:l=vn;break;case Pr:l=Nn;break;case"scroll":l=hn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Re(f,h))&&u.push(Wr(f,m,p)))),d)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,i),o.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!Ai(c)&&!c[fi])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?Ai(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=En,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?s:bi(l),p=null==c?s:bi(c),(s=new u(m,f+"leave",l,n,i)).target=d,s.relatedTarget=p,m=null,Ai(i)===r&&((u=new u(h,f+"enter",c,n,i)).target=p,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,f=0,p=u=l;p;p=$r(p))f++;for(p=0,m=h;m;m=$r(m))p++;for(;0<f-p;)u=$r(u),f--;for(;0<p-f;)h=$r(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=$r(u),h=$r(h)}u=null}else u=null;null!==l&&Kr(o,s,l,u,!1),null!==c&&null!==d&&Kr(o,d,c,u,!0)}if("select"===(l=(s=r?bi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Yn;else if(qn(s))if(Qn)g=or;else{g=ir;var v=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ar);switch(g&&(g=g(e,r))?Wn(o,g,n,i):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=r?bi(r):window,e){case"focusin":(qn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,Ar=null);break;case"focusout":Ar=vr=gr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,br(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":br(o,n,i)}var A;if(On)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Vn?zn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(In&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Vn&&(A=en()):(Zt="value"in(Qt=i)?Qt.value:Qt.textContent,Vn=!0)),0<(v=Hr(r,y)).length&&(y=new bn(y,e,null,n,i),o.push({event:y,listeners:v}),A?y.data=A:null!==(A=Un(n))&&(y.data=A))),(A=Dn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Fn=!0,Bn);case"textInput":return(e=t.data)===Bn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!On&&zn(e,t)?(e=en(),Jt=Zt=Qt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return In&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=A))}Br(o,t)})}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Re(e,n))&&r.unshift(Wr(e,a,i)),null!=(a=Re(e,t))&&r.push(Wr(e,a,i))),e=e.return}return r}function $r(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(l=Re(n,a))&&o.unshift(Wr(n,l,s)):i||null!=(l=Re(n,a))&&o.push(Wr(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Xr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Yr,"")}function Zr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(a(425))}function Jr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,oi="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout(function(){throw e})}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Vt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,pi="__reactProps$"+di,fi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,vi="__reactHandles$"+di;function Ai(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function yi(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function xi(e){return e[pi]||null}var _i=[],wi=-1;function Si(e){return{current:e}}function Ti(e){0>wi||(e.current=_i[wi],_i[wi]=null,wi--)}function Ci(e,t){wi++,_i[wi]=e.current,e.current=t}var Mi={},Ei=Si(Mi),Pi=Si(!1),Ni=Mi;function ki(e,t){var n=e.type.contextTypes;if(!n)return Mi;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ri(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Li(){Ti(Pi),Ti(Ei)}function Oi(e,t,n){if(Ei.current!==Mi)throw Error(a(168));Ci(Ei,t),Ci(Pi,n)}function ji(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,G(e)||"Unknown",i));return I({},n,r)}function Di(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mi,Ni=Ei.current,Ci(Ei,e),Ci(Pi,Pi.current),!0}function Ii(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=ji(e,t,Ni),r.__reactInternalMemoizedMergedChildContext=e,Ti(Pi),Ti(Ei),Ci(Ei,e)):Ti(Pi),Ci(Pi,n)}var Bi=null,Fi=!1,zi=!1;function Ui(e){null===Bi?Bi=[e]:Bi.push(e)}function Vi(){if(!zi&&null!==Bi){zi=!0;var e=0,t=yt;try{var n=Bi;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Bi=null,Fi=!1}catch(i){throw null!==Bi&&(Bi=Bi.slice(e+1)),$e(Je,Vi),i}finally{yt=t,zi=!1}}return null}var Gi=[],qi=0,Wi=null,Hi=0,$i=[],Ki=0,Xi=null,Yi=1,Qi="";function Zi(e,t){Gi[qi++]=Hi,Gi[qi++]=Wi,Wi=e,Hi=t}function Ji(e,t,n){$i[Ki++]=Yi,$i[Ki++]=Qi,$i[Ki++]=Xi,Xi=e;var r=Yi;e=Qi;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var a=32-ot(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Yi=1<<32-ot(t)+i|n<<i|r,Qi=a+e}else Yi=1<<a|n<<i|r,Qi=e}function ea(e){null!==e.return&&(Zi(e,1),Ji(e,1,0))}function ta(e){for(;e===Wi;)Wi=Gi[--qi],Gi[qi]=null,Hi=Gi[--qi],Gi[qi]=null;for(;e===Xi;)Xi=$i[--Ki],$i[Ki]=null,Qi=$i[--Ki],$i[Ki]=null,Yi=$i[--Ki],$i[Ki]=null}var na=null,ra=null,ia=!1,aa=null;function oa(e,t){var n=kc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Yi,overflow:Qi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=kc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(ia){var t=ra;if(t){var n=t;if(!sa(e,t)){if(la(e))throw Error(a(418));t=ci(n.nextSibling);var r=na;t&&sa(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function da(e){if(e!==na)return!1;if(!ia)return ua(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(la(e))throw ha(),Error(a(418));for(;t;)oa(e,t),t=ci(t.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?ci(e.stateNode.nextSibling):null;return!0}function ha(){for(var e=ra;e;)e=ci(e.nextSibling)}function pa(){ra=na=null,ia=!1}function fa(e){null===aa?aa=[e]:aa.push(e)}var ma=b.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function va(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Aa(e){return(0,e._init)(e._payload)}function ya(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Ic(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===w?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===R&&Aa(a)===t.type)?((r=i(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=jc(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ic(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case _:return(t=Bc(t,e.mode,n)).return=e,t;case R:return h(e,(0,t._init)(t._payload),n)}if(te(t)||j(t))return(t=jc(t,e.mode,n,null)).return=e,t;va(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(e,t,n,r):null;case _:return n.key===i?u(e,t,n,r):null;case R:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||j(n))return null!==i?null:d(e,t,n,r,null);va(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case _:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case R:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||j(r))return d(t,e=e.get(n)||null,r,i,null);va(t,r)}return null}function m(i,a,s,l){for(var c=null,u=null,d=a,m=a=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(i,d,s[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(i,d),a=o(v,a,m),null===u?c=v:u.sibling=v,u=v,d=g}if(m===s.length)return n(i,d),ia&&Zi(i,m),c;if(null===d){for(;m<s.length;m++)null!==(d=h(i,s[m],l))&&(a=o(d,a,m),null===u?c=d:u.sibling=d,u=d);return ia&&Zi(i,m),c}for(d=r(i,d);m<s.length;m++)null!==(g=f(d,i,m,s[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),a=o(g,a,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(i,e)}),ia&&Zi(i,m),c}function g(i,s,l,c){var u=j(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,m=s,g=s=0,v=null,A=l.next();null!==m&&!A.done;g++,A=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=p(i,m,A.value,c);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(i,m),s=o(y,s,g),null===d?u=y:d.sibling=y,d=y,m=v}if(A.done)return n(i,m),ia&&Zi(i,g),u;if(null===m){for(;!A.done;g++,A=l.next())null!==(A=h(i,A.value,c))&&(s=o(A,s,g),null===d?u=A:d.sibling=A,d=A);return ia&&Zi(i,g),u}for(m=r(i,m);!A.done;g++,A=l.next())null!==(A=f(m,i,g,A.value,c))&&(e&&null!==A.alternate&&m.delete(null===A.key?g:A.key),s=o(A,s,g),null===d?u=A:d.sibling=A,d=A);return e&&m.forEach(function(e){return t(i,e)}),ia&&Zi(i,g),u}return function e(r,a,o,l){if("object"===typeof o&&null!==o&&o.type===w&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case x:e:{for(var c=o.key,u=a;null!==u;){if(u.key===c){if((c=o.type)===w){if(7===u.tag){n(r,u.sibling),(a=i(u,o.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&Aa(c)===u.type){n(r,u.sibling),(a=i(u,o.props)).ref=ga(r,u,o),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}o.type===w?((a=jc(o.props.children,r.mode,l,o.key)).return=r,r=a):((l=Oc(o.type,o.key,o.props,null,r.mode,l)).ref=ga(r,a,o),l.return=r,r=l)}return s(r);case _:e:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Bc(o,r.mode,l)).return=r,r=a}return s(r);case R:return e(r,a,(u=o._init)(o._payload),l)}if(te(o))return m(r,a,o,l);if(j(o))return g(r,a,o,l);va(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=Ic(o,r.mode,l)).return=r,r=a),s(r)):n(r,a)}}var ba=ya(!0),xa=ya(!1),_a=Si(null),wa=null,Sa=null,Ta=null;function Ca(){Ta=Sa=wa=null}function Ma(e){var t=_a.current;Ti(_a),e._currentValue=t}function Ea(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Pa(e,t){wa=e,Ta=Sa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ys=!0),e.firstContext=null)}function Na(e){var t=e._currentValue;if(Ta!==e)if(e={context:e,memoizedValue:t,next:null},null===Sa){if(null===wa)throw Error(a(308));Sa=e,wa.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return t}var ka=null;function Ra(e){null===ka?ka=[e]:ka.push(e)}function La(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ra(t)):(n.next=i.next,i.next=n),t.interleaved=n,Oa(e,r)}function Oa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ja=!1;function Da(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ia(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ba(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&El)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Oa(e,n)}return null===(i=r.interleaved)?(t.next=t,Ra(r)):(t.next=i.next,i.next=t),r.interleaved=t,Oa(e,n)}function za(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,At(e,n)}}function Ua(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Va(e,t,n,r){var i=e.updateQueue;ja=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=i.baseState;for(o=0,u=c=l=null,s=a;;){var h=s.lane,p=s.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=I({},d,h);break e;case 2:ja=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Dl|=o,e.lanes=o,e.memoizedState=d}}function Ga(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var qa={},Wa=Si(qa),Ha=Si(qa),$a=Si(qa);function Ka(e){if(e===qa)throw Error(a(174));return e}function Xa(e,t){switch(Ci($a,t),Ci(Ha,e),Ci(Wa,qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ti(Wa),Ci(Wa,t)}function Ya(){Ti(Wa),Ti(Ha),Ti($a)}function Qa(e){Ka($a.current);var t=Ka(Wa.current),n=le(t,e.type);t!==n&&(Ci(Ha,e),Ci(Wa,n))}function Za(e){Ha.current===e&&(Ti(Wa),Ti(Ha))}var Ja=Si(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function no(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=b.ReactCurrentDispatcher,io=b.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,uo=!1,ho=0,po=0;function fo(){throw Error(a(321))}function mo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function go(e,t,n,r,i,o){if(ao=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?Jo:es,e=n(r,i),uo){o=0;do{if(uo=!1,ho=0,25<=o)throw Error(a(301));o+=1,lo=so=null,t.updateQueue=null,ro.current=ts,e=n(r,i)}while(uo)}if(ro.current=Zo,t=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,t)throw Error(a(300));return e}function vo(){var e=0!==ho;return ho=0,e}function Ao(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=e:lo=lo.next=e,lo}function yo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===lo?oo.memoizedState:lo.next;if(null!==t)lo=t,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=e:lo=lo.next=e}return lo}function bo(e,t){return"function"===typeof t?t(e):t}function xo(e){var t=yo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=so,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var l=s=null,c=null,u=o;do{var d=u.lane;if((ao&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,s=r):c=c.next=h,oo.lanes|=d,Dl|=d}u=u.next}while(null!==u&&u!==o);null===c?s=r:c.next=l,sr(r,t.memoizedState)||(ys=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,oo.lanes|=o,Dl|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function _o(e){var t=yo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(ys=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function wo(){}function So(e,t){var n=oo,r=yo(),i=t(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,ys=!0),r=r.queue,Do(Mo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==lo&&1&lo.memoizedState.tag){if(n.flags|=2048,ko(9,Co.bind(null,n,r,i,t),void 0,null),null===Pl)throw Error(a(349));0!==(30&ao)||To(n,t,i)}return i}function To(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Co(e,t,n,r){t.value=n,t.getSnapshot=r,Eo(t)&&Po(e)}function Mo(e,t,n){return n(function(){Eo(t)&&Po(e)})}function Eo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Po(e){var t=Oa(e,1);null!==t&&nc(t,e,1,-1)}function No(e){var t=Ao();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bo,lastRenderedState:e},t.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[t.memoizedState,e]}function ko(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ro(){return yo().memoizedState}function Lo(e,t,n,r){var i=Ao();oo.flags|=e,i.memoizedState=ko(1|t,n,void 0,void 0===r?null:r)}function Oo(e,t,n,r){var i=yo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&mo(r,o.deps))return void(i.memoizedState=ko(t,n,a,r))}oo.flags|=e,i.memoizedState=ko(1|t,n,a,r)}function jo(e,t){return Lo(8390656,8,e,t)}function Do(e,t){return Oo(2048,8,e,t)}function Io(e,t){return Oo(4,2,e,t)}function Bo(e,t){return Oo(4,4,e,t)}function Fo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Oo(4,4,Fo.bind(null,t,e),n)}function Uo(){}function Vo(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Go(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function qo(e,t,n){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,ys=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),oo.lanes|=n,Dl|=n,e.baseState=!0),t)}function Wo(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=io.transition;io.transition={};try{e(!1),t()}finally{yt=n,io.transition=r}}function Ho(){return yo().memoizedState}function $o(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xo(e))Yo(t,n);else if(null!==(n=La(e,t,n,r))){nc(n,e,r,ec()),Qo(n,t,r)}}function Ko(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xo(e))Yo(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var l=t.interleaved;return null===l?(i.next=i,Ra(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=La(e,t,i,r))&&(nc(n,e,r,i=ec()),Qo(n,t,r))}}function Xo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Yo(e,t){uo=co=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,At(e,n)}}var Zo={readContext:Na,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},Jo={readContext:Na,useCallback:function(e,t){return Ao().memoizedState=[e,void 0===t?null:t],e},useContext:Na,useEffect:jo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Lo(4194308,4,Fo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Lo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Lo(4,2,e,t)},useMemo:function(e,t){var n=Ao();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ao();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=$o.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ao().memoizedState=e},useState:No,useDebugValue:Uo,useDeferredValue:function(e){return Ao().memoizedState=e},useTransition:function(){var e=No(!1),t=e[0];return e=Wo.bind(null,e[1]),Ao().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=oo,i=Ao();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Pl)throw Error(a(349));0!==(30&ao)||To(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,jo(Mo.bind(null,r,o,e),[e]),r.flags|=2048,ko(9,Co.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Ao(),t=Pl.identifierPrefix;if(ia){var n=Qi;t=":"+t+"R"+(n=(Yi&~(1<<32-ot(Yi)-1)).toString(32)+n),0<(n=ho++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=po++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Na,useCallback:Vo,useContext:Na,useEffect:Do,useImperativeHandle:zo,useInsertionEffect:Io,useLayoutEffect:Bo,useMemo:Go,useReducer:xo,useRef:Ro,useState:function(){return xo(bo)},useDebugValue:Uo,useDeferredValue:function(e){return qo(yo(),so.memoizedState,e)},useTransition:function(){return[xo(bo)[0],yo().memoizedState]},useMutableSource:wo,useSyncExternalStore:So,useId:Ho,unstable_isNewReconciler:!1},ts={readContext:Na,useCallback:Vo,useContext:Na,useEffect:Do,useImperativeHandle:zo,useInsertionEffect:Io,useLayoutEffect:Bo,useMemo:Go,useReducer:_o,useRef:Ro,useState:function(){return _o(bo)},useDebugValue:Uo,useDeferredValue:function(e){var t=yo();return null===so?t.memoizedState=e:qo(t,so.memoizedState,e)},useTransition:function(){return[_o(bo)[0],yo().memoizedState]},useMutableSource:wo,useSyncExternalStore:So,useId:Ho,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=I({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:I({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),a=Ba(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Fa(e,a,i))&&(nc(t,e,i,r),za(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),a=Ba(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Fa(e,a,i))&&(nc(t,e,i,r),za(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=Ba(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Fa(e,i,r))&&(nc(t,e,r,n),za(t,e,r))}};function as(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,a))}function os(e,t,n){var r=!1,i=Mi,a=t.contextType;return"object"===typeof a&&null!==a?a=Na(a):(i=Ri(t)?Ni:Ei.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?ki(e,i):Mi),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=is,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&is.enqueueReplaceState(t,t.state,null)}function ls(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Da(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Na(a):(a=Ri(t)?Ni:Ei.current,i.context=ki(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&is.enqueueReplaceState(i,i.state,null),Va(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function us(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var hs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Ba(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ql||(ql=!0,Wl=r),ds(0,t)},n}function fs(e,t,n){(n=Ba(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ds(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new hs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Tc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ba(-1,1)).tag=2,Fa(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var As=b.ReactCurrentOwner,ys=!1;function bs(e,t,n,r){t.child=null===e?xa(t,null,n,r):ba(t,e.child,n,r)}function xs(e,t,n,r,i){n=n.render;var a=t.ref;return Pa(t,i),r=go(e,t,n,r,a,i),n=vo(),null===e||ys?(ia&&n&&ea(t),t.flags|=1,bs(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qs(e,t,i))}function _s(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Rc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,ws(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(o,r)&&e.ref===t.ref)return qs(e,t,i)}return t.flags|=1,(e=Lc(a,r)).ref=t.ref,e.return=t,t.child=e}function ws(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(ys=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,qs(e,t,i);0!==(131072&e.flags)&&(ys=!0)}}return Cs(e,t,n,r,i)}function Ss(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ci(Ll,Rl),Rl|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ci(Ll,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ci(Ll,Rl),Rl|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ci(Ll,Rl),Rl|=r;return bs(e,t,i,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,r,i){var a=Ri(n)?Ni:Ei.current;return a=ki(t,a),Pa(t,i),n=go(e,t,n,r,a,i),r=vo(),null===e||ys?(ia&&r&&ea(t),t.flags|=1,bs(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qs(e,t,i))}function Ms(e,t,n,r,i){if(Ri(n)){var a=!0;Di(t)}else a=!1;if(Pa(t,i),null===t.stateNode)Gs(e,t),os(t,n,r),ls(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Na(c):c=ki(t,c=Ri(n)?Ni:Ei.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==c)&&ss(t,o,r,c),ja=!1;var h=t.memoizedState;o.state=h,Va(t,r,o,i),l=t.memoizedState,s!==r||h!==l||Pi.current||ja?("function"===typeof u&&(rs(t,n,u,r),l=t.memoizedState),(s=ja||as(t,n,s,r,h,l,c))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Ia(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ns(t.type,s),o.props=c,d=t.pendingProps,h=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Na(l):l=ki(t,l=Ri(n)?Ni:Ei.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||h!==l)&&ss(t,o,r,l),ja=!1,h=t.memoizedState,o.state=h,Va(t,r,o,i);var f=t.memoizedState;s!==d||h!==f||Pi.current||ja?("function"===typeof p&&(rs(t,n,p,r),f=t.memoizedState),(c=ja||as(t,n,c,r,h,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Es(e,t,n,r,a,i)}function Es(e,t,n,r,i,a){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&Ii(t,n,!1),qs(e,t,a);r=t.stateNode,As.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=ba(t,e.child,null,a),t.child=ba(t,null,s,a)):bs(e,t,s,a),t.memoizedState=r.state,i&&Ii(t,n,!0),t.child}function Ps(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),Xa(e,t.containerInfo)}function Ns(e,t,n,r,i){return pa(),fa(i),t.flags|=256,bs(e,t,n,r),t.child}var ks,Rs,Ls,Os,js={dehydrated:null,treeContext:null,retryLane:0};function Ds(e){return{baseLanes:e,cachePool:null,transitions:null}}function Is(e,t,n){var r,i=t.pendingProps,o=Ja.current,s=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ci(Ja,1&o),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,s?(i=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Dc(l,i,0,null),e=jc(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ds(n),t.memoizedState=js,e):Bs(t,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Fs(e,t,s,r=us(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Dc({mode:"visible",children:r.children},i,0,null),(o=jc(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&ba(t,e.child,null,s),t.child.memoizedState=Ds(s),t.memoizedState=js,o);if(0===(1&t.mode))return Fs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Fs(e,t,s,r=us(o=Error(a(419)),r,void 0))}if(l=0!==(s&e.childLanes),ys||l){if(null!==(r=Pl)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Oa(e,i),nc(r,e,i,-1))}return mc(),Fs(e,t,s,r=us(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Mc.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ra=ci(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&($i[Ki++]=Yi,$i[Ki++]=Qi,$i[Ki++]=Xi,Yi=e.id,Qi=e.overflow,Xi=t),t=Bs(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,o,n);if(s){s=i.fallback,l=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Lc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Lc(r,s):(s=jc(s,l,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,l=null===(l=e.child.memoizedState)?Ds(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=js,i}return e=(s=e.child).sibling,i=Lc(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Bs(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fs(e,t,n,r){return null!==r&&fa(r),ba(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ea(e.return,t,n)}function Us(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Vs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(bs(e,t,r.children,n),0!==(2&(r=Ja.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zs(e,n,t);else if(19===e.tag)zs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ci(Ja,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===eo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Us(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===eo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Us(t,!0,n,null,a);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Dl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Lc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Lc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function $s(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Ri(t.type)&&Li(),Hs(t),null;case 3:return r=t.stateNode,Ya(),Ti(Pi),Ti(Ei),no(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(oc(aa),aa=null))),Rs(e,t),Hs(t),null;case 5:Za(t);var i=Ka($a.current);if(n=t.type,null!==e&&null!=t.stateNode)Ls(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Hs(t),null}if(e=Ka(Wa.current),da(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[hi]=t,r[pi]=o,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<jr.length;i++)Fr(jr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":Y(r,o),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Fr("invalid",r);break;case"textarea":ie(r,o),Fr("invalid",r)}for(var l in Ae(n,o),i=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fr("scroll",r)}switch(n){case"input":H(r),J(r,o,!0);break;case"textarea":H(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Jr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hi]=t,e[pi]=r,ks(e,t,!1,!1),t.stateNode=e;e:{switch(l=ye(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<jr.length;i++)Fr(jr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":Y(e,r),i=X(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=I({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(o in Ae(n,i),c=i)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Fr("scroll",e):null!=u&&y(e,o,u,l))}switch(n){case"input":H(e),J(e,r,!1);break;case"textarea":H(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+q(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Jr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Os(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ka($a.current),Ka(Wa.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(o=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Hs(t),null;case 13:if(Ti(Ja),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))ha(),pa(),t.flags|=98560,o=!1;else if(o=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[hi]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),o=!1}else null!==aa&&(oc(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Ja.current)?0===Ol&&(Ol=3):mc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return Ya(),Rs(e,t),null===e&&Vr(t.stateNode.containerInfo),Hs(t),null;case 10:return Ma(t.type._context),Hs(t),null;case 19:if(Ti(Ja),null===(o=t.memoizedState))return Hs(t),null;if(r=0!==(128&t.flags),null===(l=o.rendering))if(r)Ws(o,!1);else{if(0!==Ol||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=eo(e))){for(t.flags|=128,Ws(o,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ci(Ja,1&Ja.current|2),t.child}e=e.sibling}null!==o.tail&&Qe()>Vl&&(t.flags|=128,r=!0,Ws(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ia)return Hs(t),null}else 2*Qe()-o.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,r=!0,Ws(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Qe(),t.sibling=null,n=Ja.current,Ci(Ja,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ks(e,t){switch(ta(t),t.tag){case 1:return Ri(t.type)&&Li(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ya(),Ti(Pi),Ti(Ei),no(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(Ti(Ja),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ti(Ja),null;case 4:return Ya(),null;case 10:return Ma(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}ks=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Rs=function(){},Ls=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Ka(Wa.current);var a,o=null;switch(n){case"input":i=X(e,i),r=X(e,r),o=[];break;case"select":i=I({},i,{value:void 0}),r=I({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Jr)}for(u in Ae(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fr("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,Ys=!1,Qs="function"===typeof WeakSet?WeakSet:Set,Zs=null;function Js(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Sc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&el(t,n,a)}i=i.next}while(i!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function il(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[mi],delete t[gi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function sl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Jr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Ys||Js(n,t);case 6:var r=ul,i=dl;ul=null,hl(e,t,n),dl=i,null!==(ul=r)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Vt(e)):li(ul,n.stateNode));break;case 4:r=ul,i=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&el(n,t,o),i=i.next}while(i!==r)}hl(e,t,n);break;case 1:if(!Ys&&(Js(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Sc(n,t,s)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Ys=(r=Ys)||null!==n.memoizedState,hl(e,t,n),Ys=r):hl(e,t,n);break;default:hl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qs),t.forEach(function(t){var r=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(a(160));pl(o,s,i),ul=null,dl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Sc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(g){Sc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Sc(e,e.return,g)}}break;case 1:ml(t,e),vl(e),512&r&&null!==n&&Js(n,n.return);break;case 5:if(ml(t,e),vl(e),512&r&&null!==n&&Js(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Sc(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Q(i,o),ye(l,s);var u=ye(l,o);for(s=0;s<c.length;s+=2){var d=c[s],h=c[s+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):y(i,d,h,u)}switch(l){case"input":Z(i,o);break;case"textarea":ae(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(i,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[pi]=o}catch(g){Sc(e,e.return,g)}}break;case 6:if(ml(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(g){Sc(e,e.return,g)}}break;case 3:if(ml(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){Sc(e,e.return,g)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Ul=Qe())),4&r&&fl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ys=(u=Ys)||d,ml(t,e),Ys=u):ml(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Zs=e,d=e.child;null!==d;){for(h=Zs=d;null!==Zs;){switch(f=(p=Zs).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Js(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Sc(r,n,g)}}break;case 5:Js(p,p.return);break;case 22:if(null!==p.memoizedState){xl(h);continue}}null!==f?(f.return=p,Zs=f):xl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,s=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(g){Sc(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Sc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ml(t,e),vl(e),4&r&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ol(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),cl(e,sl(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;ll(e,sl(e),o);break;default:throw Error(a(161))}}catch(s){Sc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Al(e,t,n){Zs=e,yl(e,t,n)}function yl(e,t,n){for(var r=0!==(1&e.mode);null!==Zs;){var i=Zs,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Xs;if(!o){var s=i.alternate,l=null!==s&&null!==s.memoizedState||Ys;s=Xs;var c=Ys;if(Xs=o,(Ys=l)&&!c)for(Zs=i;null!==Zs;)l=(o=Zs).child,22===o.tag&&null!==o.memoizedState?_l(i):null!==l?(l.return=o,Zs=l):_l(i);for(;null!==a;)Zs=a,yl(a,t,n),a=a.sibling;Zs=i,Xs=s,Ys=c}bl(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,Zs=a):bl(e)}}function bl(e){for(;null!==Zs;){var t=Zs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ys)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ga(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ga(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(a(163))}Ys||512&t.flags&&il(t)}catch(p){Sc(t,t.return,p)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function xl(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function _l(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Sc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Sc(t,i,l)}}var a=t.return;try{il(t)}catch(l){Sc(t,a,l)}break;case 5:var o=t.return;try{il(t)}catch(l){Sc(t,o,l)}}}catch(l){Sc(t,t.return,l)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var wl,Sl=Math.ceil,Tl=b.ReactCurrentDispatcher,Cl=b.ReactCurrentOwner,Ml=b.ReactCurrentBatchConfig,El=0,Pl=null,Nl=null,kl=0,Rl=0,Ll=Si(0),Ol=0,jl=null,Dl=0,Il=0,Bl=0,Fl=null,zl=null,Ul=0,Vl=1/0,Gl=null,ql=!1,Wl=null,Hl=null,$l=!1,Kl=null,Xl=0,Yl=0,Ql=null,Zl=-1,Jl=0;function ec(){return 0!==(6&El)?Qe():-1!==Zl?Zl:Zl=Qe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&El)&&0!==kl?kl&-kl:null!==ma.transition?(0===Jl&&(Jl=mt()),Jl):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nc(e,t,n,r){if(50<Yl)throw Yl=0,Ql=null,Error(a(185));vt(e,n,r),0!==(2&El)&&e===Pl||(e===Pl&&(0===(2&El)&&(Il|=n),4===Ol&&sc(e,kl)),rc(e,r),1===n&&0===El&&0===(1&t.mode)&&(Vl=Qe()+500,Fi&&Vi()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,l=i[o];-1===l?0!==(s&n)&&0===(s&r)||(i[o]=pt(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ht(e,e===Pl?kl:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Fi=!0,Ui(e)}(lc.bind(null,e)):Ui(lc.bind(null,e)),oi(function(){0===(6&El)&&Vi()}),n=null;else{switch(bt(r)){case 1:n=Je;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pc(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Zl=-1,Jl=0,0!==(6&El))throw Error(a(327));var n=e.callbackNode;if(_c()&&e.callbackNode!==n)return null;var r=ht(e,e===Pl?kl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var i=El;El|=2;var o=fc();for(Pl===e&&kl===t||(Gl=null,Vl=Qe()+500,hc(e,t));;)try{Ac();break}catch(l){pc(e,l)}Ca(),Tl.current=o,El=i,null!==Nl?t=0:(Pl=null,kl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=ac(e,i))),1===t)throw n=jl,hc(e,0),sc(e,r),rc(e,Qe()),n;if(6===t)sc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gc(e,r))&&(0!==(o=ft(e))&&(r=o,t=ac(e,o))),1===t))throw n=jl,hc(e,0),sc(e,r),rc(e,Qe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:xc(e,zl,Gl);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=Ul+500-Qe())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xc.bind(null,e,zl,Gl),t);break}xc(e,zl,Gl);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Sl(r/1960))-r)){e.timeoutHandle=ri(xc.bind(null,e,zl,Gl),r);break}xc(e,zl,Gl);break;default:throw Error(a(329))}}}return rc(e,Qe()),e.callbackNode===n?ic.bind(null,e):null}function ac(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=zl,zl=n,null!==t&&oc(t)),e}function oc(e){null===zl?zl=e:zl.push.apply(zl,e)}function sc(e,t){for(t&=~Bl,t&=~Il,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&El))throw Error(a(327));_c();var t=ht(e,0);if(0===(1&t))return rc(e,Qe()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=jl,hc(e,0),sc(e,t),rc(e,Qe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,zl,Gl),rc(e,Qe()),null}function cc(e,t){var n=El;El|=1;try{return e(t)}finally{0===(El=n)&&(Vl=Qe()+500,Fi&&Vi())}}function uc(e){null!==Kl&&0===Kl.tag&&0===(6&El)&&_c();var t=El;El|=1;var n=Ml.transition,r=yt;try{if(Ml.transition=null,yt=1,e)return e()}finally{yt=r,Ml.transition=n,0===(6&(El=t))&&Vi()}}function dc(){Rl=Ll.current,Ti(Ll)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Nl)for(n=Nl.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Li();break;case 3:Ya(),Ti(Pi),Ti(Ei),no();break;case 5:Za(r);break;case 4:Ya();break;case 13:case 19:Ti(Ja);break;case 10:Ma(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Pl=e,Nl=e=Lc(e.current,null),kl=Rl=t,Ol=0,jl=null,Bl=Il=Dl=0,zl=Fl=null,null!==ka){for(t=0;t<ka.length;t++)if(null!==(r=(n=ka[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}ka=null}return e}function pc(e,t){for(;;){var n=Nl;try{if(Ca(),ro.current=Zo,co){for(var r=oo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}co=!1}if(ao=0,lo=so=oo=null,uo=!1,ho=0,Cl.current=null,null===n||null===n.return){Ol=1,jl=t,Nl=null;break}e:{var o=e,s=n.return,l=n,c=t;if(t=kl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,vs(f,s,l,0,t),1&f.mode&&ms(o,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ms(o,u,t),mc();break e}c=Error(a(426))}else if(ia&&1&l.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,l,0,t),fa(cs(c,l));break e}}o=c=cs(c,l),4!==Ol&&(Ol=2),null===Fl?Fl=[o]:Fl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ua(o,ps(0,c,t));break e;case 1:l=c;var A=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof A.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Hl||!Hl.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Ua(o,fs(o,l,t));break e}}o=o.return}while(null!==o)}bc(n)}catch(b){t=b,Nl===n&&null!==n&&(Nl=n=n.return);continue}break}}function fc(){var e=Tl.current;return Tl.current=Zo,null===e?Zo:e}function mc(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===Pl||0===(268435455&Dl)&&0===(268435455&Il)||sc(Pl,kl)}function gc(e,t){var n=El;El|=2;var r=fc();for(Pl===e&&kl===t||(Gl=null,hc(e,t));;)try{vc();break}catch(i){pc(e,i)}if(Ca(),El=n,Tl.current=r,null!==Nl)throw Error(a(261));return Pl=null,kl=0,Ol}function vc(){for(;null!==Nl;)yc(Nl)}function Ac(){for(;null!==Nl&&!Xe();)yc(Nl)}function yc(e){var t=wl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?bc(e):Nl=t,Cl.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=$s(n,t,Rl)))return void(Nl=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Nl=n);if(null===e)return Ol=6,void(Nl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nl=t);Nl=t=e}while(null!==t);0===Ol&&(Ol=5)}function xc(e,t,n){var r=yt,i=Ml.transition;try{Ml.transition=null,yt=1,function(e,t,n,r){do{_c()}while(null!==Kl);if(0!==(6&El))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===Pl&&(Nl=Pl=null,kl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||$l||($l=!0,Pc(tt,function(){return _c(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Ml.transition,Ml.transition=null;var s=yt;yt=1;var l=El;El|=4,Cl.current=null,function(e,t){if(ei=qt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(x){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(l=s+i),h!==o||0!==r&&3!==h.nodeType||(c=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===i&&(l=s),p===o&&++d===r&&(c=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},qt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,A=t.stateNode,y=A.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);A.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(x){Sc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}m=tl,tl=!1}(e,n),gl(n,e),fr(ti),qt=!!ei,ti=ei=null,e.current=n,Al(n,e,i),Ye(),El=l,yt=s,Ml.transition=o}else e.current=n;if($l&&($l=!1,Kl=e,Xl=i),o=e.pendingLanes,0===o&&(Hl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ql)throw ql=!1,e=Wl,Wl=null,e;0!==(1&Xl)&&0!==e.tag&&_c(),o=e.pendingLanes,0!==(1&o)?e===Ql?Yl++:(Yl=0,Ql=e):Yl=0,Vi()}(e,t,n,r)}finally{Ml.transition=i,yt=r}return null}function _c(){if(null!==Kl){var e=bt(Xl),t=Ml.transition,n=yt;try{if(Ml.transition=null,yt=16>e?16:e,null===Kl)var r=!1;else{if(e=Kl,Kl=null,Xl=0,0!==(6&El))throw Error(a(331));var i=El;for(El|=4,Zs=e.current;null!==Zs;){var o=Zs,s=o.child;if(0!==(16&Zs.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:nl(8,d,o)}var h=d.child;if(null!==h)h.return=d,Zs=h;else for(;null!==Zs;){var p=(d=Zs).sibling,f=d.return;if(al(d),d===u){Zs=null;break}if(null!==p){p.return=f,Zs=p;break}Zs=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Zs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Zs=s;else e:for(;null!==Zs;){if(0!==(2048&(o=Zs).flags))switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var A=o.sibling;if(null!==A){A.return=o.return,Zs=A;break e}Zs=o.return}}var y=e.current;for(Zs=y;null!==Zs;){var b=(s=Zs).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,Zs=b;else e:for(s=y;null!==Zs;){if(0!==(2048&(l=Zs).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(_){Sc(l,l.return,_)}if(l===s){Zs=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Zs=x;break e}Zs=l.return}}if(El=i,Vi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(_){}r=!0}return r}finally{yt=n,Ml.transition=t}}return!1}function wc(e,t,n){e=Fa(e,t=ps(0,t=cs(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)wc(e,e,n);else for(;null!==t;){if(3===t.tag){wc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){t=Fa(t,e=fs(t,e=cs(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),rc(t,e));break}}t=t.return}}function Tc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(kl&n)===n&&(4===Ol||3===Ol&&(130023424&kl)===kl&&500>Qe()-Ul?hc(e,0):Bl|=n),rc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Oa(e,t))&&(vt(e,t,n),rc(e,n))}function Mc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Cc(e,n)}function Pc(e,t){return $e(e,t)}function Nc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kc(e,t,n,r){return new Nc(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var n=e.alternate;return null===n?((n=kc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Rc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case w:return jc(n.children,i,o,t);case S:s=8,i|=8;break;case T:return(e=kc(12,n,t,2|i)).elementType=T,e.lanes=o,e;case P:return(e=kc(13,n,t,i)).elementType=P,e.lanes=o,e;case N:return(e=kc(19,n,t,i)).elementType=N,e.lanes=o,e;case L:return Dc(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:s=10;break e;case M:s=9;break e;case E:s=11;break e;case k:s=14;break e;case R:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=kc(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function jc(e,t,n,r){return(e=kc(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=kc(22,e,r,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function Ic(e,t,n){return(e=kc(6,e,null,t)).lanes=n,e}function Bc(e,t,n){return(t=kc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,r,i,a,o,s,l){return e=new Fc(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=kc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Da(a),e}function Uc(e){if(!e)return Mi;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ri(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ri(n))return ji(e,n,t)}return t}function Vc(e,t,n,r,i,a,o,s,l){return(e=zc(n,r,!0,e,0,a,0,s,l)).context=Uc(null),n=e.current,(a=Ba(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,Fa(n,a,i),e.current.lanes=i,vt(e,i,r),rc(e,r),e}function Gc(e,t,n,r){var i=t.current,a=ec(),o=tc(i);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ba(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Fa(i,t,o))&&(nc(e,i,o,a),za(e,i,o)),o}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}wl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pi.current)ys=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ys=!1,function(e,t,n){switch(t.tag){case 3:Ps(t),pa();break;case 5:Qa(t);break;case 1:Ri(t.type)&&Di(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ci(_a,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ci(Ja,1&Ja.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Is(e,t,n):(Ci(Ja,1&Ja.current),null!==(e=qs(e,t,n))?e.sibling:null);Ci(Ja,1&Ja.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ci(Ja,Ja.current),r)break;return null;case 22:case 23:return t.lanes=0,Ss(e,t,n)}return qs(e,t,n)}(e,t,n);ys=0!==(131072&e.flags)}else ys=!1,ia&&0!==(1048576&t.flags)&&Ji(t,Hi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var i=ki(t,Ei.current);Pa(t,n),i=go(null,t,r,e,i,n);var o=vo();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ri(r)?(o=!0,Di(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Da(t),i.updater=is,t.stateNode=i,i._reactInternals=t,ls(t,r,e,n),t=Es(null,t,r,!0,o,n)):(t.tag=0,ia&&o&&ea(t),bs(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===k)return 14}return 2}(r),e=ns(r,e),i){case 0:t=Cs(null,t,r,e,n);break e;case 1:t=Ms(null,t,r,e,n);break e;case 11:t=xs(null,t,r,e,n);break e;case 14:t=_s(null,t,r,ns(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Cs(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ms(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 3:e:{if(Ps(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,Ia(e,t),Va(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ns(e,t,r,n,i=cs(Error(a(423)),t));break e}if(r!==i){t=Ns(e,t,r,n,i=cs(Error(a(424)),t));break e}for(ra=ci(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=xa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),r===i){t=qs(e,t,n);break e}bs(e,t,r,n)}t=t.child}return t;case 5:return Qa(t),null===e&&ca(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==o&&ni(r,o)&&(t.flags|=32),Ts(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Is(e,t,n);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ba(t,null,r,n):bs(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xs(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Ci(_a,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Pi.current){t=qs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Ba(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ea(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Ea(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Pa(t,n),r=r(i=Na(i)),t.flags|=1,bs(e,t,r,n),t.child;case 14:return i=ns(r=t.type,t.pendingProps),_s(e,t,r,i=ns(r.type,i),n);case 15:return ws(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ns(r,i),Gs(e,t),t.tag=1,Ri(r)?(e=!0,Di(t)):e=!1,Pa(t,n),os(t,r,i),ls(t,r,i,n),Es(null,t,r,!0,e,n);case 19:return Vs(e,t,n);case 22:return Ss(e,t,n)}throw Error(a(156,t.tag))};var $c="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function Jc(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=qc(o);s.call(e)}}Gc(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=qc(o);a.call(e)}}var o=Vc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=o,e[fi]=o.current,Vr(8===e.nodeType?e.parentNode:e),uc(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=qc(l);s.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[fi]=l.current,Vr(8===e.nodeType?e.parentNode:e),uc(function(){Gc(t,l,n,r)}),l}(n,t,e,i,r);return qc(o)}Xc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Gc(e,t,null,null)},Xc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Gc(null,e,null,null)}),t[fi]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&It(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(At(t,1|n),rc(t,Qe()),0===(6&El)&&(Vl=Qe()+500,Vi()))}break;case 13:uc(function(){var t=Oa(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Hc(e,1)}},_t=function(e){if(13===e.tag){var t=Oa(e,134217728);if(null!==t)nc(t,e,134217728,ec());Hc(e,134217728)}},wt=function(e){if(13===e.tag){var t=tc(e),n=Oa(e,t);if(null!==n)nc(n,e,t,ec());Hc(e,t)}},St=function(){return yt},Tt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},_e=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=xi(r);if(!i)throw Error(a(90));$(r),Z(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=cc,Pe=uc;var eu={usingClientEntryPoint:!1,Events:[yi,bi,xi,Ce,Me,cc]},tu={findFiberByHostInstance:Ai,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),at=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(a(299));var n=!1,r="",i=$c;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(a(200));return Jc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=$c;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vc(t,null,e,1,null!=n?n:null,i,0,o,s),e[fi]=t.current,Vr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(a(200));return Jc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(a(40));return!!e._reactRootContainer&&(uc(function(){Jc(null,null,e,!1,function(){e._reactRootContainer=null,e[fi]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Jc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},2777:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isSymbol=function(e){return"symbol"===typeof e||e instanceof Symbol}},2795:function(e,t,n){"use strict";n.d(t,{Rf:function(){return i},rE:function(){return a}});var r=n(5043);function i(e){return(0,r.forwardRef)(e)}var a=(e,t,n=!0)=>{if(!t)return[e,{}];const r=t.reduce((t,n)=>n in e?{...t,[n]:e[n]}:t,{});if(n){return[Object.keys(e).filter(e=>!t.includes(e)).reduce((t,n)=>({...t,[n]:e[n]}),{}),r]}return[e,r]}},2849:function(e){e.exports={BASE_DENSITY_GLSL:'\n// ============================================================================\n// Base Density Correction\n// ============================================================================\n\n// Correct for film base color (orange mask for C-41, etc.)\n//\n// Two modes:\n// - Linear (u_baseMode == 0): Simple RGB gain multiplication\n// - Log (u_baseMode == 1): Density domain subtraction (more accurate)\n//\nvec3 applyBaseDensityCorrection(vec3 col) {\n  if (u_baseMode > 0.5) {\n    // Log mode: density domain subtraction\n    // D = -log10(T), then subtract base density, then convert back\n    float minT = 0.001;\n    float log10 = log(10.0);\n    \n    // Red channel\n    float Tr = max(col.r, minT);\n    float Dr = -log(Tr) / log10;\n    float Dr_corrected = Dr - u_baseDensity.r;\n    col.r = pow(10.0, -Dr_corrected);\n    \n    // Green channel\n    float Tg = max(col.g, minT);\n    float Dg = -log(Tg) / log10;\n    float Dg_corrected = Dg - u_baseDensity.g;\n    col.g = pow(10.0, -Dg_corrected);\n    \n    // Blue channel\n    float Tb = max(col.b, minT);\n    float Db = -log(Tb) / log10;\n    float Db_corrected = Db - u_baseDensity.b;\n    col.b = pow(10.0, -Db_corrected);\n    \n    col = clamp(col, 0.0, 1.0);\n  } else {\n    // Linear mode: simple gain multiplication (legacy compatible)\n    col = col * u_baseGains;\n    col = clamp(col, 0.0, 1.0);\n  }\n  \n  return col;\n}\n\n// ============================================================================\n// Density Levels (Log Domain Per-Channel Normalization)\n// ============================================================================\n\n// Normalize each channel\'s [Dmin, Dmax] to a common output range.\n// This "flattens" the RGB channels, compensating for:\n// 1. Orange mask in color negative film\n// 2. Different dye characteristics per layer\n// 3. Scanner/light source color imbalance\n//\n// The output range is set to the average of the three input ranges,\n// which preserves overall contrast while normalizing channel balance.\n//\nvec3 applyDensityLevels(vec3 col) {\n  if (u_densityLevelsEnabled < 0.5) return col;\n  \n  float minT = 0.001;\n  float log10 = log(10.0);\n  \n  // Calculate average range across channels for output scaling\n  float rangeR = u_densityLevelsMax.r - u_densityLevelsMin.r;\n  float rangeG = u_densityLevelsMax.g - u_densityLevelsMin.g;\n  float rangeB = u_densityLevelsMax.b - u_densityLevelsMin.b;\n  float avgRange = (rangeR + rangeG + rangeB) / 3.0;\n  // Clamp average range to reasonable bounds\n  avgRange = max(avgRange, 0.5);  // Minimum 0.5 to avoid extreme compression\n  avgRange = min(avgRange, 2.5);  // Maximum 2.5 to avoid extreme expansion\n  \n  // Red channel\n  float Tr = max(col.r, minT);\n  float Dr = -log(Tr) / log10;\n  if (rangeR > 0.001) {\n    float normR = clamp((Dr - u_densityLevelsMin.r) / rangeR, 0.0, 1.0);\n    float DrNew = normR * avgRange;\n    col.r = pow(10.0, -DrNew);\n  }\n  \n  // Green channel\n  float Tg = max(col.g, minT);\n  float Dg = -log(Tg) / log10;\n  if (rangeG > 0.001) {\n    float normG = clamp((Dg - u_densityLevelsMin.g) / rangeG, 0.0, 1.0);\n    float DgNew = normG * avgRange;\n    col.g = pow(10.0, -DgNew);\n  }\n  \n  // Blue channel\n  float Tb = max(col.b, minT);\n  float Db = -log(Tb) / log10;\n  if (rangeB > 0.001) {\n    float normB = clamp((Db - u_densityLevelsMin.b) / rangeB, 0.0, 1.0);\n    float DbNew = normB * avgRange;\n    col.b = pow(10.0, -DbNew);\n  }\n  \n  return clamp(col, 0.0, 1.0);\n}\n'}},2879:function(e,t,n){"use strict";n.d(t,{V:function(){return s}});var r=n(708),i=n(7449),a=n(5330),o=n(8436);const s={test:(0,o.$)("hsl","hue"),parse:(0,o.q)("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:o=1})=>"hsla("+Math.round(e)+", "+i.KN.transform((0,a.a)(t))+", "+i.KN.transform((0,a.a)(n))+", "+(0,a.a)(r.X4.transform(o))+")"}},2896:function(e,t,n){"use strict";n.d(t,{W:function(){return r}});const r={}},2927:function(e,t,n){"use strict";n.d(t,{cn:function(){return a}});var r=n(6639),i=n(6264);function a(...e){return(0,i.a0)(...e)({twMergeConfig:r.w})}},3084:function(e,t,n){"use strict";n.d(t,{X:function(){return i},f:function(){return r}});const r=e=>1e3*e,i=e=>e/1e3},3194:function(e,t,n){"use strict";n.d(t,{B:function(){return s},s:function(){return l}});var r=n(2196),i=n(5043),a=n(2598);const o={border:0,clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"};function s(e={}){let{style:t,isFocusable:n}=e,[r,s]=(0,i.useState)(!1),{focusWithinProps:l}=(0,a.R)({isDisabled:!n,onFocusWithinChange:e=>s(e)});return{visuallyHiddenProps:{...l,style:(0,i.useMemo)(()=>r?t:t?{...o,...t}:o,[r])}}}function l(e){let{children:t,elementType:n="div",isFocusable:a,style:o,...l}=e,{visuallyHiddenProps:c}=s(e);return i.createElement(n,(0,r.v)(l,c),t)}},3218:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3223:function(e,t,n){"use strict";n.d(t,{U:function(){return r},_:function(){return i}});const r=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],i=["initial",...r]},3255:function(e,t,n){"use strict";n.d(t,{i:function(){return s}});var r=n(171),i=n(5043),a=n(3941),o=n(8493);function s(e){let{isDisabled:t,onFocus:n,onBlur:s,onFocusChange:l}=e;const c=(0,i.useCallback)(e=>{if(e.target===e.currentTarget)return s&&s(e),l&&l(!1),!0},[s,l]),u=(0,r.yB)(c),d=(0,i.useCallback)(e=>{const t=(0,o.TW)(e.target),r=t?(0,a.bq)(t):(0,a.bq)();e.target===e.currentTarget&&r===(0,a.wt)(e.nativeEvent)&&(n&&n(e),l&&l(!0),u(e))},[l,n,u]);return{focusProps:{onFocus:!t&&(n||l||s)?d:void 0,onBlur:t||!s&&!l?void 0:c}}}},3272:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toKey=function(e){return"string"===typeof e||"symbol"===typeof e?e:Object.is(e?.valueOf?.(),-0)?"-0":String(e)}},3456:function(e,t,n){"use strict";n.d(t,{F:function(){return s}});var r=n(579),i=n(5043),a=n(6841),o=n(5491);function s({children:e,features:t,strict:n=!1}){const[,s]=(0,i.useState)(!l(t)),c=(0,i.useRef)(void 0);if(!l(t)){const{renderer:e,...n}=t;c.current=e,(0,o.Y)(n)}return(0,i.useEffect)(()=>{l(t)&&t().then(({renderer:e,...t})=>{(0,o.Y)(t),c.current=e,s(!0)})},[]),(0,r.jsx)(a.Y.Provider,{value:{renderer:c.current,strict:n},children:e})}function l(e){return"function"===typeof e}},3735:function(e,t,n){"use strict";n.d(t,{v:function(){return N}});var r=n(9427);function i(e,t=-1/0,n=1/0){return Math.min(Math.max(e,t),n)}const a={top:"top",bottom:"top",left:"left",right:"left"},o={top:"bottom",bottom:"top",left:"right",right:"left"},s={top:"left",left:"top"},l={top:"height",left:"width"},c={width:"totalWidth",height:"totalHeight"},u={};let d=()=>"undefined"!==typeof document?window.visualViewport:null;function h(e,t){let n=0,i=0,a=0,o=0,s=0,l=0,c={};var u;let d=(null!==(u=null===t||void 0===t?void 0:t.scale)&&void 0!==u?u:1)>1;if("BODY"===e.tagName||"HTML"===e.tagName){let r=document.documentElement;var h,p;a=r.clientWidth,o=r.clientHeight,n=null!==(h=null===t||void 0===t?void 0:t.width)&&void 0!==h?h:a,i=null!==(p=null===t||void 0===t?void 0:t.height)&&void 0!==p?p:o,c.top=r.scrollTop||e.scrollTop,c.left=r.scrollLeft||e.scrollLeft,t&&(s=t.offsetTop,l=t.offsetLeft)}else({width:n,height:i,top:s,left:l}=b(e,!1)),c.top=e.scrollTop,c.left=e.scrollLeft,a=n,o=i;var f,m;(0,r.Tc)()&&("BODY"===e.tagName||"HTML"===e.tagName)&&d&&(c.top=0,c.left=0,s=null!==(f=null===t||void 0===t?void 0:t.pageTop)&&void 0!==f?f:0,l=null!==(m=null===t||void 0===t?void 0:t.pageLeft)&&void 0!==m?m:0);return{width:n,height:i,totalWidth:a,totalHeight:o,scroll:c,top:s,left:l}}function p(e,t,n,r,i,o,s){var c;let u=null!==(c=i.scroll[e])&&void 0!==c?c:0,d=r[l[e]],h=s[e]+r.scroll[a[e]]+o,p=s[e]+r.scroll[a[e]]+d-o,f=t-u+r.scroll[a[e]]+s[e]-r[a[e]],m=t-u+n+r.scroll[a[e]]+s[e]-r[a[e]];return f<h?h-f:m>p?Math.max(p-m,h-f):0}function f(e){if(u[e])return u[e];let[t,n]=e.split(" "),r=a[t]||"right",i=s[r];a[n]||(n="center");let o=l[r],c=l[i];return u[e]={placement:t,crossPlacement:n,axis:r,crossAxis:i,size:o,crossSize:c},u[e]}function m(e,t,n,r,a,s,l,u,d,h,p){let{placement:f,crossPlacement:m,axis:g,crossAxis:v,size:A,crossSize:y}=r,b={};var x,_,w,S,T;b[v]=null!==(x=e[v])&&void 0!==x?x:0,"center"===m?b[v]+=((null!==(_=e[y])&&void 0!==_?_:0)-(null!==(w=n[y])&&void 0!==w?w:0))/2:m!==v&&(b[v]+=(null!==(S=e[y])&&void 0!==S?S:0)-(null!==(T=n[y])&&void 0!==T?T:0)),b[v]+=s;const C=e[v]-n[y]+d+h,M=e[v]+e[y]-d-h;if(b[v]=i(b[v],C,M),f===g){let t=u?p[A]:p[c[A]];b[o[g]]=Math.floor(t-e[g]+a)}else b[g]=Math.floor(e[g]+e[A]+a);return b}function g(e,t,n,r,i,a,s,l){let{placement:c,axis:u,size:d}=a;var h,p,f,m;return c===u?Math.max(0,n[u]-(null!==(h=s.scroll[u])&&void 0!==h?h:0)-(e[u]+(l?t[u]:0))-(null!==(p=r[u])&&void 0!==p?p:0)-r[o[u]]-i):Math.max(0,e[d]+e[u]+(l?t[u]:0)-n[u]-n[d]+(null!==(f=s.scroll[u])&&void 0!==f?f:0)-(null!==(m=r[u])&&void 0!==m?m:0)-r[o[u]]-i)}function v(e,t,n,r,s,l,u,d,h,v,A,y,b,x,_,w,S,T){let C=f(e),{size:M,crossAxis:E,crossSize:P,placement:N,crossPlacement:k}=C,R=m(t,0,n,C,A,y,0,b,_,w,h),L=A,O=g(d,v,t,s,l+A,C,h,S);if(u&&n[M]>O){let e=f(`${o[N]} ${k}`),r=m(t,0,n,e,A,y,0,b,_,w,h);g(d,v,t,s,l+A,e,h,S)>O&&(C=e,R=r,L=A)}let j="bottom";"top"===C.axis?"top"===C.placement?j="top":"bottom"===C.placement&&(j="bottom"):"top"===C.crossAxis&&("top"===C.crossPlacement?j="bottom":"bottom"===C.crossPlacement&&(j="top"));let D=p(E,R[E],n[P],d,h,l,v);R[E]+=D;let I=function(e,t,n,r,i,a,o,s,l,u,d){var h,p;let f=(null!=e.top?e.top:l[c.height]-(null!==(h=e.bottom)&&void 0!==h?h:0)-o)-(null!==(p=l.scroll.top)&&void 0!==p?p:0),m=u?n.top:0;var g,v,A;let y=Math.max(t.top+m,(null!==(g=null===d||void 0===d?void 0:d.offsetTop)&&void 0!==g?g:t.top)+m),b=Math.min(t.top+t.height+m,(null!==(v=null===d||void 0===d?void 0:d.offsetTop)&&void 0!==v?v:0)+(null!==(A=null===d||void 0===d?void 0:d.height)&&void 0!==A?A:0));var x,_,w,S;return"top"!==s?Math.max(0,b-f-((null!==(x=i.top)&&void 0!==x?x:0)+(null!==(_=i.bottom)&&void 0!==_?_:0)+a)):Math.max(0,f+o-y-((null!==(w=i.top)&&void 0!==w?w:0)+(null!==(S=i.bottom)&&void 0!==S?S:0)+a))}(R,d,v,0,s,l,n.height,j,h,S,T);x&&x<I&&(I=x),n.height=Math.min(n.height,I),R=m(t,0,n,C,L,y,0,b,_,w,h),D=p(E,R[E],n[P],d,h,l,v),R[E]+=D;let B={},F=t[E]-R[E]-s[a[E]],z=F+.5*t[P];const U=_/2+w;var V,G,q,W;const H="left"===a[E]?(null!==(V=s.left)&&void 0!==V?V:0)+(null!==(G=s.right)&&void 0!==G?G:0):(null!==(q=s.top)&&void 0!==q?q:0)+(null!==(W=s.bottom)&&void 0!==W?W:0),$=n[P]-H-_/2-w,K=i(z,t[E]+_/2-(R[E]+s[a[E]]),t[E]+t[P]-_/2-(R[E]+s[a[E]]));B[E]=i(K,U,$),({placement:N,crossPlacement:k}=C),_?F=B[E]:"right"===k?F+=t[P]:"center"===k&&(F+=t[P]/2);let X="left"===N||"top"===N?n[M]:0,Y={x:"top"===N||"bottom"===N?F:X,y:"left"===N||"right"===N?F:X};return{position:R,maxHeight:I,arrowOffsetLeft:B.left,arrowOffsetTop:B.top,placement:N,triggerAnchorPoint:Y}}function A(e){let{placement:t,targetNode:n,overlayNode:r,scrollNode:i,padding:a,shouldFlip:o,boundaryElement:s,offset:l,crossOffset:c,maxHeight:u,arrowSize:p=0,arrowBoundaryOffset:f=0}=e,m=d(),g=r instanceof HTMLElement?function(e){let t=e.offsetParent;t&&t===document.body&&"static"===window.getComputedStyle(t).position&&!_(t)&&(t=document.documentElement);if(null==t)for(t=e.parentElement;t&&!_(t);)t=t.parentElement;return t||document.documentElement}(r):document.documentElement,A=g===document.documentElement;const y=window.getComputedStyle(g).position;let w=!!y&&"static"!==y,S=A?b(n,!1):x(n,g,!1);if(!A){let{marginTop:e,marginLeft:t}=window.getComputedStyle(n);S.top+=parseInt(e,10)||0,S.left+=parseInt(t,10)||0}let T=b(r,!0),C=function(e){let t=window.getComputedStyle(e);return{top:parseInt(t.marginTop,10)||0,bottom:parseInt(t.marginBottom,10)||0,left:parseInt(t.marginLeft,10)||0,right:parseInt(t.marginRight,10)||0}}(r);var M,E,P,N;T.width+=(null!==(M=C.left)&&void 0!==M?M:0)+(null!==(E=C.right)&&void 0!==E?E:0),T.height+=(null!==(P=C.top)&&void 0!==P?P:0)+(null!==(N=C.bottom)&&void 0!==N?N:0);(k=i).scrollTop,k.scrollLeft,k.scrollWidth,k.scrollHeight;var k;return v(t,S,T,0,C,a,o,h(s,m),h(g,m),x(s,g,!1),l,c,w,u,p,f,s.contains(g),m)}function y(e,t){let{top:n,left:r,width:i,height:a}=e.getBoundingClientRect();return t&&e instanceof e.ownerDocument.defaultView.HTMLElement&&(i=e.offsetWidth,a=e.offsetHeight),{top:n,left:r,width:i,height:a}}function b(e,t){let{top:n,left:r,width:i,height:a}=y(e,t),{scrollTop:o,scrollLeft:s,clientTop:l,clientLeft:c}=document.documentElement;return{top:n+o-l,left:r+s-c,width:i,height:a}}function x(e,t,n){let r,i=window.getComputedStyle(e);if("fixed"===i.position)r=y(e,n);else{r=b(e,n);let i=b(t,n),a=window.getComputedStyle(t);i.top+=(parseInt(a.borderTopWidth,10)||0)-t.scrollTop,i.left+=(parseInt(a.borderLeftWidth,10)||0)-t.scrollLeft,r.top-=i.top,r.left-=i.left}return r.top-=parseInt(i.marginTop,10)||0,r.left-=parseInt(i.marginLeft,10)||0,r}function _(e){let t=window.getComputedStyle(e);return"none"!==t.transform||/transform|perspective/.test(t.willChange)||"none"!==t.filter||"paint"===t.contain||"backdropFilter"in t&&"none"!==t.backdropFilter||"WebkitBackdropFilter"in t&&"none"!==t.WebkitBackdropFilter}var w=n(9075),S=n(5043),T=n(6650),C=n(1468);function M(e){const{ref:t,box:n,onResize:r}=e;let i=(0,C.J)(r);(0,S.useEffect)(()=>{let e=null===t||void 0===t?void 0:t.current;if(e){if("undefined"===typeof window.ResizeObserver)return window.addEventListener("resize",i,!1),()=>{window.removeEventListener("resize",i,!1)};{const t=new window.ResizeObserver(e=>{e.length&&i()});return t.observe(e,{box:n}),()=>{e&&t.unobserve(e)}}}},[t,n])}var E=n(269);let P="undefined"!==typeof document?window.visualViewport:null;function N(e){let{direction:t}=(0,E.Y)(),{arrowSize:n,targetRef:r,overlayRef:i,arrowRef:a,scrollRef:o=i,placement:s="bottom",containerPadding:l=12,shouldFlip:c=!0,boundaryElement:u=("undefined"!==typeof document?document.body:null),offset:d=0,crossOffset:h=0,shouldUpdatePosition:p=!0,isOpen:f=!0,onClose:m,maxHeight:g,arrowBoundaryOffset:v=0}=e,[b,x]=(0,S.useState)(null),_=[p,s,i.current,r.current,null===a||void 0===a?void 0:a.current,o.current,l,c,u,d,h,f,t,g,v,n],C=(0,S.useRef)(null===P||void 0===P?void 0:P.scale);(0,S.useEffect)(()=>{f&&(C.current=null===P||void 0===P?void 0:P.scale)},[f]);let N=(0,S.useCallback)(()=>{if(!1===p||!f||!i.current||!r.current||!u)return;if((null===P||void 0===P?void 0:P.scale)!==C.current)return;let e=null;if(o.current&&o.current.contains(document.activeElement)){var m;let t=null===(m=document.activeElement)||void 0===m?void 0:m.getBoundingClientRect(),n=o.current.getBoundingClientRect();var b,_;if(e={type:"top",offset:(null!==(b=null===t||void 0===t?void 0:t.top)&&void 0!==b?b:0)-n.top},e.offset>n.height/2)e.type="bottom",e.offset=(null!==(_=null===t||void 0===t?void 0:t.bottom)&&void 0!==_?_:0)-n.bottom}let w=i.current;var S,T;!g&&i.current&&(w.style.top="0px",w.style.bottom="",w.style.maxHeight=(null!==(T=null===(S=window.visualViewport)||void 0===S?void 0:S.height)&&void 0!==T?T:window.innerHeight)+"px");let M=A({placement:k(s,t),overlayNode:i.current,targetNode:r.current,scrollNode:o.current||i.current,padding:l,shouldFlip:c,boundaryElement:u,offset:d,crossOffset:h,maxHeight:g,arrowSize:null!==n&&void 0!==n?n:(null===a||void 0===a?void 0:a.current)?y(a.current,!0).width:0,arrowBoundaryOffset:v});if(M.position){if(w.style.top="",w.style.bottom="",w.style.left="",w.style.right="",Object.keys(M.position).forEach(e=>w.style[e]=M.position[e]+"px"),w.style.maxHeight=null!=M.maxHeight?M.maxHeight+"px":"",e&&document.activeElement&&o.current){let t=document.activeElement.getBoundingClientRect(),n=o.current.getBoundingClientRect(),r=t[e.type]-n[e.type];o.current.scrollTop+=r-e.offset}x(M)}},_);var R;(0,T.N)(N,_),R=N,(0,T.N)(()=>(window.addEventListener("resize",R,!1),()=>{window.removeEventListener("resize",R,!1)}),[R]),M({ref:i,onResize:N}),M({ref:r,onResize:N});let L=(0,S.useRef)(!1);(0,T.N)(()=>{let e,t=()=>{L.current=!0,clearTimeout(e),e=setTimeout(()=>{L.current=!1},500),N()},n=()=>{L.current&&t()};return null===P||void 0===P||P.addEventListener("resize",t),null===P||void 0===P||P.addEventListener("scroll",n),()=>{null===P||void 0===P||P.removeEventListener("resize",t),null===P||void 0===P||P.removeEventListener("scroll",n)}},[N]);let O=(0,S.useCallback)(()=>{L.current||null===m||void 0===m||m()},[m,L]);var j,D,I;return(0,w.o)({triggerRef:r,isOpen:f,onClose:m&&O}),{overlayProps:{style:{position:b?"absolute":"fixed",top:b?void 0:0,left:b?void 0:0,zIndex:1e5,...null===b||void 0===b?void 0:b.position,maxHeight:null!==(j=null===b||void 0===b?void 0:b.maxHeight)&&void 0!==j?j:"100vh"}},placement:null!==(D=null===b||void 0===b?void 0:b.placement)&&void 0!==D?D:null,triggerAnchorPoint:null!==(I=null===b||void 0===b?void 0:b.triggerAnchorPoint)&&void 0!==I?I:null,arrowProps:{"aria-hidden":"true",role:"presentation",style:{left:null===b||void 0===b?void 0:b.arrowOffsetLeft,top:null===b||void 0===b?void 0:b.arrowOffsetTop}},updatePosition:N}}function k(e,t){return"rtl"===t?e.replace("start","right").replace("end","left"):e.replace("start","left").replace("end","right")}},3757:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isTypedArray=function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}},3771:function(e){const t={red:{hueCenter:0,hueRange:30,name:"\u7ea2\u8272"},orange:{hueCenter:30,hueRange:30,name:"\u6a59\u8272"},yellow:{hueCenter:60,hueRange:30,name:"\u9ec4\u8272"},green:{hueCenter:120,hueRange:45,name:"\u7eff\u8272"},cyan:{hueCenter:180,hueRange:30,name:"\u9752\u8272"},blue:{hueCenter:240,hueRange:45,name:"\u84dd\u8272"},purple:{hueCenter:280,hueRange:30,name:"\u7d2b\u8272"},magenta:{hueCenter:330,hueRange:30,name:"\u54c1\u7ea2"}},n=["red","orange","yellow","green","cyan","blue","purple","magenta"],r=Object.entries(t),i={red:{hue:0,saturation:0,luminance:0},orange:{hue:0,saturation:0,luminance:0},yellow:{hue:0,saturation:0,luminance:0},green:{hue:0,saturation:0,luminance:0},cyan:{hue:0,saturation:0,luminance:0},blue:{hue:0,saturation:0,luminance:0},purple:{hue:0,saturation:0,luminance:0},magenta:{hue:0,saturation:0,luminance:0}};function a(e,t,n){e/=255,t/=255,n/=255;const r=Math.max(e,t,n),i=Math.min(e,t,n),a=(r+i)/2;if(r===i)return[0,0,a];const o=r-i,s=a>.5?o/(2-r-i):o/(r+i);let l;switch(r){case e:l=((t-n)/o+(t<n?6:0))/6;break;case t:l=((n-e)/o+2)/6;break;case n:l=((e-t)/o+4)/6}return[360*l,s,a]}function o(e,t,n){if(e=(e%360+360)%360,e/=360,0===t){const e=Math.round(255*n);return[e,e,e]}const r=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),i=n<.5?n*(1+t):n+t-n*t,a=2*n-i,o=r(a,i,e+1/3),s=r(a,i,e),l=r(a,i,e-1/3);return[Math.round(255*o),Math.round(255*s),Math.round(255*l)]}function s(e,t){const n=Math.abs(e-t);return n>180?360-n:n}function l(e,t){const n=s(e,t.hueCenter);if(n>=t.hueRange)return 0;const r=n/t.hueRange;return.5*(1+Math.cos(r*Math.PI))}function c(e,t,n,i={}){if(u(i))return[e,t,n];let[s,c,d]=a(e,t,n);if(c<.05){let a=0;for(const[e,t]of r){const n=i[e];if(n&&0!==n.luminance){const e=l(s,t);e>0&&(a+=n.luminance/100*e)}}return 0!==a?(d=Math.max(0,Math.min(1,d+.5*a)),o(s,c,d)):[e,t,n]}let h=0,p=0,f=0,m=0;for(const[a,o]of r){const e=i[a];if(!e)continue;const t=l(s,o);t<=0||(m+=t,0!==e.hue&&(h+=e.hue*t),0!==e.saturation&&(p+=e.saturation/100*t),0!==e.luminance&&(f+=e.luminance/100*t))}return m>1&&(h/=m,p/=m,f/=m),0!==h&&(s=(s+h+360)%360),0!==p&&(p>0?c+=(1-c)*p:c*=1+p,c=Math.max(0,Math.min(1,c))),0!==f&&(f>0?d+=(1-d)*f*.5:d*=1+.5*f,d=Math.max(0,Math.min(1,d))),o(s,c,d)}function u(e){if(!e)return!0;for(const t of n){const n=e[t];if(n&&(0!==n.hue||0!==n.saturation||0!==n.luminance))return!1}return!0}e.exports={HSL_CHANNELS:t,HSL_CHANNEL_ORDER:n,DEFAULT_HSL_PARAMS:i,rgbToHsl:a,hslToRgb:o,applyHSL:c,applyHSLToArray:function(e,t,n={}){const r=n.channels||4;if(u(t))return e;const i=new Uint8Array(e.length);for(let a=0;a<e.length;a+=r){const n=e[a],o=e[a+1],s=e[a+2],[l,u,d]=c(n,o,s,t);i[a]=l,i[a+1]=u,i[a+2]=d,4===r&&(i[a+3]=e[a+3])}return i},isDefaultHSL:u,createSingleChannelHSL:function(e,t=0,n=0,r=0){const a={...i};return a[e]={hue:t,saturation:n,luminance:r},a},mergeHSLParams:function(e,t){const r={};for(const i of n){const n=e?.[i]||{hue:0,saturation:0,luminance:0},a=t?.[i]||{};r[i]={hue:a.hue??n.hue,saturation:a.saturation??n.saturation,luminance:a.luminance??n.luminance}}return r},validateHSLParams:function(e){const t=[];if(!e||"object"!==typeof e)return{valid:!0,errors:[]};for(const r of n){const n=e[r];n&&(void 0!==n.hue&&("number"!==typeof n.hue||n.hue<-180||n.hue>180)&&t.push(`${r}.hue must be between -180 and 180`),void 0!==n.saturation&&("number"!==typeof n.saturation||n.saturation<-100||n.saturation>100)&&t.push(`${r}.saturation must be between -100 and 100`),void 0!==n.luminance&&("number"!==typeof n.luminance||n.luminance<-100||n.luminance>100)&&t.push(`${r}.luminance must be between -100 and 100`))}return{valid:0===t.length,errors:t}},calculateChannelWeight:l,hueDistance:s}},3779:function(e,t,n){"use strict";n.d(t,{GU:function(){return m},Hj:function(){return p},Im:function(){return o},Lz:function(){return f},Px:function(){return S},QA:function(){return r},R8:function(){return y},Tn:function(){return s},ZH:function(){return h},cy:function(){return b},j1:function(){return d},qE:function(){return v},sE:function(){return l},t6:function(){return g},v6:function(){return w}});var r=e=>e?"":void 0;function i(e){return Array.isArray(e)}function a(e){const t=typeof e;return null!=e&&("object"===t||"function"===t)&&!i(e)}function o(e){return i(e)?function(e){return i(e)&&0===e.length}(e):a(e)?function(e){return a(e)&&0===Object.keys(e).length}(e):null==e||""===e}function s(e){return"function"===typeof e}var l=e=>e?"true":void 0;function c(e){var t,n,r="";if("string"===typeof e||"number"===typeof e)r+=e;else if("object"===typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=c(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function u(...e){for(var t,n,r=0,i="";r<e.length;)(t=e[r++])&&(n=c(t))&&(i&&(i+=" "),i+=n);return i}var d=(...e)=>{let t=" ";for(const n of e)if("string"===typeof n&&n.length>0){t=n;break}return t},h=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"";function p(...e){return function(t){e.some(e=>(null==e||e(t),null==t?void 0:t.defaultPrevented))}}function f(e){return`${e}-${Math.floor(1e6*Math.random())}`}function m(e){for(const t in e)t.startsWith("on")&&delete e[t];return e}function g(e){if(!e||"object"!==typeof e)return"";try{return JSON.stringify(e)}catch{return""}}function v(e,t,n){return Math.min(Math.max(e,t),n)}var A={};function y(e,t,...n){const r=`[Hero UI]${t?` [${t}]`:" "}: ${e}`;"undefined"!==typeof console&&(A[r]||(A[r]=!0))}function b(...e){return(...t)=>{for(let n of e)"function"===typeof n&&n(...t)}}var x=new Map;function _(e,t){if(e===t)return e;let n=x.get(e);if(n)return n.forEach(e=>e.current=t),t;let r=x.get(t);return r?(r.forEach(t=>t.current=e),e):t}function w(...e){let t={...e[0]};for(let n=1;n<e.length;n++){let r=e[n];for(let e in r){let n=t[e],i=r[e];"function"===typeof n&&"function"===typeof i&&"o"===e[0]&&"n"===e[1]&&e.charCodeAt(2)>=65&&e.charCodeAt(2)<=90?t[e]=b(n,i):"className"!==e&&"UNSAFE_className"!==e||"string"!==typeof n||"string"!==typeof i?"id"===e&&n&&i?t.id=_(n,i):t[e]=void 0!==i?i:n:t[e]=u(n,i)}}return t}function S(...e){return 1===e.length&&e[0]?e[0]:t=>{let n=!1;const r=e.map(e=>{const r=T(e,t);return n||(n="function"==typeof r),r});if(n)return()=>{r.forEach((t,n)=>{"function"===typeof t?null==t||t():T(e[n],null)})}}}function T(e,t){if("function"===typeof e)return()=>e(t);null!=e&&"current"in e&&(e.current=t)}},3787:function(e){e.exports={linearToSrgb:function(e){return e<=.0031308?12.92*e:1.055*Math.pow(Math.max(0,e),1/2.4)-.055},srgbToLinear:function(e){return e<=.04045?e/12.92:Math.pow((Math.max(0,e)+.055)/1.055,2.4)},applyGamma:function(e,t=2.2){return Math.pow(Math.max(0,e),1/t)},removeGamma:function(e,t=2.2){return Math.pow(Math.max(0,e),t)}}},3799:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4704),i=n(1203),a=n(870),o=n(9972);t.isIterateeCall=function(e,t,n){return!!a.isObject(n)&&(!!("number"===typeof t&&i.isArrayLike(n)&&r.isIndex(t)&&t<n.length||"string"===typeof t&&t in n)&&o.eq(n[t],e))}},3808:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8268),i=n(5261);t.matches=function(e){return e=i.cloneDeep(e),t=>r.isMatch(t,e)}},3821:function(e,t,n){e.exports=n(2204).sortBy},3861:function(e,t,n){"use strict";function r(e,t,n,r={passive:!0}){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}n.d(t,{k:function(){return r}})},3874:function(e,t,n){"use strict";n.d(t,{N:function(){return r}});const r=(0,n(5043).createContext)({})},3879:function(e){e.exports={INVERSION_GLSL:"\n// ============================================================================\n// Negative Inversion\n// ============================================================================\n\n// Apply negative inversion\n// \n// Two modes:\n// - Linear (u_inversionMode == 0): Simple subtraction from 1.0\n// - Log (u_inversionMode == 1): Logarithmic inversion for better shadow detail\n//\nvec3 applyInversion(vec3 col) {\n  if (u_inverted < 0.5) return col;\n  \n  vec3 c255 = col * 255.0;\n  \n  if (u_inversionMode > 0.5) {\n    // Log inversion: preserves more shadow detail\n    // Formula: 255 * (1 - log(x + 1) / log(256))\n    c255.r = 255.0 * (1.0 - log(c255.r + 1.0) / log(256.0));\n    c255.g = 255.0 * (1.0 - log(c255.g + 1.0) / log(256.0));\n    c255.b = 255.0 * (1.0 - log(c255.b + 1.0) / log(256.0));\n  } else {\n    // Linear inversion: simple subtraction\n    c255 = vec3(255.0) - c255;\n  }\n  \n  return c255 / 255.0;\n}\n"}},3941:function(e,t,n){"use strict";n.d(t,{bq:function(){return o},sD:function(){return a},wt:function(){return s}});var r=n(8493),i=n(8848);function a(e,t){if(!(0,i.Nf)())return!(!t||!e)&&e.contains(t);if(!e||!t)return!1;let n=t;for(;null!==n;){if(n===e)return!0;n="SLOT"===n.tagName&&n.assignedSlot?n.assignedSlot.parentNode:(0,r.Ng)(n)?n.host:n.parentNode}return!1}const o=(e=document)=>{var t;if(!(0,i.Nf)())return e.activeElement;let n=e.activeElement;for(;n&&"shadowRoot"in n&&(null===(t=n.shadowRoot)||void 0===t?void 0:t.activeElement);)n=n.shadowRoot.activeElement;return n};function s(e){return(0,i.Nf)()&&e.target.shadowRoot&&e.composedPath?e.composedPath()[0]:e.target}},3964:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});const r=e=>Boolean(e&&e.getVelocity)},3965:function(e,t,n){"use strict";n.d(t,{X:function(){return r}});class r{constructor(e){this.isMounted=!1,this.node=e}update(){}}},4025:function(e,t,n){const{DEFAULT_WB_PARAMS:r,WB_GAIN_LIMITS:i,TEMP_SLIDER_CONFIG:a,REFERENCE_WHITE_POINTS:o}=n(5121);function s(e,t,n){return Math.max(t,Math.min(n,e))}function l(e){let t,n;if((e=s(e,1e3,4e4))>=4e3&&e<=25e3){const r=e*e,i=r*e;t=e<=7e3?-4607e6/i+2967800/r+99.11/e+.244063:-20064e5/i+1901800/r+247.48/e+.23704,n=-3*t*t+2.87*t-.275}else{const r=e*e,i=r*e;if(e<4e3){if(t=-266123900/i-234358.9/r+877.6956/e+.17991,n=-1.1063814*t*t*t-1.3481102*t*t+2.18555832*t-.20219683,e>3500){const e=(e-3500)/500,r=.38234362499999996;t=t*(1-e)+r*e,n=n*(1-e)+(-3*r*r+2.87*r-.275)*e}}else t=-20064e5/i+1901800/r+247.48/e+.23704,n=-3*t*t+2.87*t-.275}const r=t/n,i=(1-t-n)/n;let a=3.2404542*r-1.5371385-.4985314*i,o=-.969266*r+1.8760108+.041556*i,l=.0556434*r-.2040259+1.0572252*i;const c=a+o+l;if(c>.001){const e=1;a=a/c*e*3,o=o/c*e*3,l=l/c*e*3}const u=Math.max(a,Math.max(o,l));return u>1&&(a/=u,o/=u,l/=u),a=Math.max(0,a),o=Math.max(0,o),l=Math.max(0,l),[a,o,l]}function c(e){const{baseKelvin:t,kelvinPerUnit:n}=a;return t+e*n}function u(e={},t={}){const n=t.minGain??i.min,a=t.maxGain??i.max,u=!1!==t.useKelvinModel,d=Number.isFinite(e.red)?e.red:r.red,h=Number.isFinite(e.green)?e.green:r.green,p=Number.isFinite(e.blue)?e.blue:r.blue,f=Number.isFinite(e.temp)?e.temp:r.temp,m=Number.isFinite(e.tint)?e.tint:r.tint;let g,v,A;if(u){const e=c(f),[t,n,r]=l(e),[i,a,s]=l(o.D65),u=m/100;g=d*(i/Math.max(.001,t))*(1+.15*u),v=h*(a/Math.max(.001,n))*(1-.3*u),A=p*(s/Math.max(.001,r))*(1+.15*u);const y=.299*g+.587*v+.114*A;if(y>.001){const e=1/y;g*=e,v*=e,A*=e}}else{const e=f/100,t=m/100;g=d*(1+.5*e+.3*t),v=h*(1-.5*t),A=p*(1-.5*e+.3*t);const n=.299*g+.587*v+.114*A;if(n>.001){const e=1/n;g*=e,v*=e,A*=e}}return Number.isFinite(g)||(g=1),Number.isFinite(v)||(v=1),Number.isFinite(A)||(A=1),g=s(g,n,a),v=s(v,n,a),A=s(A,n,a),[g,v,A]}function d(e={},t={}){return u(e,{...t,useKelvinModel:!1})}e.exports={computeWBGains:u,computeWBGainsLegacy:d,solveTempTintFromSample:function(e,t={}){if(!Array.isArray(e)||e.length<3)return{temp:0,tint:0};const n=e.map(e=>{const t=Number(e);return Number.isFinite(t)?Math.max(1,t):128}),r={red:Math.max(.05,Number.isFinite(t.red)?t.red:1),green:Math.max(.05,Number.isFinite(t.green)?t.green:1),blue:Math.max(.05,Number.isFinite(t.blue)?t.blue:1)},[i,a,o]=n,l=a*r.green,c=l/(i*r.red),u=l/(o*r.blue);if(Math.abs(c-1)<.02&&Math.abs(u-1)<.02)return{temp:0,tint:0};const h=c+u,p=(h-2)/(.6+.5*h),f=(c-u)*(1-.5*p);if(!Number.isFinite(f)||!Number.isFinite(p))return{temp:0,tint:0};let m=s(100*f,-100,100),g=s(100*p,-100,100);const v=d({red:r.red,green:r.green,blue:r.blue,temp:m,tint:g}),[A,y,b]=v;return(A<.1||A>10||y<.1||y>10||b<.1||b>10)&&(m*=.5,g*=.5),{temp:m,tint:g}},kelvinToRGB:l,sliderToKelvin:c}},4077:function(e,t,n){"use strict";function r(e){return void 0===e||1===e}function i({scale:e,scaleX:t,scaleY:n}){return!r(e)||!r(t)||!r(n)}function a(e){return i(e)||o(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function o(e){return s(e.x)||s(e.y)}function s(e){return e&&"0%"!==e}n.d(t,{HD:function(){return a},vF:function(){return o},vk:function(){return i}})},4202:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function A(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},A.prototype=v.prototype;var b=y.prototype=new A;b.constructor=y,m(b,v.prototype),b.isPureReactComponent=!0;var x=Array.isArray,_=Object.prototype.hasOwnProperty,w={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)_.call(t,i)&&!S.hasOwnProperty(i)&&(a[i]=t[i]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===a[i]&&(a[i]=l[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:w.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var M=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return o=o(l=e),e=""===a?"."+E(l,0):a,x(o)?(i="",null!=e&&(i=e.replace(M,"$&/")+"/"),P(o,t,i,"",function(e){return e})):null!=o&&(C(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(M,"$&/")+"/")+e)),t.push(o)),1;if(l=0,a=""===a?".":a+":",x(e))for(var c=0;c<e.length;c++){var u=a+E(s=e[c],c);l+=P(s,t,i,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=P(s=s.value,t,i,u=a+E(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function N(e,t,n){if(null==e)return e;var r=[],i=0;return P(e,r,"","",function(e){return t.call(n,e,i++)}),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},L={transition:null},O={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:L,ReactCurrentOwner:w};function j(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:N,forEach:function(e,t,n){N(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return N(e,function(){t++}),t},toArray:function(e){return N(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=j,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=w.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!S.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=j,t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.3.1"},4208:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.uniqBy=function(e,t){const n=new Map;for(let r=0;r<e.length;r++){const i=e[r],a=t(i);n.has(a)||n.set(a,i)}return Array.from(n.values())}},4260:function(e,t){!function(e){"use strict";var t=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(e){L.Util.setOptions(this,e),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var t=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,t?this._withAnimation:this._noAnimation),this._markerCluster=t?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(e){if(e instanceof L.LayerGroup)return this.addLayers([e]);if(!e.getLatLng)return this._nonPointGroup.addLayer(e),this.fire("layeradd",{layer:e}),this;if(!this._map)return this._needsClustering.push(e),this.fire("layeradd",{layer:e}),this;if(this.hasLayer(e))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(e,this._maxZoom),this.fire("layeradd",{layer:e}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var t=e,n=this._zoom;if(e.__parent)for(;t.__parent._zoom>=n;)t=t.__parent;return this._currentShownBounds.contains(t.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(e,t):this._animationAddLayerNonAnimated(e,t)),this},removeLayer:function(e){return e instanceof L.LayerGroup?this.removeLayers([e]):e.getLatLng?this._map?e.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(e)),this._removeLayer(e,!0),this.fire("layerremove",{layer:e}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),e.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(e)&&(this._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,e)&&this.hasLayer(e)&&this._needsRemoving.push({layer:e,latlng:e._latlng}),this.fire("layerremove",{layer:e}),this):(this._nonPointGroup.removeLayer(e),this.fire("layerremove",{layer:e}),this)},addLayers:function(e,t){if(!L.Util.isArray(e))return this.addLayer(e);var n,r=this._featureGroup,i=this._nonPointGroup,a=this.options.chunkedLoading,o=this.options.chunkInterval,s=this.options.chunkProgress,l=e.length,c=0,u=!0;if(this._map){var d=(new Date).getTime(),h=L.bind(function(){var p=(new Date).getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();c<l&&!(a&&c%200===0&&(new Date).getTime()-p>o);c++)if((n=e[c])instanceof L.LayerGroup)u&&(e=e.slice(),u=!1),this._extractNonGroupLayers(n,e),l=e.length;else if(n.getLatLng){if(!this.hasLayer(n)&&(this._addLayer(n,this._maxZoom),t||this.fire("layeradd",{layer:n}),n.__parent&&2===n.__parent.getChildCount())){var f=n.__parent.getAllChildMarkers(),m=f[0]===n?f[1]:f[0];r.removeLayer(m)}}else i.addLayer(n),t||this.fire("layeradd",{layer:n});s&&s(c,l,(new Date).getTime()-d),c===l?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(h,this.options.chunkDelay)},this);h()}else for(var p=this._needsClustering;c<l;c++)(n=e[c])instanceof L.LayerGroup?(u&&(e=e.slice(),u=!1),this._extractNonGroupLayers(n,e),l=e.length):n.getLatLng?this.hasLayer(n)||p.push(n):i.addLayer(n);return this},removeLayers:function(e){var t,n,r=e.length,i=this._featureGroup,a=this._nonPointGroup,o=!0;if(!this._map){for(t=0;t<r;t++)(n=e[t])instanceof L.LayerGroup?(o&&(e=e.slice(),o=!1),this._extractNonGroupLayers(n,e),r=e.length):(this._arraySplice(this._needsClustering,n),a.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push({layer:n,latlng:n._latlng}),this.fire("layerremove",{layer:n}));return this}if(this._unspiderfy){this._unspiderfy();var s=e.slice(),l=r;for(t=0;t<l;t++)(n=s[t])instanceof L.LayerGroup?(this._extractNonGroupLayers(n,s),l=s.length):this._unspiderfyLayer(n)}for(t=0;t<r;t++)(n=e[t])instanceof L.LayerGroup?(o&&(e=e.slice(),o=!1),this._extractNonGroupLayers(n,e),r=e.length):n.__parent?(this._removeLayer(n,!0,!0),this.fire("layerremove",{layer:n}),i.hasLayer(n)&&(i.removeLayer(n),n.clusterShow&&n.clusterShow())):(a.removeLayer(n),this.fire("layerremove",{layer:n}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(e){e.off(this._childMarkerEventHandlers,this),delete e.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var e=new L.LatLngBounds;this._topClusterLevel&&e.extend(this._topClusterLevel._bounds);for(var t=this._needsClustering.length-1;t>=0;t--)e.extend(this._needsClustering[t].getLatLng());return e.extend(this._nonPointGroup.getBounds()),e},eachLayer:function(e,t){var n,r,i,a=this._needsClustering.slice(),o=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(a),r=a.length-1;r>=0;r--){for(n=!0,i=o.length-1;i>=0;i--)if(o[i].layer===a[r]){n=!1;break}n&&e.call(t,a[r])}this._nonPointGroup.eachLayer(e,t)},getLayers:function(){var e=[];return this.eachLayer(function(t){e.push(t)}),e},getLayer:function(e){var t=null;return e=parseInt(e,10),this.eachLayer(function(n){L.stamp(n)===e&&(t=n)}),t},hasLayer:function(e){if(!e)return!1;var t,n=this._needsClustering;for(t=n.length-1;t>=0;t--)if(n[t]===e)return!0;for(t=(n=this._needsRemoving).length-1;t>=0;t--)if(n[t].layer===e)return!1;return!(!e.__parent||e.__parent._group!==this)||this._nonPointGroup.hasLayer(e)},zoomToShowLayer:function(e,t){var n=this._map;"function"!==typeof t&&(t=function(){});var r=function(){!n.hasLayer(e)&&!n.hasLayer(e.__parent)||this._inZoomAnimation||(this._map.off("moveend",r,this),this.off("animationend",r,this),n.hasLayer(e)?t():e.__parent._icon&&(this.once("spiderfied",t,this),e.__parent.spiderfy()))};e._icon&&this._map.getBounds().contains(e.getLatLng())?t():e.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",r,this),this._map.panTo(e.getLatLng())):(this._map.on("moveend",r,this),this.on("animationend",r,this),e.__parent.zoomToBounds())},onAdd:function(e){var t,n,r;if(this._map=e,!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(e),this._nonPointGroup.addTo(e),this._gridClusters||this._generateInitialClusters(),this._maxLat=e.options.crs.projection.MAX_LATITUDE,t=0,n=this._needsRemoving.length;t<n;t++)(r=this._needsRemoving[t]).newlatlng=r.layer._latlng,r.layer._latlng=r.latlng;for(t=0,n=this._needsRemoving.length;t<n;t++)r=this._needsRemoving[t],this._removeLayer(r.layer,!0),r.layer._latlng=r.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n,!0)},onRemove:function(e){e.off("zoomend",this._zoomEnd,this),e.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(e){for(var t=e;t&&!t._icon;)t=t.__parent;return t||null},_arraySplice:function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return e.splice(n,1),!0},_removeFromGridUnclustered:function(e,t){for(var n=this._map,r=this._gridUnclustered,i=Math.floor(this._map.getMinZoom());t>=i&&r[t].removeObject(e,n.project(e.getLatLng(),t));t--);},_childMarkerDragStart:function(e){e.target.__dragStart=e.target._latlng},_childMarkerMoved:function(e){if(!this._ignoreMove&&!e.target.__dragStart){var t=e.target._popup&&e.target._popup.isOpen();this._moveChild(e.target,e.oldLatLng,e.latlng),t&&e.target.openPopup()}},_moveChild:function(e,t,n){e._latlng=t,this.removeLayer(e),e._latlng=n,this.addLayer(e)},_childMarkerDragEnd:function(e){var t=e.target.__dragStart;delete e.target.__dragStart,t&&this._moveChild(e.target,t,e.target._latlng)},_removeLayer:function(e,t,n){var r=this._gridClusters,i=this._gridUnclustered,a=this._featureGroup,o=this._map,s=Math.floor(this._map.getMinZoom());t&&this._removeFromGridUnclustered(e,this._maxZoom);var l,c=e.__parent,u=c._markers;for(this._arraySplice(u,e);c&&(c._childCount--,c._boundsNeedUpdate=!0,!(c._zoom<s));)t&&c._childCount<=1?(l=c._markers[0]===e?c._markers[1]:c._markers[0],r[c._zoom].removeObject(c,o.project(c._cLatLng,c._zoom)),i[c._zoom].addObject(l,o.project(l.getLatLng(),c._zoom)),this._arraySplice(c.__parent._childClusters,c),c.__parent._markers.push(l),l.__parent=c.__parent,c._icon&&(a.removeLayer(c),n||a.addLayer(l))):c._iconNeedsUpdate=!0,c=c.__parent;delete e.__parent},_isOrIsParent:function(e,t){for(;t;){if(e===t)return!0;t=t.parentNode}return!1},fire:function(e,t,n){if(t&&t.layer instanceof L.MarkerCluster){if(t.originalEvent&&this._isOrIsParent(t.layer._icon,t.originalEvent.relatedTarget))return;e="cluster"+e}L.FeatureGroup.prototype.fire.call(this,e,t,n)},listens:function(e,t){return L.FeatureGroup.prototype.listens.call(this,e,t)||L.FeatureGroup.prototype.listens.call(this,"cluster"+e,t)},_defaultIconCreateFunction:function(e){var t=e.getChildCount(),n=" marker-cluster-";return n+=t<10?"small":t<100?"medium":"large",new L.DivIcon({html:"<div><span>"+t+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var e=this._map,t=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,r=this.options.zoomToBoundsOnClick,i=this.options.spiderfyOnEveryZoom;(t||r||i)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),e.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(e){var t=e.layer,n=t;if("clusterkeypress"!==e.type||!e.originalEvent||13===e.originalEvent.keyCode){for(;1===n._childClusters.length;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===t._childCount&&this.options.spiderfyOnMaxZoom?t.spiderfy():this.options.zoomToBoundsOnClick&&t.zoomToBounds(),this.options.spiderfyOnEveryZoom&&t.spiderfy(),e.originalEvent&&13===e.originalEvent.keyCode&&this._map._container.focus()}},_showCoverage:function(e){var t=this._map;this._inZoomAnimation||(this._shownPolygon&&t.removeLayer(this._shownPolygon),e.layer.getChildCount()>2&&e.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(e.layer.getConvexHull(),this.options.polygonOptions),t.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var e=this.options.spiderfyOnMaxZoom,t=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,r=this.options.spiderfyOnEveryZoom,i=this._map;(e||n||r)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),t&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),i.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var e=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),e),this._currentShownBounds=e}},_generateInitialClusters:function(){var e=Math.ceil(this._map.getMaxZoom()),t=Math.floor(this._map.getMinZoom()),n=this.options.maxClusterRadius,r=n;"function"!==typeof n&&(r=function(){return n}),null!==this.options.disableClusteringAtZoom&&(e=this.options.disableClusteringAtZoom-1),this._maxZoom=e,this._gridClusters={},this._gridUnclustered={};for(var i=e;i>=t;i--)this._gridClusters[i]=new L.DistanceGrid(r(i)),this._gridUnclustered[i]=new L.DistanceGrid(r(i));this._topClusterLevel=new this._markerCluster(this,t-1)},_addLayer:function(e,t){var n,r,i=this._gridClusters,a=this._gridUnclustered,o=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(e),e.on(this._childMarkerEventHandlers,this);t>=o;t--){n=this._map.project(e.getLatLng(),t);var s=i[t].getNearObject(n);if(s)return s._addChild(e),void(e.__parent=s);if(s=a[t].getNearObject(n)){var l=s.__parent;l&&this._removeLayer(s,!1);var c=new this._markerCluster(this,t,s,e);i[t].addObject(c,this._map.project(c._cLatLng,t)),s.__parent=c,e.__parent=c;var u=c;for(r=t-1;r>l._zoom;r--)u=new this._markerCluster(this,r,u),i[r].addObject(u,this._map.project(s.getLatLng(),r));return l._addChild(u),void this._removeFromGridUnclustered(s,t)}a[t].addObject(e,n)}this._topClusterLevel._addChild(e),e.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(e){e instanceof L.MarkerCluster&&e._iconNeedsUpdate&&e._updateIcon()})},_enqueue:function(e){this._queue.push(e),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var e=0;e<this._queue.length;e++)this._queue[e].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var e=Math.round(this._map._zoom);this._processQueue(),this._zoom<e&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,e)):this._zoom>e?(this._animationStart(),this._animationZoomOut(this._zoom,e)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(e){var t=this._maxLat;return void 0!==t&&(e.getNorth()>=t&&(e._northEast.lat=1/0),e.getSouth()<=-t&&(e._southWest.lat=-1/0)),e},_animationAddLayerNonAnimated:function(e,t){if(t===e)this._featureGroup.addLayer(e);else if(2===t._childCount){t._addToMap();var n=t.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else t._updateIcon()},_extractNonGroupLayers:function(e,t){var n,r=e.getLayers(),i=0;for(t=t||[];i<r.length;i++)(n=r[i])instanceof L.LayerGroup?this._extractNonGroupLayers(n,t):t.push(n);return t},_overrideMarkerIcon:function(e){return e.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[e]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(e,t){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(e,t){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(e,t){this._animationAddLayerNonAnimated(e,t)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(e,t){var n,r=this._getExpandedVisibleBounds(),i=this._featureGroup,a=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(r,e,a,function(a){var o,s=a._latlng,l=a._markers;for(r.contains(s)||(s=null),a._isSingleParent()&&e+1===t?(i.removeLayer(a),a._recursivelyAddChildrenToMap(null,t,r)):(a.clusterHide(),a._recursivelyAddChildrenToMap(s,t,r)),n=l.length-1;n>=0;n--)o=l[n],r.contains(o._latlng)||i.removeLayer(o)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(r,t),i.eachLayer(function(e){e instanceof L.MarkerCluster||!e._icon||e.clusterShow()}),this._topClusterLevel._recursively(r,e,t,function(e){e._recursivelyRestoreChildPositions(t)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(r,e,a,function(e){i.removeLayer(e),e.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(e,t){this._animationZoomOutSingle(this._topClusterLevel,e-1,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e,this._getExpandedVisibleBounds())},_animationAddLayer:function(e,t){var n=this,r=this._featureGroup;r.addLayer(e),t!==e&&(t._childCount>2?(t._updateIcon(),this._forceLayout(),this._animationStart(),e._setPos(this._map.latLngToLayerPoint(t.getLatLng())),e.clusterHide(),this._enqueue(function(){r.removeLayer(e),e.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(t,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(e,t,n){var r=this._getExpandedVisibleBounds(),i=Math.floor(this._map.getMinZoom());e._recursivelyAnimateChildrenInAndAddSelfToMap(r,i,t+1,n);var a=this;this._forceLayout(),e._recursivelyBecomeVisible(r,n),this._enqueue(function(){if(1===e._childCount){var o=e._markers[0];this._ignoreMove=!0,o.setLatLng(o.getLatLng()),this._ignoreMove=!1,o.clusterShow&&o.clusterShow()}else e._recursively(r,n,i,function(e){e._recursivelyRemoveChildrenFromMap(r,i,t+1)});a._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(e){return new L.MarkerClusterGroup(e)};var n=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(e,t,n,r){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this,pane:e.options.clusterPane}),this._group=e,this._zoom=t,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),r&&this._addChild(r)},getAllChildMarkers:function(e,t){e=e||[];for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n].getAllChildMarkers(e,t);for(var r=this._markers.length-1;r>=0;r--)t&&this._markers[r].__dragStart||e.push(this._markers[r]);return e},getChildCount:function(){return this._childCount},zoomToBounds:function(e){for(var t,n=this._childClusters.slice(),r=this._group._map,i=r.getBoundsZoom(this._bounds),a=this._zoom+1,o=r.getZoom();n.length>0&&i>a;){a++;var s=[];for(t=0;t<n.length;t++)s=s.concat(n[t]._childClusters);n=s}i>a?this._group._map.setView(this._latlng,a):i<=o?this._group._map.setView(this._latlng,o+1):this._group._map.fitBounds(this._bounds,e)},getBounds:function(){var e=new L.LatLngBounds;return e.extend(this._bounds),e},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(e,t){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(e),e instanceof L.MarkerCluster?(t||(this._childClusters.push(e),e.__parent=this),this._childCount+=e._childCount):(t||this._markers.push(e),this._childCount++),this.__parent&&this.__parent._addChild(e,!0)},_setClusterCenter:function(e){this._cLatLng||(this._cLatLng=e._cLatLng||e._latlng)},_resetBounds:function(){var e=this._bounds;e._southWest&&(e._southWest.lat=1/0,e._southWest.lng=1/0),e._northEast&&(e._northEast.lat=-1/0,e._northEast.lng=-1/0)},_recalculateBounds:function(){var e,t,n,r,i=this._markers,a=this._childClusters,o=0,s=0,l=this._childCount;if(0!==l){for(this._resetBounds(),e=0;e<i.length;e++)n=i[e]._latlng,this._bounds.extend(n),o+=n.lat,s+=n.lng;for(e=0;e<a.length;e++)(t=a[e])._boundsNeedUpdate&&t._recalculateBounds(),this._bounds.extend(t._bounds),n=t._wLatLng,r=t._childCount,o+=n.lat*r,s+=n.lng*r;this._latlng=this._wLatLng=new L.LatLng(o/l,s/l),this._boundsNeedUpdate=!1}},_addToMap:function(e){e&&(this._backupLatlng=this._latlng,this.setLatLng(e)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(e,t,n){this._recursively(e,this._group._map.getMinZoom(),n-1,function(e){var n,r,i=e._markers;for(n=i.length-1;n>=0;n--)(r=i[n])._icon&&(r._setPos(t),r.clusterHide())},function(e){var n,r,i=e._childClusters;for(n=i.length-1;n>=0;n--)(r=i[n])._icon&&(r._setPos(t),r.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(e,t,n,r){this._recursively(e,r,t,function(i){i._recursivelyAnimateChildrenIn(e,i._group._map.latLngToLayerPoint(i.getLatLng()).round(),n),i._isSingleParent()&&n-1===r?(i.clusterShow(),i._recursivelyRemoveChildrenFromMap(e,t,n)):i.clusterHide(),i._addToMap()})},_recursivelyBecomeVisible:function(e,t){this._recursively(e,this._group._map.getMinZoom(),t,null,function(e){e.clusterShow()})},_recursivelyAddChildrenToMap:function(e,t,n){this._recursively(n,this._group._map.getMinZoom()-1,t,function(r){if(t!==r._zoom)for(var i=r._markers.length-1;i>=0;i--){var a=r._markers[i];n.contains(a._latlng)&&(e&&(a._backupLatlng=a.getLatLng(),a.setLatLng(e),a.clusterHide&&a.clusterHide()),r._group._featureGroup.addLayer(a))}},function(t){t._addToMap(e)})},_recursivelyRestoreChildPositions:function(e){for(var t=this._markers.length-1;t>=0;t--){var n=this._markers[t];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(e-1===this._zoom)for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._restorePosition();else for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i]._recursivelyRestoreChildPositions(e)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(e,t,n,r){var i,a;this._recursively(e,t-1,n-1,function(e){for(a=e._markers.length-1;a>=0;a--)i=e._markers[a],r&&r.contains(i._latlng)||(e._group._featureGroup.removeLayer(i),i.clusterShow&&i.clusterShow())},function(e){for(a=e._childClusters.length-1;a>=0;a--)i=e._childClusters[a],r&&r.contains(i._latlng)||(e._group._featureGroup.removeLayer(i),i.clusterShow&&i.clusterShow())})},_recursively:function(e,t,n,r,i){var a,o,s=this._childClusters,l=this._zoom;if(t<=l&&(r&&r(this),i&&l===n&&i(this)),l<t||l<n)for(a=s.length-1;a>=0;a--)(o=s[a])._boundsNeedUpdate&&o._recalculateBounds(),e.intersects(o._bounds)&&o._recursively(e,t,n,r,i)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var e=this.options.opacity;return this.setOpacity(0),this.options.opacity=e,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(e,t){var n=this._getCoord(t.x),r=this._getCoord(t.y),i=this._grid,a=i[r]=i[r]||{},o=a[n]=a[n]||[],s=L.Util.stamp(e);this._objectPoint[s]=t,o.push(e)},updateObject:function(e,t){this.removeObject(e),this.addObject(e,t)},removeObject:function(e,t){var n,r,i=this._getCoord(t.x),a=this._getCoord(t.y),o=this._grid,s=o[a]=o[a]||{},l=s[i]=s[i]||[];for(delete this._objectPoint[L.Util.stamp(e)],n=0,r=l.length;n<r;n++)if(l[n]===e)return l.splice(n,1),1===r&&delete s[i],!0},eachObject:function(e,t){var n,r,i,a,o,s,l=this._grid;for(n in l)for(r in o=l[n])for(i=0,a=(s=o[r]).length;i<a;i++)e.call(t,s[i])&&(i--,a--)},getNearObject:function(e){var t,n,r,i,a,o,s,l,c=this._getCoord(e.x),u=this._getCoord(e.y),d=this._objectPoint,h=this._sqCellSize,p=null;for(t=u-1;t<=u+1;t++)if(i=this._grid[t])for(n=c-1;n<=c+1;n++)if(a=i[n])for(r=0,o=a.length;r<o;r++)s=a[r],((l=this._sqDist(d[L.Util.stamp(s)],e))<h||l<=h&&null===p)&&(h=l,p=s);return p},_getCoord:function(e){var t=Math.floor(e/this._cellSize);return isFinite(t)?t:e},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}},L.QuickHull={getDistant:function(e,t){var n=t[1].lat-t[0].lat;return(t[0].lng-t[1].lng)*(e.lat-t[0].lat)+n*(e.lng-t[0].lng)},findMostDistantPointFromBaseLine:function(e,t){var n,r,i,a=0,o=null,s=[];for(n=t.length-1;n>=0;n--)r=t[n],(i=this.getDistant(r,e))>0&&(s.push(r),i>a&&(a=i,o=r));return{maxPoint:o,newPoints:s}},buildConvexHull:function(e,t){var n=[],r=this.findMostDistantPointFromBaseLine(e,t);return r.maxPoint?n=(n=n.concat(this.buildConvexHull([e[0],r.maxPoint],r.newPoints))).concat(this.buildConvexHull([r.maxPoint,e[1]],r.newPoints)):[e[0]]},getConvexHull:function(e){var t,n=!1,r=!1,i=!1,a=!1,o=null,s=null,l=null,c=null,u=null,d=null;for(t=e.length-1;t>=0;t--){var h=e[t];(!1===n||h.lat>n)&&(o=h,n=h.lat),(!1===r||h.lat<r)&&(s=h,r=h.lat),(!1===i||h.lng>i)&&(l=h,i=h.lng),(!1===a||h.lng<a)&&(c=h,a=h.lng)}return r!==n?(d=s,u=o):(d=c,u=l),[].concat(this.buildConvexHull([d,u],e),this.buildConvexHull([u,d],e))}},L.MarkerCluster.include({getConvexHull:function(){var e,t,n=this.getAllChildMarkers(),r=[];for(t=n.length-1;t>=0;t--)e=n[t].getLatLng(),r.push(e);return L.QuickHull.getConvexHull(r)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var e,t=this.getAllChildMarkers(null,!0),n=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?e=this._group.options.spiderfyShapePositions(t.length,n):t.length>=this._circleSpiralSwitchover?e=this._generatePointsSpiral(t.length,n):(n.y+=10,e=this._generatePointsCircle(t.length,n)),this._animationSpiderfy(t,e)}},unspiderfy:function(e){this._group._inZoomAnimation||(this._animationUnspiderfy(e),this._group._spiderfied=null)},_generatePointsCircle:function(e,t){var n,r,i=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+e)/this._2PI,a=this._2PI/e,o=[];for(i=Math.max(i,35),o.length=e,n=0;n<e;n++)r=this._circleStartAngle+n*a,o[n]=new L.Point(t.x+i*Math.cos(r),t.y+i*Math.sin(r))._round();return o},_generatePointsSpiral:function(e,t){var n,r=this._group.options.spiderfyDistanceMultiplier,i=r*this._spiralLengthStart,a=r*this._spiralFootSeparation,o=r*this._spiralLengthFactor*this._2PI,s=0,l=[];for(l.length=e,n=e;n>=0;n--)n<e&&(l[n]=new L.Point(t.x+i*Math.cos(s),t.y+i*Math.sin(s))._round()),i+=o/(s+=a/i+5e-4*n);return l},_noanimationUnspiderfy:function(){var e,t,n=this._group,r=n._map,i=n._featureGroup,a=this.getAllChildMarkers(null,!0);for(n._ignoreMove=!0,this.setOpacity(1),t=a.length-1;t>=0;t--)e=a[t],i.removeLayer(e),e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng),e.setZIndexOffset&&e.setZIndexOffset(0),e._spiderLeg&&(r.removeLayer(e._spiderLeg),delete e._spiderLeg);n.fire("unspiderfied",{cluster:this,markers:a}),n._ignoreMove=!1,n._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(e,t){var n,r,i,a,o=this._group,s=o._map,l=o._featureGroup,c=this._group.options.spiderLegPolylineOptions;for(o._ignoreMove=!0,n=0;n<e.length;n++)a=s.layerPointToLatLng(t[n]),r=e[n],i=new L.Polyline([this._latlng,a],c),s.addLayer(i),r._spiderLeg=i,r._preSpiderfyLatlng=r._latlng,r.setLatLng(a),r.setZIndexOffset&&r.setZIndexOffset(1e6),l.addLayer(r);this.setOpacity(.3),o._ignoreMove=!1,o.fire("spiderfied",{cluster:this,markers:e})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(e,t){var n,r,i,a,o,s,l=this,c=this._group,u=c._map,d=c._featureGroup,h=this._latlng,p=u.latLngToLayerPoint(h),f=L.Path.SVG,m=L.extend({},this._group.options.spiderLegPolylineOptions),g=m.opacity;for(void 0===g&&(g=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),f?(m.opacity=0,m.className=(m.className||"")+" leaflet-cluster-spider-leg"):m.opacity=g,c._ignoreMove=!0,n=0;n<e.length;n++)r=e[n],s=u.layerPointToLatLng(t[n]),i=new L.Polyline([h,s],m),u.addLayer(i),r._spiderLeg=i,f&&(o=(a=i._path).getTotalLength()+.1,a.style.strokeDasharray=o,a.style.strokeDashoffset=o),r.setZIndexOffset&&r.setZIndexOffset(1e6),r.clusterHide&&r.clusterHide(),d.addLayer(r),r._setPos&&r._setPos(p);for(c._forceLayout(),c._animationStart(),n=e.length-1;n>=0;n--)s=u.layerPointToLatLng(t[n]),(r=e[n])._preSpiderfyLatlng=r._latlng,r.setLatLng(s),r.clusterShow&&r.clusterShow(),f&&((a=(i=r._spiderLeg)._path).style.strokeDashoffset=0,i.setStyle({opacity:g}));this.setOpacity(.3),c._ignoreMove=!1,setTimeout(function(){c._animationEnd(),c.fire("spiderfied",{cluster:l,markers:e})},200)},_animationUnspiderfy:function(e){var t,n,r,i,a,o,s=this,l=this._group,c=l._map,u=l._featureGroup,d=e?c._latLngToNewLayerPoint(this._latlng,e.zoom,e.center):c.latLngToLayerPoint(this._latlng),h=this.getAllChildMarkers(null,!0),p=L.Path.SVG;for(l._ignoreMove=!0,l._animationStart(),this.setOpacity(1),n=h.length-1;n>=0;n--)(t=h[n])._preSpiderfyLatlng&&(t.closePopup(),t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng,o=!0,t._setPos&&(t._setPos(d),o=!1),t.clusterHide&&(t.clusterHide(),o=!1),o&&u.removeLayer(t),p&&(a=(i=(r=t._spiderLeg)._path).getTotalLength()+.1,i.style.strokeDashoffset=a,r.setStyle({opacity:0})));l._ignoreMove=!1,setTimeout(function(){var e=0;for(n=h.length-1;n>=0;n--)(t=h[n])._spiderLeg&&e++;for(n=h.length-1;n>=0;n--)(t=h[n])._spiderLeg&&(t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),e>1&&u.removeLayer(t),c.removeLayer(t._spiderLeg),delete t._spiderLeg);l._animationEnd(),l.fire("unspiderfied",{cluster:s,markers:h})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(e){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(e))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(e){this._spiderfied&&this._spiderfied.unspiderfy(e)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(e){e._spiderLeg&&(this._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),this._map.removeLayer(e._spiderLeg),delete e._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(e){return e?e instanceof L.MarkerClusterGroup?e=e._topClusterLevel.getAllChildMarkers():e instanceof L.LayerGroup?e=e._layers:e instanceof L.MarkerCluster?e=e.getAllChildMarkers():e instanceof L.Marker&&(e=[e]):e=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(e),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(e),this},_flagParentsIconsNeedUpdate:function(e){var t,n;for(t in e)for(n=e[t].__parent;n;)n._iconNeedsUpdate=!0,n=n.__parent},_refreshSingleMarkerModeMarkers:function(e){var t,n;for(t in e)n=e[t],this.hasLayer(n)&&n.setIcon(this._overrideMarkerIcon(n))}}),L.Marker.include({refreshIconOptions:function(e,t){var n=this.options.icon;return L.setOptions(n,e),this.setIcon(n),t&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),e.MarkerClusterGroup=t,e.MarkerCluster=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)},4332:function(e,t,n){e.exports=n(5053).uniqBy},4338:function(e,t,n){"use strict";n.d(t,{l:function(){return l}});var r=n(5603),i=n(3941),a=n(8493),o=n(4595),s=n(368);function l(e){const t=(0,a.TW)(e);if("virtual"===(0,r.ME)()){let n=(0,i.bq)(t);(0,s.v)(()=>{const r=(0,i.bq)(t);r!==n&&r!==t.body||!e.isConnected||(0,o.e)(e)})}else(0,o.e)(e)}},4375:function(e,t,n){"use strict";n.d(t,{T:function(){return u}});var r=n(6642),i=n(5043);var a=n(9184),o=n(1321),s=n(3779),l=n(579),c=e=>{var t;const{triggerRef:n,getTriggerProps:c}=(0,r.C)(),{children:u,...d}=e,h=(0,i.useMemo)(()=>"string"===typeof u?(0,l.jsx)("p",{children:u}):i.Children.only(u),[u]),p=null!=(t=h.props.ref)?t:h.ref,{onPress:f,isDisabled:m,...g}=(0,i.useMemo)(()=>c((0,s.v6)(d,h.props),p),[c,h.props,d,p]),[,v]=((e,t)=>{var n;let r=[];return[null==(n=i.Children.map(e,e=>(0,i.isValidElement)(e)&&e.type===t?(r.push(e),null):e))?void 0:n.filter(Boolean),r.length>=0?r:void 0]})(u,o.T),{buttonProps:A}=(0,a.l)({onPress:f,isDisabled:m},n),y=(0,i.useMemo)(()=>void 0!==(null==v?void 0:v[0]),[v]);return y||delete g.preventFocusOnPress,(0,i.cloneElement)(h,(0,s.v6)(g,y?{onPress:f,isDisabled:m}:A))};c.displayName="HeroUI.PopoverTrigger";var u=c},4389:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2777);t.toNumber=function(e){return r.isSymbol(e)?NaN:Number(e)}},4391:function(e,t,n){"use strict";var r=n(7950);t.H=r.createRoot,r.hydrateRoot},4595:function(e,t,n){"use strict";function r(e){if(function(){if(null==i){i=!1;try{document.createElement("div").focus({get preventScroll(){return i=!0,!0}})}catch{}}return i}())e.focus({preventScroll:!0});else{let t=function(e){let t=e.parentNode,n=[],r=document.scrollingElement||document.documentElement;for(;t instanceof HTMLElement&&t!==r;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&n.push({element:t,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),t=t.parentNode;r instanceof HTMLElement&&n.push({element:r,scrollTop:r.scrollTop,scrollLeft:r.scrollLeft});return n}(e);e.focus(),function(e){for(let{element:t,scrollTop:n,scrollLeft:r}of e)t.scrollTop=n,t.scrollLeft=r}(t)}}n.d(t,{e:function(){return r}});let i=null},4597:function(e,t,n){"use strict";const{DEFAULT_CURVES:r,DEFAULT_WB_PARAMS:i,CONTRAST_MID_GRAY:a}=n(5121),{buildToneLUT:o}=n(5453),{buildCurveLUT:s,buildCurveLUTFloat:l}=n(114),{computeWBGains:c}=n(4025),{applyInversion:u,applyLogBaseCorrectionRGB:d,applyLinearBaseCorrectionRGB:h}=n(5329),{applyFilmCurve:p,applyFilmCurveFloat:f,FILM_CURVE_PROFILES:m}=n(6935),{applyHSL:g,DEFAULT_HSL_PARAMS:v,isDefaultHSL:A}=n(3771),{applySplitTone:y,DEFAULT_SPLIT_TONE_PARAMS:b,isDefaultSplitTone:x,prepareSplitTone:_,applySplitToneFast:w}=n(5272),{applySaturationFloat:S,applySaturation:T,isDefaultSaturation:C}=n(8974),M=n(8839),E={gamma:.6,dMin:.1,dMax:3},P={x:0,y:0,w:1,h:1};e.exports={RenderCore:class{constructor(e={}){this.rawParams=e,this.params=this.normalizeParams(e),this.luts=null}normalizeParams(e){return{inverted:e.inverted??!1,inversionMode:e.inversionMode??"linear",filmCurveEnabled:e.filmCurveEnabled??!1,filmCurveProfile:e.filmCurveProfile??"default",filmCurveGamma:e.filmCurveGamma??E.gamma,filmCurveGammaR:e.filmCurveGammaR??void 0,filmCurveGammaG:e.filmCurveGammaG??void 0,filmCurveGammaB:e.filmCurveGammaB??void 0,filmCurveDMin:e.filmCurveDMin??E.dMin,filmCurveDMax:e.filmCurveDMax??E.dMax,filmCurveToe:e.filmCurveToe??void 0,filmCurveShoulder:e.filmCurveShoulder??void 0,baseRed:e.baseRed??1,baseGreen:e.baseGreen??1,baseBlue:e.baseBlue??1,baseMode:e.baseMode??"linear",baseDensityR:e.baseDensityR??0,baseDensityG:e.baseDensityG??0,baseDensityB:e.baseDensityB??0,densityLevelsEnabled:e.densityLevelsEnabled??!1,densityLevels:e.densityLevels??{red:{min:0,max:3},green:{min:0,max:3},blue:{min:0,max:3}},red:e.red??i.red,green:e.green??i.green,blue:e.blue??i.blue,temp:e.temp??i.temp,tint:e.tint??i.tint,exposure:e.exposure??0,contrast:e.contrast??0,highlights:e.highlights??0,shadows:e.shadows??0,whites:e.whites??0,blacks:e.blacks??0,curves:e.curves??r,hslParams:e.hslParams??e.hsl??v,saturation:e.saturation??0,splitToning:e.splitToning??e.splitTone??b,lut1:e.lut1??null,lut1Intensity:e.lut1Intensity??1,lut2:e.lut2??null,lut2Intensity:e.lut2Intensity??1,rotation:e.rotation??0,orientation:e.orientation??0,cropRect:e.cropRect??P}}prepareLUTs(){if(this.luts)return this.luts;const e=this.params,t=o({exposure:e.exposure,contrast:e.contrast,highlights:e.highlights,shadows:e.shadows,whites:e.whites,blacks:e.blacks}),n=e.curves,i=s(n.rgb||r.rgb),a=s(n.red||r.red),u=s(n.green||r.green),d=s(n.blue||r.blue),h=l(n.rgb||r.rgb),p=l(n.red||r.red),f=l(n.green||r.green),m=l(n.blue||r.blue),[g,v,A]=c({red:e.red,green:e.green,blue:e.blue,temp:e.temp,tint:e.tint},{useKelvinModel:!0});return this.luts={toneLUT:t,lutRGB:i,lutR:a,lutG:u,lutB:d,lutRGBf:h,lutRf:p,lutGf:f,lutBf:m,rBal:g,gBal:v,bBal:A,lut1:e.lut1,lut1Intensity:e.lut1Intensity,lut2:e.lut2,lut2Intensity:e.lut2Intensity,splitToneCtx:_(e.splitToning)},this.luts}processPixelFloat(e,t,n){const r=this.params,i=this.luts||this.prepareLUTs();if(r.inverted&&r.filmCurveEnabled&&r.filmCurveProfile){const i=m[r.filmCurveProfile];if(i){const a=r.filmCurveGamma??i.gamma,o=r.filmCurveDMin??i.dMin,s=r.filmCurveDMax??i.dMax,l=r.filmCurveToe??i.toe??0,c=r.filmCurveShoulder??i.shoulder??0,u=r.filmCurveGammaR??i.gammaR??a,d=r.filmCurveGammaG??i.gammaG??a,h=r.filmCurveGammaB??i.gammaB??a;e=f(e,{gamma:u,dMin:o,dMax:s,toe:l,shoulder:c}),t=f(t,{gamma:d,dMin:o,dMax:s,toe:l,shoulder:c}),n=f(n,{gamma:h,dMin:o,dMax:s,toe:l,shoulder:c})}}if("log"===r.baseMode){if(0!==r.baseDensityR||0!==r.baseDensityG||0!==r.baseDensityB){const i=Math.log(10),a=.001,o=Math.max(e,a),s=Math.max(t,a),l=Math.max(n,a);e=Math.pow(10,-(-Math.log(o)/i-r.baseDensityR)),t=Math.pow(10,-(-Math.log(s)/i-r.baseDensityG)),n=Math.pow(10,-(-Math.log(l)/i-r.baseDensityB)),e=Math.max(0,Math.min(1,e)),t=Math.max(0,Math.min(1,t)),n=Math.max(0,Math.min(1,n))}}else 1===r.baseRed&&1===r.baseGreen&&1===r.baseBlue||(e=Math.max(0,Math.min(1,e*r.baseRed)),t=Math.max(0,Math.min(1,t*r.baseGreen)),n=Math.max(0,Math.min(1,n*r.baseBlue)));if(r.densityLevelsEnabled&&"log"===r.baseMode&&([e,t,n]=this._applyDensityLevelsFloat(e,t,n)),r.inverted)if("log"===r.inversionMode){const r=Math.log(256);e=1-Math.log(255*e+1)/r,t=1-Math.log(255*t+1)/r,n=1-Math.log(255*n+1)/r}else e=1-e,t=1-t,n=1-n;i.lut1&&([e,t,n]=this._sampleLUT3DFloat(e,t,n,i.lut1,i.lut1Intensity)),i.lut2&&([e,t,n]=this._sampleLUT3DFloat(e,t,n,i.lut2,i.lut2Intensity)),e*=i.rBal,t*=i.gBal,n*=i.bBal,Number.isFinite(e)||(e=0),Number.isFinite(t)||(t=0),Number.isFinite(n)||(n=0);const o=Math.pow(2,(Number(r.exposure)||0)/50);e*=o,t*=o,n*=o;const s=Number(r.contrast)||0;if(0!==s){const r=259*(s+255)/(255*(259-s));e=(e-a)*r+a,t=(t-a)*r+a,n=(n-a)*r+a}const l=.002*-(Number(r.blacks)||0),c=1-.002*(Number(r.whites)||0);if(0!==l||1!==c){const r=c-l;r>.001&&(e=(e-l)/r,t=(t-l)/r,n=(n-l)/r)}const u=.005*(Number(r.shadows)||0);if(0!==u){const r=e=>{const t=Math.max(0,Math.min(1,e));return e+u*(1-t)*(1-t)*t*4};e=r(e),t=r(t),n=r(n)}const d=.005*(Number(r.highlights)||0);if(0!==d){const r=e=>{const t=Math.max(0,Math.min(1,e));return e+d*t*t*(1-t)*4};e=r(e),t=r(t),n=r(n)}const h=Math.max(e,Math.max(t,n));if(h>.8){const r=M.highlightRollOff(h,.8)/h;e*=r,t*=r,n*=r}if(e=Math.max(0,Math.min(1,e)),t=Math.max(0,Math.min(1,t)),n=Math.max(0,Math.min(1,n)),i.lutRGBf&&(e=this._sampleCurveLUTFloatHQ(e,i.lutRGBf),t=this._sampleCurveLUTFloatHQ(t,i.lutRGBf),n=this._sampleCurveLUTFloatHQ(n,i.lutRGBf)),i.lutRf&&(e=this._sampleCurveLUTFloatHQ(e,i.lutRf)),i.lutGf&&(t=this._sampleCurveLUTFloatHQ(t,i.lutGf)),i.lutBf&&(n=this._sampleCurveLUTFloatHQ(n,i.lutBf)),r.hslParams&&!A(r.hslParams)){const[i,a,o]=g(255*e,255*t,255*n,r.hslParams);e=i/255,t=a/255,n=o/255}if(C(r.saturation)||([e,t,n]=S(e,t,n,r.saturation)),i.splitToneCtx){const[r,a,o]=w(255*e,255*t,255*n,i.splitToneCtx);e=r/255,t=a/255,n=o/255}return[Math.max(0,Math.min(1,e)),Math.max(0,Math.min(1,t)),Math.max(0,Math.min(1,n))]}processPixel(e,t,n){const r=this.params,i=this.luts||this.prepareLUTs();if(r.inverted&&r.filmCurveEnabled&&r.filmCurveProfile){const i=m[r.filmCurveProfile];if(i){const a={gamma:r.filmCurveGamma??i.gamma,dMin:r.filmCurveDMin??i.dMin,dMax:r.filmCurveDMax??i.dMax};e=p(e,a),t=p(t,a),n=p(n,a)}}"log"===r.baseMode?0===r.baseDensityR&&0===r.baseDensityG&&0===r.baseDensityB||([e,t,n]=d(e,t,n,r.baseDensityR,r.baseDensityG,r.baseDensityB)):1===r.baseRed&&1===r.baseGreen&&1===r.baseBlue||([e,t,n]=h(e,t,n,r.baseRed,r.baseGreen,r.baseBlue)),r.densityLevelsEnabled&&"log"===r.baseMode&&([e,t,n]=this._applyDensityLevels(e,t,n)),r.inverted&&(e=u(e,r),t=u(t,r),n=u(n,r)),i.lut1&&([e,t,n]=this._sampleLUT3D(e,t,n,i.lut1,i.lut1Intensity)),i.lut2&&([e,t,n]=this._sampleLUT3D(e,t,n,i.lut2,i.lut2Intensity)),e*=i.rBal,t*=i.gBal,n*=i.bBal,e=this._clamp255(e),t=this._clamp255(t),n=this._clamp255(n),Number.isFinite(e)||(e=0),Number.isFinite(t)||(t=0),Number.isFinite(n)||(n=0),e=i.toneLUT[Math.floor(e)],t=i.toneLUT[Math.floor(t)],n=i.toneLUT[Math.floor(n)];const a=Math.max(e,Math.max(t,n));if(a>204){const r=e/255,i=t/255,o=n/255,s=a/255,l=M.highlightRollOff(s,.8)/s;e=this._clamp255(Math.round(r*l*255)),t=this._clamp255(Math.round(i*l*255)),n=this._clamp255(Math.round(o*l*255))}return e=i.lutRGB[e],t=i.lutRGB[t],n=i.lutRGB[n],e=i.lutR[e],t=i.lutG[t],n=i.lutB[n],r.hslParams&&!A(r.hslParams)&&([e,t,n]=g(e,t,n,r.hslParams)),C(r.saturation)||([e,t,n]=T(e,t,n,r.saturation)),i.splitToneCtx&&([e,t,n]=w(e,t,n,i.splitToneCtx)),[this._clamp255(Math.round(e)),this._clamp255(Math.round(t)),this._clamp255(Math.round(n))]}getGLSLUniforms(){const e=this.params,t=this.luts||this.prepareLUTs(),n=[t.rBal,t.gBal,t.bBal];return{u_inverted:e.inverted?1:0,u_inversionMode:"log"===e.inversionMode?1:0,u_filmCurveEnabled:e.filmCurveEnabled?1:0,u_filmCurveGamma:e.filmCurveGamma??.6,u_filmCurveGammaR:e.filmCurveGammaR??e.filmCurveGamma??.6,u_filmCurveGammaG:e.filmCurveGammaG??e.filmCurveGamma??.6,u_filmCurveGammaB:e.filmCurveGammaB??e.filmCurveGamma??.6,u_filmCurveDMin:e.filmCurveDMin??.1,u_filmCurveDMax:e.filmCurveDMax??3,u_filmCurveToe:e.filmCurveToe??0,u_filmCurveShoulder:e.filmCurveShoulder??0,u_baseMode:"log"===e.baseMode?1:0,u_baseGains:[e.baseRed,e.baseGreen,e.baseBlue],u_baseDensity:[e.baseDensityR,e.baseDensityG,e.baseDensityB],u_densityLevelsEnabled:e.densityLevelsEnabled&&"log"===e.baseMode?1:0,u_densityLevelsMin:[e.densityLevels?.red?.min??0,e.densityLevels?.green?.min??0,e.densityLevels?.blue?.min??0],u_densityLevelsMax:[e.densityLevels?.red?.max??3,e.densityLevels?.green?.max??3,e.densityLevels?.blue?.max??3],u_gains:n,u_exposure:e.exposure,u_contrast:e.contrast,u_highlights:e.highlights,u_shadows:e.shadows,u_whites:e.whites,u_blacks:e.blacks,u_useCurves:this._hasCurves(e.curves)?1:0,curveLUTs:{rgb:t.lutRGB,red:t.lutR,green:t.lutG,blue:t.lutB},u_useHSL:A(e.hslParams)?0:1,u_hslParams:this._packHSLParams(e.hslParams),u_useSaturation:C(e.saturation)?0:1,u_saturation:e.saturation??0,u_useSplitTone:x(e.splitToning)?0:1,u_splitHighlightHue:(e.splitToning?.highlights?.hue??30)/360,u_splitHighlightSat:(e.splitToning?.highlights?.saturation??0)/100,u_splitMidtoneHue:(e.splitToning?.midtones?.hue??0)/360,u_splitMidtoneSat:(e.splitToning?.midtones?.saturation??0)/100,u_splitShadowHue:(e.splitToning?.shadows?.hue??220)/360,u_splitShadowSat:(e.splitToning?.shadows?.saturation??0)/100,u_splitBalance:(e.splitToning?.balance??0)/100,u_hasLut3d:e.lut1?1:0,u_lutIntensity:e.lut1Intensity??1}}static getHSLGLSL(){return console.warn("[RenderCore] getHSLGLSL() is deprecated. Use packages/shared/shaders/hslAdjust.js instead."),"\n// HSL Channel definitions (hueCenter, hueRange)\nconst vec2 HSL_RED     = vec2(0.0,   30.0);\nconst vec2 HSL_ORANGE  = vec2(30.0,  30.0);\nconst vec2 HSL_YELLOW  = vec2(60.0,  30.0);\nconst vec2 HSL_GREEN   = vec2(120.0, 45.0);\nconst vec2 HSL_CYAN    = vec2(180.0, 30.0);\nconst vec2 HSL_BLUE    = vec2(240.0, 45.0);\nconst vec2 HSL_PURPLE  = vec2(280.0, 30.0);\nconst vec2 HSL_MAGENTA = vec2(330.0, 30.0);\n\n// RGB to HSL conversion\nvec3 rgb2hsl(vec3 c) {\n  float maxC = max(max(c.r, c.g), c.b);\n  float minC = min(min(c.r, c.g), c.b);\n  float l = (maxC + minC) / 2.0;\n  \n  if (maxC == minC) {\n    return vec3(0.0, 0.0, l);\n  }\n  \n  float d = maxC - minC;\n  float s = l > 0.5 ? d / (2.0 - maxC - minC) : d / (maxC + minC);\n  \n  float h;\n  if (maxC == c.r) {\n    h = (c.g - c.b) / d + (c.g < c.b ? 6.0 : 0.0);\n  } else if (maxC == c.g) {\n    h = (c.b - c.r) / d + 2.0;\n  } else {\n    h = (c.r - c.g) / d + 4.0;\n  }\n  h /= 6.0;\n  \n  return vec3(h * 360.0, s, l);\n}\n\n// HSL to RGB conversion\nvec3 hsl2rgb(vec3 hsl) {\n  float h = mod(hsl.x, 360.0) / 360.0;\n  float s = clamp(hsl.y, 0.0, 1.0);\n  float l = clamp(hsl.z, 0.0, 1.0);\n  \n  if (s == 0.0) {\n    return vec3(l);\n  }\n  \n  float q = l < 0.5 ? l * (1.0 + s) : l + s - l * s;\n  float p = 2.0 * l - q;\n  \n  float hk = h;\n  vec3 t = vec3(hk + 1.0/3.0, hk, hk - 1.0/3.0);\n  t = fract(t + 1.0);\n  \n  vec3 c;\n  for (int i = 0; i < 3; i++) {\n    float ti = t[i];\n    if (ti < 1.0/6.0) {\n      c[i] = p + (q - p) * 6.0 * ti;\n    } else if (ti < 0.5) {\n      c[i] = q;\n    } else if (ti < 2.0/3.0) {\n      c[i] = p + (q - p) * (2.0/3.0 - ti) * 6.0;\n    } else {\n      c[i] = p;\n    }\n  }\n  \n  return c;\n}\n\n// Calculate HSL weight for a channel\nfloat hslChannelWeight(float hue, vec2 channel) {\n  float center = channel.x;\n  float range = channel.y;\n  \n  float dist = min(abs(hue - center), min(abs(hue - center + 360.0), abs(hue - center - 360.0)));\n  \n  if (dist > range) return 0.0;\n  \n  // Cosine smooth transition\n  return 0.5 * (1.0 + cos(3.14159265 * dist / range));\n}\n\n// Apply HSL adjustment\n// hslParams: array of 8 vec3 (hueShift, saturation, luminance) for each channel\nvec3 applyHSL(vec3 color, vec3 hslParams[8]) {\n  vec3 hsl = rgb2hsl(color);\n  float h = hsl.x;\n  float s = hsl.y;\n  float l = hsl.z;\n  \n  float totalHueShift = 0.0;\n  float satAdjust = 0.0;\n  float lumAdjust = 0.0;\n  float totalWeight = 0.0;\n  \n  vec2 channels[8];\n  channels[0] = HSL_RED;\n  channels[1] = HSL_ORANGE;\n  channels[2] = HSL_YELLOW;\n  channels[3] = HSL_GREEN;\n  channels[4] = HSL_CYAN;\n  channels[5] = HSL_BLUE;\n  channels[6] = HSL_PURPLE;\n  channels[7] = HSL_MAGENTA;\n  \n  for (int i = 0; i < 8; i++) {\n    float w = hslChannelWeight(h, channels[i]);\n    if (w > 0.0) {\n      totalHueShift += hslParams[i].x * w;\n      satAdjust += (hslParams[i].y / 100.0) * w;\n      lumAdjust += (hslParams[i].z / 100.0) * w;\n      totalWeight += w;\n    }\n  }\n  \n  if (totalWeight > 1.0) {\n    totalHueShift /= totalWeight;\n    satAdjust /= totalWeight;\n    lumAdjust /= totalWeight;\n  }\n  \n  if (totalWeight > 0.0) {\n    h = mod(h + totalHueShift, 360.0);\n    \n    // Saturation: asymmetric mapping (matching CPU filmLabHSL.js)\n    if (satAdjust > 0.0) {\n      s = s + (1.0 - s) * satAdjust;\n    } else if (satAdjust < 0.0) {\n      s = s * (1.0 + satAdjust);\n    }\n    s = clamp(s, 0.0, 1.0);\n    \n    // Luminance: asymmetric mapping with 0.5 damping (matching CPU filmLabHSL.js)\n    if (lumAdjust > 0.0) {\n      l = l + (1.0 - l) * lumAdjust * 0.5;\n    } else if (lumAdjust < 0.0) {\n      l = l * (1.0 + lumAdjust * 0.5);\n    }\n    l = clamp(l, 0.0, 1.0);\n  }\n  \n  return hsl2rgb(vec3(h, s, l));\n}\n"}static getSplitToneGLSL(){return console.warn("[RenderCore] getSplitToneGLSL() is deprecated. Use packages/shared/shaders/splitTone.js instead."),"\n// Calculate luminance (Rec. 709, matching CPU filmLabSplitTone.js)\nfloat calcLuminance(vec3 c) {\n  return 0.2126 * c.r + 0.7152 * c.g + 0.0722 * c.b;\n}\n\n// Smoothstep helper (matching CPU Hermite smoothstep)\nfloat splitToneSmoothstep(float t) {\n  t = clamp(t, 0.0, 1.0);\n  return t * t * (3.0 - 2.0 * t);\n}\n\n// Apply split toning \u2014 lerp-to-tint blend (matching CPU filmLabSplitTone.js)\nvec3 applySplitTone(vec3 color, float highlightHue, float highlightSat, \n                     float shadowHue, float shadowSat, float balance) {\n  float lum = calcLuminance(color);\n  \n  // Zone weights (matching CPU calculateZoneWeights)\n  float balanceOffset = balance / 2.0;\n  float midpoint = 0.5 + balanceOffset;\n  float shadowEnd = 0.25;\n  float highlightStart = 0.75;\n  \n  float shadowWeight = 0.0;\n  float midtoneWeight = 0.0;\n  float highlightWeight = 0.0;\n  \n  if (lum < shadowEnd) {\n    shadowWeight = 1.0;\n  } else if (lum < midpoint) {\n    float d = max(midpoint - shadowEnd, 0.001);\n    float st = splitToneSmoothstep(clamp((lum - shadowEnd) / d, 0.0, 1.0));\n    shadowWeight = 1.0 - st;\n    midtoneWeight = st;\n  }\n  if (lum > highlightStart) {\n    highlightWeight = 1.0;\n  } else if (lum > midpoint) {\n    float d = max(highlightStart - midpoint, 0.001);\n    float st = splitToneSmoothstep(clamp((lum - midpoint) / d, 0.0, 1.0));\n    highlightWeight = st;\n    midtoneWeight = max(midtoneWeight, 1.0 - st);\n  }\n  \n  vec3 highlightTint = hsl2rgb(vec3(highlightHue * 360.0, 1.0, 0.5));\n  vec3 shadowTint = hsl2rgb(vec3(shadowHue * 360.0, 1.0, 0.5));\n  \n  // Lerp-to-tint blend (matching CPU: result + (tint - result) * strength * 0.3)\n  vec3 result = color;\n  if (shadowWeight > 0.0 && shadowSat > 0.0) {\n    float strength = shadowSat * shadowWeight;\n    result += (shadowTint - result) * strength * 0.3;\n  }\n  if (highlightWeight > 0.0 && highlightSat > 0.0) {\n    float strength = highlightSat * highlightWeight;\n    result += (highlightTint - result) * strength * 0.3;\n  }\n  \n  return clamp(result, 0.0, 1.0);\n}\n"}getPipelineDescription(){const e=this.params,t=[];return e.inverted&&e.filmCurveEnabled&&t.push({name:"Film Curve (H&D)",active:!0,profile:e.filmCurveProfile}),e.inverted&&t.push({name:"Inversion",active:!0,mode:e.inversionMode}),t.push({name:"White Balance",active:!0,gains:[e.red,e.green,e.blue]}),t.push({name:"Tone Mapping",active:!0}),this._hasCurves(e.curves)&&t.push({name:"Curves",active:!0}),A(e.hslParams)||t.push({name:"HSL Adjustment",active:!0}),x(e.splitToning)||t.push({name:"Split Toning",active:!0}),e.lut1&&t.push({name:"3D LUT",active:!0}),{steps:t,params:this.params,version:"2.0.0"}}_clamp255(e){return Math.max(0,Math.min(255,e))}_applyFilmCurveFloat(e,t,n,r){const i=Math.max(.001,Math.min(1,e)),a=-Math.log10(i),o=Math.max(0,Math.min(1,(a-n)/(r-n))),s=n+Math.pow(o,t)*(r-n);return Math.max(0,Math.min(1,Math.pow(10,-s)))}_applyDensityLevelsFloat(e,t,n){const r=this.params.densityLevels;if(!r)return[e,t,n];const i=Math.log(10),a=r.red.max-r.red.min,o=r.green.max-r.green.min,s=r.blue.max-r.blue.min;let l=(a+o+s)/3;l=Math.max(.5,Math.min(2.5,l));const c=(e,t,n)=>{const r=Math.max(e,.001),a=-Math.log(r)/i;if(n<=.001)return e;const o=Math.max(0,Math.min(1,(a-t.min)/n))*l;return Math.max(0,Math.min(1,Math.pow(10,-o)))};return[c(e,r.red,a),c(t,r.green,o),c(n,r.blue,s)]}_sampleLUT3DFloat(e,t,n,r,i=1){if(!r||!r.data||!r.size)return[e,t,n];const{size:a,data:o}=r,s=a-1,l=Math.max(0,Math.min(1,e))*s,c=Math.max(0,Math.min(1,t))*s,u=Math.max(0,Math.min(1,n))*s,d=Math.floor(l),h=Math.min(s,d+1),p=Math.floor(c),f=Math.min(s,p+1),m=Math.floor(u),g=Math.min(s,m+1),v=l-d,A=c-p,y=u-m,b=(e,t,n)=>3*(e+t*a+n*a*a),x=e=>{const t=o[b(d,p,m)+e],n=o[b(h,p,m)+e],r=o[b(d,f,m)+e],i=o[b(h,f,m)+e],a=o[b(d,p,g)+e],s=o[b(h,p,g)+e],l=o[b(d,f,g)+e],c=o[b(h,f,g)+e];return((t*(1-v)+n*v)*(1-A)+(r*(1-v)+i*v)*A)*(1-y)+((a*(1-v)+s*v)*(1-A)+(l*(1-v)+c*v)*A)*y},_=x(0),w=x(1),S=x(2);return i>=1?[_,w,S]:[e+(_-e)*i,t+(w-t)*i,n+(S-n)*i]}_sampleCurveLUTFloat(e,t){const n=255*Math.max(0,Math.min(1,e)),r=Math.floor(n),i=Math.min(255,r+1),a=n-r;return((1-a)*t[r]+a*t[i])/255}_sampleCurveLUTFloatHQ(e,t){const n=t.length-1,r=Math.max(0,Math.min(1,e))*n,i=Math.floor(r),a=Math.min(n,i+1),o=r-i;return(1-o)*t[i]+o*t[a]}_applyDensityLevels(e,t,n){const r=this.params.densityLevels;if(!r)return[e,t,n];const i=Math.log(10),a=r.red.max-r.red.min,o=r.green.max-r.green.min,s=r.blue.max-r.blue.min;let l=(a+o+s)/3;l=Math.max(.5,Math.min(2.5,l));const c=(e,t,n)=>{const r=Math.max(e/255,.001),a=-Math.log(r)/i;if(n<=.001)return e;const o=Math.max(0,Math.min(1,(a-t.min)/n))*l,s=Math.pow(10,-o);return Math.max(0,Math.min(255,255*s))};return[c(e,r.red,a),c(t,r.green,o),c(n,r.blue,s)]}_hasCurves(e){if(!e)return!1;const t=e=>!(!e||2!==e.length)&&(0===e[0]?.x&&0===e[0]?.y&&255===e[1]?.x&&255===e[1]?.y);return!t(e.rgb)||!t(e.red)||!t(e.green)||!t(e.blue)}_packHSLParams(e){const t=["red","orange","yellow","green","cyan","blue","purple","magenta"],n=[];for(const r of t){const t=e?.[r]||{hue:0,saturation:0,luminance:0};n.push([t.hue??0,t.saturation??0,t.luminance??0])}return n}_sampleLUT3D(e,t,n,r,i=1){if(!r||!r.data||!r.size)return[e,t,n];const{size:a,data:o}=r,s=a-1,l=this._clamp255(e)/255*s,c=this._clamp255(t)/255*s,u=this._clamp255(n)/255*s,d=Math.floor(l),h=Math.min(s,d+1),p=Math.floor(c),f=Math.min(s,p+1),m=Math.floor(u),g=Math.min(s,m+1),v=l-d,A=c-p,y=u-m,b=(e,t,n)=>3*(e+t*a+n*a*a),x=e=>{const t=o[b(d,p,m)+e],n=o[b(h,p,m)+e],r=o[b(d,f,m)+e],i=o[b(h,f,m)+e],a=o[b(d,p,g)+e],s=o[b(h,p,g)+e],l=o[b(d,f,g)+e],c=o[b(h,f,g)+e];return((t*(1-v)+n*v)*(1-A)+(r*(1-v)+i*v)*A)*(1-y)+((a*(1-v)+s*v)*(1-A)+(l*(1-v)+c*v)*A)*y},_=255*x(0),w=255*x(1),S=255*x(2);return i>=1?[_,w,S]:[e+(_-e)*i,t+(w-t)*i,n+(S-n)*i]}},DEFAULT_FILM_CURVE:E,DEFAULT_CROP_RECT:P}},4640:function(e,t,n){"use strict";n.d(t,{C:function(){return f}});var r=n(6642),i=n(5043),a=n(1809),o=n(7820),s=n(3456),l=n(4900),c=n(6280),u=n(6808),d=n(579),h=()=>n.e(707).then(n.bind(n,5707)).then(e=>e.default),p=e=>{const{as:t,children:n,className:p,...f}=e,{Component:m,placement:g,backdrop:v,motionProps:A,disableAnimation:y,getPopoverProps:b,getDialogProps:x,getBackdropProps:_,getContentProps:w,isNonModal:S,onClose:T}=(0,r.C)(),C=(0,i.useRef)(null),{dialogProps:M,titleProps:E}=(0,u.s)({},C),P=x({ref:C,...M,...f}),N=t||m||"div",k=n&&(0,d.jsxs)(d.Fragment,{children:[!S&&(0,d.jsx)(a.R,{onDismiss:T}),(0,d.jsx)(N,{...P,children:(0,d.jsx)("div",{...w({className:p}),children:"function"===typeof n?n(E):n})}),(0,d.jsx)(a.R,{onDismiss:T})]}),R=(0,i.useMemo)(()=>"transparent"===v?null:y?(0,d.jsx)("div",{..._()}):(0,d.jsx)(s.F,{features:h,children:(0,d.jsx)(l.m.div,{animate:"enter",exit:"exit",initial:"exit",variants:o.zF.fade,..._()})}),[v,y,_]),L=g?(0,c.kn)("center"===g?"top":g):void 0,O=(0,d.jsx)(d.Fragment,{children:y?k:(0,d.jsx)(s.F,{features:h,children:(0,d.jsx)(l.m.div,{animate:"enter",exit:"exit",initial:"initial",style:L,variants:o.zF.scaleSpringOpacity,...A,children:k})})});return(0,d.jsxs)("div",{...b(),children:[R,O]})};p.displayName="HeroUI.PopoverContent";var f=p},4704:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=/^(?:0|[1-9]\d*)$/;t.isIndex=function(e,t=Number.MAX_SAFE_INTEGER){switch(typeof e){case"number":return Number.isInteger(e)&&e>=0&&e<t;case"symbol":return!1;case"string":return n.test(e)}}},4735:function(e,t,n){"use strict";n.d(t,{B:function(){return r}});const r="undefined"!==typeof window},4760:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});const r=e=>e},4784:function(e,t,n){"use strict";function r(e,t){return t?e*(1e3/t):0}n.d(t,{f:function(){return r}})},4803:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPrimitive=function(e){return null==e||"object"!==typeof e&&"function"!==typeof e}},4830:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.debounce=function(e,t,{signal:n,edges:r}={}){let i,a=null;const o=null!=r&&r.includes("leading"),s=null==r||r.includes("trailing"),l=()=>{null!==a&&(e.apply(i,a),i=void 0,a=null)};let c=null;const u=()=>{null!=c&&clearTimeout(c),c=setTimeout(()=>{c=null,s&&l(),d()},t)},d=()=>{null!==c&&(clearTimeout(c),c=null),i=void 0,a=null},h=function(...e){if(n?.aborted)return;i=this,a=e;const t=null==c;u(),o&&t&&l()};return h.schedule=u,h.cancel=d,h.flush=()=>{l()},n?.addEventListener("abort",d,{once:!0}),h}},4879:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4389);t.toFinite=function(e){if(!e)return 0===e?e:0;if((e=r.toNumber(e))===1/0||e===-1/0){return(e<0?-1:1)*Number.MAX_VALUE}return e===e?e:0}},4886:function(e,t,n){"use strict";n.d(t,{$:function(){return a},H:function(){return i}});var r=n(2001);const i={};function a(e){for(const t in e)i[t]=e[t],(0,r.j)(t)&&(i[t].isCSSVariable=!0)}},4895:function(e,t,n){const r=n(4597),i=n(8974),a=n(5121),o=n(5453),s=n(114),l=n(4025),c=n(5329),u=n(6935),d=n(3771),h=n(5556),p=n(5272),f=n(6532),m=n(7929),g=n(2351),v=n(9044),A=n(8310);e.exports={RenderCore:r,applySaturationFloat:i.applySaturationFloat,applySaturation:i.applySaturation,isDefaultSaturation:i.isDefaultSaturation,buildToneLUT:o.buildToneLUT,applyToneMapping:o.applyToneMapping,createSpline:s.createSpline,buildCurveLUT:s.buildCurveLUT,buildCurveLUTFloat:s.buildCurveLUTFloat,buildCompositeFloatCurveLUT:s.buildCompositeFloatCurveLUT,buildAllCurveLUTs:s.buildAllCurveLUTs,applyCurve:s.applyCurve,computeWBGains:l.computeWBGains,computeWBGainsLegacy:l.computeWBGainsLegacy,solveTempTintFromSample:l.solveTempTintFromSample,kelvinToRGB:l.kelvinToRGB,sliderToKelvin:l.sliderToKelvin,invertLinear:c.invertLinear,invertLog:c.invertLog,applyInversion:c.applyInversion,applyInversionRGB:c.applyInversionRGB,buildInversionLUT:c.buildInversionLUT,calculateBaseDensity:c.calculateBaseDensity,applyLogBaseCorrection:c.applyLogBaseCorrection,applyLogBaseCorrectionRGB:c.applyLogBaseCorrectionRGB,applyLinearBaseCorrection:c.applyLinearBaseCorrection,applyLinearBaseCorrectionRGB:c.applyLinearBaseCorrectionRGB,applyFilmCurve:u.applyFilmCurve,applyFilmCurveRGB:u.applyFilmCurveRGB,buildFilmCurveLUT:u.buildFilmCurveLUT,mergeFilmProfiles:u.mergeFilmProfiles,groupFilmProfilesByCategory:u.groupFilmProfilesByCategory,FILM_CURVE_PROFILES:u.FILM_CURVE_PROFILES,PREVIEW_MAX_WIDTH_SERVER:a.PREVIEW_MAX_WIDTH_SERVER,PREVIEW_MAX_WIDTH_CLIENT:a.PREVIEW_MAX_WIDTH_CLIENT,EXPORT_MAX_WIDTH:a.EXPORT_MAX_WIDTH,DEFAULT_TONE_PARAMS:a.DEFAULT_TONE_PARAMS,DEFAULT_WB_PARAMS:a.DEFAULT_WB_PARAMS,DEFAULT_BASE_GAINS:a.DEFAULT_BASE_GAINS,DEFAULT_BASE_CORRECTION:a.DEFAULT_BASE_CORRECTION,INVERSION_MODE_LABELS:a.INVERSION_MODE_LABELS,DEFAULT_INVERSION_PARAMS:a.DEFAULT_INVERSION_PARAMS,DEFAULT_CURVES:a.DEFAULT_CURVES,DEFAULT_CROP_RECT:a.DEFAULT_CROP_RECT,WB_GAIN_LIMITS:a.WB_GAIN_LIMITS,JPEG_QUALITY:a.JPEG_QUALITY,WEBGL_DEBOUNCE_MS:a.WEBGL_DEBOUNCE_MS,DEBUG:a.DEBUG,FILM_PROFILES:a.FILM_PROFILES,REFERENCE_WHITE_POINTS:a.REFERENCE_WHITE_POINTS,TEMP_SLIDER_CONFIG:a.TEMP_SLIDER_CONFIG,HSL_CHANNELS:d.HSL_CHANNELS,HSL_CHANNEL_ORDER:d.HSL_CHANNEL_ORDER,DEFAULT_HSL_PARAMS:d.DEFAULT_HSL_PARAMS,rgbToHsl:d.rgbToHsl,hslToRgb:d.hslToRgb,applyHSL:d.applyHSL,applyHSLToArray:d.applyHSLToArray,isDefaultHSL:d.isDefaultHSL,mergeHSLParams:d.mergeHSLParams,validateHSLParams:d.validateHSLParams,DEFAULT_PROCESSING_PARAMS:h.DEFAULT_PROCESSING_PARAMS,PARAMS_VERSION:h.PARAMS_VERSION,buildExportParams:h.buildExportParams,validateExportParams:h.validateExportParams,migrateParams:h.migrateParams,serializeParams:h.serializeParams,deserializeParams:h.deserializeParams,diffParams:h.diffParams,DEFAULT_SPLIT_TONE_PARAMS:p.DEFAULT_SPLIT_TONE_PARAMS,SPLIT_TONE_PRESETS:p.SPLIT_TONE_PRESETS,LUMINANCE_CONFIG:p.LUMINANCE_CONFIG,applySplitTone:p.applySplitTone,applySplitToneToArray:p.applySplitToneToArray,isDefaultSplitTone:p.isDefaultSplitTone,mergeSplitToneParams:p.mergeSplitToneParams,validateSplitToneParams:p.validateSplitToneParams,calculateLuminance:p.calculateLuminance,RenderCore:f.RenderCore,DEFAULT_FILM_CURVE:f.DEFAULT_FILM_CURVE,getEffectiveInverted:m.getEffectiveInverted,isPositiveMode:m.isPositiveMode,shouldShowInversionControls:m.shouldShowInversionControls,getLUT3DIndex:m.getLUT3DIndex,packLUT3DForWebGL:m.packLUT3DForWebGL,buildCombinedLUT:m.buildCombinedLUT,normalizeSourceType:m.normalizeSourceType,normalizeInversionMode:m.normalizeInversionMode,getLUT3DSamplingGLSL:m.getLUT3DSamplingGLSL,SOURCE_TYPE:g.SOURCE_TYPE,getStrictSourcePath:g.getStrictSourcePath,validateSourceMatch:g.validateSourceMatch,canUseSourceType:g.canUseSourceType,getAvailableSourceTypes:g.getAvailableSourceTypes,RAW_EXTENSIONS:v.RAW_EXTENSIONS,isRawFile:v.isRawFile,getRawFormatInfo:v.getRawFormatInfo,detectFileType:v.detectFileType,isBrowserLoadable:v.isBrowserLoadable,requiresServerDecode:v.requiresServerDecode,shaders:A,buildFragmentShader:A.buildFragmentShader,VERTEX_SHADER:A.VERTEX_SHADER,SHADER_VERSION:A.SHADER_VERSION}},4900:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});const r=(0,n(8332).H)()},4906:function(e,t,n){"use strict";n.d(t,{n:function(){return i},o:function(){return a}});var r=n(151),[i,a]=(0,r.q)({name:"ProviderContext",strict:!1})},4930:function(e,t,n){"use strict";n.d(t,{M:function(){return i}});var r=n(5043);function i(e){const t=(0,r.useRef)(null);return null===t.current&&(t.current=e()),t.current}},4962:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var r=n(1389);function i(e,t){let{id:n,"aria-label":i,"aria-labelledby":a}=e;if(n=(0,r.Bi)(n),a&&i){let e=new Set([n,...a.trim().split(/\s+/)]);a=[...e].join(" ")}else a&&(a=a.trim().split(/\s+/).join(" "));return i||a||!t||(i=t),{id:n,"aria-label":i,"aria-labelledby":a}}},5033:function(e,t,n){"use strict";function r(...e){return(...t)=>{for(let n of e)"function"===typeof n&&n(...t)}}n.d(t,{c:function(){return r}})},5040:function(e,t,n){"use strict";n.d(t,{u:function(){return i}});var r=n(8123);const i={test:(0,n(8436).$)("#"),parse:function(e){let t="",n="",r="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,r+=r,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:r.B.transform}},5043:function(e,t,n){"use strict";e.exports=n(4202)},5053:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(4208),i=n(9599),a=n(2104),o=n(2715);t.uniqBy=function(e,t=i.identity){return a.isArrayLikeObject(e)?r.uniqBy(Array.from(e),o.iteratee(t)):[]}},5082:function(e,t){"use strict";var n=60103,r=60106,i=60107,a=60108,o=60114,s=60109,l=60110,c=60112,u=60113,d=60120,h=60115,p=60116,f=60121,m=60122,g=60117,v=60129,A=60131;if("function"===typeof Symbol&&Symbol.for){var y=Symbol.for;n=y("react.element"),r=y("react.portal"),i=y("react.fragment"),a=y("react.strict_mode"),o=y("react.profiler"),s=y("react.provider"),l=y("react.context"),c=y("react.forward_ref"),u=y("react.suspense"),d=y("react.suspense_list"),h=y("react.memo"),p=y("react.lazy"),f=y("react.block"),m=y("react.server.block"),g=y("react.fundamental"),v=y("react.debug_trace_mode"),A=y("react.legacy_hidden")}function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case i:case o:case a:case u:case d:return e;default:switch(e=e&&e.$$typeof){case l:case c:case p:case h:case s:return e;default:return t}}case r:return t}}}t.isFragment=function(e){return b(e)===i}},5121:function(e){e.exports={PREVIEW_MAX_WIDTH_SERVER:1400,PREVIEW_MAX_WIDTH_CLIENT:1200,EXPORT_MAX_WIDTH:8e3,DEFAULT_TONE_PARAMS:{exposure:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0},CONTRAST_MID_GRAY:.46,DEFAULT_WB_PARAMS:{red:1,green:1,blue:1,temp:0,tint:0},DEFAULT_BASE_GAINS:{baseRed:1,baseGreen:1,baseBlue:1},DEFAULT_BASE_CORRECTION:{baseMode:"linear",baseDensityR:0,baseDensityG:0,baseDensityB:0},INVERSION_MODE_LABELS:{linear:"Linear",log:"Soft"},DEFAULT_INVERSION_PARAMS:{inverted:!1,inversionMode:"linear"},DEFAULT_CURVES:{rgb:[{x:0,y:0},{x:255,y:255}],red:[{x:0,y:0},{x:255,y:255}],green:[{x:0,y:0},{x:255,y:255}],blue:[{x:0,y:0},{x:255,y:255}]},DEFAULT_CROP_RECT:{x:0,y:0,w:1,h:1},WB_GAIN_LIMITS:{min:.05,max:50},JPEG_QUALITY:{preview:85,export:95,maximum:100},WEBGL_DEBOUNCE_MS:100,DEBUG:!1,FILM_PROFILES:{portra160:{gamma:.58,gammaR:.56,gammaG:.58,gammaB:.54,dMin:.1,dMax:2.8,toe:.3,shoulder:.2,name:"Kodak Portra 160"},portra400:{gamma:.6,gammaR:.58,gammaG:.6,gammaB:.55,dMin:.12,dMax:3,toe:.3,shoulder:.2,name:"Kodak Portra 400"},portra800:{gamma:.62,gammaR:.6,gammaG:.62,gammaB:.57,dMin:.15,dMax:3.2,toe:.35,shoulder:.25,name:"Kodak Portra 800"},ektar100:{gamma:.55,gammaR:.53,gammaG:.55,gammaB:.51,dMin:.08,dMax:3,toe:.25,shoulder:.3,name:"Kodak Ektar 100"},gold200:{gamma:.58,gammaR:.56,gammaG:.58,gammaB:.54,dMin:.12,dMax:2.9,toe:.3,shoulder:.2,name:"Kodak Gold 200"},colorplus200:{gamma:.57,gammaR:.55,gammaG:.57,gammaB:.53,dMin:.11,dMax:2.8,toe:.3,shoulder:.2,name:"Kodak ColorPlus 200"},pro400h:{gamma:.6,gammaR:.58,gammaG:.6,gammaB:.56,dMin:.12,dMax:3,toe:.25,shoulder:.2,name:"Fuji Pro 400H"},superia400:{gamma:.58,gammaR:.56,gammaG:.58,gammaB:.54,dMin:.13,dMax:2.9,toe:.3,shoulder:.2,name:"Fuji Superia 400"},c200:{gamma:.56,gammaR:.54,gammaG:.56,gammaB:.52,dMin:.1,dMax:2.8,toe:.3,shoulder:.2,name:"Fuji C200"},trix400:{gamma:.65,dMin:.15,dMax:2.8,toe:.35,shoulder:.25,name:"Kodak Tri-X 400"},tmax100:{gamma:.62,dMin:.1,dMax:2.6,toe:.2,shoulder:.15,name:"Kodak T-Max 100"},tmax400:{gamma:.64,dMin:.12,dMax:2.8,toe:.25,shoulder:.2,name:"Kodak T-Max 400"},hp5:{gamma:.63,dMin:.14,dMax:2.7,toe:.3,shoulder:.2,name:"Ilford HP5+"},delta100:{gamma:.6,dMin:.08,dMax:2.5,toe:.2,shoulder:.15,name:"Ilford Delta 100"},delta400:{gamma:.62,dMin:.1,dMax:2.7,toe:.25,shoulder:.2,name:"Ilford Delta 400"},acros100:{gamma:.6,dMin:.09,dMax:2.6,toe:.2,shoulder:.15,name:"Fuji Acros 100"},default:{gamma:.6,dMin:.1,dMax:3,toe:0,shoulder:0,name:"Generic Film"}},REFERENCE_WHITE_POINTS:{D50:5e3,D55:5500,D65:6500,D75:7500,A:2856,F2:4230,F11:4e3},TEMP_SLIDER_CONFIG:{min:-100,max:100,baseKelvin:6500,kelvinPerUnit:40}}},5173:function(e,t,n){e.exports=n(1497)()},5183:function(e){e.exports={FILM_CURVE_GLSL:"\n// ============================================================================\n// Film Curve: H&D Density Model (Q13: 3-segment S-curve)\n// ============================================================================\n\n// Hermite smoothstep for toe/shoulder blending\nfloat filmHermite(float t) {\n  float c = clamp(t, 0.0, 1.0);\n  return c * c * (3.0 - 2.0 * c);\n}\n\n// Three-segment gamma mapping (matches CPU _applyThreeSegmentGamma)\nfloat threeSegGamma(float d, float gamma, float toe, float shoulder) {\n  float toeBound = 0.25 * toe;\n  float shBound  = 1.0 - 0.25 * shoulder;\n  float gammaToe = gamma * 1.5;\n  float gammaSh  = gamma * 0.6;\n  float tw = 0.08;\n\n  if (d < toeBound) {\n    return pow(d, gammaToe);\n  } else if (d < toeBound + tw && toeBound > 0.0) {\n    float t = (d - toeBound) / tw;\n    float blend = filmHermite(t);\n    return mix(pow(d, gammaToe), pow(d, gamma), blend);\n  } else if (d > shBound) {\n    return pow(d, gammaSh);\n  } else if (d > shBound - tw && shoulder > 0.0) {\n    float t = (d - (shBound - tw)) / tw;\n    float blend = filmHermite(t);\n    return mix(pow(d, gamma), pow(d, gammaSh), blend);\n  } else {\n    return pow(d, gamma);\n  }\n}\n\n// Full film curve: per-channel gamma + toe/shoulder S-curve\nfloat applyFilmCurve(float value, float gamma, float dMin, float dMax,\n                      float toe, float shoulder) {\n  float normalized = clamp(value, 0.001, 1.0);\n  float density = -log(normalized) / log(10.0);\n  float densityNorm = clamp((density - dMin) / (dMax - dMin), 0.0, 1.0);\n\n  float gammaApplied;\n  if (toe <= 0.0 && shoulder <= 0.0) {\n    gammaApplied = pow(densityNorm, gamma);\n  } else {\n    gammaApplied = threeSegGamma(densityNorm, gamma, toe, shoulder);\n  }\n\n  float adjustedDensity = dMin + gammaApplied * (dMax - dMin);\n  float outputT = pow(10.0, -adjustedDensity);\n  return clamp(outputT, 0.0, 1.0);\n}\n\n// Legacy single-gamma overload (backward compat \u2014 used when toe=shoulder=0)\nfloat applyFilmCurveLegacy(float value) {\n  return applyFilmCurve(value, u_filmCurveGamma, u_filmCurveDMin, u_filmCurveDMax, 0.0, 0.0);\n}\n"}},5261:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6433);t.cloneDeep=function(e){return r.cloneDeepWithImpl(e,void 0,e,new Map,void 0)}},5272:function(e){const t={highlights:{hue:30,saturation:0},midtones:{hue:0,saturation:0},shadows:{hue:220,saturation:0},balance:0},n={shadowEnd:.25,highlightStart:.75};function r(e,t,n){return(.2126*e+.7152*t+.0722*n)/255}function i(e,t,n){if(e=(e%360+360)%360,e/=360,0===t){const e=Math.round(255*n);return[e,e,e]}const r=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),i=n<.5?n*(1+t):n+t-n*t,a=2*n-i;return[Math.round(255*r(a,i,e+1/3)),Math.round(255*r(a,i,e)),Math.round(255*r(a,i,e-1/3))]}function a(e,t=0){const r=.5+t/200;let i=0,a=0,s=0;if(e<n.shadowEnd)i=1;else if(e<r){const t=(e-n.shadowEnd)/(r-n.shadowEnd);i=1-o(t),a=o(t)}if(e>=n.shadowEnd&&e<=n.highlightStart)if(e>=r-.1&&e<=r+.1)a=1;else if(e<r){const t=(e-n.shadowEnd)/(r-n.shadowEnd);a=Math.max(a,o(t))}else{const t=(e-r)/(n.highlightStart-r);a=Math.max(a,1-o(t))}if(e>n.highlightStart)s=1;else if(e>r){const t=(e-r)/(n.highlightStart-r);s=o(t),a=Math.max(a,1-o(t))}return{shadow:i,midtone:a,highlight:s}}function o(e){return(e=Math.max(0,Math.min(1,e)))*e*(3-2*e)}function s(e){if(!e)return!0;const{highlights:t,midtones:n,shadows:r}=e;return(!t?.saturation||0===t.saturation)&&((!n?.saturation||0===n.saturation)&&(!r?.saturation||0===r.saturation))}function l(e){if(!e||s(e))return null;const{highlights:t={},midtones:n={},shadows:r={},balance:a=0}=e;return{highlightSat:(t.saturation??0)/100,midtoneSat:(n.saturation??0)/100,shadowSat:(r.saturation??0)/100,highlightColor:i(t.hue??30,1,.5),midtoneColor:i(n.hue??0,1,.5),shadowColor:i(r.hue??220,1,.5),balance:a}}function c(e,t,n,i){if(!i)return[e,t,n];const o=a(r(e,t,n),i.balance);let s=e,l=t,c=n;if(i.highlightSat>0&&o.highlight>0){const e=i.highlightSat*o.highlight*.3;s+=(i.highlightColor[0]-s)*e,l+=(i.highlightColor[1]-l)*e,c+=(i.highlightColor[2]-c)*e}if(i.midtoneSat>0&&o.midtone>0){const e=i.midtoneSat*o.midtone*.3;s+=(i.midtoneColor[0]-s)*e,l+=(i.midtoneColor[1]-l)*e,c+=(i.midtoneColor[2]-c)*e}if(i.shadowSat>0&&o.shadow>0){const e=i.shadowSat*o.shadow*.3;s+=(i.shadowColor[0]-s)*e,l+=(i.shadowColor[1]-l)*e,c+=(i.shadowColor[2]-c)*e}return[Math.max(0,Math.min(255,Math.round(s))),Math.max(0,Math.min(255,Math.round(l))),Math.max(0,Math.min(255,Math.round(c)))]}e.exports={DEFAULT_SPLIT_TONE_PARAMS:t,LUMINANCE_CONFIG:n,SPLIT_TONE_PRESETS:{warmCoolFilm:{name:"\u6696\u9ad8\u5149\u51b7\u9634\u5f71",highlights:{hue:40,saturation:20},shadows:{hue:230,saturation:25},balance:0},tealOrange:{name:"\u9752\u6a59\u7535\u5f71",highlights:{hue:30,saturation:30},shadows:{hue:190,saturation:35},balance:-10},vintageFade:{name:"\u590d\u53e4\u892a\u8272",highlights:{hue:50,saturation:15},shadows:{hue:200,saturation:20},balance:20},coolMood:{name:"\u51b7\u8c03",highlights:{hue:200,saturation:10},shadows:{hue:240,saturation:25},balance:0},warmMood:{name:"\u6696\u8c03",highlights:{hue:35,saturation:20},shadows:{hue:25,saturation:15},balance:0}},applySplitTone:function(e,t,n,o={}){if(s(o))return[e,t,n];const{highlights:l={},midtones:c={},shadows:u={},balance:d=0}=o,h=l.hue??30,p=(l.saturation??0)/100,f=c.hue??0,m=(c.saturation??0)/100,g=u.hue??220,v=(u.saturation??0)/100,A=a(r(e,t,n),d),y=i(h,1,.5),b=i(f,1,.5),x=i(g,1,.5);let _=e,w=t,S=n;if(p>0&&A.highlight>0){const e=p*A.highlight;_+=(y[0]-_)*e*.3,w+=(y[1]-w)*e*.3,S+=(y[2]-S)*e*.3}if(m>0&&A.midtone>0){const e=m*A.midtone;_+=(b[0]-_)*e*.3,w+=(b[1]-w)*e*.3,S+=(b[2]-S)*e*.3}if(v>0&&A.shadow>0){const e=v*A.shadow;_+=(x[0]-_)*e*.3,w+=(x[1]-w)*e*.3,S+=(x[2]-S)*e*.3}return[Math.max(0,Math.min(255,Math.round(_))),Math.max(0,Math.min(255,Math.round(w))),Math.max(0,Math.min(255,Math.round(S)))]},applySplitToneToArray:function(e,t,n={}){const r=n.channels||4;if(s(t))return e;const i=new Uint8Array(e.length),a=l(t);for(let o=0;o<e.length;o+=r){const t=e[o],n=e[o+1],s=e[o+2],[l,u,d]=c(t,n,s,a);i[o]=l,i[o+1]=u,i[o+2]=d,4===r&&(i[o+3]=e[o+3])}return i},isDefaultSplitTone:s,prepareSplitTone:l,applySplitToneFast:c,calculateLuminance:r,calculateZoneWeights:a,smoothstep:o,mergeSplitToneParams:function(e,n){return{highlights:{hue:n?.highlights?.hue??e?.highlights?.hue??t.highlights.hue,saturation:n?.highlights?.saturation??e?.highlights?.saturation??t.highlights.saturation},shadows:{hue:n?.shadows?.hue??e?.shadows?.hue??t.shadows.hue,saturation:n?.shadows?.saturation??e?.shadows?.saturation??t.shadows.saturation},balance:n?.balance??e?.balance??t.balance}},validateSplitToneParams:function(e){const t=[];return e&&"object"===typeof e?(e.highlights&&(void 0!==e.highlights.hue&&("number"!==typeof e.highlights.hue||e.highlights.hue<0||e.highlights.hue>360)&&t.push("highlights.hue must be between 0 and 360"),void 0!==e.highlights.saturation&&("number"!==typeof e.highlights.saturation||e.highlights.saturation<0||e.highlights.saturation>100)&&t.push("highlights.saturation must be between 0 and 100")),e.shadows&&(void 0!==e.shadows.hue&&("number"!==typeof e.shadows.hue||e.shadows.hue<0||e.shadows.hue>360)&&t.push("shadows.hue must be between 0 and 360"),void 0!==e.shadows.saturation&&("number"!==typeof e.shadows.saturation||e.shadows.saturation<0||e.shadows.saturation>100)&&t.push("shadows.saturation must be between 0 and 100")),void 0!==e.balance&&("number"!==typeof e.balance||e.balance<-100||e.balance>100)&&t.push("balance must be between -100 and 100"),{valid:0===t.length,errors:t}):{valid:!0,errors:[]}}}},5303:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2489),i=n(4704),a=n(6321),o=n(1444);t.has=function(e,t){let n;if(n=Array.isArray(t)?t:"string"===typeof t&&r.isDeepKey(t)&&null==e?.[t]?o.toPath(t):[t],0===n.length)return!1;let s=e;for(let r=0;r<n.length;r++){const e=n[r];if(null==s||!Object.hasOwn(s,e)){if(!((Array.isArray(s)||a.isArguments(s))&&i.isIndex(e)&&e<s.length))return!1}s=s[e]}return!0}},5316:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9709),i=n(7043),a=n(1444);t.orderBy=function(e,t,n,o){if(null==e)return[];n=o?void 0:n,Array.isArray(e)||(e=Object.values(e)),Array.isArray(t)||(t=null==t?[null]:[t]),0===t.length&&(t=[null]),Array.isArray(n)||(n=null==n?[]:[n]),n=n.map(e=>String(e));const s=(e,t)=>{let n=e;for(let r=0;r<t.length&&null!=n;++r)n=n[t[r]];return n},l=t.map(e=>(Array.isArray(e)&&1===e.length&&(e=e[0]),null==e||"function"===typeof e||Array.isArray(e)||i.isKey(e)?e:{key:e,path:a.toPath(e)}));return e.map(e=>({original:e,criteria:l.map(t=>((e,t)=>null==t||null==e?t:"object"===typeof e&&"key"in e?Object.hasOwn(t,e.key)?t[e.key]:s(t,e.path):"function"===typeof e?e(t):Array.isArray(e)?s(t,e):"object"===typeof t?t[e]:t)(t,e))})).slice().sort((e,t)=>{for(let i=0;i<l.length;i++){const a=r.compareValues(e.criteria[i],t.criteria[i],n[i]);if(0!==a)return a}return 0}).map(e=>e.original)}},5329:function(e,t,n){const{DEFAULT_INVERSION_PARAMS:r}=n(5121);function i(e){return 255-e}function a(e){return t=Math.round(255*(1-Math.log(e+1)/Math.log(256))),n=0,r=255,Math.max(n,Math.min(r,t));var t,n,r}function o(e,t={}){const{inverted:n=r.inverted,inversionMode:o=r.inversionMode}=t;if(!n)return e;switch(o){case"linear":default:return i(e);case"log":return a(e)}}function s(e,t){if(0===t)return e;const n=Math.max(e/255,.001),r=-Math.log10(n)-t,i=Math.pow(10,-r);return Math.max(0,Math.min(255,Math.round(255*i)))}function l(e,t){return 1===t?e:Math.max(0,Math.min(255,Math.round(e*t)))}e.exports={invertLinear:i,invertLog:a,applyInversion:o,applyInversionRGB:function(e,t,n,r={}){return[o(e,r),o(t,r),o(n,r)]},buildInversionLUT:function(e={}){const t=new Uint8Array(256);for(let n=0;n<256;n++)t[n]=o(n,e);return t},calculateBaseDensity:function(e,t,n){const r=.001,i=Math.max(e/255,r),a=Math.max(t/255,r),o=Math.max(n/255,r);return{densityR:-Math.log10(i),densityG:-Math.log10(a),densityB:-Math.log10(o)}},applyLogBaseCorrection:s,applyLogBaseCorrectionRGB:function(e,t,n,r,i,a){return[s(e,r),s(t,i),s(n,a)]},applyLinearBaseCorrection:l,applyLinearBaseCorrectionRGB:function(e,t,n,r,i,a){return[l(e,r),l(t,i),l(n,a)]}}},5330:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});const r=e=>Math.round(1e5*e)/1e5},5357:function(e,t,n){"use strict";n.d(t,{J:function(){return s},D:function(){return o}});const r=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function i(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||r.has(e)}let a=e=>!i(e);function o(e){"function"===typeof e&&(a=t=>t.startsWith("on")?!i(t):e(t))}try{o(require("@emotion/is-prop-valid").default)}catch{}function s(e,t,n){const r={};for(const o in e)"values"===o&&"object"===typeof e.values||(a(o)||!0===n&&i(o)||!t&&!i(o)||e.draggable&&o.startsWith("onDrag"))&&(r[o]=e[o]);return r}},5414:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(1293);t.throttle=function(e,t=0,n={}){const{leading:i=!0,trailing:a=!0}=n;return r.debounce(e,t,{leading:i,maxWait:t,trailing:a})}},5439:function(e,t,n){e.exports=n(5414).throttle},5453:function(e,t,n){const{DEFAULT_TONE_PARAMS:r,CONTRAST_MID_GRAY:i}=n(5121);function a(e={}){const{exposure:t=r.exposure,contrast:n=r.contrast,highlights:a=r.highlights,shadows:o=r.shadows,whites:s=r.whites,blacks:l=r.blacks}=e,c=new Uint8Array(256),u=Math.pow(2,(Number(t)||0)/50),d=Number(n)||0,h=259*(d+255)/(255*(259-d)),p=.002*-(Number(l)||0),f=1-.002*(Number(s)||0),m=.005*(Number(o)||0),g=.005*(Number(a)||0);for(let r=0;r<256;r++){let e=r/255;e*=u,e=(e-i)*h+i,f!==p&&(e=(e-p)/(f-p)),0!==m&&(e+=m*Math.pow(1-e,2)*e*4),0!==g&&(e+=g*Math.pow(e,2)*(1-e)*4),c[r]=Math.min(255,Math.max(0,Math.round(255*e)))}return c}e.exports={buildToneLUT:a,applyToneMapping:function(e,t={}){return a(t)[Math.min(255,Math.max(0,Math.round(e)))]}}},5481:function(e,t,n){"use strict";n.d(t,{gX:function(){return a}});var r=n(5043);const i=(0,r.createContext)({});function a(){var e;return null!==(e=(0,r.useContext)(i))&&void 0!==e?e:{}}},5491:function(e,t,n){"use strict";n.d(t,{Y:function(){return i}});var r=n(9601);function i(e){for(const t in e)r.B[t]={...r.B[t],...e[t]}}},5508:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6433),i=n(7599);t.cloneDeepWith=function(e,t){return r.cloneDeepWith(e,(n,a,o,s)=>{const l=t?.(n,a,o,s);if(void 0!==l)return l;if("object"===typeof e)switch(Object.prototype.toString.call(e)){case i.numberTag:case i.stringTag:case i.booleanTag:{const t=new e.constructor(e?.valueOf());return r.copyProperties(t,e),t}case i.argumentsTag:{const t={};return r.copyProperties(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}},5529:function(e,t,n){"use strict";n.d(t,{o:function(){return f}});var r=n(269);const i=Symbol.for("react-aria.i18n.locale"),a=Symbol.for("react-aria.i18n.strings");let o;class s{getStringForLocale(e,t){let n=this.getStringsForLocale(t)[e];if(!n)throw new Error(`Could not find intl message ${e} in ${t} locale`);return n}getStringsForLocale(e){let t=this.strings[e];return t||(t=function(e,t,n="en-US"){if(t[e])return t[e];let r=function(e){return Intl.Locale?new Intl.Locale(e).language:e.split("-")[0]}(e);if(t[r])return t[r];for(let i in t)if(i.startsWith(r+"-"))return t[i];return t[n]}(e,this.strings,this.defaultLocale),this.strings[e]=t),t}static getGlobalDictionaryForPackage(e){if("undefined"===typeof window)return null;let t=window[i];if(void 0===o){let e=window[a];if(!e)return null;o={};for(let n in e)o[n]=new s({[t]:e[n]},t)}let n=null===o||void 0===o?void 0:o[e];if(!n)throw new Error(`Strings for package "${e}" were not included by LocalizedStringProvider. Please add it to the list passed to createLocalizedStringDictionary.`);return n}constructor(e,t="en-US"){this.strings=Object.fromEntries(Object.entries(e).filter(([,e])=>e)),this.defaultLocale=t}}const l=new Map,c=new Map;class u{format(e,t){let n=this.strings.getStringForLocale(e,this.locale);return"function"===typeof n?n(t,this):n}plural(e,t,n="cardinal"){let r=t["="+e];if(r)return"function"===typeof r?r():r;let i=this.locale+":"+n,a=l.get(i);return a||(a=new Intl.PluralRules(this.locale,{type:n}),l.set(i,a)),r=t[a.select(e)]||t.other,"function"===typeof r?r():r}number(e){let t=c.get(this.locale);return t||(t=new Intl.NumberFormat(this.locale),c.set(this.locale,t)),t.format(e)}select(e,t){let n=e[t]||e.other;return"function"===typeof n?n():n}constructor(e,t){this.locale=e,this.strings=t}}var d=n(5043);const h=new WeakMap;function p(e,t){return t&&s.getGlobalDictionaryForPackage(t)||function(e){let t=h.get(e);return t||(t=new s(e),h.set(e,t)),t}(e)}function f(e,t){let{locale:n}=(0,r.Y)(),i=p(e,t);return(0,d.useMemo)(()=>new u(n,i),[n,i])}},5556:function(e,t,n){const{DEFAULT_TONE_PARAMS:r,DEFAULT_WB_PARAMS:i,DEFAULT_INVERSION_PARAMS:a,DEFAULT_CURVES:o,DEFAULT_CROP_RECT:s,JPEG_QUALITY:l,EXPORT_MAX_WIDTH:c}=n(5121),{DEFAULT_HSL_PARAMS:u}=n(3771),{DEFAULT_SPLIT_TONE_PARAMS:d}=n(5272),h={red:{hue:0,saturation:0,luminance:0},orange:{hue:0,saturation:0,luminance:0},yellow:{hue:0,saturation:0,luminance:0},green:{hue:0,saturation:0,luminance:0},cyan:{hue:0,saturation:0,luminance:0},blue:{hue:0,saturation:0,luminance:0},purple:{hue:0,saturation:0,luminance:0},magenta:{hue:0,saturation:0,luminance:0}},p={highlights:{hue:30,saturation:0},midtones:{hue:0,saturation:0},shadows:{hue:220,saturation:0},balance:0},f={version:3,inverted:a.inverted,inversionMode:a.inversionMode,filmCurveEnabled:!1,filmCurveProfile:"default",red:i.red,green:i.green,blue:i.blue,temp:i.temp,tint:i.tint,exposure:r.exposure,contrast:r.contrast,highlights:r.highlights,shadows:r.shadows,whites:r.whites,blacks:r.blacks,curves:{...o},hslParams:{...h},saturation:0,splitToning:{...p},baseMode:"linear",baseRed:1,baseGreen:1,baseBlue:1,baseDensityR:0,baseDensityG:0,baseDensityB:0,densityLevelsEnabled:!1,cropRect:{...s},rotation:0,lut1:null,lut1Intensity:1,lut2:null,lut2Intensity:1};function m(e,t={}){const n={...f};if(e){const t="string"===typeof e?JSON.parse(e):e;Object.assign(n,t)}return Object.assign(n,t),n.version=3,g(n)}function g(e){const t=e.version||1,n={...e};var r;return t<2&&(n.hslParams||n.hsl||(n.hslParams={...h}),n.splitToning||(n.splitToning={...p}),n.version=2),t<3&&(n.saturation=n.saturation??0,n.version=3),n.hsl&&!n.hslParams?(n.hslParams=n.hsl,delete n.hsl):n.hsl&&delete n.hsl,n.hslParams&&n.hslParams.hue&&"object"===typeof n.hslParams.hue&&!n.hslParams.red&&(n.hslParams=function(e){const t={aqua:"cyan"},n=["red","orange","yellow","green","aqua","cyan","blue","purple","magenta"],r={...h};for(const i of n){const n=t[i]||i;h[n]&&(r[n]={hue:e.hue&&e.hue[i]||0,saturation:e.saturation&&e.saturation[i]||0,luminance:e.luminance&&e.luminance[i]||0})}return r}(n.hslParams)),n.splitToning&&("highlightHue"in n.splitToning||"shadowHue"in n.splitToning)&&(n.splitToning={highlights:{hue:(r=n.splitToning).highlightHue||0,saturation:r.highlightSaturation||0},midtones:{hue:0,saturation:0},shadows:{hue:r.shadowHue||0,saturation:r.shadowSaturation||0},balance:r.balance??0}),n.hslParams=n.hslParams||{...h},n.splitToning=n.splitToning||{...p},n.curves=n.curves||{...o},n.cropRect=n.cropRect||{...s},n}e.exports={PARAMS_VERSION:3,DEFAULT_PROCESSING_PARAMS:f,DEFAULT_HSL_PARAMS:h,DEFAULT_SPLIT_TONING:p,buildExportParams:m,validateExportParams:function(e){const t=[],n=[{key:"exposure",min:-100,max:100},{key:"contrast",min:-100,max:100},{key:"highlights",min:-100,max:100},{key:"shadows",min:-100,max:100},{key:"whites",min:-100,max:100},{key:"blacks",min:-100,max:100},{key:"temp",min:-100,max:100},{key:"tint",min:-100,max:100},{key:"red",min:.05,max:50},{key:"green",min:.05,max:50},{key:"blue",min:.05,max:50},{key:"lut1Intensity",min:0,max:1},{key:"lut2Intensity",min:0,max:1},{key:"rotation",min:-360,max:360}];for(const{key:i,min:a,max:o}of n){const n=e[i];void 0!==n&&null!==n&&("number"===typeof n&&Number.isFinite(n)?(n<a||n>o)&&t.push(`${i} must be between ${a} and ${o}`):t.push(`${i} must be a finite number`))}if(e.inversionMode&&!["linear","log"].includes(e.inversionMode)&&t.push('inversionMode must be "linear" or "log"'),e.cropRect){const{x:n,y:r,w:i,h:a}=e.cropRect;(n<0||n>1||r<0||r>1||i<=0||i>1||a<=0||a>1)&&t.push("cropRect values must be normalized (0-1)"),(n+i>1.01||r+a>1.01)&&t.push("cropRect extends beyond image bounds")}if(e.curves)for(const i of["rgb","red","green","blue"]){const n=e.curves[i];if(n&&Array.isArray(n))for(const e of n){if("number"!==typeof e.x||"number"!==typeof e.y){t.push(`curves.${i} contains invalid point`);break}if(e.x<0||e.x>255||e.y<0||e.y>255){t.push(`curves.${i} point out of range (0-255)`);break}}}void 0!==e.saturation&&null!==e.saturation&&("number"===typeof e.saturation&&Number.isFinite(e.saturation)?(e.saturation<-100||e.saturation>100)&&t.push("saturation must be between -100 and 100"):t.push("saturation must be a finite number"));const r=e.hslParams||e.hsl;if(r){const e=["red","orange","yellow","green","cyan","blue","purple","magenta"];for(const n of e){const e=r[n];e&&(void 0!==e.hue&&(e.hue<-180||e.hue>180)&&t.push(`hslParams.${n}.hue must be between -180 and 180`),void 0!==e.saturation&&(e.saturation<-100||e.saturation>100)&&t.push(`hslParams.${n}.saturation must be between -100 and 100`),void 0!==e.luminance&&(e.luminance<-100||e.luminance>100)&&t.push(`hslParams.${n}.luminance must be between -100 and 100`))}}return{valid:0===t.length,errors:t}},getPhotoProcessingParams:function(e){if(!e)return{...f};let t;return t=e.processing_params?"string"===typeof e.processing_params?JSON.parse(e.processing_params):e.processing_params:{},m(null,t)},migrateParams:g,hasParamsDifference:function(e,t){const n=m(null,e),r=m(null,t),i=["inverted","inversionMode","filmCurveEnabled","filmCurveProfile","red","green","blue","temp","tint","exposure","contrast","highlights","shadows","whites","blacks","saturation","rotation","lut1","lut1Intensity","lut2","lut2Intensity","baseMode","baseRed","baseGreen","baseBlue","baseDensityR","baseDensityG","baseDensityB","densityLevelsEnabled"];for(const o of i)if(n[o]!==r[o])return!0;const a=["x","y","w","h"];for(const o of a)if(Math.abs((n.cropRect?.[o]||0)-(r.cropRect?.[o]||0))>.001)return!0;return JSON.stringify(n.curves)!==JSON.stringify(r.curves)||(JSON.stringify(n.hslParams)!==JSON.stringify(r.hslParams)||JSON.stringify(n.splitToning)!==JSON.stringify(r.splitToning))},serializeParams:function(e){const t=m(null,e);return JSON.stringify(t)},deserializeParams:function(e){return e?m(null,"string"===typeof e?JSON.parse(e):e):{...f}}}},5583:function(e,t,n){"use strict";n.d(t,{h:function(){return h},q:function(){return d}});var r=n(935),i=n(8412);const a=new Set;let o=!1,s=!1,l=!1;function c(){if(s){const e=Array.from(a).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),n=new Map;t.forEach(e=>{const t=(0,r.W9)(e);t.length&&(n.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=n.get(e);t&&t.forEach(([t,n])=>{e.getValue(t)?.set(n)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}s=!1,o=!1,a.forEach(e=>e.complete(l)),a.clear()}function u(){a.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(s=!0)})}function d(){l=!0,u(),c(),l=!1}class h{constructor(e,t,n,r,i,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=i,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(a.add(this),o||(o=!0,i.Gt.read(u),i.Gt.resolveKeyframes(c))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;if(null===e[0]){const i=r?.get(),a=e[e.length-1];if(void 0!==i)e[0]=i;else if(n&&t){const r=n.readValue(t,a);void 0!==r&&null!==r&&(e[0]=r)}void 0===e[0]&&(e[0]=a),r&&void 0===i&&r.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),a.delete(this)}cancel(){"scheduled"===this.state&&(a.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}},5603:function(e,t,n){"use strict";n.d(t,{Cl:function(){return C},K7:function(){return E},ME:function(){return T},pP:function(){return S}});var r=n(171),i=n(8493),a=n(7418),o=n(9427),s=n(9673),l=n(5043);let c=null,u="keyboard",d=new Set,h=new Map,p=!1,f=!1;const m={Tab:!0,Escape:!0};function g(e,t){for(let n of d)n(e,t)}function v(e){p=!0,!a.Fe.isOpening&&function(e){return!(e.metaKey||!(0,o.cX)()&&e.altKey||e.ctrlKey||"Control"===e.key||"Shift"===e.key||"Meta"===e.key)}(e)&&(c="keyboard",u="keyboard",g("keyboard",e))}function A(e){c="pointer",u="pointerType"in e?e.pointerType:"mouse","mousedown"!==e.type&&"pointerdown"!==e.type||(p=!0,g("pointer",e))}function y(e){!a.Fe.isOpening&&(0,s.Y)(e)&&(p=!0,c="virtual",u="virtual")}function b(e){e.target!==window&&e.target!==document&&!r.lR&&e.isTrusted&&(p||f||(c="virtual",u="virtual",g("virtual",e)),p=!1,f=!1)}function x(){r.lR||(p=!1,f=!0)}function _(e){if("undefined"===typeof window||"undefined"===typeof document||h.get((0,i.mD)(e)))return;const t=(0,i.mD)(e),n=(0,i.TW)(e);let r=t.HTMLElement.prototype.focus;t.HTMLElement.prototype.focus=function(){p=!0,r.apply(this,arguments)},n.addEventListener("keydown",v,!0),n.addEventListener("keyup",v,!0),n.addEventListener("click",y,!0),t.addEventListener("focus",b,!0),t.addEventListener("blur",x,!1),"undefined"!==typeof PointerEvent&&(n.addEventListener("pointerdown",A,!0),n.addEventListener("pointermove",A,!0),n.addEventListener("pointerup",A,!0)),t.addEventListener("beforeunload",()=>{w(e)},{once:!0}),h.set(t,{focus:r})}const w=(e,t)=>{const n=(0,i.mD)(e),r=(0,i.TW)(e);t&&r.removeEventListener("DOMContentLoaded",t),h.has(n)&&(n.HTMLElement.prototype.focus=h.get(n).focus,r.removeEventListener("keydown",v,!0),r.removeEventListener("keyup",v,!0),r.removeEventListener("click",y,!0),n.removeEventListener("focus",b,!0),n.removeEventListener("blur",x,!1),"undefined"!==typeof PointerEvent&&(r.removeEventListener("pointerdown",A,!0),r.removeEventListener("pointermove",A,!0),r.removeEventListener("pointerup",A,!0)),h.delete(n))};function S(){return"pointer"!==c}function T(){return c}function C(e){c=e,u="pointer"===e?"mouse":e,g(e,null)}"undefined"!==typeof document&&function(e){const t=(0,i.TW)(e);let n;"loading"!==t.readyState?_(e):(n=()=>{_(e)},t.addEventListener("DOMContentLoaded",n))}();const M=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function E(e,t,n){_(),(0,l.useEffect)(()=>{let t=(t,r)=>{(function(e,t,n){let r=(0,i.TW)(null===n||void 0===n?void 0:n.target);const a="undefined"!==typeof window?(0,i.mD)(null===n||void 0===n?void 0:n.target).HTMLInputElement:HTMLInputElement,o="undefined"!==typeof window?(0,i.mD)(null===n||void 0===n?void 0:n.target).HTMLTextAreaElement:HTMLTextAreaElement,s="undefined"!==typeof window?(0,i.mD)(null===n||void 0===n?void 0:n.target).HTMLElement:HTMLElement,l="undefined"!==typeof window?(0,i.mD)(null===n||void 0===n?void 0:n.target).KeyboardEvent:KeyboardEvent;return!((e=e||r.activeElement instanceof a&&!M.has(r.activeElement.type)||r.activeElement instanceof o||r.activeElement instanceof s&&r.activeElement.isContentEditable)&&"keyboard"===t&&n instanceof l&&!m[n.key])})(!!(null===n||void 0===n?void 0:n.isTextInput),t,r)&&e(S())};return d.add(t),()=>{d.delete(t)}},t)}},5773:function(e,t,n){"use strict";n.d(t,{k:function(){return a}});var r=n(3779),i=n(5043);function a(e={}){const[t,n]=(0,i.useState)([]),a=(0,i.useCallback)(e=>{const t=e.target,i=Math.max(t.clientWidth,t.clientHeight);n(t=>[...t,{key:(0,r.Lz)(t.length.toString()),size:i,x:e.x-i/2,y:e.y-i/2}])},[]);return{ripples:t,onClear:(0,i.useCallback)(e=>{n(t=>t.filter(t=>t.key!==e))},[]),onPress:a,...e}}},5793:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var r=n(6650);function i(e,t){(0,r.N)(()=>{if(e&&e.ref&&t)return e.ref.current=t.current,()=>{e.ref&&(e.ref.current=null)}})}},5859:function(e,t,n){"use strict";function r(e){const t=[{},{}];return e?.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function i(e,t,n,i){if("function"===typeof t){const[a,o]=r(i);t=t(void 0!==n?n:e.custom,a,o)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[a,o]=r(i);t=t(void 0!==n?n:e.custom,a,o)}return t}n.d(t,{a:function(){return i}})},5990:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.getTag=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}},6031:function(e,t,n){"use strict";n.d(t,{f:function(){return ot}});var r=n(8878);function i(e){e.duration=0,e.type="keyframes"}var a=n(8412),o=n(8560),s=n(217),l=n(3084),c=n(7178),u=n(8523),d=n(9565),h=n(2001),p=n(6087),f=n(2326),m=n(5040),g=n(2879);function v(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var A=n(8123);function y(e,t){return n=>n>0?t:e}var b=n(1853);const x=(e,t,n)=>{const r=e*e,i=n*(t*t-r)+r;return i<0?0:Math.sqrt(i)},_=[m.u,A.B,g.V];function w(e){const t=(n=e,_.find(e=>e.test(n)));var n;if((0,d.$)(Boolean(t),`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!Boolean(t))return!1;let r=t.parse(e);return t===g.V&&(r=function({hue:e,saturation:t,lightness:n,alpha:r}){e/=360,n/=100;let i=0,a=0,o=0;if(t/=100){const r=n<.5?n*(1+t):n+t-n*t,s=2*n-r;i=v(s,r,e+1/3),a=v(s,r,e),o=v(s,r,e-1/3)}else i=a=o=n;return{red:Math.round(255*i),green:Math.round(255*a),blue:Math.round(255*o),alpha:r}}(r)),r}const S=(e,t)=>{const n=w(e),r=w(t);if(!n||!r)return y(e,t);const i={...n};return e=>(i.red=x(n.red,r.red,e),i.green=x(n.green,r.green,e),i.blue=x(n.blue,r.blue,e),i.alpha=(0,b.k)(n.alpha,r.alpha,e),A.B.transform(i))},T=new Set(["none","hidden"]);function C(e,t){return n=>(0,b.k)(e,t,n)}function M(e){return"number"===typeof e?C:"string"===typeof e?(0,h.p)(e)?y:p.y.test(e)?S:N:Array.isArray(e)?E:"object"===typeof e?p.y.test(e)?S:P:y}function E(e,t){const n=[...e],r=n.length,i=e.map((e,n)=>M(e)(e,t[n]));return e=>{for(let t=0;t<r;t++)n[t]=i[t](e);return n}}function P(e,t){const n={...e,...t},r={};for(const i in n)void 0!==e[i]&&void 0!==t[i]&&(r[i]=M(e[i])(e[i],t[i]));return e=>{for(const t in r)n[t]=r[t](e);return n}}const N=(e,t)=>{const n=f.f.createTransformer(t),r=(0,f.V)(e),i=(0,f.V)(t);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?T.has(e)&&!i.values.length||T.has(t)&&!r.values.length?function(e,t){return T.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):(0,o.F)(E(function(e,t){const n=[],r={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){const a=t.types[i],o=e.indexes[a][r[a]],s=e.values[o]??0;n[i]=s,r[a]++}return n}(r,i),i.values),n):((0,d.$)(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),y(e,t))};function k(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return(0,b.k)(e,t,n);return M(e)(e,t)}const R=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>a.Gt.update(t,e),stop:()=>(0,a.WG)(t),now:()=>a.uv.isProcessing?a.uv.timestamp:c.k.now()}},L=(e,t,n=10)=>{let r="";const i=Math.max(Math.round(t/n),2);for(let a=0;a<i;a++)r+=Math.round(1e4*e(a/(i-1)))/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},O=2e4;function j(e){let t=0;let n=e.next(t);for(;!n.done&&t<O;)t+=50,n=e.next(t);return t>=O?1/0:t}var D=n(4784);function I(e,t,n){const r=Math.max(t-5,0);return(0,D.f)(n-e(r),t-r)}const B=100,F=10,z=1,U=0,V=800,G=.3,q=.3,W={granular:.01,default:2},H={granular:.005,default:.5},$=.01,K=10,X=.05,Y=1,Q=.001;function Z({duration:e=V,bounce:t=G,velocity:n=U,mass:r=z}){let i,a;(0,d.$)(e<=(0,l.f)(K),"Spring duration must be 10 seconds or less","spring-duration-limit");let o=1-t;o=(0,s.q)(X,Y,o),e=(0,s.q)($,K,(0,l.X)(e)),o<1?(i=t=>{const r=t*o,i=r*e,a=r-n,s=ee(t,o),l=Math.exp(-i);return Q-a/s*l},a=t=>{const r=t*o*e,a=r*n+n,s=Math.pow(o,2)*Math.pow(t,2)*e,l=Math.exp(-r),c=ee(Math.pow(t,2),o);return(-i(t)+Q>0?-1:1)*((a-s)*l)/c}):(i=t=>Math.exp(-t*e)*((t-n)*e+1)-.001,a=t=>Math.exp(-t*e)*(e*e*(n-t)));const c=function(e,t,n){let r=n;for(let i=1;i<J;i++)r-=e(r)/t(r);return r}(i,a,5/e);if(e=(0,l.f)(e),isNaN(c))return{stiffness:B,damping:F,duration:e};{const t=Math.pow(c,2)*r;return{stiffness:t,damping:2*o*Math.sqrt(r*t),duration:e}}}const J=12;function ee(e,t){return e*Math.sqrt(1-t*t)}const te=["duration","bounce"],ne=["stiffness","damping","mass"];function re(e,t){return t.some(t=>void 0!==e[t])}function ie(e=q,t=G){const n="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:i}=n;const a=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],c={done:!1,value:a},{stiffness:u,damping:d,mass:h,duration:p,velocity:f,isResolvedFromDuration:m}=function(e){let t={velocity:U,stiffness:B,damping:F,mass:z,isResolvedFromDuration:!1,...e};if(!re(e,ne)&&re(e,te))if(e.visualDuration){const n=e.visualDuration,r=2*Math.PI/(1.2*n),i=r*r,a=2*(0,s.q)(.05,1,1-(e.bounce||0))*Math.sqrt(i);t={...t,mass:z,stiffness:i,damping:a}}else{const n=Z(e);t={...t,...n,mass:z},t.isResolvedFromDuration=!0}return t}({...n,velocity:-(0,l.X)(n.velocity||0)}),g=f||0,v=d/(2*Math.sqrt(u*h)),A=o-a,y=(0,l.X)(Math.sqrt(u/h)),b=Math.abs(A)<5;let x;if(r||(r=b?W.granular:W.default),i||(i=b?H.granular:H.default),v<1){const e=ee(y,v);x=t=>{const n=Math.exp(-v*y*t);return o-n*((g+v*y*A)/e*Math.sin(e*t)+A*Math.cos(e*t))}}else if(1===v)x=e=>o-Math.exp(-y*e)*(A+(g+y*A)*e);else{const e=y*Math.sqrt(v*v-1);x=t=>{const n=Math.exp(-v*y*t),r=Math.min(e*t,300);return o-n*((g+v*y*A)*Math.sinh(r)+e*A*Math.cosh(r))/e}}const _={calculatedDuration:m&&p||null,next:e=>{const t=x(e);if(m)c.done=e>=p;else{let n=0===e?g:0;v<1&&(n=0===e?(0,l.f)(g):I(x,e,t));const a=Math.abs(n)<=r,s=Math.abs(o-t)<=i;c.done=a&&s}return c.value=c.done?o:t,c},toString:()=>{const e=Math.min(j(_),O),t=L(t=>_.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return _}function ae({keyframes:e,velocity:t=0,power:n=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:o,min:s,max:l,restDelta:c=.5,restSpeed:u}){const d=e[0],h={done:!1,value:d},p=e=>void 0===s?l:void 0===l||Math.abs(s-e)<Math.abs(l-e)?s:l;let f=n*t;const m=d+f,g=void 0===o?m:o(m);g!==m&&(f=g-d);const v=e=>-f*Math.exp(-e/r),A=e=>g+v(e),y=e=>{const t=v(e),n=A(e);h.done=Math.abs(t)<=c,h.value=h.done?g:n};let b,x;const _=e=>{var t;(t=h.value,void 0!==s&&t<s||void 0!==l&&t>l)&&(b=e,x=ie({keyframes:[h.value,p(h.value)],velocity:I(A,e,h.value),damping:i,stiffness:a,restDelta:c,restSpeed:u}))};return _(0),{calculatedDuration:null,next:e=>{let t=!1;return x||void 0!==b||(t=!0,y(e),_(e)),void 0!==b&&e>=b?x.next(e-b):(!t&&y(e),h)}}}ie.applyToOptions=e=>{const t=function(e,t=100,n){const r=n({...e,keyframes:[0,t]}),i=Math.min(j(r),O);return{type:"keyframes",ease:e=>r.next(i*e).value/t,duration:(0,l.X)(i)}}(e,100,ie);return e.ease=t.ease,e.duration=(0,l.f)(t.duration),e.type="keyframes",e};var oe=n(4760);const se=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function le(e,t,n,r){if(e===t&&n===r)return oe.l;const i=t=>function(e,t,n,r,i){let a,o,s=0;do{o=t+(n-t)/2,a=se(o,r,i)-e,a>0?n=o:t=o}while(Math.abs(a)>1e-7&&++s<12);return o}(t,0,1,e,n);return e=>0===e||1===e?e:se(i(e),t,r)}const ce=le(.42,0,1,1),ue=le(0,0,.58,1),de=le(.42,0,.58,1);var he=n(9086),pe=n(1827);const fe=le(.33,1.53,.69,.99),me=(0,pe.G)(fe),ge=(0,he.V)(me),ve=e=>(e*=2)<1?.5*me(e):.5*(2-Math.pow(2,-10*(e-1)));var Ae=n(2427);const ye=e=>Array.isArray(e)&&"number"===typeof e[0],be={linear:oe.l,easeIn:ce,easeInOut:de,easeOut:ue,circIn:Ae.po,circInOut:Ae.tn,circOut:Ae.yT,backIn:me,backInOut:ge,backOut:fe,anticipate:ve},xe=e=>{if(ye(e)){(0,d.V)(4===e.length,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");const[t,n,r,i]=e;return le(t,n,r,i)}return"string"===typeof e?((0,d.V)(void 0!==be[e],`Invalid easing type '${e}'`,"invalid-easing-type"),be[e]):e};var _e=n(2896),we=n(2349);function Se(e,t,{clamp:n=!0,ease:r,mixer:i}={}){const a=e.length;if((0,d.V)(a===t.length,"Both input and output ranges must be the same length","range-length"),1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];const l=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const c=function(e,t,n){const r=[],i=n||_e.W.mix||k,a=e.length-1;for(let s=0;s<a;s++){let n=i(e[s],e[s+1]);if(t){const e=Array.isArray(t)?t[s]||oe.l:t;n=(0,o.F)(e,n)}r.push(n)}return r}(t,r,i),u=c.length,h=n=>{if(l&&n<e[0])return t[0];let r=0;if(u>1)for(;r<e.length-2&&!(n<e[r+1]);r++);const i=(0,we.q)(e[r],e[r+1],n);return c[r](i)};return n?t=>h((0,s.q)(e[0],e[a-1],t)):h}function Te(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let r=1;r<=t;r++){const i=(0,we.q)(0,t,r);e.push((0,b.k)(n,1,i))}}(t,e.length-1),t}function Ce({duration:e=300,keyframes:t,times:n,ease:r="easeInOut"}){const i=(e=>Array.isArray(e)&&"number"!==typeof e[0])(r)?r.map(xe):xe(r),a={done:!1,value:t[0]},o=function(e,t){return e.map(e=>e*t)}(n&&n.length===t.length?n:Te(t),e),s=Se(o,t,{ease:Array.isArray(i)?i:(l=t,c=i,l.map(()=>c||de).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(a.value=s(t),a.done=t>=e,a)}}const Me=e=>null!==e;function Ee(e,{repeat:t,repeatType:n="loop"},r,i=1){const a=e.filter(Me),o=i<0||t&&"loop"!==n&&t%2===1?0:a.length-1;return o&&void 0!==r?r:a[o]}const Pe={decay:ae,inertia:ae,tween:Ce,keyframes:Ce,spring:ie};function Ne(e){"string"===typeof e.type&&(e.type=Pe[e.type])}class ke{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const Re=e=>e/100;class Le extends ke{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==c.k.now()&&this.tick(c.k.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},u.q.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;Ne(e);const{type:t=Ce,repeat:n=0,repeatDelay:r=0,repeatType:i,velocity:a=0}=e;let{keyframes:s}=e;const l=t||Ce;l!==Ce&&"number"!==typeof s[0]&&(this.mixKeyframes=(0,o.F)(Re,k(s[0],s[1])),s=[0,100]);const c=l({...e,keyframes:s});"mirror"===i&&(this.mirroredGenerator=l({...e,keyframes:[...s].reverse(),velocity:-a})),null===c.calculatedDuration&&(c.calculatedDuration=j(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=c}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:n,totalDuration:r,mixKeyframes:i,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(null===this.startTime)return n.next(0);const{delay:c=0,keyframes:u,repeat:d,repeatType:h,repeatDelay:p,type:f,onUpdate:m,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const v=this.currentTime-c*(this.playbackSpeed>=0?1:-1),A=this.playbackSpeed>=0?v<0:v>r;this.currentTime=Math.max(v,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=r);let y=this.currentTime,b=n;if(d){const e=Math.min(this.currentTime,r)/o;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===h?(n=1-n,p&&(n-=p/o)):"mirror"===h&&(b=a)),y=(0,s.q)(0,1,n)*o}const x=A?{done:!1,value:u[0]}:b.next(y);i&&(x.value=i(x.value));let{done:_}=x;A||null===l||(_=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&_);return w&&f!==ae&&(x.value=Ee(u,this.options,g,this.speed)),m&&m(x.value),w&&this.finish(),x}then(e,t){return this.finished.then(e,t)}get duration(){return(0,l.X)(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+(0,l.X)(e)}get time(){return(0,l.X)(this.currentTime)}set time(e){e=(0,l.f)(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(c.k.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=(0,l.X)(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=R,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();const n=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=n):null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(c.k.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,u.q.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}var Oe=n(5583);function je(e){let t;return()=>(void 0===t&&(t=e()),t)}const De=je(()=>void 0!==window.ScrollTimeline);var Ie=n(7151);const Be={};function Fe(e,t){const n=je(e);return()=>Be[t]??n()}const ze=Fe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),Ue=([e,t,n,r])=>`cubic-bezier(${e}, ${t}, ${n}, ${r})`,Ve={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ue([0,.65,.55,1]),circOut:Ue([.55,0,1,.45]),backIn:Ue([.31,.01,.66,-.59]),backOut:Ue([.33,1.53,.69,.99])};function Ge(e,t){return e?"function"===typeof e?ze()?L(e,t):"ease-out":ye(e)?Ue(e):Array.isArray(e)?e.map(e=>Ge(e,t)||Ve.easeOut):Ve[e]:void 0}function qe(e,t,n,{delay:r=0,duration:i=300,repeat:a=0,repeatType:o="loop",ease:s="easeOut",times:l}={},c=void 0){const d={[t]:n};l&&(d.offset=l);const h=Ge(s,i);Array.isArray(h)&&(d.easing=h),Ie.Q.value&&u.q.waapi++;const p={delay:r,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"};c&&(p.pseudoElement=c);const f=e.animate(d,p);return Ie.Q.value&&f.finished.finally(()=>{u.q.waapi--}),f}function We(e){return"function"===typeof e&&"applyToOptions"in e}class He extends ke{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:r,pseudoElement:i,allowFlatten:a=!1,finalKeyframe:o,onComplete:s}=e;this.isPseudoElement=Boolean(i),this.allowFlatten=a,this.options=e,(0,d.V)("string"!==typeof e.type,'Mini animate() doesn\'t support "type" as a string.',"mini-spring");const l=function({type:e,...t}){return We(e)&&ze()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=qe(t,n,r,l,i),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const e=Ee(r,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,n){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,n):e.style[t]=n}(t,n,e),this.animation.cancel()}s?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return(0,l.X)(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+(0,l.X)(e)}get time(){return(0,l.X)(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=(0,l.f)(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&De()?(this.animation.timeline=e,oe.l):t(this)}}const $e={anticipate:ve,backInOut:ge,circInOut:Ae.tn};function Ke(e){"string"===typeof e.ease&&e.ease in $e&&(e.ease=$e[e.ease])}class Xe extends He{constructor(e){Ke(e),Ne(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:n,onComplete:r,element:i,...a}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const o=new Le({...a,autoplay:!1}),s=(0,l.f)(this.finishedTime??this.time);t.setWithVelocity(o.sample(s-10).value,o.sample(s).value,10),o.stop()}}const Ye=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!f.f.test(e)&&"0"!==e||e.startsWith("url(")));const Qe=new Set(["opacity","clipPath","filter","transform"]),Ze=je(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class Je extends ke{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:a="loop",keyframes:o,name:s,motionValue:l,element:u,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=c.k.now();const h={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:i,repeatType:a,name:s,motionValue:l,element:u,...d},p=u?.KeyframeResolver||Oe.h;this.keyframeResolver=new p(o,(e,t,n)=>this.onKeyframesResolved(e,t,h,!n),s,l,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,n,r){this.keyframeResolver=void 0;const{name:a,type:o,velocity:s,delay:l,isHandoff:u,onUpdate:h}=n;this.resolvedAt=c.k.now(),function(e,t,n,r){const i=e[0];if(null===i)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],o=Ye(i,t),s=Ye(a,t);return(0,d.$)(o===s,`You are trying to animate ${t} from "${i}" to "${a}". "${o?a:i}" is not an animatable value.`,"value-not-animatable"),!(!o||!s)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||We(n))&&r)}(e,a,o,s)||(!_e.W.instantAnimations&&l||h?.(Ee(e,n,t)),e[0]=e[e.length-1],i(n),n.repeat=0);const p={startTime:r?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},f=!u&&function(e){const{motionValue:t,name:n,repeatDelay:r,repeatType:i,damping:a,type:o}=e,s=t?.owner?.current;if(!(s instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=t.owner.getProps();return Ze()&&n&&Qe.has(n)&&("transform"!==n||!c)&&!l&&!r&&"mirror"!==i&&0!==a&&"inertia"!==o}(p)?new Xe({...p,element:p.motionValue.owner.current}):new Le(p);f.finished.then(()=>this.notifyFinished()).catch(oe.l),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),(0,Oe.q)()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const et=e=>null!==e;var tt=n(8689);const nt={type:"spring",stiffness:500,damping:25,restSpeed:10},rt={type:"keyframes",duration:.8},it={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},at=(e,{keyframes:t})=>t.length>2?rt:tt.f.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:nt:it;const ot=(e,t,n,o={},s,c)=>u=>{const d=(0,r.r)(o,e)||{},h=d.delay||o.delay||0;let{elapsed:p=0}=o;p-=(0,l.f)(h);const f={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...d,delay:-p,onUpdate:e=>{t.set(e),d.onUpdate&&d.onUpdate(e)},onComplete:()=>{u(),d.onComplete&&d.onComplete()},name:e,motionValue:t,element:c?void 0:s};(function({when:e,delay:t,delayChildren:n,staggerChildren:r,staggerDirection:i,repeat:a,repeatType:o,repeatDelay:s,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(d)||Object.assign(f,at(e,f)),f.duration&&(f.duration=(0,l.f)(f.duration)),f.repeatDelay&&(f.repeatDelay=(0,l.f)(f.repeatDelay)),void 0!==f.from&&(f.keyframes[0]=f.from);let m=!1;if((!1===f.type||0===f.duration&&!f.repeatDelay)&&(i(f),0===f.delay&&(m=!0)),(_e.W.instantAnimations||_e.W.skipAnimations)&&(m=!0,i(f),f.delay=0),f.allowFlatten=!d.type&&!d.ease,m&&!c&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:n="loop"},r){const i=e.filter(et),a=t&&"loop"!==n&&t%2===1?0:i.length-1;return a&&void 0!==r?r:i[a]}(f.keyframes,d);if(void 0!==e)return void a.Gt.update(()=>{f.onUpdate(e),f.onComplete()})}return d.isSync?new Le(f):new Je(f)}},6061:function(e,t,n){"use strict";n.d(t,{u:function(){return i}});var r=n(3964);function i(e){return(0,r.S)(e)?e.get():e}},6087:function(e,t,n){"use strict";n.d(t,{y:function(){return o}});var r=n(5040),i=n(2879),a=n(8123);const o={test:e=>a.B.test(e)||r.u.test(e)||i.V.test(e),parse:e=>a.B.test(e)?a.B.parse(e):i.V.test(e)?i.V.parse(e):r.u.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?a.B.transform(e):i.V.transform(e),getAnimatableNone:e=>{const t=o.parse(e);return t.alpha=0,o.transform(t)}}},6116:function(e,t,n){"use strict";var r=n(4895),i=n(8624);const a=.95;async function o(e,t=null){return new Promise((n,r)=>{const i=new Image;i.crossOrigin="anonymous";const a=setTimeout(()=>{r(new Error("Image load timeout"))},3e4);i.onload=()=>{clearTimeout(a);const e=t?Math.min(1,t/i.width):1,r=Math.round(i.width*e),o=Math.round(i.height*e),s=document.createElement("canvas");s.width=r,s.height=o;const l=s.getContext("2d",{willReadFrequently:!0});l.drawImage(i,0,0,r,o),n({canvas:s,ctx:l,width:r,height:o,originalWidth:i.width,originalHeight:i.height,image:i})},i.onerror=t=>{clearTimeout(a),r(new Error(`Failed to load image: ${e}`))},i.src=e})}function s(e,t){const n=(t.rotation||0)+(t.orientation||0),r=t.cropRect||{x:0,y:0,w:1,h:1};if(0===n&&0===r.x&&0===r.y&&1===r.w&&1===r.h)return e;const i=n*Math.PI/180,a=Math.abs(Math.sin(i)),o=Math.abs(Math.cos(i)),s=e.width,l=e.height,c=s*o+l*a,u=s*a+l*o;let d=Math.round(r.x*c),h=Math.round(r.y*u),p=Math.max(1,Math.round(r.w*c)),f=Math.max(1,Math.round(r.h*u));d=Math.max(0,Math.min(d,Math.round(c)-1)),h=Math.max(0,Math.min(h,Math.round(u)-1)),p=Math.min(p,Math.round(c)-d),f=Math.min(f,Math.round(u)-h);const m=document.createElement("canvas");m.width=p,m.height=f;const g=m.getContext("2d");return g.save(),g.translate(-d,-h),g.translate(c/2,u/2),g.rotate(i),g.drawImage(e,-s/2,-l/2),g.restore(),m}function l(e,t){const n=e.getContext("2d",{willReadFrequently:!0}),i=n.getImageData(0,0,e.width,e.height),a=i.data,o=new r.RenderCore(t);o.prepareLUTs();const s=a.length;for(let r=0;r<s;r+=4){if(0===a[r+3])continue;const e=a[r]/255,t=a[r+1]/255,n=a[r+2]/255,[i,s,l]=o.processPixelFloat(e,t,n);a[r]=Math.min(255,Math.max(0,Math.round(255*i))),a[r+1]=Math.min(255,Math.max(0,Math.round(255*s))),a[r+2]=Math.min(255,Math.max(0,Math.round(255*l)))}return n.putImageData(i,0,0),e}async function c(e,t="jpeg",n=.95){return new Promise((r,i)=>{try{"jpeg"===t?e.toBlob(e=>{e?r({blob:e,contentType:"image/jpeg"}):i(new Error("Failed to create JPEG blob"))},"image/jpeg",n):"png"===t?e.toBlob(e=>{e?r({blob:e,contentType:"image/png"}):i(new Error("Failed to create PNG blob"))},"image/png"):"tiff16"===t?e.toBlob(e=>{e?r({blob:e,contentType:"image/png",warning:"TIFF16 not supported in CPU mode, using PNG as lossless alternative"}):i(new Error("Failed to create PNG blob (TIFF fallback)"))},"image/png"):i(new Error(`Unsupported format: ${t}`))}catch(a){i(a)}})}async function u({imageUrl:e,params:t,format:n="jpeg",maxWidth:r=null}){try{console.log("[CpuRenderService] Starting CPU render, format:",n);const i=performance.now(),a=0===r?0:r||4e3,{canvas:u,width:d,height:h}=await o(e,a);console.log(`[CpuRenderService] Image loaded: ${d}x${h}`),l(u,t);const p=s(u,t),f="jpeg"===n?1:void 0,{blob:m,contentType:g,warning:v}=await c(p,n,f),A=performance.now()-i;return console.log(`[CpuRenderService] CPU render completed in ${A.toFixed(0)}ms, size: ${(m.size/1024).toFixed(0)}KB`),{ok:!0,blob:m,contentType:g,source:"local-cpu",...v&&{warning:v}}}catch(i){return console.error("[CpuRenderService] CPU render failed:",i),{ok:!1,error:i.message||"CPU render failed",source:"local-cpu"}}}const d={localCpuPreview:async function({imageUrl:e,params:t,maxWidth:n=1400}){try{console.log("[CpuRenderService] Starting CPU preview render");const r=performance.now(),{canvas:i,width:u,height:d}=await o(e,n);console.log(`[CpuRenderService] Image loaded: ${u}x${d}`),l(i,t);const h=s(i,t),{blob:p}=await c(h,"jpeg",a),f=performance.now()-r;return console.log(`[CpuRenderService] CPU preview completed in ${f.toFixed(0)}ms`),{ok:!0,blob:p,source:"local-cpu"}}catch(r){return console.error("[CpuRenderService] CPU preview failed:",r),{ok:!1,error:r.message||"CPU preview failed",source:"local-cpu"}}},localCpuRender:u,localCpuExport:async function({photoId:e,imageUrl:t,params:n,format:r="jpeg"},i){try{console.log("[CpuRenderService] Starting CPU export, photoId:",e);const a=await u({imageUrl:t,params:n,format:r,maxWidth:0});if(!a.ok)return a;if(i){const t="tiff16"===r?"png":"jpeg"===r?"jpg":r,n=await i(a.blob,{photoId:e,filename:`filmlab_${e}_${Date.now()}.${t}`,type:"positive"});return n.ok?{ok:!0,photo:n.photo,filePath:n.filePath,source:"local-cpu-uploaded"}:{ok:!1,error:n.error||"Upload failed",blob:a.blob,source:"local-cpu-no-upload"}}return{ok:!0,blob:a.blob,contentType:a.contentType,source:"local-cpu"}}catch(a){return console.error("[CpuRenderService] CPU export failed:",a),{ok:!1,error:a.message||"CPU export failed",source:"local-cpu"}}},loadImageToCanvas:o,applyGeometry:s,processCanvasWithRenderCore:l,canvasToBlob:c,getPhotoImageUrl:async function(e,t="original"){try{const n=(0,i.Gi)(),r=await fetch(`${n}/api/photos/${e}`);if(r.ok){const e=await r.json();switch(t){case"positive":return e.positive_rel_path?`${n}/uploads/${e.positive_rel_path}`:null;case"negative":return e.negative_rel_path?`${n}/uploads/${e.negative_rel_path}`:e.original_rel_path?`${n}/uploads/${e.original_rel_path}`:e.full_rel_path?`${n}/uploads/${e.full_rel_path}`:null;default:return e.original_rel_path?`${n}/uploads/${e.original_rel_path}`:e.negative_rel_path?`${n}/uploads/${e.negative_rel_path}`:e.full_rel_path?`${n}/uploads/${e.full_rel_path}`:null}}}catch(n){console.error("[CpuRenderService] Failed to get photo info:",n)}return null},isCpuRenderAvailable:function(){if("undefined"===typeof document)return!1;try{const e=document.createElement("canvas");return!!e.getContext("2d")}catch{return!1}},PREVIEW_MAX_WIDTH:1400,EXPORT_MAX_WIDTH:4e3,JPEG_QUALITY:a,JPEG_HQ_QUALITY:1};t.Ay=d},6189:function(e,t,n){"use strict";n.d(t,{O:function(){return c}});var r=n(8689),i=n(2001);const a=(e,t)=>t&&"number"===typeof e?t.transform(e):e;var o=n(381);const s={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},l=r.U.length;function c(e,t,n){const{style:c,vars:u,transformOrigin:d}=e;let h=!1,p=!1;for(const s in t){const e=t[s];if(r.f.has(s))h=!0;else if((0,i.j)(s))u[s]=e;else{const t=a(e,o.W[s]);s.startsWith("origin")?(p=!0,d[s]=t):c[s]=t}}if(t.transform||(h||n?c.transform=function(e,t,n){let i="",c=!0;for(let u=0;u<l;u++){const l=r.U[u],d=e[l];if(void 0===d)continue;let h=!0;if(h="number"===typeof d?d===(l.startsWith("scale")?1:0):0===parseFloat(d),!h||n){const e=a(d,o.W[l]);h||(c=!1,i+=`${s[l]||l}(${e}) `),n&&(t[l]=e)}}return i=i.trim(),n?i=n(t,c?"":i):c&&(i="none"),i}(t,e.transform,n):c.transform&&(c.transform="none")),p){const{originX:e="50%",originY:t="50%",originZ:n=0}=d;c.transformOrigin=`${e} ${t} ${n}`}}},6264:function(e,t,n){"use strict";n.d(t,{a0:function(){return Le},tv:function(){return je}});var r=/\s+/g,i=(...e)=>{const t=[],n=e=>{if(!e&&0!==e&&0n!==e)return;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)n(e[t]);return}const r=typeof e;if("string"===r||"number"===r||"bigint"===r){if("number"===r&&e!==e)return;t.push(String(e))}else if("object"===r){const n=Object.keys(e);for(let r=0,i=n.length;r<i;r++){const i=n[r];e[i]&&t.push(i)}}};for(let r=0,a=e.length;r<a;r++){const t=e[r];null!==t&&void 0!==t&&n(t)}return t.length>0?"string"===typeof(i=t.join(" "))&&i?i.replace(r," ").trim():i:void 0;var i},a=e=>!1===e?"false":!0===e?"true":0===e?"0":e,o=e=>{if(!e||"object"!==typeof e)return!0;for(const t in e)return!1;return!0},s=(e,t)=>{for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?s(r,t):r&&t.push(r)}};var l=(...e)=>{const t=[];s(e,t);const n=[];for(let r=0;r<t.length;r++)t[r]&&n.push(t[r]);return n},c=(e,t)=>{const n={};for(const r in e){const i=e[r];if(r in t){const e=t[r];Array.isArray(i)||Array.isArray(e)?n[r]=l(e,i):n[r]="object"===typeof i&&"object"===typeof e&&i&&e?c(i,e):e+" "+i}else n[r]=i}for(const r in t)r in e||(n[r]=t[r]);return n},u={twMerge:!0,twMergeConfig:{}};var d=function(){let e=null,t={},n=!1;return{get cachedTwMerge(){return e},set cachedTwMerge(t){e=t},get cachedTwMergeConfig(){return t},set cachedTwMergeConfig(e){t=e},get didTwMergeConfigChange(){return n},set didTwMergeConfigChange(e){n=e},reset(){e=null,t={},n=!1}}}();const h=(e=new Map,t=null,n)=>({nextPart:e,validators:t,classGroupId:n}),p="-",f=[],m=e=>{const t=A(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{if(e.startsWith("[")&&e.endsWith("]"))return v(e);const n=e.split(p),r=""===n[0]&&n.length>1?1:0;return g(n,r,t)},getConflictingClassGroupIds:(e,t)=>{if(t){const t=r[e],i=n[e];return t?i?((e,t)=>{const n=new Array(e.length+t.length);for(let r=0;r<e.length;r++)n[r]=e[r];for(let r=0;r<t.length;r++)n[e.length+r]=t[r];return n})(i,t):t:i||f}return n[e]||f}}},g=(e,t,n)=>{if(0===e.length-t)return n.classGroupId;const r=e[t],i=n.nextPart.get(r);if(i){const n=g(e,t+1,i);if(n)return n}const a=n.validators;if(null===a)return;const o=0===t?e.join(p):e.slice(t).join(p),s=a.length;for(let l=0;l<s;l++){const e=a[l];if(e.validator(o))return e.classGroupId}},v=e=>-1===e.slice(1,-1).indexOf(":")?void 0:(()=>{const t=e.slice(1,-1),n=t.indexOf(":"),r=t.slice(0,n);return r?"arbitrary.."+r:void 0})(),A=e=>{const{theme:t,classGroups:n}=e;return y(n,t)},y=(e,t)=>{const n=h();for(const r in e){const i=e[r];b(i,n,r,t)}return n},b=(e,t,n,r)=>{const i=e.length;for(let a=0;a<i;a++){const i=e[a];x(i,t,n,r)}},x=(e,t,n,r)=>{"string"!==typeof e?"function"!==typeof e?S(e,t,n,r):w(e,t,n,r):_(e,t,n)},_=(e,t,n)=>{(""===e?t:T(t,e)).classGroupId=n},w=(e,t,n,r)=>{C(e)?b(e(r),t,n,r):(null===t.validators&&(t.validators=[]),t.validators.push(((e,t)=>({classGroupId:e,validator:t}))(n,e)))},S=(e,t,n,r)=>{const i=Object.entries(e),a=i.length;for(let o=0;o<a;o++){const[e,a]=i[o];b(a,T(t,e),n,r)}},T=(e,t)=>{let n=e;const r=t.split(p),i=r.length;for(let a=0;a<i;a++){const e=r[a];let t=n.nextPart.get(e);t||(t=h(),n.nextPart.set(e,t)),n=t}return n},C=e=>"isThemeGetter"in e&&!0===e.isThemeGetter,M=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=Object.create(null),r=Object.create(null);const i=(i,a)=>{n[i]=a,t++,t>e&&(t=0,r=n,n=Object.create(null))};return{get(e){let t=n[e];return void 0!==t?t:void 0!==(t=r[e])?(i(e,t),t):void 0},set(e,t){e in n?n[e]=t:i(e,t)}}},E=[],P=(e,t,n,r,i)=>({modifiers:e,hasImportantModifier:t,baseClassName:n,maybePostfixModifierPosition:r,isExternal:i}),N=e=>{const{prefix:t,experimentalParseClassName:n}=e;let r=e=>{const t=[];let n,r=0,i=0,a=0;const o=e.length;for(let u=0;u<o;u++){const o=e[u];if(0===r&&0===i){if(":"===o){t.push(e.slice(a,u)),a=u+1;continue}if("/"===o){n=u;continue}}"["===o?r++:"]"===o?r--:"("===o?i++:")"===o&&i--}const s=0===t.length?e:e.slice(a);let l=s,c=!1;s.endsWith("!")?(l=s.slice(0,-1),c=!0):s.startsWith("!")&&(l=s.slice(1),c=!0);return P(t,c,l,n&&n>a?n-a:void 0)};if(t){const e=t+":",n=r;r=t=>t.startsWith(e)?n(t.slice(e.length)):P(E,!1,t,void 0,!0)}if(n){const e=r;r=t=>n({className:t,parseClassName:e})}return r},k=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach((e,n)=>{t.set(e,1e6+n)}),e=>{const n=[];let r=[];for(let i=0;i<e.length;i++){const a=e[i],o="["===a[0],s=t.has(a);o||s?(r.length>0&&(r.sort(),n.push(...r),r=[]),n.push(a)):r.push(a)}return r.length>0&&(r.sort(),n.push(...r)),n}},R=/\s+/,L=e=>{if("string"===typeof e)return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=L(e[r]))&&(n&&(n+=" "),n+=t);return n},O=(e,...t)=>{let n,r,i,a;const o=e=>{const t=r(e);if(t)return t;const a=((e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:a}=t,o=[],s=e.trim().split(R);let l="";for(let c=s.length-1;c>=0;c-=1){const e=s[c],{isExternal:t,modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}=n(e);if(t){l=e+(l.length>0?" "+l:l);continue}let f=!!p,m=r(f?h.substring(0,p):h);if(!m){if(!f){l=e+(l.length>0?" "+l:l);continue}if(m=r(h),!m){l=e+(l.length>0?" "+l:l);continue}f=!1}const g=0===u.length?"":1===u.length?u[0]:a(u).join(":"),v=d?g+"!":g,A=v+m;if(o.indexOf(A)>-1)continue;o.push(A);const y=i(m,f);for(let n=0;n<y.length;++n){const e=y[n];o.push(v+e)}l=e+(l.length>0?" "+l:l)}return l})(e,n);return i(e,a),a};return a=s=>{const l=t.reduce((e,t)=>t(e),e());return n=(e=>({cache:M(e.cacheSize),parseClassName:N(e),sortModifiers:k(e),...m(e)}))(l),r=n.cache.get,i=n.cache.set,a=o,o(s)},(...e)=>a(((...e)=>{let t,n,r=0,i="";for(;r<e.length;)(t=e[r++])&&(n=L(t))&&(i&&(i+=" "),i+=n);return i})(...e))},j=[],D=e=>{const t=t=>t[e]||j;return t.isThemeGetter=!0,t},I=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,B=/^\((?:(\w[\w-]*):)?(.+)\)$/i,F=/^\d+\/\d+$/,z=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,U=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,V=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,G=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,q=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,W=e=>F.test(e),H=e=>!!e&&!Number.isNaN(Number(e)),$=e=>!!e&&Number.isInteger(Number(e)),K=e=>e.endsWith("%")&&H(e.slice(0,-1)),X=e=>z.test(e),Y=()=>!0,Q=e=>U.test(e)&&!V.test(e),Z=()=>!1,J=e=>G.test(e),ee=e=>q.test(e),te=e=>!re(e)&&!ce(e),ne=e=>ge(e,be,Z),re=e=>I.test(e),ie=e=>ge(e,xe,Q),ae=e=>ge(e,_e,H),oe=e=>ge(e,Ae,Z),se=e=>ge(e,ye,ee),le=e=>ge(e,Se,J),ce=e=>B.test(e),ue=e=>ve(e,xe),de=e=>ve(e,we),he=e=>ve(e,Ae),pe=e=>ve(e,be),fe=e=>ve(e,ye),me=e=>ve(e,Se,!0),ge=(e,t,n)=>{const r=I.exec(e);return!!r&&(r[1]?t(r[1]):n(r[2]))},ve=(e,t,n=!1)=>{const r=B.exec(e);return!!r&&(r[1]?t(r[1]):n)},Ae=e=>"position"===e||"percentage"===e,ye=e=>"image"===e||"url"===e,be=e=>"length"===e||"size"===e||"bg-size"===e,xe=e=>"length"===e,_e=e=>"number"===e,we=e=>"family-name"===e,Se=e=>"shadow"===e,Te=(Symbol.toStringTag,()=>{const e=D("color"),t=D("font"),n=D("text"),r=D("font-weight"),i=D("tracking"),a=D("leading"),o=D("breakpoint"),s=D("container"),l=D("spacing"),c=D("radius"),u=D("shadow"),d=D("inset-shadow"),h=D("text-shadow"),p=D("drop-shadow"),f=D("blur"),m=D("perspective"),g=D("aspect"),v=D("ease"),A=D("animate"),y=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",ce,re],b=()=>[ce,re,l],x=()=>[W,"full","auto",...b()],_=()=>[$,"none","subgrid",ce,re],w=()=>["auto",{span:["full",$,ce,re]},$,ce,re],S=()=>[$,"auto",ce,re],T=()=>["auto","min","max","fr",ce,re],C=()=>["auto",...b()],M=()=>[W,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...b()],E=()=>[e,ce,re],P=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",he,oe,{position:[ce,re]}],N=()=>["auto","cover","contain",pe,ne,{size:[ce,re]}],k=()=>[K,ue,ie],R=()=>["","none","full",c,ce,re],L=()=>["",H,ue,ie],O=()=>[H,K,he,oe],j=()=>["","none",f,ce,re],I=()=>["none",H,ce,re],B=()=>["none",H,ce,re],F=()=>[H,ce,re],z=()=>[W,"full",...b()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[X],breakpoint:[X],color:[Y],container:[X],"drop-shadow":[X],ease:["in","out","in-out"],font:[te],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[X],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[X],shadow:[X],spacing:["px",H],text:[X],"text-shadow":[X],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",W,re,ce,g]}],container:["container"],columns:[{columns:[H,re,ce,s]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:y()}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:x()}],"inset-x":[{"inset-x":x()}],"inset-y":[{"inset-y":x()}],start:[{start:x()}],end:[{end:x()}],top:[{top:x()}],right:[{right:x()}],bottom:[{bottom:x()}],left:[{left:x()}],visibility:["visible","invisible","collapse"],z:[{z:[$,"auto",ce,re]}],basis:[{basis:[W,"full","auto",s,...b()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[H,W,"auto","initial","none",re]}],grow:[{grow:["",H,ce,re]}],shrink:[{shrink:["",H,ce,re]}],order:[{order:[$,"first","last","none",ce,re]}],"grid-cols":[{"grid-cols":_()}],"col-start-end":[{col:w()}],"col-start":[{"col-start":S()}],"col-end":[{"col-end":S()}],"grid-rows":[{"grid-rows":_()}],"row-start-end":[{row:w()}],"row-start":[{"row-start":S()}],"row-end":[{"row-end":S()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":T()}],"auto-rows":[{"auto-rows":T()}],gap:[{gap:b()}],"gap-x":[{"gap-x":b()}],"gap-y":[{"gap-y":b()}],"justify-content":[{justify:["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe","normal"]}],"justify-items":[{"justify-items":["start","end","center","stretch","center-safe","end-safe","normal"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"align-items":[{items:["start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"align-self":[{self:["auto","start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"place-items":[{"place-items":["start","end","center","stretch","center-safe","end-safe","baseline"]}],"place-self":[{"place-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],p:[{p:b()}],px:[{px:b()}],py:[{py:b()}],ps:[{ps:b()}],pe:[{pe:b()}],pt:[{pt:b()}],pr:[{pr:b()}],pb:[{pb:b()}],pl:[{pl:b()}],m:[{m:C()}],mx:[{mx:C()}],my:[{my:C()}],ms:[{ms:C()}],me:[{me:C()}],mt:[{mt:C()}],mr:[{mr:C()}],mb:[{mb:C()}],ml:[{ml:C()}],"space-x":[{"space-x":b()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":b()}],"space-y-reverse":["space-y-reverse"],size:[{size:M()}],w:[{w:[s,"screen",...M()]}],"min-w":[{"min-w":[s,"screen","none",...M()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[o]},...M()]}],h:[{h:["screen","lh",...M()]}],"min-h":[{"min-h":["screen","lh","none",...M()]}],"max-h":[{"max-h":["screen","lh",...M()]}],"font-size":[{text:["base",n,ue,ie]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,ce,ae]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",K,re]}],"font-family":[{font:[de,re,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,ce,re]}],"line-clamp":[{"line-clamp":[H,"none",ce,ae]}],leading:[{leading:[a,...b()]}],"list-image":[{"list-image":["none",ce,re]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ce,re]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:E()}],"text-color":[{text:E()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","wavy"]}],"text-decoration-thickness":[{decoration:[H,"from-font","auto",ce,ie]}],"text-decoration-color":[{decoration:E()}],"underline-offset":[{"underline-offset":[H,"auto",ce,re]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:b()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ce,re]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ce,re]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:P()}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:N()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},$,ce,re],radial:["",ce,re],conic:[$,ce,re]},fe,se]}],"bg-color":[{bg:E()}],"gradient-from-pos":[{from:k()}],"gradient-via-pos":[{via:k()}],"gradient-to-pos":[{to:k()}],"gradient-from":[{from:E()}],"gradient-via":[{via:E()}],"gradient-to":[{to:E()}],rounded:[{rounded:R()}],"rounded-s":[{"rounded-s":R()}],"rounded-e":[{"rounded-e":R()}],"rounded-t":[{"rounded-t":R()}],"rounded-r":[{"rounded-r":R()}],"rounded-b":[{"rounded-b":R()}],"rounded-l":[{"rounded-l":R()}],"rounded-ss":[{"rounded-ss":R()}],"rounded-se":[{"rounded-se":R()}],"rounded-ee":[{"rounded-ee":R()}],"rounded-es":[{"rounded-es":R()}],"rounded-tl":[{"rounded-tl":R()}],"rounded-tr":[{"rounded-tr":R()}],"rounded-br":[{"rounded-br":R()}],"rounded-bl":[{"rounded-bl":R()}],"border-w":[{border:L()}],"border-w-x":[{"border-x":L()}],"border-w-y":[{"border-y":L()}],"border-w-s":[{"border-s":L()}],"border-w-e":[{"border-e":L()}],"border-w-t":[{"border-t":L()}],"border-w-r":[{"border-r":L()}],"border-w-b":[{"border-b":L()}],"border-w-l":[{"border-l":L()}],"divide-x":[{"divide-x":L()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":L()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:["solid","dashed","dotted","double","hidden","none"]}],"divide-style":[{divide:["solid","dashed","dotted","double","hidden","none"]}],"border-color":[{border:E()}],"border-color-x":[{"border-x":E()}],"border-color-y":[{"border-y":E()}],"border-color-s":[{"border-s":E()}],"border-color-e":[{"border-e":E()}],"border-color-t":[{"border-t":E()}],"border-color-r":[{"border-r":E()}],"border-color-b":[{"border-b":E()}],"border-color-l":[{"border-l":E()}],"divide-color":[{divide:E()}],"outline-style":[{outline:["solid","dashed","dotted","double","none","hidden"]}],"outline-offset":[{"outline-offset":[H,ce,re]}],"outline-w":[{outline:["",H,ue,ie]}],"outline-color":[{outline:E()}],shadow:[{shadow:["","none",u,me,le]}],"shadow-color":[{shadow:E()}],"inset-shadow":[{"inset-shadow":["none",d,me,le]}],"inset-shadow-color":[{"inset-shadow":E()}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:E()}],"ring-offset-w":[{"ring-offset":[H,ie]}],"ring-offset-color":[{"ring-offset":E()}],"inset-ring-w":[{"inset-ring":L()}],"inset-ring-color":[{"inset-ring":E()}],"text-shadow":[{"text-shadow":["none",h,me,le]}],"text-shadow-color":[{"text-shadow":E()}],opacity:[{opacity:[H,ce,re]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[H]}],"mask-image-linear-from-pos":[{"mask-linear-from":O()}],"mask-image-linear-to-pos":[{"mask-linear-to":O()}],"mask-image-linear-from-color":[{"mask-linear-from":E()}],"mask-image-linear-to-color":[{"mask-linear-to":E()}],"mask-image-t-from-pos":[{"mask-t-from":O()}],"mask-image-t-to-pos":[{"mask-t-to":O()}],"mask-image-t-from-color":[{"mask-t-from":E()}],"mask-image-t-to-color":[{"mask-t-to":E()}],"mask-image-r-from-pos":[{"mask-r-from":O()}],"mask-image-r-to-pos":[{"mask-r-to":O()}],"mask-image-r-from-color":[{"mask-r-from":E()}],"mask-image-r-to-color":[{"mask-r-to":E()}],"mask-image-b-from-pos":[{"mask-b-from":O()}],"mask-image-b-to-pos":[{"mask-b-to":O()}],"mask-image-b-from-color":[{"mask-b-from":E()}],"mask-image-b-to-color":[{"mask-b-to":E()}],"mask-image-l-from-pos":[{"mask-l-from":O()}],"mask-image-l-to-pos":[{"mask-l-to":O()}],"mask-image-l-from-color":[{"mask-l-from":E()}],"mask-image-l-to-color":[{"mask-l-to":E()}],"mask-image-x-from-pos":[{"mask-x-from":O()}],"mask-image-x-to-pos":[{"mask-x-to":O()}],"mask-image-x-from-color":[{"mask-x-from":E()}],"mask-image-x-to-color":[{"mask-x-to":E()}],"mask-image-y-from-pos":[{"mask-y-from":O()}],"mask-image-y-to-pos":[{"mask-y-to":O()}],"mask-image-y-from-color":[{"mask-y-from":E()}],"mask-image-y-to-color":[{"mask-y-to":E()}],"mask-image-radial":[{"mask-radial":[ce,re]}],"mask-image-radial-from-pos":[{"mask-radial-from":O()}],"mask-image-radial-to-pos":[{"mask-radial-to":O()}],"mask-image-radial-from-color":[{"mask-radial-from":E()}],"mask-image-radial-to-color":[{"mask-radial-to":E()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"]}],"mask-image-conic-pos":[{"mask-conic":[H]}],"mask-image-conic-from-pos":[{"mask-conic-from":O()}],"mask-image-conic-to-pos":[{"mask-conic-to":O()}],"mask-image-conic-from-color":[{"mask-conic-from":E()}],"mask-image-conic-to-color":[{"mask-conic-to":E()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:P()}],"mask-repeat":[{mask:["no-repeat",{repeat:["","x","y","space","round"]}]}],"mask-size":[{mask:N()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ce,re]}],filter:[{filter:["","none",ce,re]}],blur:[{blur:j()}],brightness:[{brightness:[H,ce,re]}],contrast:[{contrast:[H,ce,re]}],"drop-shadow":[{"drop-shadow":["","none",p,me,le]}],"drop-shadow-color":[{"drop-shadow":E()}],grayscale:[{grayscale:["",H,ce,re]}],"hue-rotate":[{"hue-rotate":[H,ce,re]}],invert:[{invert:["",H,ce,re]}],saturate:[{saturate:[H,ce,re]}],sepia:[{sepia:["",H,ce,re]}],"backdrop-filter":[{"backdrop-filter":["","none",ce,re]}],"backdrop-blur":[{"backdrop-blur":j()}],"backdrop-brightness":[{"backdrop-brightness":[H,ce,re]}],"backdrop-contrast":[{"backdrop-contrast":[H,ce,re]}],"backdrop-grayscale":[{"backdrop-grayscale":["",H,ce,re]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[H,ce,re]}],"backdrop-invert":[{"backdrop-invert":["",H,ce,re]}],"backdrop-opacity":[{"backdrop-opacity":[H,ce,re]}],"backdrop-saturate":[{"backdrop-saturate":[H,ce,re]}],"backdrop-sepia":[{"backdrop-sepia":["",H,ce,re]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":b()}],"border-spacing-x":[{"border-spacing-x":b()}],"border-spacing-y":[{"border-spacing-y":b()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ce,re]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[H,"initial",ce,re]}],ease:[{ease:["linear","initial",v,ce,re]}],delay:[{delay:[H,ce,re]}],animate:[{animate:["none",A,ce,re]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,ce,re]}],"perspective-origin":[{"perspective-origin":y()}],rotate:[{rotate:I()}],"rotate-x":[{"rotate-x":I()}],"rotate-y":[{"rotate-y":I()}],"rotate-z":[{"rotate-z":I()}],scale:[{scale:B()}],"scale-x":[{"scale-x":B()}],"scale-y":[{"scale-y":B()}],"scale-z":[{"scale-z":B()}],"scale-3d":["scale-3d"],skew:[{skew:F()}],"skew-x":[{"skew-x":F()}],"skew-y":[{"skew-y":F()}],transform:[{transform:[ce,re,"","none","gpu","cpu"]}],"transform-origin":[{origin:y()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:z()}],"translate-x":[{"translate-x":z()}],"translate-y":[{"translate-y":z()}],"translate-z":[{"translate-z":z()}],"translate-none":["translate-none"],accent:[{accent:E()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:E()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ce,re]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":b()}],"scroll-mx":[{"scroll-mx":b()}],"scroll-my":[{"scroll-my":b()}],"scroll-ms":[{"scroll-ms":b()}],"scroll-me":[{"scroll-me":b()}],"scroll-mt":[{"scroll-mt":b()}],"scroll-mr":[{"scroll-mr":b()}],"scroll-mb":[{"scroll-mb":b()}],"scroll-ml":[{"scroll-ml":b()}],"scroll-p":[{"scroll-p":b()}],"scroll-px":[{"scroll-px":b()}],"scroll-py":[{"scroll-py":b()}],"scroll-ps":[{"scroll-ps":b()}],"scroll-pe":[{"scroll-pe":b()}],"scroll-pt":[{"scroll-pt":b()}],"scroll-pr":[{"scroll-pr":b()}],"scroll-pb":[{"scroll-pb":b()}],"scroll-pl":[{"scroll-pl":b()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ce,re]}],fill:[{fill:["none",...E()]}],"stroke-w":[{stroke:[H,ue,ie,ae]}],stroke:[{stroke:["none",...E()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}}),Ce=(e,t,n)=>{void 0!==n&&(e[t]=n)},Me=(e,t)=>{if(t)for(const n in t)Ce(e,n,t[n])},Ee=(e,t)=>{if(t)for(const n in t)Pe(e,t,n)},Pe=(e,t,n)=>{const r=t[n];void 0!==r&&(e[n]=e[n]?e[n].concat(r):r)},Ne=(e,...t)=>"function"===typeof e?O(Te,e,...t):O(()=>((e,{cacheSize:t,prefix:n,experimentalParseClassName:r,extend:i={},override:a={}})=>(Ce(e,"cacheSize",t),Ce(e,"prefix",n),Ce(e,"experimentalParseClassName",r),Me(e.theme,a.theme),Me(e.classGroups,a.classGroups),Me(e.conflictingClassGroups,a.conflictingClassGroups),Me(e.conflictingClassGroupModifiers,a.conflictingClassGroupModifiers),Ce(e,"orderSensitiveModifiers",a.orderSensitiveModifiers),Ee(e.theme,i.theme),Ee(e.classGroups,i.classGroups),Ee(e.conflictingClassGroups,i.conflictingClassGroups),Ee(e.conflictingClassGroupModifiers,i.conflictingClassGroupModifiers),Pe(e,i,"orderSensitiveModifiers"),e))(Te(),e),...t),ke=O(Te);var Re=(e,t)=>{const n=i(e);return n&&(t?.twMerge??1)?(d.cachedTwMerge&&!d.didTwMergeConfigChange||(d.didTwMergeConfigChange=!1,d.cachedTwMerge=(r=d.cachedTwMergeConfig,o(r)?ke:Ne({...r,extend:{theme:r.theme,classGroups:r.classGroups,conflictingClassGroupModifiers:r.conflictingClassGroupModifiers,conflictingClassGroups:r.conflictingClassGroups,...r.extend}}))),d.cachedTwMerge(n)||void 0):n;var r},Le=(...e)=>t=>Re(e,t),{createTV:Oe,tv:je}=(e=>{const t=(t,n)=>{const{extend:r=null,slots:s={},variants:h={},compoundVariants:p=[],compoundSlots:f=[],defaultVariants:m={}}=t,g={...u,...n},v=r?.base?i(r.base,t?.base):t?.base,A=r?.variants&&!o(r.variants)?c(h,r.variants):h,y=r?.defaultVariants&&!o(r.defaultVariants)?{...r.defaultVariants,...m}:m;o(g.twMergeConfig)||((e,t)=>{if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const a=n[i];if(!r.includes(a))return!1;if(e[a]!==t[a])return!1}return!0})(g.twMergeConfig,d.cachedTwMergeConfig)||(d.didTwMergeConfigChange=!0,d.cachedTwMergeConfig=g.twMergeConfig);const b=o(r?.slots),x=o(s)?{}:{base:i(t?.base,b&&r?.base),...s},_=b?x:((e,t)=>{for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];e[n]=n in e?i(e[n],r):r}return e})({...r?.slots},o(x)?{base:t?.base}:x),w=o(r?.compoundVariants)?p:l(r?.compoundVariants,p),S=t=>{if(o(A)&&o(s)&&b)return e(v,t?.class,t?.className)(g);if(w&&!Array.isArray(w))throw new TypeError('The "compoundVariants" prop must be an array. Received: '+typeof w);if(f&&!Array.isArray(f))throw new TypeError('The "compoundSlots" prop must be an array. Received: '+typeof f);const n=(e,n=A,r=null,i=null)=>{const s=n[e];if(!s||o(s))return null;const l=i?.[e]??t?.[e];if(null===l)return null;const c=a(l);if("object"===typeof c)return null;const u=y?.[e];return s[(null!=c?c:a(u))||"false"]},r=(e,t)=>{if(!A||"object"!==typeof A)return null;const r=[];for(const i in A){const a=n(i,A,e,t),o="base"===e&&"string"===typeof a?a:a&&a[e];o&&r.push(o)}return r},i={};for(const e in t){const n=t[e];void 0!==n&&(i[e]=n)}const l=(e,n)=>{const r="object"===typeof t?.[e]?{[e]:t[e]?.initial}:{};return{...y,...i,...r,...n}},c=(e=[],t)=>{const n=[],r=e.length;for(let i=0;i<r;i++){const{class:r,className:a,...o}=e[i];let s=!0;const c=l(null,t);for(const e in o){const t=o[e],n=c[e];if(Array.isArray(t)){if(!t.includes(n)){s=!1;break}}else{if((null==t||!1===t)&&(null==n||!1===n))continue;if(n!==t){s=!1;break}}}s&&(r&&n.push(r),a&&n.push(a))}return n},u=t=>{const n=c(w,t);if(!Array.isArray(n))return n;const r={},i=e;for(let e=0;e<n.length;e++){const t=n[e];if("string"===typeof t)r.base=i(r.base,t)(g);else if("object"===typeof t)for(const e in t)r[e]=i(r[e],t[e])(g)}return r},d=e=>{if(f.length<1)return null;const t={},n=l(null,e);for(let r=0;r<f.length;r++){const{slots:e=[],class:i,className:a,...s}=f[r];if(!o(s)){let e=!0;for(const t in s){const r=n[t],i=s[t];if(void 0===r||(Array.isArray(i)?!i.includes(r):i!==r)){e=!1;break}}if(!e)continue}for(let n=0;n<e.length;n++){const r=e[n];t[r]||(t[r]=[]),t[r].push([i,a])}}return t};if(!o(s)||!b){const t={};if("object"===typeof _&&!o(_)){const n=e;for(const e in _)t[e]=t=>{const i=u(t),a=d(t);return n(_[e],r(e,t),i?i[e]:void 0,a?a[e]:void 0,t?.class,t?.className)(g)}}return t}return e(v,(()=>{if(!A)return null;const e=Object.keys(A),t=[];for(let r=0;r<e.length;r++){const i=n(e[r],A);i&&t.push(i)}return t})(),c(w),t?.class,t?.className)(g)};return S.variantKeys=(()=>{if(A&&"object"===typeof A)return Object.keys(A)})(),S.extend=r,S.base=v,S.slots=_,S.variants=A,S.defaultVariants=y,S.compoundSlots=f,S.compoundVariants=w,S};return{tv:t,createTV:e=>(n,r)=>t(n,r?c(e,r):e)}})(Le)},6268:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var r=n(2896),i=n(3964);function a(e,t){const n=e.getValue("willChange");if(a=n,Boolean((0,i.S)(a)&&a.add))return n.add(t);if(!n&&r.W.WillChange){const n=new r.W.WillChange("auto");e.addValue("willChange",n),n.add(t)}var a}},6280:function(e,t,n){"use strict";n.d(t,{Fh:function(){return o},VO:function(){return i},kn:function(){return r},p8:function(){return a}});var r=e=>{const t={top:{originY:1},bottom:{originY:0},left:{originX:1},right:{originX:0},"top-start":{originX:0,originY:1},"top-end":{originX:1,originY:1},"bottom-start":{originX:0,originY:0},"bottom-end":{originX:1,originY:0},"right-start":{originX:0,originY:0},"right-end":{originX:0,originY:1},"left-start":{originX:1,originY:0},"left-end":{originX:1,originY:1}};return(null==t?void 0:t[e])||{}},i=e=>({top:"top",bottom:"bottom",left:"left",right:"right","top-start":"top start","top-end":"top end","bottom-start":"bottom start","bottom-end":"bottom end","left-start":"left top","left-end":"left bottom","right-start":"right top","right-end":"right bottom"}[e]),a=(e,t)=>{if(t.includes("-")){const[n]=t.split("-");if(n.includes(e))return!1}return!0},o=(e,t)=>{if(t.includes("-")){const[,n]=t.split("-");return`${e}-${n}`}return e}},6296:function(e,t,n){"use strict";function r(e){if(!e)return;let t=!0;return n=>{let r={...n,preventDefault(){n.preventDefault()},isDefaultPrevented(){return n.isDefaultPrevented()},stopPropagation(){t=!0},continuePropagation(){t=!1},isPropagationStopped(){return t}};e(r),t&&n.stopPropagation()}}function i(e){return{keyboardProps:e.isDisabled?{}:{onKeyDown:r(e.onKeyDown),onKeyUp:r(e.onKeyUp)}}}n.d(t,{d:function(){return i}})},6317:function(e,t,n){"use strict";n.d(t,{v:function(){return i}});var r=n(9755);class i{constructor(){this.subscriptions=[]}add(e){return(0,r.Kq)(this.subscriptions,e),()=>(0,r.Ai)(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){const r=this.subscriptions[i];r&&r(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}},6321:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(5990);t.isArguments=function(e){return null!==e&&"object"===typeof e&&"[object Arguments]"===r.getTag(e)}},6358:function(e,t,n){"use strict";n.d(t,{L:function(){return o},m:function(){return a}});var r=n(6772),i=n(7664);function a(e,t){return(0,r.FY)((0,r.bS)(e.getBoundingClientRect(),t))}function o(e,t,n){const r=a(e,n),{scroll:o}=t;return o&&((0,i.Ql)(r.x,o.offset.x),(0,i.Ql)(r.y,o.offset.y)),r}},6392:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.last=function(e){return e[e.length-1]}},6433:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6443),i=n(5990),a=n(7599),o=n(4803),s=n(3757);function l(e,t,n,r=new Map,u=void 0){const d=u?.(e,t,n,r);if(void 0!==d)return d;if(o.isPrimitive(e))return e;if(r.has(e))return r.get(e);if(Array.isArray(e)){const t=new Array(e.length);r.set(e,t);for(let i=0;i<e.length;i++)t[i]=l(e[i],i,n,r,u);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){const t=new Map;r.set(e,t);for(const[i,a]of e)t.set(i,l(a,i,n,r,u));return t}if(e instanceof Set){const t=new Set;r.set(e,t);for(const i of e)t.add(l(i,void 0,n,r,u));return t}if("undefined"!==typeof Buffer&&Buffer.isBuffer(e))return e.subarray();if(s.isTypedArray(e)){const t=new(Object.getPrototypeOf(e).constructor)(e.length);r.set(e,t);for(let i=0;i<e.length;i++)t[i]=l(e[i],i,n,r,u);return t}if(e instanceof ArrayBuffer||"undefined"!==typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,t),c(t,e,n,r,u),t}if("undefined"!==typeof File&&e instanceof File){const t=new File([e],e.name,{type:e.type});return r.set(e,t),c(t,e,n,r,u),t}if("undefined"!==typeof Blob&&e instanceof Blob){const t=new Blob([e],{type:e.type});return r.set(e,t),c(t,e,n,r,u),t}if(e instanceof Error){const t=new e.constructor;return r.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,c(t,e,n,r,u),t}if(e instanceof Boolean){const t=new Boolean(e.valueOf());return r.set(e,t),c(t,e,n,r,u),t}if(e instanceof Number){const t=new Number(e.valueOf());return r.set(e,t),c(t,e,n,r,u),t}if(e instanceof String){const t=new String(e.valueOf());return r.set(e,t),c(t,e,n,r,u),t}if("object"===typeof e&&function(e){switch(i.getTag(e)){case a.argumentsTag:case a.arrayTag:case a.arrayBufferTag:case a.dataViewTag:case a.booleanTag:case a.dateTag:case a.float32ArrayTag:case a.float64ArrayTag:case a.int8ArrayTag:case a.int16ArrayTag:case a.int32ArrayTag:case a.mapTag:case a.numberTag:case a.objectTag:case a.regexpTag:case a.setTag:case a.stringTag:case a.symbolTag:case a.uint8ArrayTag:case a.uint8ClampedArrayTag:case a.uint16ArrayTag:case a.uint32ArrayTag:return!0;default:return!1}}(e)){const t=Object.create(Object.getPrototypeOf(e));return r.set(e,t),c(t,e,n,r,u),t}return e}function c(e,t,n=e,i,a){const o=[...Object.keys(t),...r.getSymbols(t)];for(let r=0;r<o.length;r++){const s=o[r],c=Object.getOwnPropertyDescriptor(e,s);(null==c||c.writable)&&(e[s]=l(t[s],s,n,i,a))}}t.cloneDeepWith=function(e,t){return l(e,void 0,e,new Map,t)},t.cloneDeepWithImpl=l,t.copyProperties=c},6443:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.getSymbols=function(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}},6452:function(e,t,n){"use strict";n.d(t,{P:function(){return u}});var r=n(7508),i=n(1468),a=n(8493),o=n(5043);function s(e,t){if(e.button>0)return!1;if(e.target){const t=e.target.ownerDocument;if(!t||!t.documentElement.contains(e.target))return!1;if(e.target.closest("[data-react-aria-top-layer]"))return!1}return!!t.current&&!e.composedPath().includes(t.current)}var l=n(2598),c=[];function u(e,t){const{disableOutsideEvents:n=!0,isDismissable:u=!1,isKeyboardDismissDisabled:d=!1,isOpen:h,onClose:p,shouldCloseOnBlur:f,shouldCloseOnInteractOutside:m}=e;(0,o.useEffect)(()=>{if(h&&!c.includes(t))return c.push(t),()=>{let e=c.indexOf(t);e>=0&&c.splice(e,1)}},[h,t]);const g=()=>{c[c.length-1]===t&&p&&p()};!function(e){let{ref:t,onInteractOutside:n,isDisabled:r,onInteractOutsideStart:l}=e,c=(0,o.useRef)({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),u=(0,i.J)(e=>{n&&s(e,t)&&(l&&l(e),c.current.isPointerDown=!0)}),d=(0,i.J)(e=>{n&&n(e)});(0,o.useEffect)(()=>{let e=c.current;if(r)return;const n=t.current,i=(0,a.TW)(n);if("undefined"!==typeof PointerEvent){let n=n=>{e.isPointerDown&&s(n,t)&&d(n),e.isPointerDown=!1};return i.addEventListener("pointerdown",u,!0),i.addEventListener("click",n,!0),()=>{i.removeEventListener("pointerdown",u,!0),i.removeEventListener("click",n,!0)}}},[t,r])}({isDisabled:!(u&&h),onInteractOutside:u&&h?e=>{m&&!m(e.target)||(c[c.length-1]===t&&n&&(e.stopPropagation(),e.preventDefault()),g())}:void 0,onInteractOutsideStart:e=>{m&&!m(e.target)||(c[c.length-1]===t&&n&&(e.stopPropagation(),e.preventDefault()),"pressEnd"!==function(e){const t=e.current;if(!t)return"unknown";const n=(t.getAttribute("role")||"").toLowerCase(),r=t.getAttribute("aria-modal");if(("dialog"===n||"alertdialog"===n)&&(null===r||"true"===r.toLowerCase()))return"pressEnd";if(["listbox","menu","tree","grid","combobox"].includes(n))return"pressStart";return"unknown"}(t)&&g())},ref:t});const{focusWithinProps:v}=(0,l.R)({isDisabled:!f,onBlurWithin:e=>{e.relatedTarget&&!(0,r.Pu)(e.relatedTarget)&&(m&&!m(e.relatedTarget)||g())}});return{overlayProps:{onKeyDown:e=>{"Escape"!==e.key||d||e.nativeEvent.isComposing||(e.stopPropagation(),e.preventDefault(),g())},...v},underlayProps:{onPointerDown:e=>{e.target===e.currentTarget&&e.preventDefault()}}}}},6485:function(e,t,n){"use strict";n.d(t,{P:function(){return i}});var r=n(971);function i(e){return e.props[r.n]}},6532:function(e,t,n){"use strict";const{RenderCore:r,DEFAULT_FILM_CURVE:i,DEFAULT_CROP_RECT:a}=n(4597);e.exports={RenderCore:r,DEFAULT_FILM_CURVE:i,DEFAULT_CROP_RECT:a}},6601:function(e,t,n){"use strict";n.d(t,{lN:function(){return l},pr:function(){return s}});const r="https://photon.komoot.io",i="https://nominatim.openstreetmap.org";let a=0;const o=async()=>{const e=Date.now()-a;e<1100&&await new Promise(t=>setTimeout(t,1100-e)),a=Date.now()},s=async(e,t={})=>{if(!e||e.trim().length<2)return[];const n=t.limit||5;try{const t=await(async(e,t=5)=>{const n=new URLSearchParams({q:e.trim(),limit:String(t)}),i=await fetch(`${r}/api?${n.toString()}`,{headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`Photon geocoding failed: ${i.status}`);return((await i.json()).features||[]).map(e=>{var t;const n=e.properties||{},r=(null===(t=e.geometry)||void 0===t?void 0:t.coordinates)||[0,0];return{displayName:n.name+(n.city?`, ${n.city}`:"")+(n.country?`, ${n.country}`:""),latitude:r[1],longitude:r[0],country:n.country||"",city:n.city||n.locality||n.district||"",state:n.state||"",road:n.street||"",houseNumber:n.housenumber||""}})})(e,n);if(t.length>0)return t}catch(a){console.warn("Photon geocoding failed, falling back to Nominatim:",a.message)}try{return await(async(e,t=5,n=null)=>{await o();const r=new URLSearchParams({q:e.trim(),format:"json",addressdetails:"1",limit:String(t)});n&&r.append("countrycodes",n.toLowerCase());const a=await fetch(`${i}/search?${r.toString()}`,{headers:{Accept:"application/json","User-Agent":"FilmGallery/1.0"}});if(!a.ok)throw new Error(`Nominatim geocoding failed: ${a.status}`);return(await a.json()).map(e=>{var t,n,r,i,a,o,s,l;return{displayName:e.display_name,latitude:parseFloat(e.lat),longitude:parseFloat(e.lon),country:(null===(t=e.address)||void 0===t?void 0:t.country)||"",city:(null===(n=e.address)||void 0===n?void 0:n.city)||(null===(r=e.address)||void 0===r?void 0:r.town)||(null===(i=e.address)||void 0===i?void 0:i.village)||(null===(a=e.address)||void 0===a?void 0:a.municipality)||"",state:(null===(o=e.address)||void 0===o?void 0:o.state)||"",road:(null===(s=e.address)||void 0===s?void 0:s.road)||"",houseNumber:(null===(l=e.address)||void 0===l?void 0:l.house_number)||""}})})(e,n,t.country)}catch(a){return console.error("All geocoding services failed:",a),[]}},l=async(e,t)=>{if(!e&&!t)return null;const n=t?`${t}, ${e}`:e,r=await s(n,{limit:1});return r.length>0?{latitude:r[0].latitude,longitude:r[0].longitude}:null}},6639:function(e,t,n){"use strict";n.d(t,{w:function(){return o}});var r="250ms",i={".leading-inherit":{"line-height":"inherit"},".bg-img-inherit":{"background-image":"inherit"},".bg-clip-inherit":{"background-clip":"inherit"},".text-fill-inherit":{"-webkit-text-fill-color":"inherit"},".tap-highlight-transparent":{"-webkit-tap-highlight-color":"transparent"},".input-search-cancel-button-none":{"&::-webkit-search-cancel-button":{"-webkit-appearance":"none"}},...{".transition-background":{"transition-property":"background","transition-timing-function":"ease","transition-duration":r},".transition-colors-opacity":{"transition-property":"color, background-color, border-color, text-decoration-color, fill, stroke, opacity","transition-timing-function":"ease","transition-duration":r},".transition-width":{"transition-property":"width","transition-timing-function":"ease","transition-duration":r},".transition-height":{"transition-property":"height","transition-timing-function":"ease","transition-duration":r},".transition-size":{"transition-property":"width, height","transition-timing-function":"ease","transition-duration":r},".transition-left":{"transition-property":"left","transition-timing-function":"ease","transition-duration":r},".transition-transform-opacity":{"transition-property":"transform, scale, opacity rotate","transition-timing-function":"ease","transition-duration":r},".transition-transform-background":{"transition-property":"transform, scale, background","transition-timing-function":"ease","transition-duration":r},".transition-transform-colors":{"transition-property":"transform, scale, color, background, background-color, border-color, text-decoration-color, fill, stroke","transition-timing-function":"ease","transition-duration":r},".transition-transform-colors-opacity":{"transition-property":"transform, scale, color, background, background-color, border-color, text-decoration-color, fill, stroke, opacity","transition-timing-function":"ease","transition-duration":r}},".scrollbar-hide":{"-ms-overflow-style":"none","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}},".scrollbar-default":{"-ms-overflow-style":"auto","scrollbar-width":"auto","&::-webkit-scrollbar":{display:"block"}},".text-tiny":{"font-size":"var(--heroui-font-size-tiny)","line-height":"var(--heroui-line-height-tiny)"},".text-small":{"font-size":"var(--heroui-font-size-small)","line-height":"var(--heroui-line-height-small)"},".text-medium":{"font-size":"var(--heroui-font-size-medium)","line-height":"var(--heroui-line-height-medium)"},".text-large":{"font-size":"var(--heroui-font-size-large)","line-height":"var(--heroui-line-height-large)"},".spinner-bar-animation":{animation:"fade-out 1.2s linear infinite","animation-delay":"calc(-1.2s + (0.1s * var(--bar-index)))",transform:"rotate(calc(30deg * var(--bar-index))) translate(140%)"},".spinner-dot-animation":{"animation-delay":"calc(250ms * var(--dot-index))"},".spinner-dot-blink-animation":{"animation-delay":"calc(200ms * var(--dot-index))"}},a=["small","medium","large"],o={theme:{spacing:["divider"],radius:a},classGroups:{shadow:[{shadow:a}],opacity:[{opacity:["disabled"]}],"font-size":[{text:["tiny",...a]}],"border-w":[{border:a}],"bg-image":["bg-stripe-gradient-default","bg-stripe-gradient-primary","bg-stripe-gradient-secondary","bg-stripe-gradient-success","bg-stripe-gradient-warning","bg-stripe-gradient-danger"],transition:Object.keys(i).filter(e=>e.includes(".transition")).map(e=>e.replace(".",""))}}},6642:function(e,t,n){"use strict";n.d(t,{C:function(){return a},p:function(){return i}});var r=n(151),[i,a]=(0,r.q)({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"})},6650:function(e,t,n){"use strict";n.d(t,{N:function(){return i}});var r=n(5043);const i="undefined"!==typeof document?r.useLayoutEffect:()=>{}},6764:function(e,t,n){"use strict";n.d(t,{o:function(){return d}});var r=n(2795),i=(0,n(9265).tv)({slots:{base:"relative inline-flex flex-col gap-2 items-center justify-center",wrapper:"relative flex",label:"text-foreground dark:text-foreground-dark font-regular",circle1:"absolute w-full h-full rounded-full",circle2:"absolute w-full h-full rounded-full",dots:"relative rounded-full mx-auto",spinnerBars:["absolute","rounded-full","w-[25%]","h-[8%]","left-[calc(37.5%)]","top-[calc(46%)]","spinner-bar-animation"]},variants:{size:{sm:{wrapper:"w-5 h-5",circle1:"border-2",circle2:"border-2",dots:"size-1",label:"text-small"},md:{wrapper:"w-8 h-8",circle1:"border-3",circle2:"border-3",dots:"size-1.5",label:"text-medium"},lg:{wrapper:"w-10 h-10",circle1:"border-3",circle2:"border-3",dots:"size-2",label:"text-large"}},color:{current:{circle1:"border-b-current",circle2:"border-b-current",dots:"bg-current",spinnerBars:"bg-current"},white:{circle1:"border-b-white",circle2:"border-b-white",dots:"bg-white",spinnerBars:"bg-white"},default:{circle1:"border-b-default",circle2:"border-b-default",dots:"bg-default",spinnerBars:"bg-default"},primary:{circle1:"border-b-primary",circle2:"border-b-primary",dots:"bg-primary",spinnerBars:"bg-primary"},secondary:{circle1:"border-b-secondary",circle2:"border-b-secondary",dots:"bg-secondary",spinnerBars:"bg-secondary"},success:{circle1:"border-b-success",circle2:"border-b-success",dots:"bg-success",spinnerBars:"bg-success"},warning:{circle1:"border-b-warning",circle2:"border-b-warning",dots:"bg-warning",spinnerBars:"bg-warning"},danger:{circle1:"border-b-danger",circle2:"border-b-danger",dots:"bg-danger",spinnerBars:"bg-danger"}},labelColor:{foreground:{label:"text-foreground"},primary:{label:"text-primary"},secondary:{label:"text-secondary"},success:{label:"text-success"},warning:{label:"text-warning"},danger:{label:"text-danger"}},variant:{default:{circle1:["animate-spinner-ease-spin","border-solid","border-t-transparent","border-l-transparent","border-r-transparent"],circle2:["opacity-75","animate-spinner-linear-spin","border-dotted","border-t-transparent","border-l-transparent","border-r-transparent"]},gradient:{circle1:["border-0","bg-gradient-to-b","from-transparent","via-transparent","to-primary","animate-spinner-linear-spin","[animation-duration:1s]","[-webkit-mask:radial-gradient(closest-side,rgba(0,0,0,0.0)calc(100%-3px),rgba(0,0,0,1)calc(100%-3px))]"],circle2:["hidden"]},wave:{wrapper:"translate-y-3/4",dots:["animate-sway","spinner-dot-animation"]},dots:{wrapper:"translate-y-2/4",dots:["animate-blink","spinner-dot-blink-animation"]},spinner:{},simple:{wrapper:"text-foreground h-5 w-5 animate-spin",circle1:"opacity-25",circle2:"opacity-75"}}},defaultVariants:{size:"md",color:"primary",labelColor:"foreground",variant:"default"},compoundVariants:[{variant:"gradient",color:"current",class:{circle1:"to-current"}},{variant:"gradient",color:"white",class:{circle1:"to-white"}},{variant:"gradient",color:"default",class:{circle1:"to-default"}},{variant:"gradient",color:"primary",class:{circle1:"to-primary"}},{variant:"gradient",color:"secondary",class:{circle1:"to-secondary"}},{variant:"gradient",color:"success",class:{circle1:"to-success"}},{variant:"gradient",color:"warning",class:{circle1:"to-warning"}},{variant:"gradient",color:"danger",class:{circle1:"to-danger"}},{variant:"wave",size:"sm",class:{wrapper:"w-5 h-5"}},{variant:"wave",size:"md",class:{wrapper:"w-8 h-8"}},{variant:"wave",size:"lg",class:{wrapper:"w-12 h-12"}},{variant:"dots",size:"sm",class:{wrapper:"w-5 h-5"}},{variant:"dots",size:"md",class:{wrapper:"w-8 h-8"}},{variant:"dots",size:"lg",class:{wrapper:"w-12 h-12"}},{variant:"simple",size:"sm",class:{wrapper:"w-5 h-5"}},{variant:"simple",size:"md",class:{wrapper:"w-8 h-8"}},{variant:"simple",size:"lg",class:{wrapper:"w-12 h-12"}},{variant:"simple",color:"current",class:{wrapper:"text-current"}},{variant:"simple",color:"white",class:{wrapper:"text-white"}},{variant:"simple",color:"default",class:{wrapper:"text-default"}},{variant:"simple",color:"primary",class:{wrapper:"text-primary"}},{variant:"simple",color:"secondary",class:{wrapper:"text-secondary"}},{variant:"simple",color:"success",class:{wrapper:"text-success"}},{variant:"simple",color:"warning",class:{wrapper:"text-warning"}},{variant:"simple",color:"danger",class:{wrapper:"text-danger"}}]}),a=n(2927),o=n(3779),s=n(5043),l=n(4906);var c=n(579),u=(0,r.Rf)((e,t)=>{const{slots:n,classNames:u,label:d,variant:h,getSpinnerProps:p}=function(e){var t,n;const[c,u]=(0,r.rE)(e,i.variantKeys),d=(0,l.o)(),h=null!=(n=null!=(t=null==e?void 0:e.variant)?t:null==d?void 0:d.spinnerVariant)?n:"default",{children:p,className:f,classNames:m,label:g,...v}=c,A=(0,s.useMemo)(()=>i({...u,variant:h}),[(0,o.t6)(u),h]),y=(0,a.cn)(null==m?void 0:m.base,f),b=g||p,x=(0,s.useMemo)(()=>b&&"string"===typeof b?b:v["aria-label"]?"":"Loading",[p,b,v["aria-label"]]),_=(0,s.useCallback)(()=>({"aria-label":x,className:A.base({class:y}),...v}),[x,A,y,v]);return{label:b,slots:A,classNames:m,variant:h,getSpinnerProps:_}}({...e});return"wave"===h||"dots"===h?(0,c.jsxs)("div",{ref:t,...p(),children:[(0,c.jsx)("div",{className:n.wrapper({class:null==u?void 0:u.wrapper}),children:[...new Array(3)].map((e,t)=>(0,c.jsx)("i",{className:n.dots({class:null==u?void 0:u.dots}),style:{"--dot-index":t}},`dot-${t}`))}),d&&(0,c.jsx)("span",{className:n.label({class:null==u?void 0:u.label}),children:d})]}):"simple"===h?(0,c.jsxs)("div",{ref:t,...p(),children:[(0,c.jsxs)("svg",{className:n.wrapper({class:null==u?void 0:u.wrapper}),fill:"none",viewBox:"0 0 24 24",children:[(0,c.jsx)("circle",{className:n.circle1({class:null==u?void 0:u.circle1}),cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,c.jsx)("path",{className:n.circle2({class:null==u?void 0:u.circle2}),d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})]}),d&&(0,c.jsx)("span",{className:n.label({class:null==u?void 0:u.label}),children:d})]}):"spinner"===h?(0,c.jsxs)("div",{ref:t,...p(),children:[(0,c.jsx)("div",{className:n.wrapper({class:null==u?void 0:u.wrapper}),children:[...new Array(12)].map((e,t)=>(0,c.jsx)("i",{className:n.spinnerBars({class:null==u?void 0:u.spinnerBars}),style:{"--bar-index":t}},`star-${t}`))}),d&&(0,c.jsx)("span",{className:n.label({class:null==u?void 0:u.label}),children:d})]}):(0,c.jsxs)("div",{ref:t,...p(),children:[(0,c.jsxs)("div",{className:n.wrapper({class:null==u?void 0:u.wrapper}),children:[(0,c.jsx)("i",{className:n.circle1({class:null==u?void 0:u.circle1})}),(0,c.jsx)("i",{className:n.circle2({class:null==u?void 0:u.circle2})})]}),d&&(0,c.jsx)("span",{className:n.label({class:null==u?void 0:u.label}),children:d})]})});u.displayName="HeroUI.Spinner";var d=u},6770:function(e,t,n){"use strict";n.d(t,{y:function(){return d}});var r=n(6642),i=n(2425),a=n(5043),o=n(2795),s=n(1595),l=n(9570),c=n(579),u=(0,o.Rf)((e,t)=>{const{children:n,...o}=e,u=(0,i.f)({...o,ref:t}),[d,h]=a.Children.toArray(n),p=(0,c.jsx)(s.hJ,{portalContainer:u.portalContainer,children:h});return(0,c.jsxs)(r.p,{value:u,children:[d,u.disableAnimation&&u.isOpen?p:(0,c.jsx)(l.N,{children:u.isOpen?p:null})]})});u.displayName="HeroUI.Popover";var d=u},6772:function(e,t,n){"use strict";function r({top:e,left:t,right:n,bottom:r}){return{x:{min:t,max:n},y:{min:e,max:r}}}function i({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function a(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}n.d(t,{FY:function(){return r},bS:function(){return a},pA:function(){return i}})},6808:function(e,t,n){"use strict";n.d(t,{s:function(){return l}});var r=n(1389),i=n(54),a=n(4338),o=n(5043),s=n(1595);function l(e,t){let{role:n="dialog"}=e,l=(0,r.X1)();l=e["aria-label"]?void 0:l;let c=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(t.current&&!t.current.contains(document.activeElement)){(0,a.l)(t.current);let e=setTimeout(()=>{document.activeElement!==t.current&&document.activeElement!==document.body||(c.current=!0,t.current&&(t.current.blur(),(0,a.l)(t.current)),c.current=!1)},500);return()=>{clearTimeout(e)}}},[t]),(0,s.Se)(),{dialogProps:{...(0,i.$)(e,{labelable:!0}),role:n,tabIndex:-1,"aria-labelledby":e["aria-labelledby"]||l,onBlur:e=>{c.current&&e.stopPropagation()}},titleProps:{id:l}}}},6838:function(e,t,n){"use strict";n.d(t,{mK:function(){return i},zD:function(){return a}});var r=n(5043);"undefined"===typeof window||!window.document||window.document.createElement;function i(e){return{UNSAFE_getDOMNode(){return e.current}}}function a(e){const t=(0,r.useRef)(null);return(0,r.useImperativeHandle)(e,()=>t.current),t}},6841:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});const r=(0,n(5043).createContext)({strict:!1})},6898:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var r=n(5043),i=n(6601),a=n(579);function o({value:e,onChange:t,onSelect:n,placeholder:o="Search address...",className:s="",style:l={},disabled:c=!1}){const[u,d]=(0,r.useState)(!1),[h,p]=(0,r.useState)([]),[f,m]=(0,r.useState)(!1),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const v=async()=>{const t=(e||"").trim();if(t&&!(t.length<2)){d(!0),m(!0);try{const e=await(0,i.pr)(t,{limit:5});p(e)}catch(n){console.error("Geo search failed:",n),p([])}finally{d(!1)}}};return(0,a.jsxs)("div",{ref:g,style:{position:"relative",...l},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,a.jsx)("input",{type:"text",className:`fg-input ${s}`,value:e,onChange:e=>t&&t(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),v()):"Escape"===e.key&&m(!1)},onFocus:()=>h.length>0&&m(!0),placeholder:o,disabled:c,style:{flex:1}}),(0,a.jsx)("button",{type:"button",className:"fg-btn fg-btn-secondary",onClick:v,disabled:c||u||!(e||"").trim(),title:"Search GPS coordinates",style:{padding:"0 10px",minWidth:38,opacity:c||u||!(e||"").trim()?.5:1,cursor:c||u||!(e||"").trim()?"not-allowed":"pointer"},children:u?"\u23f3":"\ud83d\udd0d"})]}),f&&h.length>0&&(0,a.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"#fff",borderRadius:8,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:100,maxHeight:200,overflowY:"auto",marginTop:4},children:h.map((e,t)=>(0,a.jsxs)("div",{onClick:()=>(e=>{const t=[e.road,e.houseNumber].filter(Boolean),r=t.length>0?t.join(" "):"";n&&n({latitude:e.latitude,longitude:e.longitude,country:e.country,city:e.city,displayName:e.displayName,detail:r||e.displayName}),m(!1),p([])})(e),style:{padding:"10px 12px",cursor:"pointer",borderBottom:t<h.length-1?"1px solid #e5e7eb":"none",fontSize:13,color:"#1f2937"},onMouseEnter:e=>e.currentTarget.style.background="#f3f4f6",onMouseLeave:e=>e.currentTarget.style.background="#fff",children:[(0,a.jsxs)("div",{style:{fontWeight:500},children:[e.city||e.state||"Unknown",e.country?`, ${e.country}`:""]}),(0,a.jsx)("div",{style:{fontSize:11,color:"#6b7280",marginTop:2,lineHeight:1.3},children:e.displayName.length>80?e.displayName.substring(0,80)+"...":e.displayName}),(0,a.jsxs)("div",{style:{fontSize:10,color:"#9ca3af",marginTop:2},children:["\ud83d\udccd ",e.latitude.toFixed(6),", ",e.longitude.toFixed(6)]})]},t))}),f&&0===h.length&&!u&&(0,a.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"#fff",borderRadius:8,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:100,marginTop:4,padding:"12px 14px",fontSize:13,color:"#6b7280",textAlign:"center"},children:"No results found. Try a different search term."})]})}},6935:function(e,t,n){const{FILM_PROFILES:r}=n(5121);function i(e,t,n){return Math.max(t,Math.min(n,e))}function a(e){const t=Math.max(0,Math.min(1,e));return t*t*(3-2*t)}function o(e,t={}){const{gamma:n=.6,dMin:r=.1,dMax:a=3,toe:o=0,shoulder:l=0}=t,c=i(e/255,.001,1),u=i((-Math.log10(c)-r)/(a-r),0,1);let d;d=o<=0&&l<=0?Math.pow(u,n):s(u,n,o,l);const h=r+d*(a-r),p=Math.pow(10,-h);return i(Math.round(255*p),0,255)}function s(e,t,n,r){const i=.25*n,o=1-.25*r,s=1.5*t,l=.6*t,c=.08;if(e<i)return Math.pow(e,s);if(e<i+c&&i>0){const n=a((e-i)/c);return Math.pow(e,s)*(1-n)+Math.pow(e,t)*n}if(e>o)return Math.pow(e,l);if(e>o-c&&r>0){const n=a((e-(o-c))/c);return Math.pow(e,t)*(1-n)+Math.pow(e,l)*n}return Math.pow(e,t)}e.exports={applyFilmCurve:o,applyFilmCurveFloat:function(e,t={}){const{gamma:n=.6,dMin:r=.1,dMax:a=3,toe:o=0,shoulder:l=0}=t,c=i(e,.001,1),u=i((-Math.log10(c)-r)/(a-r),0,1);let d;d=o<=0&&l<=0?Math.pow(u,n):s(u,n,o,l);const h=r+d*(a-r);return i(Math.pow(10,-h),0,1)},applyFilmCurveRGB:function(e,t,n,r={}){return[o(e,r),o(t,r),o(n,r)]},buildFilmCurveLUT:function(e={}){const t=new Uint8Array(256);for(let n=0;n<256;n++)t[n]=o(n,e);return t},getBuiltinFilmProfile:function(e){return r[e]||r.default},mergeFilmProfiles:function(e=[]){const t={};for(const[n,i]of Object.entries(r))t[n]={...i,isBuiltin:!0};for(const n of e)t[n.key]={gamma:n.gamma,dMin:n.dMin,dMax:n.dMax,name:n.name,category:n.category||"custom",isBuiltin:!1,id:n.id};return t},groupFilmProfilesByCategory:function(e){const t={color:[],bw:[],custom:[]},n={portra160:"color",portra400:"color",portra800:"color",ektar100:"color",gold200:"color",colorplus200:"color",pro400h:"color",superia400:"color",c200:"color",trix400:"bw",tmax100:"bw",tmax400:"bw",hp5:"bw",delta100:"bw",delta400:"bw",acros100:"bw",default:"color"};for(const[r,i]of Object.entries(e))if(i.isBuiltin){t[n[r]||"color"].push({key:r,...i})}else t.custom.push({key:r,...i});return t},FILM_CURVE_PROFILES:r}},6976:function(e){e.exports={TONEMAP_GLSL:"\n// ============================================================================\n// Contrast \u2014 around perceptual mid-gray (0.46, matching CPU CONTRAST_MID_GRAY)\n// ============================================================================\n\nvec3 applyContrast(vec3 c, float contrast) {\n  // contrast is UI value -100..100, scale to -255..255 for the standard formula\n  float C = contrast * 2.55;\n  float factor = (259.0 * (C + 255.0)) / (255.0 * (259.0 - C));\n  float midGray = 0.46;\n  return (c - vec3(midGray)) * factor + vec3(midGray);\n}\n\n// ============================================================================\n// Highlights & Shadows \u2014 Bernstein basis (matches CPU RenderCore)\n// ============================================================================\n\nvec3 applyHighlightsShadows(vec3 c) {\n  float sFactor = u_shadows * 0.005;\n  float hFactor = u_highlights * 0.005;\n  \n  if (sFactor != 0.0) {\n    c += sFactor * pow(1.0 - c, vec3(2.0)) * c * 4.0;\n  }\n  \n  if (hFactor != 0.0) {\n    c += hFactor * pow(c, vec3(2.0)) * (1.0 - c) * 4.0;\n  }\n  \n  return c;\n}\n\n// ============================================================================\n// Whites & Blacks (Level Adjustment)\n// ============================================================================\n\nvec3 applyWhitesBlacks(vec3 c) {\n  float blackPoint = -(u_blacks) * 0.002;\n  float whitePoint = 1.0 - (u_whites) * 0.002;\n  \n  if (whitePoint != blackPoint) {\n    c = (c - vec3(blackPoint)) / (whitePoint - blackPoint);\n  }\n  \n  return c;\n}\n\n// ============================================================================\n// Highlight Roll-Off \u2014 C\xb2 continuous tanh shoulder compression\n// Matches CPU MathOps.highlightRollOff()\n// ============================================================================\n\nvec3 applyHighlightRollOff(vec3 c) {\n  float maxVal = max(c.r, max(c.g, c.b));\n  float threshold = 0.8;\n  if (maxVal > threshold) {\n    float headroom = 1.0 - threshold;\n    float tRO = min((maxVal - threshold) / headroom, 10.0);\n    float e2t = exp(2.0 * tRO);\n    float tanhT = (e2t - 1.0) / (e2t + 1.0);\n    float compressed = threshold + headroom * tanhT;\n    c *= (compressed / maxVal);\n  }\n  return c;\n}\n\n// ============================================================================\n// 1D Curve LUT Sampling\n// ============================================================================\n\nfloat sampleCurve(sampler2D t, float v) {\n  return texture2D(t, vec2(v, 0.5)).r;\n}\n\nvec3 applyCurvesLUT(vec3 c) {\n  float r = sampleCurve(u_curveRGB, c.r);\n  float g = sampleCurve(u_curveRGB, c.g);\n  float b = sampleCurve(u_curveRGB, c.b);\n  \n  r = sampleCurve(u_curveR, r);\n  g = sampleCurve(u_curveG, g);\n  b = sampleCurve(u_curveB, b);\n  \n  return vec3(r, g, b);\n}\n"}},7024:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII="},7043:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2777),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.isKey=function(e,t){return!Array.isArray(e)&&(!("number"!==typeof e&&"boolean"!==typeof e&&null!=e&&!r.isSymbol(e))||("string"===typeof e&&(a.test(e)||!i.test(e))||null!=t&&Object.hasOwn(t,e)))}},7151:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});const r={value:null,addProjectionMetrics:null}},7157:function(e,t,n){"use strict";n.d(t,{j:function(){return u}});var r=n(9570),i=n(3456),a=n(4900),o=n(3779),s=n(579),l=()=>n.e(707).then(n.bind(n,5707)).then(e=>e.default),c=e=>{const{ripples:t=[],motionProps:n,color:c="currentColor",style:u,onClear:d}=e;return(0,s.jsx)(s.Fragment,{children:t.map(e=>{const t=(0,o.qE)(.01*e.size,.2,e.size>100?.75:.5);return(0,s.jsx)(i.F,{features:l,children:(0,s.jsx)(r.N,{mode:"popLayout",children:(0,s.jsx)(a.m.span,{animate:{transform:`translate(${e.x}px, ${e.y}px) scale(2)`,opacity:0},className:"heroui-ripple",exit:{opacity:0},initial:{transform:`translate(${e.x}px, ${e.y}px) scale(0)`,opacity:.35},style:{position:"absolute",backgroundColor:c,borderRadius:"100%",transformOrigin:"center",pointerEvents:"none",overflow:"hidden",inset:0,zIndex:0,width:`${e.size}px`,height:`${e.size}px`,...u},transition:{duration:t},onAnimationComplete:()=>{d(e.key)},...n})})},e.key)})})};c.displayName="HeroUI.Ripple";var u=c},7178:function(e,t,n){"use strict";n.d(t,{k:function(){return s}});var r=n(2896),i=n(8412);let a;function o(){a=void 0}const s={now:()=>(void 0===a&&s.set(i.uv.isProcessing||r.W.useManualTiming?i.uv.timestamp:performance.now()),a),set:e=>{a=e,queueMicrotask(o)}}},7189:function(e,t,n){"use strict";n.d(t,{KG:function(){return l},OQ:function(){return c}});var r=n(6317),i=n(4784),a=n(7178),o=n(8412);const s={current:void 0};class l{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{const t=a.k.now();if(this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=a.k.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new r.v);const n=this.events[e].add(t);return"change"===e?()=>{n(),o.Gt.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return s.current&&s.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=a.k.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return(0,i.f)(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function c(e,t){return new l(e,t)}},7231:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(3799),i=n(4879);t.range=function(e,t,n){n&&"number"!==typeof n&&r.isIterateeCall(e,t,n)&&(t=n=void 0),e=i.toFinite(e),void 0===t?(t=e,e=0):t=i.toFinite(t),n=void 0===n?e<t?1:-1:i.toFinite(n);const a=Math.max(Math.ceil((t-e)/(n||1)),0),o=new Array(a);for(let r=0;r<a;r++)o[r]=e,e+=n;return o}},7234:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,n))c<i&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<i&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,A="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(g=!1,b(e),!m)if(null!==r(c))m=!0,L(_);else{var t=r(u);null!==t&&O(x,t.startTime-e)}}function _(e,n){m=!1,g&&(g=!1,A(C),C=-1),f=!0;var a=p;try{for(b(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!P());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(c)&&i(c),b(n)}else i(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&O(x,d.startTime-n),l=!1}return l}finally{h=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,S=!1,T=null,C=-1,M=5,E=-1;function P(){return!(t.unstable_now()-E<M)}function N(){if(null!==T){var e=t.unstable_now();E=e;var n=!0;try{n=T(!0,e)}finally{n?w():(S=!1,T=null)}}else S=!1}if("function"===typeof y)w=function(){y(N)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,R=k.port2;k.port1.onmessage=N,w=function(){R.postMessage(null)}}else w=function(){v(N,0)};function L(e){T=e,S||(S=!0,w())}function O(e,n){C=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,L(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(g?(A(C),C=-1):g=!0,O(x,a-o))):(e.sortIndex=s,n(c,e),m||f||(m=!0,L(_))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},7237:function(e,t,n){"use strict";n(8365)},7260:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isUnsafeProperty=function(e){return"__proto__"===e}},7287:function(e,t,n){"use strict";n.d(t,{C:function(){return a},l:function(){return i}});var r=n(151),[i,a]=(0,r.q)({name:"ButtonGroupContext",strict:!1})},7312:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.flatten=function(e,t=1){const n=[],r=Math.floor(t),i=(e,t)=>{for(let a=0;a<e.length;a++){const o=e[a];Array.isArray(o)&&t<r?i(o,t+1):n.push(o)}};return i(e,0),n}},7330:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(9323);t.property=function(e){return function(t){return r.get(t,e)}}},7380:function(e,t,n){"use strict";function r(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}n.d(t,{X:function(){return r}})},7418:function(e,t,n){"use strict";n.d(t,{Fe:function(){return u},PJ:function(){return p},_h:function(){return h},pg:function(){return s},rd:function(){return l}});var r=n(4595),i=n(9427),a=n(5043);const o=(0,a.createContext)({isNative:!0,open:function(e,t){d(e,e=>u(e,t))},useHref:e=>e});function s(e){let{children:t,navigate:n,useHref:r}=e,i=(0,a.useMemo)(()=>({isNative:!1,open:(e,t,r,i)=>{d(e,e=>{c(e,t)?n(r,i):u(e,t)})},useHref:r||(e=>e)}),[n,r]);return a.createElement(o.Provider,{value:i},t)}function l(){return(0,a.useContext)(o)}function c(e,t){let n=e.getAttribute("target");return(!n||"_self"===n)&&e.origin===location.origin&&!e.hasAttribute("download")&&!t.metaKey&&!t.ctrlKey&&!t.altKey&&!t.shiftKey}function u(e,t,n=!0){var a,o;let{metaKey:s,ctrlKey:l,altKey:c,shiftKey:d}=t;(0,i.gm)()&&(null===(o=window.event)||void 0===o||null===(a=o.type)||void 0===a?void 0:a.startsWith("key"))&&"_blank"===e.target&&((0,i.cX)()?s=!0:l=!0);let h=(0,i.Tc)()&&(0,i.cX)()&&!(0,i.bh)()?new KeyboardEvent("keydown",{keyIdentifier:"Enter",metaKey:s,ctrlKey:l,altKey:c,shiftKey:d}):new MouseEvent("click",{metaKey:s,ctrlKey:l,altKey:c,shiftKey:d,detail:1,bubbles:!0,cancelable:!0});u.isOpening=n,(0,r.e)(e),e.dispatchEvent(h),u.isOpening=!1}function d(e,t){if(e instanceof HTMLAnchorElement)t(e);else if(e.hasAttribute("data-href")){let n=document.createElement("a");n.href=e.getAttribute("data-href"),e.hasAttribute("data-target")&&(n.target=e.getAttribute("data-target")),e.hasAttribute("data-rel")&&(n.rel=e.getAttribute("data-rel")),e.hasAttribute("data-download")&&(n.download=e.getAttribute("data-download")),e.hasAttribute("data-ping")&&(n.ping=e.getAttribute("data-ping")),e.hasAttribute("data-referrer-policy")&&(n.referrerPolicy=e.getAttribute("data-referrer-policy")),e.appendChild(n),t(n),e.removeChild(n)}}function h(e){var t;const n=l().useHref(null!==(t=null===e||void 0===e?void 0:e.href)&&void 0!==t?t:"");return{href:(null===e||void 0===e?void 0:e.href)?n:void 0,target:null===e||void 0===e?void 0:e.target,rel:null===e||void 0===e?void 0:e.rel,download:null===e||void 0===e?void 0:e.download,ping:null===e||void 0===e?void 0:e.ping,referrerPolicy:null===e||void 0===e?void 0:e.referrerPolicy}}function p(e,t,n,r){!t.isNative&&e.currentTarget instanceof HTMLAnchorElement&&e.currentTarget.href&&!e.isDefaultPrevented()&&c(e.currentTarget,e)&&n&&(e.preventDefault(),t.open(e.currentTarget,e,n,r))}u.isOpening=!1},7449:function(e,t,n){"use strict";n.d(t,{KN:function(){return a},gQ:function(){return c},px:function(){return o},uj:function(){return i},vh:function(){return s},vw:function(){return l}});const r=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),i=r("deg"),a=r("%"),o=r("px"),s=r("vh"),l=r("vw"),c=(()=>({...a,parse:e=>a.parse(e)/100,transform:e=>a.transform(100*e)}))()},7457:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var r=n(3964),i=n(2420);function a(e,t,n){const{style:a}=e,o={};for(const s in a)((0,r.S)(a[s])||t.style&&(0,r.S)(t.style[s])||(0,i.z)(s,e)||void 0!==n?.getValue(s)?.liveStyle)&&(o[s]=a[s]);return o}},7475:function(e,t,n){"use strict";n.d(t,{M:function(){return r}});const r=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary},7508:function(e,t,n){"use strict";n.d(t,{n1:function(){return v},N$:function(){return N},Pu:function(){return w}});var r=n(6650),i=n(3941),a=n(8493),o=n(9427),s=n(587),l=n(8848);class c{get currentNode(){return this._currentNode}set currentNode(e){if(!(0,i.sD)(this.root,e))throw new Error("Cannot set currentNode to a node that is not contained by the root node.");const t=[];let n=e,r=e;for(this._currentNode=e;n&&n!==this.root;)if(n.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const e=n,i=this._doc.createTreeWalker(e,this.whatToShow,{acceptNode:this._acceptNode});t.push(i),i.currentNode=r,this._currentSetFor.add(i),n=r=e.host}else n=n.parentNode;const a=this._doc.createTreeWalker(this.root,this.whatToShow,{acceptNode:this._acceptNode});t.push(a),a.currentNode=r,this._currentSetFor.add(a),this._walkerStack=t}get doc(){return this._doc}firstChild(){let e=this.currentNode,t=this.nextNode();return(0,i.sD)(e,t)?(t&&(this.currentNode=t),t):(this.currentNode=e,null)}lastChild(){let e=this._walkerStack[0].lastChild();return e&&(this.currentNode=e),e}nextNode(){const e=this._walkerStack[0].nextNode();if(e){if(e.shadowRoot){var t;let n;if("function"===typeof this.filter?n=this.filter(e):(null===(t=this.filter)||void 0===t?void 0:t.acceptNode)&&(n=this.filter.acceptNode(e)),n===NodeFilter.FILTER_ACCEPT)return this.currentNode=e,e;let r=this.nextNode();return r&&(this.currentNode=r),r}return e&&(this.currentNode=e),e}if(this._walkerStack.length>1){this._walkerStack.shift();let e=this.nextNode();return e&&(this.currentNode=e),e}return null}previousNode(){const e=this._walkerStack[0];if(e.currentNode===e.root){if(this._currentSetFor.has(e)){if(this._currentSetFor.delete(e),this._walkerStack.length>1){this._walkerStack.shift();let e=this.previousNode();return e&&(this.currentNode=e),e}return null}return null}const t=e.previousNode();if(t){if(t.shadowRoot){var n;let e;if("function"===typeof this.filter?e=this.filter(t):(null===(n=this.filter)||void 0===n?void 0:n.acceptNode)&&(e=this.filter.acceptNode(t)),e===NodeFilter.FILTER_ACCEPT)return t&&(this.currentNode=t),t;let r=this.lastChild();return r&&(this.currentNode=r),r}return t&&(this.currentNode=t),t}if(this._walkerStack.length>1){this._walkerStack.shift();let e=this.previousNode();return e&&(this.currentNode=e),e}return null}nextSibling(){return null}previousSibling(){return null}parentNode(){return null}constructor(e,t,n,r){this._walkerStack=[],this._currentSetFor=new Set,this._acceptNode=e=>{if(e.nodeType===Node.ELEMENT_NODE){const n=e.shadowRoot;if(n){const e=this._doc.createTreeWalker(n,this.whatToShow,{acceptNode:this._acceptNode});return this._walkerStack.unshift(e),NodeFilter.FILTER_ACCEPT}var t;if("function"===typeof this.filter)return this.filter(e);if(null===(t=this.filter)||void 0===t?void 0:t.acceptNode)return this.filter.acceptNode(e);if(null===this.filter)return NodeFilter.FILTER_ACCEPT}return NodeFilter.FILTER_SKIP},this._doc=e,this.root=t,this.filter=null!==r&&void 0!==r?r:null,this.whatToShow=null!==n&&void 0!==n?n:NodeFilter.SHOW_ALL,this._currentNode=t,this._walkerStack.unshift(e.createTreeWalker(t,n,this._acceptNode));const i=t.shadowRoot;if(i){const e=this._doc.createTreeWalker(i,this.whatToShow,{acceptNode:this._acceptNode});this._walkerStack.unshift(e)}}}function u(e,t,n,r){return(0,l.Nf)()?new c(e,t,n,r):e.createTreeWalker(t,n,r)}var d=n(5603),h=n(4338),p=n(5043);const f=p.createContext(null),m="react-aria-focus-scope-restore";let g=null;function v(e){let{children:t,contain:n,restoreFocus:s,autoFocus:l}=e,c=(0,p.useRef)(null),u=(0,p.useRef)(null),h=(0,p.useRef)([]),{parentNode:v}=(0,p.useContext)(f)||{},w=(0,p.useMemo)(()=>new R({scopeRef:h}),[h]);(0,r.N)(()=>{let e=v||L.root;if(L.getTreeNode(e.scopeRef)&&g&&!S(g,e.scopeRef)){let t=L.getTreeNode(g);t&&(e=t)}e.addChild(w),L.addNode(w)},[w,v]),(0,r.N)(()=>{let e=L.getTreeNode(h);e&&(e.contain=!!n)},[n]),(0,r.N)(()=>{var e;let t=null===(e=c.current)||void 0===e?void 0:e.nextSibling,n=[],r=e=>e.stopPropagation();for(;t&&t!==u.current;)n.push(t),t.addEventListener(m,r),t=t.nextSibling;return h.current=n,()=>{for(let e of n)e.removeEventListener(m,r)}},[t]),function(e,t,n){(0,r.N)(()=>{if(t||n)return;let r=e.current;const o=(0,a.TW)(r?r[0]:void 0);let s=t=>{let n=(0,i.wt)(t);x(n,e.current)?g=e:b(n)||(g=null)};return o.addEventListener("focusin",s,!1),null===r||void 0===r||r.forEach(e=>e.addEventListener("focusin",s,!1)),()=>{o.removeEventListener("focusin",s,!1),null===r||void 0===r||r.forEach(e=>e.removeEventListener("focusin",s,!1))}},[e,t,n])}(h,s,n),function(e,t){let n=(0,p.useRef)(void 0),s=(0,p.useRef)(void 0);(0,r.N)(()=>{let r=e.current;if(!t)return void(s.current&&(cancelAnimationFrame(s.current),s.current=void 0));const l=(0,a.TW)(r?r[0]:void 0);let c=t=>{if("Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!y(e)||t.isComposing)return;let n=(0,i.bq)(l),r=e.current;if(!r||!x(n,r))return;let a=N(A(r),{tabbable:!0},r);if(!n)return;a.currentNode=n;let o=t.shiftKey?a.previousNode():a.nextNode();o||(a.currentNode=t.shiftKey?r[r.length-1].nextElementSibling:r[0].previousElementSibling,o=t.shiftKey?a.previousNode():a.nextNode()),t.preventDefault(),o&&T(o,!0)},u=t=>{g&&!S(g,e)||!x((0,i.wt)(t),e.current)?y(e)&&!_((0,i.wt)(t),e)?n.current?n.current.focus():g&&g.current&&M(g.current):y(e)&&(n.current=(0,i.wt)(t)):(g=e,n.current=(0,i.wt)(t))},h=t=>{s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{let r=(0,d.ME)(),a=("virtual"===r||null===r)&&(0,o.m0)()&&(0,o.H8)(),s=(0,i.bq)(l);if(!a&&s&&y(e)&&!_(s,e)){g=e;let r=(0,i.wt)(t);var c;if(r&&r.isConnected)n.current=r,null===(c=n.current)||void 0===c||c.focus();else g.current&&M(g.current)}})};return l.addEventListener("keydown",c,!1),l.addEventListener("focusin",u,!1),null===r||void 0===r||r.forEach(e=>e.addEventListener("focusin",u,!1)),null===r||void 0===r||r.forEach(e=>e.addEventListener("focusout",h,!1)),()=>{l.removeEventListener("keydown",c,!1),l.removeEventListener("focusin",u,!1),null===r||void 0===r||r.forEach(e=>e.removeEventListener("focusin",u,!1)),null===r||void 0===r||r.forEach(e=>e.removeEventListener("focusout",h,!1))}},[e,t]),(0,r.N)(()=>()=>{s.current&&cancelAnimationFrame(s.current)},[s])}(h,n),function(e,t,n){const o=(0,p.useRef)("undefined"!==typeof document?(0,i.bq)((0,a.TW)(e.current?e.current[0]:void 0)):null);(0,r.N)(()=>{let r=e.current;const o=(0,a.TW)(r?r[0]:void 0);if(!t||n)return;let s=()=>{g&&!S(g,e)||!x((0,i.bq)(o),e.current)||(g=e)};return o.addEventListener("focusin",s,!1),null===r||void 0===r||r.forEach(e=>e.addEventListener("focusin",s,!1)),()=>{o.removeEventListener("focusin",s,!1),null===r||void 0===r||r.forEach(e=>e.removeEventListener("focusin",s,!1))}},[e,n]),(0,r.N)(()=>{const r=(0,a.TW)(e.current?e.current[0]:void 0);if(!t)return;let i=t=>{if("Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!y(e)||t.isComposing)return;let n=r.activeElement;if(!_(n,e)||!E(e))return;let i=L.getTreeNode(e);if(!i)return;let a=i.nodeToRestore,o=N(r.body,{tabbable:!0});o.currentNode=n;let s=t.shiftKey?o.previousNode():o.nextNode();if(a&&a.isConnected&&a!==r.body||(a=void 0,i.nodeToRestore=void 0),(!s||!_(s,e))&&a){o.currentNode=a;do{s=t.shiftKey?o.previousNode():o.nextNode()}while(_(s,e));t.preventDefault(),t.stopPropagation(),s?T(s,!0):b(a)?T(a,!0):n.blur()}};return n||r.addEventListener("keydown",i,!0),()=>{n||r.removeEventListener("keydown",i,!0)}},[e,t,n]),(0,r.N)(()=>{const n=(0,a.TW)(e.current?e.current[0]:void 0);if(!t)return;let r=L.getTreeNode(e);var s;return r?(r.nodeToRestore=null!==(s=o.current)&&void 0!==s?s:void 0,()=>{let r=L.getTreeNode(e);if(!r)return;let a=r.nodeToRestore,o=(0,i.bq)(n);if(t&&a&&(o&&_(o,e)||o===n.body&&E(e))){let t=L.clone();requestAnimationFrame(()=>{if(n.activeElement===n.body){let n=t.getTreeNode(e);for(;n;){if(n.nodeToRestore&&n.nodeToRestore.isConnected)return void P(n.nodeToRestore);n=n.parent}for(n=t.getTreeNode(e);n;){if(n.scopeRef&&n.scopeRef.current&&L.getTreeNode(n.scopeRef)){return void P(C(n.scopeRef.current,!0))}n=n.parent}}})}}):void 0},[e,t])}(h,s,n),function(e,t){const n=p.useRef(t);(0,p.useEffect)(()=>{if(n.current){g=e;const t=(0,a.TW)(e.current?e.current[0]:void 0);!x((0,i.bq)(t),g.current)&&e.current&&M(e.current)}n.current=!1},[e])}(h,l),(0,p.useEffect)(()=>{const e=(0,i.bq)((0,a.TW)(h.current?h.current[0]:void 0));let t=null;if(x(e,h.current)){for(let n of L.traverse())n.scopeRef&&x(e,n.scopeRef.current)&&(t=n);t===L.getTreeNode(h)&&(g=t.scopeRef)}},[h]),(0,r.N)(()=>()=>{var e,t,n;let r=null!==(n=null===(t=L.getTreeNode(h))||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.scopeRef)&&void 0!==n?n:null;h!==g&&!S(h,g)||r&&!L.getTreeNode(r)||(g=r),L.removeTreeNode(h)},[h]);let k=(0,p.useMemo)(()=>function(e){return{focusNext(t={}){let n=e.current,{from:r,tabbable:o,wrap:s,accept:l}=t;var c;let u=r||(0,i.bq)((0,a.TW)(null!==(c=n[0])&&void 0!==c?c:void 0)),d=n[0].previousElementSibling,h=N(A(n),{tabbable:o,accept:l},n);h.currentNode=x(u,n)?u:d;let p=h.nextNode();return!p&&s&&(h.currentNode=d,p=h.nextNode()),p&&T(p,!0),p},focusPrevious(t={}){let n=e.current,{from:r,tabbable:o,wrap:s,accept:l}=t;var c;let u=r||(0,i.bq)((0,a.TW)(null!==(c=n[0])&&void 0!==c?c:void 0)),d=n[n.length-1].nextElementSibling,h=N(A(n),{tabbable:o,accept:l},n);h.currentNode=x(u,n)?u:d;let p=h.previousNode();return!p&&s&&(h.currentNode=d,p=h.previousNode()),p&&T(p,!0),p},focusFirst(t={}){let n=e.current,{tabbable:r,accept:i}=t,a=N(A(n),{tabbable:r,accept:i},n);a.currentNode=n[0].previousElementSibling;let o=a.nextNode();return o&&T(o,!0),o},focusLast(t={}){let n=e.current,{tabbable:r,accept:i}=t,a=N(A(n),{tabbable:r,accept:i},n);a.currentNode=n[n.length-1].nextElementSibling;let o=a.previousNode();return o&&T(o,!0),o}}}(h),[]),O=(0,p.useMemo)(()=>({focusManager:k,parentNode:w}),[w,k]);return p.createElement(f.Provider,{value:O},p.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:c}),t,p.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:u}))}function A(e){return e[0].parentElement}function y(e){let t=L.getTreeNode(g);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function b(e){return _(e)}function x(e,t){return!!e&&(!!t&&t.some(t=>t.contains(e)))}function _(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of L.traverse(L.getTreeNode(t)))if(n&&x(e,n.current))return!0;return!1}function w(e){return _(e,g)}function S(e,t){var n;let r=null===(n=L.getTreeNode(t))||void 0===n?void 0:n.parent;for(;r;){if(r.scopeRef===e)return!0;r=r.parent}return!1}function T(e,t=!1){if(null==e||t){if(null!=e)try{e.focus()}catch{}}else try{(0,h.l)(e)}catch{}}function C(e,t=!0){let n=e[0].previousElementSibling,r=A(e),i=N(r,{tabbable:t},e);i.currentNode=n;let a=i.nextNode();return t&&!a&&(r=A(e),i=N(r,{tabbable:!1},e),i.currentNode=n,a=i.nextNode()),a}function M(e,t=!0){T(C(e,t))}function E(e){let t=L.getTreeNode(g);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(null===t||void 0===t?void 0:t.scopeRef)===e}function P(e){e.dispatchEvent(new CustomEvent(m,{bubbles:!0,cancelable:!0}))&&T(e)}function N(e,t,n){let r=(null===t||void 0===t?void 0:t.tabbable)?s.A:s.t,i=(null===e||void 0===e?void 0:e.nodeType)===Node.ELEMENT_NODE?e:null,o=(0,a.TW)(i),l=u(o,e||o,NodeFilter.SHOW_ELEMENT,{acceptNode(e){var i;if(null===t||void 0===t||null===(i=t.from)||void 0===i?void 0:i.contains(e))return NodeFilter.FILTER_REJECT;if((null===t||void 0===t?void 0:t.tabbable)&&"INPUT"===e.tagName&&"radio"===e.getAttribute("type")){if(!function(e){if(e.checked)return!0;let t=[];if(e.form){var n,r;let i=null===(r=e.form)||void 0===r||null===(n=r.elements)||void 0===n?void 0:n.namedItem(e.name);t=[...null!==i&&void 0!==i?i:[]]}else t=[...(0,a.TW)(e).querySelectorAll(`input[type="radio"][name="${CSS.escape(e.name)}"]`)].filter(e=>!e.form);return!!t&&!t.some(e=>e.checked)}(e))return NodeFilter.FILTER_REJECT;if("INPUT"===l.currentNode.tagName&&"radio"===l.currentNode.type&&l.currentNode.name===e.name)return NodeFilter.FILTER_REJECT}return!r(e)||n&&!x(e,n)||(null===t||void 0===t?void 0:t.accept)&&!t.accept(e)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}});return(null===t||void 0===t?void 0:t.from)&&(l.currentNode=t.from),l}class k{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,t,n){let r=this.fastMap.get(null!==t&&void 0!==t?t:null);if(!r)return;let i=new R({scopeRef:e});r.addChild(i),i.parent=r,this.fastMap.set(e,i),n&&(i.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(null===e)return;let t=this.fastMap.get(e);if(!t)return;let n=t.parent;for(let i of this.traverse())i!==t&&t.nodeToRestore&&i.nodeToRestore&&t.scopeRef&&t.scopeRef.current&&x(i.nodeToRestore,t.scopeRef.current)&&(i.nodeToRestore=t.nodeToRestore);let r=t.children;n&&(n.removeChild(t),r.size>0&&r.forEach(e=>n&&n.addChild(e))),this.fastMap.delete(t.scopeRef)}*traverse(e=this.root){if(null!=e.scopeRef&&(yield e),e.children.size>0)for(let t of e.children)yield*this.traverse(t)}clone(){var e;let t=new k;var n;for(let r of this.traverse())t.addTreeNode(r.scopeRef,null!==(n=null===(e=r.parent)||void 0===e?void 0:e.scopeRef)&&void 0!==n?n:null,r.nodeToRestore);return t}constructor(){this.fastMap=new Map,this.root=new R({scopeRef:null}),this.fastMap.set(null,this.root)}}class R{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let L=new k},7585:function(e){e.exports={UNIFORMS_GLSL:"\n// Image texture\nuniform sampler2D u_image;\n\n// Inversion (float for WebGL1/2 compat \u2014 test with > 0.5)\nuniform float u_inverted;      // 0.0 = no inversion, 1.0 = invert\nuniform float u_inversionMode; // 0.0 = linear, 1.0 = log\n\n// White Balance\nuniform vec3 u_gains;          // r,g,b gains\n\n// Tone adjustments (raw values from UI, see shader for scaling)\nuniform float u_exposure;      // -100..100\nuniform float u_contrast;      // -100..100\nuniform float u_highlights;    // -100..100\nuniform float u_shadows;       // -100..100\nuniform float u_whites;        // -100..100\nuniform float u_blacks;        // -100..100\n\n// Film Curve parameters (Q13: per-channel gamma + toe/shoulder)\nuniform float u_filmCurveEnabled;\nuniform float u_filmCurveGamma;\nuniform float u_filmCurveGammaR;\nuniform float u_filmCurveGammaG;\nuniform float u_filmCurveGammaB;\nuniform float u_filmCurveDMin;\nuniform float u_filmCurveDMax;\nuniform float u_filmCurveToe;\nuniform float u_filmCurveShoulder;\n\n// Film Base Correction (Pre-Inversion)\nuniform float u_baseMode;      // 0.0 = linear (gains), 1.0 = log (density subtraction)\nuniform vec3 u_baseGains;      // Linear mode: r,g,b gains\nuniform vec3 u_baseDensity;    // Log mode: r,g,b density values to subtract\n\n// Density Levels (Log domain auto-levels)\nuniform float u_densityLevelsEnabled;\nuniform vec3 u_densityLevelsMin;\nuniform vec3 u_densityLevelsMax;\n\n// Curve LUTs (1D textures)\nuniform sampler2D u_curveRGB;\nuniform sampler2D u_curveR;\nuniform sampler2D u_curveG;\nuniform sampler2D u_curveB;\nuniform float u_useCurves;\n\n// 3D LUT (packed 2D texture for WebGL1; sampler3D for WebGL2)\nuniform sampler2D u_lut3d;\nuniform float u_useLut3d;\nuniform float u_lutSize;\nuniform float u_lutIntensity;\n\n// HSL adjustments (8 channels x 3 values: hue, saturation, luminance)\nuniform float u_useHSL;\nuniform vec3 u_hslRed;\nuniform vec3 u_hslOrange;\nuniform vec3 u_hslYellow;\nuniform vec3 u_hslGreen;\nuniform vec3 u_hslCyan;\nuniform vec3 u_hslBlue;\nuniform vec3 u_hslPurple;\nuniform vec3 u_hslMagenta;\n\n// Global Saturation (Luma-Preserving, Rec.709)\nuniform float u_useSaturation;\nuniform float u_saturation;    // -100..100, 0 = identity\n\n// Split Toning (u_split* prefix to distinguish from tone mapping highlights)\nuniform float u_useSplitTone;\nuniform float u_splitHighlightHue;\nuniform float u_splitHighlightSat;\nuniform float u_splitMidtoneHue;\nuniform float u_splitMidtoneSat;\nuniform float u_splitShadowHue;\nuniform float u_splitShadowSat;\nuniform float u_splitBalance;\n"}},7599:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});t.argumentsTag="[object Arguments]",t.arrayBufferTag="[object ArrayBuffer]",t.arrayTag="[object Array]",t.bigInt64ArrayTag="[object BigInt64Array]",t.bigUint64ArrayTag="[object BigUint64Array]",t.booleanTag="[object Boolean]",t.dataViewTag="[object DataView]",t.dateTag="[object Date]",t.errorTag="[object Error]",t.float32ArrayTag="[object Float32Array]",t.float64ArrayTag="[object Float64Array]",t.functionTag="[object Function]",t.int16ArrayTag="[object Int16Array]",t.int32ArrayTag="[object Int32Array]",t.int8ArrayTag="[object Int8Array]",t.mapTag="[object Map]",t.numberTag="[object Number]",t.objectTag="[object Object]",t.regexpTag="[object RegExp]",t.setTag="[object Set]",t.stringTag="[object String]",t.symbolTag="[object Symbol]",t.uint16ArrayTag="[object Uint16Array]",t.uint32ArrayTag="[object Uint32Array]",t.uint8ArrayTag="[object Uint8Array]",t.uint8ClampedArrayTag="[object Uint8ClampedArray]"},7664:function(e,t,n){"use strict";n.d(t,{OU:function(){return d},Ql:function(){return h},Ww:function(){return f},hq:function(){return a},o4:function(){return l}});var r=n(1853),i=n(4077);function a(e,t,n){return n+t*(e-n)}function o(e,t,n,r,i){return void 0!==i&&(e=a(e,i,r)),a(e,n,r)+t}function s(e,t=0,n=1,r,i){e.min=o(e.min,t,n,r,i),e.max=o(e.max,t,n,r,i)}function l(e,{x:t,y:n}){s(e.x,t.translate,t.scale,t.originPoint),s(e.y,n.translate,n.scale,n.originPoint)}const c=.999999999999,u=1.0000000000001;function d(e,t,n,r=!1){const a=n.length;if(!a)return;let o,s;t.x=t.y=1;for(let c=0;c<a;c++){o=n[c],s=o.projectionDelta;const{visualElement:a}=o.options;a&&a.props.style&&"contents"===a.props.style.display||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&f(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,l(e,s)),r&&(0,i.HD)(o.latestValues)&&f(e,o.latestValues))}t.x<u&&t.x>c&&(t.x=1),t.y<u&&t.y>c&&(t.y=1)}function h(e,t){e.min=e.min+t,e.max=e.max+t}function p(e,t,n,i,a=.5){s(e,t,n,(0,r.k)(e.min,e.max,a),i)}function f(e,t){p(e.x,t.x,t.scaleX,t.scale,t.originX),p(e.y,t.y,t.scaleY,t.scale,t.originY)}},7690:function(e){e.exports={SPLIT_TONE_GLSL:"\n// ============================================================================\n// Split Toning \u2014 matches CPU filmLabSplitTone.js\n// ============================================================================\n\n// Rec. 709 luminance (matching CPU filmLabSplitTone.js)\nfloat calcLuminance(vec3 c) {\n  return 0.2126 * c.r + 0.7152 * c.g + 0.0722 * c.b;\n}\n\n// Hermite smoothstep for zone weight transitions (NOT GLSL built-in)\nfloat splitToneSmoothstep(float t) {\n  t = clamp(t, 0.0, 1.0);\n  return t * t * (3.0 - 2.0 * t);\n}\n\nvec3 applySplitToning(vec3 color) {\n  float lum = calcLuminance(color);\n\n  // Zone weights (matching CPU calculateZoneWeights)\n  // balance is in [-1, 1] range (pre-divided by 100 on JS side)\n  float balanceOffset = u_splitBalance / 2.0;\n  float midpoint = 0.5 + balanceOffset;\n  float shadowEnd = 0.25;\n  float highlightStart = 0.75;\n\n  float shadowWeight = 0.0;\n  float midtoneWeight = 0.0;\n  float highlightWeight = 0.0;\n\n  // Shadow zone\n  if (lum < shadowEnd) {\n    shadowWeight = 1.0;\n  } else if (lum < midpoint) {\n    float d = max(midpoint - shadowEnd, 0.001);\n    float st = splitToneSmoothstep(clamp((lum - shadowEnd) / d, 0.0, 1.0));\n    shadowWeight = 1.0 - st;\n    midtoneWeight = st;\n  }\n\n  // Highlight zone\n  if (lum > highlightStart) {\n    highlightWeight = 1.0;\n  } else if (lum > midpoint) {\n    float d = max(highlightStart - midpoint, 0.001);\n    float st = splitToneSmoothstep(clamp((lum - midpoint) / d, 0.0, 1.0));\n    highlightWeight = st;\n    midtoneWeight = max(midtoneWeight, 1.0 - st);\n  }\n\n  // Midtone zone (peak at midpoint)\n  if (lum >= shadowEnd && lum <= highlightStart) {\n    if (abs(lum - midpoint) < 0.1) {\n      midtoneWeight = 1.0;\n    } else if (lum < midpoint) {\n      float d = max(midpoint - shadowEnd, 0.001);\n      midtoneWeight = max(midtoneWeight, splitToneSmoothstep(clamp((lum - shadowEnd) / d, 0.0, 1.0)));\n    } else {\n      float d = max(highlightStart - midpoint, 0.001);\n      midtoneWeight = max(midtoneWeight, 1.0 - splitToneSmoothstep(clamp((lum - midpoint) / d, 0.0, 1.0)));\n    }\n  }\n\n  // Generate tint colors (hue is 0-1 range, pre-divided by 360 on JS side)\n  vec3 highlightTint = hsl2rgb(vec3(u_splitHighlightHue * 360.0, 1.0, 0.5));\n  vec3 midtoneTint = hsl2rgb(vec3(u_splitMidtoneHue * 360.0, 1.0, 0.5));\n  vec3 shadowTint = hsl2rgb(vec3(u_splitShadowHue * 360.0, 1.0, 0.5));\n\n  // Lerp-to-tint blend (matching CPU: result + (tint - result) * strength * 0.3)\n  // NOT multiply-blend \u2014 lerp preserves luminance better\n  vec3 result = color;\n  if (shadowWeight > 0.0 && u_splitShadowSat > 0.0) {\n    float strength = u_splitShadowSat * shadowWeight;\n    result += (shadowTint - result) * strength * 0.3;\n  }\n  if (midtoneWeight > 0.0 && u_splitMidtoneSat > 0.0) {\n    float strength = u_splitMidtoneSat * midtoneWeight;\n    result += (midtoneTint - result) * strength * 0.3;\n  }\n  if (highlightWeight > 0.0 && u_splitHighlightSat > 0.0) {\n    float strength = u_splitHighlightSat * highlightWeight;\n    result += (highlightTint - result) * strength * 0.3;\n  }\n  return clamp(result, 0.0, 1.0);\n}\n"}},7770:function(e,t,n){e.exports=n(9323).get},7820:function(e,t,n){"use strict";n.d(t,{xf:function(){return r},zF:function(){return i}});var r={ease:[.36,.66,.4,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1],spring:[.155,1.105,.295,1.12],springOut:[.57,-.15,.62,.07],softSpring:[.16,1.11,.3,1.02]},i=(r.easeOut,r.easeIn,{scaleSpring:{enter:{transform:"scale(1)",opacity:1,transition:{type:"spring",bounce:0,duration:.2}},exit:{transform:"scale(0.85)",opacity:0,transition:{type:"easeOut",duration:.15}}},scaleSpringOpacity:{initial:{opacity:0,transform:"scale(0.8)"},enter:{opacity:1,transform:"scale(1)",transition:{type:"spring",bounce:0,duration:.3}},exit:{opacity:0,transform:"scale(0.96)",transition:{type:"easeOut",bounce:0,duration:.15}}},scale:{enter:{scale:1},exit:{scale:.95}},scaleFadeIn:{enter:{transform:"scale(1)",opacity:1,transition:{duration:.25,ease:r.easeIn}},exit:{transform:"scale(0.95)",opacity:0,transition:{duration:.2,ease:r.easeOut}}},scaleInOut:{enter:{transform:"scale(1)",opacity:1,transition:{duration:.4,ease:r.ease}},exit:{transform:"scale(1.03)",opacity:0,transition:{duration:.3,ease:r.ease}}},fade:{enter:{opacity:1,transition:{duration:.4,ease:r.ease}},exit:{opacity:0,transition:{duration:.3,ease:r.ease}}},collapse:{enter:{opacity:1,height:"auto",transition:{height:{type:"spring",bounce:0,duration:.3},opacity:{easings:"ease",duration:.4}}},exit:{opacity:0,height:0,transition:{easings:"ease",duration:.3}}}})},7929:function(e){"use strict";function t(e,t,n,r){return e+t*r+n*r*r}e.exports={getEffectiveInverted:function(e,t){return"positive"!==e&&!!t},isPositiveMode:function(e){return"positive"===e},shouldShowInversionControls:function(e){return"positive"!==e},getLUT3DIndex:t,packLUT3DForWebGL:function(e,n){const r=new Uint8Array(n*(n*n)*4);let i=0;for(let a=0;a<n;a++)for(let o=0;o<n;o++)for(let s=0;s<n;s++){const l=3*t(s,o,a,n),c=Math.max(0,Math.min(1,e[l])),u=Math.max(0,Math.min(1,e[l+1])),d=Math.max(0,Math.min(1,e[l+2]));r[i++]=Math.round(255*c),r[i++]=Math.round(255*u),r[i++]=Math.round(255*d),r[i++]=255}return r},buildCombinedLUT:function(e,t){const n=e,r=t,i=n||r;if(!i||!i.data)return null;const a=i.size,o=a*a*a,s=new Float32Array(3*o),l=n?n.data:null,c=n?n.intensity??1:0,u=r?r.data:null,d=r?r.intensity??1:0;for(let h=0,p=0;h<o;h++,p+=3){let e=h%a/(a-1),t=Math.floor(h/a)%a/(a-1),n=Math.floor(h/(a*a))/(a-1);if(l&&c>0){e=e*(1-c)+l[p]*c,t=t*(1-c)+l[p+1]*c,n=n*(1-c)+l[p+2]*c}if(u&&d>0){e=e*(1-d)+u[p]*d,t=t*(1-d)+u[p+1]*d,n=n*(1-d)+u[p+2]*d}s[p]=e,s[p+1]=t,s[p+2]=n}return{size:a,data:s,intensity:1}},sampleLUT3D:function(e,n,r,i,a=1){if(!i||!i.data||!i.size)return[e,n,r];const{size:o,data:s}=i,l=o-1,c=Math.max(0,Math.min(255,e))/255*l,u=Math.max(0,Math.min(255,n))/255*l,d=Math.max(0,Math.min(255,r))/255*l,h=Math.floor(c),p=Math.min(l,h+1),f=Math.floor(u),m=Math.min(l,f+1),g=Math.floor(d),v=Math.min(l,g+1),A=c-h,y=u-f,b=d-g,x=(e,n,r)=>3*t(e,n,r,o),_=e=>{const t=s[x(h,f,g)+e],n=s[x(p,f,g)+e],r=s[x(h,m,g)+e],i=s[x(p,m,g)+e],a=s[x(h,f,v)+e],o=s[x(p,f,v)+e],l=s[x(h,m,v)+e],c=s[x(p,m,v)+e];return((t*(1-A)+n*A)*(1-y)+(r*(1-A)+i*A)*y)*(1-b)+((a*(1-A)+o*A)*(1-y)+(l*(1-A)+c*A)*y)*b},w=255*_(0),S=255*_(1),T=255*_(2);return a>=1?[w,S,T]:[e+(w-e)*a,n+(S-n)*a,r+(T-r)*a]},normalizeSourceType:function(e){return["original","negative","positive"].includes(e)?e:"original"},normalizeInversionMode:function(e){return["linear","log"].includes(e)?e:"linear"},getLUT3DSamplingGLSL:function(){return"\n// 3D LUT \u91c7\u6837 (\u4e0e CPU \u7248\u672c\u4e00\u81f4)\n// \u7eb9\u7406\u5e03\u5c40: X = R, Y = G + B*size\nvec3 sampleLUT3D(vec3 c) {\n  int size = u_lutSize;\n  float sz = float(size);\n  \n  // \u6620\u5c04\u5230 [0..size-1]\n  float rf = c.r * (sz - 1.0);\n  float gf = c.g * (sz - 1.0);\n  float bf = c.b * (sz - 1.0);\n\n  float r0 = floor(rf);\n  float g0 = floor(gf);\n  float b0 = floor(bf);\n  float r1 = min(sz - 1.0, r0 + 1.0);\n  float g1 = min(sz - 1.0, g0 + 1.0);\n  float b1 = min(sz - 1.0, b0 + 1.0);\n\n  // \u91c7\u6837 8 \u4e2a\u89d2\u70b9\n  vec3 c000, c100, c010, c110, c001, c101, c011, c111;\n  vec2 uv;\n\n  // UV \u8ba1\u7b97: x = (r + 0.5) / size, y = (g + b*size + 0.5) / (size*size)\n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g0 + b0 * sz + 0.5) / (sz * sz);\n  c000 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g0 + b0 * sz + 0.5) / (sz * sz);\n  c100 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g1 + b0 * sz + 0.5) / (sz * sz);\n  c010 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g1 + b0 * sz + 0.5) / (sz * sz);\n  c110 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g0 + b1 * sz + 0.5) / (sz * sz);\n  c001 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g0 + b1 * sz + 0.5) / (sz * sz);\n  c101 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r0 + 0.5) / sz;\n  uv.y = (g1 + b1 * sz + 0.5) / (sz * sz);\n  c011 = texture2D(u_lut3d, uv).rgb;\n\n  uv.x = (r1 + 0.5) / sz;\n  uv.y = (g1 + b1 * sz + 0.5) / (sz * sz);\n  c111 = texture2D(u_lut3d, uv).rgb;\n\n  // \u4e09\u7ebf\u6027\u63d2\u503c\n  float fr = rf - r0;\n  float fg = gf - g0;\n  float fb = bf - b0;\n\n  vec3 c00 = mix(c000, c100, fr);\n  vec3 c10 = mix(c010, c110, fr);\n  vec3 c01 = mix(c001, c101, fr);\n  vec3 c11 = mix(c011, c111, fr);\n\n  vec3 c0 = mix(c00, c10, fg);\n  vec3 c1 = mix(c01, c11, fg);\n\n  return mix(c0, c1, fb);\n}\n\n// \u5e26\u5f3a\u5ea6\u7684 LUT \u91c7\u6837\nvec3 sampleLUT3DWithIntensity(vec3 c, float intensity) {\n  if (intensity <= 0.0) return c;\n  vec3 lutColor = sampleLUT3D(c);\n  return mix(c, lutColor, intensity);\n}\n"}}},7950:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8085:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});const r=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu},8093:function(e,t,n){"use strict";n.d(t,{ge:function(){return i},xU:function(){return r}});const r=()=>({x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}),i=()=>({x:{min:0,max:0},y:{min:0,max:0}})},8123:function(e,t,n){"use strict";n.d(t,{B:function(){return l}});var r=n(217),i=n(708),a=n(5330),o=n(8436);const s={...i.ai,transform:e=>Math.round((e=>(0,r.q)(0,255,e))(e))},l={test:(0,o.$)("rgb","red"),parse:(0,o.q)("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:r=1})=>"rgba("+s.transform(e)+", "+s.transform(t)+", "+s.transform(n)+", "+(0,a.a)(i.X4.transform(r))+")"}},8184:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var r=n(3255),i=n(5603),a=n(2598),o=n(5043);function s(e={}){let{autoFocus:t=!1,isTextInput:n,within:s}=e,l=(0,o.useRef)({isFocused:!1,isFocusVisible:t||(0,i.pP)()}),[c,u]=(0,o.useState)(!1),[d,h]=(0,o.useState)(()=>l.current.isFocused&&l.current.isFocusVisible),p=(0,o.useCallback)(()=>h(l.current.isFocused&&l.current.isFocusVisible),[]),f=(0,o.useCallback)(e=>{l.current.isFocused=e,u(e),p()},[p]);(0,i.K7)(e=>{l.current.isFocusVisible=e,p()},[],{isTextInput:n});let{focusProps:m}=(0,r.i)({isDisabled:s,onFocusChange:f}),{focusWithinProps:g}=(0,a.R)({isDisabled:!s,onFocusWithinChange:f});return{isFocused:c,isFocusVisible:d,focusProps:s?g:m}}},8210:function(e,t,n){var r;!function(){"use strict";var i,a=1e9,o={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},s=!0,l="[DecimalError] ",c=l+"Invalid argument: ",u=l+"Exponent out of range: ",d=Math.floor,h=Math.pow,p=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,f=1e7,m=9007199254740991,g=d(1286742750677284.5),v={};function A(e,t){var n,r,i,a,o,l,c,u,d=e.constructor,h=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),s?E(t,h):t;if(c=e.d,u=t.d,o=e.e,i=t.e,c=c.slice(),a=o-i){for(a<0?(r=c,a=-a,l=u.length):(r=u,i=o,l=c.length),a>(l=(o=Math.ceil(h/7))>l?o+1:l+1)&&(a=l,r.length=1),r.reverse();a--;)r.push(0);r.reverse()}for((l=c.length)-(a=u.length)<0&&(a=l,r=u,u=c,c=r),n=0;a;)n=(c[--a]=c[a]+u[a]+n)/f|0,c[a]%=f;for(n&&(c.unshift(n),++i),l=c.length;0==c[--l];)c.pop();return t.d=c,t.e=i,s?E(t,h):t}function y(e,t,n){if(e!==~~e||e<t||e>n)throw Error(c+e)}function b(e){var t,n,r,i=e.length-1,a="",o=e[0];if(i>0){for(a+=o,t=1;t<i;t++)(n=7-(r=e[t]+"").length)&&(a+=T(n)),a+=r;(n=7-(r=(o=e[t])+"").length)&&(a+=T(n))}else if(0===o)return"0";for(;o%10===0;)o/=10;return a+o}v.absoluteValue=v.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},v.comparedTo=v.cmp=function(e){var t,n,r,i,a=this;if(e=new a.constructor(e),a.s!==e.s)return a.s||-e.s;if(a.e!==e.e)return a.e>e.e^a.s<0?1:-1;for(t=0,n=(r=a.d.length)<(i=e.d.length)?r:i;t<n;++t)if(a.d[t]!==e.d[t])return a.d[t]>e.d[t]^a.s<0?1:-1;return r===i?0:r>i^a.s<0?1:-1},v.decimalPlaces=v.dp=function(){var e=this,t=e.d.length-1,n=7*(t-e.e);if(t=e.d[t])for(;t%10==0;t/=10)n--;return n<0?0:n},v.dividedBy=v.div=function(e){return x(this,new this.constructor(e))},v.dividedToIntegerBy=v.idiv=function(e){var t=this.constructor;return E(x(this,new t(e),0,1),t.precision)},v.equals=v.eq=function(e){return!this.cmp(e)},v.exponent=function(){return w(this)},v.greaterThan=v.gt=function(e){return this.cmp(e)>0},v.greaterThanOrEqualTo=v.gte=function(e){return this.cmp(e)>=0},v.isInteger=v.isint=function(){return this.e>this.d.length-2},v.isNegative=v.isneg=function(){return this.s<0},v.isPositive=v.ispos=function(){return this.s>0},v.isZero=function(){return 0===this.s},v.lessThan=v.lt=function(e){return this.cmp(e)<0},v.lessThanOrEqualTo=v.lte=function(e){return this.cmp(e)<1},v.logarithm=v.log=function(e){var t,n=this,r=n.constructor,a=r.precision,o=a+5;if(void 0===e)e=new r(10);else if((e=new r(e)).s<1||e.eq(i))throw Error(l+"NaN");if(n.s<1)throw Error(l+(n.s?"NaN":"-Infinity"));return n.eq(i)?new r(0):(s=!1,t=x(C(n,o),C(e,o),o),s=!0,E(t,a))},v.minus=v.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?P(t,e):A(t,(e.s=-e.s,e))},v.modulo=v.mod=function(e){var t,n=this,r=n.constructor,i=r.precision;if(!(e=new r(e)).s)throw Error(l+"NaN");return n.s?(s=!1,t=x(n,e,0,1).times(e),s=!0,n.minus(t)):E(new r(n),i)},v.naturalExponential=v.exp=function(){return _(this)},v.naturalLogarithm=v.ln=function(){return C(this)},v.negated=v.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},v.plus=v.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?A(t,e):P(t,(e.s=-e.s,e))},v.precision=v.sd=function(e){var t,n,r,i=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(c+e);if(t=w(i)+1,n=7*(r=i.d.length-1)+1,r=i.d[r]){for(;r%10==0;r/=10)n--;for(r=i.d[0];r>=10;r/=10)n++}return e&&t>n?t:n},v.squareRoot=v.sqrt=function(){var e,t,n,r,i,a,o,c=this,u=c.constructor;if(c.s<1){if(!c.s)return new u(0);throw Error(l+"NaN")}for(e=w(c),s=!1,0==(i=Math.sqrt(+c))||i==1/0?(((t=b(c.d)).length+e)%2==0&&(t+="0"),i=Math.sqrt(t),e=d((e+1)/2)-(e<0||e%2),r=new u(t=i==1/0?"5e"+e:(t=i.toExponential()).slice(0,t.indexOf("e")+1)+e)):r=new u(i.toString()),i=o=(n=u.precision)+3;;)if(r=(a=r).plus(x(c,a,o+2)).times(.5),b(a.d).slice(0,o)===(t=b(r.d)).slice(0,o)){if(t=t.slice(o-3,o+1),i==o&&"4999"==t){if(E(a,n+1,0),a.times(a).eq(c)){r=a;break}}else if("9999"!=t)break;o+=4}return s=!0,E(r,n)},v.times=v.mul=function(e){var t,n,r,i,a,o,l,c,u,d=this,h=d.constructor,p=d.d,m=(e=new h(e)).d;if(!d.s||!e.s)return new h(0);for(e.s*=d.s,n=d.e+e.e,(c=p.length)<(u=m.length)&&(a=p,p=m,m=a,o=c,c=u,u=o),a=[],r=o=c+u;r--;)a.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)l=a[i]+m[r]*p[i-r-1]+t,a[i--]=l%f|0,t=l/f|0;a[i]=(a[i]+t)%f|0}for(;!a[--o];)a.pop();return t?++n:a.shift(),e.d=a,e.e=n,s?E(e,h.precision):e},v.toDecimalPlaces=v.todp=function(e,t){var n=this,r=n.constructor;return n=new r(n),void 0===e?n:(y(e,0,a),void 0===t?t=r.rounding:y(t,0,8),E(n,e+w(n)+1,t))},v.toExponential=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=N(r,!0):(y(e,0,a),void 0===t?t=i.rounding:y(t,0,8),n=N(r=E(new i(r),e+1,t),!0,e+1)),n},v.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return void 0===e?N(i):(y(e,0,a),void 0===t?t=o.rounding:y(t,0,8),n=N((r=E(new o(i),e+w(i)+1,t)).abs(),!1,e+w(r)+1),i.isneg()&&!i.isZero()?"-"+n:n)},v.toInteger=v.toint=function(){var e=this,t=e.constructor;return E(new t(e),w(e)+1,t.rounding)},v.toNumber=function(){return+this},v.toPower=v.pow=function(e){var t,n,r,a,o,c,u=this,h=u.constructor,p=+(e=new h(e));if(!e.s)return new h(i);if(!(u=new h(u)).s){if(e.s<1)throw Error(l+"Infinity");return u}if(u.eq(i))return u;if(r=h.precision,e.eq(i))return E(u,r);if(c=(t=e.e)>=(n=e.d.length-1),o=u.s,c){if((n=p<0?-p:p)<=m){for(a=new h(i),t=Math.ceil(r/7+4),s=!1;n%2&&k((a=a.times(u)).d,t),0!==(n=d(n/2));)k((u=u.times(u)).d,t);return s=!0,e.s<0?new h(i).div(a):E(a,r)}}else if(o<0)throw Error(l+"NaN");return o=o<0&&1&e.d[Math.max(t,n)]?-1:1,u.s=1,s=!1,a=e.times(C(u,r+12)),s=!0,(a=_(a)).s=o,a},v.toPrecision=function(e,t){var n,r,i=this,o=i.constructor;return void 0===e?r=N(i,(n=w(i))<=o.toExpNeg||n>=o.toExpPos):(y(e,1,a),void 0===t?t=o.rounding:y(t,0,8),r=N(i=E(new o(i),e,t),e<=(n=w(i))||n<=o.toExpNeg,e)),r},v.toSignificantDigits=v.tosd=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(y(e,1,a),void 0===t?t=n.rounding:y(t,0,8)),E(new n(this),e,t)},v.toString=v.valueOf=v.val=v.toJSON=function(){var e=this,t=w(e),n=e.constructor;return N(e,t<=n.toExpNeg||t>=n.toExpPos)};var x=function(){function e(e,t){var n,r=0,i=e.length;for(e=e.slice();i--;)n=e[i]*t+r,e[i]=n%f|0,r=n/f|0;return r&&e.unshift(r),e}function t(e,t,n,r){var i,a;if(n!=r)a=n>r?1:-1;else for(i=a=0;i<n;i++)if(e[i]!=t[i]){a=e[i]>t[i]?1:-1;break}return a}function n(e,t,n){for(var r=0;n--;)e[n]-=r,r=e[n]<t[n]?1:0,e[n]=r*f+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(r,i,a,o){var s,c,u,d,h,p,m,g,v,A,y,b,x,_,S,T,C,M,P=r.constructor,N=r.s==i.s?1:-1,k=r.d,R=i.d;if(!r.s)return new P(r);if(!i.s)throw Error(l+"Division by zero");for(c=r.e-i.e,C=R.length,S=k.length,g=(m=new P(N)).d=[],u=0;R[u]==(k[u]||0);)++u;if(R[u]>(k[u]||0)&&--c,(b=null==a?a=P.precision:o?a+(w(r)-w(i))+1:a)<0)return new P(0);if(b=b/7+2|0,u=0,1==C)for(d=0,R=R[0],b++;(u<S||d)&&b--;u++)x=d*f+(k[u]||0),g[u]=x/R|0,d=x%R|0;else{for((d=f/(R[0]+1)|0)>1&&(R=e(R,d),k=e(k,d),C=R.length,S=k.length),_=C,A=(v=k.slice(0,C)).length;A<C;)v[A++]=0;(M=R.slice()).unshift(0),T=R[0],R[1]>=f/2&&++T;do{d=0,(s=t(R,v,C,A))<0?(y=v[0],C!=A&&(y=y*f+(v[1]||0)),(d=y/T|0)>1?(d>=f&&(d=f-1),1==(s=t(h=e(R,d),v,p=h.length,A=v.length))&&(d--,n(h,C<p?M:R,p))):(0==d&&(s=d=1),h=R.slice()),(p=h.length)<A&&h.unshift(0),n(v,h,A),-1==s&&(s=t(R,v,C,A=v.length))<1&&(d++,n(v,C<A?M:R,A)),A=v.length):0===s&&(d++,v=[0]),g[u++]=d,s&&v[0]?v[A++]=k[_]||0:(v=[k[_]],A=1)}while((_++<S||void 0!==v[0])&&b--)}return g[0]||g.shift(),m.e=c,E(m,o?a+w(m)+1:a)}}();function _(e,t){var n,r,a,o,l,c=0,d=0,p=e.constructor,f=p.precision;if(w(e)>16)throw Error(u+w(e));if(!e.s)return new p(i);for(null==t?(s=!1,l=f):l=t,o=new p(.03125);e.abs().gte(.1);)e=e.times(o),d+=5;for(l+=Math.log(h(2,d))/Math.LN10*2+5|0,n=r=a=new p(i),p.precision=l;;){if(r=E(r.times(e),l),n=n.times(++c),b((o=a.plus(x(r,n,l))).d).slice(0,l)===b(a.d).slice(0,l)){for(;d--;)a=E(a.times(a),l);return p.precision=f,null==t?(s=!0,E(a,f)):a}a=o}}function w(e){for(var t=7*e.e,n=e.d[0];n>=10;n/=10)t++;return t}function S(e,t,n){if(t>e.LN10.sd())throw s=!0,n&&(e.precision=n),Error(l+"LN10 precision limit exceeded");return E(new e(e.LN10),t)}function T(e){for(var t="";e--;)t+="0";return t}function C(e,t){var n,r,a,o,c,u,d,h,p,f=1,m=e,g=m.d,v=m.constructor,A=v.precision;if(m.s<1)throw Error(l+(m.s?"NaN":"-Infinity"));if(m.eq(i))return new v(0);if(null==t?(s=!1,h=A):h=t,m.eq(10))return null==t&&(s=!0),S(v,h);if(h+=10,v.precision=h,r=(n=b(g)).charAt(0),o=w(m),!(Math.abs(o)<15e14))return d=S(v,h+2,A).times(o+""),m=C(new v(r+"."+n.slice(1)),h-10).plus(d),v.precision=A,null==t?(s=!0,E(m,A)):m;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=b((m=m.times(e)).d)).charAt(0),f++;for(o=w(m),r>1?(m=new v("0."+n),o++):m=new v(r+"."+n.slice(1)),u=c=m=x(m.minus(i),m.plus(i),h),p=E(m.times(m),h),a=3;;){if(c=E(c.times(p),h),b((d=u.plus(x(c,new v(a),h))).d).slice(0,h)===b(u.d).slice(0,h))return u=u.times(2),0!==o&&(u=u.plus(S(v,h+2,A).times(o+""))),u=x(u,new v(f),h),v.precision=A,null==t?(s=!0,E(u,A)):u;u=d,a+=2}}function M(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);)++r;for(i=t.length;48===t.charCodeAt(i-1);)--i;if(t=t.slice(r,i)){if(i-=r,n=n-r-1,e.e=d(n/7),e.d=[],r=(n+1)%7,n<0&&(r+=7),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=7;r<i;)e.d.push(+t.slice(r,r+=7));r=7-(t=t.slice(r)).length}else r-=i;for(;r--;)t+="0";if(e.d.push(+t),s&&(e.e>g||e.e<-g))throw Error(u+n)}else e.s=0,e.e=0,e.d=[0];return e}function E(e,t,n){var r,i,a,o,l,c,p,m,v=e.d;for(o=1,a=v[0];a>=10;a/=10)o++;if((r=t-o)<0)r+=7,i=t,p=v[m=0];else{if((m=Math.ceil((r+1)/7))>=(a=v.length))return e;for(p=a=v[m],o=1;a>=10;a/=10)o++;i=(r%=7)-7+o}if(void 0!==n&&(l=p/(a=h(10,o-i-1))%10|0,c=t<0||void 0!==v[m+1]||p%a,c=n<4?(l||c)&&(0==n||n==(e.s<0?3:2)):l>5||5==l&&(4==n||c||6==n&&(r>0?i>0?p/h(10,o-i):0:v[m-1])%10&1||n==(e.s<0?8:7))),t<1||!v[0])return c?(a=w(e),v.length=1,t=t-a-1,v[0]=h(10,(7-t%7)%7),e.e=d(-t/7)||0):(v.length=1,v[0]=e.e=e.s=0),e;if(0==r?(v.length=m,a=1,m--):(v.length=m+1,a=h(10,7-r),v[m]=i>0?(p/h(10,o-i)%h(10,i)|0)*a:0),c)for(;;){if(0==m){(v[0]+=a)==f&&(v[0]=1,++e.e);break}if(v[m]+=a,v[m]!=f)break;v[m--]=0,a=1}for(r=v.length;0===v[--r];)v.pop();if(s&&(e.e>g||e.e<-g))throw Error(u+w(e));return e}function P(e,t){var n,r,i,a,o,l,c,u,d,h,p=e.constructor,m=p.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new p(e),s?E(t,m):t;if(c=e.d,h=t.d,r=t.e,u=e.e,c=c.slice(),o=u-r){for((d=o<0)?(n=c,o=-o,l=h.length):(n=h,r=u,l=c.length),o>(i=Math.max(Math.ceil(m/7),l)+2)&&(o=i,n.length=1),n.reverse(),i=o;i--;)n.push(0);n.reverse()}else{for((d=(i=c.length)<(l=h.length))&&(l=i),i=0;i<l;i++)if(c[i]!=h[i]){d=c[i]<h[i];break}o=0}for(d&&(n=c,c=h,h=n,t.s=-t.s),l=c.length,i=h.length-l;i>0;--i)c[l++]=0;for(i=h.length;i>o;){if(c[--i]<h[i]){for(a=i;a&&0===c[--a];)c[a]=f-1;--c[a],c[i]+=f}c[i]-=h[i]}for(;0===c[--l];)c.pop();for(;0===c[0];c.shift())--r;return c[0]?(t.d=c,t.e=r,s?E(t,m):t):new p(0)}function N(e,t,n){var r,i=w(e),a=b(e.d),o=a.length;return t?(n&&(r=n-o)>0?a=a.charAt(0)+"."+a.slice(1)+T(r):o>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(i<0?"e":"e+")+i):i<0?(a="0."+T(-i-1)+a,n&&(r=n-o)>0&&(a+=T(r))):i>=o?(a+=T(i+1-o),n&&(r=n-i-1)>0&&(a=a+"."+T(r))):((r=i+1)<o&&(a=a.slice(0,r)+"."+a.slice(r)),n&&(r=n-o)>0&&(i+1===o&&(a+="."),a+=T(r))),e.s<0?"-"+a:a}function k(e,t){if(e.length>t)return e.length=t,!0}function R(e){if(!e||"object"!==typeof e)throw Error(l+"Object expected");var t,n,r,i=["precision",1,a,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<i.length;t+=3)if(void 0!==(r=e[n=i[t]])){if(!(d(r)===r&&r>=i[t+1]&&r<=i[t+2]))throw Error(c+n+": "+r);this[n]=r}if(void 0!==(r=e[n="LN10"])){if(r!=Math.LN10)throw Error(c+n+": "+r);this[n]=new this(r)}return this}o=function e(t){var n,r,i;function a(e){var t=this;if(!(t instanceof a))return new a(e);if(t.constructor=a,e instanceof a)return t.s=e.s,t.e=e.e,void(t.d=(e=e.d)?e.slice():e);if("number"===typeof e){if(0*e!==0)throw Error(c+e);if(e>0)t.s=1;else{if(!(e<0))return t.s=0,t.e=0,void(t.d=[0]);e=-e,t.s=-1}return e===~~e&&e<1e7?(t.e=0,void(t.d=[e])):M(t,e.toString())}if("string"!==typeof e)throw Error(c+e);if(45===e.charCodeAt(0)?(e=e.slice(1),t.s=-1):t.s=1,!p.test(e))throw Error(c+e);M(t,e)}if(a.prototype=v,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=e,a.config=a.set=R,void 0===t&&(t={}),t)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<i.length;)t.hasOwnProperty(r=i[n++])||(t[r]=this[r]);return a.config(t),a}(o),o.default=o.Decimal=o,i=new o(1),void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},8225:function(e,t,n){"use strict";n.d(t,{o:function(){return o}});var r=n(9075),i=n(5043),a=n(1389);function o(e,t,n){let o,{type:s}=e,{isOpen:l}=t;(0,i.useEffect)(()=>{n&&n.current&&r.a.set(n.current,t.close)}),"menu"===s?o=!0:"listbox"===s&&(o="listbox");let c=(0,a.Bi)();return{triggerProps:{"aria-haspopup":o,"aria-expanded":l,"aria-controls":l?c:void 0,onPress:t.toggle},overlayProps:{id:c}}}},8240:function(e,t,n){"use strict";var r;n.d(t,{B2:function(){return u},Cz:function(){return s},FH:function(){return l},Fb:function(){return h},Go:function(){return f},Nr:function(){return p},getApiBase:function(){return a},gl:function(){return d},jsonFetch:function(){return c},tE:function(){return i}});const i="undefined"!==typeof window&&null!==(r=window.__electron)&&void 0!==r&&r.API_BASE?window.__electron.API_BASE:{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE||"http://127.0.0.1:4000";function a(){var e;return"undefined"!==typeof window&&null!==(e=window.__electron)&&void 0!==e&&e.API_BASE?window.__electron.API_BASE:i}let o=(()=>{try{return parseInt(sessionStorage.getItem("__fg_cb")||"0",10)||0}catch{return 0}})();function s(){o=Date.now();try{sessionStorage.setItem("__fg_cb",String(o))}catch{}return window.dispatchEvent(new CustomEvent("fg-cache-bust",{detail:o})),o}function l(e){const t=a();if(!e)return null;let n;if(e.startsWith("http://")||e.startsWith("https://"))n=e;else if(e.startsWith("/"))n=`${t}${e}`;else{const r=e.toLowerCase().indexOf("uploads");if(-1!==r){n=`${t}/${e.slice(r).replace(/\\/g,"/").replace(/^\/+/,"")}`}else if(-1!==e.indexOf("\\")||/^([a-zA-Z]:\\)/.test(e)){const r=e.split(/[/\\]+/);n=`${t}/uploads/${r[r.length-1]}`}else n=`${t}/uploads/${e.replace(/^\/+/,"")}`}if(o>0){const e=n.includes("?")?"&":"?";n+=`${e}_cb=${o}`}return n}async function c(e,t={}){const n=a(),r=await fetch(`${n}${e}`,t),i=await r.text();try{return JSON.parse(i)}catch{return i}}async function u(e,t){return c(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async function d(e,t){return c(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async function h(e){return c(e,{method:"DELETE"})}function p(e,t,n,r={}){var a;const{timeout:o=3e5}=r,s="undefined"!==typeof window&&null!==(a=window.__electron)&&void 0!==a&&a.API_BASE?window.__electron.API_BASE:i;return new Promise((r,i)=>{const a=new XMLHttpRequest;a.open("POST",`${s}${e}`),a.timeout=o,a.onload=()=>{if(a.status>=200&&a.status<300)try{r(JSON.parse(a.responseText))}catch(e){r(a.responseText)}else{const e=a.statusText||`HTTP ${a.status}`;console.error("[Upload] Failed:",a.status,a.responseText),i(new Error(e))}},a.onerror=()=>{console.error("[Upload] Network error - API_BASE:",s,"URL:",e),i(new Error("Network error: Failed to connect to server"))},a.ontimeout=()=>{console.error("[Upload] Timeout - API_BASE:",s,"URL:",e),i(new Error("Upload timeout: Request took too long"))},a.upload&&n&&(a.upload.onprogress=e=>{e.lengthComputable&&n(Math.round(e.loaded/e.total*100))}),a.send(t)})}function f(e){if(!e||"object"!==typeof e)return"";const t=new Set(["client","queryKey","signal","meta","pageParam","direction"]),n=new URLSearchParams;for(const[i,a]of Object.entries(e))t.has(i)||void 0!==a&&null!==a&&""!==a&&n.append(i,a);const r=n.toString();return r?`?${r}`:""}},8249:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg=="},8268:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(2132);t.isMatch=function(e,t){return r.isMatchWith(e,t,()=>{})}},8294:function(e,t,n){"use strict";n.d(t,{A:function(){return d}});var r=n(5043),i=n(8624),a=n(579);function o({value:e,onChange:t,onCoordinatesAvailable:n}){const[o,s]=(0,r.useState)([]),[l,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),f=(0,r.useRef)(!0),m=(0,r.useRef)({country:"",city:""});(0,r.useEffect)(()=>{(0,i.X6)().then(e=>{const t=(Array.isArray(e)?e:[]).sort((e,t)=>(e.country_name||"").localeCompare(t.country_name||""));s(t)}).catch(e=>{console.error("Failed to load countries:",e),s([])})},[]),(0,r.useEffect)(()=>{if(!u.trim())return void c([]);const e=o.find(e=>{var t,n;return(null===(t=e.country_name)||void 0===t?void 0:t.toLowerCase())===u.toLowerCase()||(null===(n=e.country_code)||void 0===n?void 0:n.toLowerCase())===u.toLowerCase()});e?(0,i.Vs)({country:e.country_code,hasRecords:!1}).then(t=>{console.log("[LocationInput] Loaded cities for",e.country_code,":",(null===t||void 0===t?void 0:t.length)||0,"cities"),c(Array.isArray(t)?t:[])}).catch(e=>{console.error("[LocationInput] Failed to load cities:",e),c([])}):c([])},[u,o]),(0,r.useEffect)(()=>{const t=(null===e||void 0===e?void 0:e.country_name)||"",n=(null===e||void 0===e?void 0:e.city_name)||"";d(t),p(n),m.current={country:t,city:n},setTimeout(()=>{f.current=!1},100)},[null===e||void 0===e?void 0:e.country_name,null===e||void 0===e?void 0:e.city_name]),(0,r.useEffect)(()=>{if(console.log("[LocationInput] Checking coords - cityInput:",h,"cities.length:",l.length),!h.trim()||0===l.length)return;const e=l.find(e=>{var t;return(null===(t=e.city_name)||void 0===t?void 0:t.toLowerCase())===h.toLowerCase()});console.log("[LocationInput] cityMatch:",e),e&&null!=e.city_lat&&null!=e.city_lng?(console.log("[LocationInput] Calling onCoordinatesAvailable with:",e.city_lat,e.city_lng),null===n||void 0===n||n({lat:e.city_lat,lng:e.city_lng})):null===n||void 0===n||n(null)},[l,h,n]);const g=(0,r.useCallback)((e,r)=>{if(f.current)return;if(e===m.current.country&&r===m.current.city)return;if(m.current={country:e,city:r},!r.trim())return null===t||void 0===t||t(null),void(null===n||void 0===n||n(null));const i=o.find(t=>{var n,r;return(null===(n=t.country_name)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()||(null===(r=t.country_code)||void 0===r?void 0:r.toLowerCase())===e.toLowerCase()}),a=l.find(e=>{var t;return(null===(t=e.city_name)||void 0===t?void 0:t.toLowerCase())===r.toLowerCase()});if(a&&i){const e=null!=a.city_lat&&null!=a.city_lng?{lat:a.city_lat,lng:a.city_lng}:null;null===n||void 0===n||n(e),null===t||void 0===t||t({location_id:a.id,country_code:i.country_code,country_name:i.country_name,city_name:a.city_name})}else null===n||void 0===n||n(null),null===t||void 0===t||t({location_id:null,country_code:null,country_name:e||null,city_name:r})},[o,l,t,n]),v=(0,r.useCallback)(e=>{const t=e.target.value;d(t)},[]),A=(0,r.useCallback)(()=>{const e=u.trim(),t=h.trim();e!==m.current.country&&t?g(e,t):m.current.country=e},[u,h,g]),y=(0,r.useCallback)(e=>{const t=e.target.value;p(t);if(l.find(e=>{var n;return(null===(n=e.city_name)||void 0===n?void 0:n.toLowerCase())===t.toLowerCase()})){const e=u.trim();g(e,t)}},[l,u,g]),b=(0,r.useCallback)(()=>{const e=u.trim(),t=h.trim();e===m.current.country&&t===m.current.city||t&&g(e,t)},[u,h,g]),x=o.filter(e=>{var t;return null===(t=e.country_name)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase())}).slice(0,100),_=l.filter(e=>{var t;return null===(t=e.city_name)||void 0===t?void 0:t.toLowerCase().includes(h.toLowerCase())}).slice(0,100);return(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{className:"fg-input",list:"location-country-list",value:u,onChange:v,onBlur:A,placeholder:"Country",autoComplete:"off",style:{width:"100%",boxSizing:"border-box"}}),(0,a.jsx)("datalist",{id:"location-country-list",children:x.map(e=>(0,a.jsx)("option",{value:e.country_name},e.country_code))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{className:"fg-input",list:"location-city-list",value:h,onChange:y,onBlur:b,placeholder:"City",autoComplete:"off",style:{width:"100%",boxSizing:"border-box"}}),(0,a.jsx)("datalist",{id:"location-city-list",children:_.map(e=>(0,a.jsx)("option",{value:e.city_name},e.id))})]})]})}var s=n(6898),l=n(775);n(1997),n(1972);const c={caption:["caption"],tags:["tags"],time:["date_taken","time_taken"],equipment:["camera","lens","camera_equip_id","lens_equip_id","photographer"],params:["aperture","shutter_speed","iso","focal_length"],location:["location_id","country","city","detail_location","latitude","longitude"],scanning:["scanner_equip_id","scan_resolution","scan_software","scan_lab","scan_date","scan_cost","scan_notes"]},u=Object.values(c).flat();function d({photo:e,photos:t,roll:n,onClose:d,onSaved:h}){const p=Array.isArray(t)&&t.length>1,f=e||(p?t[0]:null),[m,g]=(0,r.useState)(new Set),[v,A]=(0,r.useState)((null===f||void 0===f?void 0:f.date_taken)||""),[y,b]=(0,r.useState)((null===f||void 0===f?void 0:f.time_taken)||""),[x,_]=(0,r.useState)((null===f||void 0===f?void 0:f.camera)||(null===n||void 0===n?void 0:n.camera)||""),[w,S]=(0,r.useState)((null===f||void 0===f?void 0:f.lens)||(null===n||void 0===n?void 0:n.lens)||""),[T,C]=(0,r.useState)((null===f||void 0===f?void 0:f.camera_equip_id)||(null===n||void 0===n?void 0:n.camera_equip_id)||null),[M,E]=(0,r.useState)((null===f||void 0===f?void 0:f.lens_equip_id)||(null===n||void 0===n?void 0:n.lens_equip_id)||null),[P,N]=(0,r.useState)(null),[k,R]=(0,r.useState)((null===f||void 0===f?void 0:f.photographer)||(null===n||void 0===n?void 0:n.photographer)||""),[L,O]=(0,r.useState)(null!=(null===f||void 0===f?void 0:f.aperture)?f.aperture:""),[j,D]=(0,r.useState)((null===f||void 0===f?void 0:f.shutter_speed)||""),[I,B]=(0,r.useState)(null!=(null===f||void 0===f?void 0:f.iso)?f.iso:""),[F,z]=(0,r.useState)(null!=(null===f||void 0===f?void 0:f.focal_length)?f.focal_length:""),[U,V]=(0,r.useState)((null===f||void 0===f?void 0:f.detail_location)||""),[G,q]=(0,r.useState)({location_id:(null===f||void 0===f?void 0:f.location_id)||null,country_name:(null===f||void 0===f?void 0:f.country_name)||null,city_name:(null===f||void 0===f?void 0:f.city_name)||null,latitude:null===f||void 0===f?void 0:f.latitude,longitude:null===f||void 0===f?void 0:f.longitude}),[W,H]=(0,r.useState)(null),[$,K]=(0,r.useState)((null===f||void 0===f?void 0:f.scanner_equip_id)||(null===n||void 0===n?void 0:n.scanner_equip_id)||null),[X,Y]=(0,r.useState)((null===f||void 0===f?void 0:f.scan_resolution)||(null===n||void 0===n?void 0:n.scan_resolution)||""),[Q,Z]=(0,r.useState)((null===f||void 0===f?void 0:f.scan_software)||(null===n||void 0===n?void 0:n.scan_software)||""),[J,ee]=(0,r.useState)((null===f||void 0===f?void 0:f.scan_lab)||(null===n||void 0===n?void 0:n.scan_lab)||""),[te,ne]=(0,r.useState)((null===f||void 0===f?void 0:f.scan_date)||(null===n||void 0===n?void 0:n.scan_date)||""),[re,ie]=(0,r.useState)((null===f||void 0===f?void 0:f.scan_cost)||(null===n||void 0===n?void 0:n.scan_cost)||""),[ae,oe]=(0,r.useState)((null===f||void 0===f?void 0:f.scan_notes)||(null===n||void 0===n?void 0:n.scan_notes)||""),[se,le]=(0,r.useState)((null===f||void 0===f?void 0:f.caption)||""),[ce,ue]=(0,r.useState)(null!==f&&void 0!==f&&f.tags?f.tags.map(e=>e.name||e):[]),[de,he]=(0,r.useState)(""),[pe,fe]=(0,r.useState)([]),[me,ge]=(0,r.useState)({cameras:[],lenses:[],photographers:[]});(0,r.useEffect)(()=>{(0,i.ET)().then(e=>ge(e||{cameras:[],lenses:[],photographers:[]})).catch(e=>console.error("Failed to load metadata options",e)),(0,i.Q2)().then(e=>fe(e||[])).catch(e=>console.error("Failed to load tags",e))},[]),(0,r.useEffect)(()=>{f&&(g(new Set),A(f.date_taken||""),b(f.time_taken||""),_(f.camera||(null===n||void 0===n?void 0:n.camera)||""),S(f.lens||(null===n||void 0===n?void 0:n.lens)||""),C(f.camera_equip_id||(null===n||void 0===n?void 0:n.camera_equip_id)||null),E(f.lens_equip_id||(null===n||void 0===n?void 0:n.lens_equip_id)||null),R(f.photographer||(null===n||void 0===n?void 0:n.photographer)||""),O(null!=f.aperture?f.aperture:""),D(f.shutter_speed||""),B(null!=f.iso?f.iso:""),z(null!=f.focal_length?f.focal_length:""),V(f.detail_location||""),q({location_id:f.location_id||null,country_name:f.country_name||null,city_name:f.city_name||null,latitude:f.latitude,longitude:f.longitude}),K(f.scanner_equip_id||(null===n||void 0===n?void 0:n.scanner_equip_id)||null),Y(f.scan_resolution||(null===n||void 0===n?void 0:n.scan_resolution)||""),Z(f.scan_software||(null===n||void 0===n?void 0:n.scan_software)||""),ee(f.scan_lab||(null===n||void 0===n?void 0:n.scan_lab)||""),ne(f.scan_date||(null===n||void 0===n?void 0:n.scan_date)||""),ie(f.scan_cost||(null===n||void 0===n?void 0:n.scan_cost)||""),oe(f.scan_notes||(null===n||void 0===n?void 0:n.scan_notes)||""),le(f.caption||""),ue(f.tags?f.tags.map(e=>e.name||e):[]),he(""))},[f,n]);const ve=e=>{const t=Array.isArray(e)?e:[e];g(e=>{const n=new Set(e);return t.forEach(e=>n.add(e)),n})},Ae=e=>{const t=c[e];return!!t&&t.some(e=>m.has(e))},ye=m.size>0;async function be(n=null){const r={};if((n?c[n]:u).forEach(e=>{m.has(e)&&(r[e]=(e=>{var t,n;switch(e){case"caption":return se||null;case"tags":return ce;case"date_taken":return v||null;case"time_taken":return y||null;case"location_id":return G.location_id||null;case"country":return G.country_name||null;case"city":return G.city_name||null;case"detail_location":return U||null;case"latitude":return null!==(t=G.latitude)&&void 0!==t?t:null;case"longitude":return null!==(n=G.longitude)&&void 0!==n?n:null;case"camera":return x||null;case"lens":return w||null;case"camera_equip_id":return T||null;case"lens_equip_id":return M||null;case"photographer":return k||null;case"aperture":return""!==L?parseFloat(L):null;case"shutter_speed":return j||null;case"iso":return""!==I?parseInt(I):null;case"focal_length":return""!==F?parseFloat(F):null;case"scanner_equip_id":return $||null;case"scan_resolution":return X||null;case"scan_software":return Q||null;case"scan_lab":return J||null;case"scan_date":return te||null;case"scan_cost":return re||null;case"scan_notes":return ae||null;default:return null}})(e))}),0!==Object.keys(r).length)try{const a=p?t:[e],o=(0,i.Gi)();for(const e of a)await fetch(`${o}/api/photos/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(e=>e.text()).catch(()=>null);g(e=>{const t=new Set(e);return Object.keys(r).forEach(e=>t.delete(e)),t}),n?h&&h(r):(h&&h(r),d&&d())}catch(a){console.error("Batch/Single save failed",a)}}const xe=r.useRef(null);(0,r.useEffect)(()=>{var e;const t=null===(e=xe.current)||void 0===e?void 0:e.querySelector("input,select,textarea,button");function n(e){"Escape"===e.key&&d&&d()}return t&&t.focus(),window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[d]);const[_e,we]=(0,r.useState)(!1),Se=()=>{we(!0),setTimeout(()=>d&&d(),200)},Te=({title:e,sectionKey:t})=>(0,a.jsxs)("div",{className:"fg-section-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,a.jsx)("div",{className:"fg-section-label",children:e}),(0,a.jsx)("button",{type:"button",className:"fg-btn-mini",style:{fontSize:"0.75rem",padding:"2px 8px",opacity:Ae(t)?1:.5,cursor:Ae(t)?"pointer":"default",border:"1px solid currentColor",borderRadius:4,background:"transparent"},disabled:!Ae(t),onClick:()=>be(t),children:"Save"})]});return(0,a.jsx)("div",{role:"presentation",onClick:Se,style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.25)",zIndex:10019},children:(0,a.jsxs)("aside",{ref:xe,className:"fg-sidepanel "+(_e?"fade-slide-exit-active":"fade-slide-enter-active"),role:"dialog","aria-modal":"true","aria-label":p?"Batch edit photos":"Photo details",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("header",{className:"fg-sidepanel-header",children:[(0,a.jsx)("h3",{className:"fg-sidepanel-title",children:p?`Batch Editing (${t.length})`:"Photo Details"}),(0,a.jsx)("button",{className:"fg-sidepanel-close",onClick:Se,"aria-label":"Close sidebar",children:"\xd7"})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Time",sectionKey:"time"}),(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Date Taken"}),(0,a.jsx)("input",{className:"fg-input",type:"date",lang:"en",value:v,onChange:e=>{A(e.target.value),ve("date_taken")},min:(null===n||void 0===n?void 0:n.start_date)||"",max:(null===n||void 0===n?void 0:n.end_date)||""})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Time Taken"}),(0,a.jsx)("input",{className:"fg-input",type:"time",value:y,onChange:e=>{b(e.target.value),ve("time_taken")}})]})]})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Equipment & Photographer",sectionKey:"equipment"}),(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Camera"}),(0,a.jsx)(l.A,{type:"camera",value:T,onChange:(e,t)=>{C(e),N(t),_(t?`${t.brand} ${t.model}`:"");const n=["camera_equip_id","camera"];null!==t&&void 0!==t&&t.has_fixed_lens&&(E(null),S(t.fixed_lens_focal_length?`${t.fixed_lens_focal_length}mm f/${t.fixed_lens_max_aperture||"?"}`:"Fixed"),n.push("lens_equip_id","lens")),ve(n)},placeholder:null!==n&&void 0!==n&&n.camera?`Default: ${n.camera}`:"Select camera..."})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Lens"}),null!==P&&void 0!==P&&P.has_fixed_lens?(0,a.jsxs)("div",{className:"fg-input",style:{background:"#f5f5f5",cursor:"not-allowed",color:"#666",display:"flex",alignItems:"center"},children:["Fixed: ",P.fixed_lens_focal_length?`${P.fixed_lens_focal_length}mm`:"Built-in",P.fixed_lens_max_aperture?` f/${P.fixed_lens_max_aperture}`:""]}):(0,a.jsx)(l.A,{type:"lens",value:M,cameraId:T,onChange:(e,t)=>{E(e),S(t?`${t.brand} ${t.model}`:""),ve(["lens_equip_id","lens"])},placeholder:null!==n&&void 0!==n&&n.lens?`Default: ${n.lens}`:"Select lens..."})]})]}),(0,a.jsx)("div",{className:"fg-sidepanel-groupGrid cols-1",style:{marginTop:8},children:(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Photographer"}),(0,a.jsx)("input",{className:"fg-input",type:"text",list:"photographer-options",placeholder:null!==n&&void 0!==n&&n.photographer?`Default: ${n.photographer}`:"e.g. Xiaoming",value:k,onChange:e=>{R(e.target.value),ve("photographer")}}),(0,a.jsx)("datalist",{id:"photographer-options",children:(me.photographers||[]).map((e,t)=>(0,a.jsx)("option",{value:e},t))})]})})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Shooting Parameters",sectionKey:"params"}),(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-4",children:[(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Aperture"}),(0,a.jsx)("input",{className:"fg-input",type:"number",step:"0.1",min:"0.5",max:"64",placeholder:"e.g. 2.8",value:L,onChange:e=>{O(e.target.value),ve("aperture")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Shutter"}),(0,a.jsx)("input",{className:"fg-input",type:"text",placeholder:"e.g. 1/125",value:j,onChange:e=>{D(e.target.value),ve("shutter_speed")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"ISO"}),(0,a.jsx)("input",{className:"fg-input",type:"number",min:"6",max:"25600",placeholder:"e.g. 400",value:I,onChange:e=>{B(e.target.value),ve("iso")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Focal (mm)"}),(0,a.jsx)("input",{className:"fg-input",type:"number",step:"1",min:"1",max:"2000",placeholder:"e.g. 50",value:F,onChange:e=>{z(e.target.value),ve("focal_length")}})]})]})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Location",sectionKey:"location"}),(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Country / City"}),(0,a.jsx)(o,{value:G,onChange:e=>{if(!e)return q(e=>({...e,location_id:null,country_name:null,city_name:null})),void ve(["location_id","country","city"]);q(t=>({...t,location_id:e.location_id||null,country_name:e.country_name||null,city_name:e.city_name||null})),ve(["location_id","country","city"])},onCoordinatesAvailable:H})]}),W&&(0,a.jsx)("div",{className:"fg-field",children:(0,a.jsxs)("button",{type:"button",className:"fg-btn fg-btn-secondary",onClick:()=>{q(e=>({...e,latitude:W.lat,longitude:W.lng})),ve(["latitude","longitude"]),H(null)},style:{width:"100%"},children:["\ud83d\udccd Fill Coordinates (",W.lat.toFixed(4),", ",W.lng.toFixed(4),")"]})}),(0,a.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Latitude"}),(0,a.jsx)("input",{className:"fg-input",type:"number",value:G.latitude||"",onChange:e=>{q(t=>({...t,latitude:parseFloat(e.target.value)})),ve("latitude")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Longitude"}),(0,a.jsx)("input",{className:"fg-input",type:"number",value:G.longitude||"",onChange:e=>{q(t=>({...t,longitude:parseFloat(e.target.value)})),ve("longitude")}})]})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Detail Location"}),(0,a.jsx)(s.A,{value:U,onChange:e=>{V(e),ve("detail_location")},onSelect:e=>{q(t=>({...t,latitude:e.latitude,longitude:e.longitude})),e.detail&&V(e.detail),ve(["detail_location","latitude","longitude"])},placeholder:"Search address or type detail..."})]})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Scanning Info",sectionKey:"scanning"}),(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Scanner"}),(0,a.jsx)(l.A,{type:"scanner",value:$,onChange:e=>{K(e),ve("scanner_equip_id")},placeholder:"Select scanner..."})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Scan Lab"}),(0,a.jsx)("input",{className:"fg-input",placeholder:"e.g. Film Lab, Home scan",value:J,onChange:e=>{ee(e.target.value),ve("scan_lab")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Scan Date"}),(0,a.jsx)("input",{className:"fg-input",type:"date",value:te,onChange:e=>{ne(e.target.value),ve("scan_date")},lang:"en-US"})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Resolution (DPI)"}),(0,a.jsx)("input",{className:"fg-input",type:"number",placeholder:"e.g. 3200, 4800",value:X,onChange:e=>{Y(e.target.value),ve("scan_resolution")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Scan Software"}),(0,a.jsx)("input",{className:"fg-input",placeholder:"e.g. VueScan, Epson Scan 2",value:Q,onChange:e=>{Z(e.target.value),ve("scan_software")}})]}),(0,a.jsxs)("div",{className:"fg-field",children:[(0,a.jsx)("label",{className:"fg-label",children:"Scan Cost"}),(0,a.jsx)("input",{className:"fg-input",type:"number",placeholder:"0.00",value:re,onChange:e=>{ie(e.target.value),ve("scan_cost")}})]})]}),(0,a.jsxs)("div",{className:"fg-field",style:{marginTop:8},children:[(0,a.jsx)("label",{className:"fg-label",children:"Scan Notes"}),(0,a.jsx)("textarea",{className:"fg-textarea",style:{minHeight:60,resize:"vertical"},placeholder:"Scan parameters, issues, etc...",value:ae,onChange:e=>{oe(e.target.value),ve("scan_notes")}})]})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Caption",sectionKey:"caption"}),(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsx)("div",{className:"fg-field",children:(0,a.jsx)("textarea",{className:"fg-textarea",style:{minHeight:80,resize:"vertical"},placeholder:"Add a description or caption for this photo...",value:se,onChange:e=>{le(e.target.value),ve("caption")}})})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,a.jsx)(Te,{title:"Tags",sectionKey:"tags"}),(0,a.jsx)("div",{className:"fg-separator"}),ce.length>0&&(0,a.jsx)("div",{className:"fg-field",style:{display:"flex",flexWrap:"wrap",gap:6},children:ce.map(e=>(0,a.jsxs)("span",{className:"fg-tag-chip",style:{display:"inline-flex",alignItems:"center",gap:4,padding:"4px 8px",borderRadius:12,background:"var(--fg-success-bg, #dcfce7)",color:"var(--fg-success-text, #166534)",fontSize:"0.85rem"},children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>{ue(t=>t.filter(t=>t!==e)),ve("tags")},style:{background:"transparent",border:"none",cursor:"pointer",padding:0,lineHeight:1,color:"inherit",opacity:.6},"aria-label":`Remove tag ${e}`,children:"\xd7"})]},e))}),(0,a.jsxs)("div",{className:"fg-field",style:{marginTop:ce.length>0?8:0},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,a.jsx)("input",{className:"fg-input",type:"text",list:"tag-suggestions",placeholder:"Add tag...",value:de,onChange:e=>he(e.target.value),onKeyDown:e=>{"Enter"===e.key&&de.trim()&&(e.preventDefault(),ce.includes(de.trim())||(ue(e=>[...e,de.trim()]),ve("tags")),he(""))},style:{flex:1}}),(0,a.jsx)("button",{type:"button",className:"fg-btn fg-btn-secondary",disabled:!de.trim(),onClick:()=>{de.trim()&&!ce.includes(de.trim())&&(ue(e=>[...e,de.trim()]),ve("tags")),he("")},style:{padding:"0 12px"},children:"+"})]}),(0,a.jsx)("datalist",{id:"tag-suggestions",children:pe.filter(e=>e.photos_count>0).filter(e=>!ce.includes(e.name)).filter(e=>!de||e.name.toLowerCase().includes(de.toLowerCase())).map(e=>(0,a.jsx)("option",{value:e.name},e.id))})]})]}),(0,a.jsxs)("section",{className:"fg-sidepanel-section",style:{marginTop:"auto"},children:[(0,a.jsx)("div",{className:"fg-separator"}),(0,a.jsxs)("div",{className:"fg-sidepanel-actions",children:[(0,a.jsx)("button",{type:"button",className:"fg-btn",onClick:Se,children:"Cancel"}),(0,a.jsxs)("button",{type:"button",className:"fg-btn fg-btn-primary",onClick:()=>be(null),disabled:!ye,style:{opacity:ye?1:.6},children:["Save All ",ye&&`(${m.size})`," changes"]})]})]})]})})}},8310:function(e,t,n){const r=n(619),i=n(9546),a=n(7690),o=n(5183),s=n(6976),l=n(1628),c=n(3879),u=n(2849),d=n(9288),h=n(7585);function p(e={}){const{isGL2:t=!1,useCompositeCurve:n=!1}=e,r=t?"texture":"texture2D";return`\nvoid main() {\n  vec3 c = ${r}(u_image, v_uv).rgb;\n\n  // \u2460 Film Curve (before inversion) \u2014 Q13: per-channel gamma + toe/shoulder S-curve\n  if (u_inverted > 0.5 && u_filmCurveEnabled > 0.5) {\n    float toe = u_filmCurveToe;\n    float sh  = u_filmCurveShoulder;\n    c.r = applyFilmCurve(c.r, u_filmCurveGammaR, u_filmCurveDMin, u_filmCurveDMax, toe, sh);\n    c.g = applyFilmCurve(c.g, u_filmCurveGammaG, u_filmCurveDMin, u_filmCurveDMax, toe, sh);\n    c.b = applyFilmCurve(c.b, u_filmCurveGammaB, u_filmCurveDMin, u_filmCurveDMax, toe, sh);\n  }\n\n  // \u2461 Base Correction \u2014 neutralize film base color\n  if (u_baseMode > 0.5) {\n    float minT = 0.001;\n    float log10 = log(10.0);\n    float Tr = max(c.r, minT);\n    c.r = pow(10.0, -(-log(Tr) / log10 - u_baseDensity.r));\n    float Tg = max(c.g, minT);\n    c.g = pow(10.0, -(-log(Tg) / log10 - u_baseDensity.g));\n    float Tb = max(c.b, minT);\n    c.b = pow(10.0, -(-log(Tb) / log10 - u_baseDensity.b));\n    c = clamp(c, 0.0, 1.0);\n  } else {\n    c = clamp(c * u_baseGains, 0.0, 1.0);\n  }\n\n  // \u2461.5 Density Levels (Log domain auto-levels)\n  if (u_densityLevelsEnabled > 0.5) {\n    float minT = 0.001;\n    float log10 = log(10.0);\n    float rangeR = u_densityLevelsMax.r - u_densityLevelsMin.r;\n    float rangeG = u_densityLevelsMax.g - u_densityLevelsMin.g;\n    float rangeB = u_densityLevelsMax.b - u_densityLevelsMin.b;\n    float avgRange = clamp((rangeR + rangeG + rangeB) / 3.0, 0.5, 2.5);\n\n    if (rangeR > 0.001) {\n      float Dr = -log(max(c.r, minT)) / log10;\n      c.r = pow(10.0, -clamp((Dr - u_densityLevelsMin.r) / rangeR, 0.0, 1.0) * avgRange);\n    }\n    if (rangeG > 0.001) {\n      float Dg = -log(max(c.g, minT)) / log10;\n      c.g = pow(10.0, -clamp((Dg - u_densityLevelsMin.g) / rangeG, 0.0, 1.0) * avgRange);\n    }\n    if (rangeB > 0.001) {\n      float Db = -log(max(c.b, minT)) / log10;\n      c.b = pow(10.0, -clamp((Db - u_densityLevelsMin.b) / rangeB, 0.0, 1.0) * avgRange);\n    }\n    c = clamp(c, 0.0, 1.0);\n  }\n\n  // \u2462 Inversion\n  if (u_inverted > 0.5) {\n    if (u_inversionMode > 0.5) {\n      c = vec3(1.0) - log(c * 255.0 + vec3(1.0)) / log(256.0);\n    } else {\n      c = vec3(1.0) - c;\n    }\n  }\n\n${t?"\n  // \u2462b 3D LUT (WebGL2 native sampler3D \u2014 applied AFTER inversion)\n  if (u_hasLut3d > 0.5) {\n    float size = u_lut3dSize;\n    vec3 uvw = c * (size - 1.0) / size + 0.5 / size;\n    vec3 lutColor = texture(u_lut3dTex, uvw).rgb;\n    c = mix(c, lutColor, u_lutIntensity);\n  }\n":"\n  // \u2462b 3D LUT (WebGL1 packed 2D texture \u2014 applied AFTER inversion)\n  if (u_useLut3d > 0.5) {\n    vec3 lutColor = sampleLUT3D(c);\n    c = mix(c, lutColor, u_lutIntensity);\n  }\n"}\n\n  // \u2463 White Balance\n  c *= u_gains;\n\n  // \u2464a Exposure (f-stop formula: pow(2, exposure/50))\n  float expFactor = pow(2.0, u_exposure / 50.0);\n  c *= expFactor;\n\n  // \u2464b Contrast around perceptual mid-gray (0.46 = sRGB 18% reflectance)\n  c = applyContrast(c, u_contrast);\n\n  // \u2464c Blacks & Whites (window remap)\n  c = applyWhitesBlacks(c);\n\n  // \u2464d Shadows & Highlights (Bernstein basis)\n  c = applyHighlightsShadows(c);\n\n  // \u2464e Highlight Roll-Off (tanh shoulder compression)\n  c = applyHighlightRollOff(c);\n\n  c = clamp(c, 0.0, 1.0);\n\n  // \u2465 Curves (1D LUT)\n  if (u_useCurves > 0.5) {\n  ${n?`\n    // Composite curve texture: R,G,B channels contain per-channel curve data\n    c.r = ${r}(u_toneCurveTex, vec2(c.r, 0.5)).r;\n    c.g = ${r}(u_toneCurveTex, vec2(c.g, 0.5)).g;\n    c.b = ${r}(u_toneCurveTex, vec2(c.b, 0.5)).b;\n  `:"\n    // Separate 1D curve textures: master RGB + per-channel\n    c = applyCurvesLUT(c);\n  "}\n  }\n\n  // \u2466 HSL Adjustment\n  if (u_useHSL > 0.5) {\n    c = applyHSLAdjustment(c);\n  }\n\n  // \u2466b Saturation (Luma-Preserving, Rec.709)\n  if (u_useSaturation > 0.5) {\n    c = applySaturation(c);\n  }\n\n  // \u2467 Split Toning\n  if (u_useSplitTone > 0.5) {\n    c = applySplitToning(c);\n  }\n\n  ${t?"fragColor":"gl_FragColor"} = vec4(c, 1.0);\n}\n`}e.exports={buildFragmentShader:function(e={}){const{isGL2:t=!1,useCompositeCurve:n=!1,precision:f="mediump"}=e;return t?`#version 300 es\nprecision highp float;\nprecision highp sampler3D;\n\n// WebGL2 compat: modules may use texture2D()\n#define texture2D texture\n\nin vec2 v_uv;\nout vec4 fragColor;\n\n// WebGL2: 3D LUT as native sampler3D\nuniform sampler3D u_lut3dTex;\nuniform float u_hasLut3d;\nuniform float u_lut3dSize;\n\n${n?"\n// Composite curve texture (gpu-renderer path: R,G,B channels = per-channel curves)\nuniform sampler2D u_toneCurveTex;\n":""}\n\n${h.UNIFORMS_GLSL}\n${r.COLOR_MATH_GLSL}\n${o.FILM_CURVE_GLSL}\n${u.BASE_DENSITY_GLSL}\n${c.INVERSION_GLSL}\n${s.TONEMAP_GLSL}\n${i.HSL_ADJUST_GLSL}\n${d.getSaturationGLSL()}\n${a.SPLIT_TONE_GLSL}\n${p({isGL2:!0,useCompositeCurve:n})}\n`:`\nprecision ${f} float;\nvarying vec2 v_uv;\n\n${h.UNIFORMS_GLSL}\n${r.COLOR_MATH_GLSL}\n${o.FILM_CURVE_GLSL}\n${u.BASE_DENSITY_GLSL}\n${c.INVERSION_GLSL}\n${s.TONEMAP_GLSL}\n${l.LUT3D_GLSL}\n${i.HSL_ADJUST_GLSL}\n${d.getSaturationGLSL()}\n${a.SPLIT_TONE_GLSL}\n${p({isGL2:!1})}\n`},buildMainFunction:p,VERTEX_SHADER:"\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nvarying vec2 v_uv;\n\nvoid main() {\n  v_uv = a_uv;\n  gl_Position = vec4(a_pos, 0.0, 1.0);\n}\n",VERTEX_SHADER_GL2:"#version 300 es\nin vec2 a_pos;\nin vec2 a_uv;\nout vec2 v_uv;\n\nvoid main() {\n  v_uv = a_uv;\n  gl_Position = vec4(a_pos, 0.0, 1.0);\n}\n",colorMath:r,hslAdjust:i,splitTone:a,saturation:d,filmCurve:o,tonemap:s,lut3d:l,inversion:c,baseDensity:u,uniforms:h,SHADER_VERSION:"2026-02-08-v3"}},8328:function(e,t,n){"use strict";function r(e){return"object"===typeof e&&null!==e}n.d(t,{G:function(){return r}})},8332:function(e,t,n){"use strict";n.d(t,{H:function(){return X}});var r=n(579),i=n(5043),a=n(2190),o=n(6841),s=n(1051);const l=(0,i.createContext)({});var c=n(9426),u=n(9742);function d(e){const{initial:t,animate:n}=function(e,t){if((0,c.e)(e)){const{initial:t,animate:n}=e;return{initial:!1===t||(0,u.w)(t)?t:void 0,animate:(0,u.w)(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,i.useContext)(l));return(0,i.useMemo)(()=>({initial:t,animate:n}),[h(t),h(n)])}function h(e){return Array.isArray(e)?e.join(" "):e}var p=n(3964),f=n(2420),m=n(6189);const g=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function v(e,t,n){for(const r in t)(0,p.S)(t[r])||(0,f.z)(r,n)||(e[r]=t[r])}function A(e,t){const n={};return v(n,e.style||{},e),Object.assign(n,function({transformTemplate:e},t){return(0,i.useMemo)(()=>{const n=g();return(0,m.O)(n,t,e),Object.assign({},n.vars,n.style)},[t])}(e,t)),n}function y(e,t){const n={},r=A(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=r,n}var b=n(9954);const x=()=>({...g(),attrs:{}});var _=n(9420);function w(e,t,n,r){const a=(0,i.useMemo)(()=>{const n=x();return(0,b.B)(n,t,(0,_.n)(r),e.transformTemplate,e.style),{...n.attrs,style:{...n.style}}},[t]);if(e.style){const t={};v(t,e.style,e),a.style={...t,...a.style}}return a}var S=n(5357),T=n(2116);function C(e,t,n,{latestValues:r},a,o=!1){const s=((0,T.Q)(e)?w:y)(t,r,a,e),l=(0,S.J)(t,"string"===typeof e,o),c=e!==i.Fragment?{...l,...s,ref:n}:{},{children:u}=t,d=(0,i.useMemo)(()=>(0,p.S)(u)?u.get():u,[u]);return(0,i.createElement)(e,{...c,children:d})}var M=n(9615),E=n(9674),P=n(5859),N=n(4930),k=n(6061);function R(e,t,n,r){const i={},a=r(e,{});for(const c in a)i[c]=(0,k.u)(a[c]);let{initial:o,animate:s}=e;const l=(0,c.e)(e),u=(0,c.O)(e);t&&u&&!l&&!1!==e.inherit&&(void 0===o&&(o=t.initial),void 0===s&&(s=t.animate));let d=!!n&&!1===n.initial;d=d||!1===o;const h=d?s:o;if(h&&"boolean"!==typeof h&&!(0,M.N)(h)){const t=Array.isArray(h)?h:[h];for(let n=0;n<t.length;n++){const r=(0,P.a)(e,t[n]);if(r){const{transitionEnd:e,transition:t,...n}=r;for(const r in n){let e=n[r];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(i[r]=e)}for(const r in e)i[r]=e[r]}}}return i}const L=e=>(t,n)=>{const r=(0,i.useContext)(l),a=(0,i.useContext)(E.t),o=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},n,r,i){return{latestValues:R(n,r,i,e),renderState:t()}}(e,t,r,a);return n?o():(0,N.M)(o)};const O=L({scrapeMotionValuesFromProps:n(7457).x,createRenderState:g});const j=L({scrapeMotionValuesFromProps:n(1248).x,createRenderState:x});var D=n(4735),I=n(9601),B=n(5491);const F=Symbol.for("motionComponentSymbol");var z=n(7380);function U(e,t,n){return(0,i.useCallback)(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),n&&("function"===typeof n?n(r):(0,z.X)(n)&&(n.current=r))},[t])}var V=n(971),G=n(3874),q=n(293);function W(e,t,n,r,a){const{visualElement:c}=(0,i.useContext)(l),u=(0,i.useContext)(o.Y),d=(0,i.useContext)(E.t),h=(0,i.useContext)(s.Q).reducedMotion,p=(0,i.useRef)(null);r=r||u.renderer,!p.current&&r&&(p.current=r(e,{visualState:t,parent:c,props:n,presenceContext:d,blockInitialAnimation:!!d&&!1===d.initial,reducedMotionConfig:h}));const f=p.current,m=(0,i.useContext)(G.N);!f||f.projection||!a||"html"!==f.type&&"svg"!==f.type||function(e,t,n,r){const{layoutId:i,layout:a,drag:o,dragConstraints:s,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:H(e.parent)),e.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:Boolean(o)||s&&(0,z.X)(s),visualElement:e,animationType:"string"===typeof a?a:"both",initialPromotionConfig:r,crossfade:u,layoutScroll:l,layoutRoot:c})}(p.current,n,a,m);const g=(0,i.useRef)(!1);(0,i.useInsertionEffect)(()=>{f&&g.current&&f.update(n,d)});const v=n[V.n],A=(0,i.useRef)(Boolean(v)&&!window.MotionHandoffIsComplete?.(v)&&window.MotionHasOptimisedAnimation?.(v));return(0,q.E)(()=>{f&&(g.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),f.scheduleRenderMicrotask(),A.current&&f.animationState&&f.animationState.animateChanges())}),(0,i.useEffect)(()=>{f&&(!A.current&&f.animationState&&f.animationState.animateChanges(),A.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(v)}),A.current=!1),f.enteringChildren=void 0)}),f}function H(e){if(e)return!1!==e.options.allowProjection?e.projection:H(e.parent)}function $(e,{forwardMotionProps:t=!1}={},n,a){n&&(0,B.Y)(n);const c=(0,T.Q)(e)?j:O;function u(n,u){let h;const p={...(0,i.useContext)(s.Q),...n,layoutId:K(n)},{isStatic:f}=p,m=d(n),g=c(n,f);if(!f&&D.B){!function(){(0,i.useContext)(o.Y).strict;0}();const t=function(e){const{drag:t,layout:n}=I.B;if(!t&&!n)return{};const r={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(p);h=t.MeasureLayout,m.visualElement=W(e,g,p,a,t.ProjectionNode)}return(0,r.jsxs)(l.Provider,{value:m,children:[h&&m.visualElement?(0,r.jsx)(h,{visualElement:m.visualElement,...p}):null,C(e,n,U(g,m.visualElement,u),g,f,t)]})}u.displayName=`motion.${"string"===typeof e?e:`create(${e.displayName??e.name??""})`}`;const h=(0,i.forwardRef)(u);return h[F]=e,h}function K({layoutId:e}){const t=(0,i.useContext)(a.L).id;return t&&void 0!==e?t+"-"+e:e}function X(e,t){if("undefined"===typeof Proxy)return $;const n=new Map,r=(n,r)=>$(n,r,e,t);return new Proxy((e,t)=>r(e,t),{get:(i,a)=>"create"===a?r:(n.has(a)||n.set(a,$(a,void 0,e,t)),n.get(a))})}},8346:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toArray=function(e){return Array.isArray(e)?e:Array.from(e)}},8365:function(e,t,n){"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},a=r.useSyncExternalStore,o=r.useRef,s=r.useEffect,l=r.useMemo,c=r.useDebugValue},8387:function(e,t,n){"use strict";function r(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function i(){for(var e,t,n=0,i="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{$:function(){return i}}),t.A=i},8396:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(5508);t.cloneDeep=function(e){return r.cloneDeepWith(e)}},8412:function(e,t,n){"use strict";n.d(t,{Gt:function(){return a},PP:function(){return l},WG:function(){return o},uv:function(){return s}});var r=n(4760),i=n(1422);const{schedule:a,cancel:o,state:s,steps:l}=(0,i.I)("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:r.l,!0)},8416:function(e,t,n){"use strict";n.d(t,{H:function(){return h}});var r=n(6650),i=n(9427),a=n(5033),o=n(1697);function s(e,t){let n=e;for((0,o.o)(n,t)&&(n=n.parentElement);n&&!(0,o.o)(n,t);)n=n.parentElement;return n||document.scrollingElement||document.documentElement}var l=n(1709);const c="undefined"!==typeof document&&window.visualViewport;let u,d=0;function h(e={}){let{isDisabled:t}=e;(0,r.N)(()=>{if(!t)return d++,1===d&&(u=(0,i.un)()?function(){let e,t=!1,n=n=>{let r=n.target;e=(0,o.o)(r)?r:s(r,!0),t=!1;let i=r.ownerDocument.defaultView.getSelection();i&&!i.isCollapsed&&i.containsNode(r,!0)&&(t=!0),"selectionStart"in r&&"selectionEnd"in r&&r.selectionStart<r.selectionEnd&&r.ownerDocument.activeElement===r&&(t=!0)},r=document.createElement("style");r.textContent="\n@layer {\n  * {\n    overscroll-behavior: contain;\n  }\n}".trim(),document.head.prepend(r);let i=n=>{2===n.touches.length||t||(e&&e!==document.documentElement&&e!==document.body?e.scrollHeight===e.clientHeight&&e.scrollWidth===e.clientWidth&&n.preventDefault():n.preventDefault())},c=e=>{let t=e.target,n=e.relatedTarget;if(n&&(0,l.o)(n))n.focus({preventScroll:!0}),m(n,(0,l.o)(t));else if(!n){var r;let e=null===(r=t.parentElement)||void 0===r?void 0:r.closest("[tabindex]");null===e||void 0===e||e.focus({preventScroll:!0})}},u=HTMLElement.prototype.focus;HTMLElement.prototype.focus=function(e){let t=null!=document.activeElement&&(0,l.o)(document.activeElement);u.call(this,{...e,preventScroll:!0}),e&&e.preventScroll||m(this,t)};let d=(0,a.c)(f(document,"touchstart",n,{passive:!1,capture:!0}),f(document,"touchmove",i,{passive:!1,capture:!0}),f(document,"blur",c,!0));return()=>{d(),r.remove(),HTMLElement.prototype.focus=u}}():function(){let e=window.innerWidth-document.documentElement.clientWidth;return(0,a.c)(e>0&&("scrollbarGutter"in document.documentElement.style?p(document.documentElement,"scrollbarGutter","stable"):p(document.documentElement,"paddingRight",`${e}px`)),p(document.documentElement,"overflow","hidden"))}()),()=>{d--,0===d&&u()}},[t])}function p(e,t,n){let r=e.style[t];return e.style[t]=n,()=>{e.style[t]=r}}function f(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}function m(e,t){t||!c?g(e):c.addEventListener("resize",()=>g(e),{once:!0})}function g(e){let t=document.scrollingElement||document.documentElement,n=e;for(;n&&n!==t;){let e=s(n);if(e!==document.documentElement&&e!==document.body&&e!==n){let t=e.getBoundingClientRect(),r=n.getBoundingClientRect();if(r.top<t.top||r.bottom>t.top+n.clientHeight){let n=t.bottom;c&&(n=Math.min(n,c.offsetTop+c.height));let i=r.top-t.top-((n-t.top)/2-r.height/2);e.scrollTo({top:Math.max(0,Math.min(e.scrollHeight-e.clientHeight,e.scrollTop+i)),behavior:"smooth"})}}n=e.parentElement}}},8420:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isLength=function(e){return Number.isSafeInteger(e)&&e>=0}},8436:function(e,t,n){"use strict";n.d(t,{$:function(){return a},q:function(){return o}});var r=n(8085);const i=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,a=(e,t)=>n=>Boolean("string"===typeof n&&i.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),o=(e,t,n)=>i=>{if("string"!==typeof i)return i;const[a,o,s,l]=i.match(r.S);return{[e]:parseFloat(a),[t]:parseFloat(o),[n]:parseFloat(s),alpha:void 0!==l?parseFloat(l):1}}},8443:function(e,t,n){"use strict";e.exports=n(9717)},8493:function(e,t,n){"use strict";n.d(t,{Ng:function(){return a},TW:function(){return r},mD:function(){return i}});const r=e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.ownerDocument)&&void 0!==t?t:document},i=e=>{if(e&&"window"in e&&e.window===e)return e;return r(e).defaultView||window};function a(e){return null!==(t=e)&&"object"===typeof t&&"nodeType"in t&&"number"===typeof t.nodeType&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"host"in e;var t}},8499:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!==typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var l,c,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,a),!0;case 6:return u.fn.call(u.context,t,r,i,a,o),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var l=0,c=[],u=s.length;l<u;l++)(s[l].fn!==t||i&&!s[l].once||r&&s[l].context!==r)&&c.push(s[l]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},8523:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});const r={layout:0,mainThread:0,waapi:0}},8560:function(e,t,n){"use strict";n.d(t,{F:function(){return i}});const r=(e,t)=>n=>t(e(n)),i=(...e)=>e.reduce(r)},8603:function(e,t,n){"use strict";n.d(t,{Wc:function(){return u}});var r=n(4338),i=n(3255),a=n(6296),o=n(2196),s=n(5793),l=n(5043);let c=l.createContext(null);function u(e,t){let{focusProps:n}=(0,i.i)(e),{keyboardProps:u}=(0,a.d)(e),d=(0,o.v)(n,u),h=function(e){let t=(0,l.useContext)(c)||{};(0,s.w)(t,e);let{ref:n,...r}=t;return r}(t),p=e.isDisabled?{}:h,f=(0,l.useRef)(e.autoFocus);(0,l.useEffect)(()=>{f.current&&t.current&&(0,r.l)(t.current),f.current=!1},[t]);let m=e.excludeFromTabOrder?-1:0;return e.isDisabled&&(m=void 0),{focusableProps:(0,o.v)({...d,tabIndex:m},p)}}},8624:function(e,t,n){"use strict";n.d(t,{tE:function(){return r.tE},FH:function(){return r.FH},Cz:function(){return r.Cz},TH:function(){return je},N8:function(){return fe},cx:function(){return De},PI:function(){return Le},PG:function(){return he},EG:function(){return de},Wt:function(){return I},Lw:function(){return y},n3:function(){return se},xH:function(){return P},HW:function(){return C},Ns:function(){return X},zX:function(){return G},yJ:function(){return xe},qJ:function(){return Te},wP:function(){return l},z1:function(){return te},jJ:function(){return F},iE:function(){return x},Dy:function(){return ce},Ut:function(){return k},Jv:function(){return T},Yv:function(){return Q},Sz:function(){return W},RT:function(){return ke},IM:function(){return f},BC:function(){return Me},LF:function(){return s},kz:function(){return re},E$:function(){return $e},Js:function(){return ze},Oi:function(){return M},ft:function(){return We},Gi:function(){return r.getApiBase},un:function(){return Oe},Wf:function(){return pe},RS:function(){return D},$N:function(){return R},X6:function(){return be},AZ:function(){return L},qZ:function(){return m},fO:function(){return oe},m3:function(){return E},t1:function(){return w},ip:function(){return A},Lu:function(){return K},Nw:function(){return Ue},Tu:function(){return V},g$:function(){return ye},Vs:function(){return ve},ET:function(){return Ee},i$:function(){return d},vQ:function(){return Ve},EF:function(){return a},fn:function(){return i},Qp:function(){return ee},Ok:function(){return Ie},Di:function(){return Ge},KE:function(){return we},Q2:function(){return _e},s7:function(){return He},Po:function(){return Pe},nk:function(){return Se},br:function(){return Re},lp:function(){return me},zc:function(){return Be},Xp:function(){return qe},Eq:function(){return ge},X8:function(){return Ae},Mn:function(){return h},Du:function(){return c},F$:function(){return u},$M:function(){return B},uV:function(){return b},Tf:function(){return le},uD:function(){return N},lm:function(){return S},wY:function(){return Y},qm:function(){return q},tj:function(){return Fe},oN:function(){return p},K8:function(){return v},Rz:function(){return Ce},Zt:function(){return o},_3:function(){return ne},O0:function(){return z},sy:function(){return ue},F5:function(){return _},h7:function(){return Z},BQ:function(){return H},Xd:function(){return Ne},i5:function(){return g},nC:function(){return ie}});var r=n(8240);async function i(e={}){const t=(0,r.Go)(e);return(0,r.jsonFetch)(`/api/rolls${t}`)}async function a(e){return(0,r.jsonFetch)(`/api/rolls/${e}`)}async function o(e,t){return(0,r.gl)(`/api/rolls/${e}`,t)}async function s(e){return(0,r.Fb)(`/api/rolls/${e}`)}async function l({fields:e={},files:t=[],useTwoStep:n=!1,isNegative:i=!1,uploadType:a=null,onProgress:o,isOriginal:s=!1}={}){const l=a||(i?"negative":"positive"),c="negative"===l,u={...e,isNegative:c,uploadType:l,isOriginal:s},d=t.filter(e=>e instanceof File),h=t.filter(e=>"string"===typeof e||e&&e.tmpPath);return h.length>0||0===d.length&&e.tmpFiles?async function({fields:e={},tmpFiles:t=[],coverIndex:n=0}={}){const i={...e,tmpFiles:t,coverIndex:n};return(0,r.B2)("/api/rolls",i)}({fields:u,tmpFiles:e.tmpFiles||h,coverIndex:e.coverIndex||0}):async function({fields:e={},files:t=[],onProgress:n}={}){const i=new FormData;return Object.entries(e).forEach(([e,t])=>{void 0!==t&&null!==t&&i.append(e,t)}),t.forEach(e=>i.append("files",e)),(0,r.Nr)("/api/rolls",i,n)}({fields:u,files:d,onProgress:o})}async function c(e,{photoId:t,filename:n}={}){return(0,r.B2)(`/api/rolls/${e}/cover`,{photoId:t,filename:n})}async function u(e,{name:t,params:n}){return(0,r.B2)(`/api/rolls/${e}/preset`,{name:t,params:n})}async function d(e){return(0,r.jsonFetch)(`/api/rolls/${e}/photos`)}async function h(e={}){const t=(0,r.Go)(e);return(0,r.jsonFetch)(`/api/photos${t}`)}async function p(e,t){return(0,r.gl)(`/api/photos/${e}`,t)}async function f(e){return(0,r.Fb)(`/api/photos/${e}`)}async function m(){return(0,r.jsonFetch)("/api/photos/favorites")}async function g(e,t,n={}){const i=new FormData;return i.append("image",t),Object.entries(n).forEach(([e,t])=>{void 0!==t&&null!==t&&i.append(e,t)}),(0,r.Nr)(`/api/rolls/${e}/photos`,i)}async function v(e,t){const n=(0,r.getApiBase)(),i=new FormData;i.append("positive",t,"positive.jpg");return(await fetch(`${n}/api/photos/${e}/update-positive`,{method:"POST",body:i})).json()}async function A(e=!1){const t=e?`/api/films?_t=${Date.now()}`:"/api/films";return(0,r.jsonFetch)(t)}async function y({name:e,iso:t,category:n,brand:i,format:a,process:o,thumbFile:s}){const l=new FormData;l.append("name",e),t&&l.append("iso",t),n&&l.append("category",n),i&&l.append("brand",i),a&&l.append("format",a),o&&l.append("process",o),s&&l.append("thumb",s);const c=(0,r.getApiBase)();return(await fetch(`${c}/api/films`,{method:"POST",body:l})).json()}async function b({id:e,name:t,iso:n,category:i,brand:a,format:o,process:s,thumbFile:l}){const c=new FormData;t&&c.append("name",t),void 0!==n&&c.append("iso",n),void 0!==i&&c.append("category",i),void 0!==a&&c.append("brand",a),void 0!==o&&c.append("format",o),void 0!==s&&c.append("process",s),l&&c.append("thumb",l);const u=(0,r.getApiBase)();return(await fetch(`${u}/api/films/${e}`,{method:"PUT",body:c})).json()}async function x(e){return(0,r.Fb)(`/api/films/${e}`)}async function _(e,t){const n=(0,r.getApiBase)(),i=new FormData;i.append("thumb",t);return(await fetch(`${n}/api/films/${e}/thumb`,{method:"POST",body:i})).json()}async function w(e={}){const t=(0,r.Go)(e);return(0,r.jsonFetch)(`/api/film-items${t}`)}async function S(e,t){return(0,r.gl)(`/api/film-items/${e}`,t)}async function T(e,t=!1){const n=t?"?hard=true":"";return(0,r.Fb)(`/api/film-items/${e}${n}`)}async function C(e){return(0,r.B2)("/api/film-items/purchase-batch",e)}async function M(e){const t=(0,r.getApiBase)(),n=await fetch(`${t}/api/film-items/${e}/shot-logs/export`);if(!n.ok)throw new Error("Export failed");return n.blob()}async function E(){return(0,r.jsonFetch)("/api/presets/film-curves")}async function P({name:e,gamma:t,dMin:n,dMax:i,category:a="custom"}){return(0,r.B2)("/api/presets/film-curves",{name:e,gamma:t,dMin:n,dMax:i,category:a})}async function N(e,{name:t,gamma:n,dMin:i,dMax:a,category:o}){return(0,r.gl)(`/api/presets/film-curves/${e}`,{name:t,gamma:n,dMin:i,dMax:a,category:o})}async function k(e){return(0,r.Fb)(`/api/presets/film-curves/${e}`)}async function R(e){return(0,r.jsonFetch)(`/api/equipment/compatible-lenses/${e}`)}async function L(e,t,n=20){return(0,r.jsonFetch)(`/api/equipment/related-rolls/${e}/${t}?limit=${n}`)}function O(e){const t=`/api/equipment/${e}`;return{async list(e={},n=!1){const i=(0,r.Go)(e),a=`${t}${i}`;return n?(0,r.jsonFetch)(`${a}${i?"&":"?"}_t=${Date.now()}`):(0,r.jsonFetch)(a)},async get(e){return(0,r.jsonFetch)(`${t}/${e}`)},async create(e){return(0,r.B2)(t,e)},async update(e,n){return(0,r.gl)(`${t}/${e}`,n)},async delete(e,n=!1){const i=n?"?hard=true":"";return(0,r.Fb)(`${t}/${e}${i}`)},async uploadImage(e,n){const i=(0,r.getApiBase)(),a=new FormData;a.append("image",n);return(await fetch(`${i}${t}/${e}/image`,{method:"POST",body:a})).json()}}}const j=O("cameras"),D=(e,t)=>j.list(e,t),I=e=>j.create(e),B=(e,t)=>j.update(e,t),F=(e,t)=>j.delete(e,t),z=(e,t)=>j.uploadImage(e,t),U=O("lenses"),V=(e,t)=>U.list(e,t),G=e=>U.create(e),q=(e,t)=>U.update(e,t),W=(e,t)=>U.delete(e,t),H=(e,t)=>U.uploadImage(e,t),$=O("flashes"),K=(e,t)=>$.list(e,t),X=e=>$.create(e),Y=(e,t)=>$.update(e,t),Q=(e,t)=>$.delete(e,t),Z=(e,t)=>$.uploadImage(e,t),J=O("scanners"),ee=(e,t)=>J.list(e,t),te=e=>J.create(e),ne=(e,t)=>J.update(e,t),re=(e,t)=>J.delete(e,t),ie=(e,t)=>J.uploadImage(e,t),ae=O("film-backs"),oe=(e,t)=>ae.list(e,t),se=e=>ae.create(e),le=(e,t)=>ae.update(e,t),ce=(e,t)=>ae.delete(e,t),ue=(e,t)=>ae.uploadImage(e,t);async function de(e){return(0,r.B2)("/api/batch-render/library",e)}async function he(e){return(0,r.B2)("/api/batch-render/download",e)}async function pe(e){return(0,r.jsonFetch)(`/api/batch-render/progress/${e}`)}async function fe(e){return(0,r.B2)(`/api/batch-render/cancel/${e}`,{})}async function me(e){return(0,r.B2)(`/api/batch-render/pause/${e}`,{})}async function ge(e){return(0,r.B2)(`/api/batch-render/resume/${e}`,{})}async function ve({hasRecords:e=!0,country:t,query:n}={}){const i=(0,r.Go)({hasRecords:e,country:t,query:n});return(0,r.jsonFetch)(`/api/locations${i}`)}async function Ae(e={}){const t=(0,r.Go)(e);return(0,r.jsonFetch)(`/api/locations/search${t}`)}async function ye(e){return(0,r.jsonFetch)(`/api/locations/${e}`)}async function be(){return(0,r.jsonFetch)("/api/locations/countries")}async function xe(e){return(0,r.B2)("/api/locations",e)}async function _e(){return(0,r.jsonFetch)("/api/tags")}async function we(e){return(0,r.jsonFetch)(`/api/tags/${e}/photos`)}async function Se(e){const t=e?`?category=${e}`:"";return(0,r.jsonFetch)(`/api/presets${t}`)}async function Te({name:e,category:t,description:n,params:i}){return(0,r.B2)("/api/presets",{name:e,category:t,description:n,params:i})}async function Ce(e,{name:t,category:n,description:i,params:a}){return(0,r.gl)(`/api/presets/${e}`,{name:t,category:n,description:i,params:a})}async function Me(e){return(0,r.Fb)(`/api/presets/${e}`)}async function Ee(){return(0,r.jsonFetch)("/api/metadata/options")}async function Pe(){const e=(0,r.getApiBase)(),t=await fetch(`${e}/api/luts`),n=t.headers.get("content-type");if(!t.ok){if(n&&n.includes("application/json")){const e=await t.json();throw new Error(e.error||"Failed to get LUT list")}throw new Error(`Failed to get LUT list: HTTP ${t.status}`)}return t.json()}async function Ne(e){const t=(0,r.getApiBase)(),n=new FormData;n.append("lut",e);const i=await fetch(`${t}/api/luts/upload`,{method:"POST",body:n}),a=i.headers.get("content-type");if(!i.ok){if(a&&a.includes("application/json")){const e=await i.json();throw new Error(e.error||"Upload failed")}throw new Error(`Upload failed: HTTP ${i.status}`)}if(!a||!a.includes("application/json"))throw new Error("Server returned non-JSON response");return i.json()}async function ke(e){const t=(0,r.getApiBase)(),n=await fetch(`${t}/api/luts/${encodeURIComponent(e)}`,{method:"DELETE"}),i=n.headers.get("content-type");if(!n.ok){if(i&&i.includes("application/json")){const e=await n.json();throw new Error(e.error||"Delete LUT failed")}throw new Error(`Delete LUT failed: HTTP ${n.status}`)}return n.json()}async function Re(e){const t=(0,r.getApiBase)(),n=await fetch(`${t}/api/luts/${encodeURIComponent(e)}`);if(!n.ok){const e=await n.text();if(e.startsWith("<!DOCTYPE")||e.startsWith("<html"))throw new Error(`Load LUT failed: HTTP ${n.status}`);throw new Error(`Load LUT failed: ${e||"HTTP "+n.status}`)}const i=await n.text();if(i.startsWith("<!DOCTYPE")||i.startsWith("<html"))throw new Error("Server returned HTML page instead of LUT file");return function(e){const t=e.split("\n");let n=33;const r=[];for(let i of t){if(i=i.trim(),!i||i.startsWith("#"))continue;if(i.startsWith("LUT_3D_SIZE")){n=parseInt(i.split(/\s+/)[1]);continue}const e=i.split(/\s+/).map(parseFloat);e.length>=3&&!isNaN(e[0])&&r.push(e[0],e[1],e[2])}return{size:n,data:new Float32Array(r)}}(i)}async function Le(e){return(0,r.B2)("/api/batch-download",e)}async function Oe(e){return(0,r.jsonFetch)(`/api/batch-download/${e}/progress`)}async function je(e){return(0,r.B2)(`/api/batch-download/${e}/cancel`,{})}async function De(e,t,n="all",i=[]){const a=new URLSearchParams;return a.append("rollId",e),a.append("type",t),a.append("scope",n),i.length>0&&a.append("photoIds",JSON.stringify(i)),(0,r.jsonFetch)(`/api/batch-download/availability?${a}`)}function Ie(e,t="positive",n=!1){return`${(0,r.getApiBase)()}/api/batch-download/single/${e}?type=${t}&exif=${n}`}async function Be(e,t,n="filename"){return(0,r.B2)("/api/import/preview",{rollId:e,filePaths:t,strategy:n})}async function Fe(e,t,n,i){return(0,r.B2)("/api/import/manual-match",{rollId:e,matches:t,fileIndex:n,photoId:i})}async function ze(e,t,n="overwrite"){return(0,r.B2)("/api/import/execute",{rollId:e,matches:t,conflictResolution:n})}async function Ue(e){return(0,r.jsonFetch)(`/api/import/${e}/progress`)}async function Ve(){return(0,r.jsonFetch)("/api/raw/status")}async function Ge(){return(0,r.jsonFetch)("/api/raw/supported-formats")}async function qe(e){const t=(0,r.getApiBase)(),n=new FormData;n.append("file",e);return(await fetch(`${t}/api/raw/preview`,{method:"POST",body:n})).json()}async function We(e){const t=(0,r.getApiBase)(),n=new FormData;n.append("file",e);return(await fetch(`${t}/api/raw/metadata`,{method:"POST",body:n})).json()}async function He(e,t,n={},i){const a=new FormData;return a.append("file",e),a.append("rollId",String(t)),Object.entries(n).forEach(([e,t])=>{void 0!==t&&null!==t&&a.append(e,String(t))}),(0,r.Nr)("/api/raw/import",a,i)}async function $e(e,{sensitivity:t=50,filmFormat:n="auto",sourceType:i="original"}={}){return(0,r.B2)(`/api/edge-detection/photos/${e}/detect-edges`,{sensitivity:t,filmFormat:n,sourceType:i})}},8676:function(e,t,n){"use strict";n.d(t,{s:function(){return i}});var r=n(8328);function i(e){return(0,r.G)(e)&&"offsetHeight"in e}},8689:function(e,t,n){"use strict";n.d(t,{U:function(){return r},f:function(){return i}});const r=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],i=(()=>new Set(r))()},8839:function(e,t,n){const r=n(3787),i=n(9210),a=n(8880);e.exports={...r,...i,...a}},8845:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(8268),i=n(3272),a=n(8396),o=n(9323),s=n(5303);t.matchesProperty=function(e,t){switch(typeof e){case"object":Object.is(e?.valueOf(),-0)&&(e="-0");break;case"number":e=i.toKey(e)}return t=a.cloneDeep(t),function(n){const i=o.get(n,e);return void 0===i?s.has(n,e):void 0===t?void 0===i:r.isMatch(i,t)}}},8848:function(e,t,n){"use strict";n.d(t,{Nf:function(){return i}});let r=!1;function i(){return r}},8853:function(e,t,n){"use strict";e.exports=n(7234)},8878:function(e,t,n){"use strict";function r(e,t){return e?.[t]??e?.default??e}n.d(t,{r:function(){return r}})},8880:function(e){e.exports={reinhard:function(e){return e/(e+1)},reinhardExtended:function(e,t=4){return e*(1+e/(t*t))/(1+e)},filmicACES:function(e){return Math.max(0,Math.min(1,e*(2.51*e+.03)/(e*(2.43*e+.59)+.14)))},highlightRollOff:function(e,t=.8){if(e<=t)return e;const n=1-t,r=(e-t)/n,i=Math.min(r,10),a=Math.exp(2*i);return t+n*((a-1)/(a+1))}}},8909:function(e,t,n){"use strict";n.d(t,{d:function(){return R}});var r=n(171),i=n(9427),a=n(8493),o=n(368);let s="default",l="",c=new WeakMap;function u(e){if((0,i.un)()){if("default"===s){const t=(0,a.TW)(e);l=t.documentElement.style.webkitUserSelect,t.documentElement.style.webkitUserSelect="none"}s="disabled"}else if(e instanceof HTMLElement||e instanceof SVGElement){let t="userSelect"in e.style?"userSelect":"webkitUserSelect";c.set(e,e.style[t]),e.style[t]="none"}}function d(e){if((0,i.un)()){if("disabled"!==s)return;s="restoring",setTimeout(()=>{(0,o.v)(()=>{if("restoring"===s){const t=(0,a.TW)(e);"none"===t.documentElement.style.webkitUserSelect&&(t.documentElement.style.webkitUserSelect=l||""),l="",s="default"}})},300)}else if((e instanceof HTMLElement||e instanceof SVGElement)&&e&&c.has(e)){let t=c.get(e),n="userSelect"in e.style?"userSelect":"webkitUserSelect";"none"===e.style[n]&&(e.style[n]=t),""===e.getAttribute("style")&&e.removeAttribute("style"),c.delete(e)}}var h=n(1673);function p(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function f(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function m(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,p(e,t,"set"),n),n}var g=n(2196),v=n(5793),A=n(2417),y=n(1468),b=n(6650),x=n(3941),_=n(7418),w=n(5033),S=n(4595),T=n(9673),C=(n(7950),n(5043));var M=new WeakMap;class E{continuePropagation(){m(this,M,!1)}get shouldStopPropagation(){return function(e,t){return t.get?t.get.call(e):t.value}(e=this,p(e,M,"get"));var e}constructor(e,t,n,r){var i;f(this,M,{writable:!0,value:void 0}),m(this,M,!0);let a=null!==(i=null===r||void 0===r?void 0:r.target)&&void 0!==i?i:n.currentTarget;const o=null===a||void 0===a?void 0:a.getBoundingClientRect();let s,l,c=0,u=null;null!=n.clientX&&null!=n.clientY&&(l=n.clientX,u=n.clientY),o&&(null!=l&&null!=u?(s=l-o.left,c=u-o.top):(s=o.width/2,c=o.height/2)),this.type=e,this.pointerType=t,this.target=n.currentTarget,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.x=s,this.y=c}}const P=Symbol("linkClicked"),N="react-aria-pressable-style",k="data-react-aria-pressable";function R(e){let{onPress:t,onPressChange:n,onPressStart:o,onPressEnd:s,onPressUp:l,onClick:c,isDisabled:p,isPressed:f,preventFocusOnPress:m,shouldCancelOnPointerExit:M,allowTextSelectionOnPress:R,ref:I,...B}=function(e){let t=(0,C.useContext)(h.F);if(t){let{register:n,...r}=t;e=(0,g.v)(r,e),n()}return(0,v.w)(t,e.ref),e}(e),[F,z]=(0,C.useState)(!1),U=(0,C.useRef)({isPressed:!1,ignoreEmulatedMouseEvents:!1,didFirePressStart:!1,isTriggeringEvent:!1,activePointerId:null,target:null,isOverTarget:!1,pointerType:null,disposables:[]}),{addGlobalListener:V,removeAllGlobalListeners:G,removeGlobalListener:q}=(0,A.A)(),W=(0,C.useCallback)((e,t)=>{let r=U.current;if(p||r.didFirePressStart)return!1;let i=!0;if(r.isTriggeringEvent=!0,o){let n=new E("pressstart",t,e);o(n),i=n.shouldStopPropagation}return n&&n(!0),r.isTriggeringEvent=!1,r.didFirePressStart=!0,z(!0),i},[p,o,n]),H=(0,C.useCallback)((e,r,i=!0)=>{let a=U.current;if(!a.didFirePressStart)return!1;a.didFirePressStart=!1,a.isTriggeringEvent=!0;let o=!0;if(s){let t=new E("pressend",r,e);s(t),o=t.shouldStopPropagation}if(n&&n(!1),z(!1),t&&i&&!p){let n=new E("press",r,e);t(n),o&&(o=n.shouldStopPropagation)}return a.isTriggeringEvent=!1,o},[p,s,n,t]),$=(0,y.J)(H),K=(0,C.useCallback)((e,t)=>{let n=U.current;if(p)return!1;if(l){n.isTriggeringEvent=!0;let r=new E("pressup",t,e);return l(r),n.isTriggeringEvent=!1,r.shouldStopPropagation}return!0},[p,l]),X=(0,y.J)(K),Y=(0,C.useCallback)(e=>{let t=U.current;if(t.isPressed&&t.target){t.didFirePressStart&&null!=t.pointerType&&H(j(t.target,e),t.pointerType,!1),t.isPressed=!1,ae(null),t.isOverTarget=!1,t.activePointerId=null,t.pointerType=null,G(),R||d(t.target);for(let e of t.disposables)e();t.disposables=[]}},[R,G,H]),Q=(0,y.J)(Y),Z=(0,C.useCallback)(e=>{M&&Y(e)},[M,Y]),J=(0,C.useCallback)(e=>{p||null===c||void 0===c||c(e)},[p,c]),ee=(0,C.useCallback)((e,t)=>{if(!p&&c){let n=new MouseEvent("click",e);(0,r.o1)(n,t),c((0,r.eg)(n))}},[p,c]),te=(0,y.J)(ee),[ne,re]=(0,C.useState)(!1);(0,b.N)(()=>{let e=U.current;if(ne){let t=t=>{var n;if(e.isPressed&&e.target&&O(t,e.target)){var r;D((0,x.wt)(t),t.key)&&t.preventDefault();let n=(0,x.wt)(t),i=(0,x.sD)(e.target,(0,x.wt)(t));$(j(e.target,t),"keyboard",i),i&&te(t,e.target),G(),"Enter"!==t.key&&L(e.target)&&(0,x.sD)(e.target,n)&&!t[P]&&(t[P]=!0,(0,_.Fe)(e.target,t,!1)),e.isPressed=!1,re(!1),null===(r=e.metaKeyEvents)||void 0===r||r.delete(t.key)}else if("Meta"===t.key&&(null===(n=e.metaKeyEvents)||void 0===n?void 0:n.size)){var i;let t=e.metaKeyEvents;e.metaKeyEvents=void 0;for(let n of t.values())null===(i=e.target)||void 0===i||i.dispatchEvent(new KeyboardEvent("keyup",n))}},n=e.target,r=t=>{n&&O(t,n)&&!t.repeat&&(0,x.sD)(n,(0,x.wt)(t))&&e.target&&X(j(e.target,t),"keyboard")},i=(0,w.c)(r,t);return V((0,a.TW)(e.target),"keyup",i,!0),()=>{q((0,a.TW)(e.target),"keyup",i,!0)}}},[ne,V,G,q]);let[ie,ae]=(0,C.useState)(null);(0,b.N)(()=>{let e=U.current;if("pointer"===ie){let t=t=>{if(t.pointerId===e.activePointerId&&e.isPressed&&0===t.button&&e.target){if((0,x.sD)(e.target,(0,x.wt)(t))&&null!=e.pointerType){let n=!1,r=setTimeout(()=>{e.isPressed&&e.target instanceof HTMLElement&&(n?Q(t):((0,S.e)(e.target),e.target.click()))},80);V(t.currentTarget,"click",()=>n=!0,!0),e.disposables.push(()=>clearTimeout(r))}else Q(t);e.isOverTarget=!1}},n=e=>{Q(e)};return V((0,a.TW)(e.target),"pointerup",t,!1),V((0,a.TW)(e.target),"pointercancel",n,!1),()=>{q((0,a.TW)(e.target),"pointerup",t,!1),q((0,a.TW)(e.target),"pointercancel",n,!1)}}},[ie,V,q]);let oe=(0,C.useMemo)(()=>{let e=U.current,t={onKeyDown(t){if(O(t.nativeEvent,t.currentTarget)&&(0,x.sD)(t.currentTarget,(0,x.wt)(t.nativeEvent))){var n;D((0,x.wt)(t.nativeEvent),t.key)&&t.preventDefault();let r=!0;e.isPressed||t.repeat||(e.target=t.currentTarget,e.isPressed=!0,re(!0),e.pointerType="keyboard",r=W(t,"keyboard")),r&&t.stopPropagation(),t.metaKey&&(0,i.cX)()&&(null===(n=e.metaKeyEvents)||void 0===n||n.set(t.key,t.nativeEvent))}else"Meta"===t.key&&(e.metaKeyEvents=new Map)},onClick(t){if((!t||(0,x.sD)(t.currentTarget,(0,x.wt)(t.nativeEvent)))&&t&&0===t.button&&!e.isTriggeringEvent&&!_.Fe.isOpening){let n=!0;if(p&&t.preventDefault(),e.ignoreEmulatedMouseEvents||e.isPressed||"virtual"!==e.pointerType&&!(0,T.Y)(t.nativeEvent)){if(e.isPressed&&"keyboard"!==e.pointerType){let r=e.pointerType||t.nativeEvent.pointerType||"virtual",i=K(j(t.currentTarget,t),r),a=H(j(t.currentTarget,t),r,!0);n=i&&a,e.isOverTarget=!1,J(t),Y(t)}}else{let e=W(t,"virtual"),r=K(t,"virtual"),i=H(t,"virtual");J(t),n=e&&r&&i}e.ignoreEmulatedMouseEvents=!1,n&&t.stopPropagation()}}};return"undefined"!==typeof PointerEvent&&(t.onPointerDown=t=>{if(0!==t.button||!(0,x.sD)(t.currentTarget,(0,x.wt)(t.nativeEvent)))return;if((0,T.P)(t.nativeEvent))return void(e.pointerType="virtual");e.pointerType=t.pointerType;let n=!0;if(!e.isPressed){e.isPressed=!0,ae("pointer"),e.isOverTarget=!0,e.activePointerId=t.pointerId,e.target=t.currentTarget,R||u(e.target),n=W(t,e.pointerType);let r=(0,x.wt)(t.nativeEvent);"releasePointerCapture"in r&&r.releasePointerCapture(t.pointerId)}n&&t.stopPropagation()},t.onMouseDown=t=>{if((0,x.sD)(t.currentTarget,(0,x.wt)(t.nativeEvent))&&0===t.button){if(m){let n=(0,r.LE)(t.target);n&&e.disposables.push(n)}t.stopPropagation()}},t.onPointerUp=t=>{(0,x.sD)(t.currentTarget,(0,x.wt)(t.nativeEvent))&&"virtual"!==e.pointerType&&(0!==t.button||e.isPressed||K(t,e.pointerType||t.pointerType))},t.onPointerEnter=t=>{t.pointerId===e.activePointerId&&e.target&&!e.isOverTarget&&null!=e.pointerType&&(e.isOverTarget=!0,W(j(e.target,t),e.pointerType))},t.onPointerLeave=t=>{t.pointerId===e.activePointerId&&e.target&&e.isOverTarget&&null!=e.pointerType&&(e.isOverTarget=!1,H(j(e.target,t),e.pointerType,!1),Z(t))},t.onDragStart=e=>{(0,x.sD)(e.currentTarget,(0,x.wt)(e.nativeEvent))&&Y(e)}),t},[p,m,G,R,Y,Z,H,W,K,J,ee]);return(0,C.useEffect)(()=>{if(!I)return;const e=(0,a.TW)(I.current);if(!e||!e.head||e.getElementById(N))return;const t=e.createElement("style");t.id=N,t.textContent=`\n@layer {\n  [${k}] {\n    touch-action: pan-x pan-y pinch-zoom;\n  }\n}\n    `.trim(),e.head.prepend(t)},[I]),(0,C.useEffect)(()=>{let e=U.current;return()=>{var t;R||d(null!==(t=e.target)&&void 0!==t?t:void 0);for(let n of e.disposables)n();e.disposables=[]}},[R]),{isPressed:f||F,pressProps:(0,g.v)(B,oe,{[k]:!0})}}function L(e){return"A"===e.tagName&&e.hasAttribute("href")}function O(e,t){const{key:n,code:r}=e,i=t,o=i.getAttribute("role");return("Enter"===n||" "===n||"Spacebar"===n||"Space"===r)&&!(i instanceof(0,a.mD)(i).HTMLInputElement&&!B(i,n)||i instanceof(0,a.mD)(i).HTMLTextAreaElement||i.isContentEditable)&&!(("link"===o||!o&&L(i))&&"Enter"!==n)}function j(e,t){let n=t.clientX,r=t.clientY;return{currentTarget:e,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,altKey:t.altKey,clientX:n,clientY:r}}function D(e,t){return e instanceof HTMLInputElement?!B(e,t):function(e){return!(e instanceof HTMLInputElement)&&(e instanceof HTMLButtonElement?"submit"!==e.type&&"reset"!==e.type:!L(e))}(e)}const I=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function B(e,t){return"checkbox"===e.type||"radio"===e.type?" "===t:I.has(e.type)}},8917:function(e,t,n){"use strict";n.d(t,{xQ:function(){return a}});var r=n(5043),i=n(9674);function a(e=!0){const t=(0,r.useContext)(i.t);if(null===t)return[!0,null];const{isPresent:n,onExitComplete:a,register:o}=t,s=(0,r.useId)();(0,r.useEffect)(()=>{if(e)return o(s)},[e]);const l=(0,r.useCallback)(()=>e&&a&&a(s),[s,a,e]);return!n&&a?[!1,l]:[!0]}},8945:function(e,t,n){"use strict";n.d(t,{F:function(){return a},e:function(){return i}});var r=n(7475);function i(e){return{point:{x:e.pageX,y:e.pageY}}}const a=e=>t=>(0,r.M)(t)&&e(t,i(t))},8974:function(e){"use strict";const t=.2126,n=.7152,r=.0722;e.exports={applySaturationFloat:function(e,i,a,o){const s=1+o/100,l=t*e+n*i+r*a;return[Math.max(0,Math.min(1,l+(e-l)*s)),Math.max(0,Math.min(1,l+(i-l)*s)),Math.max(0,Math.min(1,l+(a-l)*s))]},applySaturation:function(e,i,a,o){const s=1+o/100,l=t*e+n*i+r*a;return[Math.max(0,Math.min(255,Math.round(l+(e-l)*s))),Math.max(0,Math.min(255,Math.round(l+(i-l)*s))),Math.max(0,Math.min(255,Math.round(l+(a-l)*s)))]},isDefaultSaturation:function(e){return null==e||0===e},LUM_R:t,LUM_G:n,LUM_B:r}},8987:function(e,t,n){"use strict";n.d(t,{P:function(){return o}});var r,i=n(5043);const a="undefined"!==typeof document?null!==(r=i.useInsertionEffect)&&void 0!==r?r:i.useLayoutEffect:()=>{};function o(e,t,n){let[r,o]=(0,i.useState)(e||t),s=(0,i.useRef)(r),l=(0,i.useRef)(void 0!==e),c=void 0!==e;(0,i.useEffect)(()=>{l.current;l.current=c},[c]);let u=c?e:r;a(()=>{s.current=u});let[,d]=(0,i.useReducer)(()=>({}),{}),h=(0,i.useCallback)((e,...t)=>{let r="function"===typeof e?e(s.current):e;Object.is(s.current,r)||(s.current=r,o(r),d(),null===n||void 0===n||n(r,...t))},[n]);return[u,h]}},8994:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return W}});var r=n(5043),i=n(8624),a=n(9277);n(6116);new Map;const o=(e,t)=>{const n=e.length,r=[],i=[],a=[];for(let c=0;c<n-1;c++)i.push(e[c+1]-e[c]),r.push(t[c+1]-t[c]),a.push(r[c]/i[c]);const o=[a[0]];for(let c=0;c<n-2;c++){const e=a[c],t=a[c+1];if(e*t<=0)o.push(0);else{const n=i[c],r=i[c+1],a=n+r;o.push(3*a/((a+r)/e+(a+n)/t))}}o.push(a[a.length-1]);const s=[],l=[];for(let c=0;c<n-1;c++){const e=o[c],t=a[c],n=1/i[c],r=e+o[c+1]-2*t;s.push((t-e-r)*n),l.push(r*n*n)}return r=>{let i=0;for(;i<n-2&&r>e[i+1];)i++;const a=r-e[i];return t[i]+o[i]*a+s[i]*a*a+l[i]*a*a*a}},s=e=>{const t=new Uint8Array(256),n=[...e].sort((e,t)=>e.x-t.x);if(n.length<2){for(let e=0;e<256;e++)t[e]=e;return t}const r=n.map(e=>e.x),i=n.map(e=>e.y),a=o(r,i);for(let o=0;o<256;o++)if(o<=n[0].x)t[o]=n[0].y;else if(o>=n[n.length-1].x)t[o]=n[n.length-1].y;else{const e=a(o);t[o]=Math.min(255,Math.max(0,Math.round(e)))}return t},l=e=>{const t=e.split("\n");let n=33;const r=[];for(let i of t){if(i=i.trim(),!i||i.startsWith("#"))continue;if(i.startsWith("LUT_3D_SIZE")){n=parseInt(i.split(/\s+/)[1]);continue}const e=i.split(/\s+/).map(parseFloat);e.length>=3&&!isNaN(e[0])&&r.push(e[0],e[1],e[2])}return{size:n,data:new Float32Array(r)}};function c(e,t,n,r=!1){if(!t)return null;switch(e){case"free":return null;case"original":{const e=t.naturalWidth||t.width,r=t.naturalHeight||t.height;return 90===Math.abs(n%180)?r/e:e/r}case"1:1":return 1;default:{const t=e.split(":");if(2===t.length){const e=parseFloat(t[0]),n=parseFloat(t[1]);return r?n/e:e/n}return null}}}function u(e,t,n,r){const i=r*Math.PI/180,a=Math.sin(i),o=Math.cos(i),s=Math.abs(a),l=Math.abs(o),c=t*l+n*s,u=t*s+n*l,d=t/2+.01,h=n/2+.01,p=(e,t)=>{const n=e*c-c/2,r=t*u-u/2,i=n*o+r*a,s=-n*a+r*o;return Math.abs(i)<=d&&Math.abs(s)<=h};return p(e.x,e.y)&&p(e.x+e.w,e.y)&&p(e.x,e.y+e.h)&&p(e.x+e.w,e.y+e.h)}var d=n(579);var h=({label:e,value:t,onChange:n,min:i,max:a,step:o=1,onMouseDown:s,onMouseUp:l,suffix:c="",displayFormatter:u})=>{const h=(0,r.useRef)(!1),p=(0,r.useCallback)(e=>{h.current=!0,s&&s()},[s]);return(0,r.useEffect)(()=>{const e=()=>{h.current&&(h.current=!1,l&&l())};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e)}},[l]),(0,d.jsxs)("div",{className:"control-group",style:{marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[(0,d.jsx)("label",{className:"iv-control-label",style:{width:90,flexShrink:0},children:e}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1},children:[(0,d.jsxs)("span",{style:{fontSize:11,color:"#ccc",fontFamily:"monospace",minWidth:32,textAlign:"right"},children:[u?u(t):t,c]}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,flex:1},children:[(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>{s&&s(),n(Math.max(i,Number((t-o).toFixed(2)))),l&&l()},children:"\u2212"}),(0,d.jsx)("input",{type:"range",min:i,max:a,step:o,value:t,onMouseDown:p,onTouchStart:p,onChange:e=>n(Number(e.target.value)),style:{flex:1,margin:"0 4px"}}),(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>{s&&s(),n(Math.min(a,Number((t+o).toFixed(2)))),l&&l()},children:"+"})]})]})]})};function p({curves:e,setCurves:t,activeChannel:n,setActiveChannel:i,isPicking:a,setIsPicking:s,pickedColor:l,histograms:c,pushToHistory:u}){const h=(0,r.useRef)(null),[p,f]=(0,r.useState)(null),m=(0,r.useRef)(null),g=260,v=150,A=()=>{const e=c&&c[n]?c[n]:new Array(256).fill(0);let t=0;for(let n=0;n<256;n++){const r=e[n]||0;r>t&&(t=r)}t<=0&&(t=1);let r="";for(let n=0;n<256;n++){const i=(e[n]||0)/t,a=n/255*g,o=v-127.5*i;r+=0===n?`M ${a} ${o}`:` L ${a} ${o}`}return r||"M 0 150 L 260 150"},y=()=>{switch(n){case"red":return"#ff4444";case"green":return"#44ff44";case"blue":return"#4444ff";default:return"#eee"}};return(0,r.useEffect)(()=>{if(null===p)return;const e=e=>{if(!h.current)return;const r=h.current.getBoundingClientRect(),i=e.clientX-r.left,a=255-(e.clientY-r.top)/r.height*255,o=i/r.width*255;m.current&&cancelAnimationFrame(m.current),m.current=requestAnimationFrame(()=>{t(e=>{const t=[...e[n]],r=p;let i=0,s=255;return r>0&&(i=t[r-1].x+1),r<t.length-1&&(s=t[r+1].x-1),t[r]={x:Math.min(s,Math.max(i,o)),y:Math.min(255,Math.max(0,a))},{...e,[n]:t}})})},r=()=>{f(null),m.current&&(cancelAnimationFrame(m.current),m.current=null)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",r)}},[p,n,t]),(0,d.jsxs)("div",{style:{background:"#111",padding:12,borderRadius:6,border:"1px solid #333"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,d.jsx)("label",{className:"iv-control-label",children:"TONE CURVE"}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>s(!a),style:{background:a?"#2e7d32":"transparent",border:a?"1px solid #1b5e20":"1px solid #444",color:a?"#fff":"#888",fontSize:10,padding:"2px 8px",borderRadius:3},children:a?"PICKING...":"PICK POINT"})]}),(0,d.jsx)("div",{style:{display:"flex",marginBottom:12,gap:4,background:"#222",padding:2,borderRadius:4},children:["rgb","red","green","blue"].map(e=>(0,d.jsx)("button",{onClick:()=>i(e),style:{flex:1,padding:"4px 0",fontSize:10,fontWeight:600,background:n===e?"#444":"transparent",color:"rgb"===e?"#fff":"red"===e?"#ff8888":"green"===e?"#88ff88":"#8888ff",border:"none",borderRadius:2,cursor:"pointer",transition:"all 0.2s"},children:e.toUpperCase()},e))}),(0,d.jsxs)("div",{ref:h,style:{position:"relative",width:"100%",height:150,border:"1px solid #333",background:"#000",cursor:"crosshair",borderRadius:2},onMouseDown:r=>{if(r.target!==h.current&&"svg"!==r.target.tagName)return;u();const i=h.current.getBoundingClientRect(),a={x:(r.clientX-i.left)/i.width*255,y:255-(r.clientY-i.top)/i.height*255},o=[...e[n],a].sort((e,t)=>e.x-t.x);t(e=>({...e,[n]:o}))},children:[(0,d.jsx)("div",{style:{position:"absolute",top:"25%",left:0,right:0,height:1,background:"#222",pointerEvents:"none"}}),(0,d.jsx)("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:1,background:"#222",pointerEvents:"none"}}),(0,d.jsx)("div",{style:{position:"absolute",top:"75%",left:0,right:0,height:1,background:"#222",pointerEvents:"none"}}),(0,d.jsx)("div",{style:{position:"absolute",left:"25%",top:0,bottom:0,width:1,background:"#222",pointerEvents:"none"}}),(0,d.jsx)("div",{style:{position:"absolute",left:"50%",top:0,bottom:0,width:1,background:"#222",pointerEvents:"none"}}),(0,d.jsx)("div",{style:{position:"absolute",left:"75%",top:0,bottom:0,width:1,background:"#222",pointerEvents:"none"}}),(0,d.jsxs)("svg",{width:"100%",height:"100%",viewBox:"0 0 260 150",preserveAspectRatio:"none",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[(0,d.jsx)("path",{d:`${A()} L 260 150 L 0 150 Z`,fill:(()=>{switch(n){case"red":return"rgba(255, 102, 102, 0.28)";case"green":return"rgba(102, 255, 102, 0.28)";case"blue":return"rgba(102, 102, 255, 0.28)";default:return"rgba(220, 220, 220, 0.23)"}})(),stroke:"none"}),(0,d.jsx)("path",{d:A(),fill:"none",stroke:(()=>{switch(n){case"red":return"rgba(255, 130, 130, 0.85)";case"green":return"rgba(130, 255, 130, 0.85)";case"blue":return"rgba(130, 130, 255, 0.85)";default:return"rgba(240, 240, 240, 0.9)"}})(),strokeWidth:"0.8",opacity:"0.7"})]}),l&&(0,d.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 260 150",preserveAspectRatio:"none",style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:"rgb"===n?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("line",{x1:l.r/255*g,y1:0,x2:l.r/255*g,y2:v,stroke:"#ff4444",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"}),(0,d.jsx)("line",{x1:l.g/255*g,y1:0,x2:l.g/255*g,y2:v,stroke:"#44ff44",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"}),(0,d.jsx)("line",{x1:l.b/255*g,y1:0,x2:l.b/255*g,y2:v,stroke:"#4444ff",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"})]}):(0,d.jsx)("line",{x1:l["red"===n?"r":"green"===n?"g":"b"]/255*g,y1:0,x2:l["red"===n?"r":"green"===n?"g":"b"]/255*g,y2:v,stroke:"red"===n?"#ff4444":"green"===n?"#44ff44":"#4444ff",strokeWidth:"1",strokeDasharray:"3,3"})}),(0,d.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 260 150",preserveAspectRatio:"none",style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:(0,d.jsx)("path",{d:(()=>{const t=[...e[n]].sort((e,t)=>e.x-t.x);let r="";if(t.length>=2){const e=t.map(e=>e.x),n=t.map(e=>e.y),i=o(e,n);r="M 0 "+(v-i(0)/255*v);for(let t=1;t<=g;t++){const e=i(t/g*255);r+=` L ${t} ${v-e/255*v}`}}else r="M 0 150 L 260 0";return r})(),stroke:y(),strokeWidth:"2",fill:"none"})}),e[n].map((r,i)=>(0,d.jsx)("div",{onMouseDown:e=>{e.stopPropagation(),e.preventDefault(),u(),f(i)},onContextMenu:r=>((r,i)=>{i.preventDefault(),i.stopPropagation();const a=e[n];if(0===r||r===a.length-1)return;u();const o=a.filter((e,t)=>t!==r);t(e=>({...e,[n]:o}))})(i,r),title:0===i||i===e[n].length-1?"Endpoint":"Right-click to remove",style:{position:"absolute",left:r.x/255*100+"%",top:100*(1-r.y/255)+"%",width:8,height:8,marginLeft:-4,marginTop:-4,borderRadius:"50%",background:"#fff",border:`2px solid ${y()}`,cursor:"move",zIndex:10,boxShadow:"0 0 4px rgba(0,0,0,0.5)"}},i))]}),(0,d.jsx)("div",{style:{fontSize:10,color:"#555",marginTop:6,textAlign:"center"},children:"Left-click to add/move \u2022 Right-click to remove"})]})}var f=n(4895);const m={red:{bg:"#ff4444",text:"#fff"},orange:{bg:"#ff8800",text:"#fff"},yellow:{bg:"#ffdd00",text:"#333"},green:{bg:"#44bb44",text:"#fff"},cyan:{bg:"#00cccc",text:"#fff"},blue:{bg:"#4488ff",text:"#fff"},purple:{bg:"#9944ff",text:"#fff"},magenta:{bg:"#ff44aa",text:"#fff"}},g={red:"Red",orange:"Orange",yellow:"Yellow",green:"Green",cyan:"Cyan",blue:"Blue",purple:"Purple",magenta:"Magenta"};function v({channel:e,params:t,onChange:n,onMouseDown:r,showLabel:i=!0}){const a=m[e],o=g[e],s=(null===t||void 0===t?void 0:t[e])||{hue:0,saturation:0,luminance:0},l=(t,r)=>{n(e,{...s,[t]:r})};return(0,d.jsxs)("div",{style:{marginBottom:i?8:0},children:[i&&(0,d.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,padding:"2px 6px",background:a.bg,borderRadius:3,width:"fit-content"},children:(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:a.text,textTransform:"uppercase",letterSpacing:.5},children:o})}),(0,d.jsxs)("div",{style:{paddingLeft:i?4:0},children:[(0,d.jsx)(A,{label:"Hue",value:s.hue,min:-180,max:180,onChange:e=>l("hue",e),onMouseDown:r,suffix:"\xb0"}),(0,d.jsx)(A,{label:"Saturation",value:s.saturation,min:-100,max:100,onChange:e=>l("saturation",e),onMouseDown:r}),(0,d.jsx)(A,{label:"Luminance",value:s.luminance,min:-100,max:100,onChange:e=>l("luminance",e),onMouseDown:r})]})]})}function A({label:e,value:t,min:n,max:r,onChange:i,onMouseDown:a,suffix:o=""}){return(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:11},children:[(0,d.jsx)("span",{style:{width:48,color:"#aaa"},children:e}),(0,d.jsx)("input",{type:"range",min:n,max:r,value:t,onChange:e=>i(Number(e.target.value)),onMouseDown:a,style:{flex:1,height:12}}),(0,d.jsxs)("span",{style:{width:36,textAlign:"right",color:"#ccc",fontFamily:"monospace",fontSize:10},children:[t,o]})]})}function y({hslParams:e,setHslParams:t,pushToHistory:n,collapsed:i=!1}){const[a,o]=(0,r.useState)(null),[s,l]=(0,r.useState)("compact"),c=(e,n)=>{t(t=>({...t,[e]:n}))},u=e=>{n&&n(),t(t=>({...t,[e]:{hue:0,saturation:0,luminance:0}}))},h=f.HSL_CHANNEL_ORDER.some(t=>{const n=null===e||void 0===e?void 0:e[t];return n&&(0!==n.hue||0!==n.saturation||0!==n.luminance)});return i?null:(0,d.jsxs)("div",{style:{padding:"8px 12px",background:"#1a1a1a",borderRadius:4,marginBottom:12},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,paddingBottom:6,borderBottom:"1px solid #333"},children:[(0,d.jsx)("span",{style:{fontSize:12,fontWeight:600,color:"#fff",letterSpacing:.5},children:"HSL Adjustment"}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>l("compact"===s?"expanded":"compact"),title:"compact"===s?"Expand All":"Compact Mode",style:{fontSize:10,padding:"2px 6px"},children:"compact"===s?"\u229e":"\u229f"}),h&&(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>{n&&n(),t({...f.DEFAULT_HSL_PARAMS})},title:"Reset All HSL",style:{fontSize:10,padding:"2px 6px",color:"#f88"},children:"\u21ba"})]})]}),"compact"===s&&(0,d.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:4,marginBottom:8},children:f.HSL_CHANNEL_ORDER.map(t=>{const n=m[t],r=(null===e||void 0===e?void 0:e[t])||{hue:0,saturation:0,luminance:0},i=0!==r.hue||0!==r.saturation||0!==r.luminance,s=a===t;return(0,d.jsx)("button",{onClick:()=>o(s?null:t),style:{padding:"4px 6px",background:s?n.bg:i?`${n.bg}40`:"#333",border:`1px solid ${i?n.bg:"#444"}`,borderRadius:3,color:s?n.text:i?n.bg:"#888",fontSize:10,cursor:"pointer",transition:"all 0.15s"},children:g[t]},t)})}),"compact"===s&&a&&(0,d.jsxs)("div",{style:{background:"#252525",padding:8,borderRadius:4,marginBottom:4},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[(0,d.jsx)("div",{style:{padding:"2px 6px",background:m[a].bg,borderRadius:3},children:(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:m[a].text,textTransform:"uppercase",letterSpacing:.5},children:g[a]})}),(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>u(a),style:{fontSize:9,padding:"1px 4px"},children:"\u21ba"})]}),(0,d.jsx)(v,{channel:a,params:e,onChange:c,onMouseDown:n,showLabel:!1})]}),"expanded"===s&&(0,d.jsx)("div",{style:{maxHeight:400,overflowY:"auto"},children:f.HSL_CHANNEL_ORDER.map(t=>(0,d.jsxs)("div",{style:{background:"#252525",padding:8,borderRadius:4,marginBottom:6},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[(0,d.jsx)("div",{style:{padding:"2px 6px",background:m[t].bg,borderRadius:3},children:(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:m[t].text,textTransform:"uppercase",letterSpacing:.5},children:g[t]})}),(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>u(t),style:{fontSize:9,padding:"1px 4px"},children:"\u21ba"})]}),(0,d.jsx)(v,{channel:t,params:e,onChange:c,onMouseDown:n,showLabel:!1})]},t))}),(0,d.jsx)("div",{style:{fontSize:9,color:"#666",marginTop:6,lineHeight:1.4},children:"\u70b9\u51fb\u989c\u8272\u5757\u5c55\u5f00\u8c03\u6574\u3002\u8272\u76f8\u504f\u79fb\u8303\u56f4 \xb1180\xb0\uff0c\u9971\u548c\u5ea6/\u660e\u5ea6 \xb1100\u3002"})]})}function b({hue:e,onChange:t,size:n=60}){const r=(e-90)*Math.PI/180,i=n/2-6,a=n/2+Math.cos(r)*i,o=n/2+Math.sin(r)*i;return(0,d.jsxs)("div",{onClick:e=>{const n=e.currentTarget.getBoundingClientRect(),r=n.width/2,i=n.height/2,a=e.clientX-n.left-r,o=e.clientY-n.top-i;let s=Math.atan2(o,a)*(180/Math.PI)+90;s<0&&(s+=360),t(Math.round(s))},style:{width:n,height:n,borderRadius:"50%",background:"conic-gradient(from 0deg, \n          hsl(0, 100%, 50%), \n          hsl(60, 100%, 50%), \n          hsl(120, 100%, 50%), \n          hsl(180, 100%, 50%), \n          hsl(240, 100%, 50%), \n          hsl(300, 100%, 50%), \n          hsl(360, 100%, 50%)\n        )",position:"relative",cursor:"crosshair",boxShadow:"inset 0 0 0 2px rgba(0,0,0,0.3)"},children:[(0,d.jsx)("div",{style:{position:"absolute",top:"25%",left:"25%",width:"50%",height:"50%",borderRadius:"50%",background:"#1a1a1a"}}),(0,d.jsx)("div",{style:{position:"absolute",left:a-4,top:o-4,width:8,height:8,borderRadius:"50%",background:`hsl(${e}, 100%, 50%)`,border:"2px solid white",boxShadow:"0 1px 3px rgba(0,0,0,0.5)"}})]})}function x({label:e,hue:t,saturation:n,onHueChange:r,onSaturationChange:i,onMouseDown:a,color:o="#fff"}){return(0,d.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:12,padding:"8px 0"},children:[(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:11,fontWeight:600,color:o,marginBottom:4},children:e}),(0,d.jsx)(b,{hue:t,onChange:r,size:56})]}),(0,d.jsxs)("div",{style:{flex:1},children:[(0,d.jsxs)("div",{style:{marginBottom:8},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,color:"#888",marginBottom:2},children:[(0,d.jsx)("span",{children:"Hue"}),(0,d.jsxs)("span",{style:{fontFamily:"monospace"},children:[t,"\xb0"]})]}),(0,d.jsx)("input",{type:"range",min:0,max:360,value:t,onChange:e=>r(Number(e.target.value)),onMouseDown:a,style:{width:"100%",background:"linear-gradient(to right, \n                hsl(0, 100%, 50%), \n                hsl(60, 100%, 50%), \n                hsl(120, 100%, 50%), \n                hsl(180, 100%, 50%), \n                hsl(240, 100%, 50%), \n                hsl(300, 100%, 50%), \n                hsl(360, 100%, 50%)\n              )",height:8,borderRadius:4}})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,color:"#888",marginBottom:2},children:[(0,d.jsx)("span",{children:"Saturation"}),(0,d.jsx)("span",{style:{fontFamily:"monospace"},children:n})]}),(0,d.jsx)("input",{type:"range",min:0,max:100,value:n,onChange:e=>i(Number(e.target.value)),onMouseDown:a,style:{width:"100%",background:`linear-gradient(to right, \n                hsl(${t}, 0%, 50%), \n                hsl(${t}, 100%, 50%)\n              )`,height:8,borderRadius:4}})]})]})]})}function _({splitToning:e,setSplitToning:t,pushToHistory:n,collapsed:i=!1}){const[a,o]=(0,r.useState)(!1),s=(0,r.useMemo)(()=>{var t;return{highlights:(null===e||void 0===e?void 0:e.highlights)||f.DEFAULT_SPLIT_TONE_PARAMS.highlights,midtones:(null===e||void 0===e?void 0:e.midtones)||f.DEFAULT_SPLIT_TONE_PARAMS.midtones,shadows:(null===e||void 0===e?void 0:e.shadows)||f.DEFAULT_SPLIT_TONE_PARAMS.shadows,balance:null!==(t=null===e||void 0===e?void 0:e.balance)&&void 0!==t?t:f.DEFAULT_SPLIT_TONE_PARAMS.balance}},[e]),l=e=>{t(t=>({...t,...e}))},c=(e,t)=>{l({highlights:{...s.highlights,[e]:t}})},u=(e,t)=>{l({midtones:{...s.midtones,[e]:t}})},h=(e,t)=>{l({shadows:{...s.shadows,[e]:t}})},p=0!==s.highlights.saturation||0!==s.midtones.saturation||0!==s.shadows.saturation;return i?null:(0,d.jsxs)("div",{style:{padding:"8px 12px",background:"#1a1a1a",borderRadius:4,marginBottom:12},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,paddingBottom:6,borderBottom:"1px solid #333"},children:[(0,d.jsx)("span",{style:{fontSize:12,fontWeight:600,color:"#fff",letterSpacing:.5},children:"Split Toning"}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>o(!a),title:"Presets",style:{fontSize:10,padding:"2px 6px"},children:"\u2605"}),p&&(0,d.jsx)("button",{className:"iv-btn-icon",onClick:()=>{n&&n(),t({...f.DEFAULT_SPLIT_TONE_PARAMS})},title:"Reset",style:{fontSize:10,padding:"2px 6px",color:"#f88"},children:"\u21ba"})]})]}),a&&(0,d.jsxs)("div",{style:{background:"#252525",padding:8,borderRadius:4,marginBottom:8},children:[(0,d.jsx)("div",{style:{fontSize:10,color:"#888",marginBottom:6},children:"Select a split toning preset:"}),(0,d.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:Object.entries(f.SPLIT_TONE_PRESETS).map(([e,r])=>(0,d.jsx)("button",{onClick:()=>(e=>{n&&n();const r=f.SPLIT_TONE_PRESETS[e];r&&t({highlights:{...r.highlights},midtones:r.midtones?{...r.midtones}:{hue:0,saturation:0},shadows:{...r.shadows},balance:r.balance}),o(!1)})(e),style:{padding:"4px 8px",background:"#333",border:"1px solid #444",borderRadius:3,color:"#ccc",fontSize:10,cursor:"pointer"},children:r.name},e))})]}),(0,d.jsx)(x,{label:"Highlights",hue:s.highlights.hue,saturation:s.highlights.saturation,onHueChange:e=>c("hue",e),onSaturationChange:e=>c("saturation",e),onMouseDown:n,color:"#ffcc00"}),(0,d.jsx)("div",{style:{height:1,background:"#333",margin:"4px 0"}}),(0,d.jsx)(x,{label:"Midtones",hue:s.midtones.hue,saturation:s.midtones.saturation,onHueChange:e=>u("hue",e),onSaturationChange:e=>u("saturation",e),onMouseDown:n,color:"#88dd88"}),(0,d.jsx)("div",{style:{height:1,background:"#333",margin:"4px 0"}}),(0,d.jsx)(x,{label:"Shadows",hue:s.shadows.hue,saturation:s.shadows.saturation,onHueChange:e=>h("hue",e),onSaturationChange:e=>h("saturation",e),onMouseDown:n,color:"#6688ff"}),(0,d.jsxs)("div",{style:{marginTop:8,padding:"8px 0",borderTop:"1px solid #333"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,color:"#888",marginBottom:4},children:[(0,d.jsx)("span",{children:"Shadows \u2190 Balance \u2192 Highlights"}),(0,d.jsx)("span",{style:{fontFamily:"monospace"},children:s.balance})]}),(0,d.jsx)("input",{type:"range",min:-100,max:100,value:s.balance,onChange:e=>l({balance:Number(e.target.value)}),onMouseDown:n,style:{width:"100%",background:"linear-gradient(to right, #6688ff, #444 50%, #ffcc00)",height:8,borderRadius:4}})]}),(0,d.jsx)("div",{style:{fontSize:9,color:"#666",marginTop:6,lineHeight:1.4},children:"\u9ad8\u5149\u7740\u8272\u5f71\u54cd\u4eae\u90e8\uff0c\u9634\u5f71\u7740\u8272\u5f71\u54cd\u6697\u90e8\u3002\u5e73\u8861\u63a7\u5236\u8fc7\u6e21\u533a\u57df\u3002"})]})}var w=n(7950);const S=e=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:e?"rgba(0,0,0,0.8)":"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},modal:{background:e?"#18181b":"#ffffff",borderRadius:12,width:"90%",maxWidth:700,maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden",border:e?"1px solid #27272a":"1px solid #e4e4e7"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",borderBottom:e?"1px solid #27272a":"1px solid #e4e4e7"},title:{fontSize:18,fontWeight:600,color:e?"#ECEDEE":"#11181C",margin:0},closeBtn:{background:"transparent",border:"none",color:e?"#71717a":"#a1a1aa",fontSize:24,cursor:"pointer",padding:4},toolbar:{display:"flex",gap:8,padding:"12px 20px",borderBottom:e?"1px solid #27272a":"1px solid #e4e4e7",alignItems:"center"},searchInput:{flex:1,padding:"8px 12px",background:e?"#27272a":"#f4f4f5",border:e?"1px solid #3f3f46":"1px solid #e4e4e7",borderRadius:6,color:e?"#ECEDEE":"#11181C",fontSize:14},uploadBtn:{padding:"8px 16px",background:e?"#27272a":"#f4f4f5",color:e?"#ECEDEE":"#11181C",border:e?"1px solid #3f3f46":"1px solid #e4e4e7",borderRadius:6,cursor:"pointer",fontSize:13},content:{flex:1,overflow:"auto",padding:20},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:12},card:{background:e?"#27272a":"#f4f4f5",borderRadius:8,padding:12,cursor:"pointer",border:"2px solid transparent",transition:"border-color 0.2s"},cardSelected:{borderColor:"#4a9eff"},cardHover:{borderColor:e?"#52525b":"#d4d4d8"},lutName:{fontSize:13,fontWeight:500,color:e?"#ECEDEE":"#11181C",marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},lutInfo:{fontSize:11,color:e?"#71717a":"#a1a1aa"},preview:{width:"100%",height:40,borderRadius:4,marginTop:8},footer:{display:"flex",justifyContent:"flex-end",gap:12,padding:"16px 20px",borderTop:e?"1px solid #27272a":"1px solid #e4e4e7"},btn:{padding:"10px 24px",borderRadius:6,border:"none",cursor:"pointer",fontSize:14,fontWeight:500},btnPrimary:{background:"#4a9eff",color:"#fff"},btnSecondary:{background:e?"#27272a":"#f4f4f5",color:e?"#ECEDEE":"#11181C",border:e?"1px solid #3f3f46":"1px solid #e4e4e7"},emptyState:{textAlign:"center",padding:40,color:e?"#71717a":"#a1a1aa"},loading:{textAlign:"center",padding:40,color:e?"#71717a":"#a1a1aa"},builtInBadge:{display:"inline-block",padding:"1px 4px",background:"#2d5a1d",color:"#8bc34a",borderRadius:3,fontSize:9,marginLeft:4}});function T(e){const t=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),n=t%360,r=2*t%360;return`linear-gradient(135deg, \n    hsl(${n}, 40%, 20%) 0%, \n    hsl(${(n+r)/2}, 50%, 40%) 50%, \n    hsl(${r}, 40%, 60%) 100%)`}function C({lut:e,selected:t,onClick:n,styles:i}){const[a,o]=(0,r.useState)(!1),s=e.name.startsWith("FilmGallery_");return(0,d.jsxs)("div",{style:{...i.card,...t?i.cardSelected:{},...a&&!t?i.cardHover:{}},onClick:n,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,d.jsxs)("div",{style:i.lutName,children:[e.name.replace(/\.(cube|3dl|csp|lut)$/i,""),s&&(0,d.jsx)("span",{style:i.builtInBadge,children:"\u5185\u7f6e"})]}),(0,d.jsx)("div",{style:i.lutInfo,children:e.type}),(0,d.jsx)("div",{style:{...i.preview,background:T(e.name)}})]})}function M({onClose:e,onSelect:t,currentLutName:n}){const[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[c,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(n||null),[f,m]=(0,r.useState)(""),[g,v]=(0,r.useState)(!1),A=(0,r.useRef)(null),y=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),b=S(y);(0,r.useEffect)(()=>{x(),p(n||null)},[n]);const x=async()=>{l(!0);try{const e=await(0,i.Po)();o(e.luts||[])}catch(e){console.error("Failed to load LUTs:",e)}finally{l(!1)}},_=a.filter(e=>e.name.toLowerCase().includes(f.toLowerCase()));return w.createPortal((0,d.jsx)("div",{style:b.overlay,onClick:t=>t.target===t.currentTarget&&e(),children:(0,d.jsxs)("div",{style:b.modal,children:[(0,d.jsxs)("div",{style:b.header,children:[(0,d.jsx)("h2",{style:b.title,children:"\u9009\u62e9 LUT"}),(0,d.jsx)("button",{style:b.closeBtn,onClick:e,children:"\xd7"})]}),(0,d.jsxs)("div",{style:b.toolbar,children:[(0,d.jsx)("input",{type:"text",placeholder:"\u641c\u7d22 LUT...",value:f,onChange:e=>m(e.target.value),style:b.searchInput}),(0,d.jsxs)("label",{style:{...b.uploadBtn,opacity:c?.7:1},children:[c?"\u4e0a\u4f20\u4e2d...":"\u4e0a\u4f20",(0,d.jsx)("input",{ref:A,type:"file",accept:".cube,.3dl,.csp,.lut",onChange:async e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const r=n.name.toLowerCase().split(".").pop();if(["cube","3dl","csp","lut"].includes(r)){u(!0);try{const e=await(0,i.Xd)(n);await x(),p(e.filename)}catch(e){console.error("Failed to upload LUT:",e),alert("\u4e0a\u4f20\u5931\u8d25: "+e.message)}finally{u(!1),e.target.value=""}}else alert("\u4ec5\u652f\u6301 .cube, .3dl, .csp, .lut \u683c\u5f0f")},style:{display:"none"},disabled:c})]})]}),(0,d.jsx)("div",{style:b.content,children:s?(0,d.jsx)("div",{style:b.loading,children:"\u52a0\u8f7d\u4e2d..."}):0===_.length?(0,d.jsx)("div",{style:b.emptyState,children:f?"\u672a\u627e\u5230\u5339\u914d\u7684 LUT":"\u6682\u65e0 LUT \u6587\u4ef6\uff0c\u8bf7\u4e0a\u4f20"}):(0,d.jsx)("div",{style:b.grid,children:_.map(e=>(0,d.jsx)(C,{lut:e,selected:h===e.name,onClick:()=>p(e.name),styles:b},e.name))})}),(0,d.jsxs)("div",{style:b.footer,children:[n&&(0,d.jsx)("button",{style:{...b.btn,...b.btnSecondary,marginRight:"auto"},onClick:()=>{t(null),e()},children:"\u6e05\u9664 LUT"}),(0,d.jsx)("button",{style:{...b.btn,...b.btnSecondary},onClick:e,children:"\u53d6\u6d88"}),(0,d.jsx)("button",{style:{...b.btn,...b.btnPrimary,opacity:g?.7:1},onClick:async()=>{if(h){v(!0);try{const n=await(0,i.br)(h);t({name:h,size:n.size,data:n.data,intensity:1}),e()}catch(n){console.error("Failed to load LUT:",n),alert("\u52a0\u8f7d LUT \u5931\u8d25: "+n.message)}finally{v(!1)}}else e()},disabled:g,children:g?"\u52a0\u8f7d\u4e2d...":"\u5e94\u7528"})]})]})}),document.body)}function E({photoId:e,sourceType:t="original",onDetectionResult:n,pushToHistory:a,cropRect:o,rotation:s,disabled:l=!1}){const[c,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[f,m]=(0,r.useState)(50),[g,v]=(0,r.useState)("auto"),[A,y]=(0,r.useState)(null),[b,x]=(0,r.useState)(null),_=o&&(0!==o.x||0!==o.y||1!==o.w||1!==o.h),w=(0,r.useCallback)(async()=>{if(e&&!c){u(!0),x(null);try{const r=await(0,i.E$)(e,{sensitivity:f,filmFormat:g,sourceType:t});if(console.log("\ud83d\udd0d Edge detection response:",r),r.success&&r.result)if(y(r.result),console.log("\ud83d\udcca Detection result:",{cropRect:r.result.cropRect,rotation:r.result.rotation,confidence:r.result.confidence,isValid:r.result.isValid}),r.result.isValid){console.log("\u2705 Applying valid detection result to cropRect");r.result.confidence<.2&&r.result.cropRect.w>.98&&r.result.cropRect.h>.98&&x("\u26a0\ufe0f No film borders detected. Image appears to be already cropped or has no borders."),a&&a(),n&&n(r.result)}else console.warn("\u26a0\ufe0f Detection result is invalid (low confidence or bad geometry)"),x("Low detection confidence, please adjust sensitivity or crop manually");else console.error("\u274c Edge detection failed:",r.error),x(r.error||"Edge detection failed")}catch(r){console.error("\u274c Edge detection error:",r),x(r.message||"Edge detection failed")}finally{u(!1)}}},[e,f,g,t,a,n,c]);return(0,d.jsxs)("div",{style:{marginBottom:8},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,d.jsx)("button",{className:"iv-btn "+(c?"iv-btn-primary":""),onClick:w,disabled:l||c,style:{flex:1,padding:"6px 12px",fontSize:11,display:"flex",alignItems:"center",justifyContent:"center",gap:6},title:"Auto detect edges for cropping",children:c?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"spinner",style:{width:12,height:12}}),"Detecting..."]}):(0,d.jsx)(d.Fragment,{children:"\ud83d\udd0d Auto Detect Edges"})}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>p(!h),style:{padding:"6px 8px",fontSize:11},title:"Detection Settings",children:"\u2699"})]}),_&&!c&&(0,d.jsx)("div",{style:{marginTop:6,padding:"4px 8px",background:"#4a3520",borderRadius:4,fontSize:10,color:"#ffa500"},children:"\u26a0 Manual crop area exists, auto detection will override"}),b&&(0,d.jsx)("div",{style:{marginTop:6,padding:"4px 8px",background:"#402020",borderRadius:4,fontSize:10,color:"#ff6b6b"},children:b}),A&&A.isValid&&!b&&(0,d.jsxs)("div",{style:{marginTop:6,padding:"4px 8px",background:"#203520",borderRadius:4,fontSize:10,color:"#90ee90"},children:["\u2713 Detection complete (Confidence: ",(100*A.confidence).toFixed(0),"%)",0!==A.rotation&&(0,d.jsxs)("span",{style:{marginLeft:8},children:["Rotation: ",A.rotation.toFixed(1),"\xb0"]})]}),h&&(0,d.jsxs)("div",{style:{marginTop:8,padding:8,background:"#252525",borderRadius:4,border:"1px solid #333"},children:[(0,d.jsxs)("div",{style:{marginBottom:8},children:[(0,d.jsxs)("label",{style:{display:"block",fontSize:10,color:"#999",marginBottom:4},children:["Sensitivity: ",f]}),(0,d.jsx)("input",{type:"range",min:"0",max:"100",value:f,onChange:e=>m(parseInt(e.target.value)),style:{width:"100%"}}),(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:"#666"},children:[(0,d.jsx)("span",{children:"Low (Fewer edges)"}),(0,d.jsx)("span",{children:"High (More edges)"})]})]}),(0,d.jsxs)("div",{style:{marginBottom:8},children:[(0,d.jsx)("label",{style:{display:"block",fontSize:10,color:"#999",marginBottom:4},children:"Film Format"}),(0,d.jsxs)("select",{value:g,onChange:e=>v(e.target.value),style:{width:"100%",background:"#333",color:"#eee",border:"1px solid #444",borderRadius:4,padding:"4px 6px",fontSize:11},children:[(0,d.jsx)("option",{value:"auto",children:"Auto detect"}),(0,d.jsx)("option",{value:"35mm",children:"35mm (3:2)"}),(0,d.jsx)("option",{value:"120",children:"120 Medium Format"}),(0,d.jsx)("option",{value:"4x5",children:"4x5 Large Format"})]})]}),A&&A.debugInfo&&(0,d.jsxs)("div",{style:{marginTop:8,padding:4,background:"#1a1a1a",borderRadius:2,fontSize:9,color:"#666",fontFamily:"monospace"},children:["Processing Time: ",A.debugInfo.totalTimeMs,"ms",(0,d.jsx)("br",{}),"Edge Pixels: ",A.debugInfo.edgePixelCount,(0,d.jsx)("br",{}),"Lines Detected: ",A.debugInfo.linesDetected]})]})]})}function P({filmCurveProfile:e,setFilmCurveProfile:t,filmCurveProfiles:n,setFilmCurveProfiles:a,pushToHistory:o}){var s,l,c;const[u,h]=r.useState(!1),[p,f]=r.useState(null),[m,g]=r.useState(""),[v,A]=r.useState(1),[y,b]=r.useState(.1),[x,_]=r.useState(2.4),w=r.useMemo(()=>{const e={};return(n||[]).forEach(t=>{const n=t.category||"other";e[n]||(e[n]=[]),e[n].push(t)}),e},[n]),S={color_negative:"Color Negative",bw_negative:"B&W Negative",slide:"Slide",custom:"Custom",generic:"Generic",other:"Other"},T=null===n||void 0===n?void 0:n.find(t=>t.key===e);return(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[(0,d.jsx)("select",{value:e,onChange:e=>{o(),t(e.target.value)},style:{flex:1,padding:"6px 8px",fontSize:11,background:"#1a1a1a",border:"1px solid #444",borderRadius:4,color:"#eee",cursor:"pointer"},children:Object.entries(w).map(([e,t])=>(0,d.jsx)("optgroup",{label:S[e]||e,children:t.map(e=>(0,d.jsx)("option",{value:e.key,children:e.name},e.key))},e))}),(0,d.jsx)("button",{onClick:()=>{f(null),h(!u),g(""),A(1),b(.1),_(2.4)},style:{fontSize:10,padding:"4px 8px",background:"#444",border:"none",borderRadius:3,color:"#eee",cursor:"pointer"},title:"Create new profile",children:"+"}),T&&!T.isBuiltin&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:()=>{return f(e=T),g(e.name),A(e.gamma),b(e.dMin),_(e.dMax),void h(!0);var e},style:{fontSize:10,padding:"4px 8px",background:"#444",border:"none",borderRadius:3,color:"#eee",cursor:"pointer"},title:"Edit profile",children:"\u270e"}),(0,d.jsx)("button",{onClick:()=>(async n=>{if(!n.isBuiltin&&window.confirm(`Delete profile "${n.name}"?`))try{await(0,i.Ut)(n.id),a(e=>e.filter(e=>e.id!==n.id)),e===n.key&&t("default")}catch(r){console.error("Failed to delete film curve profile",r)}})(T),style:{fontSize:10,padding:"4px 8px",background:"#533",border:"none",borderRadius:3,color:"#eee",cursor:"pointer"},title:"Delete profile",children:"\xd7"})]})]}),T&&(0,d.jsxs)("div",{style:{fontSize:10,color:"#666",marginBottom:8,display:"flex",gap:12},children:[(0,d.jsxs)("span",{children:["\u03b3=",null===(s=T.gamma)||void 0===s?void 0:s.toFixed(2)]}),(0,d.jsxs)("span",{children:["Dmin=",null===(l=T.dMin)||void 0===l?void 0:l.toFixed(2)]}),(0,d.jsxs)("span",{children:["Dmax=",null===(c=T.dMax)||void 0===c?void 0:c.toFixed(2)]})]}),u&&(0,d.jsxs)("div",{style:{background:"#1a1a1a",padding:10,borderRadius:4,marginTop:8},children:[(0,d.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#aaa",marginBottom:8},children:p?"Edit Profile":"New Profile"}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,d.jsx)("input",{type:"text",placeholder:"Profile Name",value:m,onChange:e=>g(e.target.value),style:{padding:"6px 8px",fontSize:11,background:"#222",border:"1px solid #444",borderRadius:3,color:"#eee"}}),(0,d.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,d.jsxs)("label",{style:{flex:1,fontSize:10,color:"#888"},children:["Gamma",(0,d.jsx)("input",{type:"number",step:"0.05",min:"0.5",max:"3.0",value:v,onChange:e=>A(e.target.value),style:{width:"100%",marginTop:2,padding:"4px 6px",fontSize:11,background:"#222",border:"1px solid #444",borderRadius:3,color:"#eee"}})]}),(0,d.jsxs)("label",{style:{flex:1,fontSize:10,color:"#888"},children:["Dmin",(0,d.jsx)("input",{type:"number",step:"0.01",min:"0.0",max:"0.5",value:y,onChange:e=>b(e.target.value),style:{width:"100%",marginTop:2,padding:"4px 6px",fontSize:11,background:"#222",border:"1px solid #444",borderRadius:3,color:"#eee"}})]}),(0,d.jsxs)("label",{style:{flex:1,fontSize:10,color:"#888"},children:["Dmax",(0,d.jsx)("input",{type:"number",step:"0.1",min:"1.5",max:"4.0",value:x,onChange:e=>_(e.target.value),style:{width:"100%",marginTop:2,padding:"4px 6px",fontSize:11,background:"#222",border:"1px solid #444",borderRadius:3,color:"#eee"}})]})]}),(0,d.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,d.jsx)("button",{onClick:()=>{h(!1),f(null)},style:{fontSize:10,padding:"4px 12px",background:"#333",border:"none",borderRadius:3,color:"#aaa",cursor:"pointer"},children:"Cancel"}),(0,d.jsx)("button",{onClick:p?async()=>{if(p&&!p.isBuiltin)try{await(0,i.uD)(p.id,{name:m.trim()||p.name,gamma:parseFloat(v)||p.gamma,dMin:parseFloat(y)||p.dMin,dMax:parseFloat(x)||p.dMax,category:p.category}),a(e=>e.map(e=>e.id===p.id?{...e,name:m.trim()||e.name,gamma:parseFloat(v),dMin:parseFloat(y),dMax:parseFloat(x)}:e)),f(null),h(!1)}catch(e){console.error("Failed to update film curve profile",e)}}:async()=>{if(m.trim())try{const e=await(0,i.xH)({name:m.trim(),gamma:parseFloat(v)||1,dMin:parseFloat(y)||.1,dMax:parseFloat(x)||2.4,category:"custom"});e&&e.key&&(a(t=>[...t,e]),t(e.key),h(!1),g(""),A(1),b(.1),_(2.4))}catch(e){console.error("Failed to create film curve profile",e)}},style:{fontSize:10,padding:"4px 12px",background:"#446",border:"none",borderRadius:3,color:"#eee",cursor:"pointer"},children:p?"Update":"Create"})]})]})]})]})}function N({densityLevelsEnabled:e,setDensityLevelsEnabled:t,densityLevels:n,setDensityLevels:i,handleDensityAutoLevels:a,handleResetDensityLevels:o,pushToHistory:s}){const[l,c]=r.useState(!1),u=(e,t,n)=>{s&&s(),i(r=>({...r,[e]:{...r[e],[t]:parseFloat(n)||0}}))};return(0,d.jsxs)("div",{style:{marginTop:8},children:[(0,d.jsxs)("div",{onClick:()=>c(!l),style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 0",borderTop:"1px dashed #444"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,d.jsx)("span",{style:{fontSize:10,color:"#888"},children:l?"\u25bc":"\u25b6"}),(0,d.jsx)("span",{style:{fontSize:10,fontWeight:600,color:"#888"},children:"DENSITY LEVELS"}),e&&(0,d.jsx)("span",{style:{fontSize:9,padding:"1px 4px",background:"#2e7d32",borderRadius:2,color:"#fff"},children:"ON"})]}),!l&&(0,d.jsx)("span",{style:{fontSize:9,color:"#666",maxWidth:160,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(()=>{if(!e)return"Disabled";const{red:t,green:r,blue:i}=n;return`R:${t.min.toFixed(2)}-${t.max.toFixed(2)} G:${r.min.toFixed(2)}-${r.max.toFixed(2)} B:${i.min.toFixed(2)}-${i.max.toFixed(2)}`})()})]}),l&&(0,d.jsxs)("div",{style:{padding:8,background:"#1a1a1a",borderRadius:4,marginTop:4,border:"1px solid #333"},children:[(0,d.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:(0,d.jsxs)("label",{style:{fontSize:10,color:"#aaa",cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[(0,d.jsx)("input",{type:"checkbox",checked:e,onChange:e=>{s&&s(),t(e.target.checked)},style:{margin:0}}),"Enable Density Levels"]})}),(0,d.jsxs)("div",{style:{opacity:e?1:.5,pointerEvents:e?"auto":"none"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:6},children:[(0,d.jsx)("span",{style:{fontSize:10,color:"#f44336",width:14},children:"R"}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"3",value:n.red.min,onChange:e=>u("red","min",e.target.value),style:{width:50,fontSize:10,padding:"2px 4px",background:"#2a2a2a",border:"1px solid #444",borderRadius:2,color:"#eee",textAlign:"center"}}),(0,d.jsx)("div",{style:{flex:1,height:4,background:"linear-gradient(to right, #400, #f44336)",borderRadius:2}}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"3",value:n.red.max,onChange:e=>u("red","max",e.target.value),style:{width:50,fontSize:10,padding:"2px 4px",background:"#2a2a2a",border:"1px solid #444",borderRadius:2,color:"#eee",textAlign:"center"}})]}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:6},children:[(0,d.jsx)("span",{style:{fontSize:10,color:"#4caf50",width:14},children:"G"}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"3",value:n.green.min,onChange:e=>u("green","min",e.target.value),style:{width:50,fontSize:10,padding:"2px 4px",background:"#2a2a2a",border:"1px solid #444",borderRadius:2,color:"#eee",textAlign:"center"}}),(0,d.jsx)("div",{style:{flex:1,height:4,background:"linear-gradient(to right, #040, #4caf50)",borderRadius:2}}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"3",value:n.green.max,onChange:e=>u("green","max",e.target.value),style:{width:50,fontSize:10,padding:"2px 4px",background:"#2a2a2a",border:"1px solid #444",borderRadius:2,color:"#eee",textAlign:"center"}})]}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:8},children:[(0,d.jsx)("span",{style:{fontSize:10,color:"#2196f3",width:14},children:"B"}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"3",value:n.blue.min,onChange:e=>u("blue","min",e.target.value),style:{width:50,fontSize:10,padding:"2px 4px",background:"#2a2a2a",border:"1px solid #444",borderRadius:2,color:"#eee",textAlign:"center"}}),(0,d.jsx)("div",{style:{flex:1,height:4,background:"linear-gradient(to right, #004, #2196f3)",borderRadius:2}}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"3",value:n.blue.max,onChange:e=>u("blue","max",e.target.value),style:{width:50,fontSize:10,padding:"2px 4px",background:"#2a2a2a",border:"1px solid #444",borderRadius:2,color:"#eee",textAlign:"center"}})]}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsx)("button",{className:"iv-btn",onClick:a,style:{flex:1,fontSize:10,padding:"4px 8px"},title:"Analyze image and auto-detect density range",children:"AUTO ANALYZE"}),(0,d.jsx)("button",{className:"iv-btn",onClick:o,style:{fontSize:10,padding:"4px 8px"},title:"Reset to default (0.00 - 3.00)",children:"RESET"})]})]}),(0,d.jsx)("div",{style:{marginTop:8,fontSize:9,color:"#666",lineHeight:1.4},children:"Density Levels works in the log domain before inversion. Use AUTO ANALYZE to detect the actual density range of your negative, then the system will stretch it to full range for optimal contrast."})]})]})}function k({onFinishBatchParams:e,currentParams:t,photoId:n,sourceType:i="original",inverted:a,setInverted:o,useGPU:s,setUseGPU:l,inversionMode:c,setInversionMode:u,filmType:f,setFilmType:m,filmCurveEnabled:g,setFilmCurveEnabled:v,filmCurveProfile:A,setFilmCurveProfile:b,filmCurveProfiles:x,setFilmCurveProfiles:w,baseMode:S,setBaseMode:T,isPickingBase:C,setIsPickingBase:k,handleAutoBase:R,densityLevelsEnabled:L,setDensityLevelsEnabled:O,densityLevels:j,setDensityLevels:D,handleDensityAutoLevels:I,handleResetDensityLevels:B,isPickingWB:F,setIsPickingWB:z,handleAutoColor:U,handleUndo:V,handleRedo:G,handleReset:q,history:W,future:H,handleAutoLevels:$,isCropping:K,setIsCropping:X,onCropDone:Y,ratioMode:Q,setRatioMode:Z,ratioSwap:J,setRatioSwap:ee,rotation:te,setRotation:ne,cropRect:re,setCropRect:ie,onAutoEdgeDetection:ae,onRotateStart:oe,onRotateEnd:se,setOrientation:le,exposure:ce,setExposure:ue,contrast:de,setContrast:he,highlights:pe,setHighlights:fe,shadows:me,setShadows:ge,whites:ve,setWhites:Ae,blacks:ye,setBlacks:be,temp:xe,setTemp:_e,tint:we,setTint:Se,curves:Te,setCurves:Ce,activeChannel:Me,setActiveChannel:Ee,isPicking:Pe,setIsPicking:Ne,pickedColor:ke,histograms:Re,pushToHistory:Le,hslParams:Oe,setHslParams:je,splitToning:De,setSplitToning:Ie,saturation:Be,setSaturation:Fe,lut1:ze,setLut1:Ue,lut2:Ve,setLut2:Ge,lutExportSize:qe,setLutExportSize:We,generateOutputLUT:He,handleLutUpload:$e,compareMode:Ke,setCompareMode:Xe,compareSlider:Ye,setCompareSlider:Qe,presets:Ze,onSavePreset:Je,onApplyPreset:et,onDeletePreset:tt,onApplyPresetToRoll:nt,handleDownload:rt,handleSave:it,onClose:at,onHighQualityExport:ot,highQualityBusy:st,onGpuExport:lt,gpuBusy:ct,exportFormat:ut,setExportFormat:dt}){const[ht,pt]=r.useState(""),[ft,mt]=r.useState(!1),[gt,vt]=r.useState(1),At=Ze.some(e=>e.name===ht.trim()),yt=e=>{Xe(Ke===e?"off":e)},bt=e=>{vt(e),mt(!0)},xt={original:{label:"ORIG",color:"#4caf50"},negative:{label:"NEG",color:"#2196f3"},positive:{label:"POS",color:"#ff9800"}},_t=xt[i]||xt.original;return(0,d.jsxs)("div",{className:"iv-sidebar custom-scrollbar",style:{width:320,background:"#1e1e1e",padding:24,color:"#eee",display:"flex",flexDirection:"column",gap:20,overflowY:"auto",borderLeft:"1px solid #333",boxShadow:"-5px 0 15px rgba(0,0,0,0.5)"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,d.jsx)("h3",{style:{margin:0,color:"#fff",fontSize:18,fontWeight:600,letterSpacing:.5},children:"Film Lab"}),(0,d.jsxs)("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:4,background:_t.color+"22",color:_t.color,fontWeight:500},children:[_t.icon," ",_t.label]})]}),(0,d.jsx)("button",{className:"iv-btn-icon",onClick:at,style:{fontSize:20},children:"\xd7"})]}),(0,d.jsx)("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:e?(0,d.jsx)("button",{className:"iv-btn iv-btn-primary",onClick:()=>e(t),style:{padding:"6px 12px",background:"#2196F3",borderColor:"#1976D2",fontWeight:600,flex:"1 1 auto"},children:"\u2713 FINISH PARAMETERS"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"iv-btn iv-btn-primary",onClick:it,style:{padding:"6px 12px",flex:"1 1 auto",minWidth:60},title:"\u4fdd\u5b58\u5904\u7406\u7ed3\u679c\u5230\u6b63\u7247\u5e93\uff08\u59cb\u7ec8\u5199\u5165JPEG\uff09",children:"SAVE"}),(0,d.jsx)("button",{className:"iv-btn",onClick:ot,disabled:st,style:{padding:"6px 12px",background:st?"#555":"#444",borderColor:st?"#666":"#555",flex:"1 1 auto",minWidth:80},title:"\u670d\u52a1\u5668\u57fa\u4e8e\u539f\u59cb\u9ad8\u4f4d\u6df1\u626b\u63cf\u751f\u6210\u9ad8\u8d28\u91cf\u6b63\u7247",children:st?"EXPORTING\u2026":"HQ EXPORT"}),"undefined"!==typeof window&&window.__electron&&(0,d.jsx)("button",{className:"iv-btn",onClick:lt,disabled:ct,style:{padding:"6px 12px",flex:"1 1 auto",minWidth:80},title:"Electron+WebGL GPU \u5bfc\u51fa\uff08\u79bb\u7ebf\u5de5\u4f5c\u7a97\u53e3\uff09",children:ct?"GPU\u2026":"GPU EXPORT"})]})}),!e&&(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,background:"#252525",padding:10,borderRadius:6},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:"#aaa"},children:"SAVE AS"}),(0,d.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,d.jsx)("label",{style:{fontSize:10,color:"#aaa"},children:"Format"}),(0,d.jsxs)("select",{value:ut,onChange:e=>dt(e.target.value),style:{background:"#333",color:"#eee",border:"1px solid #444",fontSize:10,borderRadius:3,padding:"2px 4px"},children:[(0,d.jsx)("option",{value:"jpeg",children:"JPEG"}),(0,d.jsx)("option",{value:"tiff16",children:"TIFF 16-bit"}),(0,d.jsx)("option",{value:"both",children:"Both"})]}),(0,d.jsx)("button",{className:"iv-btn",onClick:rt,style:{padding:"4px 12px"},title:"\u4e0b\u8f7d\u5f53\u524d\u5904\u7406\u7ed3\u679c\uff08\u4e0d\u5199\u5165\u6b63\u7247\u5e93\uff09",children:"DOWNLOAD"})]})]}),(0,d.jsx)("div",{style:{fontSize:10,color:"#666",lineHeight:1.4},children:"\u201cSAVE\u201d \u5199\u5165\u6b63\u7247\u5e93\uff08JPEG\uff09\u3002 \u201cSAVE AS\u201d/\u201cDOWNLOAD\u201d \u4e3a\u4e34\u65f6\u6587\u4ef6\uff0c\u53ef\u9009\u62e9\u683c\u5f0f\uff0c\u4e0d\u6539\u53d8\u5e93\u3002"})]}),(0,d.jsxs)("div",{style:{background:"#252525",padding:10,borderRadius:6,display:"flex",flexDirection:"column",gap:8},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,opacity:"positive"===i?.5:1},children:[(0,d.jsx)("input",{type:"checkbox",checked:a,onChange:e=>{Le(),o(e.target.checked)},id:"chk-invert",disabled:"positive"===i}),(0,d.jsx)("label",{htmlFor:"chk-invert",style:{fontWeight:500,fontSize:13,cursor:"positive"===i?"not-allowed":"pointer"},children:"Invert Negative"})]}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,d.jsx)("input",{type:"checkbox",id:"chk-gpu",checked:s,onChange:e=>l(e.target.checked)}),(0,d.jsx)("label",{htmlFor:"chk-gpu",style:{fontSize:12,color:"#ccc",cursor:"pointer"},children:"Use GPU (WebGL)"})]}),a&&(0,d.jsxs)("div",{style:{display:"flex",gap:4,background:"#111",padding:2,borderRadius:4},children:[(0,d.jsx)("button",{onClick:()=>{Le(),u("linear")},style:{fontSize:10,padding:"2px 6px",border:"none",borderRadius:2,cursor:"pointer",background:"linear"===c?"#444":"transparent",color:"linear"===c?"#fff":"#666"},title:"Standard linear inversion",children:"Linear"}),(0,d.jsx)("button",{onClick:()=>{Le(),u("log")},style:{fontSize:10,padding:"2px 6px",border:"none",borderRadius:2,cursor:"pointer",background:"log"===c?"#444":"transparent",color:"log"===c?"#fff":"#666"},title:"Soft logarithmic inversion - preserves more shadow detail",children:"Soft"})]})]}),a&&(0,d.jsxs)("div",{style:{borderTop:"1px solid #333",paddingTop:8},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[(0,d.jsx)("input",{type:"checkbox",checked:g,onChange:e=>{Le(),v(e.target.checked)},id:"chk-film-curve"}),(0,d.jsx)("label",{htmlFor:"chk-film-curve",style:{fontWeight:500,fontSize:13,cursor:"pointer"},children:"Film Curve"}),(0,d.jsx)("span",{style:{fontSize:9,color:"#666"},children:"(H&D Model)"})]}),g&&(0,d.jsx)(P,{filmCurveProfile:A,setFilmCurveProfile:b,filmCurveProfiles:x,setFilmCurveProfiles:w,pushToHistory:Le})]}),(0,d.jsxs)("div",{style:{marginBottom:8,borderTop:"1px solid #333",paddingTop:8},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:"#aaa"},children:"FILM BASE"}),(0,d.jsxs)("div",{style:{display:"flex",gap:2},children:[(0,d.jsx)("button",{onClick:()=>T&&T("linear"),title:"Linear: Traditional multiplicative gain correction",style:{padding:"2px 6px",fontSize:10,background:"linear"===S?"#1565c0":"#333",border:"1px solid",borderColor:"linear"===S?"#2196f3":"#444",borderRadius:3,color:"linear"===S?"#fff":"#999",cursor:"pointer"},children:"Linear"}),(0,d.jsx)("button",{onClick:()=>T&&T("log"),title:"Log: Physically accurate density-domain correction (Beer-Lambert law)",style:{padding:"2px 6px",fontSize:10,background:"log"===S?"#1565c0":"#333",border:"1px solid",borderColor:"log"===S?"#2196f3":"#444",borderRadius:3,color:"log"===S?"#fff":"#999",cursor:"pointer"},children:"Log"})]})]}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{C||X(!1),k(!C)},style:{flex:1,background:C?"#e65100":"#333",borderColor:C?"#ef6c00":"#444",color:C?"#fff":"#eee",fontSize:11},children:C?"PICKING...":"PICK (MANUAL)"}),(0,d.jsx)("button",{className:"iv-btn",onClick:R,style:{flex:1,fontSize:11},children:"AUTO DETECT"})]}),"log"===S&&(0,d.jsx)(N,{densityLevelsEnabled:L,setDensityLevelsEnabled:O,densityLevels:j,setDensityLevels:D,handleDensityAutoLevels:I,handleResetDensityLevels:B,pushToHistory:Le})]}),(0,d.jsxs)("div",{style:{marginBottom:8},children:[(0,d.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#aaa",marginBottom:4},children:"WHITE BALANCE"}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{F||X(!1),z(!F)},style:{flex:1,background:F?"#e65100":"#333",borderColor:F?"#ef6c00":"#444",color:F?"#fff":"#eee",fontSize:11},children:F?"PICKING...":"PICK (MANUAL)"}),(0,d.jsx)("button",{className:"iv-btn",onClick:U,style:{flex:1,fontSize:11},children:"AUTO WB"})]})]})]}),(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,d.jsx)("button",{className:"iv-btn",onClick:V,disabled:0===W.length,style:{flex:1},children:"Undo"}),(0,d.jsx)("button",{className:"iv-btn",onClick:G,disabled:0===H.length,style:{flex:1},children:"Redo"}),(0,d.jsx)("button",{className:"iv-btn iv-btn-danger",onClick:q,style:{flex:1},children:"Reset"})]}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,background:"#252525",padding:10,borderRadius:6},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:"#aaa"},children:"COMPARE"}),(0,d.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,d.jsx)("button",{className:"iv-btn",style:{fontSize:10,padding:"4px 8px",background:"original"===Ke?"#2e7d32":"#333",borderColor:"original"===Ke?"#1b5e20":"#444"},onClick:()=>yt("original"),children:"ORIGINAL"}),(0,d.jsx)("button",{className:"iv-btn",style:{fontSize:10,padding:"4px 8px",background:"split"===Ke?"#2e7d32":"#333",borderColor:"split"===Ke?"#1b5e20":"#444"},onClick:()=>yt("split"),children:"SPLIT"})]})]}),"split"===Ke&&(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,d.jsx)("input",{type:"range",min:0,max:1,step:.01,value:Ye,onChange:e=>Qe(Number(e.target.value))}),(0,d.jsxs)("div",{style:{fontSize:10,color:"#888",textAlign:"center"},children:["Split: ",(100*Ye).toFixed(0),"%"]})]})]}),(0,d.jsx)("div",{style:{display:"flex",gap:8},children:(0,d.jsx)("button",{className:"iv-btn iv-btn-primary",onClick:$,style:{flex:1,padding:"8px 0",fontWeight:600,fontSize:11},children:"AUTO LEVELS"})}),(0,d.jsxs)("div",{style:{borderTop:"1px solid #333",paddingTop:20},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,d.jsx)("label",{className:"iv-control-label",style:{fontSize:12,color:"#eee"},children:"CROP & ROTATE"}),(0,d.jsx)("button",{className:"iv-btn "+(K?"iv-btn-primary":""),onClick:()=>{K?Y&&Y():X(!0)},style:{padding:"4px 12px",fontSize:11},children:K?"DONE":"CROP"})]}),K&&(0,d.jsxs)("div",{style:{marginBottom:12,background:"#252525",padding:8,borderRadius:4},children:[(0,d.jsx)(E,{photoId:n,sourceType:i,cropRect:re,rotation:te,pushToHistory:Le,onDetectionResult:e=>{console.log("\ud83d\udcd0 Received detection result in FilmLabControls:",e),e&&e.cropRect&&(console.log("\ud83c\udfaf Updating cropRect from",re,"to",e.cropRect),ie(e.cropRect)),e&&Math.abs(e.rotation)>.1&&(console.log("\ud83d\udd04 Setting rotation to:",e.rotation,"(replacing, not adding)"),ne(e.rotation)),ae&&ae(e)},disabled:!n}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[(0,d.jsx)("label",{className:"iv-control-label",style:{fontSize:12,color:"#eee"},children:"Aspect"}),(0,d.jsxs)("select",{value:Q,onChange:e=>Z(e.target.value),style:{background:"#333",color:"#eee",border:"1px solid #444",fontSize:12,borderRadius:4,padding:"4px 6px"},children:[(0,d.jsx)("option",{value:"free",children:"Free"}),(0,d.jsx)("option",{value:"original",children:"Original"}),(0,d.jsx)("option",{value:"1:1",children:"1 : 1"}),(0,d.jsx)("option",{value:"3:2",children:"3 : 2"}),(0,d.jsx)("option",{value:"4:3",children:"4 : 3"}),(0,d.jsx)("option",{value:"16:9",children:"16 : 9"})]}),"free"!==Q&&"1:1"!==Q&&"original"!==Q&&(0,d.jsx)("button",{className:"iv-btn",onClick:()=>ee(e=>!e),title:"Swap aspect orientation (Lightroom: X)",style:{padding:"4px 8px",fontSize:11},children:J?"Swap: Portrait":"Swap: Landscape"})]}),(0,d.jsx)(h,{label:"ROTATION",value:te,min:-45,max:45,step:.1,onChange:ne,onMouseDown:()=>{Le(),oe&&oe()},onMouseUp:()=>{se&&se()},suffix:"\xb0"})]})]}),(0,d.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{Le(),le(e=>e-90)},style:{flex:1,fontSize:11},children:"\u21ba Rotate Left"}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{Le(),le(e=>e+90)},style:{flex:1,fontSize:11},children:"\u21bb Rotate Right"})]}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,d.jsx)(h,{label:"EXPOSURE",value:ce,onChange:ue,onMouseDown:Le,min:-100,max:100,step:1}),(0,d.jsx)(h,{label:"CONTRAST",value:de,onChange:he,onMouseDown:Le,min:-100,max:100,step:1})]}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,d.jsx)(h,{label:"HIGHLIGHTS",value:pe,onChange:fe,onMouseDown:Le,min:-100,max:100,step:1}),(0,d.jsx)(h,{label:"SHADOWS",value:me,onChange:ge,onMouseDown:Le,min:-100,max:100,step:1}),(0,d.jsx)(h,{label:"WHITES",value:ve,onChange:Ae,onMouseDown:Le,min:-100,max:100,step:1}),(0,d.jsx)(h,{label:"BLACKS",value:ye,onChange:be,onMouseDown:Le,min:-100,max:100,step:1})]}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,d.jsx)(h,{label:"TEMPERATURE",value:xe,onChange:_e,onMouseDown:Le,min:-100,max:100,step:1,displayFormatter:e=>Number(e).toFixed(2)}),(0,d.jsx)(h,{label:"TINT",value:we,onChange:Se,onMouseDown:Le,min:-100,max:100,step:1,displayFormatter:e=>Number(e).toFixed(2)})]}),(0,d.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:(0,d.jsx)(h,{label:"SATURATION",value:Be,onChange:Fe,onMouseDown:Le,min:-100,max:100,step:1})}),(0,d.jsx)(p,{curves:Te,setCurves:Ce,activeChannel:Me,setActiveChannel:Ee,isPicking:Pe,setIsPicking:Ne,pickedColor:ke,histograms:Re,pushToHistory:Le}),(0,d.jsx)(y,{hslParams:Oe,setHslParams:je,pushToHistory:Le}),(0,d.jsx)(_,{splitToning:De,setSplitToning:Ie,pushToHistory:Le}),(0,d.jsxs)("div",{style:{borderTop:"1px solid #333",paddingTop:20},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,d.jsx)("label",{className:"iv-control-label",style:{fontSize:12,color:"#eee"},children:"LUTs"}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsxs)("select",{value:qe,onChange:e=>We(Number(e.target.value)),style:{background:"#333",color:"#eee",border:"1px solid #444",fontSize:10,borderRadius:3,padding:"2px 4px"},children:[(0,d.jsx)("option",{value:33,children:"33 Point"}),(0,d.jsx)("option",{value:65,children:"65 Point"})]}),(0,d.jsx)("button",{className:"iv-btn",onClick:He,style:{fontSize:10,padding:"2px 8px"},children:"EXPORT"})]})]}),(0,d.jsxs)("div",{style:{marginBottom:12,background:"#252525",padding:8,borderRadius:4},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:"#aaa"},children:"LUT 1"}),ze?(0,d.jsx)("button",{className:"iv-btn iv-btn-danger",onClick:()=>{Le(),Ue(null)},style:{fontSize:10,padding:"2px 8px"},children:"REMOVE"}):(0,d.jsx)("button",{className:"iv-btn",style:{fontSize:10,padding:"2px 8px"},onClick:()=>bt(1),children:"LOAD"})]}),ze&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{fontSize:10,color:"#888",marginBottom:4,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:ze.name}),(0,d.jsx)(h,{label:"OPACITY",value:ze.intensity,min:0,max:1,step:.05,onChange:e=>Ue(t=>({...t,intensity:e})),onMouseDown:Le})]})]}),(0,d.jsxs)("div",{style:{marginBottom:12,background:"#252525",padding:8,borderRadius:4},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,d.jsx)("span",{style:{fontSize:11,fontWeight:600,color:"#aaa"},children:"LUT 2"}),Ve?(0,d.jsx)("button",{className:"iv-btn iv-btn-danger",onClick:()=>{Le(),Ge(null)},style:{fontSize:10,padding:"2px 8px"},children:"REMOVE"}):(0,d.jsx)("button",{className:"iv-btn",style:{fontSize:10,padding:"2px 8px"},onClick:()=>bt(2),children:"LOAD"})]}),Ve&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{fontSize:10,color:"#888",marginBottom:4,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:Ve.name}),(0,d.jsx)(h,{label:"OPACITY",value:Ve.intensity,min:0,max:1,step:.05,onChange:e=>Ge(t=>({...t,intensity:e})),onMouseDown:Le})]})]})]}),ft&&(0,d.jsx)(M,{onClose:()=>mt(!1),onSelect:e=>{Le(),1===gt?Ue(e):Ge(e),mt(!1)}}),(0,d.jsxs)("div",{style:{borderTop:"1px solid #333",paddingTop:20},children:[(0,d.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:(0,d.jsx)("label",{className:"iv-control-label",style:{fontSize:12,color:"#eee"},children:"PRESETS"})}),(0,d.jsxs)("div",{style:{background:"#252525",padding:10,borderRadius:6,display:"flex",flexDirection:"column",gap:8},children:[(0,d.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,d.jsx)("input",{value:ht,onChange:e=>pt(e.target.value),placeholder:"Preset Name",style:{flex:1,background:"#333",border:"1px solid #444",color:"#eee",fontSize:12,padding:"4px 6px",borderRadius:4}}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{ht.trim()?(Je(ht.trim()),pt("")):alert("\u8bf7\u8f93\u5165\u9884\u8bbe\u540d\u79f0")},style:{fontSize:11,whiteSpace:"nowrap",opacity:ht.trim()?1:.7},children:"SAVE"})]}),ht&&At&&(0,d.jsxs)("div",{style:{fontSize:10,color:"#e0a800"},children:["\u8986\u76d6\u5df2\u6709\u9884\u8bbe: ",ht]}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6,maxHeight:180,overflowY:"auto"},children:[0===Ze.length&&(0,d.jsx)("div",{style:{fontSize:11,color:"#666",textAlign:"center"},children:"\u6682\u65e0\u9884\u8bbe"}),Ze.map(e=>(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,background:"#1d1d1d",padding:"6px 8px",borderRadius:4},children:[(0,d.jsx)("div",{style:{flex:1,fontSize:11,color:"#ddd",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),(0,d.jsx)("button",{className:"iv-btn",style:{fontSize:10,padding:"4px 6px"},onClick:()=>(e=>{pt(e.name),et(e)})(e),children:"APPLY"}),(0,d.jsx)("button",{className:"iv-btn",style:{fontSize:10,padding:"4px 6px"},onClick:()=>nt(e),children:"ROLL"}),(0,d.jsx)("button",{className:"iv-btn iv-btn-danger",style:{fontSize:10,padding:"4px 6px"},onClick:()=>tt(e.name),children:"\u2715"})]},e.name))]})]})]})]})}function R({canvasRef:e,origCanvasRef:t,zoom:n,setZoom:i,pan:a,setPan:o,isPanning:s,handleWheel:l,handlePanStart:h,isCropping:p,rotation:f,setRotation:m,onRotateStart:g,onRotateEnd:v,pushToHistory:A,handleCanvasClick:y,isPicking:b,cropRect:x,setCropRect:_,image:w,orientation:S,rotationOffset:T,ratioMode:C,ratioSwap:M,compareMode:E,compareSlider:P,setCompareSlider:N,expectedWidth:k}){const[R,L]=(0,r.useState)(null),[O,j]=(0,r.useState)(null),[D,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!p)return void I(!1);let t;const n=()=>{k?e.current&&Math.abs(e.current.width-k)<5?I(!0):(I(!1),t=requestAnimationFrame(n)):I(!0)};return n(),()=>{t&&cancelAnimationFrame(t)}},[p,k,e]);const B=O||x;(0,r.useEffect)(()=>{if(!R)return;const t=t=>{if(!e.current||!w)return;const{startX:n,startY:r,startRect:i,type:a,handle:o,startAngle:s}=R,l=e.current.getBoundingClientRect(),d=(t.clientX-l.left)/l.width-n,h=(t.clientY-l.top)/l.height-r,p=(t.clientX-l.left)/l.width,g=(t.clientY-l.top)/l.height;if("move"===a){let{x:e,y:t,w:n,h:r}=i;e+=d,t+=h,e=Math.max(0,Math.min(1-n,e)),t=Math.max(0,Math.min(1-r,t));const a={x:e,y:t,w:n,h:r};if(u(a,w.width,w.height,f+S+T))j(a);else{let e=i,t=a;for(let n=0;n<10;n++){const n={x:(e.x+t.x)/2,y:(e.y+t.y)/2,w:(e.w+t.w)/2,h:(e.h+t.h)/2};u(n,w.width,w.height,f+S+T)?e=n:t=n}j(e)}}else if("resize"===a){let{x:e,y:t,w:n,h:r}=i;o.includes("e")&&(n+=d),o.includes("w")&&(e+=d,n-=d),o.includes("s")&&(r+=h),o.includes("n")&&(t+=h,r-=h),n<.05&&(o.includes("w")&&(e-=.05-n),n=.05),r<.05&&(o.includes("n")&&(t-=.05-r),r=.05);const a=c(C,w,S,M);if(a){const s=(f+S+T)*Math.PI/180,l=Math.abs(Math.sin(s)),c=Math.abs(Math.cos(s)),u=a/((w.width*c+w.height*l)/(w.width*l+w.height*c));if(o.includes("e")||o.includes("w")){if(r=n/u,o.includes("n"))t=i.y+i.h-r;else if(!o.includes("n")&&!o.includes("s")){t=i.y+i.h/2-r/2}}else if(o.includes("n")||o.includes("s"))if(n=r*u,o.includes("w"))e=i.x+i.w-n;else if(!o.includes("e")&&!o.includes("w")){e=i.x+i.w/2-n/2}}const s={x:e,y:t,w:n,h:r};if(u(s,w.width,w.height,f+S+T))j(s);else{let e=i,t=s;for(let n=0;n<10;n++){const n={x:(e.x+t.x)/2,y:(e.y+t.y)/2,w:(e.w+t.w)/2,h:(e.h+t.h)/2};u(n,w.width,w.height,f+S+T)?e=n:t=n}j(e)}}else if("rotate"===a){const e=i.x+i.w/2,t=i.y+i.h/2,n=(Math.atan2(g-t,p-e)-s)*(180/Math.PI);let r=i.rotation+n;r=R.startRotation+n,r=Math.max(-45,Math.min(45,r)),Math.abs(r)<1&&(r=0),m(r)}},n=()=>{O&&(_(O),A()),"rotate"===R.type&&v&&v(),L(null),j(null)};return window.addEventListener("mousemove",t),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n)}},[R,O,e,w,f,S,T,C,M,_,m,A,v]);const F=(t,n,r)=>{if(t.stopPropagation(),t.preventDefault(),!e.current)return;const i=e.current.getBoundingClientRect(),a=(t.clientX-i.left)/i.width,o=(t.clientY-i.top)/i.height,s=B.x+B.w/2,l=B.y+B.h/2,c=Math.atan2(o-l,a-s);L({type:n,handle:r,startX:a,startY:o,startRect:{...B},startRotation:f,startAngle:c}),"rotate"!==n?j({...B}):g&&g()};return(0,d.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",padding:20,background:"#000",cursor:s?"grabbing":"grab",position:"relative"},onWheel:l,onMouseDown:h,children:[(0,d.jsxs)("div",{style:{position:"absolute",bottom:20,left:20,display:"flex",gap:8,zIndex:100},onMouseDown:e=>e.stopPropagation(),children:[(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{i(1),o({x:0,y:0})},children:"Fit"}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>i(e=>Math.max(.1,e/1.2)),children:"-"}),(0,d.jsxs)("span",{style:{background:"#333",padding:"6px 10px",borderRadius:4,fontSize:12,minWidth:40,textAlign:"center"},children:[Math.round(100*n),"%"]}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>i(e=>Math.min(10,1.2*e)),children:"+"})]}),p&&(0,d.jsxs)("div",{style:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",width:300,zIndex:100,background:"rgba(0,0,0,0.6)",padding:"8px 16px",borderRadius:20,display:"flex",alignItems:"center",gap:10},onMouseDown:e=>e.stopPropagation(),children:[(0,d.jsx)("span",{style:{fontSize:10,color:"#aaa",whiteSpace:"nowrap"},children:"-45\xb0"}),(0,d.jsx)("input",{type:"range",min:-45,max:45,step:.1,value:f,onChange:e=>m(Number(e.target.value)),onMouseDown:()=>{A(),g&&g()},onMouseUp:()=>v&&v(),style:{width:"100%",cursor:"ew-resize"}}),(0,d.jsx)("span",{style:{fontSize:10,color:"#aaa",whiteSpace:"nowrap"},children:"+45\xb0"}),(0,d.jsxs)("div",{style:{position:"absolute",top:-25,left:"50%",transform:"translateX(-50%)",background:"#333",padding:"2px 6px",borderRadius:4,fontSize:11},children:[f.toFixed(1),"\xb0"]})]}),(0,d.jsxs)("div",{style:{position:"relative",display:"inline-block",boxShadow:"0 0 30px rgba(0,0,0,0.8)",transform:`translate(${a.x}px, ${a.y}px) scale(${n})`,transformOrigin:"center",transition:s?"none":"transform 0.1s ease-out"},children:[(0,d.jsx)("canvas",{ref:e,onClick:y,style:{display:"block",maxWidth:"100%",maxHeight:"calc(100vh - 40px)",objectFit:"contain",cursor:b?"crosshair":"default",opacity:"original"===E?0:1,filter:"none",mixBlendMode:"normal"}}),("original"===E||"split"===E)&&(0,d.jsx)("div",{style:{pointerEvents:"split"===E?"none":"auto",position:"absolute",top:0,left:0,width:"split"===E?100*P+"%":"100%",height:"100%",overflow:"hidden"},children:(0,d.jsx)("canvas",{ref:t,style:{display:"block",maxWidth:"100%",maxHeight:"calc(100vh - 40px)",objectFit:"contain"}})}),"split"===E&&(0,d.jsx)("div",{onMouseDown:e=>{e.stopPropagation(),e.preventDefault();const t=e=>(e=>{if("split"!==E)return;const t=e.currentTarget.parentElement.getBoundingClientRect(),n=e.clientX-t.left,r=Math.min(1,Math.max(0,n/t.width));N(r)})(e),n=()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",n)},style:{position:"absolute",top:0,left:100*P+"%",height:"100%",width:3,background:"rgba(255,255,255,0.6)",cursor:"ew-resize",boxShadow:"0 0 4px rgba(0,0,0,0.6)"}}),D&&(0,d.jsxs)("div",{className:"crop-overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",cursor:"crosshair"},onMouseDown:e=>F(e,"new",null),children:[(0,d.jsx)("div",{style:{position:"absolute",top:6,right:6,background:"rgba(0,0,0,0.6)",color:"#fff",padding:"4px 6px",borderRadius:4,fontSize:11,pointerEvents:"none"},children:(0,d.jsx)("span",{id:"crop-debug"})}),(0,d.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:100*B.y+"%",background:"rgba(0,0,0,0.5)"}}),(0,d.jsx)("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:100*(1-(B.y+B.h))+"%",background:"rgba(0,0,0,0.5)"}}),(0,d.jsx)("div",{style:{position:"absolute",top:100*B.y+"%",left:0,width:100*B.x+"%",height:100*B.h+"%",background:"rgba(0,0,0,0.5)"}}),(0,d.jsx)("div",{style:{position:"absolute",top:100*B.y+"%",right:0,width:100*(1-(B.x+B.w))+"%",height:100*B.h+"%",background:"rgba(0,0,0,0.5)"}}),(0,d.jsxs)("div",{style:{position:"absolute",left:100*B.x+"%",top:100*B.y+"%",width:100*B.w+"%",height:100*B.h+"%",border:"1px solid rgba(255,255,255,0.8)",boxShadow:"0 0 0 1px rgba(0,0,0,0.5)",cursor:"move"},onMouseDown:e=>F(e,"move",null),children:[(0,d.jsxs)("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[(0,d.jsx)("line",{x1:"33.333",y1:"0",x2:"33.333",y2:"100",stroke:"rgba(255,255,255,0.5)",strokeDasharray:"4 4",strokeWidth:"0.5"}),(0,d.jsx)("line",{x1:"66.666",y1:"0",x2:"66.666",y2:"100",stroke:"rgba(255,255,255,0.5)",strokeDasharray:"4 4",strokeWidth:"0.5"}),(0,d.jsx)("line",{x1:"0",y1:"33.333",x2:"100",y2:"33.333",stroke:"rgba(255,255,255,0.5)",strokeDasharray:"4 4",strokeWidth:"0.5"}),(0,d.jsx)("line",{x1:"0",y1:"66.666",x2:"100",y2:"66.666",stroke:"rgba(255,255,255,0.5)",strokeDasharray:"4 4",strokeWidth:"0.5"})]}),["nw","ne","sw","se"].map(e=>(0,d.jsx)("div",{onMouseDown:t=>F(t,"resize",e),style:{position:"absolute",width:10,height:10,background:"#fff",border:"1px solid #000",top:e.includes("n")?-5:void 0,bottom:e.includes("s")?-5:void 0,left:e.includes("w")?-5:void 0,right:e.includes("e")?-5:void 0,cursor:`${e}-resize`}},e)),(0,d.jsx)("div",{onMouseDown:e=>{g&&g(),F(e,"rotate",null)},style:{position:"absolute",left:"50%",top:-20,transform:"translateX(-50%)",width:12,height:12,borderRadius:12,background:"#fff",border:"1px solid #000",cursor:"grab",boxShadow:"0 0 4px rgba(0,0,0,0.4)"},title:"Drag to rotate"}),(0,d.jsx)("div",{style:{position:"absolute",left:"50%",top:-8,transform:"translateX(-50%)",width:2,height:8,background:"rgba(255,255,255,0.8)"}})]})]})]})]})}const L=48,O=80;function j({photo:e,isActive:t,onClick:n,hasPositive:a,isSelected:o,showCheckbox:s}){const l=(0,r.useMemo)(()=>{const t=e.positive_thumb_path||e.positive_thumb_rel_path||e.negative_thumb_path||e.thumb_path||e.thumb_rel_path;if(t)return(0,i.FH)(`/uploads/${t}`);const n=e.positive_rel_path||e.full_rel_path||e.negative_rel_path||e.original_rel_path;return n?(0,i.FH)(`/uploads/${n}`):null},[e]);return(0,d.jsxs)("div",{onClick:n,style:{width:L,height:L,borderRadius:4,overflow:"hidden",cursor:"pointer",border:t?"2px solid #2196F3":"2px solid transparent",background:"#222",flexShrink:0,position:"relative"},title:`#${e.frame_number||e.id}${a?" \u2713":""}`,children:[l?(0,d.jsx)("img",{src:l,alt:`#${e.frame_number}`,style:{width:"100%",height:"100%",objectFit:"cover"},loading:"lazy"}):(0,d.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#666",fontSize:10},children:e.frame_number||e.id}),a&&!s&&(0,d.jsx)("div",{style:{position:"absolute",bottom:2,right:2,width:8,height:8,borderRadius:"50%",background:"#4CAF50"}}),s&&(0,d.jsx)("div",{style:{position:"absolute",top:2,left:2,width:14,height:14,borderRadius:3,background:o?"#2196F3":"rgba(0,0,0,0.6)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#fff"},children:o&&"\u2713"})]})}function D({rollId:e,currentPhotoId:t,onPhotoChange:n,onApplyToBatch:a,currentParams:o,collapsed:s=!1,onToggleCollapse:l}){const[c,u]=(0,r.useState)([]),[h,p]=(0,r.useState)(!0),[f,m]=(0,r.useState)([]),[g,v]=(0,r.useState)(!1),[A,y]=(0,r.useState)(!1),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{e&&(p(!0),(0,i.i$)(e).then(e=>u(e)).catch(e=>console.error("Failed to load photos:",e)).finally(()=>p(!1)))},[e]);const x=(0,r.useMemo)(()=>c.findIndex(e=>e.id===t),[c,t]);(0,r.useEffect)(()=>{if(b.current&&x>=0){const e=b.current,t=L+6,n=x*t-e.clientHeight/2+t/2;e.scrollTo({top:Math.max(0,n),behavior:"smooth"})}},[x]);const _=(0,r.useCallback)(()=>{x>0&&n&&n(c[x-1])},[x,c,n]),w=(0,r.useCallback)(()=>{x<c.length-1&&n&&n(c[x+1])},[x,c,n]);(0,r.useEffect)(()=>{const e=e=>{e.ctrlKey&&"ArrowUp"===e.key?(e.preventDefault(),_()):e.ctrlKey&&"ArrowDown"===e.key&&(e.preventDefault(),w())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[_,w]);return s?(0,d.jsxs)("div",{style:{position:"absolute",top:80,left:10,background:"rgba(0,0,0,0.8)",borderRadius:4,padding:"6px 10px",cursor:"pointer",color:"#fff",fontSize:11,display:"flex",flexDirection:"column",alignItems:"center",gap:4,zIndex:100},onClick:l,title:"\u5c55\u5f00\u7167\u7247\u5217\u8868",children:[(0,d.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,d.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,d.jsx)("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),(0,d.jsx)("line",{x1:"9",y1:"21",x2:"9",y2:"9"})]}),(0,d.jsxs)("span",{children:[x+1,"/",c.length]})]}):(0,d.jsxs)("div",{style:{position:"absolute",top:60,left:0,bottom:60,width:O,background:"rgba(0,0,0,0.85)",borderRight:"1px solid #333",display:"flex",flexDirection:"column",zIndex:100},children:[(0,d.jsxs)("div",{style:{padding:6,borderBottom:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,d.jsx)("button",{onClick:_,disabled:x<=0,style:{background:"#333",border:"none",borderRadius:3,color:x>0?"#fff":"#555",cursor:x>0?"pointer":"default",width:22,height:22,fontSize:10},title:"\u4e0a\u4e00\u5f20 (Ctrl+\u2191)",children:"\u25b2"}),(0,d.jsx)("button",{onClick:w,disabled:x>=c.length-1,style:{background:"#333",border:"none",borderRadius:3,color:x<c.length-1?"#fff":"#555",cursor:x<c.length-1?"pointer":"default",width:22,height:22,fontSize:10},title:"\u4e0b\u4e00\u5f20 (Ctrl+\u2193)",children:"\u25bc"})]}),(0,d.jsxs)("span",{style:{color:"#888",fontSize:10},children:[x+1,"/",c.length]}),(0,d.jsx)("button",{onClick:l,style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:10,padding:2},title:"\u6536\u8d77",children:"\u25c0"})]}),(0,d.jsx)("div",{ref:b,style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"6px 8px",display:"flex",flexDirection:"column",gap:6},children:h?(0,d.jsx)("div",{style:{color:"#888",fontSize:10,textAlign:"center",padding:10},children:"..."}):c.map(e=>(0,d.jsx)(j,{photo:e,isActive:e.id===t,hasPositive:!!e.positive_rel_path,isSelected:f.includes(e.id),showCheckbox:g,onClick:()=>{var t;g?(t=e.id,m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])):n&&n(e)}},e.id))}),(0,d.jsx)("div",{style:{padding:6,borderTop:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{style:{display:"flex",gap:2},children:[(0,d.jsx)("button",{onClick:()=>{f.length===c.length?m([]):m(c.map(e=>e.id))},style:{background:"#333",border:"none",borderRadius:3,padding:"3px 6px",color:"#fff",fontSize:9,cursor:"pointer"},title:f.length===c.length?"\u53d6\u6d88\u5168\u9009":"\u5168\u9009",children:"All"}),(0,d.jsx)("button",{onClick:()=>{const e=c.filter(e=>!e.positive_rel_path).map(e=>e.id);m(e)},style:{background:"#333",border:"none",borderRadius:3,padding:"3px 6px",color:"#fff",fontSize:9,cursor:"pointer"},title:"\u4ec5\u9009\u62e9\u65e0\u6b63\u7247",children:"New"})]}),(0,d.jsxs)("span",{style:{color:"#888",fontSize:9},children:[f.length," \u9009\u4e2d"]}),(0,d.jsx)("button",{onClick:async()=>{if(0!==f.length&&o){y(!0);try{const t=await(0,i.EG)({rollId:e,scope:"selected",photoIds:f,paramsSource:{type:"custom",params:o},format:"jpeg",quality:95});t.jobId?(a&&a(t.jobId,f.length),m([]),v(!1)):alert("\u542f\u52a8\u6279\u91cf\u5e94\u7528\u5931\u8d25: "+(t.error||"\u672a\u77e5\u9519\u8bef"))}catch(t){console.error("Apply to batch failed:",t),alert("\u6279\u91cf\u5e94\u7528\u5931\u8d25: "+t.message)}finally{y(!1)}}},disabled:0===f.length||A,style:{background:f.length>0?"#4CAF50":"#333",border:"none",borderRadius:3,padding:"4px 8px",color:"#fff",fontSize:9,cursor:f.length>0?"pointer":"default",width:"100%"},children:A?"...":"\u5e94\u7528"}),(0,d.jsx)("button",{onClick:()=>{v(!1),m([])},style:{background:"none",border:"none",color:"#888",fontSize:9,cursor:"pointer"},children:"\u53d6\u6d88"})]}):(0,d.jsx)("button",{onClick:()=>v(!0),style:{background:"#333",border:"none",borderRadius:3,padding:"4px 8px",color:"#fff",fontSize:9,cursor:"pointer",width:"100%"},title:"\u6279\u91cf\u5e94\u7528\u5f53\u524d\u53c2\u6570",children:"\u6279\u91cf"})})]})}const I=!1,B=!1;function F(e,t,n){const r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("Shader compile error: "+t)}return r}function z(){try{const e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}function U(e,t,n={}){var r,i,a,o,s,l,c,u,d,h,p,m,g,v,A,y,b,x,_,w,S,T,C,M;if(!e)return;let E=e.getContext("webgl2",{preserveDrawingBuffer:!0,premultipliedAlpha:!1,alpha:!0,desynchronized:!1,colorSpace:"srgb"});if(E||(E=e.getContext("webgl",{preserveDrawingBuffer:!0,premultipliedAlpha:!1,colorSpace:"srgb"})||e.getContext("experimental-webgl",{preserveDrawingBuffer:!0,premultipliedAlpha:!1})),!E)throw new Error("WebGL not available");if(E.isContextLost())throw console.warn("[FilmLabWebGL] WebGL context is lost, skipping render"),new Error("WebGL context lost");e._contextLostHandlerRegistered||(e.addEventListener("webglcontextlost",t=>{t.preventDefault(),console.warn("[FilmLabWebGL] WebGL context lost event fired"),U._cache&&U._cache.delete(e)}),e.addEventListener("webglcontextrestored",()=>{console.log("[FilmLabWebGL] WebGL context restored"),U._cache&&U._cache.delete(e)}),e._contextLostHandlerRegistered=!0),I&&console.log("[FilmLabWebGL] Using:",E.getParameter(E.VERSION)),U._cache||(U._cache=new WeakMap);let P=U._cache.get(e);P?I&&console.log("[FilmLabWebGL] Reusing existing cache, shaderVersion:",P.shaderVersion):(P={},U._cache.set(e,P),I&&console.log("[FilmLabWebGL] Created new cache for canvas"));const N=t.width,k=t.height,R="number"===typeof n.scale&&n.scale>0?n.scale:1,L=("number"===typeof n.rotate?n.rotate:0)*Math.PI/180,O=Math.cos(-L),j=Math.sin(-L),D=N*R,z=k*R,V=Math.abs(Math.cos(L)),G=Math.abs(Math.sin(L)),q=D*V+z*G,W=D*G+z*V,H=n.cropRect||{x:0,y:0,w:1,h:1},$=Math.max(0,Math.min(1,H.x||0)),K=Math.max(0,Math.min(1,H.y||0)),X=Math.max(0,Math.min(1-$,H.w||1)),Y=Math.max(0,Math.min(1-K,H.h||1)),Q=Math.max(1,Math.round(q*X)),Z=Math.max(1,Math.round(W*Y));e.width=Q,e.height=Z,E.viewport(0,0,e.width,e.height);const J=(e,t)=>{const n=($+e*X)*q-q/2,r=(K+t*Y)*W-W/2;return[(n*O-r*j+D/2)/D,1-(n*j+r*O+z/2)/z]};P.computedUVs={uvTL:J(0,0),uvTR:J(1,0),uvBL:J(0,1),uvBR:J(1,1)};const ee=f.VERTEX_SHADER,te=(0,f.buildFragmentShader)({isGL2:!1}),ne=f.SHADER_VERSION;I&&console.log("[FilmLabWebGL] SHADER_VERSION:",ne,"cache.shaderVersion:",P.shaderVersion),P.program&&P.shaderVersion===ne||(P.program?(E.deleteProgram(P.program),console.log("[FilmLabWebGL] Recompiling shader due to version change:",P.shaderVersion,"->",ne)):console.log("[FilmLabWebGL] Compiling shader for the first time, version:",ne),P.program=function(e,t,n){const r=F(e,e.VERTEX_SHADER,t),i=F(e,e.FRAGMENT_SHADER,n),a=e.createProgram();if(e.attachShader(a,r),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){const t=e.getProgramInfoLog(a);throw e.deleteProgram(a),new Error("Program link error: "+t)}if(I){console.log("[FilmLabWebGL] Program created successfully. Checking active uniforms...");const t=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);console.log("[FilmLabWebGL] Number of active uniforms:",t);for(let n=0;n<t;n++){const t=e.getActiveUniform(a,n);console.log(`  - Uniform ${n}: name="${t.name}", type=${t.type}, size=${t.size}`)}}return a}(E,ee,te),P.shaderVersion=ne,P.locs=null);const re=P.program;E.useProgram(re);const ie=P.computedUVs;ie||console.error("[FilmLabWebGL] Missing computedUVs - falling back to identity UVs");const ae=ie?ie.uvBL:[0,1],oe=ie?ie.uvBR:[1,1],se=ie?ie.uvTL:[0,0],le=ie?ie.uvTR:[1,0],ce=new Float32Array([-1,-1,ae[0],ae[1],1,-1,oe[0],oe[1],-1,1,se[0],se[1],1,1,le[0],le[1]]);P.buffer||(P.buffer=E.createBuffer()),E.bindBuffer(E.ARRAY_BUFFER,P.buffer),E.bufferData(E.ARRAY_BUFFER,ce,E.DYNAMIC_DRAW);const ue=E.getAttribLocation(re,"a_pos"),de=E.getAttribLocation(re,"a_uv");E.enableVertexAttribArray(ue),E.vertexAttribPointer(ue,2,E.FLOAT,!1,16,0),E.enableVertexAttribArray(de),E.vertexAttribPointer(de,2,E.FLOAT,!1,16,8),P.imageTex||(P.imageTex=E.createTexture()),E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.imageTex),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,!0),E.pixelStorei(E.UNPACK_COLORSPACE_CONVERSION_WEBGL,E.NONE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,t);const he={};P.locs=he,he.u_image=E.getUniformLocation(re,"u_image"),he.u_inverted=E.getUniformLocation(re,"u_inverted"),he.u_inversionMode=E.getUniformLocation(re,"u_inversionMode"),he.u_gains=E.getUniformLocation(re,"u_gains"),he.u_exposure=E.getUniformLocation(re,"u_exposure"),he.u_contrast=E.getUniformLocation(re,"u_contrast"),he.u_highlights=E.getUniformLocation(re,"u_highlights"),he.u_shadows=E.getUniformLocation(re,"u_shadows"),he.u_whites=E.getUniformLocation(re,"u_whites"),he.u_blacks=E.getUniformLocation(re,"u_blacks"),he.u_filmCurveEnabled=E.getUniformLocation(re,"u_filmCurveEnabled"),he.u_filmCurveGamma=E.getUniformLocation(re,"u_filmCurveGamma"),he.u_filmCurveGammaR=E.getUniformLocation(re,"u_filmCurveGammaR"),he.u_filmCurveGammaG=E.getUniformLocation(re,"u_filmCurveGammaG"),he.u_filmCurveGammaB=E.getUniformLocation(re,"u_filmCurveGammaB"),he.u_filmCurveDMin=E.getUniformLocation(re,"u_filmCurveDMin"),he.u_filmCurveDMax=E.getUniformLocation(re,"u_filmCurveDMax"),he.u_filmCurveToe=E.getUniformLocation(re,"u_filmCurveToe"),he.u_filmCurveShoulder=E.getUniformLocation(re,"u_filmCurveShoulder"),he.u_baseMode=E.getUniformLocation(re,"u_baseMode"),he.u_baseGains=E.getUniformLocation(re,"u_baseGains"),he.u_baseDensity=E.getUniformLocation(re,"u_baseDensity"),he.u_densityLevelsEnabled=E.getUniformLocation(re,"u_densityLevelsEnabled"),he.u_densityLevelsMin=E.getUniformLocation(re,"u_densityLevelsMin"),he.u_densityLevelsMax=E.getUniformLocation(re,"u_densityLevelsMax"),he.u_curveRGB=E.getUniformLocation(re,"u_curveRGB"),he.u_curveR=E.getUniformLocation(re,"u_curveR"),he.u_curveG=E.getUniformLocation(re,"u_curveG"),he.u_curveB=E.getUniformLocation(re,"u_curveB"),he.u_useCurves=E.getUniformLocation(re,"u_useCurves"),he.u_lut3d=E.getUniformLocation(re,"u_lut3d"),he.u_useLut3d=E.getUniformLocation(re,"u_useLut3d"),he.u_lutSize=E.getUniformLocation(re,"u_lutSize"),he.u_lutIntensity=E.getUniformLocation(re,"u_lutIntensity"),he.u_useHSL=E.getUniformLocation(re,"u_useHSL"),he.u_hslRed=E.getUniformLocation(re,"u_hslRed"),he.u_hslOrange=E.getUniformLocation(re,"u_hslOrange"),he.u_hslYellow=E.getUniformLocation(re,"u_hslYellow"),he.u_hslGreen=E.getUniformLocation(re,"u_hslGreen"),he.u_hslCyan=E.getUniformLocation(re,"u_hslCyan"),he.u_hslBlue=E.getUniformLocation(re,"u_hslBlue"),he.u_hslPurple=E.getUniformLocation(re,"u_hslPurple"),he.u_hslMagenta=E.getUniformLocation(re,"u_hslMagenta"),he.u_useSaturation=E.getUniformLocation(re,"u_useSaturation"),he.u_saturation=E.getUniformLocation(re,"u_saturation"),he.u_useSplitTone=E.getUniformLocation(re,"u_useSplitTone"),he.u_splitHighlightHue=E.getUniformLocation(re,"u_splitHighlightHue"),he.u_splitHighlightSat=E.getUniformLocation(re,"u_splitHighlightSat"),he.u_splitMidtoneHue=E.getUniformLocation(re,"u_splitMidtoneHue"),he.u_splitMidtoneSat=E.getUniformLocation(re,"u_splitMidtoneSat"),he.u_splitShadowHue=E.getUniformLocation(re,"u_splitShadowHue"),he.u_splitShadowSat=E.getUniformLocation(re,"u_splitShadowSat"),he.u_splitBalance=E.getUniformLocation(re,"u_splitBalance"),B&&console.log("[FilmLabWebGL] LUT uniform locations:","u_lut3d=",he.u_lut3d,"u_useLut3d=",he.u_useLut3d,"u_lutSize=",he.u_lutSize,"u_lutIntensity=",he.u_lutIntensity),E.uniform1i(he.u_image,0);const pe=n.inverted?1:0;I&&(console.log("[FilmLabWebGL] u_inverted:",pe,"params.inverted:",n.inverted),console.log("[FilmLabWebGL] locs.u_inverted:",he.u_inverted),null===he.u_inverted&&console.error("[FilmLabWebGL] ERROR: u_inverted uniform location is NULL!")),E.uniform1f(he.u_inverted,pe);const fe="log"===n.inversionMode?1:0;E.uniform1f(he.u_inversionMode,fe);const me=n.gains||[1,1,1];I&&console.log("[FilmLabWebGL] Setting u_gains:",me),E.uniform3fv(he.u_gains,new Float32Array(me));const ge="number"===typeof n.exposure?n.exposure:0;I&&console.log("[FilmLabWebGL] Setting u_exposure:",ge,"from",n.exposure),E.uniform1f(he.u_exposure,ge);const ve="number"===typeof n.contrast?n.contrast:0;E.uniform1f(he.u_contrast,ve),E.uniform1f(he.u_highlights,n.highlights||0),E.uniform1f(he.u_shadows,n.shadows||0),E.uniform1f(he.u_whites,n.whites||0),E.uniform1f(he.u_blacks,n.blacks||0);const Ae=n.filmCurveEnabled?1:0;E.uniform1f(he.u_filmCurveEnabled,Ae),E.uniform1f(he.u_filmCurveGamma,null!==(r=n.filmCurveGamma)&&void 0!==r?r:.6),E.uniform1f(he.u_filmCurveGammaR,null!==(i=null!==(a=n.filmCurveGammaR)&&void 0!==a?a:n.filmCurveGamma)&&void 0!==i?i:.6),E.uniform1f(he.u_filmCurveGammaG,null!==(o=null!==(s=n.filmCurveGammaG)&&void 0!==s?s:n.filmCurveGamma)&&void 0!==o?o:.6),E.uniform1f(he.u_filmCurveGammaB,null!==(l=null!==(c=n.filmCurveGammaB)&&void 0!==c?c:n.filmCurveGamma)&&void 0!==l?l:.6),E.uniform1f(he.u_filmCurveDMin,null!==(u=n.filmCurveDMin)&&void 0!==u?u:.1),E.uniform1f(he.u_filmCurveDMax,null!==(d=n.filmCurveDMax)&&void 0!==d?d:3),E.uniform1f(he.u_filmCurveToe,null!==(h=n.filmCurveToe)&&void 0!==h?h:0),E.uniform1f(he.u_filmCurveShoulder,null!==(p=n.filmCurveShoulder)&&void 0!==p?p:0);const ye="log"===n.baseMode?1:0,be=n.baseGains||[1,1,1],xe=n.baseDensity||[0,0,0];I&&console.log("[FilmLabWebGL] Setting base correction:",{baseMode:ye,baseGains:be,baseDensity:xe}),E.uniform1f(he.u_baseMode,ye),E.uniform3fv(he.u_baseGains,new Float32Array(be)),E.uniform3fv(he.u_baseDensity,new Float32Array(xe));const _e=n.densityLevelsEnabled&&ye>.5?1:0,we=n.densityLevels||{red:{min:0,max:3},green:{min:0,max:3},blue:{min:0,max:3}};E.uniform1f(he.u_densityLevelsEnabled,_e),E.uniform3fv(he.u_densityLevelsMin,new Float32Array([null!==(m=null===(g=we.red)||void 0===g?void 0:g.min)&&void 0!==m?m:0,null!==(v=null===(A=we.green)||void 0===A?void 0:A.min)&&void 0!==v?v:0,null!==(y=null===(b=we.blue)||void 0===b?void 0:b.min)&&void 0!==y?y:0])),E.uniform3fv(he.u_densityLevelsMax,new Float32Array([null!==(x=null===(_=we.red)||void 0===_?void 0:_.max)&&void 0!==x?x:3,null!==(w=null===(S=we.green)||void 0===S?void 0:S.max)&&void 0!==w?w:3,null!==(T=null===(C=we.blue)||void 0===C?void 0:C.max)&&void 0!==T?T:3])),I&&console.log("[FilmLabWebGL] Setting density levels:",{densityLevelsEnabled:_e,densityLevels:we});const Se=n.curves;if(Se){const e=(e,t)=>{if(!t)return null;P[e]||(P[e]=E.createTexture());const n=P[e];E.activeTexture(E.TEXTURE1+("curveRGB"===e?0:"curveR"===e?1:"curveG"===e?2:3)),E.bindTexture(E.TEXTURE_2D,n),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);const r=new Uint8Array(1024);for(let i=0;i<256;i++){const e=Math.max(0,Math.min(255,Math.round(t[i])));r[4*i]=e,r[4*i+1]=e,r[4*i+2]=e,r[4*i+3]=255}return E.texImage2D(E.TEXTURE_2D,0,E.RGBA,256,1,0,E.RGBA,E.UNSIGNED_BYTE,r),n},t=e("curveRGB",Se.rgb),n=e("curveR",Se.red),r=e("curveG",Se.green),i=e("curveB",Se.blue);t&&(E.activeTexture(E.TEXTURE1),E.bindTexture(E.TEXTURE_2D,t),E.uniform1i(he.u_curveRGB,1)),n&&(E.activeTexture(E.TEXTURE2),E.bindTexture(E.TEXTURE_2D,n),E.uniform1i(he.u_curveR,2)),r&&(E.activeTexture(E.TEXTURE3),E.bindTexture(E.TEXTURE_2D,r),E.uniform1i(he.u_curveG,3)),i&&(E.activeTexture(E.TEXTURE4),E.bindTexture(E.TEXTURE_2D,i),E.uniform1i(he.u_curveB,4)),E.uniform1f(he.u_useCurves,1)}else E.uniform1f(he.u_useCurves,0);if(n.lut3&&n.lut3.size&&n.lut3.data){var Te;const e=n.lut3.size,t=n.lut3.data,r=null!==(Te=n.lut3.intensity)&&void 0!==Te?Te:1,i=(0,f.packLUT3DForWebGL)(t,e),a=e,o=e*e;if(B){console.log("[FilmLabWebGL] LUT Debug:"),console.log("  - size:",e,"texture:",a,"x",o),console.log("  - intensity:",r),console.log("  - dataF length:",t.length,"expected:",e*e*e*3),console.log("  - dataF[0..8]:",Array.from(t.slice(0,9)).map(e=>e.toFixed(3))),console.log("  - buf[0..15] (first pixel):",Array.from(i.slice(0,16)));const n=e;console.log(`  - buf[${4*n}..${4*n+3}] (row 1, col 0):`,Array.from(i.slice(4*n,4*n+4)));const s=(t,n,r)=>t+n*e+r*e*e,l=[{r:0,g:0,b:0,name:"black"},{r:e-1,g:e-1,b:e-1,name:"white"},{r:e-1,g:0,b:0,name:"red"},{r:0,g:e-1,b:0,name:"green"},{r:0,g:0,b:e-1,name:"blue"},{r:Math.floor(e/2),g:Math.floor(e/2),b:Math.floor(e/2),name:"mid-gray"}];for(const r of l){var Ce,Me,Ee;const n=3*s(r.r,r.g,r.b),a=r.g+r.b*e,o=r.r,l=4*(a*e+o);console.log(`  - ${r.name} (r=${r.r}, g=${r.g}, b=${r.b}):`,`srcIdx=${n}, dataF=[${null===(Ce=t[n])||void 0===Ce?void 0:Ce.toFixed(3)}, ${null===(Me=t[n+1])||void 0===Me?void 0:Me.toFixed(3)}, ${null===(Ee=t[n+2])||void 0===Ee?void 0:Ee.toFixed(3)}]`,`bufIdx=${l}, buf=[${i[l]}, ${i[l+1]}, ${i[l+2]}]`,`texUV=(${(o+.5)/e}, ${(a+.5)/(e*e)})`)}}P.lut3Tex||(P.lut3Tex=E.createTexture()),E.activeTexture(E.TEXTURE5),E.bindTexture(E.TEXTURE_2D,P.lut3Tex),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,!1),E.pixelStorei(E.UNPACK_COLORSPACE_CONVERSION_WEBGL,E.NONE),E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);const s=E.RGBA8||E.RGBA;E.texImage2D(E.TEXTURE_2D,0,s,a,o,0,E.RGBA,E.UNSIGNED_BYTE,i),B&&(console.log("  - locs.u_lut3d:",he.u_lut3d,"locs.u_useLut3d:",he.u_useLut3d,"locs.u_lutSize:",he.u_lutSize,"locs.u_lutIntensity:",he.u_lutIntensity),null===he.u_lut3d&&console.error("[FilmLabWebGL] ERROR: u_lut3d uniform not found in shader!")),E.uniform1i(he.u_lut3d,5),E.uniform1f(he.u_useLut3d,1),E.uniform1f(he.u_lutSize,e),E.uniform1f(he.u_lutIntensity,r),B&&console.log("  - u_useLut3d: 1, u_lutSize:",e,"u_lutIntensity:",r)}else E.uniform1f(he.u_useLut3d,0),E.uniform1f(he.u_lutIntensity,0),B&&n.lut3&&console.log("[FilmLabWebGL] LUT skipped - invalid data:",n.lut3);const Pe=n.hslParams;var Ne,ke,Re,Le,Oe,je,De,Ie,Be,Fe,ze,Ue,Ve,Ge,qe,We,He,$e,Ke,Xe,Ye,Qe,Ze,Je,et,tt,nt,rt,it,at,ot,st,lt,ct,ut,dt,ht,pt,ft,mt,gt,vt,At,yt,bt,xt,_t,wt;Pe&&!function(e){if(!e)return!0;const t=["red","orange","yellow","green","cyan","blue","purple","magenta"];for(const n of t){const t=e[n];if(t&&(0!==t.hue||0!==t.saturation||0!==t.luminance))return!1}return!0}(Pe)?(E.uniform1f(he.u_useHSL,1),E.uniform3fv(he.u_hslRed,new Float32Array([null!==(Ne=null===(ke=Pe.red)||void 0===ke?void 0:ke.hue)&&void 0!==Ne?Ne:0,null!==(Re=null===(Le=Pe.red)||void 0===Le?void 0:Le.saturation)&&void 0!==Re?Re:0,null!==(Oe=null===(je=Pe.red)||void 0===je?void 0:je.luminance)&&void 0!==Oe?Oe:0])),E.uniform3fv(he.u_hslOrange,new Float32Array([null!==(De=null===(Ie=Pe.orange)||void 0===Ie?void 0:Ie.hue)&&void 0!==De?De:0,null!==(Be=null===(Fe=Pe.orange)||void 0===Fe?void 0:Fe.saturation)&&void 0!==Be?Be:0,null!==(ze=null===(Ue=Pe.orange)||void 0===Ue?void 0:Ue.luminance)&&void 0!==ze?ze:0])),E.uniform3fv(he.u_hslYellow,new Float32Array([null!==(Ve=null===(Ge=Pe.yellow)||void 0===Ge?void 0:Ge.hue)&&void 0!==Ve?Ve:0,null!==(qe=null===(We=Pe.yellow)||void 0===We?void 0:We.saturation)&&void 0!==qe?qe:0,null!==(He=null===($e=Pe.yellow)||void 0===$e?void 0:$e.luminance)&&void 0!==He?He:0])),E.uniform3fv(he.u_hslGreen,new Float32Array([null!==(Ke=null===(Xe=Pe.green)||void 0===Xe?void 0:Xe.hue)&&void 0!==Ke?Ke:0,null!==(Ye=null===(Qe=Pe.green)||void 0===Qe?void 0:Qe.saturation)&&void 0!==Ye?Ye:0,null!==(Ze=null===(Je=Pe.green)||void 0===Je?void 0:Je.luminance)&&void 0!==Ze?Ze:0])),E.uniform3fv(he.u_hslCyan,new Float32Array([null!==(et=null===(tt=Pe.cyan)||void 0===tt?void 0:tt.hue)&&void 0!==et?et:0,null!==(nt=null===(rt=Pe.cyan)||void 0===rt?void 0:rt.saturation)&&void 0!==nt?nt:0,null!==(it=null===(at=Pe.cyan)||void 0===at?void 0:at.luminance)&&void 0!==it?it:0])),E.uniform3fv(he.u_hslBlue,new Float32Array([null!==(ot=null===(st=Pe.blue)||void 0===st?void 0:st.hue)&&void 0!==ot?ot:0,null!==(lt=null===(ct=Pe.blue)||void 0===ct?void 0:ct.saturation)&&void 0!==lt?lt:0,null!==(ut=null===(dt=Pe.blue)||void 0===dt?void 0:dt.luminance)&&void 0!==ut?ut:0])),E.uniform3fv(he.u_hslPurple,new Float32Array([null!==(ht=null===(pt=Pe.purple)||void 0===pt?void 0:pt.hue)&&void 0!==ht?ht:0,null!==(ft=null===(mt=Pe.purple)||void 0===mt?void 0:mt.saturation)&&void 0!==ft?ft:0,null!==(gt=null===(vt=Pe.purple)||void 0===vt?void 0:vt.luminance)&&void 0!==gt?gt:0])),E.uniform3fv(he.u_hslMagenta,new Float32Array([null!==(At=null===(yt=Pe.magenta)||void 0===yt?void 0:yt.hue)&&void 0!==At?At:0,null!==(bt=null===(xt=Pe.magenta)||void 0===xt?void 0:xt.saturation)&&void 0!==bt?bt:0,null!==(_t=null===(wt=Pe.magenta)||void 0===wt?void 0:wt.luminance)&&void 0!==_t?_t:0]))):E.uniform1f(he.u_useHSL,0);const St=null!==(M=n.saturation)&&void 0!==M?M:0;0!==St?(E.uniform1f(he.u_useSaturation,1),E.uniform1f(he.u_saturation,St)):(E.uniform1f(he.u_useSaturation,0),E.uniform1f(he.u_saturation,0));const Tt=n.splitToning;var Ct,Mt,Et,Pt,Nt,kt,Rt,Lt,Ot,jt,Dt,It,Bt;Tt&&!function(e){var t,n,r,i,a,o;if(!e)return!0;const s=null!==(t=null===(n=e.highlights)||void 0===n?void 0:n.saturation)&&void 0!==t?t:0,l=null!==(r=null===(i=e.midtones)||void 0===i?void 0:i.saturation)&&void 0!==r?r:0,c=null!==(a=null===(o=e.shadows)||void 0===o?void 0:o.saturation)&&void 0!==a?a:0;return 0===s&&0===l&&0===c}(Tt)?(E.uniform1f(he.u_useSplitTone,1),E.uniform1f(he.u_splitHighlightHue,(null!==(Ct=null===(Mt=Tt.highlights)||void 0===Mt?void 0:Mt.hue)&&void 0!==Ct?Ct:30)/360),E.uniform1f(he.u_splitHighlightSat,(null!==(Et=null===(Pt=Tt.highlights)||void 0===Pt?void 0:Pt.saturation)&&void 0!==Et?Et:0)/100),E.uniform1f(he.u_splitMidtoneHue,(null!==(Nt=null===(kt=Tt.midtones)||void 0===kt?void 0:kt.hue)&&void 0!==Nt?Nt:0)/360),E.uniform1f(he.u_splitMidtoneSat,(null!==(Rt=null===(Lt=Tt.midtones)||void 0===Lt?void 0:Lt.saturation)&&void 0!==Rt?Rt:0)/100),E.uniform1f(he.u_splitShadowHue,(null!==(Ot=null===(jt=Tt.shadows)||void 0===jt?void 0:jt.hue)&&void 0!==Ot?Ot:220)/360),E.uniform1f(he.u_splitShadowSat,(null!==(Dt=null===(It=Tt.shadows)||void 0===It?void 0:It.saturation)&&void 0!==Dt?Dt:0)/100),E.uniform1f(he.u_splitBalance,(null!==(Bt=Tt.balance)&&void 0!==Bt?Bt:0)/100)):E.uniform1f(he.u_useSplitTone,0);if(E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.imageTex),P.lut3Tex&&n.lut3&&(E.activeTexture(E.TEXTURE5),E.bindTexture(E.TEXTURE_2D,P.lut3Tex)),E.drawArrays(E.TRIANGLE_STRIP,0,4),I){const t=Math.floor(e.width/2),n=Math.floor(e.height/2),r=new Uint8Array(4);E.readPixels(t,n,1,1,E.RGBA,E.UNSIGNED_BYTE,r);const i=new Uint8Array(4);E.readPixels(0,0,1,1,E.RGBA,E.UNSIGNED_BYTE,i);const a=new Uint8Array(4);E.readPixels(e.width-1,e.height-1,1,1,E.RGBA,E.UNSIGNED_BYTE,a),console.log("[FilmLabWebGL] DEBUG: readPixels - Center:",Array.from(r),"TopLeft:",Array.from(i),"TopRight:",Array.from(a)),console.log("[FilmLabWebGL] DEBUG: Canvas size:",e.width,"x",e.height),console.log("[FilmLabWebGL] DEBUG: If inverted, center should be [255,0,0,255] (red) but user sees cyan!")}return E.bindTexture(E.TEXTURE_2D,null),E.bindBuffer(E.ARRAY_BUFFER,null),e}function V({imageUrl:e,onClose:t,onSave:n,onFinishBatchParams:o,rollId:u,photoId:h,onPhotoUpdate:p,sourceType:m="original",photos:g=null,onPhotoChange:v=null,showPhotoSwitcher:A=!1}){const y=(0,r.useRef)(null),b=(0,r.useRef)(null),[x,_]=(0,r.useState)(null),[w,S]=(0,r.useState)(!0),[T,C]=(0,r.useState)(!1),[M,E]=(0,r.useState)("linear"),[P,N]=(0,r.useState)("default"),[L,O]=(0,r.useState)(!1),[j,I]=(0,r.useState)("default"),[B,F]=(0,r.useState)([]),[V,G]=(0,r.useState)(!1),[q,W]=(0,r.useState)(!1),[H,$]=(0,r.useState)(!1),[K,X]=(0,r.useState)(null),[Y,Q]=(0,r.useState)(0),[Z,J]=(0,r.useState)(0),[ee,te]=(0,r.useState)(0),[ne,re]=(0,r.useState)(0),[ie,ae]=(0,r.useState)(0),[oe,se]=(0,r.useState)(0),[le,ce]=(0,r.useState)(0),[ue,de]=(0,r.useState)(0),[he,pe]=(0,r.useState)(1),[fe,me]=(0,r.useState)(1),[ge,ve]=(0,r.useState)(1),[Ae,ye]=(0,r.useState)(1),[be,xe]=(0,r.useState)(1),[_e,we]=(0,r.useState)(1),[Se,Te]=(0,r.useState)("log"),[Ce,Me]=(0,r.useState)(0),[Ee,Pe]=(0,r.useState)(0),[Ne,ke]=(0,r.useState)(0),[Re,Le]=(0,r.useState)(!1),[Oe,je]=(0,r.useState)({red:{min:0,max:3},green:{min:0,max:3},blue:{min:0,max:3}}),[De,Ie]=(0,r.useState)(0),[Be,Fe]=(0,r.useState)(0),[ze,Ue]=(0,r.useState)(!1),Ve=(0,r.useRef)(0),[Ge,qe]=(0,r.useState)(!1),[We,He]=(0,r.useState)({x:0,y:0,w:1,h:1}),[$e,Ke]=(0,r.useState)({x:0,y:0,w:1,h:1}),[Xe,Ye]=(0,r.useState)("free"),[Qe,Ze]=(0,r.useState)(!1),Je=(0,r.useRef)(!1),et=(0,r.useRef)(!1),tt=[{x:0,y:0},{x:255,y:255}],[nt,rt]=(0,r.useState)({rgb:[...tt],red:[...tt],green:[...tt],blue:[...tt]}),[it,at]=(0,r.useState)("rgb"),[ot,st]=(0,r.useState)({...f.DEFAULT_HSL_PARAMS}),[lt,ct]=(0,r.useState)({...f.DEFAULT_SPLIT_TONE_PARAMS}),[ut,dt]=(0,r.useState)(0),[ht,pt]=(0,r.useState)(1),[ft,mt]=(0,r.useState)({x:0,y:0}),[gt,vt]=(0,r.useState)(!1),[At,yt]=(0,r.useState)({rgb:new Array(256).fill(0),red:new Array(256).fill(0),green:new Array(256).fill(0),blue:new Array(256).fill(0)}),[bt,xt]=(0,r.useState)(null),[_t,wt]=(0,r.useState)(null),[St,Tt]=(0,r.useState)(33),[Ct,Mt]=(0,r.useState)(z()),[Et,Pt]=(0,r.useState)("off"),[Nt,kt]=(0,r.useState)(.5),[Rt,Lt]=(0,r.useState)([]),Ot=(0,r.useRef)(null),[jt,Dt]=(0,r.useState)(!1),[It,Bt]=(0,r.useState)(!1),[Ft,zt]=(0,r.useState)("jpeg"),[Ut,Vt]=(0,r.useState)(0),Gt=(0,r.useRef)(null),qt=(0,r.useRef)(null);(0,r.useEffect)(()=>{Gt.current=null,qt.current=null,"positive"===m&&C(!1)},[m]);const Wt=r.useMemo(()=>{const e=(0,f.computeWBGains)({red:he,green:fe,blue:ge,temp:le,tint:ue}),t=x&&x.width?Math.min(1,f.PREVIEW_MAX_WIDTH_CLIENT/x.width):1;return{inverted:(0,f.getEffectiveInverted)(m,T),inversionMode:M,gains:e,baseMode:Se,baseGains:[Ae,be,_e],baseDensity:[Ce,Ee,Ne],densityLevelsEnabled:Re,densityLevels:Oe,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,curves:nt,lut1:bt,lut2:_t,hslParams:ot,splitToning:lt,saturation:ut,hslKey:JSON.stringify(ot),splitToneKey:JSON.stringify(lt),filmCurveEnabled:L,filmCurveProfile:j,rotation:De,orientation:Be,rotationOffset:Ut,isCropping:Ge,cropKey:`${$e.x},${$e.y},${$e.w},${$e.h}`,scale:t,sourceType:m}},[T,M,Y,Z,ee,ne,ie,oe,le,ue,he,fe,ge,Se,Ae,be,_e,Ce,Ee,Ne,Re,Oe,nt,bt,_t,ot,lt,ut,L,j,De,Be,Ut,Ge,$e,x,m]),Ht=r.useMemo(()=>({inverted:T,inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,baseMode:Se,baseRed:Ae,baseGreen:be,baseBlue:_e,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe,rotation:De,orientation:Be,cropRect:$e,curves:nt,hslParams:ot,splitToning:lt,saturation:ut}),[T,M,L,j,Y,Z,ee,ne,ie,oe,le,ue,he,fe,ge,Se,Ae,be,_e,Ce,Ee,Ne,Re,Oe,De,Be,$e,nt,ot,lt,ut]),$t=r.useMemo(()=>{if(!x)return null;const e=f.PREVIEW_MAX_WIDTH_CLIENT,t=Math.min(1,e/x.width),n=(De+Be+Ut)*Math.PI/180,r=Math.abs(Math.sin(n)),i=Math.abs(Math.cos(n)),a=x.width*t,o=x.height*t;return{rotatedW:Math.round(a*i+o*r),rotatedH:Math.round(a*r+o*i),scale:t,rad:n,scaledW:a,scaledH:o}},[x,De,Be,Ut]);(0,r.useEffect)(()=>{(async()=>{try{const e=await(0,i.nk)();e&&Array.isArray(e.presets)&&Lt(e.presets.map(e=>({id:e.id,name:e.name,params:e.params})))}catch(e){console.warn("Failed to load presets from backend",e);try{const e=localStorage.getItem("filmLabPresets");e&&Lt(JSON.parse(e))}catch(t){console.warn("Failed to load presets from localStorage",t)}}})()},[]),(0,r.useEffect)(()=>{(async()=>{try{const e=await(0,i.m3)(),t=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.profiles)||[];F(t)}catch(e){console.warn("Failed to load film curve profiles",e)}})()},[]),(0,r.useEffect)(()=>{!T&&L&&O(!1)},[T,L]);const Kt=e=>{Lt(e);try{localStorage.setItem("filmLabPresets",JSON.stringify(e))}catch(t){console.warn("Persist presets failed",t)}},Xt=e=>{var t,n,r,i,a,o,s,l;if(!e)return;const{params:c}=e;en(),C("positive"!==m&&c.inverted),E(c.inversionMode),Q(c.exposure),J(c.contrast),te(c.highlights),re(c.shadows),ae(c.whites),se(c.blacks),ce(c.temp),de(c.tint),pe(c.red),me(c.green),ve(c.blue),Te(null!==(t=c.baseMode)&&void 0!==t?t:"log"),ye(null!==(n=c.baseRed)&&void 0!==n?n:1),xe(null!==(r=c.baseGreen)&&void 0!==r?r:1),we(null!==(i=c.baseBlue)&&void 0!==i?i:1),Me(null!==(a=c.baseDensityR)&&void 0!==a?a:0),Pe(null!==(o=c.baseDensityG)&&void 0!==o?o:0),ke(null!==(s=c.baseDensityB)&&void 0!==s?s:0),rt(JSON.parse(JSON.stringify(c.curves))),st(c.hslParams||f.DEFAULT_HSL_PARAMS),ct(c.splitToning||f.DEFAULT_SPLIT_TONE_PARAMS),dt(null!==(l=c.saturation)&&void 0!==l?l:0),O(!!c.filmCurveEnabled),c.filmCurveProfile&&I(c.filmCurveProfile);const u=e=>e?e.data&&Array.isArray(e.data)?{...e,data:new Float32Array(e.data)}:e:null;xt(u(c.lut1)),wt(u(c.lut2))},[Yt,Qt]=(0,r.useState)([]),[Zt,Jt]=(0,r.useState)([]),en=()=>{Qt(e=>[...e,{inverted:T,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,curves:nt,rotation:De,cropRect:We,lut1:bt?{...bt}:null,lut2:_t?{..._t}:null}]),Jt([])};(0,r.useEffect)(()=>{_(null);const t=(0,f.requiresServerDecode)(e),n=(0,f.isRawFile)(e);if(t&&h){let e=!0;return(async()=>{try{console.log(`[FilmLab] Loading ${n?"RAW":"TIFF"} file via smart proxy...`);const t=await(0,a.bf)({photoId:h,params:{},maxWidth:2e3,sourceType:m});if(e&&t.ok){const n=URL.createObjectURL(t.blob),r=new Image;r.onload=()=>{e&&_(r)},r.src=n,Vt(0)}else e&&console.warn(`Failed to load ${n?"RAW":"TIFF"} proxy`,t.error)}catch(t){e&&console.error(`Failed to load ${n?"RAW":"TIFF"} proxy`,t)}})(),()=>{e=!1}}const r=new Image;r.crossOrigin="Anonymous",r.src=e,r.onload=()=>{_(r)},r.onerror=t=>{console.error("Failed to load image:",e,t),h&&(console.log("Attempting to load via smart proxy..."),(async()=>{try{const e=await(0,a.bf)({photoId:h,params:{},maxWidth:2e3,sourceType:m});if(e.ok){const t=URL.createObjectURL(e.blob),n=new Image;n.onload=()=>_(n),n.onerror=()=>console.error("Proxy load also failed"),n.src=t}}catch(e){console.error("Proxy load failed:",e)}})())},fetch(e).then(e=>e.arrayBuffer()).then(e=>{const t=new DataView(e),n=t.byteLength>=2&&(18761===t.getUint16(0,!1)||19789===t.getUint16(0,!1)),r=function(e){const t=new DataView(e);if(t.byteLength<2)return-1;if(65496===t.getUint16(0,!1)){const e=t.byteLength;let n=2;for(;n<e;){if(t.byteLength<n+2)return-1;const e=t.getUint16(n,!1);if(n+=2,65505===e){if(t.byteLength<n+14)return-1;if(1165519206!==t.getUint32(n+2,!1))return-1;const e=18761===t.getUint16(n+8,!1);n+=8;const r=t.getUint32(n+4,e);if(r<8)return-1;const i=n+r;if(t.byteLength<i+2)return-1;const a=t.getUint16(i,e);for(let n=0;n<a;n++){const r=i+2+12*n;if(t.byteLength<r+12)return-1;if(274===t.getUint16(r,e))return t.getUint16(r+8,e)}}else{if(65280!==(65280&e))break;if(t.byteLength<n+2)return-1;n+=t.getUint16(n,!1)}}}else{const e=t.getUint16(0,!1);if(18761===e||19789===e){const n=18761===e;if(t.byteLength<8)return-1;if(42!==t.getUint16(2,n))return-1;const r=t.getUint32(4,n);if(r<8)return-1;let i=r;if(t.byteLength<i+2)return-1;const a=t.getUint16(i,n);for(let e=0;e<a;e++){const r=i+2+12*e;if(t.byteLength<r+12)return-1;if(274===t.getUint16(r,n))return t.getUint16(r+8,n)}}}return-1}(e);if(n)return void Vt(0);let i=0;6===r?i=-90:3===r?i=-180:8===r&&(i=-270),Vt(i)}).catch(e=>console.warn("Failed to parse EXIF",e))},[e,h,m]),(0,r.useEffect)(()=>{if(y.current)return Ot.current&&cancelAnimationFrame(Ot.current),Ot.current=requestAnimationFrame(()=>{tn()}),()=>{Ot.current&&(cancelAnimationFrame(Ot.current),Ot.current=null)}},[De,Be,Ge,ze,Wt]),(0,r.useEffect)(()=>{x&&b.current&&"off"!==Et&&nn()},[x,De,Be,Ge,Et]),(0,r.useEffect)(()=>{if(!x)return;if(!Ge)return;const e=De+Be+Ut,t=e*Math.PI/180,n=Math.abs(Math.sin(t)),r=Math.abs(Math.cos(t)),i=x.width*r+x.height*n,a=x.width*n+x.height*r,o=a>0?i/a:1,s=function(e,t,n,r=null){const i=n*Math.PI/180,a=Math.abs(Math.sin(i)),o=Math.abs(Math.cos(i)),s=e*o+t*a,l=e*a+t*o;if(a<.001||o<.001)return{x:0,y:0,w:1,h:1};const c=r||e/t,u=e/(c*o+a),d=t/(c*a+o),h=Math.min(u,d),p=h*c;return{x:(s-p)/2/s,y:(l-h)/2/l,w:p/s,h:h/l}}(x.width,x.height,e,o),l=c(Xe,x,Be,Qe);He(e=>{if(!l){let t=Math.min(e.w,s.w),n=Math.min(e.h,s.h);const r=e.x+e.w/2,i=e.y+e.h/2;return{x:Math.min(Math.max(r-t/2,s.x),s.x+s.w-t),y:Math.min(Math.max(i-n/2,s.y),s.y+s.h-n),w:t,h:n}}const t=l/o,n=e.x+e.w/2,r=e.y+e.h/2;let i=s.w,a=i/t;a>s.h&&(a=s.h,i=a*t);let c=Math.min(e.w,s.w),u=c/t;return u>s.h&&(u=s.h,c=u*t),i=c,a=u,{x:Math.min(Math.max(n-i/2,s.x),s.x+s.w-i),y:Math.min(Math.max(r-a/2,s.y),s.y+s.h-a),w:i,h:a}})},[Ge,Xe,Qe,De,Be,Ut,x]);const tn=()=>{try{const p=y.current;if(!p)return;const g=p.getContext("2d",{willReadFrequently:!0,colorSpace:"srgb"});if(!g)return;if(!x)return;if(!$t)return;const{rotatedW:v,rotatedH:A,rad:b,scaledW:_,scaledH:w}=$t;let S={x:0,y:0,w:1,h:1};if(!Ge&&$e){const e=Math.max(0,Math.min(1,$e.x||0)),t=Math.max(0,Math.min(1,$e.y||0)),n=Math.max(0,Math.min(1-e,$e.w||1));S={x:e,y:t,w:n,h:Math.max(0,Math.min(1-t,$e.h||1))}}let C=x,E=!1,P=!1;if(Ct&&z())try{if(Gt.current&&qt.current===Wt)C=Gt.current,E=!0,P=!0;else{var e,t,n,r,i,a,o,l;const c=document.createElement("canvas"),{gains:u,lut1:d,lut2:h}=Wt;let p=null;(d&&d.intensity>0||h&&h.intensity>0)&&(p=(0,f.buildCombinedLUT)(d,h));const m=De+Be+Ut,g=Ge?null:$e,v=null===B||void 0===B?void 0:B.find(e=>e.key===j),A=null!==(e=null===v||void 0===v?void 0:v.gamma)&&void 0!==e?e:.6,y=null!==(t=null===v||void 0===v?void 0:v.gammaR)&&void 0!==t?t:A,b=null!==(n=null===v||void 0===v?void 0:v.gammaG)&&void 0!==n?n:A,_=null!==(r=null===v||void 0===v?void 0:v.gammaB)&&void 0!==r?r:A,w=null!==(i=null===v||void 0===v?void 0:v.dMin)&&void 0!==i?i:.1,S=null!==(a=null===v||void 0===v?void 0:v.dMax)&&void 0!==a?a:3,T=null!==(o=null===v||void 0===v?void 0:v.toe)&&void 0!==o?o:0,N=null!==(l=null===v||void 0===v?void 0:v.shoulder)&&void 0!==l?l:0;U(c,x,{inverted:Wt.inverted,inversionMode:M,gains:u,baseMode:Wt.baseMode,baseGains:Wt.baseGains,baseDensity:Wt.baseDensity,densityLevelsEnabled:Wt.densityLevelsEnabled,densityLevels:Wt.densityLevels,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,filmCurveEnabled:L,filmCurveGamma:A,filmCurveGammaR:y,filmCurveGammaG:b,filmCurveGammaB:_,filmCurveDMin:w,filmCurveDMax:S,filmCurveToe:T,filmCurveShoulder:N,rotate:m,cropRect:g,scale:Wt.scale,curves:{rgb:s(nt.rgb),red:s(nt.red),green:s(nt.green),blue:s(nt.blue)},lut3:p,hslParams:ot,splitToning:lt}),Gt.current=c,qt.current=Wt,C=c,E=!0,P=!0}}catch(d){P=!1,E=!1,console.error("WebGL failed",d)}if(E)p.width=C.width,p.height=C.height,g.drawImage(C,0,0);else{const e=Math.max(1,Math.round(v*S.w)),t=Math.max(1,Math.round(A*S.h));p.width=e,p.height=t;const n=S.x*v,r=S.y*A;g.save(),g.translate(-n,-r),g.translate(v/2,A/2),g.rotate(b),g.drawImage(C,-_/2,-w/2,_,w),g.restore()}let N=null,k=null;if((!P||!ze)&&p.width>0&&p.height>0)try{N=g.getImageData(0,0,p.width,p.height),k=N.data}catch(h){console.warn("[FilmLab] getImageData failed:",h.message)}const R=new Array(256).fill(0),O=new Array(256).fill(0),D=new Array(256).fill(0),I=new Array(256).fill(0);let F=0;const V=Ge?6:2,G=p.width,q=p.height;let W=0,H=0,$=G,K=q;if(Ge&&We&&P&&(W=Math.max(0,Math.floor(We.x*G)),H=Math.max(0,Math.floor(We.y*q)),$=Math.min(G,Math.floor((We.x+We.w)*G)),K=Math.min(q,Math.floor((We.y+We.h)*q))),P){if(!ze&&k)for(let e=H;e<K;e+=V)for(let t=W;t<$;t+=V){const n=4*(e*G+t);if(0===k[n+3])continue;const r=k[n],i=k[n+1],a=k[n+2];O[r]++,D[i]++,I[a]++;const o=Math.round(.299*r+.587*i+.114*a);R[o]++,F=Math.max(F,O[r],D[i],I[a],R[o])}}else{var c,u;const e=(0,f.getEffectiveInverted)(m,T),t=new f.RenderCore({exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,curves:nt,red:he,green:fe,blue:ge,temp:le,tint:ue,lut1:bt,lut2:_t,lut1Intensity:null!==(c=null===bt||void 0===bt?void 0:bt.intensity)&&void 0!==c?c:1,lut2Intensity:null!==(u=null===_t||void 0===_t?void 0:_t.intensity)&&void 0!==u?u:1,inverted:e,inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,hslParams:ot,splitToning:lt,saturation:ut,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe});t.prepareLUTs();for(let n=0;n<q;n++)for(let e=0;e<G;e++){const r=4*(n*G+e);if(0===k[r+3])continue;const i=k[r],a=k[r+1],o=k[r+2],[s,l,c]=t.processPixel(i,a,o);if(e%V===0&&n%V===0){const e=Math.round(s),t=Math.round(l),n=Math.round(c);O[e]++,D[t]++,I[n]++;const r=Math.round(.299*s+.587*l+.114*c);R[r]++,F=Math.max(F,O[e],D[t],I[n],R[r])}k[r]=s,k[r+1]=l,k[r+2]=c}g.putImageData(N,0,0)}if(!ze&&F>0)for(let e=0;e<256;e++)R[e]/=F,O[e]/=F,D[e]/=F,I[e]/=F;ze||yt({rgb:R,red:O,green:D,blue:I})}catch(p){console.error("[FilmLab] processImage error (caught, UI preserved):",p)}},nn=()=>{if(!x||!b.current)return;const e=b.current,t=e.getContext("2d",{willReadFrequently:!0}),n=Math.min(1,1200/x.width),r=(De+Be+Ut)*Math.PI/180,i=Math.abs(Math.sin(r)),a=Math.abs(Math.cos(r)),o=x.width*n,s=x.height*n,l=o*a+s*i,c=o*i+s*a;e.width=Math.round(l),e.height=Math.round(c),t.save(),t.translate(l/2,c/2),t.rotate(r),t.drawImage(x,-o/2,-s/2,o,s),t.restore()},rn=(e,t)=>{if("undefined"!==typeof window&&window.__electron&&window.__electron.filmLabSaveAs)return void window.__electron.filmLabSaveAs({blob:e,defaultName:t}).then(n=>{if(n&&n.ok&&n.filePath)try{window.__electron.showInFolder&&window.__electron.showInFolder(n.filePath)}catch(r){}else if(n&&n.canceled);else if(n&&n.error){console.warn("Electron save-as failed, falling back to browser download:",n.error);const r=URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=t,i.click(),URL.revokeObjectURL(r)}}).catch(n=>{console.warn("Electron save-as exception, fallback:",n&&n.message);const r=URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=t,i.click(),URL.revokeObjectURL(r)});const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.click(),URL.revokeObjectURL(n)},an=()=>{var e,t;if(Ct&&z()&&!bt&&!_t)try{var n,r,i;const e=(0,f.computeWBGains)({red:he,green:fe,blue:ge,temp:le,tint:ue}),t=document.createElement("canvas");let a=null;if(bt&&bt.intensity>0||_t&&_t.intensity>0){const e=bt&&bt.size||_t&&_t.size;if(e){const t=e*e*e,n=new Float32Array(3*t),r=bt?bt.data:null,i=bt?bt.intensity:0,o=_t?_t.data:null,s=_t?_t.intensity:0;for(let l=0,c=0;l<t;l++,c+=3){const t=l%e,u=Math.floor(l/e)%e,d=Math.floor(l/(e*e));let h=t/(e-1),p=u/(e-1),f=d/(e-1);if(r&&i>0){const e=r[c],t=r[c+1],n=r[c+2];h=h*(1-i)+e*i,p=p*(1-i)+t*i,f=f*(1-i)+n*i}if(o&&s>0){const e=o[c],t=o[c+1],n=o[c+2];h=h*(1-s)+e*s,p=p*(1-s)+t*s,f=f*(1-s)+n*s}a={size:e,data:n}}}}const o=null===B||void 0===B?void 0:B.find(e=>e.key===j),l=null!==(n=null===o||void 0===o?void 0:o.gamma)&&void 0!==n?n:.6,c=null!==(r=null===o||void 0===o?void 0:o.dMin)&&void 0!==r?r:.1,u=null!==(i=null===o||void 0===o?void 0:o.dMax)&&void 0!==i?i:3,d=(0,f.getEffectiveInverted)(m,T);U(t,x,{inverted:d,inversionMode:M,gains:e,baseMode:Se,baseGains:[Ae,be,_e],baseDensity:[Ce,Ee,Ne],densityLevelsEnabled:Re,densityLevels:Oe,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,filmCurveEnabled:L,filmCurveGamma:l,filmCurveDMin:c,filmCurveDMax:u,curves:{rgb:s(nt.rgb),red:s(nt.red),green:s(nt.green),blue:s(nt.blue)},lut3:a,hslParams:ot,splitToning:lt});const h=document.createElement("canvas"),p=h.getContext("2d"),g=(De+Be+Ut)*Math.PI/180,v=Math.abs(Math.sin(g)),A=Math.abs(Math.cos(g)),y=t.width,b=t.height,_=y*A+b*v,w=y*v+b*A;let S=$e.x*_,C=$e.y*w,E=$e.w*_,P=$e.h*w;return S=Math.round(S),C=Math.round(C),E=Math.max(1,Math.round(E)),P=Math.max(1,Math.round(P)),h.width=E,h.height=P,p.save(),p.translate(-S,-C),p.translate(_/2,w/2),p.rotate(g),p.drawImage(t,-y/2,-b/2),p.restore(),new Promise(e=>{h.toBlob(t=>{rn(t,`film-lab-render-${Date.now()}.jpg`),e()},"image/jpeg",1)})}catch(P){console.warn("GPU Save As fallback to CPU:",P.message)}const a=document.createElement("canvas"),o=a.getContext("2d",{willReadFrequently:!0}),l=Math.min(1,4e3/x.width),c=(De+Be+Ut)*Math.PI/180,u=Math.abs(Math.sin(c)),d=Math.abs(Math.cos(c)),h=x.width*l,p=x.height*l,g=h*d+p*u,v=h*u+p*d;let A=$e.x*g,y=$e.y*v,b=$e.w*g,_=$e.h*v;A=Math.round(A),y=Math.round(y),b=Math.max(1,Math.round(b)),_=Math.max(1,Math.round(_)),a.width=b,a.height=_,o.save(),o.translate(-A,-y),o.translate(g/2,v/2),o.rotate(c),o.drawImage(x,-h/2,-p/2,h,p),o.restore();const w=o.getImageData(0,0,a.width,a.height),S=w.data,C=(0,f.getEffectiveInverted)(m,T),E=new f.RenderCore({exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,curves:nt,red:he,green:fe,blue:ge,temp:le,tint:ue,lut1:bt,lut2:_t,lut1Intensity:null!==(e=null===bt||void 0===bt?void 0:bt.intensity)&&void 0!==e?e:1,lut2Intensity:null!==(t=null===_t||void 0===_t?void 0:_t.intensity)&&void 0!==t?t:1,inverted:C,inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe,hslParams:ot,splitToning:lt});E.prepareLUTs();for(let s=0;s<S.length;s+=4){if(0===S[s+3])continue;const e=S[s],t=S[s+1],n=S[s+2],[r,i,a]=E.processPixel(e,t,n);S[s]=r,S[s+1]=i,S[s+2]=a}return o.putImageData(w,0,0),new Promise(e=>{a.toBlob(t=>{rn(t,`film-lab-render-${Date.now()}.jpg`),e()},"image/jpeg",1)})};return(0,r.useEffect)(()=>{const e=e=>{Ge&&("x"!==e.key&&"X"!==e.key||Ze(e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Ge]),(0,d.jsxs)("div",{className:"iv-overlay",style:{background:"rgba(10,10,10,0.98)",display:"flex",flexDirection:"row",color:"#eee"},children:[(0,d.jsx)("style",{children:'\n        .iv-sidebar {\n          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n        }\n        .iv-control-label {\n          font-size: 10px;\n          text-transform: uppercase;\n          letter-spacing: 0.8px;\n          color: #888;\n          font-weight: 600;\n        }\n        .iv-btn {\n          background: #333;\n          border: 1px solid #444;\n          color: #eee;\n          padding: 6px 12px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 12px;\n          transition: all 0.2s;\n          font-weight: 500;\n        }\n        .iv-btn:hover {\n          background: #444;\n          border-color: #555;\n        }\n        .iv-btn:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n        .iv-btn-primary {\n          background: #2e7d32;\n          border-color: #1b5e20;\n          color: white;\n        }\n        .iv-btn-primary:hover {\n          background: #388e3c;\n        }\n        .iv-btn-danger {\n          background: #c62828;\n          border-color: #b71c1c;\n        }\n        .iv-btn-danger:hover {\n          background: #d32f2f;\n        }\n        .iv-btn-icon {\n          background: transparent;\n          border: none;\n          color: #666;\n          cursor: pointer;\n          width: 20px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 4px;\n          font-size: 14px;\n          line-height: 1;\n        }\n        .iv-btn-icon:hover {\n          background: #333;\n          color: #fff;\n        }\n        input[type=range] {\n          -webkit-appearance: none;\n          width: 100%;\n          background: transparent;\n        }\n        input[type=range]:focus {\n          outline: none;\n        }\n        input[type=range]::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          height: 12px;\n          width: 12px;\n          border-radius: 50%;\n          background: #eee;\n          cursor: pointer;\n          margin-top: -4px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.5);\n          border: 1px solid #000;\n        }\n        input[type=range]::-webkit-slider-runnable-track {\n          width: 100%;\n          height: 4px;\n          cursor: pointer;\n          background: #444;\n          border-radius: 2px;\n        }\n        input[type=checkbox] {\n          accent-color: #2e7d32;\n          width: 16px;\n          height: 16px;\n          cursor: pointer;\n        }\n        /* Scrollbar */\n        .iv-scroll::-webkit-scrollbar {\n          width: 6px;\n        }\n        .iv-scroll::-webkit-scrollbar-track {\n          background: #1a1a1a;\n        }\n        .iv-scroll::-webkit-scrollbar-thumb {\n          background: #444;\n          border-radius: 3px;\n        }\n        .iv-scroll::-webkit-scrollbar-thumb:hover {\n          background: #555;\n        }\n      '}),(0,d.jsx)(R,{canvasRef:y,origCanvasRef:b,zoom:ht,setZoom:pt,pan:ft,setPan:mt,isPanning:gt,handleWheel:e=>{if(e.target.closest(".iv-sidebar"))return;const t=e.deltaY<0?1.1*ht:ht/1.1;pt(Math.min(Math.max(.1,t),10))},handlePanStart:e=>{if(0!==e.button)return;e.preventDefault(),vt(!0),et.current=!1;const t=e.clientX,n=e.clientY,r=ft.x,i=ft.y,a=e=>{const a=e.clientX-t,o=e.clientY-n;(Math.abs(a)>5||Math.abs(o)>5)&&(et.current=!0),mt({x:r+a,y:i+o})},o=()=>{vt(!1),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",a),window.addEventListener("mouseup",o)},isCropping:Ge,rotation:De,setRotation:Ie,onRotateStart:()=>{Ve.current=De,Ue(!0)},onRotateEnd:()=>{Ue(!1)},pushToHistory:en,handleCanvasClick:e=>{if(et.current)return;if(!V&&!q&&!H||!x||!y.current)return;const t=y.current,n=t.getBoundingClientRect(),r=(e.clientX-n.left)*(t.width/n.width),i=(e.clientY-n.top)*(t.height/n.height),a=document.createElement("canvas"),o=a.getContext("2d",{willReadFrequently:!0});a.width=t.width,a.height=t.height;const s=f.PREVIEW_MAX_WIDTH_CLIENT,l=Math.min(1,s/x.width),c=(De+Be+Ut)*Math.PI/180,u=Math.abs(Math.sin(c)),d=Math.abs(Math.cos(c)),h=x.width*l,p=x.height*l,m=h*d+p*u,g=h*u+p*d;let v={x:0,y:0,w:1,h:1};if(!Ge&&$e){const e=Math.max(0,Math.min(1,$e.x||0)),t=Math.max(0,Math.min(1,$e.y||0));v={x:e,y:t,w:Math.max(0,Math.min(1-e,$e.w||1)),h:Math.max(0,Math.min(1-t,$e.h||1))}}const A=v.x*m,b=v.y*g;o.save(),o.translate(-A,-b),o.translate(m/2,g/2),o.rotate(c),o.drawImage(x,-h/2,-p/2,h,p),o.restore();const _=Math.max(0,Math.min(a.width-3,Math.floor(r-1.5))),w=Math.max(0,Math.min(a.height-3,Math.floor(i-1.5))),S=o.getImageData(_,w,3,3).data;let T=0,C=0,M=0,E=0;for(let f=0;f<3;f++)for(let e=0;e<3;e++){const t=4*(3*f+e);0!==S[t+3]&&(T+=S[t+0],C+=S[t+1],M+=S[t+2],E++)}if(0!==E){if(T/=E,C/=E,M/=E,q){const e=Math.max(1,T),t=Math.max(1,C),n=Math.max(1,M);if(en(),"log"===Se){const r=.001,i=-Math.log10(Math.max(e/255,r)),a=-Math.log10(Math.max(t/255,r)),o=-Math.log10(Math.max(n/255,r));Me(i),Pe(a),ke(o),ye(255/e),xe(255/t),we(255/n)}else ye(255/e),xe(255/t),we(255/n),Me(0),Pe(0),ke(0);return void W(!1)}if(H){const e=t.getContext("2d",{willReadFrequently:!0,colorSpace:"srgb"}).getImageData(Math.max(0,Math.floor(r-1)),Math.max(0,Math.floor(i-1)),3,3).data;let n=0,a=0,o=0,s=0;for(let t=0;t<e.length;t+=4){e[t+3]<128||(n+=e[t],a+=e[t+1],o+=e[t+2],s++)}if(0===s)return console.warn("[FilmLab] WB Picker: no valid pixels sampled from rendered canvas"),void $(!1);n/=s,a/=s,o/=s,console.log("[WB Picker] Sampled pixel:",{r:n.toFixed(2),g:a.toFixed(2),b:o.toFixed(2)});const l=(0,f.solveTempTintFromSample)([n,a,o],{red:1,green:1,blue:1});return l&&Number.isFinite(l.temp)&&Number.isFinite(l.tint)?(en(),ce(l.temp),de(l.tint)):console.warn("[FilmLab] WB Picker failed to solve temp/tint"),void $(!1)}if(V){const e=t.getContext("2d",{willReadFrequently:!0,colorSpace:"srgb"}).getImageData(Math.max(0,Math.floor(r-1)),Math.max(0,Math.floor(i-1)),3,3).data;let n=0,a=0,o=0,s=0;for(let t=0;t<e.length;t+=4){e[t+3]<128||(n+=e[t],a+=e[t+1],o+=e[t+2],s++)}return s>0&&(n/=s,a/=s,o/=s),X({r:n,g:a,b:o}),void G(!1)}}else console.warn("[FilmLab] WB Picker: no valid pixels sampled")},isPicking:V||q||H,cropRect:We,setCropRect:He,image:x,orientation:Be,rotationOffset:Ut,ratioMode:Xe,ratioSwap:Qe,compareMode:Et,compareSlider:Nt,setCompareSlider:kt,expectedWidth:$t?Math.round($t.rotatedW):0}),A&&u&&(0,d.jsx)(D,{rollId:u,currentPhotoId:h,onPhotoChange:v,onApplyToBatch:(e,t)=>{alert(`\u5df2\u542f\u52a8\u6279\u91cf\u5e94\u7528\u4efb\u52a1\n\u4efb\u52a1 ID: ${e}\n\u5904\u7406\u7167\u7247: ${t} \u5f20`)},currentParams:Ht,collapsed:w,onToggleCollapse:()=>S(!w)}),(0,d.jsx)(k,{photoId:h,sourceType:m,inverted:T,setInverted:C,useGPU:Ct,setUseGPU:Mt,inversionMode:M,setInversionMode:E,filmType:P,setFilmType:N,filmCurveEnabled:L,setFilmCurveEnabled:O,filmCurveProfile:j,setFilmCurveProfile:I,filmCurveProfiles:B,setFilmCurveProfiles:F,baseMode:Se,setBaseMode:Te,isPickingBase:q,setIsPickingBase:W,handleAutoBase:()=>{if(!x)return;en();const e=((De||0)+(Be||0)+(Ut||0))*Math.PI/180,t=Math.abs(Math.sin(e)),n=Math.abs(Math.cos(e)),r=Math.min(1,256/Math.max(x.width,x.height)),i=x.width*r,a=x.height*r,o=Math.round(i*n+a*t),s=Math.round(i*t+a*n),l=document.createElement("canvas");l.width=o,l.height=s;const c=l.getContext("2d");c.save(),c.translate(o/2,s/2),c.rotate(e),c.drawImage(x,-i/2,-a/2,i,a),c.restore();const u=$e||{x:0,y:0,w:1,h:1},d=Math.round(u.x*l.width),h=Math.round(u.y*l.height),p=Math.max(1,Math.round(u.w*l.width)),f=Math.max(1,Math.round(u.h*l.height)),m=document.createElement("canvas");m.width=p,m.height=f;const g=m.getContext("2d",{willReadFrequently:!0});g.drawImage(l,d,h,p,f,0,0,p,f);const v=g.getImageData(0,0,m.width,m.height).data;let A=0;for(let x=0;x<v.length;x+=4){const e=.299*v[x]+.587*v[x+1]+.114*v[x+2];e>A&&(A=e)}const y=.95*A;let b=0,_=0,w=0,S=0;for(let x=0;x<v.length;x+=4){const e=v[x],t=v[x+1],n=v[x+2];.299*e+.587*t+.114*n>=y&&(b+=e,_+=t,w+=n,S++)}if(S>0){const e=b/S,t=_/S,n=w/S,r=Math.max(1,e),i=Math.max(1,t),a=Math.max(1,n);if("log"===Se){const e=.001,t=-Math.log10(Math.max(r/255,e)),n=-Math.log10(Math.max(i/255,e)),o=-Math.log10(Math.max(a/255,e));Me(t),Pe(n),ke(o),ye(255/r),xe(255/i),we(255/a)}else ye(255/r),xe(255/i),we(255/a),Me(0),Pe(0),ke(0)}},densityLevelsEnabled:Re,setDensityLevelsEnabled:Le,densityLevels:Oe,setDensityLevels:je,handleDensityAutoLevels:()=>{if(!x)return;en();const e=((De||0)+(Be||0)+(Ut||0))*Math.PI/180,t=Math.abs(Math.sin(e)),n=Math.abs(Math.cos(e)),r=Math.min(1,512/Math.max(x.width,x.height)),i=x.width*r,a=x.height*r,o=Math.round(i*n+a*t),s=Math.round(i*t+a*n),l=document.createElement("canvas");l.width=o,l.height=s;const c=l.getContext("2d");c.save(),c.translate(o/2,s/2),c.rotate(e),c.drawImage(x,-i/2,-a/2,i,a),c.restore();const u=$e||{x:0,y:0,w:1,h:1},d=Math.round(u.x*l.width),h=Math.round(u.y*l.height),p=Math.max(1,Math.round(u.w*l.width)),f=Math.max(1,Math.round(u.h*l.height)),m=document.createElement("canvas");m.width=p,m.height=f;const g=m.getContext("2d",{willReadFrequently:!0});g.drawImage(l,d,h,p,f,0,0,p,f);const v=g.getImageData(0,0,m.width,m.height).data,A=new Array(300).fill(0),y=new Array(300).fill(0),b=new Array(300).fill(0),_=.001,w=Math.log(10);for(let x=0;x<v.length;x+=4){let e=v[x]/255,t=v[x+1]/255,n=v[x+2]/255;if("log"===Se&&(0!==Ce||0!==Ee||0!==Ne)){let r=-Math.log(Math.max(e,_))/w,i=-Math.log(Math.max(t,_))/w,a=-Math.log(Math.max(n,_))/w;r-=Ce,i-=Ee,a-=Ne,e=Math.pow(10,-r),t=Math.pow(10,-i),n=Math.pow(10,-a)}const r=-Math.log(Math.max(e,_))/w,i=-Math.log(Math.max(t,_))/w,a=-Math.log(Math.max(n,_))/w,o=Math.max(0,Math.min(299,Math.round(100*r))),s=Math.max(0,Math.min(299,Math.round(100*i))),l=Math.max(0,Math.min(299,Math.round(100*a)));A[o]++,y[s]++,b[l]++}const S=e=>{const t=e.reduce((e,t)=>e+t,0);let n=0,r=0;for(let a=0;a<300;a++)if(n+=e[a],n/t>=.005){r=a/100;break}n=0;let i=3;for(let a=299;a>=0;a--)if(n+=e[a],n/t>=.005){i=a/100;break}return i<=r&&(i=r+.1),r=Math.max(0,r-.02),i=Math.min(3,i+.02),{min:Math.round(100*r)/100,max:Math.round(100*i)/100}},T=S(A),C=S(y),M=S(b);je({red:T,green:C,blue:M}),Le(!0)},handleResetDensityLevels:()=>{en(),je({red:{min:0,max:3},green:{min:0,max:3},blue:{min:0,max:3}}),Le(!1)},isPickingWB:H,setIsPickingWB:$,handleAutoColor:()=>{if(!y.current)return;en();const e=y.current,t=e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height).data;let n=0,r=0,i=0,a=0;for(let u=0;u<e.height;u+=4)for(let o=0;o<e.width;o+=4){const s=4*(u*e.width+o),l=t[s],c=t[s+1],d=t[s+2];if(t[s+3]<128)continue;const h=.299*l+.587*c+.114*d;h<10||h>245||(n+=l,r+=c,i+=d,a++)}if(0===a)return;const o=n/a,s=r/a,l=i/a;console.log("[Auto WB] Sampled averages:",{rAvg:o.toFixed(2),gAvg:s.toFixed(2),bAvg:l.toFixed(2),count:a});const c=(0,f.solveTempTintFromSample)([o,s,l],{red:1,green:1,blue:1});c&&Number.isFinite(c.temp)&&Number.isFinite(c.tint)&&(ce(c.temp),de(c.tint))},handleUndo:()=>{if(0===Yt.length)return;const e=Yt[Yt.length-1],t={inverted:T,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,curves:nt,rotation:De,cropRect:We};Jt(e=>[...e,t]),Qt(e=>e.slice(0,-1)),C("positive"!==m&&e.inverted),Q(e.exposure),J(e.contrast),te(e.highlights||0),re(e.shadows||0),ae(e.whites||0),se(e.blacks||0),ce(e.temp),de(e.tint),pe(e.red),me(e.green),ve(e.blue),rt(e.curves),Ie(e.rotation||0),He(e.cropRect||{x:0,y:0,w:1,h:1})},handleRedo:()=>{if(0===Zt.length)return;const e=Zt[Zt.length-1],t={inverted:T,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,curves:nt,rotation:De,cropRect:We};Qt(e=>[...e,t]),Jt(e=>e.slice(0,-1)),C("positive"!==m&&e.inverted),Q(e.exposure),J(e.contrast),te(e.highlights||0),re(e.shadows||0),ae(e.whites||0),se(e.blacks||0),ce(e.temp),de(e.tint),pe(e.red),me(e.green),ve(e.blue),rt(e.curves),Ie(e.rotation||0),He(e.cropRect||{x:0,y:0,w:1,h:1})},handleReset:()=>{en(),Je.current=!1,C(!1),Q(0),J(0),te(0),re(0),ae(0),se(0),ce(0),de(0),pe(1),me(1),ve(1),Te("log"),ye(1),xe(1),we(1),Me(0),Pe(0),ke(0),Ie(0),Fe(0),He({x:0,y:0,w:1,h:1}),pt(1),mt({x:0,y:0}),xt(null),wt(null),rt({rgb:[{x:0,y:0},{x:255,y:255}],red:[{x:0,y:0},{x:255,y:255}],green:[{x:0,y:0},{x:255,y:255}],blue:[{x:0,y:0},{x:255,y:255}]}),st({...f.DEFAULT_HSL_PARAMS}),ct({...f.DEFAULT_SPLIT_TONE_PARAMS})},history:Yt,future:Zt,handleAutoLevels:()=>{if(!x)return;en();const e=e=>{let t=0,n=255;for(let r=0;r<256;r++)if(e[r]>.005){t=r;break}for(let r=255;r>=0;r--)if(e[r]>.005){n=r;break}return{min:t,max:n}},t=e(At.red),n=e(At.green),r=e(At.blue);rt(e=>({...e,red:[{x:t.min,y:0},{x:t.max,y:255}],green:[{x:n.min,y:0},{x:n.max,y:255}],blue:[{x:r.min,y:0},{x:r.max,y:255}]}))},isCropping:Ge,setIsCropping:qe,onCropDone:()=>{en(),Ke({...We}),qe(!1)},ratioMode:Xe,setRatioMode:Ye,ratioSwap:Qe,setRatioSwap:Ze,rotation:De,setRotation:Ie,cropRect:We,setCropRect:He,onRotateStart:()=>{Ve.current=De,Ue(!0)},onRotateEnd:()=>{Ue(!1)},setOrientation:Fe,exposure:Y,setExposure:Q,contrast:Z,setContrast:J,highlights:ee,setHighlights:te,shadows:ne,setShadows:re,whites:ie,setWhites:ae,blacks:oe,setBlacks:se,temp:le,setTemp:ce,tint:ue,setTint:de,curves:nt,setCurves:rt,activeChannel:it,setActiveChannel:at,isPicking:V,setIsPicking:G,pickedColor:K,histograms:At,pushToHistory:en,hslParams:ot,setHslParams:st,splitToning:lt,setSplitToning:ct,saturation:ut,setSaturation:dt,lut1:bt,setLut1:xt,lut2:_t,setLut2:wt,lutExportSize:St,setLutExportSize:Tt,generateOutputLUT:()=>{var e,t;const n=St;let r=`LUT_3D_SIZE ${n}\n`;const i=(0,f.getEffectiveInverted)(m,T),a=new f.RenderCore({exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,curves:nt,red:he,green:fe,blue:ge,temp:le,tint:ue,lut1:bt,lut2:_t,lut1Intensity:null!==(e=null===bt||void 0===bt?void 0:bt.intensity)&&void 0!==e?e:1,lut2Intensity:null!==(t=null===_t||void 0===_t?void 0:_t.intensity)&&void 0!==t?t:1,inverted:i,inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,hslParams:ot,splitToning:lt,saturation:ut,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe});a.prepareLUTs();for(let c=0;c<n;c++)for(let e=0;e<n;e++)for(let t=0;t<n;t++){const i=t/(n-1)*255,o=e/(n-1)*255,s=c/(n-1)*255,[l,u,d]=a.processPixel(i,o,s);r+=`${(l/255).toFixed(6)} ${(u/255).toFixed(6)} ${(d/255).toFixed(6)}\n`}const o=new Blob([r],{type:"text/plain"}),s=URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download="film-lab-export.cube",l.click()},handleLutUpload:(e,t)=>{const n=e.target.files[0];if(!n)return;const r=new FileReader;r.onload=e=>{const r=e.target.result,i=l(r),a={name:n.name,...i,intensity:1};en(),1===t?xt(a):wt(a)},r.readAsText(n)},compareMode:Et,setCompareMode:Pt,compareSlider:Nt,setCompareSlider:kt,presets:Rt,onSavePreset:async e=>{if(!e)return;const t=e=>e?{...e,data:e.data?Array.from(e.data):null}:null,n={inverted:T,inversionMode:M,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,baseRed:Ae,baseGreen:be,baseBlue:_e,curves:JSON.parse(JSON.stringify(nt)),hslParams:ot,splitToning:lt,saturation:ut,filmCurveEnabled:L,filmCurveProfile:j,lut1:t(bt),lut2:t(_t)},r=Rt.find(t=>t.name===e);try{if(r&&r.id){await(0,i.Rz)(r.id,{name:e,category:"filmlab",description:"",params:n});const t=Rt.map(t=>t.name===e?{...t,params:n}:t);Kt(t)}else{const t=await(0,i.qJ)({name:e,category:"filmlab",description:"",params:n}),a=[...r&&r.id?Rt:Rt.filter(t=>t.name!==e),{id:t.id,name:e,params:n}];Kt(a)}}catch(a){console.error("Failed to save preset to backend, falling back to local only",a);let t;t=Rt.some(t=>t.name===e)?Rt.map(t=>t.name===e?{...t,params:n}:t):[...Rt,{name:e,params:n}],Kt(t)}},onApplyPreset:Xt,onDeletePreset:async e=>{const t=Rt.find(t=>t.name===e);if(t&&t.id)try{await(0,i.BC)(t.id)}catch(n){console.warn("Failed to delete preset in backend, still removing locally",n)}Kt(Rt.filter(t=>t.name!==e))},onApplyPresetToRoll:async e=>{if(e){if(!u)return Xt(e),void("undefined"!==typeof window&&alert("\u672a\u63d0\u4f9b rollId\uff0c\u5df2\u4ec5\u5bf9\u5f53\u524d\u56fe\u50cf\u5e94\u7528\u9884\u8bbe\u3002"));try{const t=await(0,i.F$)(u,{name:e.name,params:e.params});Xt(e),t&&t.ok&&"undefined"!==typeof window&&alert(`\u9884\u8bbe "${e.name}" \u5df2\u4fdd\u5b58\u5230\u6574\u5377\uff08roll ${u}\uff09\u3002\u540e\u7eed\u53ef\u5728\u8bbf\u95ee\u8be5\u5377\u65f6\u9ed8\u8ba4\u52a0\u8f7d\u3002`)}catch(t){console.error("Set roll preset failed",t),"undefined"!==typeof window&&alert("\u4fdd\u5b58\u6574\u5377\u9884\u8bbe\u5931\u8d25: "+t.message)}}},handleDownload:async()=>{if(!x||!h)return;const e={inverted:(0,f.getEffectiveInverted)(m,T),inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,rotation:De,orientation:Be,cropRect:$e,curves:nt,sourceType:m};if("tiff16"===Ft||"both"===Ft)try{"both"===Ft&&await an();const t=await(0,a.Rs)(h,e,{format:"tiff16",sourceType:m});return t.ok?void rn(t.blob,`film-lab-render-${Date.now()}.tiff`):void("undefined"!==typeof window&&alert("TIFF16 Render Failed: "+t.error))}catch(t){return console.error("Render-positive TIFF16 failed",t),void("undefined"!==typeof window&&alert("TIFF16 Render Failed: "+(t.message||t)))}await an()},handleSave:()=>{var e,t;if(!x)return;const r=document.createElement("canvas"),i=r.getContext("2d",{willReadFrequently:!0}),a=f.EXPORT_MAX_WIDTH,o=Math.min(1,a/x.width),s=(De+Be+Ut)*Math.PI/180,l=Math.abs(Math.sin(s)),c=Math.abs(Math.cos(s)),u=x.width*o,d=x.height*o,h=Math.round(u*c+d*l),p=Math.round(u*l+d*c),g=document.createElement("canvas");g.width=h,g.height=p;const v=g.getContext("2d");v.save(),v.translate(h/2,p/2),v.rotate(s),v.drawImage(x,-u/2,-d/2,u,d),v.restore();let A=Math.max(0,Math.min(1,$e.x)),y=Math.max(0,Math.min(1,$e.y)),b=Math.max(0,Math.min(1-A,$e.w)),_=Math.max(0,Math.min(1-y,$e.h));const w=Math.round(A*g.width),S=Math.round(y*g.height),C=Math.max(1,Math.round(b*g.width)),E=Math.max(1,Math.round(_*g.height));r.width=C,r.height=E,i.drawImage(g,w,S,C,E,0,0,C,E);const P=i.getImageData(0,0,r.width,r.height),N=P.data,k=(0,f.getEffectiveInverted)(m,T),R=new f.RenderCore({exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,curves:nt,red:he,green:fe,blue:ge,temp:le,tint:ue,lut1:bt,lut2:_t,lut1Intensity:null!==(e=null===bt||void 0===bt?void 0:bt.intensity)&&void 0!==e?e:1,lut2Intensity:null!==(t=null===_t||void 0===_t?void 0:_t.intensity)&&void 0!==t?t:1,inverted:k,inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe,hslParams:ot,splitToning:lt});R.prepareLUTs();for(let n=0;n<N.length;n+=4){if(0===N[n+3])continue;const e=N[n],t=N[n+1],r=N[n+2],[i,a,o]=R.processPixel(e,t,r);N[n]=i,N[n+1]=a,N[n+2]=o}i.putImageData(P,0,0),r.toBlob(e=>{n&&n(e)},"image/jpeg",1)},onClose:t,onHighQualityExport:async()=>{if(h&&!jt){Dt(!0);try{var e,t,n,r,i,o,s,l,c,u;const g=e=>!e||!e.data||e.intensity<=0?null:{size:e.size,data:Array.from(e.data),intensity:e.intensity},v=null===B||void 0===B?void 0:B.find(e=>e.key===j),A=null!==(e=null===v||void 0===v?void 0:v.gamma)&&void 0!==e?e:.6,y=null!==(t=null===v||void 0===v?void 0:v.gammaR)&&void 0!==t?t:A,b=null!==(n=null===v||void 0===v?void 0:v.gammaG)&&void 0!==n?n:A,x=null!==(r=null===v||void 0===v?void 0:v.gammaB)&&void 0!==r?r:A,_=null!==(i=null===v||void 0===v?void 0:v.dMin)&&void 0!==i?i:.1,w=null!==(o=null===v||void 0===v?void 0:v.dMax)&&void 0!==o?o:3,S=null!==(s=null===v||void 0===v?void 0:v.toe)&&void 0!==s?s:0,C=null!==(l=null===v||void 0===v?void 0:v.shoulder)&&void 0!==l?l:0,E={sourceType:m,inverted:(0,f.getEffectiveInverted)(m,T),inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,filmCurveGamma:A,filmCurveGammaR:y,filmCurveGammaG:b,filmCurveGammaB:x,filmCurveDMin:_,filmCurveDMax:w,filmCurveToe:S,filmCurveShoulder:C,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe,rotation:De,orientation:Be,cropRect:$e,curves:nt,hslParams:ot,splitToning:lt,saturation:ut,lut1:g(bt),lut2:g(_t),lut1Intensity:null!==(c=null===bt||void 0===bt?void 0:bt.intensity)&&void 0!==c?c:1,lut2Intensity:null!==(u=null===_t||void 0===_t?void 0:_t.intensity)&&void 0!==u?u:1},P=await(0,a.JX)(h,E,{format:"jpeg",sourceType:m});var d;if(P&&P.ok)p&&p(),P.filePath&&null!==(d=window.__electron)&&void 0!==d&&d.showInFolder&&console.log("[FilmLab] Export saved to:",P.filePath);else P&&P.error&&"undefined"!==typeof window&&alert("Export Failed: "+P.error)}catch(g){console.error("High quality export failed",g),"undefined"!==typeof window&&alert("High Quality Export Failed: "+(g.message||g))}finally{Dt(!1)}}},highQualityBusy:jt,onGpuExport:async()=>{if(!It){Bt(!0);try{var t;if(null!==(t=window.__electron)&&void 0!==t&&t.filmlabGpuProcess){var n,r,i,o,l,c,u,d;const t=(0,f.buildCompositeFloatCurveLUT)({rgb:nt.rgb,red:nt.red,green:nt.green,blue:nt.blue}),a=s(nt.rgb),v=s(nt.red),A=s(nt.green),y=s(nt.blue),b=new Uint8Array(1024);for(let e=0;e<256;e++){let t=e,n=e,r=e;t=a[t],n=a[n],r=a[r],t=v[t],n=A[n],r=y[r],b[4*e+0]=t,b[4*e+1]=n,b[4*e+2]=r,b[4*e+3]=255}let x=null;(bt||_t)&&(x=(0,f.buildCombinedLUT)(bt,_t));const _=null===B||void 0===B?void 0:B.find(e=>e.key===j),w=null!==(n=null===_||void 0===_?void 0:_.gamma)&&void 0!==n?n:.6,S=null!==(r=null===_||void 0===_?void 0:_.gammaR)&&void 0!==r?r:w,C=null!==(i=null===_||void 0===_?void 0:_.gammaG)&&void 0!==i?i:w,E=null!==(o=null===_||void 0===_?void 0:_.gammaB)&&void 0!==o?o:w,P=null!==(l=null===_||void 0===_?void 0:_.dMin)&&void 0!==l?l:.1,N=null!==(c=null===_||void 0===_?void 0:_.dMax)&&void 0!==c?c:3,k=null!==(u=null===_||void 0===_?void 0:_.toe)&&void 0!==u?u:0,R=null!==(d=null===_||void 0===_?void 0:_.shoulder)&&void 0!==d?d:0,O={sourceType:m,inverted:(0,f.getEffectiveInverted)(m,T),inversionMode:M,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe,rotation:De,orientation:Be,filmCurveEnabled:L,filmCurveGamma:w,filmCurveGammaR:S,filmCurveGammaG:C,filmCurveGammaB:E,filmCurveDMin:P,filmCurveDMax:N,filmCurveToe:k,filmCurveShoulder:R,cropRect:$e,toneCurveLutFloat:Array.from(t),toneCurveLut:Array.from(b),lut3d:x?{size:x.size,data:Array.from(x.data)}:null,hslParams:ot,splitToning:lt},D=await window.__electron.filmlabGpuProcess({params:O,photoId:h,imageUrl:e});if(null!==D&&void 0!==D&&D.ok){if(p&&p(),D.filePath){try{window.__electron.showInFolder&&window.__electron.showInFolder(D.filePath)}catch(g){}"undefined"!==typeof window&&alert("GPU Export Saved To:\n"+D.filePath)}return}console.warn("[FilmLab] GPU export failed, trying CPU fallback:",null===D||void 0===D?void 0:D.error)}else console.log("[FilmLab] GPU processor not available, using CPU fallback");console.log("[FilmLab] Attempting CPU export fallback");const v={sourceType:m,inverted:(0,f.getEffectiveInverted)(m,T),inversionMode:M,filmCurveEnabled:L,filmCurveProfile:j,exposure:Y,contrast:Z,highlights:ee,shadows:ne,whites:ie,blacks:oe,temp:le,tint:ue,red:he,green:fe,blue:ge,baseRed:Ae,baseGreen:be,baseBlue:_e,baseMode:Se,baseDensityR:Ce,baseDensityG:Ee,baseDensityB:Ne,densityLevelsEnabled:Re,densityLevels:Oe,rotation:De,orientation:Be,cropRect:$e,curves:nt,hslParams:ot,splitToning:lt,saturation:ut,lut1:bt?{size:bt.size,data:Array.from(bt.data),intensity:bt.intensity}:null,lut2:_t?{size:_t.size,data:Array.from(_t.data),intensity:_t.intensity}:null},A=await(0,a.JX)(h,v,{format:"jpeg",sourceType:m});if(null!==A&&void 0!==A&&A.ok){if(p&&p(),"undefined"!==typeof window){const e=A.source||"local";alert(`Export completed (${e} mode)`)}}else"undefined"!==typeof window&&alert("Export Failed: "+((null===A||void 0===A?void 0:A.error)||"Unknown error"))}catch(v){console.error("Export failed",v),"undefined"!==typeof window&&alert("Export Failed: "+(v.message||v))}finally{Bt(!1)}}},gpuBusy:It,exportFormat:Ft,setExportFormat:zt,onFinishBatchParams:o,currentParams:Ht})]})}var G=n(1848),q=n(8294);function W({images:e=[],index:t=0,onClose:n,onPhotoUpdate:a,viewMode:o="positive",roll:s,batchRenderCallback:l}){const[c,u]=(0,r.useState)(t),[h,p]=(0,r.useState)(1),[f,m]=(0,r.useState)({x:0,y:0}),[g,v]=(0,r.useState)(!1),[A,y]=(0,r.useState)({isOpen:!1,type:"alert",title:"",message:"",onConfirm:null}),b=(0,r.useRef)(!1),x=(0,r.useRef)({x:0,y:0}),_=(0,r.useRef)(),[w,S]=(0,r.useState)(!1),[T,C]=(0,r.useState)(!1),[M,E]=(0,r.useState)("original"),P=e&&e.length>c?e[c]:null,N=(0,r.useMemo)(()=>P?{original:!!(P.original_rel_path||P.negative_rel_path||P.full_rel_path),negative:!(!P.negative_rel_path&&!P.full_rel_path),positive:!!P.positive_rel_path}:{original:!1,negative:!1,positive:!1},[P]);function k(e){b.current=!0;const t=O(e);x.current=t}function R(e){if(!b.current)return;const t=O(e),n=t.x-x.current.x,r=t.y-x.current.y;x.current=t,m(e=>({x:e.x+n,y:e.y+r}))}function L(){b.current=!1}function O(e){return e.touches&&e.touches[0]?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}}(0,r.useEffect)(()=>{u(t),p(1),m({x:0,y:0})},[t,e]),(0,r.useEffect)(()=>{function t(t){"Escape"===t.key&&n(),"+"!==t.key&&"="!==t.key||p(e=>Math.min(4,+(e+.25).toFixed(2))),"-"===t.key&&p(e=>Math.max(.25,+(e-.25).toFixed(2))),"ArrowLeft"===t.key&&u(e=>Math.max(0,e-1)),"ArrowRight"===t.key&&u(t=>Math.min(e.length-1,t+1))}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,n]),(0,r.useEffect)(()=>{m({x:0,y:0}),p(1)},[c]),(0,r.useEffect)(()=>{if(l&&P){let e="original";N.original?e="original":N.negative?e="negative":N.positive&&(e="positive"),E(e),v(!0)}},[l,P,N]);const j=(e,t)=>{y({isOpen:!0,type:"alert",title:e,message:t,onConfirm:()=>y(e=>({...e,isOpen:!1}))})};if(!e||0===e.length)return null;let D=null;D="negative"===o?P.negative_rel_path?`/uploads/${P.negative_rel_path}`:P.full_rel_path?`/uploads/${P.full_rel_path}`:P.filename?P.filename:P:P.positive_rel_path?`/uploads/${P.positive_rel_path}`:P.full_rel_path?`/uploads/${P.full_rel_path}`:P.filename?P.filename:P;const I=(0,i.FH)(D)+`?t=${Date.now()}`,B=e=>{E(e),C(!1),v(!0)};if(g){const t=(()=>{switch(M){case"positive":return P.positive_rel_path?{path:P.positive_rel_path,valid:!0,warning:null}:(console.warn("[ImageViewer] Positive mode but no positive_rel_path available for photo:",P.id),{path:null,valid:!1,warning:"\u6b64\u7167\u7247\u6ca1\u6709\u6b63\u7247\u6587\u4ef6\uff0c\u8bf7\u5148\u4f7f\u7528\u8d1f\u7247\u6a21\u5f0f\u751f\u6210\u6b63\u7247"});case"negative":return P.negative_rel_path?{path:P.negative_rel_path,valid:!0,warning:null}:P.original_rel_path?{path:P.original_rel_path,valid:!0,warning:"\u4f7f\u7528\u539f\u59cb\u6587\u4ef6\u4f5c\u4e3a\u8d1f\u7247\u6e90"}:P.full_rel_path?{path:P.full_rel_path,valid:!0,warning:"\u4f7f\u7528\u65e7\u7248\u6587\u4ef6\u8def\u5f84"}:{path:null,valid:!1,warning:"\u65e0\u53ef\u7528\u7684\u8d1f\u7247/\u539f\u59cb\u6587\u4ef6"};default:return P.original_rel_path?{path:P.original_rel_path,valid:!0,warning:null}:P.negative_rel_path?{path:P.negative_rel_path,valid:!0,warning:"\u4f7f\u7528\u8d1f\u7247\u6587\u4ef6\u4f5c\u4e3a\u6e90"}:P.full_rel_path?{path:P.full_rel_path,valid:!0,warning:"\u4f7f\u7528\u65e7\u7248\u6587\u4ef6\u8def\u5f84"}:{path:null,valid:!1,warning:"\u65e0\u53ef\u7528\u7684\u6e90\u6587\u4ef6"}}})();if(!t.valid)return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(G.A,{isOpen:!0,type:"alert",title:"\u65e0\u6cd5\u6253\u5f00 FilmLab",message:t.warning||"\u6240\u9009\u6e90\u7c7b\u578b\u4e0d\u53ef\u7528",onConfirm:()=>{v(!1)}})});const r=t.path?(0,i.FH)(`/uploads/${t.path}`)+`?t=${Date.now()}&photoId=${P.id}`:I;return t.warning&&console.log("[ImageViewer] Source selection warning:",t.warning),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(G.A,{isOpen:A.isOpen,type:A.type,title:A.title,message:A.message,onConfirm:A.onConfirm,onCancel:A.onCancel}),(0,d.jsx)(V,{imageUrl:r,rollId:P.roll_id,photoId:P.id,sourceType:M,onPhotoUpdate:a,onClose:()=>{v(!1)},onFinishBatchParams:l?e=>{l(e),v(!1),n()}:null,photos:e,showPhotoSwitcher:e.length>1,onPhotoChange:t=>{const n=e.findIndex(e=>e.id===t.id);-1!==n&&u(n)},onSave:e=>{var t;t=async()=>{try{const t=await(0,i.K8)(P.id,e);if(t.error)throw new Error(t.error);a&&a(),v(!1)}catch(t){console.error(t),j("Error","Failed to save positive: "+(t.message||t))}},y({isOpen:!0,type:"confirm",title:"Save Positive",message:"Overwrite existing positive with this edit?",onConfirm:()=>{t(),y(e=>({...e,isOpen:!1}))},onCancel:()=>y(e=>({...e,isOpen:!1}))})}})]})}return(0,d.jsxs)("div",{className:"iv-overlay",onMouseUp:L,onMouseLeave:L,onTouchEnd:L,onTouchCancel:L,ref:_,role:"dialog","aria-modal":"true",children:[(0,d.jsx)(G.A,{isOpen:A.isOpen,type:A.type,title:A.title,message:A.message,onConfirm:A.onConfirm,onCancel:A.onCancel}),(0,d.jsxs)("div",{className:"iv-topbar",children:[(0,d.jsx)("div",{className:"iv-title",children:P.caption||P.frame_number||`Image ${c+1} / ${e.length}`}),(0,d.jsxs)("div",{className:"iv-controls",children:[(0,d.jsx)("button",{className:"iv-btn",onClick:()=>S(!0),title:"Edit Meta",children:"Edit Meta"}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>{if(Object.values(N).filter(Boolean).length<=1){const e=N.original?"original":N.negative?"negative":N.positive?"positive":"original";return E(e),void v(!0)}C(!0)},title:"Film Lab (Invert/Color)",children:"Film Lab"}),(0,d.jsx)("button",{className:"iv-btn",onClick:async()=>{console.log("[DOWNLOAD] Starting download for photo ID:",P.id);try{const e=(0,i.Ok)(P.id,"positive",!0);console.log("[DOWNLOAD] Using unified download URL:",e);const t=await fetch(e);if(!t.ok)throw new Error(`Server returned ${t.status}`);const n=await t.blob();console.log("[DOWNLOAD] Received blob size:",n.size,"bytes");const r=P.filename?P.filename.split("/").pop():`photo_${P.id}.jpg`;if(window.__electron){const e=await window.__electron.filmLabSaveAs({blob:n,defaultName:r});if(e&&e.error)throw new Error(e.error);console.log("[DOWNLOAD] \u2705 Download with EXIF successful")}else{const e=window.URL.createObjectURL(n),t=document.createElement("a");t.style.display="none",t.href=e,t.download=r,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(e),document.body.removeChild(t)}}catch(e){console.error("Download failed",e),j("Error","Download failed: "+e.message)}},title:"Save to Disk",children:"Download"}),(0,d.jsx)("button",{className:"iv-btn",onClick:function(){p(e=>Math.max(.25,+(e-.25).toFixed(2)))},children:"\u2212"}),(0,d.jsx)("button",{className:"iv-btn",onClick:function(){p(1),m({x:0,y:0})},children:"Reset"}),(0,d.jsx)("button",{className:"iv-btn",onClick:function(){p(e=>Math.min(4,+(e+.25).toFixed(2)))},children:"+"}),(0,d.jsx)("button",{className:"iv-btn iv-close",onClick:n,children:"Close"})]})]}),T&&(0,d.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1100},onClick:()=>C(!1),children:(0,d.jsxs)("div",{style:{backgroundColor:"#2a2a2a",borderRadius:12,padding:"24px 32px",minWidth:320,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("h3",{style:{margin:"0 0 16px",color:"#fff",fontSize:18,fontWeight:600},children:"\u9009\u62e9\u7f16\u8f91\u6e90"}),(0,d.jsx)("p",{style:{margin:"0 0 20px",color:"#999",fontSize:13},children:"\u9009\u62e9\u8981\u5728 Film Lab \u4e2d\u7f16\u8f91\u7684\u56fe\u50cf\u6e90"}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,d.jsxs)("button",{className:"iv-btn",onClick:()=>B("original"),disabled:!N.original&&!N.negative,style:{padding:"12px 16px",textAlign:"left",background:"#333",opacity:N.original||N.negative?1:.4},children:[(0,d.jsx)("div",{style:{fontSize:14,fontWeight:500,color:"#fff"},children:"\ud83c\udf9e\ufe0f \u539f\u59cb (Original)"}),(0,d.jsx)("div",{style:{fontSize:11,color:"#888",marginTop:4},children:N.original?"\u4f7f\u7528\u539f\u59cb\u4e0a\u4f20\u7684TIFF/Raw\u6587\u4ef6":N.negative?"\u4f7f\u7528\u8d1f\u7247\u626b\u63cf":"\u65e0\u53ef\u7528\u6e90"})]}),(0,d.jsxs)("button",{className:"iv-btn",onClick:()=>B("negative"),disabled:!N.negative,style:{padding:"12px 16px",textAlign:"left",background:"#333",opacity:N.negative?1:.4},children:[(0,d.jsx)("div",{style:{fontSize:14,fontWeight:500,color:"#fff"},children:"\ud83d\udcf7 \u8d1f\u7247 (Negative)"}),(0,d.jsx)("div",{style:{fontSize:11,color:"#888",marginTop:4},children:N.negative?"\u4f7f\u7528\u8d1f\u7247\u626b\u63cf\u8fdb\u884c\u53cd\u76f8\u5904\u7406":"\u65e0\u8d1f\u7247\u6587\u4ef6"})]}),(0,d.jsxs)("button",{className:"iv-btn",onClick:()=>B("positive"),disabled:!N.positive,style:{padding:"12px 16px",textAlign:"left",background:"#333",opacity:N.positive?1:.4},children:[(0,d.jsx)("div",{style:{fontSize:14,fontWeight:500,color:"#fff"},children:"\u2728 \u6b63\u7247 (Positive)"}),(0,d.jsx)("div",{style:{fontSize:11,color:"#888",marginTop:4},children:N.positive?"\u5fae\u8c03\u5df2\u6e32\u67d3\u7684\u6b63\u7247\uff08\u8272\u8c03/\u66f2\u7ebf\u8c03\u6574\uff09":"\u5c1a\u672a\u6e32\u67d3\u6b63\u7247"})]})]}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>C(!1),style:{marginTop:16,width:"100%",padding:"10px",background:"#444"},children:"\u53d6\u6d88"})]})}),(0,d.jsx)("div",{className:"iv-canvas",onWheel:function(e){e.preventDefault();const t=e.deltaY;p(e=>{const n=t>0?e-.15:e+.15;return Math.min(4,Math.max(.25,+n.toFixed(2)))})},onMouseDown:k,onMouseMove:R,onTouchStart:k,onTouchMove:R,style:{cursor:h>1?"grab":"auto"},children:(0,d.jsx)("img",{src:I,alt:P.caption||"",className:"iv-image",style:{transform:`translate(${f.x}px, ${f.y}px) scale(${h})`,transition:b.current?"none":"transform 0.12s ease-out"},draggable:!1})}),(0,d.jsxs)("div",{className:"iv-footer",children:[(0,d.jsx)("button",{className:"iv-btn",onClick:()=>u(e=>Math.max(0,e-1)),disabled:0===c,children:"Prev"}),(0,d.jsxs)("div",{className:"iv-small",children:[c+1," / ",e.length]}),(0,d.jsx)("button",{className:"iv-btn",onClick:()=>u(t=>Math.min(e.length-1,t+1)),disabled:c===e.length-1,children:"Next"})]}),w&&(0,d.jsx)(q.A,{photo:P,roll:s,onClose:()=>S(!1),onSaved:()=>{S(!1),a&&a()}},`photo-details-${P.id}`)]})}},9015:function(e,t,n){"use strict";n.d(t,{$:function(){return l}});var r=new Set(["id","type","style","title","role","tabIndex","htmlFor","width","height","abbr","accept","acceptCharset","accessKey","action","allowFullScreen","allowTransparency","alt","async","autoComplete","autoFocus","autoPlay","cellPadding","cellSpacing","challenge","charset","checked","cite","class","className","cols","colSpan","command","content","contentEditable","contextMenu","controls","coords","crossOrigin","data","dateTime","default","defer","dir","disabled","download","draggable","dropzone","encType","enterKeyHint","for","form","formAction","formEncType","formMethod","formNoValidate","formTarget","frameBorder","headers","hidden","high","href","hrefLang","httpEquiv","icon","inputMode","isMap","itemId","itemProp","itemRef","itemScope","itemType","kind","label","lang","list","loop","manifest","max","maxLength","media","mediaGroup","method","min","minLength","multiple","muted","name","noValidate","open","optimum","pattern","ping","placeholder","poster","preload","radioGroup","referrerPolicy","readOnly","rel","required","rows","rowSpan","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","slot","sortable","span","spellCheck","src","srcDoc","srcSet","start","step","target","translate","typeMustMatch","useMap","value","wmode","wrap"]),i=new Set(["onCopy","onCut","onPaste","onLoad","onError","onWheel","onScroll","onCompositionEnd","onCompositionStart","onCompositionUpdate","onKeyDown","onKeyPress","onKeyUp","onFocus","onBlur","onChange","onInput","onSubmit","onClick","onContextMenu","onDoubleClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onPointerDown","onPointerEnter","onPointerLeave","onPointerUp","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd"]),a=/^(data-.*)$/,o=/^(aria-.*)$/,s=/^(on[A-Z].*)$/;function l(e,t={}){let{labelable:n=!0,enabled:l=!0,propNames:c,omitPropNames:u,omitEventNames:d,omitDataProps:h,omitEventProps:p}=t,f={};if(!l)return e;for(const m in e)(null==u?void 0:u.has(m))||(null==d?void 0:d.has(m))&&s.test(m)||s.test(m)&&!i.has(m)||h&&a.test(m)||p&&s.test(m)||(Object.prototype.hasOwnProperty.call(e,m)&&(r.has(m)||n&&o.test(m)||(null==c?void 0:c.has(m))||a.test(m))||s.test(m))&&(f[m]=e[m]);return f}},9044:function(e){"use strict";const t=[".dng",".cr2",".cr3",".nef",".arw",".raf",".orf",".rw2",".pef",".srw",".x3f",".erf",".mef",".mos",".mrw",".kdc",".3fr",".fff",".iiq",".dcr",".k25",".qtk"];function n(e){if(!e||"string"!==typeof e)return!1;const n=e.lastIndexOf(".");if(-1===n)return!1;const r=e.slice(n).toLowerCase();return t.includes(r)}function r(e){if(!e||"string"!==typeof e)return"unknown";const n=e.lastIndexOf(".");if(-1===n)return"unknown";const r=e.slice(n).toLowerCase();return t.includes(r)?"raw":[".tif",".tiff"].includes(r)?"tiff":[".bmp",".dib"].includes(r)?"bmp":[".jpg",".jpeg"].includes(r)?"jpeg":".png"===r?"png":"unknown"}e.exports={RAW_EXTENSIONS:t,isRawFile:n,getRawFormatInfo:function(e){if(!n(e))return null;const t=e.lastIndexOf(".");return{".dng":{ext:".dng",name:"Adobe Digital Negative",manufacturer:"Adobe"},".cr2":{ext:".cr2",name:"Canon RAW 2",manufacturer:"Canon"},".cr3":{ext:".cr3",name:"Canon RAW 3",manufacturer:"Canon"},".nef":{ext:".nef",name:"Nikon Electronic Format",manufacturer:"Nikon"},".arw":{ext:".arw",name:"Sony Alpha RAW",manufacturer:"Sony"},".raf":{ext:".raf",name:"Fujifilm RAW",manufacturer:"Fujifilm"},".orf":{ext:".orf",name:"Olympus RAW Format",manufacturer:"Olympus"},".rw2":{ext:".rw2",name:"Panasonic RAW",manufacturer:"Panasonic"},".pef":{ext:".pef",name:"Pentax Electronic Format",manufacturer:"Pentax"},".srw":{ext:".srw",name:"Samsung RAW",manufacturer:"Samsung"},".x3f":{ext:".x3f",name:"Sigma RAW",manufacturer:"Sigma"},".erf":{ext:".erf",name:"Epson RAW Format",manufacturer:"Epson"},".mef":{ext:".mef",name:"Mamiya Electronic Format",manufacturer:"Mamiya"},".mos":{ext:".mos",name:"Leaf RAW",manufacturer:"Leaf"},".mrw":{ext:".mrw",name:"Minolta RAW",manufacturer:"Minolta"},".kdc":{ext:".kdc",name:"Kodak Digital Camera",manufacturer:"Kodak"},".3fr":{ext:".3fr",name:"Hasselblad 3F RAW",manufacturer:"Hasselblad"},".fff":{ext:".fff",name:"Hasselblad/Imacon FlexFrame",manufacturer:"Hasselblad"},".iiq":{ext:".iiq",name:"Phase One IIQ",manufacturer:"Phase One"},".dcr":{ext:".dcr",name:"Kodak RAW",manufacturer:"Kodak"},".k25":{ext:".k25",name:"Kodak DC25",manufacturer:"Kodak"},".qtk":{ext:".qtk",name:"Apple QuickTake",manufacturer:"Apple"}}[e.slice(t).toLowerCase()]||null},detectFileType:r,isBrowserLoadable:function(e){const t=r(e);return"jpeg"===t||"png"===t||"bmp"===t},requiresServerDecode:function(e){const t=r(e);return"raw"===t||"tiff"===t}}},9075:function(e,t,n){"use strict";n.d(t,{a:function(){return i},o:function(){return a}});var r=n(5043);const i=new WeakMap;function a(e){let{triggerRef:t,isOpen:n,onClose:a}=e;(0,r.useEffect)(()=>{if(!n||null===a)return;let e=e=>{let n=e.target;if(!t.current||n instanceof Node&&!n.contains(t.current))return;if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;let r=a||i.get(t.current);r&&r()};return window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("scroll",e,!0)}},[n,a,t])}},9086:function(e,t,n){"use strict";n.d(t,{V:function(){return r}});const r=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2},9161:function(e,t,n){"use strict";n.d(t,{M:function(){return d}});var r=n(3941),i=n(8493),a=n(2417),o=n(5043);let s=!1,l=0;function c(e){"touch"===e.pointerType&&(s=!0,setTimeout(()=>{s=!1},50))}function u(){if("undefined"!==typeof document)return 0===l&&"undefined"!==typeof PointerEvent&&document.addEventListener("pointerup",c),l++,()=>{l--,l>0||"undefined"!==typeof PointerEvent&&document.removeEventListener("pointerup",c)}}function d(e){let{onHoverStart:t,onHoverChange:n,onHoverEnd:l,isDisabled:c}=e,[d,h]=(0,o.useState)(!1),p=(0,o.useRef)({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;(0,o.useEffect)(u,[]);let{addGlobalListener:f,removeAllGlobalListeners:m}=(0,a.A)(),{hoverProps:g,triggerHoverEnd:v}=(0,o.useMemo)(()=>{let e=(e,t)=>{let r=p.target;p.pointerType="",p.target=null,"touch"!==t&&p.isHovered&&r&&(p.isHovered=!1,m(),l&&l({type:"hoverend",target:r,pointerType:t}),n&&n(!1),h(!1))},a={};return"undefined"!==typeof PointerEvent&&(a.onPointerEnter=a=>{s&&"mouse"===a.pointerType||((a,o)=>{if(p.pointerType=o,c||"touch"===o||p.isHovered||!a.currentTarget.contains(a.target))return;p.isHovered=!0;let s=a.currentTarget;p.target=s,f((0,i.TW)(a.target),"pointerover",t=>{p.isHovered&&p.target&&!(0,r.sD)(p.target,t.target)&&e(t,t.pointerType)},{capture:!0}),t&&t({type:"hoverstart",target:s,pointerType:o}),n&&n(!0),h(!0)})(a,a.pointerType)},a.onPointerLeave=t=>{!c&&t.currentTarget.contains(t.target)&&e(t,t.pointerType)}),{hoverProps:a,triggerHoverEnd:e}},[t,n,l,c,p,f,m]);return(0,o.useEffect)(()=>{c&&v({currentTarget:p.target},p.pointerType)},[c]),{hoverProps:g,isHovered:d}}},9184:function(e,t,n){"use strict";n.d(t,{l:function(){return s}});var r=n(2196),i=n(54),a=n(8603),o=n(8909);function s(e,t){let n,{elementType:s="button",isDisabled:l,onPress:c,onPressStart:u,onPressEnd:d,onPressUp:h,onPressChange:p,preventFocusOnPress:f,allowFocusWhenDisabled:m,onClick:g,href:v,target:A,rel:y,type:b="button",allowTextSelectionOnPress:x}=e;n="button"===s?{type:b,disabled:l}:{role:"button",href:"a"!==s||l?void 0:v,target:"a"===s?A:void 0,type:"input"===s?b:void 0,disabled:"input"===s?l:void 0,"aria-disabled":l&&"input"!==s?l:void 0,rel:"a"===s?y:void 0};let{pressProps:_,isPressed:w}=(0,o.d)({onClick:g,onPressStart:u,onPressEnd:d,onPressUp:h,onPressChange:p,onPress:c,isDisabled:l,preventFocusOnPress:f,allowTextSelectionOnPress:x,ref:t}),{focusableProps:S}=(0,a.Wc)(e,t);m&&(S.tabIndex=l?-1:S.tabIndex);let T=(0,r.v)(S,_,(0,i.$)(e,{labelable:!0}));return{isPressed:w,buttonProps:(0,r.v)(n,T,{"aria-haspopup":e["aria-haspopup"],"aria-expanded":e["aria-expanded"],"aria-controls":e["aria-controls"],"aria-pressed":e["aria-pressed"],"aria-current":e["aria-current"]})}}},9210:function(e){e.exports={evToGain:function(e){return Math.pow(2,e)},applyExposure:function(e,t){return e*Math.pow(2,t)},applyWhiteBalance:function(e,t,n,r){return{r:e*r.r,g:t*r.g,b:n*r.b}}}},9265:function(e,t,n){"use strict";n.d(t,{tv:function(){return a}});var r=n(6639),i=n(6264),a=(e,t)=>{var n,a,o;return(0,i.tv)(e,{...t,twMerge:null==(n=null==t?void 0:t.twMerge)||n,twMergeConfig:{...null==t?void 0:t.twMergeConfig,theme:{...null==(a=null==t?void 0:t.twMergeConfig)?void 0:a.theme,...r.w.theme},classGroups:{...null==(o=null==t?void 0:t.twMergeConfig)?void 0:o.classGroups,...r.w.classGroups}}})}},9277:function(e,t,n){"use strict";n.d(t,{JX:function(){return b},Rs:function(){return A},bf:function(){return m}});var r=n(8624),i=n(6116);let a=null,o=0;const s=6e4,l=new Map;let c=0;const u={NO_GPU_PROCESSOR:"E_NO_GPU_PROCESSOR",PHOTO_NOT_FOUND:"E_PHOTO_NOT_FOUND",SERVER_UNAVAILABLE:"E_SERVER_UNAVAILABLE",NAS_NO_COMPUTE:"E_NAS_NO_COMPUTE",UPLOAD_FAILED:"E_UPLOAD_FAILED",PROCESSING_FAILED:"E_PROCESSING_FAILED",NETWORK_ERROR:"E_NETWORK_ERROR",TIMEOUT:"E_TIMEOUT"};function d(e,t,n={}){return{ok:!1,error:t,code:e,details:n,timestamp:Date.now()}}async function h(){const e=Date.now();if(a&&e-o<s)return a;try{const s=(0,r.Gi)(),d=await fetch(`${s}/api/discover`);if(d.ok){var t,n,i,l,c,u;const r=await d.json();return a={mode:r.mode||"standalone",compute:null===(t=null===(n=r.capabilities)||void 0===n?void 0:n.compute)||void 0===t||t,database:null===(i=null===(l=r.capabilities)||void 0===l?void 0:l.database)||void 0===i||i,files:null===(c=null===(u=r.capabilities)||void 0===u?void 0:u.files)||void 0===c||c,version:r.version},o=e,a}}catch(d){console.warn("[ComputeService] Failed to fetch capabilities:",d)}return{mode:"standalone",compute:!0,database:!0,files:!0}}async function p(){return!0===(await h()).compute}function f(){var e;return null!==(e=window.__electron)&&void 0!==e&&e.filmlabGpuProcess?window.__electron.filmlabGpuProcess:null}async function m({photoId:e,params:t,maxWidth:n=1400,sourceType:i="original"}){if(await p()){var a,o;const s=(0,r.Gi)(),l=await fetch(`${s}/api/filmlab/preview`,{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache"},body:JSON.stringify({photoId:e,params:t,maxWidth:n,sourceType:i}),cache:"no-store"});if((l.headers.get("content-type")||"").startsWith("image/")){return{ok:!0,blob:await l.blob(),source:"server"}}if(503===l.status){if("E_NAS_NO_COMPUTE"===(await l.json().catch(()=>({}))).code)return await g({photoId:e,params:t,maxWidth:n})}const c=await l.text();let u;try{u=JSON.parse(c)}catch{u={error:c}}return{ok:!1,error:(null===(a=u)||void 0===a?void 0:a.error)||(null===(o=u)||void 0===o?void 0:o.message)||c}}return await g({photoId:e,params:t,maxWidth:n,sourceType:i})}async function g({photoId:e,params:t,maxWidth:n,sourceType:r="original"}){const a=await v(e,r);if(!a)return{ok:!1,error:`Cannot get photo image URL for sourceType: ${r}`};const o=f();if(o)try{const i=await o({params:t,photoId:e,imageUrl:a,previewMode:!0,maxWidth:n,sourceType:r});if(null!==i&&void 0!==i&&i.ok)return{ok:!0,blob:i.blob,source:"local-gpu"};console.warn("[ComputeService] GPU preview failed, falling back to CPU:",null===i||void 0===i?void 0:i.error)}catch(s){console.warn("[ComputeService] GPU preview exception, falling back to CPU:",s.message)}else console.log("[ComputeService] GPU processor not available, using CPU fallback");return console.log("[ComputeService] Using CPU fallback for preview"),await i.Ay.localCpuPreview({imageUrl:a,params:t,maxWidth:n})}async function v(e,t="original"){try{const n=(0,r.Gi)(),i=await fetch(`${n}/api/photos/${e}`);if(i.ok){const e=await i.json();switch(t){case"positive":return e.positive_rel_path?`${n}/uploads/${e.positive_rel_path}`:null;case"negative":return e.negative_rel_path?`${n}/uploads/${e.negative_rel_path}`:e.original_rel_path?`${n}/uploads/${e.original_rel_path}`:e.full_rel_path?`${n}/uploads/${e.full_rel_path}`:null;default:return e.original_rel_path?`${n}/uploads/${e.original_rel_path}`:e.negative_rel_path?`${n}/uploads/${e.negative_rel_path}`:e.full_rel_path?`${n}/uploads/${e.full_rel_path}`:null}}}catch(n){console.error("[ComputeService] Failed to get photo info:",n)}return null}async function A(e,t,{format:n="jpeg",sourceType:i="original"}={}){if(await p()){var a,o;const s=(0,r.Gi)(),l=await fetch(`${s}/api/photos/${e}/render-positive`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({params:t,format:n,sourceType:i})}),c=l.headers.get("content-type")||"";if(c.startsWith("image/")){return{ok:!0,blob:await l.blob(),contentType:c,source:"server"}}if(503===l.status){if("E_NAS_NO_COMPUTE"===(await l.json().catch(()=>({}))).code)return await y(e,t,{format:n,sourceType:i})}const u=await l.text();let d;try{d=JSON.parse(u)}catch{d={error:u}}return{ok:!1,error:(null===(a=d)||void 0===a?void 0:a.error)||(null===(o=d)||void 0===o?void 0:o.message)||u}}return await y(e,t,{format:n,sourceType:i})}async function y(e,t,{format:n="jpeg",sourceType:r="original"}={}){const a=await v(e,r);if(!a)return{ok:!1,error:`Cannot get photo image URL for sourceType: ${r}`};const o=f();if(o)try{const i=await o({params:t,photoId:e,imageUrl:a,previewMode:!1,outputFormat:n,sourceType:r});if(null!==i&&void 0!==i&&i.ok)return{ok:!0,blob:i.blob,contentType:"tiff16"===n?"image/tiff":"image/jpeg",source:"local-gpu"};console.warn("[ComputeService] GPU render failed, falling back to CPU:",null===i||void 0===i?void 0:i.error)}catch(s){console.warn("[ComputeService] GPU render exception, falling back to CPU:",s.message)}else console.log("[ComputeService] GPU processor not available, using CPU fallback");return console.log("[ComputeService] Using CPU fallback for render, format:",n),await i.Ay.localCpuRender({imageUrl:a,params:t,format:n,maxWidth:0})}async function b(e,t,{format:n="jpeg",sourceType:i="original"}={}){if(await p()){const o=(0,r.Gi)();try{const r=await fetch(`${o}/api/filmlab/export`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({photoId:e,params:t,format:n,sourceType:i})});if(r.ok){return{ok:!0,...await r.json(),source:"server"}}if(503===r.status){if("E_NAS_NO_COMPUTE"===(await r.json().catch(()=>({}))).code)return await x(e,t,{format:n,sourceType:i})}const a=await r.json().catch(()=>({}));return{ok:!1,error:(null===a||void 0===a?void 0:a.error)||`Server export failed: ${r.status}`}}catch(a){return console.error("[ComputeService] Server export failed:",a),{ok:!1,error:a.message||"Server export failed"}}}return await x(e,t,{format:n,sourceType:i})}async function x(e,t,{format:n="jpeg",sourceType:r="original"}={}){const a=await v(e,r);if(!a)return d(u.PHOTO_NOT_FOUND,`Cannot get photo image URL for sourceType: ${r}`);const o=f();if(o)try{console.log("[ComputeService] Attempting GPU export, photoId:",e);const i=await o({params:t,photoId:e,imageUrl:a,previewMode:!1,outputFormat:n,sourceType:r});if(null!==i&&void 0!==i&&i.ok)return console.log("[ComputeService] GPU export successful"),{ok:!0,photo:i.photo,filePath:i.filePath,source:"local-gpu"};console.warn("[ComputeService] GPU export failed, falling back to CPU:",null===i||void 0===i?void 0:i.error)}catch(s){console.warn("[ComputeService] GPU export exception, falling back to CPU:",s.message)}else console.log("[ComputeService] GPU processor not available, using CPU fallback");return console.log("[ComputeService] Using CPU fallback for export"),await i.Ay.localCpuExport({photoId:e,imageUrl:a,params:t,format:n},_)}async function _(e,t={}){const{photoId:n,filename:i,type:a="processed",onProgress:o}=t;if(!e)return d(u.PROCESSING_FAILED,"No blob to upload");const s=new FormData,l=i||`processed_${n}_${Date.now()}.jpg`;s.append("file",e,l),s.append("type",a),n&&s.append("photoId",n);try{return await new Promise((e,t)=>{const n=(0,r.Gi)(),i=new XMLHttpRequest;i.open("POST",`${n}/api/uploads/processed`),i.onload=()=>{if(i.status>=200&&i.status<300)try{const t=JSON.parse(i.responseText);e({ok:!0,...t,source:"remote-upload"})}catch{e({ok:!0,url:i.responseText,source:"remote-upload"})}else e(d(u.UPLOAD_FAILED,`Upload failed: ${i.statusText}`,{status:i.status}))},i.onerror=()=>{e(d(u.NETWORK_ERROR,"Network error during upload"))},i.ontimeout=()=>{e(d(u.TIMEOUT,"Upload timed out"))},i.upload&&o&&(i.upload.onprogress=e=>{e.lengthComputable&&o({phase:"upload",loaded:e.loaded,total:e.total,percent:Math.round(e.loaded/e.total*100)})}),i.timeout=12e4,i.send(s)})}catch(c){return console.error("[ComputeService] Upload failed:",c),d(u.UPLOAD_FAILED,c.message)}}async function w(e,t,n={}){const{format:r="jpeg",sourceType:i="original",onProgress:a,uploadToServer:o=!0}=n;a&&a({phase:"processing",percent:0,message:"\u5f00\u59cb\u5904\u7406..."});const s=await y(e,t,{format:r,sourceType:i});if(!s.ok)return s;if(a&&a({phase:"processing",percent:100,message:"\u5904\u7406\u5b8c\u6210"}),!o)return s;a&&a({phase:"upload",percent:0,message:"\u5f00\u59cb\u4e0a\u4f20..."});const l=await _(s.blob,{photoId:e,filename:`filmlab_${e}_${Date.now()}.${"tiff16"===r?"tiff":"jpg"}`,type:"processed",onProgress:e=>{a&&a({phase:"upload",...e,message:`\u4e0a\u4f20\u4e2d ${e.percent}%`})}});return l.ok?(a&&a({phase:"complete",percent:100,message:"\u5b8c\u6210"}),{ok:!0,blob:s.blob,remoteUrl:l.url,source:"local-gpu-uploaded"}):{...s,uploadError:l.error,uploadFailed:!0}}function S(e,t){for(const[,{taskId:r,callback:i}]of l)if(r===e)try{i(t)}catch(n){console.warn("[ComputeService] Progress callback error:",n)}}const T={getServerCapabilities:h,isComputeAvailable:p,isHybridMode:function(){var e;return!!window.__electron&&"hybrid"===(null===(e=window.__electron)||void 0===e?void 0:e.serverMode)},getLocalGpuProcessor:f,clearCapabilityCache:function(){a=null,o=0},smartFilmlabPreview:m,smartRenderPositive:A,smartExportPositive:b,uploadProcessedResult:_,processAndUpload:w,registerProgressCallback:function(e,t){const n=++c;return l.set(n,{taskId:e,callback:t}),n},unregisterProgressCallback:function(e){l.delete(e)},emitProgress:S,createProgressTask:function(e){let t="init",n=0;return{taskId:e,update(r,i,a){t=r,n=i,S(e,{phase:r,percent:i,message:a,timestamp:Date.now()})},getProgress(){return{phase:t,percent:n}},complete(t){S(e,{phase:"complete",percent:100,result:t,timestamp:Date.now()})},error(t){S(e,{phase:"error",error:t,timestamp:Date.now()})}}},batchProcess:async function(e,t,n={}){const{format:r="jpeg",concurrency:i=1,uploadToServer:a=!0,onProgress:o,onItemComplete:s}=n,l=[],c=e.length;let d=0,h=0;const p=()=>{o&&o({total:c,completed:d,failed:h,percent:Math.round(d/c*100),current:d+h})},f=async e=>{try{const n=await w(e,t,{format:r,uploadToServer:a,onProgress:e=>{}});return n.ok?d++:h++,s&&s({photoId:e,result:n}),p(),{photoId:e,...n}}catch(n){return h++,p(),{photoId:e,ok:!1,error:n.message,code:u.PROCESSING_FAILED}}};for(let u=0;u<e.length;u+=i){const t=e.slice(u,u+i),n=await Promise.all(t.map(f));l.push(...n)}return{ok:0===h,total:c,completed:d,failed:h,results:l}},ComputeErrorCodes:u};t.Ay=T},9288:function(e){"use strict";e.exports={getSaturationGLSL:function(){return"\n// \u2500\u2500 Saturation (Luma-Preserving, Rec.709) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nvec3 applySaturation(vec3 color) {\n  float s = 1.0 + u_saturation / 100.0;\n  float lum = dot(color, vec3(0.2126, 0.7152, 0.0722));\n  return clamp(vec3(lum) + (color - vec3(lum)) * s, 0.0, 1.0);\n}\n"},getSaturationMainCall:function(){return"\n  // \u2466b Saturation (Luma-Preserving)\n  if (u_useSaturation > 0.5) {\n    color = applySaturation(color);\n  }\n"}}},9323:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(7260),i=n(2489),a=n(3272),o=n(1444);t.get=function e(t,n,s){if(null==t)return s;switch(typeof n){case"string":{if(r.isUnsafeProperty(n))return s;const a=t[n];return void 0===a?i.isDeepKey(n)?e(t,o.toPath(n),s):s:a}case"number":case"symbol":{"number"===typeof n&&(n=a.toKey(n));const e=t[n];return void 0===e?s:e}default:{if(Array.isArray(n))return function(e,t,n){if(0===t.length)return n;let i=e;for(let a=0;a<t.length;a++){if(null==i)return n;if(r.isUnsafeProperty(t[a]))return n;i=i[t[a]]}if(void 0===i)return n;return i}(t,n,s);if(n=Object.is(n?.valueOf(),-0)?"-0":String(n),r.isUnsafeProperty(n))return s;const e=t[n];return void 0===e?s:e}}}},9397:function(e,t,n){e.exports=n(2682).isPlainObject},9420:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});const r=e=>"string"===typeof e&&"svg"===e.toLowerCase()},9426:function(e,t,n){"use strict";n.d(t,{O:function(){return s},e:function(){return o}});var r=n(9615),i=n(9742),a=n(3223);function o(e){return(0,r.N)(e.animate)||a._.some(t=>(0,i.w)(e[t]))}function s(e){return Boolean(o(e)||e.variants)}},9427:function(e,t,n){"use strict";function r(e){var t;if("undefined"===typeof window||null==window.navigator)return!1;let n=null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.brands;return Array.isArray(n)&&n.some(t=>e.test(t.brand))||e.test(window.navigator.userAgent)}function i(e){var t;return"undefined"!==typeof window&&null!=window.navigator&&e.test((null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.platform)||window.navigator.platform)}function a(e){let t=null;return()=>(null==t&&(t=e()),t)}n.d(t,{H8:function(){return h},Tc:function(){return d},bh:function(){return l},cX:function(){return o},gm:function(){return f},lg:function(){return u},m0:function(){return p},un:function(){return c}});const o=a(function(){return i(/^Mac/i)}),s=a(function(){return i(/^iPhone/i)}),l=a(function(){return i(/^iPad/i)||o()&&navigator.maxTouchPoints>1}),c=a(function(){return s()||l()}),u=a(function(){return o()||c()}),d=a(function(){return r(/AppleWebKit/i)&&!h()}),h=a(function(){return r(/Chrome/i)}),p=a(function(){return r(/Android/i)}),f=a(function(){return r(/Firefox/i)})},9461:function(e,t,n){"use strict";e.exports=n(2330)},9546:function(e){e.exports={HSL_ADJUST_GLSL:"\n// ============================================================================\n// HSL Channel Weight Calculation\n// Cosine smooth transition: 0.5*(1+cos(t*PI))  \u2014 matches CPU filmLabHSL.js\n// ============================================================================\n\nfloat hslChannelWeight(float hue, float centerHue, float hueRange) {\n  float dist = min(abs(hue - centerHue), 360.0 - abs(hue - centerHue));\n  if (dist >= hueRange) return 0.0;\n  float t = dist / hueRange;\n  return 0.5 * (1.0 + cos(t * 3.14159265));\n}\n\n// ============================================================================\n// HSL Adjustment Application\n// Matches CPU filmLabHSL.js \u2014 asymmetric sat/lum, weight normalization\n// ============================================================================\n\nvec3 applyHSLAdjustment(vec3 color) {\n  vec3 hsl = rgb2hsl(color);\n  float h = hsl.x;\n  float s = hsl.y;\n  float l = hsl.z;\n\n  float hueAdjust = 0.0;\n  float satAdjust = 0.0;\n  float lumAdjust = 0.0;\n  float totalWeight = 0.0;\n  float w;\n\n  // 8 channels: hue centers & ranges from HSL_CHANNELS (filmLabHSL.js)\n  w = hslChannelWeight(h, 0.0, 30.0);\n  if (w > 0.0) { hueAdjust += u_hslRed.x * w; satAdjust += (u_hslRed.y / 100.0) * w; lumAdjust += (u_hslRed.z / 100.0) * w; totalWeight += w; }\n  w = hslChannelWeight(h, 30.0, 30.0);\n  if (w > 0.0) { hueAdjust += u_hslOrange.x * w; satAdjust += (u_hslOrange.y / 100.0) * w; lumAdjust += (u_hslOrange.z / 100.0) * w; totalWeight += w; }\n  w = hslChannelWeight(h, 60.0, 30.0);\n  if (w > 0.0) { hueAdjust += u_hslYellow.x * w; satAdjust += (u_hslYellow.y / 100.0) * w; lumAdjust += (u_hslYellow.z / 100.0) * w; totalWeight += w; }\n  w = hslChannelWeight(h, 120.0, 45.0);\n  if (w > 0.0) { hueAdjust += u_hslGreen.x * w; satAdjust += (u_hslGreen.y / 100.0) * w; lumAdjust += (u_hslGreen.z / 100.0) * w; totalWeight += w; }\n  w = hslChannelWeight(h, 180.0, 30.0);\n  if (w > 0.0) { hueAdjust += u_hslCyan.x * w; satAdjust += (u_hslCyan.y / 100.0) * w; lumAdjust += (u_hslCyan.z / 100.0) * w; totalWeight += w; }\n  w = hslChannelWeight(h, 240.0, 45.0);\n  if (w > 0.0) { hueAdjust += u_hslBlue.x * w; satAdjust += (u_hslBlue.y / 100.0) * w; lumAdjust += (u_hslBlue.z / 100.0) * w; totalWeight += w; }\n  w = hslChannelWeight(h, 280.0, 30.0);\n  if (w > 0.0) { hueAdjust += u_hslPurple.x * w; satAdjust += (u_hslPurple.y / 100.0) * w; lumAdjust += (u_hslPurple.z / 100.0) * w; totalWeight += w; }\n  // Magenta: center 330\xb0 (NOT 320\xb0) \u2014 matches CPU HSL_CHANNELS definition\n  w = hslChannelWeight(h, 330.0, 30.0);\n  if (w > 0.0) { hueAdjust += u_hslMagenta.x * w; satAdjust += (u_hslMagenta.y / 100.0) * w; lumAdjust += (u_hslMagenta.z / 100.0) * w; totalWeight += w; }\n\n  // Normalize if overlapping channels sum > 1 (BUG-07 fix)\n  if (totalWeight > 1.0) {\n    hueAdjust /= totalWeight;\n    satAdjust /= totalWeight;\n    lumAdjust /= totalWeight;\n  }\n\n  if (totalWeight > 0.0) {\n    hsl.x = mod(hsl.x + hueAdjust, 360.0);\n\n    // Asymmetric saturation (BUG-04 fix \u2014 matches CPU filmLabHSL.js)\n    // Positive: expand toward 1.0;  Negative: compress toward 0.0\n    if (satAdjust > 0.0) {\n      hsl.y = s + (1.0 - s) * satAdjust;\n    } else if (satAdjust < 0.0) {\n      hsl.y = s * (1.0 + satAdjust);\n    }\n    hsl.y = clamp(hsl.y, 0.0, 1.0);\n\n    // Asymmetric luminance with 0.5 damping (BUG-05 fix \u2014 matches CPU filmLabHSL.js)\n    if (lumAdjust > 0.0) {\n      hsl.z = l + (1.0 - l) * lumAdjust * 0.5;\n    } else if (lumAdjust < 0.0) {\n      hsl.z = l * (1.0 + lumAdjust * 0.5);\n    }\n    hsl.z = clamp(hsl.z, 0.0, 1.0);\n  }\n\n  return hsl2rgb(hsl);\n}\n"}},9565:function(e,t,n){"use strict";n.d(t,{$:function(){return r},V:function(){return i}});let r=()=>{},i=()=>{}},9570:function(e,t,n){"use strict";n.d(t,{N:function(){return b}});var r=n(579),i=n(5043),a=n(2190),o=n(4930),s=n(293),l=n(9674),c=n(8676),u=n(1051);function d(e,t){if("function"===typeof e)return e(t);null!==e&&void 0!==e&&(e.current=t)}function h(...e){return i.useCallback(function(...e){return t=>{let n=!1;const r=e.map(e=>{const r=d(e,t);return n||"function"!==typeof r||(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"===typeof n?n():d(e[t],null)}}}}(...e),e)}class p extends i.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=(0,c.s)(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=n-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function f({children:e,isPresent:t,anchorX:n,root:a}){const o=(0,i.useId)(),s=(0,i.useRef)(null),l=(0,i.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,i.useContext)(u.Q),d=h(s,e?.ref);return(0,i.useInsertionEffect)(()=>{const{width:e,height:r,top:i,left:u,right:d}=l.current;if(t||!s.current||!e||!r)return;const h="left"===n?`left: ${u}`:`right: ${d}`;s.current.dataset.motionPopId=o;const p=document.createElement("style");c&&(p.nonce=c);const f=a??document.head;return f.appendChild(p),p.sheet&&p.sheet.insertRule(`\n          [data-motion-pop-id="${o}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${r}px !important;\n            ${h}px !important;\n            top: ${i}px !important;\n          }\n        `),()=>{f.contains(p)&&f.removeChild(p)}},[t]),(0,r.jsx)(p,{isPresent:t,childRef:s,sizeRef:l,children:i.cloneElement(e,{ref:d})})}const m=({children:e,initial:t,isPresent:n,onExitComplete:a,custom:s,presenceAffectsLayout:c,mode:u,anchorX:d,root:h})=>{const p=(0,o.M)(g),m=(0,i.useId)();let v=!0,A=(0,i.useMemo)(()=>(v=!1,{id:m,initial:t,isPresent:n,custom:s,onExitComplete:e=>{p.set(e,!0);for(const t of p.values())if(!t)return;a&&a()},register:e=>(p.set(e,!1),()=>p.delete(e))}),[n,p,a]);return c&&v&&(A={...A}),(0,i.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[n]),i.useEffect(()=>{!n&&!p.size&&a&&a()},[n]),"popLayout"===u&&(e=(0,r.jsx)(f,{isPresent:n,anchorX:d,root:h,children:e})),(0,r.jsx)(l.t.Provider,{value:A,children:e})};function g(){return new Map}var v=n(8917);const A=e=>e.key||"";function y(e){const t=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&t.push(e)}),t}const b=({children:e,custom:t,initial:n=!0,onExitComplete:l,presenceAffectsLayout:c=!0,mode:u="sync",propagate:d=!1,anchorX:h="left",root:p})=>{const[f,g]=(0,v.xQ)(d),b=(0,i.useMemo)(()=>y(e),[e]),x=d&&!f?[]:b.map(A),_=(0,i.useRef)(!0),w=(0,i.useRef)(b),S=(0,o.M)(()=>new Map),[T,C]=(0,i.useState)(b),[M,E]=(0,i.useState)(b);(0,s.E)(()=>{_.current=!1,w.current=b;for(let e=0;e<M.length;e++){const t=A(M[e]);x.includes(t)?S.delete(t):!0!==S.get(t)&&S.set(t,!1)}},[M,x.length,x.join("-")]);const P=[];if(b!==T){let e=[...b];for(let t=0;t<M.length;t++){const n=M[t],r=A(n);x.includes(r)||(e.splice(t,0,n),P.push(n))}return"wait"===u&&P.length&&(e=P),E(y(e)),C(b),null}const{forceRender:N}=(0,i.useContext)(a.L);return(0,r.jsx)(r.Fragment,{children:M.map(e=>{const i=A(e),a=!(d&&!f)&&(b===M||x.includes(i));return(0,r.jsx)(m,{isPresent:a,initial:!(_.current&&!n)&&void 0,custom:t,presenceAffectsLayout:c,mode:u,root:p,onExitComplete:a?void 0:()=>{if(!S.has(i))return;S.set(i,!0);let e=!0;S.forEach(t=>{t||(e=!1)}),e&&(N?.(),E(w.current),d&&g?.(),l&&l())},anchorX:h,children:e},i)})})}},9599:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.identity=function(e){return e}},9601:function(e,t,n){"use strict";n.d(t,{B:function(){return i}});const r={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},i={};for(const a in r)i[a]={isEnabled:e=>r[a].some(t=>!!e[t])}},9615:function(e,t,n){"use strict";function r(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}n.d(t,{N:function(){return r}})},9634:function(e,t,n){(()=>{var t={296:(e,t,n)=>{var r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,o=/^0o[0-7]+$/i,s=parseInt,l="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),d=Object.prototype.toString,h=Math.max,p=Math.min,f=function(){return u.Date.now()};function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=a.test(e);return n||o.test(e)?s(e.slice(2),n?2:8):i.test(e)?NaN:+e}e.exports=function(e,t,n){var r,i,a,o,s,l,c=0,u=!1,d=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function A(t){var n=r,a=i;return r=i=void 0,c=t,o=e.apply(a,n)}function y(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=a}function b(){var e=f();if(y(e))return x(e);s=setTimeout(b,function(e){var n=t-(e-l);return d?p(n,a-(e-c)):n}(e))}function x(e){return s=void 0,v&&r?A(e):(r=i=void 0,o)}function _(){var e=f(),n=y(e);if(r=arguments,i=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(b,t),u?A(e):o}(l);if(d)return s=setTimeout(b,t),A(l)}return void 0===s&&(s=setTimeout(b,t)),o}return t=g(t)||0,m(n)&&(u=!!n.leading,a=(d="maxWait"in n)?h(g(n.maxWait)||0,t):a,v="trailing"in n?!!n.trailing:v),_.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=l=i=s=void 0},_.flush=function(){return void 0===s?o:x(f())},_}},96:(e,t,n)=>{var r="Expected a function",i=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,l=parseInt,c="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,u="object"==typeof self&&self&&self.Object===Object&&self,d=c||u||Function("return this")(),h=Object.prototype.toString,p=Math.max,f=Math.min,m=function(){return d.Date.now()};function g(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==h.call(e)}(e))return NaN;if(g(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=g(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=o.test(e);return n||s.test(e)?l(e.slice(2),n?2:8):a.test(e)?NaN:+e}e.exports=function(e,t,n){var i=!0,a=!0;if("function"!=typeof e)throw new TypeError(r);return g(n)&&(i="leading"in n?!!n.leading:i,a="trailing"in n?!!n.trailing:a),function(e,t,n){var i,a,o,s,l,c,u=0,d=!1,h=!1,A=!0;if("function"!=typeof e)throw new TypeError(r);function y(t){var n=i,r=a;return i=a=void 0,u=t,s=e.apply(r,n)}function b(e){var n=e-c;return void 0===c||n>=t||n<0||h&&e-u>=o}function x(){var e=m();if(b(e))return _(e);l=setTimeout(x,function(e){var n=t-(e-c);return h?f(n,o-(e-u)):n}(e))}function _(e){return l=void 0,A&&i?y(e):(i=a=void 0,s)}function w(){var e=m(),n=b(e);if(i=arguments,a=this,c=e,n){if(void 0===l)return function(e){return u=e,l=setTimeout(x,t),d?y(e):s}(c);if(h)return l=setTimeout(x,t),y(c)}return void 0===l&&(l=setTimeout(x,t)),s}return t=v(t)||0,g(n)&&(d=!!n.leading,o=(h="maxWait"in n)?p(v(n.maxWait)||0,t):o,A="trailing"in n?!!n.trailing:A),w.cancel=function(){void 0!==l&&clearTimeout(l),u=0,i=c=a=l=void 0},w.flush=function(){return void 0===l?s:_(m())},w}(e,t,{leading:i,maxWait:t,trailing:a})}},703:(e,t,n)=>{"use strict";var r=n(414);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},697:(e,t,n)=>{e.exports=n(703)()},414:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{"use strict";i.r(a),i.d(a,{LazyLoadComponent:()=>q,LazyLoadImage:()=>te,trackWindowScroll:()=>L});const e=n(5043);var t=i.n(e),r=i(697);function o(){return"undefined"!=typeof window&&"IntersectionObserver"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(e){var t=function(e){if("object"!==s(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===s(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var f=function(e){e.forEach(function(e){e.isIntersecting&&e.target.onVisible()})},m={},g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(g,e);var n,r,i,a,d=(i=g,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=p(i);if(a){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function g(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(t=d.call(this,e)).supportsObserver=!e.scrollPosition&&e.useIntersectionObserver&&o(),t.supportsObserver){var n=e.threshold;t.observer=function(e){return m[e]=m[e]||new IntersectionObserver(f,{rootMargin:e+"px"}),m[e]}(n)}return t}return n=g,r=[{key:"componentDidMount",value:function(){this.placeholder&&this.observer&&(this.placeholder.onVisible=this.props.onVisible,this.observer.observe(this.placeholder)),this.supportsObserver||this.updateVisibility()}},{key:"componentWillUnmount",value:function(){this.observer&&this.placeholder&&this.observer.unobserve(this.placeholder)}},{key:"componentDidUpdate",value:function(){this.supportsObserver||this.updateVisibility()}},{key:"getPlaceholderBoundingBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.scrollPosition,t=this.placeholder.getBoundingClientRect(),n=this.placeholder.style,r=parseInt(n.getPropertyValue("margin-left"),10)||0,i=parseInt(n.getPropertyValue("margin-top"),10)||0;return{bottom:e.y+t.bottom+i,left:e.x+t.left+r,right:e.x+t.right+r,top:e.y+t.top+i}}},{key:"isPlaceholderInViewport",value:function(){if("undefined"==typeof window||!this.placeholder)return!1;var e=this.props,t=e.scrollPosition,n=e.threshold,r=this.getPlaceholderBoundingBox(t),i=t.y+window.innerHeight,a=t.x,o=t.x+window.innerWidth,s=t.y;return Boolean(s-n<=r.bottom&&i+n>=r.top&&a-n<=r.right&&o+n>=r.left)}},{key:"updateVisibility",value:function(){this.isPlaceholderInViewport()&&this.props.onVisible()}},{key:"render",value:function(){var e=this,n=this.props,r=n.className,i=n.height,a=n.placeholder,o=n.style,s=n.width;if(a&&"function"!=typeof a.type)return t().cloneElement(a,{ref:function(t){return e.placeholder=t}});var u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({display:"inline-block"},o);return void 0!==s&&(u.width=s),void 0!==i&&(u.height=i),t().createElement("span",{className:r,ref:function(t){return e.placeholder=t},style:u},a)}}],r&&u(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),g}(t().Component);g.propTypes={onVisible:r.PropTypes.func.isRequired,className:r.PropTypes.string,height:r.PropTypes.oneOfType([r.PropTypes.number,r.PropTypes.string]),placeholder:r.PropTypes.element,threshold:r.PropTypes.number,useIntersectionObserver:r.PropTypes.bool,scrollPosition:r.PropTypes.shape({x:r.PropTypes.number.isRequired,y:r.PropTypes.number.isRequired}),width:r.PropTypes.oneOfType([r.PropTypes.number,r.PropTypes.string])},g.defaultProps={className:"",placeholder:null,threshold:100,useIntersectionObserver:!0};const v=g;var A=i(296),y=i.n(A),b=i(96),x=i.n(b),_=function(e){var t=getComputedStyle(e,null);return t.getPropertyValue("overflow")+t.getPropertyValue("overflow-y")+t.getPropertyValue("overflow-x")};const w=function(e){if(!(e instanceof HTMLElement))return window;for(var t=e;t&&t instanceof HTMLElement;){if(/(scroll|auto)/.test(_(t)))return t;t=t.parentNode}return window};function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}var T=["delayMethod","delayTime"];function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(this,arguments)}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function E(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},N(e)}var k=function(){return"undefined"==typeof window?0:window.scrollX||window.pageXOffset},R=function(){return"undefined"==typeof window?0:window.scrollY||window.pageYOffset};const L=function(e){var n=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(c,n);var r,i,a,s,l=(a=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N(a);if(s){var n=N(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return E(this,e)});function c(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=l.call(this,e)).useIntersectionObserver=e.useIntersectionObserver&&o(),n.useIntersectionObserver)return E(n);var r=n.onChangeScroll.bind(P(n));return"debounce"===e.delayMethod?n.delayedScroll=y()(r,e.delayTime):"throttle"===e.delayMethod&&(n.delayedScroll=x()(r,e.delayTime)),n.state={scrollPosition:{x:k(),y:R()}},n.baseComponentRef=t().createRef(),n}return r=c,(i=[{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"componentDidUpdate",value:function(){"undefined"==typeof window||this.useIntersectionObserver||w(this.baseComponentRef.current)!==this.scrollElement&&(this.removeListeners(),this.addListeners())}},{key:"addListeners",value:function(){"undefined"==typeof window||this.useIntersectionObserver||(this.scrollElement=w(this.baseComponentRef.current),this.scrollElement.addEventListener("scroll",this.delayedScroll,{passive:!0}),window.addEventListener("resize",this.delayedScroll,{passive:!0}),this.scrollElement!==window&&window.addEventListener("scroll",this.delayedScroll,{passive:!0}))}},{key:"removeListeners",value:function(){"undefined"==typeof window||this.useIntersectionObserver||(this.scrollElement.removeEventListener("scroll",this.delayedScroll),window.removeEventListener("resize",this.delayedScroll),this.scrollElement!==window&&window.removeEventListener("scroll",this.delayedScroll))}},{key:"onChangeScroll",value:function(){this.useIntersectionObserver||this.setState({scrollPosition:{x:k(),y:R()}})}},{key:"render",value:function(){var n=this.props,r=(n.delayMethod,n.delayTime,function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(n,T)),i=this.useIntersectionObserver?null:this.state.scrollPosition;return t().createElement(e,C({forwardRef:this.baseComponentRef,scrollPosition:i},r))}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=function(e){if("object"!==S(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===S(i)?i:String(i)),r)}var i}(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),c}(t().Component);return n.propTypes={delayMethod:r.PropTypes.oneOf(["debounce","throttle"]),delayTime:r.PropTypes.number,useIntersectionObserver:r.PropTypes.bool},n.defaultProps={delayMethod:"throttle",delayTime:300,useIntersectionObserver:!0},n};function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function j(e,t){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},j(e,t)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&j(e,t)}(s,e);var n,r,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=D(i);if(a){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,e)}return n=s,(r=[{key:"render",value:function(){return t().createElement(v,this.props)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=function(e){if("object"!==O(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===O(i)?i:String(i)),r)}var i}(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);const B=L(I);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function z(e,t){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},z(e,t)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}var G=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&z(e,t)}(l,e);var n,r,i,a,s=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=V(i);if(a){var n=V(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return U(e)}(this,e)});function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=s.call(this,e);var n=e.afterLoad,r=e.beforeLoad,i=e.scrollPosition,a=e.visibleByDefault;return t.state={visible:a},a&&(r(),n()),t.onVisible=t.onVisible.bind(U(t)),t.isScrollTracked=Boolean(i&&Number.isFinite(i.x)&&i.x>=0&&Number.isFinite(i.y)&&i.y>=0),t}return n=l,(r=[{key:"componentDidUpdate",value:function(e,t){t.visible!==this.state.visible&&this.props.afterLoad()}},{key:"onVisible",value:function(){this.props.beforeLoad(),this.setState({visible:!0})}},{key:"render",value:function(){if(this.state.visible)return this.props.children;var e=this.props,n=e.className,r=e.delayMethod,i=e.delayTime,a=e.height,s=e.placeholder,l=e.scrollPosition,c=e.style,u=e.threshold,d=e.useIntersectionObserver,h=e.width;return this.isScrollTracked||d&&o()?t().createElement(v,{className:n,height:a,onVisible:this.onVisible,placeholder:s,scrollPosition:l,style:c,threshold:u,useIntersectionObserver:d,width:h}):t().createElement(B,{className:n,delayMethod:r,delayTime:i,height:a,onVisible:this.onVisible,placeholder:s,style:c,threshold:u,width:h})}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=function(e){if("object"!==F(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===F(i)?i:String(i)),r)}var i}(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);G.propTypes={afterLoad:r.PropTypes.func,beforeLoad:r.PropTypes.func,useIntersectionObserver:r.PropTypes.bool,visibleByDefault:r.PropTypes.bool},G.defaultProps={afterLoad:function(){return{}},beforeLoad:function(){return{}},useIntersectionObserver:!0,visibleByDefault:!1};const q=G;function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}var H=["afterLoad","beforeLoad","delayMethod","delayTime","effect","placeholder","placeholderSrc","scrollPosition","threshold","useIntersectionObserver","visibleByDefault","wrapperClassName","wrapperProps"];function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach(function(t){X(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function X(e,t,n){return(t=Q(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Y.apply(this,arguments)}function Q(e){var t=function(e){if("object"!==W(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===W(t)?t:String(t)}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(s,e);var n,r,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=J(i);if(a){var n=J(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).state={loaded:!1},t}return n=s,(r=[{key:"onImageLoad",value:function(){var e=this;return this.state.loaded?null:function(t){e.props.onLoad(t),e.props.afterLoad(),e.setState({loaded:!0})}}},{key:"getImg",value:function(){var e=this.props,n=(e.afterLoad,e.beforeLoad,e.delayMethod,e.delayTime,e.effect,e.placeholder,e.placeholderSrc,e.scrollPosition,e.threshold,e.useIntersectionObserver,e.visibleByDefault,e.wrapperClassName,e.wrapperProps,function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,H));return t().createElement("img",Y({},n,{onLoad:this.onImageLoad()}))}},{key:"getLazyLoadImage",value:function(){var e=this.props,n=e.beforeLoad,r=e.className,i=e.delayMethod,a=e.delayTime,o=e.height,s=e.placeholder,l=e.scrollPosition,c=e.style,u=e.threshold,d=e.useIntersectionObserver,h=e.visibleByDefault,p=e.width;return t().createElement(q,{beforeLoad:n,className:r,delayMethod:i,delayTime:a,height:o,placeholder:s,scrollPosition:l,style:c,threshold:u,useIntersectionObserver:d,visibleByDefault:h,width:p},this.getImg())}},{key:"getWrappedLazyLoadImage",value:function(e){var n=this.props,r=n.effect,i=n.height,a=n.placeholderSrc,o=n.width,s=n.wrapperClassName,l=n.wrapperProps,c=this.state.loaded,u=c?" lazy-load-image-loaded":"",d=c||!a?{}:{backgroundImage:"url(".concat(a,")"),backgroundSize:"100% 100%"};return t().createElement("span",Y({className:s+" lazy-load-image-background "+r+u,style:K(K({},d),{},{color:"transparent",display:"inline-block",height:i,width:o})},l),e)}},{key:"render",value:function(){var e=this.props,t=e.effect,n=e.placeholderSrc,r=e.visibleByDefault,i=e.wrapperClassName,a=e.wrapperProps,o=this.getLazyLoadImage();return(t||n)&&!r||i||a?this.getWrappedLazyLoadImage(o):o}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Q(r.key),r)}}(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);ee.propTypes={onLoad:r.PropTypes.func,afterLoad:r.PropTypes.func,beforeLoad:r.PropTypes.func,delayMethod:r.PropTypes.string,delayTime:r.PropTypes.number,effect:r.PropTypes.string,placeholderSrc:r.PropTypes.string,threshold:r.PropTypes.number,useIntersectionObserver:r.PropTypes.bool,visibleByDefault:r.PropTypes.bool,wrapperClassName:r.PropTypes.string,wrapperProps:r.PropTypes.object},ee.defaultProps={onLoad:function(){},afterLoad:function(){return{}},beforeLoad:function(){return{}},delayMethod:"throttle",delayTime:300,effect:"",placeholderSrc:null,threshold:100,useIntersectionObserver:!0,visibleByDefault:!1,wrapperClassName:""};const te=ee})(),e.exports=a})()},9645:function(e,t,n){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=n(6392),i=n(8346),a=n(1203);t.last=function(e){if(a.isArrayLike(e))return r.last(i.toArray(e))}},9673:function(e,t,n){"use strict";n.d(t,{P:function(){return a},Y:function(){return i}});var r=n(9427);function i(e){return!(""!==e.pointerType||!e.isTrusted)||((0,r.m0)()&&e.pointerType?"click"===e.type&&1===e.buttons:0===e.detail&&!e.pointerType)}function a(e){return!(0,r.m0)()&&0===e.width&&0===e.height||1===e.width&&1===e.height&&0===e.pressure&&0===e.detail&&"mouse"===e.pointerType}},9674:function(e,t,n){"use strict";n.d(t,{t:function(){return r}});const r=(0,n(5043).createContext)(null)},9709:function(e,t){"use strict";function n(e){return"symbol"===typeof e?1:null===e?2:void 0===e?3:e!==e?4:0}Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});t.compareValues=(e,t,r)=>{if(e!==t){const i=n(e),a=n(t);if(i===a&&0===i){if(e<t)return"desc"===r?1:-1;if(e>t)return"desc"===r?-1:1}return"desc"===r?a-i:i-a}return 0}},9715:function(e,t,n){"use strict";n.d(t,{W:function(){return D}});var r=n(9615),i=n(5859);function a(e,t,n){const r=e.getProps();return(0,i.a)(r,t,void 0!==n?n:r.custom,e)}var o=n(8878),s=n(8412),l=n(462),c=n(7189);const u=e=>Array.isArray(e);function d(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,(0,c.OQ)(n))}function h(e){return u(e)?e[e.length-1]||0:e}var p=n(6268),f=n(6485),m=n(6031);function g({protectedKeys:e,needsAnimating:t},n){const r=e.hasOwnProperty(n)&&!0!==t[n];return t[n]=!1,r}function v(e,t,{delay:n=0,transitionOverride:r,type:i}={}){let{transition:c=e.getDefaultTransition(),transitionEnd:u,...v}=t;r&&(c=r);const A=[],y=i&&e.animationState&&e.animationState.getState()[i];for(const a in v){const t=e.getValue(a,e.latestValues[a]??null),r=v[a];if(void 0===r||y&&g(y,a))continue;const i={delay:n,...(0,o.r)(c||{},a)},u=t.get();if(void 0!==u&&!t.isAnimating&&!Array.isArray(r)&&r===u&&!i.velocity)continue;let d=!1;if(window.MotionHandoffAnimation){const t=(0,f.P)(e);if(t){const e=window.MotionHandoffAnimation(t,a,s.Gt);null!==e&&(i.startTime=e,d=!0)}}(0,p.g)(e,a),t.start((0,m.f)(a,t,r,e.shouldReduceMotion&&l.$.has(a)?{type:!1}:i,e,d));const h=t.animation;h&&A.push(h)}return u&&Promise.all(A).then(()=>{s.Gt.update(()=>{u&&function(e,t){const n=a(e,t);let{transitionEnd:r={},transition:i={},...o}=n||{};o={...o,...r};for(const a in o)d(e,a,h(o[a]))}(e,u)})}),A}function A(e,t,n,r=0,i=1){const a=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),o=e.size,s=(o-1)*r;return"function"===typeof n?n(a,o):1===i?a*r:s-a*r}function y(e,t,n={}){const r=a(e,t,"exit"===n.type?e.presenceContext?.custom:void 0);let{transition:i=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const o=r?()=>Promise.all(v(e,r,n)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(r=0)=>{const{delayChildren:a=0,staggerChildren:o,staggerDirection:s}=i;return function(e,t,n=0,r=0,i=0,a=1,o){const s=[];for(const l of e.variantChildren)l.notify("AnimationStart",t),s.push(y(l,t,{...o,delay:n+("function"===typeof r?0:r)+A(e.variantChildren,l,r,i,a)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(s)}(e,t,r,a,o,s,n)}:()=>Promise.resolve(),{when:l}=i;if(l){const[e,t]="beforeChildren"===l?[o,s]:[s,o];return e().then(()=>t())}return Promise.all([o(),s(n.delay)])}function b(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}var x=n(9742),_=n(3223);const w=_._.length;function S(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&S(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let n=0;n<w;n++){const r=_._[n],i=e.props[r];((0,x.w)(i)||!1===i)&&(t[r]=i)}return t}const T=[..._.U].reverse(),C=_.U.length;function M(e){return t=>Promise.all(t.map(({animation:t,options:n})=>function(e,t,n={}){let r;if(e.notify("AnimationStart",t),Array.isArray(t)){const i=t.map(t=>y(e,t,n));r=Promise.all(i)}else if("string"===typeof t)r=y(e,t,n);else{const i="function"===typeof t?a(e,t,n.custom):t;r=Promise.all(v(e,i,n))}return r.then(()=>{e.notify("AnimationComplete",t)})}(e,t,n)))}function E(e){let t=M(e),n=k(),i=!0;const o=t=>(n,r)=>{const i=a(e,r,"exit"===t?e.presenceContext?.custom:void 0);if(i){const{transition:e,transitionEnd:t,...r}=i;n={...n,...r,...t}}return n};function s(s){const{props:l}=e,c=S(e.parent)||{},d=[],h=new Set;let p={},f=1/0;for(let t=0;t<C;t++){const m=T[t],g=n[m],v=void 0!==l[m]?l[m]:c[m],y=(0,x.w)(v),_=m===s?g.isActive:null;!1===_&&(f=t);let w=v===c[m]&&v!==l[m]&&y;if(w&&i&&e.manuallyAnimateOnMount&&(w=!1),g.protectedKeys={...p},!g.isActive&&null===_||!v&&!g.prevProp||(0,r.N)(v)||"boolean"===typeof v)continue;const S=P(g.prevProp,v);let C=S||m===s&&g.isActive&&!w&&y||t>f&&y,M=!1;const E=Array.isArray(v)?v:[v];let N=E.reduce(o(m),{});!1===_&&(N={});const{prevResolvedValues:k={}}=g,R={...k,...N},L=t=>{C=!0,h.has(t)&&(M=!0,h.delete(t)),g.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in R){const t=N[e],n=k[e];if(p.hasOwnProperty(e))continue;let r=!1;r=u(t)&&u(n)?!b(t,n):t!==n,r?void 0!==t&&null!==t?L(e):h.add(e):void 0!==t&&h.has(e)?L(e):g.protectedKeys[e]=!0}g.prevProp=v,g.prevResolvedValues=N,g.isActive&&(p={...p,...N}),i&&e.blockInitialAnimation&&(C=!1);const O=w&&S;C&&(!O||M)&&d.push(...E.map(t=>{const n={type:m};if("string"===typeof t&&i&&!O&&e.manuallyAnimateOnMount&&e.parent){const{parent:r}=e,i=a(r,t);if(r.enteringChildren&&i){const{delayChildren:t}=i.transition||{};n.delay=A(r.enteringChildren,e,t)}}return{animation:t,options:n}}))}if(h.size){const t={};if("boolean"!==typeof l.initial){const n=a(e,Array.isArray(l.initial)?l.initial[0]:l.initial);n&&n.transition&&(t.transition=n.transition)}h.forEach(n=>{const r=e.getBaseTarget(n),i=e.getValue(n);i&&(i.liveStyle=!0),t[n]=r??null}),d.push({animation:t})}let m=Boolean(d.length);return!i||!1!==l.initial&&l.initial!==l.animate||e.manuallyAnimateOnMount||(m=!1),i=!1,m?t(d):Promise.resolve()}return{animateChanges:s,setActive:function(t,r){if(n[t].isActive===r)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,r)),n[t].isActive=r;const i=s(t);for(const e in n)n[e].protectedKeys={};return i},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=k()}}}function P(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!b(t,e)}function N(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function k(){return{animate:N(!0),whileInView:N(),whileHover:N(),whileTap:N(),whileDrag:N(),whileFocus:N(),exit:N()}}var R=n(3965);class L extends R.X{constructor(e){super(e),e.animationState||(e.animationState=E(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();(0,r.N)(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let O=0;class j extends R.X{constructor(){super(...arguments),this.id=O++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const D={animation:{Feature:L},exit:{Feature:j}}},9717:function(e,t,n){"use strict";var r=n(5043),i=n(9461);var a="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=i.useSyncExternalStore,s=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var d=s(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=c(function(){function e(e){if(!l){if(l=!0,o=e,e=r(e),void 0!==i&&h.hasValue){var t=h.value;if(i(t,e))return s=t}return s=e}if(t=s,a(o,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(o=e,t):(o=e,s=n)}var o,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]);var p=o(e,d[0],d[1]);return l(function(){h.hasValue=!0,h.value=p},[p]),u(p),p}},9742:function(e,t,n){"use strict";function r(e){return"string"===typeof e||Array.isArray(e)}n.d(t,{w:function(){return r}})},9755:function(e,t,n){"use strict";function r(e,t){-1===e.indexOf(t)&&e.push(t)}function i(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}n.d(t,{Ai:function(){return i},Kq:function(){return r}})},9859:function(e,t,n){e.exports=n(7231).range},9921:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObjectLike=function(e){return"object"===typeof e&&null!==e}},9954:function(e,t,n){"use strict";n.d(t,{B:function(){return s}});var r=n(6189),i=n(7449);const a={offset:"stroke-dashoffset",array:"stroke-dasharray"},o={offset:"strokeDashoffset",array:"strokeDasharray"};function s(e,{attrX:t,attrY:n,attrScale:s,pathLength:l,pathSpacing:c=1,pathOffset:u=0,...d},h,p,f){if((0,r.O)(e,d,p),h)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:g}=e;m.transform&&(g.transform=m.transform,delete m.transform),(g.transform||m.transformOrigin)&&(g.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),g.transform&&(g.transformBox=f?.transformBox??"fill-box",delete m.transformBox),void 0!==t&&(m.x=t),void 0!==n&&(m.y=n),void 0!==s&&(m.scale=s),void 0!==l&&function(e,t,n=1,r=0,s=!0){e.pathLength=1;const l=s?a:o;e[l.offset]=i.px.transform(-r);const c=i.px.transform(t),u=i.px.transform(n);e[l.array]=`${c} ${u}`}(m,l,c,u,!1)}},9972:function(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.eq=function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(function(e){o[e]=function(){return r[e]}});return o.default=function(){return r},n.d(a,o),a}}(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce(function(t,r){return n.f[r](e,t),t},[]))},n.u=function(e){return"static/js/"+e+".0687bcf5.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="film-manager-client:";n.l=function(r,i,a,o){if(e[r])e[r].push(i);else{var s,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+a){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=r),e[r]=[i];var h=function(t,n){s.onerror=s.onload=null,clearTimeout(p);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach(function(e){return e(n)}),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="./",function(){var e={792:0};n.f.j=function(t,r){var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise(function(n,r){i=e[t]=[n,r]});r.push(i[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,function(r){if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,i[1](s)}},"chunk-"+t,t)}};var t=function(t,r){var i,a,o=r[0],s=r[1],l=r[2],c=0;if(o.some(function(t){return 0!==e[t]})){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)l(n)}for(t&&t(r);c<o.length;c++)a=o[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkfilm_manager_client=self.webpackChunkfilm_manager_client||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){"use strict";var e={};n.r(e),n.d(e,{scaleBand:function(){return TT},scaleDiverging:function(){return xN},scaleDivergingLog:function(){return _N},scaleDivergingPow:function(){return SN},scaleDivergingSqrt:function(){return TN},scaleDivergingSymlog:function(){return wN},scaleIdentity:function(){return mM},scaleImplicit:function(){return wT},scaleLinear:function(){return fM},scaleLog:function(){return SM},scaleOrdinal:function(){return ST},scalePoint:function(){return MT},scalePow:function(){return LM},scaleQuantile:function(){return WM},scaleQuantize:function(){return HM},scaleRadial:function(){return DM},scaleSequential:function(){return fN},scaleSequentialLog:function(){return mN},scaleSequentialPow:function(){return vN},scaleSequentialQuantile:function(){return yN},scaleSequentialSqrt:function(){return AN},scaleSequentialSymlog:function(){return gN},scaleSqrt:function(){return OM},scaleSymlog:function(){return EM},scaleThreshold:function(){return $M},scaleTime:function(){return uN},scaleUtc:function(){return dN},tickFormat:function(){return hM}});var t={};n.r(t),n.d(t,{computeMikkTSpaceTangents:function(){return Ite},computeMorphedAttributes:function(){return $te},deepCloneAttribute:function(){return zte},deinterleaveAttribute:function(){return Vte},deinterleaveGeometry:function(){return Gte},estimateBytesUsed:function(){return qte},interleaveAttributes:function(){return Ute},mergeAttributes:function(){return Fte},mergeGeometries:function(){return Bte},mergeGroups:function(){return Kte},mergeVertices:function(){return Wte},toCreasedNormals:function(){return Xte},toTrianglesDrawMode:function(){return Hte}});var r=n(5043),i=n.t(r,2),a=n(4391),o="popstate";function s(e={}){return f(function(e,t){let{pathname:n="/",search:r="",hash:i=""}=p(e.location.hash.substring(1));return n.startsWith("/")||n.startsWith(".")||(n="/"+n),d("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){let n=e.document.querySelector("base"),r="";if(n&&n.getAttribute("href")){let t=e.location.href,n=t.indexOf("#");r=-1===n?t:t.slice(0,n)}return r+"#"+("string"===typeof t?t:h(t))},function(e,t){c("/"===e.pathname.charAt(0),`relative pathnames are not supported in hash history.push(${JSON.stringify(t)})`)},e)}function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(or){}}}function u(e,t){return{usr:e.state,key:e.key,idx:t}}function d(e,t,n=null,r){return{pathname:"string"===typeof e?e:e.pathname,search:"",hash:"",..."string"===typeof t?p(t):t,state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10)}}function h({pathname:e="/",search:t="",hash:n=""}){return t&&"?"!==t&&(e+="?"===t.charAt(0)?t:"?"+t),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}function p(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function f(e,t,n,r={}){let{window:i=document.defaultView,v5Compat:a=!1}=r,s=i.history,l="POP",c=null,h=p();function p(){return(s.state||{idx:null}).idx}function f(){l="POP";let e=p(),t=null==e?null:e-h;h=e,c&&c({action:l,location:v.location,delta:t})}function g(e){return m(e)}null==h&&(h=0,s.replaceState({...s.state,idx:h},""));let v={get action(){return l},get location(){return e(i,s)},listen(e){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(o,f),c=e,()=>{i.removeEventListener(o,f),c=null}},createHref(e){return t(i,e)},createURL:g,encodeLocation(e){let t=g(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l="PUSH";let r=d(v.location,e,t);n&&n(r,e),h=p()+1;let o=u(r,h),f=v.createHref(r);try{s.pushState(o,"",f)}catch(tJ){if(tJ instanceof DOMException&&"DataCloneError"===tJ.name)throw tJ;i.location.assign(f)}a&&c&&c({action:l,location:v.location,delta:1})},replace:function(e,t){l="REPLACE";let r=d(v.location,e,t);n&&n(r,e),h=p();let i=u(r,h),o=v.createHref(r);s.replaceState(i,"",o),a&&c&&c({action:l,location:v.location,delta:0})},go(e){return s.go(e)}};return v}function m(e,t=!1){let n="http://localhost";"undefined"!==typeof window&&(n="null"!==window.location.origin?window.location.origin:window.location.href),l(n,"No window.location.(origin|href) available to create URL");let r="string"===typeof e?e:h(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}new WeakMap;function g(e,t,n="/"){return v(e,t,n,!1)}function v(e,t,n,r){let i=R(("string"===typeof t?p(t):t).pathname||"/",n);if(null==i)return null;let a=A(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(a);let o=null;for(let s=0;null==o&&s<a.length;++s){let e=k(i);o=E(a[s],e,r)}return o}function A(e,t=[],n=[],r="",i=!1){let a=(e,a,o=i,s)=>{let c={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(r)&&o)return;l(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length)}let u=z([r,c.relativePath]),d=n.concat(c);e.children&&e.children.length>0&&(l(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),A(e.children,t,d,u,o)),(null!=e.path||e.index)&&t.push({path:u,score:M(u,e.index),routesMeta:d})};return e.forEach((e,t)=>{if(""!==e.path&&e.path?.includes("?"))for(let n of y(e.path))a(e,t,!0,n);else a(e,t)}),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return i?[a,""]:[a];let o=y(r.join("/")),s=[];return s.push(...o.map(e=>""===e?a:[a,e].join("/"))),i&&s.push(...o),s.map(t=>e.startsWith("/")&&""===t?"/":t)}var b=/^:[\w-]+$/,x=3,_=2,w=1,S=10,T=-2,C=e=>"*"===e;function M(e,t){let n=e.split("/"),r=n.length;return n.some(C)&&(r+=T),t&&(r+=_),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?x:""===t?w:S),r)}function E(e,t,n=!1){let{routesMeta:r}=e,i={},a="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],l=s===r.length-1,c="/"===a?t:t.slice(a.length)||"/",u=P({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=P({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:z([a,u.pathname]),pathnameBase:U(z([a,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(a=z([a,u.pathnameBase]))}return o}function P(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=N(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1),l=r.reduce((e,{paramName:t,isOptional:n},r)=>{if("*"===t){let e=s[r]||"";o=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const i=s[r];return e[t]=n&&!i?void 0:(i||"").replace(/%2F/g,"/"),e},{});return{params:l,pathname:a,pathnameBase:o,pattern:e}}function N(e,t=!1,n=!0){c("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),r]}function k(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(tJ){return c(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${tJ}).`),e}}function R(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}var L=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,O=e=>L.test(e);function j(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function D(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function I(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function B(e){let t=I(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function F(e,t,n,r=!1){let i;"string"===typeof e?i=p(e):(i={...e},l(!i.pathname||!i.pathname.includes("?"),D("?","pathname","search",i)),l(!i.pathname||!i.pathname.includes("#"),D("#","pathname","hash",i)),l(!i.search||!i.search.includes("#"),D("#","search","hash",i)));let a,o=""===e||""===i.pathname,s=o?"/":i.pathname;if(null==s)a=n;else{let e=t.length-1;if(!r&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}a=e>=0?t[e]:"/"}let u=function(e,t="/"){let n,{pathname:r,search:i="",hash:a=""}="string"===typeof e?p(e):e;if(r)if(O(r))n=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),c(!1,`Pathnames cannot have embedded double slashes - normalizing ${e} -> ${r}`)}n=r.startsWith("/")?j(r.substring(1),"/"):j(r,t)}else n=t;return{pathname:n,search:V(i),hash:G(a)}}(i,a),d=s&&"/"!==s&&s.endsWith("/"),h=(o||"."===s)&&n.endsWith("/");return u.pathname.endsWith("/")||!d&&!h||(u.pathname+="/"),u}var z=e=>e.join("/").replace(/\/\/+/g,"/"),U=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",G=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function q(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}Symbol("Uninstrumented");Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var W=["POST","PUT","PATCH","DELETE"],H=(new Set(W),["GET",...W]);new Set(H),Symbol("ResetLoaderData");var $=r.createContext(null);$.displayName="DataRouter";var K=r.createContext(null);K.displayName="DataRouterState";var X=r.createContext(!1);var Y=r.createContext({isTransitioning:!1});Y.displayName="ViewTransition";var Q=r.createContext(new Map);Q.displayName="Fetchers";var Z=r.createContext(null);Z.displayName="Await";var J=r.createContext(null);J.displayName="Navigation";var ee=r.createContext(null);ee.displayName="Location";var te=r.createContext({outlet:null,matches:[],isDataRoute:!1});te.displayName="Route";var ne=r.createContext(null);ne.displayName="RouteError";function re(){return null!=r.useContext(ee)}function ie(){return l(re(),"useLocation() may be used only in the context of a <Router> component."),r.useContext(ee).location}var ae="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function oe(e){r.useContext(J).static||r.useLayoutEffect(e)}function se(){let{isDataRoute:e}=r.useContext(te);return e?function(){let{router:e}=ve("useNavigate"),t=ye("useNavigate"),n=r.useRef(!1);oe(()=>{n.current=!0});let i=r.useCallback(async(r,i={})=>{c(n.current,ae),n.current&&("number"===typeof r?e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))},[e,t]);return i}():function(){l(re(),"useNavigate() may be used only in the context of a <Router> component.");let e=r.useContext($),{basename:t,navigator:n}=r.useContext(J),{matches:i}=r.useContext(te),{pathname:a}=ie(),o=JSON.stringify(B(i)),s=r.useRef(!1);oe(()=>{s.current=!0});let u=r.useCallback((r,i={})=>{if(c(s.current,ae),!s.current)return;if("number"===typeof r)return void n.go(r);let l=F(r,JSON.parse(o),a,"path"===i.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:z([t,l.pathname])),(i.replace?n.replace:n.push)(l,i.state,i)},[t,n,o,a,e]);return u}()}r.createContext(null);function le(){let{matches:e}=r.useContext(te),t=e[e.length-1];return t?t.params:{}}function ce(e,{relative:t}={}){let{matches:n}=r.useContext(te),{pathname:i}=ie(),a=JSON.stringify(B(n));return r.useMemo(()=>F(e,JSON.parse(a),i,"path"===t),[e,a,i,t])}function ue(e,t,n,i,a){l(re(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=r.useContext(J),{matches:s}=r.useContext(te),u=s[s.length-1],d=u?u.params:{},h=u?u.pathname:"/",f=u?u.pathnameBase:"/",m=u&&u.route;{let e=m&&m.path||"";_e(h,!m||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let v,A=ie();if(t){let e="string"===typeof t?p(t):t;l("/"===f||e.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${e.pathname}" was given in the \`location\` prop.`),v=e}else v=A;let y=v.pathname||"/",b=y;if("/"!==f){let e=f.replace(/^\//,"").split("/");b="/"+y.replace(/^\//,"").split("/").slice(e.length).join("/")}let x=g(e,{pathname:b});c(m||null!=x,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),c(null==x||void 0!==x[x.length-1].route.element||void 0!==x[x.length-1].route.Component||void 0!==x[x.length-1].route.lazy,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=me(x&&x.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:z([f,o.encodeLocation?o.encodeLocation(e.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?f:z([f,o.encodeLocation?o.encodeLocation(e.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathnameBase])})),s,n,i,a);return t&&_?r.createElement(ee.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},_):_}function de(){let e=be(),t=q(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},s=null;return console.error("Error handled by React Router default ErrorBoundary:",e),s=r.createElement(r.Fragment,null,r.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),r.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",r.createElement("code",{style:o},"ErrorBoundary")," or"," ",r.createElement("code",{style:o},"errorElement")," prop on your route.")),r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),n?r.createElement("pre",{style:a},n):null,s)}var he=r.createElement(de,null),pe=class extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){return void 0!==this.state.error?r.createElement(te.Provider,{value:this.props.routeContext},r.createElement(ne.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function fe({routeContext:e,match:t,children:n}){let i=r.useContext($);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),r.createElement(te.Provider,{value:e},n)}function me(e,t=[],n=null,i=null,a=null){if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let o=e,s=n?.errors;if(null!=s){let e=o.findIndex(e=>e.route.id&&void 0!==s?.[e.route.id]);l(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(n)for(let r=0;r<o.length;r++){let e=o[r];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=r),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}let d=n&&i?(e,t)=>{i(e,{location:n.location,params:n.matches?.[0]?.params??{},errorInfo:t})}:void 0;return o.reduceRight((e,i,a)=>{let l,h=!1,p=null,f=null;n&&(l=s&&i.route.id?s[i.route.id]:void 0,p=i.route.errorElement||he,c&&(u<0&&0===a?(_e("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,f=null):u===a&&(h=!0,f=i.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,a+1)),g=()=>{let t;return t=l?p:h?f:i.route.Component?r.createElement(i.route.Component,null):i.route.element?i.route.element:e,r.createElement(fe,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(i.route.ErrorBoundary||i.route.errorElement||0===a)?r.createElement(pe,{location:n.location,revalidation:n.revalidation,component:p,error:l,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0},onError:d}):g()},null)}function ge(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ve(e){let t=r.useContext($);return l(t,ge(e)),t}function Ae(e){let t=r.useContext(K);return l(t,ge(e)),t}function ye(e){let t=function(e){let t=r.useContext(te);return l(t,ge(e)),t}(e),n=t.matches[t.matches.length-1];return l(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function be(){let e=r.useContext(ne),t=Ae("useRouteError"),n=ye("useRouteError");return void 0!==e?e:t.errors?.[n]}var xe={};function _e(e,t,n){t||xe[e]||(xe[e]=!0,c(!1,n))}var we={};function Se(e,t){e||we[t]||(we[t]=!0,console.warn(t))}r.memo(function({routes:e,future:t,state:n,unstable_onError:r}){return ue(e,void 0,n,r,t)});function Te(e){l(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ce({basename:e="/",children:t=null,location:n,navigationType:i="POP",navigator:a,static:o=!1}){l(!re(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=e.replace(/^\/*/,"/"),u=r.useMemo(()=>({basename:s,navigator:a,static:o,future:{}}),[s,a,o]);"string"===typeof n&&(n=p(n));let{pathname:d="/",search:h="",hash:f="",state:m=null,key:g="default"}=n,v=r.useMemo(()=>{let e=R(d,s);return null==e?null:{location:{pathname:e,search:h,hash:f,state:m,key:g},navigationType:i}},[s,d,h,f,m,g,i]);return c(null!=v,`<Router basename="${s}"> is not able to match the URL "${d}${h}${f}" because it does not start with the basename, so the <Router> won't render anything.`),null==v?null:r.createElement(J.Provider,{value:u},r.createElement(ee.Provider,{children:t,value:v}))}function Me({children:e,location:t}){return ue(Ee(e),t)}r.Component;function Ee(e,t=[]){let n=[];return r.Children.forEach(e,(e,i)=>{if(!r.isValidElement(e))return;let a=[...t,i];if(e.type===r.Fragment)return void n.push.apply(n,Ee(e.props.children,a));l(e.type===Te,`[${"string"===typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),l(!e.props.index||!e.props.children,"An index route cannot have child routes.");let o={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=Ee(e.props.children,a)),n.push(o)}),n}var Pe="get",Ne="application/x-www-form-urlencoded";function ke(e){return null!=e&&"string"===typeof e.tagName}var Re=null;var Le=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Oe(e){return null==e||Le.has(e)?e:(c(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ne}"`),null)}function je(e,t){let n,r,i,a,o;if(function(e){return ke(e)&&"form"===e.tagName.toLowerCase()}(e)){let o=e.getAttribute("action");r=o?R(o,t):null,n=e.getAttribute("method")||Pe,i=Oe(e.getAttribute("enctype"))||Ne,a=new FormData(e)}else if(function(e){return ke(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return ke(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let o=e.form;if(null==o)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let s=e.getAttribute("formaction")||o.getAttribute("action");if(r=s?R(s,t):null,n=e.getAttribute("formmethod")||o.getAttribute("method")||Pe,i=Oe(e.getAttribute("formenctype"))||Oe(o.getAttribute("enctype"))||Ne,a=new FormData(o,e),!function(){if(null===Re)try{new FormData(document.createElement("form"),0),Re=!1}catch(or){Re=!0}return Re}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?`${t}.`:"";a.append(`${e}x`,"0"),a.append(`${e}y`,"0")}else t&&a.append(t,r)}}else{if(ke(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Pe,r=null,i=Ne,o=e}return a&&"text/plain"===i&&(o=a,a=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:a,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;function De(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}Symbol("SingleFetchRedirect");function Ie(e,t,n){let r="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===r.pathname?r.pathname=`_root.${n}`:t&&"/"===R(r.pathname,t)?r.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function Be(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(tJ){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(tJ),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Fe(e){return null!=e&&"string"===typeof e.page}function ze(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function Ue(e,t,n,r,i,a){let o=(e,t)=>!n[t]||e.route.id!==n[t].route.id,s=(e,t)=>n[t].pathname!==e.pathname||n[t].route.path?.endsWith("*")&&n[t].params["*"]!==e.params["*"];return"assets"===a?t.filter((e,t)=>o(e,t)||s(e,t)):"data"===a?t.filter((t,a)=>{let l=r.routes[t.route.id];if(!l||!l.hasLoader)return!1;if(o(t,a)||s(t,a))return!0;if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0}):[]}function Ve(e,t,{includeHydrateFallback:n}={}){return r=e.map(e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1),[...new Set(r)];var r}function Ge(e,t){let n=new Set,r=new Set(t);return e.reduce((e,i)=>{if(t&&!Fe(i)&&"script"===i.as&&i.href&&r.has(i.href))return e;let a=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(i));return n.has(a)||(n.add(a),e.push({key:a,link:i})),e},[])}function qe(e,t){return"lazy"===e.mode&&!0===t}function We(){let e=r.useContext($);return De(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function He(){let e=r.useContext(K);return De(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var $e=r.createContext(void 0);function Ke(){let e=r.useContext($e);return De(e,"You must render this element inside a <HydratedRouter> element"),e}function Xe(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function Ye(e,t,n){if(n&&!et)return[e[0]];if(t){let n=e.findIndex(e=>void 0!==t[e.route.id]);return e.slice(0,n+1)}return e}$e.displayName="FrameworkContext";function Qe({page:e,...t}){let{router:n}=We(),i=r.useMemo(()=>g(n.routes,e,n.basename),[n.routes,e,n.basename]);return i?r.createElement(Je,{page:e,matches:i,...t}):null}function Ze(e){let{manifest:t,routeModules:n}=Ke(),[i,a]=r.useState([]);return r.useEffect(()=>{let r=!1;return async function(e,t,n){let r=await Promise.all(e.map(async e=>{let r=t.routes[e.route.id];if(r){let e=await Be(r,n);return e.links?e.links():[]}return[]}));return Ge(r.flat(1).filter(ze).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"}))}(e,t,n).then(e=>{r||a(e)}),()=>{r=!0}},[e,t,n]),i}function Je({page:e,matches:t,...n}){let i=ie(),{manifest:a,routeModules:o}=Ke(),{basename:s}=We(),{loaderData:l,matches:c}=He(),u=r.useMemo(()=>Ue(e,t,c,a,i,"data"),[e,t,c,a,i]),d=r.useMemo(()=>Ue(e,t,c,a,i,"assets"),[e,t,c,a,i]),h=r.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let n=new Set,r=!1;if(t.forEach(e=>{let t=a.routes[e.route.id];t&&t.hasLoader&&(!u.some(t=>t.route.id===e.route.id)&&e.route.id in l&&o[e.route.id]?.shouldRevalidate||t.hasClientLoader?r=!0:n.add(e.route.id))}),0===n.size)return[];let c=Ie(e,s,"data");return r&&n.size>0&&c.searchParams.set("_routes",t.filter(e=>n.has(e.route.id)).map(e=>e.route.id).join(",")),[c.pathname+c.search]},[s,l,i,a,u,t,e,o]),p=r.useMemo(()=>Ve(d,a),[d,a]),f=Ze(d);return r.createElement(r.Fragment,null,h.map(e=>r.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...n})),p.map(e=>r.createElement("link",{key:e,rel:"modulepreload",href:e,...n})),f.map(({key:e,link:t})=>r.createElement("link",{key:e,nonce:n.nonce,...t})))}var et=!1;function tt(e){let{manifest:t,serverHandoffString:n,isSpaMode:i,renderMeta:a,routeDiscovery:o,ssr:s}=Ke(),{router:l,static:c,staticContext:u}=We(),{matches:d}=He(),h=r.useContext(X),p=qe(o,s);a&&(a.didRenderScripts=!0);let f=Ye(d,null,i);r.useEffect(()=>{0},[]);let m=r.useMemo(()=>{if(h)return null;let i=u?`window.__reactRouterContext = ${n};window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());`:" ",a=c?`${t.hmr?.runtime?`import ${JSON.stringify(t.hmr.runtime)};`:""}${p?"":`import ${JSON.stringify(t.url)}`};\n${f.map((e,n)=>{let r=`route${n}`,i=t.routes[e.route.id];De(i,`Route ${e.route.id} not found in manifest`);let{clientActionModule:a,clientLoaderModule:o,clientMiddlewareModule:s,hydrateFallbackModule:l,module:c}=i,u=[...a?[{module:a,varName:`${r}_clientAction`}]:[],...o?[{module:o,varName:`${r}_clientLoader`}]:[],...s?[{module:s,varName:`${r}_clientMiddleware`}]:[],...l?[{module:l,varName:`${r}_HydrateFallback`}]:[],{module:c,varName:`${r}_main`}];return 1===u.length?`import * as ${r} from ${JSON.stringify(c)};`:[u.map(e=>`import * as ${e.varName} from "${e.module}";`).join("\n"),`const ${r} = {${u.map(e=>`...${e.varName}`).join(",")}};`].join("\n")}).join("\n")}\n  ${p?`window.__reactRouterManifest = ${JSON.stringify(function({sri:e,...t},n){let r=new Set(n.state.matches.map(e=>e.route.id)),i=n.state.location.pathname.split("/").filter(Boolean),a=["/"];for(i.pop();i.length>0;)a.push(`/${i.join("/")}`),i.pop();a.forEach(e=>{let t=g(n.routes,e,n.basename);t&&t.forEach(e=>r.add(e.route.id))});let o=[...r].reduce((e,n)=>Object.assign(e,{[n]:t.routes[n]}),{});return{...t,routes:o,sri:!!e||void 0}}(t,l),null,2)};`:""}\n  window.__reactRouterRouteModules = {${f.map((e,t)=>`${JSON.stringify(e.route.id)}:route${t}`).join(",")}};\n\nimport(${JSON.stringify(t.entry.module)});`:" ";return r.createElement(r.Fragment,null,r.createElement("script",{...e,suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:i},type:void 0}),r.createElement("script",{...e,suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:a},type:"module",async:!0}))},[]),v=et||h?[]:function(e){return[...new Set(e)]}(t.entry.imports.concat(Ve(f,t,{includeHydrateFallback:!0}))),A="object"===typeof t.sri?t.sri:{};return Se(!h,"The <Scripts /> element is a no-op when using RSC and can be safely removed."),et||h?null:r.createElement(r.Fragment,null,"object"===typeof t.sri?r.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:A})}}):null,p?null:r.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin,integrity:A[t.url],suppressHydrationWarning:!0}),r.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin,integrity:A[t.entry.module],suppressHydrationWarning:!0}),v.map(t=>r.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin,integrity:A[t],suppressHydrationWarning:!0})),m)}function nt(...e){return t=>{e.forEach(e=>{"function"===typeof e?e(t):null!=e&&(e.current=t)})}}r.Component;function rt({error:e,isOutsideRemixApp:t}){console.error(e);let n,i=r.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if(q(e))return r.createElement(it,{title:"Unhandled Thrown Response!"},r.createElement("h1",{style:{fontSize:"24px"}},e.status," ",e.statusText),i);if(e instanceof Error)0;else{let t=null==e?"Unknown Error":"object"===typeof e&&"toString"in e?e.toString():JSON.stringify(e);new Error(t)}return r.createElement(it,{title:"Application Error!",isOutsideRemixApp:t},r.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),r.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},n.stack),i)}function it({title:e,renderScripts:t,isOutsideRemixApp:n,children:i}){let{routeModules:a}=Ke();return a.root?.Layout&&!n?i:r.createElement("html",{lang:"en"},r.createElement("head",null,r.createElement("meta",{charSet:"utf-8"}),r.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),r.createElement("title",null,e)),r.createElement("body",null,r.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},i,t?r.createElement(tt,null):null)))}var at="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{at&&(window.__reactRouterVersion="7.9.6")}catch(or){}function ot({basename:e,children:t,window:n}){let i=r.useRef();null==i.current&&(i.current=s({window:n,v5Compat:!0}));let a=i.current,[o,l]=r.useState({action:a.action,location:a.location}),c=r.useCallback(e=>{r.startTransition(()=>l(e))},[l]);return r.useLayoutEffect(()=>a.listen(c),[a,c]),r.createElement(Ce,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a})}var st=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lt=r.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:a,replace:o,state:s,target:u,to:d,preventScrollReset:p,viewTransition:f,...m},g){let v,{basename:A}=r.useContext(J),y="string"===typeof d&&st.test(d),b=!1;if("string"===typeof d&&y&&(v=d,at))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),n=R(t.pathname,A);t.origin===e.origin&&null!=n?d=n+t.search+t.hash:b=!0}catch(or){c(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let x=function(e,{relative:t}={}){l(re(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=r.useContext(J),{hash:a,pathname:o,search:s}=ce(e,{relative:t}),c=o;return"/"!==n&&(c="/"===o?n:z([n,o])),i.createHref({pathname:c,search:s,hash:a})}(d,{relative:i}),[_,w,S]=function(e,t){let n=r.useContext($e),[i,a]=r.useState(!1),[o,s]=r.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:d,onTouchStart:h}=t,p=r.useRef(null);r.useEffect(()=>{if("render"===e&&s(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{s(e.isIntersecting)})},{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}},[e]),r.useEffect(()=>{if(i){let e=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(e)}}},[i]);let f=()=>{a(!0)},m=()=>{a(!1),s(!1)};return n?"intent"!==e?[o,p,{}]:[o,p,{onFocus:Xe(l,f),onBlur:Xe(c,m),onMouseEnter:Xe(u,f),onMouseLeave:Xe(d,m),onTouchStart:Xe(h,f)}]:[!1,p,{}]}(n,m),T=function(e,{target:t,replace:n,state:i,preventScrollReset:a,relative:o,viewTransition:s}={}){let l=se(),c=ie(),u=ce(e,{relative:o});return r.useCallback(r=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(r,t)){r.preventDefault();let t=void 0!==n?n:h(c)===h(u);l(e,{replace:t,state:i,preventScrollReset:a,relative:o,viewTransition:s})}},[c,l,u,n,i,t,e,a,o,s])}(d,{replace:o,state:s,target:u,preventScrollReset:p,relative:i,viewTransition:f});let C=r.createElement("a",{...m,...S,href:v||x,onClick:b||a?e:function(t){e&&e(t),t.defaultPrevented||T(t)},ref:nt(g,w),target:u,"data-discover":y||"render"!==t?void 0:"true"});return _&&!y?r.createElement(r.Fragment,null,C,r.createElement(Qe,{page:x})):C});lt.displayName="Link";var ct=r.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:a,to:o,viewTransition:s,children:c,...u},d){let h=ce(o,{relative:u.relative}),p=ie(),f=r.useContext(K),{navigator:m,basename:g}=r.useContext(J),v=null!=f&&function(e,{relative:t}={}){let n=r.useContext(Y);l(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=ht("useViewTransitionState"),a=ce(e,{relative:t});if(!n.isTransitioning)return!1;let o=R(n.currentLocation.pathname,i)||n.currentLocation.pathname,s=R(n.nextLocation.pathname,i)||n.nextLocation.pathname;return null!=P(a.pathname,s)||null!=P(a.pathname,o)}(h)&&!0===s,A=m.encodeLocation?m.encodeLocation(h).pathname:h.pathname,y=p.pathname,b=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;t||(y=y.toLowerCase(),b=b?b.toLowerCase():null,A=A.toLowerCase()),b&&g&&(b=R(b,g)||b);const x="/"!==A&&A.endsWith("/")?A.length-1:A.length;let _,w=y===A||!i&&y.startsWith(A)&&"/"===y.charAt(x),S=null!=b&&(b===A||!i&&b.startsWith(A)&&"/"===b.charAt(A.length)),T={isActive:w,isPending:S,isTransitioning:v},C=w?e:void 0;_="function"===typeof n?n(T):[n,w?"active":null,S?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let M="function"===typeof a?a(T):a;return r.createElement(lt,{...u,"aria-current":C,className:_,ref:d,style:M,to:o,viewTransition:s},"function"===typeof c?c(T):c)});ct.displayName="NavLink";var ut=r.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:i,replace:a,state:o,method:s=Pe,action:c,onSubmit:u,relative:d,preventScrollReset:p,viewTransition:f,...m},g)=>{let v=mt(),A=function(e,{relative:t}={}){let{basename:n}=r.useContext(J),i=r.useContext(te);l(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),o={...ce(e||".",{relative:t})},s=ie();if(null==e){o.search=s.search;let e=new URLSearchParams(o.search),t=e.getAll("index"),n=t.some(e=>""===e);if(n){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let n=e.toString();o.search=n?`?${n}`:""}}e&&"."!==e||!a.route.index||(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(o.pathname="/"===o.pathname?n:z([n,o.pathname]));return h(o)}(c,{relative:d}),y="get"===s.toLowerCase()?"get":"post",b="string"===typeof c&&st.test(c);return r.createElement("form",{ref:g,method:y,action:A,onSubmit:i?u:e=>{if(u&&u(e),e.defaultPrevented)return;e.preventDefault();let r=e.nativeEvent.submitter,i=r?.getAttribute("formmethod")||s;v(r||e.currentTarget,{fetcherKey:t,method:i,navigate:n,replace:a,state:o,relative:d,preventScrollReset:p,viewTransition:f})},...m,"data-discover":b||"render"!==e?void 0:"true"})});function dt(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ht(e){let t=r.useContext($);return l(t,dt(e)),t}ut.displayName="Form";var pt=0,ft=()=>`__${String(++pt)}__`;function mt(){let{router:e}=ht("useSubmit"),{basename:t}=r.useContext(J),n=ye("useRouteId");return r.useCallback(async(r,i={})=>{let{action:a,method:o,encType:s,formData:l,body:c}=je(r,t);if(!1===i.navigate){let t=i.fetcherKey||ft();await e.fetch(t,n,i.action||a,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||o,formEncType:i.encType||s,flushSync:i.flushSync})}else await e.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||o,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,t,n])}var gt=n(579),vt=r.createContext(void 0),At=e=>{const t=r.useContext(vt);if(e)return e;if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},yt=({client:e,children:t})=>(r.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),(0,gt.jsx)(vt.Provider,{value:e,children:t})),bt={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},xt=new class{#e=bt;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}};var _t="undefined"===typeof window||"Deno"in globalThis;function wt(){}function St(e){return"number"===typeof e&&e>=0&&e!==1/0}function Tt(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Ct(e,t){return"function"===typeof e?e(t):e}function Mt(e,t){return"function"===typeof e?e(t):e}function Et(e,t){const{type:n="all",exact:r,fetchStatus:i,predicate:a,queryKey:o,stale:s}=e;if(o)if(r){if(t.queryHash!==Nt(o,t.options))return!1}else if(!Rt(t.queryKey,o))return!1;if("all"!==n){const e=t.isActive();if("active"===n&&!e)return!1;if("inactive"===n&&e)return!1}return("boolean"!==typeof s||t.isStale()===s)&&((!i||i===t.state.fetchStatus)&&!(a&&!a(t)))}function Pt(e,t){const{exact:n,status:r,predicate:i,mutationKey:a}=e;if(a){if(!t.options.mutationKey)return!1;if(n){if(kt(t.options.mutationKey)!==kt(a))return!1}else if(!Rt(t.options.mutationKey,a))return!1}return(!r||t.state.status===r)&&!(i&&!i(t))}function Nt(e,t){return(t?.queryKeyHashFn||kt)(e)}function kt(e){return JSON.stringify(e,(e,t)=>It(t)?Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{}):t)}function Rt(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&Object.keys(t).every(n=>Rt(e[n],t[n])))}var Lt=Object.prototype.hasOwnProperty;function Ot(e,t){if(e===t)return e;const n=Dt(e)&&Dt(t);if(!n&&(!It(e)||!It(t)))return t;const r=(n?e:Object.keys(e)).length,i=n?t:Object.keys(t),a=i.length,o=n?new Array(a):{};let s=0;for(let l=0;l<a;l++){const a=n?l:i[l],c=e[a],u=t[a];if(c===u){o[a]=c,(n?l<r:Lt.call(e,a))&&s++;continue}if(null===c||null===u||"object"!==typeof c||"object"!==typeof u){o[a]=u;continue}const d=Ot(c,u);o[a]=d,d===c&&s++}return r===a&&s===r?e:o}function jt(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function Dt(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function It(e){if(!Bt(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!!Bt(n)&&(!!n.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function Bt(e){return"[object Object]"===Object.prototype.toString.call(e)}function Ft(e,t,n){return"function"===typeof n.structuralSharing?n.structuralSharing(e,t):!1!==n.structuralSharing?Ot(e,t):t}function zt(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function Ut(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var Vt=Symbol();function Gt(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:e.queryFn&&e.queryFn!==Vt?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}function qt(e,t){return"function"===typeof e?e(...t):!!e}var Wt=function(e){setTimeout(e,0)};var Ht=function(){let e=[],t=0,n=e=>{e()},r=e=>{e()},i=Wt;const a=r=>{t?e.push(r):i(()=>{n(r)})};return{batch:a=>{let o;t++;try{o=a()}finally{t--,t||(()=>{const t=e;e=[],t.length&&i(()=>{r(()=>{t.forEach(e=>{n(e)})})})})()}return o},batchCalls:e=>(...t)=>{a(()=>{e(...t)})},schedule:a,setNotifyFunction:e=>{n=e},setBatchNotifyFunction:e=>{r=e},setScheduler:e=>{i=e}}}(),$t=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Kt=new class extends $t{#n;#r;#i;constructor(){super(),this.#i=e=>{if(!_t&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#r||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#r?.(),this.#r=void 0)}setEventListener(e){this.#i=e,this.#r?.(),this.#r=e(e=>{"boolean"===typeof e?this.setFocused(e):this.onFocus()})}setFocused(e){this.#n!==e&&(this.#n=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return"boolean"===typeof this.#n?this.#n:"hidden"!==globalThis.document?.visibilityState}},Xt=new class extends $t{#a=!0;#r;#i;constructor(){super(),this.#i=e=>{if(!_t&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#r||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#r?.(),this.#r=void 0)}setEventListener(e){this.#i=e,this.#r?.(),this.#r=e(this.setOnline.bind(this))}setOnline(e){this.#a!==e&&(this.#a=e,this.listeners.forEach(t=>{t(e)}))}isOnline(){return this.#a}};function Yt(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});function r(e){Object.assign(n,e),delete n.resolve,delete n.reject}return n.status="pending",n.catch(()=>{}),n.resolve=t=>{r({status:"fulfilled",value:t}),e(t)},n.reject=e=>{r({status:"rejected",reason:e}),t(e)},n}function Qt(e){return Math.min(1e3*2**e,3e4)}function Zt(e){return"online"!==(e??"online")||Xt.isOnline()}var Jt=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function en(e){let t,n=!1,r=0;const i=Yt(),a=()=>"pending"!==i.status,o=()=>Kt.isFocused()&&("always"===e.networkMode||Xt.isOnline())&&e.canRun(),s=()=>Zt(e.networkMode)&&e.canRun(),l=e=>{a()||(t?.(),i.resolve(e))},c=e=>{a()||(t?.(),i.reject(e))},u=()=>new Promise(n=>{t=e=>{(a()||o())&&n(e)},e.onPause?.()}).then(()=>{t=void 0,a()||e.onContinue?.()}),d=()=>{if(a())return;let t;const i=0===r?e.initialPromise:void 0;try{t=i??e.fn()}catch(tJ){t=Promise.reject(tJ)}Promise.resolve(t).then(l).catch(t=>{if(a())return;const i=e.retry??(_t?0:3),s=e.retryDelay??Qt,l="function"===typeof s?s(r,t):s,h=!0===i||"number"===typeof i&&r<i||"function"===typeof i&&i(r,t);var p;!n&&h?(r++,e.onFail?.(r,t),(p=l,new Promise(e=>{xt.setTimeout(e,p)})).then(()=>o()?void 0:u()).then(()=>{n?c(t):d()})):c(t)})};return{promise:i,status:()=>i.status,cancel:t=>{if(!a()){const n=new Jt(t);c(n),e.onCancel?.(n)}},continue:()=>(t?.(),i),cancelRetry:()=>{n=!0},continueRetry:()=>{n=!1},canStart:s,start:()=>(s()?d():u().then(d),i)}}var tn=class{#o;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),St(this.gcTime)&&(this.#o=xt.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(_t?1/0:3e5))}clearGcTimeout(){this.#o&&(xt.clearTimeout(this.#o),this.#o=void 0)}},nn=class extends tn{#s;#l;#c;#u;#d;#h;#p;constructor(e){super(),this.#p=!1,this.#h=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#u=e.client,this.#c=this.#u.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#s=on(this.options),this.state=e.state??this.#s,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#d?.promise}setOptions(e){if(this.options={...this.#h,...e},this.updateGcTime(this.options.gcTime),this.state&&void 0===this.state.data){const e=on(this.options);void 0!==e.data&&(this.setState(an(e.data,e.dataUpdatedAt)),this.#s=e)}}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.#c.remove(this)}setData(e,t){const n=Ft(this.state.data,e,this.options);return this.#f({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#f({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#d?.promise;return this.#d?.cancel(e),t?t.then(wt).catch(wt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#s)}isActive(){return this.observers.some(e=>!1!==Mt(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Vt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===Ct(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!Tt(this.state.dataUpdatedAt,e))}onFocus(){const e=this.observers.find(e=>e.shouldFetchOnWindowFocus());e?.refetch({cancelRefetch:!1}),this.#d?.continue()}onOnline(){const e=this.observers.find(e=>e.shouldFetchOnReconnect());e?.refetch({cancelRefetch:!1}),this.#d?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#c.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#d&&(this.#p?this.#d.cancel({revert:!0}):this.#d.cancelRetry()),this.scheduleGc()),this.#c.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#f({type:"invalidate"})}async fetch(e,t){if("idle"!==this.state.fetchStatus&&"rejected"!==this.#d?.status())if(void 0!==this.state.data&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#d)return this.#d.continueRetry(),this.#d.promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const n=new AbortController,r=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(this.#p=!0,n.signal)})},i=()=>{const e=Gt(this.options,t),n=(()=>{const e={client:this.#u,queryKey:this.queryKey,meta:this.meta};return r(e),e})();return this.#p=!1,this.options.persister?this.options.persister(e,n,this):e(n)},a=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#u,state:this.state,fetchFn:i};return r(e),e})();this.options.behavior?.onFetch(a,this),this.#l=this.state,"idle"!==this.state.fetchStatus&&this.state.fetchMeta===a.fetchOptions?.meta||this.#f({type:"fetch",meta:a.fetchOptions?.meta}),this.#d=en({initialPromise:t?.initialPromise,fn:a.fetchFn,onCancel:e=>{e instanceof Jt&&e.revert&&this.setState({...this.#l,fetchStatus:"idle"}),n.abort()},onFail:(e,t)=>{this.#f({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#f({type:"pause"})},onContinue:()=>{this.#f({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{const e=await this.#d.start();if(void 0===e)throw new Error(`${this.queryHash} data is undefined`);return this.setData(e),this.#c.config.onSuccess?.(e,this),this.#c.config.onSettled?.(e,this.state.error,this),e}catch(tJ){if(tJ instanceof Jt){if(tJ.silent)return this.#d.promise;if(tJ.revert){if(void 0===this.state.data)throw tJ;return this.state.data}}throw this.#f({type:"error",error:tJ}),this.#c.config.onError?.(tJ,this),this.#c.config.onSettled?.(this.state.data,tJ,this),tJ}finally{this.scheduleGc()}}#f(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...rn(t.data,this.options),fetchMeta:e.meta??null};case"success":const n={...t,...an(e.data,e.dataUpdatedAt),dataUpdateCount:t.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#l=e.manual?n:void 0,n;case"error":const r=e.error;return{...t,error:r,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}})(this.state),Ht.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),this.#c.notify({query:this,type:"updated",action:e})})}};function rn(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Zt(t.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}function an(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function on(e){const t="function"===typeof e.initialData?e.initialData():e.initialData,n=void 0!==t,r=n?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var sn=class extends $t{constructor(e={}){super(),this.config=e,this.#m=new Map}#m;build(e,t,n){const r=t.queryKey,i=t.queryHash??Nt(r,t);let a=this.get(i);return a||(a=new nn({client:e,queryKey:r,queryHash:i,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r)}),this.add(a)),a}add(e){this.#m.has(e.queryHash)||(this.#m.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#m.get(e.queryHash);t&&(e.destroy(),t===e&&this.#m.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ht.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#m.get(e)}getAll(){return[...this.#m.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>Et(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>Et(e,t)):t}notify(e){Ht.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ht.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ht.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ln=class extends tn{#u;#g;#v;#d;constructor(e){super(),this.#u=e.client,this.mutationId=e.mutationId,this.#v=e.mutationCache,this.#g=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#g.includes(e)||(this.#g.push(e),this.clearGcTimeout(),this.#v.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#g=this.#g.filter(t=>t!==e),this.scheduleGc(),this.#v.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#g.length||("pending"===this.state.status?this.scheduleGc():this.#v.remove(this))}continue(){return this.#d?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#f({type:"continue"})},n={client:this.#u,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#d=en({fn:()=>this.options.mutationFn?this.options.mutationFn(e,n):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{this.#f({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#f({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#v.canRun(this)});const r="pending"===this.state.status,i=!this.#d.canStart();try{if(r)t();else{this.#f({type:"pending",variables:e,isPaused:i}),await(this.#v.config.onMutate?.(e,this,n));const t=await(this.options.onMutate?.(e,n));t!==this.state.context&&this.#f({type:"pending",context:t,variables:e,isPaused:i})}const a=await this.#d.start();return await(this.#v.config.onSuccess?.(a,e,this.state.context,this,n)),await(this.options.onSuccess?.(a,e,this.state.context,n)),await(this.#v.config.onSettled?.(a,null,this.state.variables,this.state.context,this,n)),await(this.options.onSettled?.(a,null,e,this.state.context,n)),this.#f({type:"success",data:a}),a}catch(tJ){try{throw await(this.#v.config.onError?.(tJ,e,this.state.context,this,n)),await(this.options.onError?.(tJ,e,this.state.context,n)),await(this.#v.config.onSettled?.(void 0,tJ,this.state.variables,this.state.context,this,n)),await(this.options.onSettled?.(void 0,tJ,e,this.state.context,n)),tJ}finally{this.#f({type:"error",error:tJ})}}finally{this.#v.runNext(this)}}#f(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),Ht.batch(()=>{this.#g.forEach(t=>{t.onMutationUpdate(e)}),this.#v.notify({mutation:this,type:"updated",action:e})})}};var cn=class extends $t{constructor(e={}){super(),this.config=e,this.#A=new Set,this.#y=new Map,this.#b=0}#A;#y;#b;build(e,t,n){const r=new ln({client:e,mutationCache:this,mutationId:++this.#b,options:e.defaultMutationOptions(t),state:n});return this.add(r),r}add(e){this.#A.add(e);const t=un(e);if("string"===typeof t){const n=this.#y.get(t);n?n.push(e):this.#y.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#A.delete(e)){const t=un(e);if("string"===typeof t){const n=this.#y.get(t);if(n)if(n.length>1){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}else n[0]===e&&this.#y.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=un(e);if("string"===typeof t){const n=this.#y.get(t),r=n?.find(e=>"pending"===e.state.status);return!r||r===e}return!0}runNext(e){const t=un(e);if("string"===typeof t){const n=this.#y.get(t)?.find(t=>t!==e&&t.state.isPaused);return n?.continue()??Promise.resolve()}return Promise.resolve()}clear(){Ht.batch(()=>{this.#A.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#A.clear(),this.#y.clear()})}getAll(){return Array.from(this.#A)}find(e){const t={exact:!0,...e};return this.getAll().find(e=>Pt(t,e))}findAll(e={}){return this.getAll().filter(t=>Pt(e,t))}notify(e){Ht.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return Ht.batch(()=>Promise.all(e.map(e=>e.continue().catch(wt))))}};function un(e){return e.options.scope?.id}function dn(e){return{onFetch:(t,n)=>{const r=t.options,i=t.fetchOptions?.meta?.fetchMore?.direction,a=t.state.data?.pages||[],o=t.state.data?.pageParams||[];let s={pages:[],pageParams:[]},l=0;const c=async()=>{let n=!1;const c=Gt(t.options,t.fetchOptions),u=async(e,r,i)=>{if(n)return Promise.reject();if(null==r&&e.pages.length)return Promise.resolve(e);const a=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:r,direction:i?"backward":"forward",meta:t.options.meta};return(e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(t.signal.aborted?n=!0:t.signal.addEventListener("abort",()=>{n=!0}),t.signal)})})(e),e})(),o=await c(a),{maxPages:s}=t.options,l=i?Ut:zt;return{pages:l(e.pages,o,s),pageParams:l(e.pageParams,r,s)}};if(i&&a.length){const e="backward"===i,t={pages:a,pageParams:o},n=(e?pn:hn)(r,t);s=await u(t,n,e)}else{const t=e??a.length;do{const e=0===l?o[0]??r.initialPageParam:hn(r,s);if(l>0&&null==e)break;s=await u(s,e),l++}while(l<t)}return s};t.options.persister?t.fetchFn=()=>t.options.persister?.(c,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=c}}}function hn(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function pn(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}const fn="undefined"!==typeof window&&!!window.__electron,mn={STATIC:{staleTime:1/0,gcTime:864e5},SEMI_STATIC:{staleTime:18e5,gcTime:36e5},DYNAMIC:{staleTime:3e5,gcTime:9e5},REALTIME:{staleTime:3e4,gcTime:12e4}},gn={equipment:mn.STATIC,cameras:mn.STATIC,lenses:mn.STATIC,films:mn.STATIC,luts:mn.STATIC,locations:mn.SEMI_STATIC,tags:mn.SEMI_STATIC,rolls:mn.DYNAMIC,photos:mn.DYNAMIC,stats:mn.DYNAMIC,favorites:mn.DYNAMIC,uploadProgress:mn.REALTIME,exportJobs:mn.REALTIME,conflicts:mn.REALTIME};function vn(e){return gn[e]||mn.DYNAMIC}const An=fn?{staleTime:9e5,gcTime:36e5}:{staleTime:3e5,gcTime:18e5},yn=new class{#x;#v;#h;#_;#w;#S;#T;#C;constructor(e={}){this.#x=e.queryCache||new sn,this.#v=e.mutationCache||new cn,this.#h=e.defaultOptions||{},this.#_=new Map,this.#w=new Map,this.#S=0}mount(){this.#S++,1===this.#S&&(this.#T=Kt.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#x.onFocus())}),this.#C=Xt.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#x.onOnline())}))}unmount(){this.#S--,0===this.#S&&(this.#T?.(),this.#T=void 0,this.#C?.(),this.#C=void 0)}isFetching(e){return this.#x.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#v.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#x.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#x.build(this,t),r=n.state.data;return void 0===r?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Ct(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return this.#x.findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),i=this.#x.get(r.queryHash),a=i?.state.data,o=function(e,t){return"function"===typeof e?e(t):e}(t,a);if(void 0!==o)return this.#x.build(this,r).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return Ht.batch(()=>this.#x.findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#x.get(t.queryHash)?.state}removeQueries(e){const t=this.#x;Ht.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const n=this.#x;return Ht.batch(()=>(n.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=Ht.batch(()=>this.#x.findAll(e).map(e=>e.cancel(n)));return Promise.all(r).then(wt).catch(wt)}invalidateQueries(e,t={}){return Ht.batch(()=>(this.#x.findAll(e).forEach(e=>{e.invalidate()}),"none"===e?.refetchType?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=Ht.batch(()=>this.#x.findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,n);return n.throwOnError||(t=t.catch(wt)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(r).then(wt)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const n=this.#x.build(this,t);return n.isStaleByTime(Ct(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(wt).catch(wt)}fetchInfiniteQuery(e){return e.behavior=dn(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(wt).catch(wt)}ensureInfiniteQueryData(e){return e.behavior=dn(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Xt.isOnline()?this.#v.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#x}getMutationCache(){return this.#v}getDefaultOptions(){return this.#h}setDefaultOptions(e){this.#h=e}setQueryDefaults(e,t){this.#_.set(kt(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#_.values()],n={};return t.forEach(t=>{Rt(e,t.queryKey)&&Object.assign(n,t.defaultOptions)}),n}setMutationDefaults(e,t){this.#w.set(kt(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#w.values()],n={};return t.forEach(t=>{Rt(e,t.mutationKey)&&Object.assign(n,t.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#h.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Nt(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Vt&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#h.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#x.clear(),this.#v.clear()}}({defaultOptions:{queries:{staleTime:An.staleTime,gcTime:An.gcTime,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:2,retryDelay:e=>Math.min(1e3*2**e,3e4),structuralSharing:!0},mutations:{retry:1,onError:e=>console.error("[Mutation Error]",e)}}});var bn=n(8624);const xn=new class{constructor(){this.queue=[],this.isProcessing=!1,this.processDelay=300}add(e){var t;const n=this.queue.some(t=>JSON.stringify(t.queryKey)===JSON.stringify(e.queryKey));if(n)return;const r=yn.getQueryData(e.queryKey),i=yn.getQueryState(e.queryKey);r&&i&&!i.isStale||(this.queue.push({...e,priority:null!==(t=e.priority)&&void 0!==t?t:5}),this.queue.sort((e,t)=>e.priority-t.priority),this.isProcessing||this.process())}async process(){if(0===this.queue.length)return void(this.isProcessing=!1);this.isProcessing=!0;const e=this.queue.shift();try{var t,n;await yn.prefetchQuery({queryKey:e.queryKey,queryFn:e.queryFn,staleTime:null!==(t=null===(n=e.options)||void 0===n?void 0:n.staleTime)&&void 0!==t?t:mn.DYNAMIC.staleTime,...e.options})}catch(r){console.warn("[Prefetch] Failed:",e.queryKey,r.message)}setTimeout(()=>this.process(),this.processDelay)}clear(){this.queue=[]}getStatus(){return{queueLength:this.queue.length,isProcessing:this.isProcessing,pendingKeys:this.queue.map(e=>e.queryKey.join("/"))}}};var _n=class extends $t{constructor(e,t){super(),this.options=t,this.#u=e,this.#M=null,this.#E=Yt(),this.bindMethods(),this.setOptions(t)}#u;#P=void 0;#N=void 0;#k=void 0;#R;#L;#E;#M;#O;#j;#D;#I;#B;#F;#z=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#P.addObserver(this),wn(this.#P,this.options)?this.#U():this.updateResult(),this.#V())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Sn(this.#P,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Sn(this.#P,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#G(),this.#q(),this.#P.removeObserver(this)}setOptions(e){const t=this.options,n=this.#P;if(this.options=this.#u.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!==typeof this.options.enabled&&"function"!==typeof this.options.enabled&&"boolean"!==typeof Mt(this.options.enabled,this.#P))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#W(),this.#P.setOptions(this.options),t._defaulted&&!jt(this.options,t)&&this.#u.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#P,observer:this});const r=this.hasListeners();r&&Tn(this.#P,n,this.options,t)&&this.#U(),this.updateResult(),!r||this.#P===n&&Mt(this.options.enabled,this.#P)===Mt(t.enabled,this.#P)&&Ct(this.options.staleTime,this.#P)===Ct(t.staleTime,this.#P)||this.#H();const i=this.#$();!r||this.#P===n&&Mt(this.options.enabled,this.#P)===Mt(t.enabled,this.#P)&&i===this.#F||this.#K(i)}getOptimisticResult(e){const t=this.#u.getQueryCache().build(this.#u,e),n=this.createResult(t,e);return function(e,t){if(!jt(e.getCurrentResult(),t))return!0;return!1}(this,n)&&(this.#k=n,this.#L=this.options,this.#R=this.#P.state),n}getCurrentResult(){return this.#k}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),t?.(n),"promise"===n&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#E.status||this.#E.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,n))})}trackProp(e){this.#z.add(e)}getCurrentQuery(){return this.#P}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#u.defaultQueryOptions(e),n=this.#u.getQueryCache().build(this.#u,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#U({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#k))}#U(e){this.#W();let t=this.#P.fetch(this.options,e);return e?.throwOnError||(t=t.catch(wt)),t}#H(){this.#G();const e=Ct(this.options.staleTime,this.#P);if(_t||this.#k.isStale||!St(e))return;const t=Tt(this.#k.dataUpdatedAt,e)+1;this.#I=xt.setTimeout(()=>{this.#k.isStale||this.updateResult()},t)}#$(){return("function"===typeof this.options.refetchInterval?this.options.refetchInterval(this.#P):this.options.refetchInterval)??!1}#K(e){this.#q(),this.#F=e,!_t&&!1!==Mt(this.options.enabled,this.#P)&&St(this.#F)&&0!==this.#F&&(this.#B=xt.setInterval(()=>{(this.options.refetchIntervalInBackground||Kt.isFocused())&&this.#U()},this.#F))}#V(){this.#H(),this.#K(this.#$())}#G(){this.#I&&(xt.clearTimeout(this.#I),this.#I=void 0)}#q(){this.#B&&(xt.clearInterval(this.#B),this.#B=void 0)}createResult(e,t){const n=this.#P,r=this.options,i=this.#k,a=this.#R,o=this.#L,s=e!==n?e.state:this.#N,{state:l}=e;let c,u={...l},d=!1;if(t._optimisticResults){const i=this.hasListeners(),a=!i&&wn(e,t),o=i&&Tn(e,n,t,r);(a||o)&&(u={...u,...rn(l.data,e.options)}),"isRestoring"===t._optimisticResults&&(u.fetchStatus="idle")}let{error:h,errorUpdatedAt:p,status:f}=u;c=u.data;let m=!1;if(void 0!==t.placeholderData&&void 0===c&&"pending"===f){let e;i?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(e=i.data,m=!0):e="function"===typeof t.placeholderData?t.placeholderData(this.#D?.state.data,this.#D):t.placeholderData,void 0!==e&&(f="success",c=Ft(i?.data,e,t),d=!0)}if(t.select&&void 0!==c&&!m)if(i&&c===a?.data&&t.select===this.#O)c=this.#j;else try{this.#O=t.select,c=t.select(c),c=Ft(i?.data,c,t),this.#j=c,this.#M=null}catch(_){this.#M=_}this.#M&&(h=this.#M,c=this.#j,p=Date.now(),f="error");const g="fetching"===u.fetchStatus,v="pending"===f,A="error"===f,y=v&&g,b=void 0!==c,x={status:f,fetchStatus:u.fetchStatus,isPending:v,isSuccess:"success"===f,isError:A,isInitialLoading:y,isLoading:y,data:c,dataUpdatedAt:u.dataUpdatedAt,error:h,errorUpdatedAt:p,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>s.dataUpdateCount||u.errorUpdateCount>s.errorUpdateCount,isFetching:g,isRefetching:g&&!v,isLoadingError:A&&!b,isPaused:"paused"===u.fetchStatus,isPlaceholderData:d,isRefetchError:A&&b,isStale:Cn(e,t),refetch:this.refetch,promise:this.#E,isEnabled:!1!==Mt(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=e=>{"error"===x.status?e.reject(x.error):void 0!==x.data&&e.resolve(x.data)},r=()=>{const e=this.#E=x.promise=Yt();t(e)},i=this.#E;switch(i.status){case"pending":e.queryHash===n.queryHash&&t(i);break;case"fulfilled":"error"!==x.status&&x.data===i.value||r();break;case"rejected":"error"===x.status&&x.error===i.reason||r()}}return x}updateResult(){const e=this.#k,t=this.createResult(this.#P,this.options);if(this.#R=this.#P.state,this.#L=this.options,void 0!==this.#R.data&&(this.#D=this.#P),jt(t,e))return;this.#k=t;this.#X({listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,n="function"===typeof t?t():t;if("all"===n||!n&&!this.#z.size)return!0;const r=new Set(n??this.#z);return this.options.throwOnError&&r.add("error"),Object.keys(this.#k).some(t=>{const n=t;return this.#k[n]!==e[n]&&r.has(n)})})()})}#W(){const e=this.#u.getQueryCache().build(this.#u,this.options);if(e===this.#P)return;const t=this.#P;this.#P=e,this.#N=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#V()}#X(e){Ht.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#k)}),this.#u.getQueryCache().notify({query:this.#P,type:"observerResultsUpdated"})})}};function wn(e,t){return function(e,t){return!1!==Mt(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&Sn(e,t,t.refetchOnMount)}function Sn(e,t,n){if(!1!==Mt(t.enabled,e)&&"static"!==Ct(t.staleTime,e)){const r="function"===typeof n?n(e):n;return"always"===r||!1!==r&&Cn(e,t)}return!1}function Tn(e,t,n,r){return(e!==t||!1===Mt(r.enabled,e))&&(!n.suspense||"error"!==e.state.status)&&Cn(e,n)}function Cn(e,t){return!1!==Mt(t.enabled,e)&&e.isStaleByTime(Ct(t.staleTime,e))}function Mn(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var En=r.createContext(Mn()),Pn=r.createContext(!1),Nn=(Pn.Provider,(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()}));function kn(e,t,n){const i=r.useContext(Pn),a=r.useContext(En),o=At(n),s=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(s),s._optimisticResults=i?"isRestoring":"optimistic",(e=>{if(e.suspense){const t=1e3,n=e=>"static"===e?e:Math.max(e??t,t),r=e.staleTime;e.staleTime="function"===typeof r?(...e)=>n(r(...e)):n(r),"number"===typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,t))}})(s),((e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))})(s,a),(e=>{r.useEffect(()=>{e.clearReset()},[e])})(a);const l=!o.getQueryCache().get(s.queryHash),[c]=r.useState(()=>new t(o,s)),u=c.getOptimisticResult(s),d=!i&&!1!==e.subscribed;if(r.useSyncExternalStore(r.useCallback(e=>{const t=d?c.subscribe(Ht.batchCalls(e)):wt;return c.updateResult(),t},[c,d]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),r.useEffect(()=>{c.setOptions(s)},[s,c]),((e,t)=>e?.suspense&&t.isPending)(s,u))throw Nn(s,c,a);if((({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(i&&void 0===e.data||qt(n,[e.error,r])))({result:u,errorResetBoundary:a,throwOnError:s.throwOnError,query:o.getQueryCache().get(s.queryHash),suspense:s.suspense}))throw u.error;if(o.getDefaultOptions().queries?._experimental_afterQuery?.(s,u),s.experimental_prefetchInRender&&!_t&&((e,t)=>e.isLoading&&e.isFetching&&!t)(u,i)){const e=l?Nn(s,c,a):o.getQueryCache().get(s.queryHash)?.promise;e?.catch(wt).finally(()=>{c.updateResult()})}return s.notifyOnChangeProps?u:c.trackResult(u)}function Rn(e,t){return kn(e,_n,t)}var Ln=n(2795),On=n(9265),jn=(0,On.tv)({slots:{base:["group","relative","overflow-hidden","bg-content3 dark:bg-content2","pointer-events-none","before:opacity-100","before:absolute","before:inset-0","before:-translate-x-full","before:border-t","before:border-content4/30","before:bg-gradient-to-r","before:from-transparent","before:via-content4","dark:before:via-default-700/10","before:to-transparent","after:opacity-100","after:absolute","after:inset-0","after:-z-10","after:bg-content3","dark:after:bg-content2","data-[loaded=true]:pointer-events-auto","data-[loaded=true]:overflow-visible","data-[loaded=true]:!bg-transparent","data-[loaded=true]:before:opacity-0 data-[loaded=true]:before:-z-10 data-[loaded=true]:before:animate-none","data-[loaded=true]:after:opacity-0"],content:["opacity-0","group-data-[loaded=true]:opacity-100"]},variants:{disableAnimation:{true:{base:"before:animate-none before:transition-none after:transition-none",content:"transition-none"},false:{base:"before:animate-shimmer transition-background !duration-300",content:"transition-opacity motion-reduce:transition-none !duration-300"}}},defaultVariants:{}}),Dn=n(2927),In=n(3779),Bn=n(4906);var Fn=(0,Ln.Rf)((e,t)=>{const{Component:n,children:i,getSkeletonProps:a,getContentProps:o}=function(e){var t,n;const i=(0,Bn.o)(),[a,o]=(0,Ln.rE)(e,jn.variantKeys),{as:s,children:l,isLoaded:c=!1,className:u,classNames:d,...h}=a,p=s||"div",f=null!=(n=null!=(t=e.disableAnimation)?t:null==i?void 0:i.disableAnimation)&&n,m=(0,r.useMemo)(()=>jn({...o,disableAnimation:f}),[(0,In.t6)(o),f,l]),g=(0,Dn.cn)(null==d?void 0:d.base,u);return{Component:p,children:l,slots:m,classNames:d,getSkeletonProps:(e={})=>({"data-loaded":(0,In.sE)(c),className:m.base({class:(0,Dn.cn)(g,null==e?void 0:e.className)}),...h}),getContentProps:(e={})=>({className:m.content({class:(0,Dn.cn)(null==d?void 0:d.content,null==e?void 0:e.className)})})}}({...e});return(0,gt.jsx)(n,{ref:t,...a(),children:(0,gt.jsx)("div",{...o(),children:i})})});Fn.displayName="HeroUI.Skeleton";var zn=Fn;const Un=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),Vn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Gn=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)};var qn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Wn=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1},Hn=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:a="",children:o,iconNode:s,...l},c)=>(0,r.createElement)("svg",{ref:c,...qn,width:t,height:t,stroke:e,strokeWidth:i?24*Number(n)/Number(t):n,className:Un("lucide",a),...!o&&!Wn(l)&&{"aria-hidden":"true"},...l},[...s.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(o)?o:[o]])),$n=(e,t)=>{const n=(0,r.forwardRef)(({className:n,...i},a)=>(0,r.createElement)(Hn,{ref:a,iconNode:t,className:Un(`lucide-${Vn(Gn(e))}`,`lucide-${e}`,n),...i}));return n.displayName=Gn(e),n},Kn=$n("image-off",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);function Xn({src:e,thumb:t,alt:n="",aspectRatio:i="1/1",className:a="",objectFit:o="cover",fadeInDuration:s=.3,unloadOnExit:l=!1,rootMargin:c="200px",onClick:u,onLoad:d,onError:h,...p}){const[f,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),[A,y]=(0,r.useState)(!1),[b,x]=(0,r.useState)(!!t),_=(0,r.useRef)(null),w=(0,r.useRef)(null);(0,r.useEffect)(()=>{const e=_.current;if(e)return w.current=new IntersectionObserver(([n])=>{n.isIntersecting?(m(!0),!l&&w.current&&w.current.unobserve(e)):l&&(m(!1),v(!1),x(!!t))},{rootMargin:c,threshold:.01}),w.current.observe(e),()=>{w.current&&e&&w.current.unobserve(e)}},[l,c,t]);return(0,gt.jsxs)("div",{ref:_,className:`relative overflow-hidden bg-default-100 ${a}`,style:{aspectRatio:i},onClick:u,...p,children:[!f&&(0,gt.jsx)(zn,{className:"absolute inset-0 w-full h-full"}),f&&!A&&(0,gt.jsxs)(gt.Fragment,{children:[t&&b&&(0,gt.jsx)("img",{src:t,alt:n,className:"absolute inset-0 w-full h-full",style:{objectFit:o,filter:"blur(10px)",transform:"scale(1.1)"},loading:"eager"}),(0,gt.jsx)("img",{src:e,alt:n,className:"absolute inset-0 w-full h-full",style:{objectFit:o,opacity:g?1:0,transition:`opacity ${s}s ease-in-out`},onLoad:()=>{v(!0),x(!1),null===d||void 0===d||d()},onError:()=>{y(!0),null===h||void 0===h||h()},loading:"lazy",decoding:"async"}),!g&&!t&&(0,gt.jsx)(zn,{className:"absolute inset-0 w-full h-full"})]}),A&&(0,gt.jsxs)("div",{className:"absolute inset-0 bg-default-100 flex flex-col items-center justify-center text-default-400 cursor-pointer",onClick:e=>{e.stopPropagation(),y(!1),v(!1)},children:[(0,gt.jsx)(Kn,{size:24,className:"mb-2"}),(0,gt.jsx)("span",{className:"text-xs",children:"Click to retry"})]})]})}var Yn=(0,r.memo)(Xn);function Qn({children:e,height:t=260,padding:n=12,gap:i=16,background:a="transparent",style:o,loop:s=!0,showEdges:l=!0}){const c=(0,r.useRef)(null),u=(0,r.useRef)(null),d=(0,r.useRef)({pos:0,target:0,vel:0,isDragging:!1,startX:0,lastX:0,lastTime:0,segmentWidth:0,amplitude:0,timestamp:0}),h=(0,r.useRef)(null),p=(0,r.useMemo)(()=>`hs-${Math.random().toString(36).slice(2)}`,[]),f=(0,r.useMemo)(()=>r.Children.count(e),[e]),m=s&&f>=4,g=(0,r.useCallback)(()=>{const e=d.current,t=c.current,n=u.current;if(t&&n){if(e.isDragging||(e.vel*=.92,Math.abs(e.vel)<.05&&(e.vel=0),e.pos+=e.vel),m&&e.segmentWidth>0){const t=e.segmentWidth;e.pos<.5*t?e.pos+=t:e.pos>1.5*t&&(e.pos-=t)}else{const n=t.scrollWidth-t.clientWidth;e.pos<0&&(e.pos=0,e.vel=0),e.pos>n&&(e.pos=n,e.vel=0)}if(Math.abs(t.scrollLeft-e.pos)>.5&&(t.scrollLeft=e.pos),Math.abs(e.vel)>.5){const t=Math.max(-2,Math.min(2,.1*e.vel));n.style.transform=`skewX(${-t}deg)`,n.style.transition="none"}else n.style.transform="skewX(0deg)",n.style.transition="transform 0.3s ease-out";h.current=requestAnimationFrame(g)}},[m]);(0,r.useEffect)(()=>(h.current=requestAnimationFrame(g),()=>cancelAnimationFrame(h.current)),[g]);const v=(0,r.useCallback)(e=>{if(!m&&f<4)return;if(0!==e.button&&1!==e.button)return;const t=d.current;t.isDragging=!0,t.startX=e.clientX,t.lastX=e.clientX,t.lastTime=performance.now(),t.vel=0;const n=c.current;n&&(n.style.cursor="grabbing")},[m,f]),A=(0,r.useCallback)(e=>{const t=d.current;if(!t.isDragging)return;const n=performance.now(),r=e.clientX-t.lastX,i=n-t.lastTime;if(t.pos-=r,i>0){const e=-r;t.vel=.5*t.vel+.5*e}t.lastX=e.clientX,t.lastTime=n},[]),y=(0,r.useCallback)(e=>{const t=d.current;if(!t.isDragging)return;t.isDragging=!1;const n=c.current;n&&(n.style.cursor=m?"grab":"default");performance.now()-t.lastTime>100?t.vel=0:t.vel*=1.2},[m]);(0,r.useEffect)(()=>{const e=c.current;if(!e)return;const t=e=>{e.preventDefault();const t=Math.abs(e.deltaX)>Math.abs(e.deltaY)?e.deltaX:e.deltaY;d.current.vel+=.08*t};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]),(0,r.useLayoutEffect)(()=>{const e=c.current,t=u.current;if(!e||!t)return;const n=()=>{if(m){const n=t.scrollWidth/3;d.current.segmentWidth=n,0===d.current.pos&&(d.current.pos=n,e.scrollLeft=n)}else d.current.segmentWidth=0};n();const r=new ResizeObserver(n);return r.observe(t),()=>r.disconnect()},[e,m,i]);const b=(0,r.useMemo)(()=>{const t=r.Children.toArray(e);return m?[...t.map((e,t)=>r.cloneElement(e,{key:`pre-${t}`})),...t.map((e,t)=>r.cloneElement(e,{key:`cur-${t}`})),...t.map((e,t)=>r.cloneElement(e,{key:`post-${t}`}))]:t},[e,m]);return(0,gt.jsxs)("div",{style:{position:"relative",...o},children:[(0,gt.jsx)("style",{children:`\n        .${p}::-webkit-scrollbar{ display:none; height:0; width:0 }\n      `}),(0,gt.jsx)("div",{className:p,ref:c,onPointerDown:v,onPointerMove:A,onPointerUp:y,onPointerLeave:y,style:{overflowX:"hidden",overflowY:"hidden",whiteSpace:"nowrap",padding:n,background:a,height:t,boxSizing:"border-box",userSelect:"none",touchAction:"none",cursor:m?"grab":"default"},children:(0,gt.jsx)("div",{ref:u,style:{display:"inline-flex",gap:i,alignItems:"stretch",height:"100%",willChange:"transform"},children:b})}),l&&m&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-12 pointer-events-none z-10 bg-gradient-to-r from-background to-transparent"}),(0,gt.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-12 pointer-events-none z-10 bg-gradient-to-l from-background to-transparent"})]})]})}var Zn=r.memo(Qn);function Jn({rolls:e=[],horizontal:t=!1}){const n=se(),r=At();function i(e){if(!e)return"Unknown film";return e.film_name_joined||e.film&&e.film.name||e.film_type||e.filmName||("string"===typeof e.film?e.film:null)||null||"Unknown film"}async function a(e,t){if(t&&t.stopPropagation(),window.confirm("Delete this roll and its files? This cannot be undone."))try{const t=await(0,bn.LF)(e);t&&(t.deleted||t.ok||!1!==t.success)?r.invalidateQueries(["rolls"]):alert("Delete failed")}catch(n){console.error(n),alert("Delete failed: "+(n.message||n))}}if(!e||0===e.length)return(0,gt.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#999"},children:"No rolls found."});const o=(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:t?void 0:"repeat(auto-fill, minmax(240px, 1fr))",gap:t?0:16},children:e.map(e=>(0,gt.jsxs)("div",{className:"card",onClick:()=>n(`/rolls/${e.id}`),style:t?{width:280,minWidth:280,height:"100%",cursor:"pointer"}:void 0,children:[(0,gt.jsx)("button",{className:"card-delete btn btn-danger btn-sm",onClick:t=>a(e.id,t),"aria-label":`Delete roll ${e.title||"Untitled"}`,children:"Delete"}),(0,gt.jsxs)("div",{className:"card-cover",children:[e.coverPath||e.cover_photo?(()=>{const t=e.coverPath||e.cover_photo,n=(0,bn.FH)(t);return(0,gt.jsx)(Yn,{src:n,alt:"cover",aspectRatio:"3/2",className:"w-full h-full",objectFit:"cover",fadeInDuration:.3})})():(0,gt.jsx)("div",{style:{color:"#999"},children:"No cover"}),(0,gt.jsxs)("div",{className:"card-overlay",children:[(0,gt.jsx)("div",{className:"card-title",children:e.title||"Untitled"}),(0,gt.jsxs)("div",{className:"card-meta",children:[e.start_date?e.start_date:"",e.end_date&&e.end_date!==e.start_date?` \u2014 ${e.end_date}`:""]}),(0,gt.jsx)("div",{className:"card-meta muted",children:i(e)})]})]})]},e.id))});return t?(0,gt.jsx)(Zn,{height:330,padding:8,loop:e.length>=4,showEdges:e.length>=4,children:e.map(e=>(0,gt.jsxs)("div",{className:"card",onClick:()=>n(`/rolls/${e.id}`),style:{width:320,minWidth:320,height:"100%",cursor:"pointer"},children:[(0,gt.jsx)("button",{className:"card-delete btn btn-danger btn-sm",onClick:t=>a(e.id,t),"aria-label":`Delete roll ${e.title||"Untitled"}`,children:"Delete"}),(0,gt.jsxs)("div",{className:"card-cover",children:[e.coverPath||e.cover_photo?(()=>{const t=e.coverPath||e.cover_photo,n=(0,bn.FH)(t);return(0,gt.jsx)(Yn,{src:n,alt:"cover",aspectRatio:"3/2",className:"w-full h-full",objectFit:"cover",fadeInDuration:.3})})():(0,gt.jsx)("div",{style:{color:"#999"},children:"No cover"}),(0,gt.jsxs)("div",{className:"card-overlay",children:[(0,gt.jsx)("div",{className:"card-title",children:e.title||"Untitled"}),(0,gt.jsxs)("div",{className:"card-meta",children:[e.start_date?e.start_date:"",e.end_date&&e.end_date!==e.start_date?` \u2014 ${e.end_date}`:""]}),(0,gt.jsx)("div",{className:"card-meta muted",children:i(e)})]})]})]},e.id))}):o}var er=r.memo(Jn);function tr(){const e=se(),{data:t=[],isLoading:n}=Rn({queryKey:["rolls"],queryFn:()=>(0,bn.fn)(),...vn("rolls"),keepPreviousData:!0});return n?(0,gt.jsx)("div",{className:"p-10 text-center text-zinc-500 dark:text-zinc-400",children:"Loading rolls..."}):(0,gt.jsxs)("div",{className:"flex flex-col min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6",children:[(0,gt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,gt.jsx)("h3",{className:"text-2xl font-bold",children:"Roll Library"}),(0,gt.jsx)("div",{children:(0,gt.jsx)("button",{className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:opacity-90 transition-opacity font-medium",onClick:()=>e("/rolls/new"),children:"New Roll"})})]}),(0,gt.jsx)(er,{rolls:t})]})}function nr({value:e,onChange:t}){var n,i;const[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),[c,u]=(0,r.useState)(""),[d,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[v,A]=(0,r.useState)("");(0,r.useEffect)(()=>{(0,bn.X6)().then(e=>{const t=(Array.isArray(e)?e:[]).sort((e,t)=>(e.country_name||"").localeCompare(t.country_name||""));o(t)})},[]),(0,r.useEffect)(()=>{c?(console.log("[LocationSelect] Loading cities for country:",c),(0,bn.X8)({country:c}).then(e=>{console.log("[LocationSelect] Received cities:",(null===e||void 0===e?void 0:e.length)||0),l(Array.isArray(e)?e:[])}).catch(e=>{console.error("[LocationSelect] Error loading cities:",e),l([])})):l([])},[c]),(0,r.useEffect)(()=>{e&&(0,bn.g$)(e).then(e=>{if(e&&e.country_code){u(e.country_code);const t=a.find(t=>t.country_code===e.country_code);h(t?t.country_name:e.country_code),f(e.city_name),g(e.city_name)}})},[e,a]),(0,r.useEffect)(()=>{const n=s.find(e=>e.city_name===p);if(n&&t){if(n.id===e)return;t({location_id:n.id,country_code:n.country_code,country_name:n.country_name,city_name:n.city_name,latitude:n.city_lat,longitude:n.city_lng})}},[p,s,t,e]);const y=a.filter(e=>e.country_name.toLowerCase().startsWith(d.toLowerCase())),b=s.filter(e=>e.city_name.toLowerCase().startsWith(m.toLowerCase())),x=s.find(e=>e.city_name===p);return(0,gt.jsxs)("div",{className:"fg-location-select",style:{display:"flex",flexDirection:"column",gap:10},children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,gt.jsxs)("div",{style:{position:"relative"},children:[(0,gt.jsx)("input",{className:"fg-input",list:"country-list",value:d,onChange:function(e){const t=e.target.value;h(t);const n=a.find(e=>e.country_name.toLowerCase()===t.toLowerCase());n?(u(n.country_code),f(""),g("")):c&&(u(""),f(""),g(""))},placeholder:"Country",autoComplete:"off",style:{width:"100%",boxSizing:"border-box"}}),(0,gt.jsx)("datalist",{id:"country-list",children:y.slice(0,100).map(e=>(0,gt.jsx)("option",{value:e.country_name},e.country_code))})]}),(0,gt.jsxs)("div",{style:{position:"relative"},children:[(0,gt.jsx)("input",{className:"fg-input",list:"city-list",value:m,onChange:function(e){const t=e.target.value;g(t);const n=s.find(e=>e.city_name.toLowerCase()===t.toLowerCase());n?f(n.city_name):p&&f("")},placeholder:"City",autoComplete:"off",disabled:!c,style:{width:"100%",boxSizing:"border-box"}}),(0,gt.jsx)("datalist",{id:"city-list",children:b.slice(0,100).map(e=>(0,gt.jsx)("option",{value:e.city_name},e.id))})]})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"stretch"},children:[(0,gt.jsx)("input",{className:"fg-input",placeholder:"Add city",value:v,onChange:e=>A(e.target.value),style:{flex:1,minWidth:0}}),(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-secondary",onClick:async function(){if(c&&v.trim())try{const e=a.find(e=>e.country_code===c),t=e?e.country_name:c,n=await(0,bn.yJ)({country_code:c,country_name:t,city_name:v.trim()});if(n&&n.id){const e=await(0,bn.X8)({country:c});l(Array.isArray(e)?e:[]),f(v.trim()),g(v.trim()),A("")}}catch(or){console.error("Add city failed",or)}},disabled:!c||!v.trim(),style:{flexShrink:0},children:"Add"})]}),x&&(0,gt.jsxs)("div",{style:{fontSize:12,color:"var(--fg-muted)"},children:["Lat: ",null!==(n=x.city_lat)&&void 0!==n?n:"\u2014"," Lng: ",null!==(i=x.city_lng)&&void 0!==i?i:"\u2014"]})]})}n(1997);function rr({films:e=[],value:t,onChange:n}){const r=Array.isArray(e)?e:[],i=e=>e&&"135"!==e?` [${e}]`:"";return(0,gt.jsxs)("select",{value:t||"",onChange:e=>n(e.target.value||null),children:[(0,gt.jsx)("option",{value:"",children:"\u2014 Select film \u2014"}),r.map(e=>(0,gt.jsxs)("option",{value:e.id,children:[e.brand?`${e.brand} `:"",e.name,i(e.format)," \u2022 ISO ",e.iso," \u2022 ",e.category]},e.id))]})}var ir=n(1848),ar=n(775),or="undefined"!=typeof self?self:n.g;const sr="undefined"!=typeof navigator,lr=sr&&"undefined"==typeof HTMLImageElement,cr=!("undefined"==typeof n.g||"undefined"==typeof process||!process.versions||!process.versions.node),ur=or.Buffer,dr=or.BigInt,hr=!!ur,pr=e=>e;function fr(e,t=pr){if(cr)try{return"function"==typeof require?Promise.resolve(t(require(e))):import(e).then(t)}catch(t){console.warn(`Couldn't load ${e}`)}}let mr=or.fetch;if(!or.fetch){const e=fr("http",e=>e),t=fr("https",e=>e),n=(r,{headers:i}={})=>new Promise(async(a,o)=>{let{port:s,hostname:l,pathname:c,protocol:u,search:d}=new URL(r);const h={method:"GET",hostname:l,path:encodeURI(c)+d,headers:i};""!==s&&(h.port=Number(s));const p=("https:"===u?await t:await e).request(h,e=>{if(301===e.statusCode||302===e.statusCode){let t=new URL(e.headers.location,r).toString();return n(t,{headers:i}).then(a).catch(o)}a({status:e.statusCode,arrayBuffer:()=>new Promise(t=>{let n=[];e.on("data",e=>n.push(e)),e.on("end",()=>t(Buffer.concat(n)))})})});p.on("error",o),p.end()});(e=>{mr=e})(n)}function gr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const vr=e=>yr(e)?void 0:e,Ar=e=>void 0!==e;function yr(e){return void 0===e||(e instanceof Map?0===e.size:0===Object.values(e).filter(Ar).length)}function br(e){let t=new Error(e);throw delete t.stack,t}function xr(e){return""===(e=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(e).trim())?void 0:e}function _r(e){let t=function(e){let t=0;return e.ifd0.enabled&&(t+=1024),e.exif.enabled&&(t+=2048),e.makerNote&&(t+=2048),e.userComment&&(t+=1024),e.gps.enabled&&(t+=512),e.interop.enabled&&(t+=100),e.ifd1.enabled&&(t+=1024),t+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const wr=e=>String.fromCharCode.apply(null,e),Sr="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;function Tr(e){return Sr?Sr.decode(e):hr?Buffer.from(e).toString("utf8"):decodeURIComponent(escape(wr(e)))}class Cr{static from(e,t){return e instanceof this&&e.le===t?e:new Cr(e,void 0,void 0,t)}constructor(e,t=0,n,r){if("boolean"==typeof r&&(this.le=r),Array.isArray(e)&&(e=new Uint8Array(e)),0===e)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){void 0===n&&(n=e.byteLength-t);let r=new DataView(e,t,n);this._swapDataView(r)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof Cr){void 0===n&&(n=e.byteLength-t),(t+=e.byteOffset)+n>e.byteOffset+e.byteLength&&br("Creating view outside of available memory in ArrayBuffer");let r=new DataView(e.buffer,t,n);this._swapDataView(r)}else if("number"==typeof e){let t=new DataView(new ArrayBuffer(e));this._swapDataView(t)}else br("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,n=Cr){return e instanceof DataView||e instanceof Cr?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||br("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new n(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new Cr(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return Tr(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let n=this.getUint8Array(e,t);return wr(n)}getUnicodeString(e=0,t=this.byteLength){const n=[];for(let r=0;r<t&&e+r<this.byteLength;r+=2)n.push(this.getUint16(e+r));return wr(n)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,n){switch(t){case 1:return this.getUint8(e,n);case 2:return this.getUint16(e,n);case 4:return this.getUint32(e,n);case 8:return this.getUint64&&this.getUint64(e,n)}}getUint(e,t,n){switch(t){case 8:return this.getUint8(e,n);case 16:return this.getUint16(e,n);case 32:return this.getUint32(e,n);case 64:return this.getUint64&&this.getUint64(e,n)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function Mr(e,t){br(`${e} '${t}' was not loaded, try using full build of exifr.`)}class Er extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||Mr(this.kind,e),t&&(e in t||function(e,t){br(`Unknown ${e} '${t}'.`)}(this.kind,e),t[e].enabled||Mr(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var Pr=new Er("file parser"),Nr=new Er("segment parser"),kr=new Er("file reader");function Rr(e,t){return"string"==typeof e?Lr(e,t):sr&&!lr&&e instanceof HTMLImageElement?Lr(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new Cr(e):sr&&e instanceof Blob?Or(e,t,"blob",Ir):void br("Invalid input argument")}function Lr(e,t){return(n=e).startsWith("data:")||n.length>1e4?jr(e,t,"base64"):cr&&e.includes("://")?Or(e,t,"url",Dr):cr?jr(e,t,"fs"):sr?Or(e,t,"url",Dr):void br("Invalid input argument");var n}async function Or(e,t,n,r){return kr.has(n)?jr(e,t,n):r?async function(e,t){let n=await t(e);return new Cr(n)}(e,r):void br(`Parser ${n} is not loaded`)}async function jr(e,t,n){let r=new(kr.get(n))(e,t);return await r.read(),r}const Dr=e=>mr(e).then(e=>e.arrayBuffer()),Ir=e=>new Promise((t,n)=>{let r=new FileReader;r.onloadend=()=>t(r.result||new ArrayBuffer),r.onerror=n,r.readAsArrayBuffer(e)});class Br extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function Fr(e,t,n){let r=new Br;for(let[i,a]of n)r.set(i,a);if(Array.isArray(t))for(let i of t)e.set(i,r);else e.set(t,r);return r}function zr(e,t,n){let r,i=e.get(t);for(r of n)i.set(r[0],r[1])}const Ur=new Map,Vr=new Map,Gr=new Map,qr=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Wr=["jfif","xmp","icc","iptc","ihdr"],Hr=["tiff",...Wr],$r=["ifd0","ifd1","exif","gps","interop"],Kr=[...Hr,...$r],Xr=["makerNote","userComment"],Yr=["translateKeys","translateValues","reviveValues","multiSegment"],Qr=[...Yr,"sanitize","mergeOutput","silentErrors"];class Zr{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Jr extends Zr{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,n,r){if(super(),gr(this,"enabled",!1),gr(this,"skip",new Set),gr(this,"pick",new Set),gr(this,"deps",new Set),gr(this,"translateKeys",!1),gr(this,"translateValues",!1),gr(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(r),this.canBeFiltered=$r.includes(e),this.canBeFiltered&&(this.dict=Ur.get(e)),void 0!==n)if(Array.isArray(n))this.parse=this.enabled=!0,this.canBeFiltered&&n.length>0&&this.translateTagSet(n,this.pick);else if("object"==typeof n){if(this.enabled=!0,this.parse=!1!==n.parse,this.canBeFiltered){let{pick:e,skip:t}=n;e&&e.length>0&&this.translateTagSet(e,this.pick),t&&t.length>0&&this.translateTagSet(t,this.skip)}this.applyInheritables(n)}else!0===n||!1===n?this.parse=this.enabled=n:br(`Invalid options argument: ${n}`)}applyInheritables(e){let t,n;for(t of Yr)n=e[t],void 0!==n&&(this[t]=n)}translateTagSet(e,t){if(this.dict){let n,r,{tagKeys:i,tagValues:a}=this.dict;for(n of e)"string"==typeof n?(r=a.indexOf(n),-1===r&&(r=i.indexOf(Number(n))),-1!==r&&t.add(Number(i[r]))):t.add(n)}else for(let n of e)t.add(n)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,ai(this.pick,this.deps)):this.enabled&&this.pick.size>0&&ai(this.pick,this.deps)}}var ei={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},ti=new Map;class ni extends Zr{static useCached(e){let t=ti.get(e);return void 0!==t||(t=new this(e),ti.set(e,t)),t}constructor(e){super(),!0===e?this.setupFromTrue():void 0===e?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):"object"==typeof e?this.setupFromObject(e):br(`Invalid options argument ${e}`),void 0===this.firstChunkSize&&(this.firstChunkSize=sr?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of qr)this[e]=ei[e];for(e of Qr)this[e]=ei[e];for(e of Xr)this[e]=ei[e];for(e of Kr)this[e]=new Jr(e,ei[e],void 0,this)}setupFromTrue(){let e;for(e of qr)this[e]=ei[e];for(e of Qr)this[e]=ei[e];for(e of Xr)this[e]=!0;for(e of Kr)this[e]=new Jr(e,!0,void 0,this)}setupFromArray(e){let t;for(t of qr)this[t]=ei[t];for(t of Qr)this[t]=ei[t];for(t of Xr)this[t]=ei[t];for(t of Kr)this[t]=new Jr(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,$r)}setupFromObject(e){let t;for(t of($r.ifd0=$r.ifd0||$r.image,$r.ifd1=$r.ifd1||$r.thumbnail,Object.assign(this,e),qr))this[t]=ii(e[t],ei[t]);for(t of Qr)this[t]=ii(e[t],ei[t]);for(t of Xr)this[t]=ii(e[t],ei[t]);for(t of Hr)this[t]=new Jr(t,ei[t],e[t],this);for(t of $r)this[t]=new Jr(t,ei[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,$r,Kr),!0===e.tiff?this.batchEnableWithBool($r,!0):!1===e.tiff?this.batchEnableWithUserValue($r,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,$r):"object"==typeof e.tiff&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,$r)}batchEnableWithBool(e,t){for(let n of e)this[n].enabled=t}batchEnableWithUserValue(e,t){for(let n of e){let e=t[n];this[n].enabled=!1!==e&&void 0!==e}}setupGlobalFilters(e,t,n,r=n){if(e&&e.length){for(let e of r)this[e].enabled=!1;let t=ri(e,n);for(let[e,n]of t)ai(this[e].pick,n),this[e].enabled=!0}else if(t&&t.length){let e=ri(t,n);for(let[t,n]of e)ai(this[t].skip,n)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:n,iptc:r,icc:i}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),n.enabled||e.skip.add(700),r.enabled||e.skip.add(33723),i.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:n,interop:r}=this;r.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),n.needed&&e.deps.add(34853),this.tiff.enabled=$r.some(e=>!0===this[e].enabled)||this.makerNote||this.userComment;for(let i of $r)this[i].finalizeFilters()}get onlyTiff(){return!Wr.map(e=>this[e].enabled).some(e=>!0===e)&&this.tiff.enabled}checkLoadedPlugins(){for(let e of Hr)this[e].enabled&&!Nr.has(e)&&Mr("segment parser",e)}}function ri(e,t){let n,r,i,a,o=[];for(i of t){for(a of(n=Ur.get(i),r=[],n))(e.includes(a[0])||e.includes(a[1]))&&r.push(a[0]);r.length&&o.push([i,r])}return o}function ii(e,t){return void 0!==e?e:void 0!==t?t:void 0}function ai(e,t){for(let n of t)e.add(n)}gr(ni,"default",ei);class oi{constructor(e){gr(this,"parsers",{}),gr(this,"output",{}),gr(this,"errors",[]),gr(this,"pushToErrors",e=>this.errors.push(e)),this.options=ni.useCached(e)}async read(e){this.file=await Rr(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[n,r]of Pr)if(r.canHandle(e,t))return this.fileParser=new r(this.options,this.file,this.parsers),e[n]=!0;this.file.close&&this.file.close(),br("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),vr(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map(async t=>{let n=await t.parse();t.assignToOutput(e,n)});this.options.silentErrors&&(t=t.map(e=>e.catch(this.pushToErrors))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,n=Nr.get("tiff",e);var r;if(t.tiff?r={start:0,type:"tiff"}:t.jpeg&&(r=await this.fileParser.getOrFindSegment("tiff")),void 0===r)return;let i=await this.fileParser.ensureSegmentChunk(r),a=this.parsers.tiff=new n(i,e,t),o=await a.extractThumbnail();return t.close&&t.close(),o}}async function si(e,t){let n=new oi(t);return await n.read(e),n.parse()}var li=Object.freeze({__proto__:null,parse:si,Exifr:oi,fileParsers:Pr,segmentParsers:Nr,fileReaders:kr,tagKeys:Ur,tagValues:Vr,tagRevivers:Gr,createDictionary:Fr,extendDictionary:zr,fetchUrlAsArrayBuffer:Dr,readBlobAsArrayBuffer:Ir,chunkedProps:qr,otherSegments:Wr,segments:Hr,tiffBlocks:$r,segmentsAndBlocks:Kr,tiffExtractables:Xr,inheritables:Yr,allFormatters:Qr,Options:ni});class ci{constructor(e,t,n){gr(this,"errors",[]),gr(this,"ensureSegmentChunk",async e=>{let t=e.start,n=e.size||65536;if(this.file.chunked)if(this.file.available(t,n))e.chunk=this.file.subarray(t,n);else try{e.chunk=await this.file.readChunk(t,n)}catch(t){br(`Couldn't read segment: ${JSON.stringify(e)}. ${t.message}`)}else this.file.byteLength>t+n?e.chunk=this.file.subarray(t,n):void 0===e.size?e.chunk=this.file.subarray(t):br("Segment unreachable: "+JSON.stringify(e));return e.chunk}),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=n}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let n=new(Nr.get(e))(t,this.options,this.file);return this.parsers[e]=n}createParsers(e){for(let t of e){let{type:e,chunk:n}=t,r=this.options[e];if(r&&r.enabled){let t=this.parsers[e];t&&t.append||t||this.createParser(e,n)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class ui{static findPosition(e,t){let n=e.getUint16(t+2)+2,r="function"==typeof this.headerLength?this.headerLength(e,t,n):this.headerLength,i=t+r,a=n-r;return{offset:t,length:n,headerLength:r,start:i,size:a,end:i+a}}static parse(e,t={}){return new this(e,new ni({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof Cr?e:new Cr(e)}constructor(e,t={},n){gr(this,"errors",[]),gr(this,"raw",new Map),gr(this,"handleError",e=>{if(!this.options.silentErrors)throw e;this.errors.push(e.message)}),this.chunk=this.normalizeInput(e),this.file=n,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let n=Gr.get(t),r=Vr.get(t),i=Ur.get(t),a=this.options[t],o=a.reviveValues&&!!n,s=a.translateValues&&!!r,l=a.translateKeys&&!!i,c={};for(let[u,d]of e)o&&n.has(u)?d=n.get(u)(d):s&&r.has(u)&&(d=this.translateValue(d,r.get(u))),l&&i.has(u)&&(u=i.get(u)||u),c[u]=d;return c}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,n){if(this.globalOptions.mergeOutput)return Object.assign(e,n);e[t]?Object.assign(e[t],n):e[t]=n}}function di(e){return 192===e||194===e||196===e||219===e||221===e||218===e||254===e}function hi(e){return e>=224&&e<=239}function pi(e,t,n){for(let[r,i]of Nr)if(i.canHandle(e,t,n))return r}gr(ui,"headerLength",4),gr(ui,"type",void 0),gr(ui,"multiSegment",!1),gr(ui,"canHandle",()=>!1);class fi extends ci{constructor(...e){super(...e),gr(this,"appSegments",[]),gr(this,"jpegSegments",[]),gr(this,"unknownSegments",[])}static canHandle(e,t){return 65496===t}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){!0===e?(this.findAll=!0,this.wanted=new Set(Nr.keyList())):(e=void 0===e?Nr.keyList().filter(e=>this.options[e].enabled):e.filter(e=>this.options[e].enabled&&Nr.has(e)),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:n,findAll:r,wanted:i,remaining:a}=this;if(!r&&this.file.chunked&&(r=Array.from(i).some(e=>{let t=Nr.get(e),n=this.options[e];return t.multiSegment&&n.multiSegment}),r&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,n.byteLength),!this.options.onlyTiff&&n.chunked){let t=!1;for(;a.size>0&&!t&&(n.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:r}=n,i=this.appSegments.some(e=>!this.file.available(e.offset||e.start,e.length||e.size));if(t=e>r&&!i?!await n.readNextChunk(e):!await n.readNextChunk(r),void 0===(e=this.findAppSegmentsInRange(e,n.byteLength)))return}}}findAppSegmentsInRange(e,t){t-=2;let n,r,i,a,o,s,{file:l,findAll:c,wanted:u,remaining:d,options:h}=this;for(;e<t;e++)if(255===l.getUint8(e))if(n=l.getUint8(e+1),hi(n)){if(r=l.getUint16(e+2),i=pi(l,e,r),i&&u.has(i)&&(a=Nr.get(i),o=a.findPosition(l,e),s=h[i],o.type=i,this.appSegments.push(o),!c&&(a.multiSegment&&s.multiSegment?(this.unfinishedMultiSegment=o.chunkNumber<o.chunkCount,this.unfinishedMultiSegment||d.delete(i)):d.delete(i),0===d.size)))break;h.recordUnknownSegments&&(o=ui.findPosition(l,e),o.marker=n,this.unknownSegments.push(o)),e+=r+1}else if(di(n)){if(r=l.getUint16(e+2),218===n&&!1!==h.stopAfterSos)return;h.recordJpegSegments&&this.jpegSegments.push({offset:e,length:r,marker:n}),e+=r+1}return e}mergeMultiSegments(){if(!this.appSegments.some(e=>e.multiSegment))return;let e=function(e){let t,n,r,i=new Map;for(let a=0;a<e.length;a++)t=e[a],n=t.type,i.has(n)?r=i.get(n):i.set(n,r=[]),r.push(t);return Array.from(i)}(this.appSegments);this.mergedAppSegments=e.map(([e,t])=>{let n=Nr.get(e,this.options);return n.handleMultiSegments?{type:e,chunk:n.handleMultiSegments(t)}:t[0]})}getSegment(e){return this.appSegments.find(t=>t.type===e)}async getOrFindSegment(e){let t=this.getSegment(e);return void 0===t&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}gr(fi,"type","jpeg"),Pr.set("jpeg",fi);const mi=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class gi extends ui{parseHeader(){var e=this.chunk.getUint16();18761===e?this.le=!0:19789===e&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,n=new Map){let{pick:r,skip:i}=this.options[t];r=new Set(r);let a=r.size>0,o=0===i.size,s=this.chunk.getUint16(e);e+=2;for(let l=0;l<s;l++){let s=this.chunk.getUint16(e);if(a){if(r.has(s)&&(n.set(s,this.parseTag(e,s,t)),r.delete(s),0===r.size))break}else!o&&i.has(s)||n.set(s,this.parseTag(e,s,t));e+=12}return n}parseTag(e,t,n){let{chunk:r}=this,i=r.getUint16(e+2),a=r.getUint32(e+4),o=mi[i];if(o*a<=4?e+=8:e=r.getUint32(e+8),(i<1||i>13)&&br(`Invalid TIFF value type. block: ${n.toUpperCase()}, tag: ${t.toString(16)}, type: ${i}, offset ${e}`),e>r.byteLength&&br(`Invalid TIFF value offset. block: ${n.toUpperCase()}, tag: ${t.toString(16)}, type: ${i}, offset ${e} is outside of chunk size ${r.byteLength}`),1===i)return r.getUint8Array(e,a);if(2===i)return xr(r.getString(e,a));if(7===i)return r.getUint8Array(e,a);if(1===a)return this.parseTagValue(i,e);{let t=new(function(e){switch(e){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:case 10:default:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 11:return Float32Array;case 12:return Float64Array}}(i))(a),n=o;for(let r=0;r<a;r++)t[r]=this.parseTagValue(i,e),e+=n;return t}}parseTagValue(e,t){let{chunk:n}=this;switch(e){case 1:return n.getUint8(t);case 3:return n.getUint16(t);case 4:case 13:return n.getUint32(t);case 5:return n.getUint32(t)/n.getUint32(t+4);case 6:return n.getInt8(t);case 8:return n.getInt16(t);case 9:return n.getInt32(t);case 10:return n.getInt32(t)/n.getInt32(t+4);case 11:return n.getFloat(t);case 12:return n.getDouble(t);default:br(`Invalid tiff type ${e}`)}}}class vi extends gi{static canHandle(e,t){return 225===e.getUint8(t+1)&&1165519206===e.getUint32(t+4)&&0===e.getUint16(t+8)}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return void 0!==t.catch&&(t=t.catch(this.handleError)),t}findIfd0Offset(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(void 0===this.ifd1Offset){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let n=new Map;return this[t]=n,this.parseTags(e,t,n),n}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&br("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&br(`IFD0 offset points to outside of file.\nthis.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,_r(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return 0!==t.size?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.exifOffset)return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,_r(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let n=e.get(t);n&&1===n.length&&e.set(t,n[0])}async parseGpsBlock(){if(this.gps)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.gpsOffset)return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",Ai(...e.get(2),e.get(1))),e.set("longitude",Ai(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),void 0!==this.interopOffset||this.exif||await this.parseExifBlock(),void 0!==this.interopOffset))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),void 0===this.ifd1)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,n,r={};for(t of $r)if(e=this[t],!yr(e))if(n=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if("ifd1"===t)continue;Object.assign(r,n)}else r[t]=n;return this.makerNote&&(r.makerNote=this.makerNote),this.userComment&&(r.userComment=this.userComment),r}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[n,r]of Object.entries(t))this.assignObjectToOutput(e,n,r)}}function Ai(e,t,n,r){var i=e+t/60+n/3600;return"S"!==r&&"W"!==r||(i*=-1),i}gr(vi,"type","tiff"),gr(vi,"headerLength",10),Nr.set("tiff",vi);var yi=Object.freeze({__proto__:null,default:li,Exifr:oi,fileParsers:Pr,segmentParsers:Nr,fileReaders:kr,tagKeys:Ur,tagValues:Vr,tagRevivers:Gr,createDictionary:Fr,extendDictionary:zr,fetchUrlAsArrayBuffer:Dr,readBlobAsArrayBuffer:Ir,chunkedProps:qr,otherSegments:Wr,segments:Hr,tiffBlocks:$r,segmentsAndBlocks:Kr,tiffExtractables:Xr,inheritables:Yr,allFormatters:Qr,Options:ni,parse:si});const bi={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},xi=Object.assign({},bi,{firstChunkSize:4e4,gps:[1,2,3,4]});async function _i(e){let t=new oi(xi);await t.read(e);let n=await t.parse();if(n&&n.gps){let{latitude:e,longitude:t}=n.gps;return{latitude:e,longitude:t}}}const wi=Object.assign({},bi,{tiff:!1,ifd1:!0,mergeOutput:!1});async function Si(e){let t=new oi(wi);await t.read(e);let n=await t.extractThumbnail();return n&&hr?ur.from(n):n}async function Ti(e){let t=await this.thumbnail(e);if(void 0!==t){let e=new Blob([t]);return URL.createObjectURL(e)}}const Ci=Object.assign({},bi,{firstChunkSize:4e4,ifd0:[274]});async function Mi(e){let t=new oi(Ci);await t.read(e);let n=await t.parse();if(n&&n.ifd0)return n.ifd0[274]}const Ei=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let Pi=!0,Ni=!0;if("object"==typeof navigator){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,e,n]=t,r=Number(e)+.1*Number(n);Pi=r<13.4,Ni=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);Pi=Ni=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);Pi=Ni=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);Pi=Ni=Number(t)<77}}async function ki(e){let t=await Mi(e);return Object.assign({canvas:Pi,css:Ni},Ei[t])}class Ri extends Cr{constructor(...e){super(...e),gr(this,"ranges",new Li),0!==this.byteLength&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,n){if(0===e&&0===this.byteLength&&n){let e=new DataView(n.buffer||n,n.byteOffset,n.byteLength);this._swapDataView(e)}else{let n=e+t;if(n>this.byteLength){let{dataView:e}=this._extend(n);this._swapDataView(e)}}}_extend(e){let t;t=hr?ur.allocUnsafe(e):new Uint8Array(e);let n=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:n}}subarray(e,t,n=!1){return t=t||this._lengthToEnd(e),n&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,n=!1){n&&this._tryExtend(t,e.byteLength,e);let r=super.set(e,t);return this.ranges.add(t,r.byteLength),r}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class Li{constructor(){gr(this,"list",[])}get length(){return this.list.length}add(e,t,n=0){let r=e+t,i=this.list.filter(t=>Oi(e,t.offset,r)||Oi(e,t.end,r));if(i.length>0){e=Math.min(e,...i.map(e=>e.offset)),r=Math.max(r,...i.map(e=>e.end)),t=r-e;let n=i.shift();n.offset=e,n.length=t,n.end=r,this.list=this.list.filter(e=>!i.includes(e))}else this.list.push({offset:e,length:t,end:r})}available(e,t){let n=e+t;return this.list.some(t=>t.offset<=e&&n<=t.end)}}function Oi(e,t,n){return e<=t&&t<=n}class ji extends Ri{constructor(e,t){super(0),gr(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,n=await this.readChunk(e,t);return!!n&&n.byteLength===t}async readChunk(e,t){if(this.chunksRead++,0!==(t=this.safeWrapAddress(e,t)))return this._readChunk(e,t)}safeWrapAddress(e,t){return void 0!==this.size&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return void 0!==this.size&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}kr.set("blob",class extends ji{async readWhole(){this.chunked=!1;let e=await Ir(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let n=t?e+t:void 0,r=this.input.slice(e,n),i=await Ir(r);return this.set(i,e,!0)}});var Di=Object.freeze({__proto__:null,default:yi,Exifr:oi,fileParsers:Pr,segmentParsers:Nr,fileReaders:kr,tagKeys:Ur,tagValues:Vr,tagRevivers:Gr,createDictionary:Fr,extendDictionary:zr,fetchUrlAsArrayBuffer:Dr,readBlobAsArrayBuffer:Ir,chunkedProps:qr,otherSegments:Wr,segments:Hr,tiffBlocks:$r,segmentsAndBlocks:Kr,tiffExtractables:Xr,inheritables:Yr,allFormatters:Qr,Options:ni,parse:si,gpsOnlyOptions:xi,gps:_i,thumbnailOnlyOptions:wi,thumbnail:Si,thumbnailUrl:Ti,orientationOnlyOptions:Ci,orientation:Mi,rotations:Ei,get rotateCanvas(){return Pi},get rotateCss(){return Ni},rotation:ki});kr.set("url",class extends ji{async readWhole(){this.chunked=!1;let e=await Dr(this.input);e instanceof ArrayBuffer?this._swapArrayBuffer(e):e instanceof Uint8Array&&this._swapBuffer(e)}async _readChunk(e,t){let n=t?e+t-1:void 0,r=this.options.httpHeaders||{};(e||n)&&(r.range=`bytes=${[e,n].join("-")}`);let i=await mr(this.input,{headers:r}),a=await i.arrayBuffer(),o=a.byteLength;if(416!==i.status)return o!==t&&(this.size=e+o),this.set(a,e,!0)}}),Cr.prototype.getUint64=function(e){let t=this.getUint32(e),n=this.getUint32(e+4);return t<1048575?t<<32|n:void 0!==typeof dr?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),dr(t)<<dr(32)|dr(n)):void br("Trying to read 64b value but JS can only handle 53b numbers.")};class Ii extends ci{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let n=this.parseBoxHead(e);if(t.push(n),0===n.length)break;e+=n.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return void 0===e.boxes&&this.parseSubBoxes(e),e.boxes.find(e=>e.kind===t)}parseBoxHead(e){let t=this.file.getUint32(e),n=this.file.getString(e+4,4),r=e+8;return 1===t&&(t=this.file.getUint64(e+8),r+=8),{offset:e,length:t,kind:n,start:r}}parseBoxFullHead(e){if(void 0!==e.version)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class Bi extends Ii{static canHandle(e,t){if(0!==t)return!1;let n=e.getUint16(2);if(n>50)return!1;let r=16,i=[];for(;r<n;)i.push(e.getString(r,4)),r+=4;return i.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;"meta"!==t.kind;)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,n){await this.file.ensureChunk(t,n);let r=this.file.subarray(t,n);this.createParser(e,r)}async findIcc(e){let t=this.findBox(e,"iprp");if(void 0===t)return;let n=this.findBox(t,"ipco");if(void 0===n)return;let r=this.findBox(n,"colr");void 0!==r&&await this.registerSegment("icc",r.offset+12,r.length)}async findExif(e){let t=this.findBox(e,"iinf");if(void 0===t)return;let n=this.findBox(e,"iloc");if(void 0===n)return;let r=this.findExifLocIdInIinf(t),i=this.findExtentInIloc(n,r);if(void 0===i)return;let[a,o]=i;await this.file.ensureChunk(a,o);let s=4+this.file.getUint32(a);a+=s,o-=s,await this.registerSegment("tiff",a,o)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,n,r,i,a=e.start,o=this.file.getUint16(a);for(a+=2;o--;){if(t=this.parseBoxHead(a),this.parseBoxFullHead(t),n=t.start,t.version>=2&&(r=3===t.version?4:2,i=this.file.getString(n+r+2,4),"Exif"===i))return this.file.getUintBytes(n,r);a+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let n=e.start,[r,i]=this.get8bits(n++),[a,o]=this.get8bits(n++),s=2===e.version?4:2,l=1===e.version||2===e.version?2:0,c=o+r+i,u=2===e.version?4:2,d=this.file.getUintBytes(n,u);for(n+=u;d--;){let e=this.file.getUintBytes(n,s);n+=s+l+2+a;let u=this.file.getUint16(n);if(n+=2,e===t)return u>1&&console.warn("ILOC box has more than one extent but we're only processing one\nPlease create an issue at https://github.com/MikeKovarik/exifr with this file"),[this.file.getUintBytes(n+o,r),this.file.getUintBytes(n+o+r,i)];n+=u*c}}}class Fi extends Bi{}gr(Fi,"type","heic");class zi extends Bi{}gr(zi,"type","avif"),Pr.set("heic",Fi),Pr.set("avif",zi),Fr(Ur,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),Fr(Ur,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),Fr(Ur,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),Fr(Vr,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Ui=Fr(Vr,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Vi={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Ui.set(37392,Vi),Ui.set(41488,Vi);const Gi={0:"Normal",1:"Low",2:"High"};function qi(e){return"object"==typeof e&&void 0!==e.length?e[0]:e}function Wi(e){let t=Array.from(e).slice(1);return t[1]>15&&(t=t.map(e=>String.fromCharCode(e))),"0"!==t[2]&&0!==t[2]||t.pop(),t.join(".")}function Hi(e){if("string"==typeof e){var[t,n,r,i,a,o]=e.trim().split(/[-: ]/g).map(Number),s=new Date(t,n-1,r);return Number.isNaN(i)||Number.isNaN(a)||Number.isNaN(o)||(s.setHours(i),s.setMinutes(a),s.setSeconds(o)),Number.isNaN(+s)?e:s}}function $i(e){if("string"==typeof e)return e;let t=[];if(0===e[1]&&0===e[e.length-1])for(let n=0;n<e.length;n+=2)t.push(Ki(e[n+1],e[n]));else for(let n=0;n<e.length;n+=2)t.push(Ki(e[n],e[n+1]));return xr(String.fromCodePoint(...t))}function Ki(e,t){return e<<8|t}Ui.set(41992,Gi),Ui.set(41993,Gi),Ui.set(41994,Gi),Fr(Gr,["ifd0","ifd1"],[[50827,function(e){return"string"!=typeof e?Tr(e):e}],[306,Hi],[40091,$i],[40092,$i],[40093,$i],[40094,$i],[40095,$i]]),Fr(Gr,"exif",[[40960,Wi],[36864,Wi],[36867,Hi],[36868,Hi],[40962,qi],[40963,qi]]),Fr(Gr,"gps",[[0,e=>Array.from(e).join(".")],[7,e=>Array.from(e).join(":")]]);class Xi extends ui{static canHandle(e,t){return 225===e.getUint8(t+1)&&1752462448===e.getUint32(t+4)&&"http://ns.adobe.com/"===e.getString(t+4,20)}static headerLength(e,t){return"http://ns.adobe.com/xmp/extension/"===e.getString(t+4,34)?79:33}static findPosition(e,t){let n=super.findPosition(e,t);return n.multiSegment=n.extended=79===n.headerLength,n.multiSegment?(n.chunkCount=e.getUint8(t+72),n.chunkNumber=e.getUint8(t+76),0!==e.getUint8(t+77)&&n.chunkNumber++):(n.chunkCount=1/0,n.chunkNumber=-1),n}static handleMultiSegments(e){return e.map(e=>e.chunk.getString()).join("")}normalizeInput(e){return"string"==typeof e?e:Cr.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=function(e){let t={},n={};for(let r of ia)t[r]=[],n[r]=0;return e.replace(aa,(e,r,i)=>{if("<"===r){let r=++n[i];return t[i].push(r),`${e}#${r}`}return`${e}#${t[i].pop()}`})}(e);let t=Qi.findAll(e,"rdf","Description");0===t.length&&t.push(new Qi("rdf","Description",void 0,e));let n,r={};for(let i of t)for(let e of i.properties)n=ta(e.ns,r),Zi(e,n);return function(e){let t;for(let n in e)t=e[n]=vr(e[n]),void 0===t&&delete e[n];return vr(e)}(r)}assignToOutput(e,t){if(this.localOptions.parse)for(let[n,r]of Object.entries(t))switch(n){case"tiff":this.assignObjectToOutput(e,"ifd0",r);break;case"exif":this.assignObjectToOutput(e,"exif",r);break;case"xmlns":break;default:this.assignObjectToOutput(e,n,r)}else e.xmp=t}}gr(Xi,"type","xmp"),gr(Xi,"multiSegment",!0),Nr.set("xmp",Xi);class Yi{static findAll(e){return na(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Yi.unpackMatch)}static unpackMatch(e){let t=e[1],n=e[2],r=e[3].slice(1,-1);return r=ra(r),new Yi(t,n,r)}constructor(e,t,n){this.ns=e,this.name=t,this.value=n}serialize(){return this.value}}class Qi{static findAll(e,t,n){if(void 0!==t||void 0!==n){t=t||"[\\w\\d-]+",n=n||"[\\w\\d-]+";var r=new RegExp(`<(${t}):(${n})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else r=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return na(e,r).map(Qi.unpackMatch)}static unpackMatch(e){let t=e[1],n=e[2],r=e[4],i=e[8];return new Qi(t,n,r,i)}constructor(e,t,n,r){this.ns=e,this.name=t,this.attrString=n,this.innerXml=r,this.attrs=Yi.findAll(n),this.children=Qi.findAll(r),this.value=0===this.children.length?ra(r):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return void 0!==this.value&&0===this.attrs.length&&0===this.children.length}get isListContainer(){return 1===this.children.length&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return"rdf"===e&&("Seq"===t||"Bag"===t||"Alt"===t)}get isListItem(){return"rdf"===this.ns&&"li"===this.name}serialize(){if(0===this.properties.length&&void 0===this.value)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return ea(this.children.map(Ji));if(this.isListItem&&1===this.children.length&&0===this.attrs.length)return this.children[0].serialize();let e={};for(let t of this.properties)Zi(t,e);return void 0!==this.value&&(e.value=this.value),vr(e)}}function Zi(e,t){let n=e.serialize();void 0!==n&&(t[e.name]=n)}var Ji=e=>e.serialize(),ea=e=>1===e.length?e[0]:e,ta=(e,t)=>t[e]?t[e]:t[e]={};function na(e,t){let n,r=[];if(!e)return r;for(;null!==(n=t.exec(e));)r.push(n);return r}function ra(e){if(function(e){return null==e||"null"===e||"undefined"===e||""===e||""===e.trim()}(e))return;let t=Number(e);if(!Number.isNaN(t))return t;let n=e.toLowerCase();return"true"===n||"false"!==n&&e.trim()}const ia=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],aa=new RegExp(`(<|\\/)(${ia.join("|")})`,"g");var oa=Object.freeze({__proto__:null,default:Di,Exifr:oi,fileParsers:Pr,segmentParsers:Nr,fileReaders:kr,tagKeys:Ur,tagValues:Vr,tagRevivers:Gr,createDictionary:Fr,extendDictionary:zr,fetchUrlAsArrayBuffer:Dr,readBlobAsArrayBuffer:Ir,chunkedProps:qr,otherSegments:Wr,segments:Hr,tiffBlocks:$r,segmentsAndBlocks:Kr,tiffExtractables:Xr,inheritables:Yr,allFormatters:Qr,Options:ni,parse:si,gpsOnlyOptions:xi,gps:_i,thumbnailOnlyOptions:wi,thumbnail:Si,thumbnailUrl:Ti,orientationOnlyOptions:Ci,orientation:Mi,rotations:Ei,get rotateCanvas(){return Pi},get rotateCss(){return Ni},rotation:ki});let sa=fr("fs",e=>e.promises);kr.set("fs",class extends ji{async readWhole(){this.chunked=!1,this.fs=await sa;let e=await this.fs.readFile(this.input);this._swapBuffer(e)}async readChunked(){this.chunked=!0,this.fs=await sa,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){void 0===this.fh&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(e,t){void 0===this.fh&&await this.open(),e+t>this.size&&(t=this.size-e);var n=this.subarray(e,t,!0);return await this.fh.read(n.dataView,0,t,e),n}async close(){if(this.fh){let e=this.fh;this.fh=void 0,await e.close()}}}),kr.set("base64",class extends ji{constructor(...e){super(...e),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(e,t){let n,r,i=this.input;void 0===e?(e=0,n=0,r=0):(n=4*Math.floor(e/3),r=e-n/4*3),void 0===t&&(t=this.size);let a=e+t,o=n+4*Math.ceil(a/3);i=i.slice(n,o);let s=Math.min(t,this.size-e);if(hr){let t=ur.from(i,"base64").slice(r,r+s);return this.set(t,e,!0)}{let t=this.subarray(e,s,!0),n=atob(i),a=t.toUint8();for(let e=0;e<s;e++)a[e]=n.charCodeAt(r+e);return t}}});class la extends ci{static canHandle(e,t){return 18761===t||19789===t}extendOptions(e){let{ifd0:t,xmp:n,iptc:r,icc:i}=e;n.enabled&&t.deps.add(700),r.enabled&&t.deps.add(33723),i.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:n,icc:r}=this.options;if(e.enabled||t.enabled||n.enabled||r.enabled){let e=Math.max(_r(this.options),this.options.chunkSize);await this.file.ensureChunk(0,e),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}gr(la,"type","tiff"),Pr.set("tiff",la);let ca=fr("zlib");const ua=["ihdr","iccp","text","itxt","exif"];class da extends ci{constructor(...e){super(...e),gr(this,"catchError",e=>this.errors.push(e)),gr(this,"metaChunks",[]),gr(this,"unknownChunks",[])}static canHandle(e,t){return 35152===t&&2303741511===e.getUint32(0)&&218765834===e.getUint32(4)}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:n}=this;for(;e<t;){let t=n.getUint32(e),r=n.getUint32(e+4),i=n.getString(e+4,4).toLowerCase(),a=t+4+4+4,o={type:i,offset:e,length:a,start:e+4+4,size:t,marker:r};ua.includes(i)?this.metaChunks.push(o):this.unknownChunks.push(o),e+=a}}parseTextChunks(){let e=this.metaChunks.filter(e=>"text"===e.type);for(let t of e){let[e,n]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(e,n)}}injectKeyValToIhdr(e,t){let n=this.parsers.ihdr;n&&n.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find(e=>"ihdr"===e.type);e&&!1!==this.options.ihdr.enabled&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find(e=>"exif"===e.type);e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter(e=>"itxt"===e.type);for(let t of e)"XML:com.adobe.xmp"===t.chunk.getString(0,17)&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find(e=>"iccp"===e.type);if(!e)return;let{chunk:t}=e,n=t.getUint8Array(0,81),r=0;for(;r<80&&0!==n[r];)r++;let i=r+2,a=t.getString(0,r);if(this.injectKeyValToIhdr("ProfileName",a),cr){let e=await ca,n=t.getUint8Array(i);n=e.inflateSync(n),this.injectSegment("icc",n)}}}gr(da,"type","png"),Pr.set("png",da),Fr(Ur,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),zr(Ur,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let ha=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];zr(Ur,"ifd0",ha),zr(Ur,"exif",ha),Fr(Vr,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class pa extends ui{static canHandle(e,t){return 224===e.getUint8(t+1)&&1246120262===e.getUint32(t+4)&&0===e.getUint8(t+8)}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}gr(pa,"type","jfif"),gr(pa,"headerLength",9),Nr.set("jfif",pa),Fr(Ur,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class fa extends ui{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}gr(fa,"type","ihdr"),Nr.set("ihdr",fa),Fr(Ur,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),Fr(Vr,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class ma extends ui{static canHandle(e,t){return 226===e.getUint8(t+1)&&1229144927===e.getUint32(t+4)}static findPosition(e,t){let n=super.findPosition(e,t);return n.chunkNumber=e.getUint8(t+16),n.chunkCount=e.getUint8(t+17),n.multiSegment=n.chunkCount>1,n}static handleMultiSegments(e){return function(e){let t=function(e){let t=e[0].constructor,n=0;for(let a of e)n+=a.length;let r=new t(n),i=0;for(let a of e)r.set(a,i),i+=a.length;return r}(e.map(e=>e.chunk.toUint8()));return new Cr(t)}(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&br("ICC header is too short");for(let[t,n]of Object.entries(ga)){t=parseInt(t,10);let r=n(this.chunk,t);"\0\0\0\0"!==r&&e.set(t,r)}}parseTags(){let e,t,n,r,i,{raw:a}=this,o=this.chunk.getUint32(128),s=132,l=this.chunk.byteLength;for(;o--;){if(e=this.chunk.getString(s,4),t=this.chunk.getUint32(s+4),n=this.chunk.getUint32(s+8),r=this.chunk.getString(t,4),t+n>l)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");i=this.parseTag(r,t,n),void 0!==i&&"\0\0\0\0"!==i&&a.set(e,i),s+=12}}parseTag(e,t,n){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,n);case"sig ":return this.parseSig(t)}if(!(t+n>this.chunk.byteLength))return this.chunk.getUint8Array(t,n)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return xr(this.chunk.getString(e+12,t))}parseText(e,t){return xr(this.chunk.getString(e+8,t-8))}parseSig(e){return xr(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,n=t.getUint32(e+8),r=t.getUint32(e+12),i=e+16,a=[];for(let o=0;o<n;o++){let n=t.getString(i+0,2),o=t.getString(i+2,2),s=t.getUint32(i+4),l=t.getUint32(i+8)+e,c=xr(t.getUnicodeString(l,s));a.push({lang:n,country:o,text:c}),i+=r}return 1===n?a[0].text:a}translateValue(e,t){return"string"==typeof e?t[e]||t[e.toLowerCase()]||e:t[e]||e}}gr(ma,"type","icc"),gr(ma,"multiSegment",!0),gr(ma,"headerLength",18);const ga={4:va,8:function(e,t){return[e.getUint8(t),e.getUint8(t+1)>>4,e.getUint8(t+1)%16].map(e=>e.toString(10)).join(".")},12:va,16:va,20:va,24:function(e,t){const n=e.getUint16(t),r=e.getUint16(t+2)-1,i=e.getUint16(t+4),a=e.getUint16(t+6),o=e.getUint16(t+8),s=e.getUint16(t+10);return new Date(Date.UTC(n,r,i,a,o,s))},36:va,40:va,48:va,52:va,64:(e,t)=>e.getUint32(t),80:va};function va(e,t){return xr(e.getString(t,4))}Nr.set("icc",ma),Fr(Ur,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const Aa={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},ya={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};Fr(Vr,"icc",[[4,Aa],[12,ya],[40,Object.assign({},Aa,ya)],[48,Aa],[80,Aa],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class ba extends ui{static canHandle(e,t,n){return 237===e.getUint8(t+1)&&"Photoshop"===e.getString(t+4,9)&&void 0!==this.containsIptc8bim(e,t,n)}static headerLength(e,t,n){let r,i=this.containsIptc8bim(e,t,n);if(void 0!==i)return r=e.getUint8(t+i+7),r%2!=0&&(r+=1),0===r&&(r=4),i+8+r}static containsIptc8bim(e,t,n){for(let r=0;r<n;r++)if(this.isIptcSegmentHead(e,t+r))return r}static isIptcSegmentHead(e,t){return 56===e.getUint8(t)&&943868237===e.getUint32(t)&&1028===e.getUint16(t+4)}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,n=!1;for(let r=0;r<t;r++)if(28===this.chunk.getUint8(r)&&2===this.chunk.getUint8(r+1)){n=!0;let t=this.chunk.getUint16(r+3),i=this.chunk.getUint8(r+2),a=this.chunk.getLatin1String(r+5,t);e.set(i,this.pluralizeValue(e.get(i),a)),r+=4+t}else if(n)break;return this.translate(),this.output}pluralizeValue(e,t){return void 0!==e?e instanceof Array?(e.push(t),e):[e,t]:t}}gr(ba,"type","iptc"),gr(ba,"translateValues",!1),gr(ba,"reviveValues",!1),Nr.set("iptc",ba),Fr(Ur,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),Fr(Vr,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);var xa=oa,_a=n(4895);const wa=[".tif",".tiff"],Sa=e=>{if(!e)return!1;const t="."+e.split(".").pop().toLowerCase();return wa.includes(t)};function Ta(e){const[t,n]=(0,r.useState)([]);return(0,r.useEffect)(()=>{let t=!0;const r=[];return(async()=>{if(!e||0===e.length)return void(t&&n([]));const i=e.map(async e=>{try{const t=await async function(e){if(!e)return null;if((0,_a.isRawFile)(e.name)||Sa(e.name))try{const t=await xa.thumbnailUrl(e,{thumbnail:!0,firstChunkSize:1048576});if(t)return t}catch(t){console.warn("[PreviewUtils] Failed to extract thumbnail for",e.name,t)}return(0,_a.isRawFile)(e.name)||Sa(e.name)?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+CiAgPHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNlMGUwZTAiIC8+CiAgPHRleHQgeD0iNTAiIHk9IjUwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmaWxsPSIjNzU3NTc1Ij5SQVc8L3RleHQ+Cjwvc3ZnPg==":URL.createObjectURL(e)}(e);return{url:t,name:e.name}}catch(or){return console.error("Preview error",or),{url:null,name:e.name}}}),a=await Promise.all(i);t?(n(a),a.forEach(e=>{e.url&&e.url.startsWith("blob:")&&r.push(e.url)})):a.forEach(e=>{e.url&&e.url.startsWith("blob:")&&URL.revokeObjectURL(e.url)})})(),()=>{t=!1,r.forEach(e=>URL.revokeObjectURL(e))}},[e]),t}var Ca=n(7950);function Ma({onClose:e,onSave:t,files:n=[],shotLogs:i=[],initialAssignments:a=null}){var o;const s=(0,r.useMemo)(()=>[...n].sort((e,t)=>e.name.localeCompare(t.name)),[n]),l=(0,r.useMemo)(()=>{const e=[200,150,40,280,340,80,20,180,120,320];return i.map((t,n)=>`hsl(${e[n%e.length]}, 70%, 85%)`)},[i]),[c,u]=(0,r.useState)(()=>{if(a&&Object.keys(a).length>0)return{...a};const e={};let t=0;return i.forEach((n,r)=>{const i=Number(n.count||n.shots||0)||1;for(let a=0;a<i&&t<s.length;a++)e[s[t].name]=r,t++}),e}),[d,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),m=(0,r.useMemo)(()=>{const e=i.map(()=>0);return Object.values(c).forEach(t=>{null!==t&&void 0!==t&&e[t]++}),e},[c,i]),g=(0,r.useCallback)(e=>{if(null===d)return;const t=i[d],n=Number(t.count||t.shots||0)||1,r=m[d];c[e]===d?u(t=>{const n={...t};return delete n[e],n}):(r<n||void 0!==c[e])&&u(t=>({...t,[e]:d}))},[d,i,m,c]),v=(0,r.useCallback)((e,t)=>{if(e.preventDefault(),null===p)return;const n=i[p],r=Number(n.count||n.shots||0)||1;(m[p]<r||void 0!==c[t])&&u(e=>({...e,[t]:p})),f(null)},[p,i,m,c]),A=(0,r.useCallback)(()=>{const e={};let t=0;i.forEach((n,r)=>{const i=Number(n.count||n.shots||0)||1;for(let a=0;a<i&&t<s.length;a++)e[s[t].name]=r,t++}),u(e)},[i,s]),y=(0,r.useCallback)(()=>{const e={};let t=0;[...i].reverse().forEach((n,r)=>{const a=i.length-1-r,o=Number(n.count||n.shots||0)||1;for(let i=0;i<o&&t<s.length;i++)e[s[t].name]=a,t++}),u(e)},[i,s]),b=(0,r.useCallback)(()=>{u({}),h(null)},[]),x=(0,r.useCallback)(()=>{const n={};Object.entries(c).forEach(([e,t])=>{if(null!==t&&void 0!==t&&i[t]){const r=i[t];n[e]={date:r.date||"",lens:r.lens||"",aperture:r.aperture,shutter_speed:r.shutter_speed||"",country:r.country||"",city:r.city||"",detail_location:r.detail_location||"",latitude:r.latitude,longitude:r.longitude,caption:r.caption||"",logIndex:t}}}),t(n),e()},[c,i,t,e]),_=Object.keys(c).length,w=s.length;return Ca.createPortal((0,gt.jsx)("div",{style:Ea.overlay,children:(0,gt.jsxs)("div",{style:Ea.modal,children:[(0,gt.jsxs)("div",{style:Ea.header,children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h3",{style:{margin:0},children:"Map Shot Logs to Files"}),(0,gt.jsx)("div",{style:{fontSize:12,color:"#666",marginTop:4},children:null!==d?`Click files to assign: ${(null===(o=i[d])||void 0===o?void 0:o.date)||"Selected log"}`:"Select a log on the right, then click files to assign"})]}),(0,gt.jsxs)("div",{style:Ea.controls,children:[(0,gt.jsxs)("span",{style:{fontSize:13,color:"#666",marginRight:10},children:[_,"/",w," files mapped"]}),(0,gt.jsx)("button",{type:"button",onClick:A,style:Ea.btn,children:"\u987a\u5e8f"}),(0,gt.jsx)("button",{type:"button",onClick:y,style:Ea.btn,children:"\u9006\u5e8f"}),(0,gt.jsx)("button",{type:"button",onClick:b,style:Ea.btn,children:"\u6e05\u9664"}),(0,gt.jsx)("div",{style:Ea.spacer}),(0,gt.jsx)("button",{type:"button",onClick:e,style:Ea.btnSecondary,children:"Cancel"}),(0,gt.jsx)("button",{type:"button",onClick:x,style:Ea.btnPrimary,children:"Save"})]})]}),(0,gt.jsxs)("div",{style:Ea.body,children:[(0,gt.jsxs)("div",{style:Ea.leftPanel,children:[(0,gt.jsxs)("div",{style:Ea.panelHeader,children:["Files (",s.length,")"]}),(0,gt.jsx)("div",{style:Ea.fileList,children:s.map((e,t)=>{var n,r;const a=c[e.name],o=void 0!==a,s=o?l[a]:"#fff";return(0,gt.jsxs)("div",{onClick:()=>g(e.name),onDragOver:e=>e.preventDefault(),onDrop:t=>v(t,e.name),style:{...Ea.fileItem,backgroundColor:s,border:null!==d?"2px dashed #0369a1":"1px solid #ddd",cursor:null!==d?"pointer":"default"},children:[(0,gt.jsx)("span",{style:Ea.fileIndex,children:t+1}),e.preview?(0,gt.jsx)("img",{src:e.preview,alt:"",style:Ea.thumb}):(0,gt.jsx)("div",{style:Ea.thumbPlaceholder,children:"IMG"}),(0,gt.jsxs)("div",{style:Ea.fileInfo,children:[(0,gt.jsx)("div",{style:Ea.fileName,children:e.name}),o&&(0,gt.jsxs)("div",{style:Ea.fileAssignment,children:[(null===(n=i[a])||void 0===n?void 0:n.date)||`Log ${a+1}`,(null===(r=i[a])||void 0===r?void 0:r.lens)&&` \xb7 ${i[a].lens}`]})]}),o&&(0,gt.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),u(t=>{const n={...t};return delete n[e.name],n})},style:Ea.clearBtn,title:"Remove assignment",children:"\xd7"})]},e.name)})})]}),(0,gt.jsxs)("div",{style:Ea.rightPanel,children:[(0,gt.jsxs)("div",{style:Ea.panelHeader,children:["Shot Logs (",i.length,")"]}),(0,gt.jsx)("div",{style:Ea.logList,children:i.map((e,t)=>{const n=Number(e.count||e.shots||0)||1,r=m[t],i=d===t,a=r>=n;return(0,gt.jsxs)("div",{draggable:!0,onDragStart:()=>f(t),onDragEnd:()=>f(null),onClick:()=>h(i?null:t),style:{...Ea.logItem,backgroundColor:l[t],border:i?"3px solid #0369a1":"1px solid #999",opacity:a&&!i?.6:1,cursor:"pointer"},children:[(0,gt.jsxs)("div",{style:Ea.logHeader,children:[(0,gt.jsx)("span",{style:Ea.logDate,children:e.date||"No date"}),(0,gt.jsxs)("span",{style:Ea.logCount,children:[r,"/",n]})]}),(0,gt.jsxs)("div",{style:Ea.logDetails,children:[e.lens&&(0,gt.jsx)("span",{children:e.lens}),e.aperture&&(0,gt.jsxs)("span",{children:[" f/",e.aperture]}),e.shutter_speed&&(0,gt.jsxs)("span",{children:[" ",e.shutter_speed]})]}),(0,gt.jsx)("div",{style:Ea.logLocation,children:[e.city,e.detail_location].filter(Boolean).join(" \xb7 ")||"\u2014"}),e.caption&&(0,gt.jsxs)("div",{style:Ea.logCaption,children:["\ud83d\udcac ",e.caption]}),i&&(0,gt.jsx)("div",{style:Ea.selectedBadge,children:"SELECTED - Click files to assign"}),(0,gt.jsxs)("div",{style:Ea.quickActions,children:[(0,gt.jsx)("button",{type:"button",style:Ea.quickBtn,onClick:e=>{e.stopPropagation();const i=n-r;if(i<=0)return;const a=s.filter(e=>void 0===c[e.name]).slice(0,i);0!==a.length&&u(e=>{const n={...e};return a.forEach(e=>{n[e.name]=t}),n})},disabled:a,title:"Auto-fill remaining slots",children:"Auto-fill"}),(0,gt.jsx)("button",{type:"button",style:Ea.quickBtn,onClick:e=>{e.stopPropagation(),u(e=>{const n={...e};return Object.keys(n).forEach(e=>{n[e]===t&&delete n[e]}),n})},disabled:0===r,title:"Clear all assignments for this log",children:"Clear"})]})]},t)})})]})]})]})}),document.body)}const Ea={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.85)",zIndex:12e3,display:"flex",justifyContent:"center",alignItems:"center"},modal:{width:"95%",maxWidth:1400,height:"90%",backgroundColor:"#fff",borderRadius:8,display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 0 30px rgba(0,0,0,0.5)"},header:{padding:"15px 20px",borderBottom:"1px solid #ddd",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"#f5f5f5",flexShrink:0},controls:{display:"flex",alignItems:"center",gap:8},body:{flex:1,display:"flex",overflow:"hidden"},leftPanel:{flex:2,display:"flex",flexDirection:"column",borderRight:"2px solid #ddd",overflow:"hidden"},rightPanel:{flex:1,minWidth:320,display:"flex",flexDirection:"column",overflow:"hidden"},panelHeader:{padding:"10px 15px",backgroundColor:"#e9ecef",fontWeight:600,fontSize:14,borderBottom:"1px solid #ddd",flexShrink:0},fileList:{flex:1,overflowY:"auto",padding:10},fileItem:{display:"flex",alignItems:"center",padding:"8px 10px",marginBottom:6,borderRadius:6,transition:"all 0.15s"},fileIndex:{width:28,fontWeight:600,color:"#666",fontSize:12},thumb:{width:40,height:40,objectFit:"cover",borderRadius:4,marginRight:10,backgroundColor:"#ddd"},thumbPlaceholder:{width:40,height:40,borderRadius:4,marginRight:10,backgroundColor:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#666"},fileInfo:{flex:1,minWidth:0},fileName:{fontSize:13,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fileAssignment:{fontSize:11,color:"#0369a1",marginTop:2},clearBtn:{width:24,height:24,border:"none",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0.2)",color:"#fff",fontSize:16,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:8},logList:{flex:1,overflowY:"auto",padding:10},logItem:{padding:12,marginBottom:8,borderRadius:8,cursor:"move",transition:"all 0.15s"},logHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},logDate:{fontWeight:700,color:"#0369a1",fontSize:14},logCount:{fontSize:12,fontWeight:600,color:"#333",backgroundColor:"rgba(255,255,255,0.7)",padding:"2px 8px",borderRadius:10},logDetails:{fontSize:12,color:"#333",marginBottom:2},logLocation:{fontSize:11,color:"#555",fontStyle:"italic"},logCaption:{fontSize:11,color:"#6366f1",marginTop:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},selectedBadge:{marginTop:8,padding:"4px 8px",backgroundColor:"#0369a1",color:"#fff",fontSize:10,fontWeight:600,borderRadius:4,textAlign:"center"},quickActions:{display:"flex",gap:6,marginTop:8},quickBtn:{flex:1,padding:"4px 8px",fontSize:11,border:"1px solid rgba(0,0,0,0.2)",borderRadius:4,backgroundColor:"rgba(255,255,255,0.7)",cursor:"pointer"},btn:{padding:"6px 12px",cursor:"pointer",backgroundColor:"#fff",border:"1px solid #ccc",borderRadius:4,fontSize:13},btnPrimary:{padding:"6px 16px",cursor:"pointer",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:4,fontWeight:600,fontSize:13},btnSecondary:{padding:"6px 12px",cursor:"pointer",backgroundColor:"#6c757d",color:"#fff",border:"none",borderRadius:4,fontSize:13},spacer:{width:16}};function Pa({onCreated:e}){const t=ie(),[n,i]=(0,r.useState)(""),[a,o]=(0,r.useState)(""),[s,l]=(0,r.useState)(""),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[m,g]=(0,r.useState)(""),[v,A]=(0,r.useState)(null),[y,b]=(0,r.useState)(""),[x,_]=(0,r.useState)(""),[w,S]=(0,r.useState)("positive"),[T,C]=(0,r.useState)(!0),M="negative"===w,[E,P]=(0,r.useState)([]),N=Ta(E),[k,R]=(0,r.useState)(null),[L,O]=(0,r.useState)([]),[j,D]=(0,r.useState)(!1),[I,B]=(0,r.useState)({cameras:[],lenses:[],photographers:[]}),[F,z]=(0,r.useState)({isOpen:!1,title:"",message:""}),[U,V]=(0,r.useState)([]),[G,q]=(0,r.useState)({develop_lab:"",develop_process:"",develop_date:"",develop_cost:"",develop_note:""}),[W,H]=(0,r.useState)([]),[$,K]=(0,r.useState)(null),[X,Y]=(0,r.useState)(!1),[Q,Z]=(0,r.useState)([]),[J,ee]=(0,r.useState)({}),[te,ne]=(0,r.useState)({}),[re,ae]=(0,r.useState)(!1),[oe,se]=(0,r.useState)(!1),[le,ce]=(0,r.useState)(null),[ue,de]=(0,r.useState)(""),[he,pe]=(0,r.useState)(""),[fe,me]=(0,r.useState)(""),[ge,ve]=(0,r.useState)(""),[Ae,ye]=(0,r.useState)(""),[be,xe]=(0,r.useState)(""),_e=Q.reduce((e,t)=>e+(Number(t.count||t.shots||0)||0),0),we=(e,t)=>{z({isOpen:!0,type:"alert",title:e,message:t,onConfirm:()=>z(e=>({...e,isOpen:!1}))})};(0,r.useEffect)(()=>{(0,bn.ip)().then(e=>O(e||[])),(0,bn.ET)().then(e=>B(e||{cameras:[],lenses:[],photographers:[]})),(0,bn.t1)({status:"in_stock,loaded,shot,sent_to_lab"}).then(e=>{const t=e&&Array.isArray(e.items)?e.items:[];H(t)}).catch(()=>H([]))},[]),(0,r.useEffect)(()=>{if(t.state&&t.state.filmItemId&&(Y(!0),K(t.state.filmItemId),t.state.developInfo)){const e=t.state.developInfo;q(t=>({...t,develop_lab:e.develop_lab||"",develop_process:e.develop_process||"",develop_date:e.develop_date||"",develop_cost:e.develop_cost||"",develop_note:e.develop_note||""}))}},[t.state]),(0,r.useEffect)(()=>{if(X&&$&&W.length>0){const e=W.find(e=>e.id===$);if(e)if(e.loaded_date&&o(e.loaded_date),e.finished_date&&l(e.finished_date),e.shot_logs)try{const t=JSON.parse(e.shot_logs);Array.isArray(t)&&Z(t.sort((e,t)=>e.date.localeCompare(t.date)))}catch(or){console.error(or)}else Z([])}},[X,$,W]),(0,r.useEffect)(()=>{Q.length>0&&ae(!0)},[Q.length]),(0,r.useEffect)(()=>{re&&0===Object.keys(te).length&&E.length>0&&Q.length>0&&Se()},[re,Q,E]);const Se=()=>{if(!E.length||!Q.length)return;const e=[...E].sort((e,t)=>e.name.localeCompare(t.name)),t={},n={};let r=0;for(const i of Q){const a=Number(i.count||i.shots||0)||0,o=i.date||"",s=i.lens||"",l=Number.isFinite(i.focal_length)?i.focal_length:void 0!==i.focal_length&&null!==i.focal_length?Number(i.focal_length):null,c=Number.isFinite(i.aperture)?i.aperture:void 0!==i.aperture&&null!==i.aperture?Number(i.aperture):null,u=i.shutter_speed||"",d=i.country||"",h=i.city||"",p=i.detail_location||"",f=i.latitude,m=i.longitude,g=i.caption||"";for(let v=0;v<a&&!(r>=e.length);v++){const a=e[r].name;t[a]={date:o,lens:s,focal_length:l,country:d,city:h,detail_location:p,aperture:c,shutter_speed:u,latitude:f,longitude:m,caption:g,logIndex:Q.indexOf(i)},o&&(n[a]=o),r++}}ne(t),ee(n)};return(0,gt.jsxs)("form",{onSubmit:async function(t){t.preventDefault();try{if(a&&s&&new Date(a)>new Date(s))return void we("Invalid Date","Start date cannot be later than end date");const t={title:n,start_date:a||null,end_date:s||null,camera_equip_id:c||null,lens_equip_id:d||null,photographer:m,exposures:y,notes:x,default_location_id:U[0]?U[0].location_id:null,default_country:U[0]&&U[0].country_name||null,default_city:U[0]&&U[0].city_name||null,scanner_equip_id:le||null,scan_resolution:fe?Number(fe):null,scan_software:ge||null,scan_lab:ue||null,scan_date:he||null,scan_cost:Ae?Number(Ae):null,scan_notes:be||null},i=X&&$?{...t,film_item_id:$}:{...t,filmId:v},o={};new Set([...Object.keys(J),...Object.keys(te)]).forEach(e=>{const t=te[e]||{},n=t.date||J[e]||"",r=t.lens||"",i=t.focal_length,a=t.country||"",s=t.city||"",l=t.detail_location||"",c=t.aperture,u=t.shutter_speed,d=t.latitude,h=t.longitude,p=t.caption||"";(n||r||Number.isFinite(i)||a||s||l||Number.isFinite(c)||u||Number.isFinite(d)||Number.isFinite(h)||p)&&(o[e]={...n?{date:n}:{},...r?{lens:r}:{},...Number.isFinite(i)?{focal_length:i}:{},...Number.isFinite(c)?{aperture:c}:{},...u?{shutter_speed:u}:{},...a?{country:a}:{},...s?{city:s}:{},...l?{detail_location:l}:{},...Number.isFinite(d)?{latitude:d}:{},...Number.isFinite(h)?{longitude:h}:{},...p?{caption:p}:{}})}),Object.keys(o).length>0&&(i.fileMetadata=JSON.stringify(o));const l=await(0,bn.wP)({fields:i,files:E,useTwoStep:j,isNegative:M,uploadType:w,isOriginal:T,onProgress:e=>R(e)});if(R(null),l&&l.ok){P([]);try{await(0,bn.Zt)(l.roll.id,{locations:U.map(e=>e.location_id),...G}),we("Success","Roll created and fields saved")}catch(r){we("Warning","Roll created but additional fields failed to save: "+(r.message||r))}e&&e(l.roll)}else{const e=l&&l.error?l.error:"Unknown error",t=l&&l.details?JSON.stringify(l.details,null,2):"";console.error("Roll creation failed:",{error:e,details:t,response:l}),we("Error","Create roll failed: "+e+(t?"\n\nDetails: "+t:""))}}catch(r){R(null),console.error("Upload error:",r),console.error("Error stack:",r.stack);let e=r.message||String(r);e.includes("timeout")||e.includes("timed out")?e="\u4e0a\u4f20\u8d85\u65f6\u3002\u8bf7\u68c0\u67e5\uff1a\n1. TIF\u6587\u4ef6\u662f\u5426\u8fc7\u5927\uff08\u5efa\u8bae<100MB\uff09\n2. OneDrive\u662f\u5426\u6b63\u5728\u540c\u6b65\uff08\u53ef\u6682\u505c\u540c\u6b65\u540e\u91cd\u8bd5\uff09\n3. \u7f51\u7edc\u8fde\u63a5\u662f\u5426\u7a33\u5b9a":e.includes("EBUSY")||e.includes("EPERM")||e.includes("locked")?e="\u6587\u4ef6\u88ab\u5360\u7528\uff0c\u65e0\u6cd5\u4e0a\u4f20\u3002\u53ef\u80fd\u539f\u56e0\uff1a\n1. OneDrive\u6b63\u5728\u540c\u6b65\u8be5\u6587\u4ef6\u5939\n2. \u5176\u4ed6\u7a0b\u5e8f\u6b63\u5728\u8bbf\u95ee\u6587\u4ef6\n\n\u5efa\u8bae\uff1a\u6682\u505cOneDrive\u540c\u6b65\uff0c\u7a0d\u540e\u91cd\u8bd5":e.includes("Failed to process")||e.includes("Sharp")?e="\u56fe\u7247\u5904\u7406\u5931\u8d25\u3002\u53ef\u80fd\u539f\u56e0\uff1a\n1. TIF\u6587\u4ef6\u635f\u574f\u6216\u683c\u5f0f\u4e0d\u652f\u6301\n2. \u6587\u4ef6\u8fc7\u5927\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3\n\n\u5efa\u8bae\uff1a\u5c1d\u8bd5\u8f83\u5c0f\u7684\u6587\u4ef6\u6216\u8f6c\u6362\u4e3aJPEG\u683c\u5f0f":e.includes("OneDrive")&&(e="OneDrive\u540c\u6b65\u51b2\u7a81\u3002\u5efa\u8bae\uff1a\n1. \u6682\u505cOneDrive\u540c\u6b65\n2. \u7a0d\u7b49\u7247\u523b\u540e\u91cd\u8bd5\n3. \u6216\u5c06\u6587\u4ef6\u79fb\u52a8\u5230\u975eOneDrive\u76ee\u5f55"),we("\u4e0a\u4f20\u9519\u8bef",e)}},className:"fg-card",style:{maxWidth:720,margin:"0 auto",display:"flex",flexDirection:"column",gap:28},children:[(0,gt.jsx)(ir.A,{isOpen:F.isOpen,type:F.type,title:F.title,message:F.message,onConfirm:F.onConfirm}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Basic Info"}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Title"}),(0,gt.jsx)("input",{className:"fg-input",value:n,onChange:e=>i(e.target.value),placeholder:"Roll title"})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Film Source"}),(0,gt.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,gt.jsx)("input",{type:"radio",checked:!X,onChange:()=>{Y(!1),K(null)}}),(0,gt.jsx)("span",{children:"Manual film selection"})]}),(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,gt.jsx)("input",{type:"radio",checked:X,onChange:()=>Y(!0)}),(0,gt.jsx)("span",{children:"From inventory (FilmItem)"})]})]})]}),!X&&(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Film"}),(0,gt.jsx)(rr,{films:L,value:v,onChange:A})]}),X&&(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Inventory Item"}),(0,gt.jsxs)("select",{className:"fg-select",value:$||"",onChange:e=>K(e.target.value?Number(e.target.value):null),children:[(0,gt.jsx)("option",{value:"",children:"Select from in-stock / loaded"}),W.map(e=>{const t=L.find(t=>t.id===e.film_id),n=[t?t.name:`Film #${e.film_id}`,e.batch_number,e.expiry_date].filter(Boolean).join(" \u2022 ");return(0,gt.jsx)("option",{value:e.id,children:n||`Item #${e.id}`},e.id)})]}),(0,gt.jsx)("div",{style:{fontSize:12,color:"var(--fg-muted)",marginTop:4},children:"Listing items with status: in_stock, loaded, shot, sent_to_lab, developed."}),$&&(()=>{const e=W.find(e=>e.id===$);if(!e)return null;const t=L.find(t=>t.id===e.film_id);return(0,gt.jsxs)("div",{className:"fg-card",style:{marginTop:12,padding:16,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,gt.jsx)("div",{style:{fontWeight:600,marginBottom:8},children:t?t.name:"Unknown Film"}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:13,color:"#475569"},children:[(0,gt.jsxs)("div",{children:["Status: ",(0,gt.jsx)("span",{className:"fg-pill",children:e.status})]}),(0,gt.jsxs)("div",{children:["Expiry: ",e.expiry_date||"\u2014"]}),(0,gt.jsxs)("div",{children:["Batch: ",e.batch_number||"\u2014"]}),(0,gt.jsxs)("div",{children:["Price: ",e.purchase_price?`\xa5${e.purchase_price}`:"\u2014"]}),(0,gt.jsxs)("div",{children:["Channel: ",e.purchase_channel||"\u2014"]}),(0,gt.jsxs)("div",{children:["Vendor: ",e.purchase_vendor||"\u2014"]})]}),(e.label||e.purchase_note)&&(0,gt.jsxs)("div",{style:{marginTop:8,fontSize:13,fontStyle:"italic",color:"#64748b"},children:['"',e.label||e.purchase_note,'"']})]})})()]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Start Date"}),(0,gt.jsx)("input",{className:"fg-input",type:"date",value:a,onChange:e=>o(e.target.value)})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"End Date"}),(0,gt.jsx)("input",{className:"fg-input",type:"date",value:s,onChange:e=>l(e.target.value)})]})]})]}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Gear & Photographer"}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Camera"}),(0,gt.jsx)(ar.A,{type:"camera",value:c,onChange:(e,t)=>{u(e),f(t),null!==t&&void 0!==t&&t.has_fixed_lens&&h(null)},placeholder:"Select camera..."})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Lens"}),null!==p&&void 0!==p&&p.has_fixed_lens?(0,gt.jsxs)("div",{className:"fg-input",style:{background:"#f5f5f5",cursor:"not-allowed",color:"#666"},children:["Fixed lens: ",p.fixed_lens_focal_length?`${p.fixed_lens_focal_length}mm`:"Built-in",p.fixed_lens_max_aperture?` f/${p.fixed_lens_max_aperture}`:""]}):(0,gt.jsx)(ar.A,{type:"lens",value:d,cameraId:c,onChange:e=>h(e),placeholder:"Select lens..."})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Photographer"}),(0,gt.jsx)("input",{className:"fg-input",list:"photographer-options",value:m,onChange:e=>g(e.target.value),placeholder:"Select or type..."}),(0,gt.jsx)("datalist",{id:"photographer-options",children:(I.photographers||[]).map((e,t)=>(0,gt.jsx)("option",{value:e},t))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Exposures"}),(0,gt.jsx)("input",{className:"fg-input",type:"number",value:y,onChange:e=>b(e.target.value),placeholder:"e.g. 36"})]})]})]}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Shooting Cities"}),(0,gt.jsx)(nr,{value:null,onChange:e=>{e&&e.location_id&&V(t=>t.some(t=>t.location_id===e.location_id)?t:[...t,e])}}),U.length>0&&(0,gt.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:U.map(e=>(0,gt.jsx)("span",{className:"fg-pill",children:e.city_name},e.location_id))})]}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Development Info"}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Lab"}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Lab name",value:G.develop_lab,onChange:e=>q(t=>({...t,develop_lab:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Develop Date"}),(0,gt.jsx)("input",{className:"fg-input",type:"date",value:G.develop_date,onChange:e=>q(t=>({...t,develop_date:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Process"}),(0,gt.jsxs)("select",{className:"fg-select",value:G.develop_process||"",onChange:e=>q(t=>({...t,develop_process:e.target.value})),children:[(0,gt.jsx)("option",{value:"",children:"Select process"}),["C-41","E-6","BW","ECN-2"].map(e=>(0,gt.jsx)("option",{value:e,children:e},e))]})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Custom Process"}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Or type custom",value:G.develop_process||"",onChange:e=>q(t=>({...t,develop_process:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Develop Cost"}),(0,gt.jsx)("input",{className:"fg-input",type:"number",step:"0.01",placeholder:"0.00",value:G.develop_cost,onChange:e=>q(t=>({...t,develop_cost:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Note"}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Short note",value:G.develop_note,onChange:e=>q(t=>({...t,develop_note:e.target.value}))})]})]})]}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Scanning Info"}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scanner"}),(0,gt.jsx)(ar.A,{type:"scanner",value:le,onChange:e=>ce(e),placeholder:"Select scanner..."})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scan Lab"}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"e.g. Film Lab, Home scan",value:ue,onChange:e=>de(e.target.value)})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scan Date"}),(0,gt.jsx)("input",{className:"fg-input",type:"date",value:he,onChange:e=>pe(e.target.value),lang:"en-US"})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Resolution (DPI)"}),(0,gt.jsx)("input",{className:"fg-input",type:"number",step:"1",placeholder:"e.g. 3200, 4800",value:fe,onChange:e=>me(e.target.value)})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scan Software"}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"e.g. VueScan, Epson Scan 2",value:ge,onChange:e=>ve(e.target.value)})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scan Cost"}),(0,gt.jsx)("input",{className:"fg-input",type:"number",step:"0.01",placeholder:"0.00",value:Ae,onChange:e=>ye(e.target.value)})]})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scan Notes"}),(0,gt.jsx)("textarea",{className:"fg-textarea",value:be,onChange:e=>xe(e.target.value),placeholder:"Scan parameters, issues, etc...",style:{minHeight:70,resize:"vertical"}})]})]}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Notes"}),(0,gt.jsx)("div",{className:"fg-field",children:(0,gt.jsx)("textarea",{className:"fg-textarea",value:x,onChange:e=>_(e.target.value),placeholder:"Additional notes about this roll...",style:{minHeight:90,resize:"vertical"}})})]}),(0,gt.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:14},children:[(0,gt.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"var(--fg-text)",paddingBottom:10,borderBottom:"2px solid var(--fg-border)"},children:"Photos"}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"110px 1fr",gap:16,alignItems:"start",fontSize:13,background:"#f8fafc",padding:16,borderRadius:8,border:"1px solid #e2e8f0"},children:[(0,gt.jsx)("span",{style:{fontWeight:600,color:"#334155",paddingTop:2},children:"Upload Type:"}),(0,gt.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,gt.jsxs)("div",{style:{display:"flex",gap:24},children:[(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"radio",name:"uploadType",value:"positive",checked:"positive"===w,onChange:e=>S(e.target.value),style:{accentColor:"#0ea5e9",width:16,height:16}}),(0,gt.jsx)("span",{style:{color:"#0f172a"},children:"\u6b63\u7247 (Positive)"})]}),(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"radio",name:"uploadType",value:"negative",checked:"negative"===w,onChange:e=>S(e.target.value),style:{accentColor:"#0ea5e9",width:16,height:16}}),(0,gt.jsx)("span",{style:{color:"#0f172a"},children:"\u8d1f\u7247 (Negative)"})]})]}),(0,gt.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:24,paddingLeft:2},children:[(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",userSelect:"none"},children:[(0,gt.jsx)("input",{type:"checkbox",checked:T,onChange:e=>C(e.target.checked),style:{width:15,height:15,accentColor:"#0ea5e9"}}),(0,gt.jsx)("span",{style:{color:"#334155"},children:"\u4e0a\u4f20\u539f\u59cb\u5e95\u7247 (Upload Original)"})]}),(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",userSelect:"none"},children:[(0,gt.jsx)("input",{type:"checkbox",checked:j,onChange:e=>D(e.target.checked),style:{width:15,height:15,accentColor:"#0ea5e9"}}),(0,gt.jsx)("span",{style:{color:"#334155"},children:"Two-step upload"})]})]}),(0,gt.jsx)("div",{style:{fontSize:12,color:"#64748b",lineHeight:1.4},children:T?"\u652f\u6301 RAW \u683c\u5f0f (CR2, NEF, ARW, DNG, FFF \u7b49)\u3001\u626b\u63cf\u4eea BMP/TIFF \u53ca\u9ad8\u4fdd\u771f JPG\u3002\u539f\u59cb\u5e95\u7247\u5c06\u88ab\u5b58\u6863\u7528\u4e8e FilmLab \u540e\u671f\u5904\u7406\u3002":"\u4ec5\u652f\u6301\u666e\u901a\u56fe\u50cf\u683c\u5f0f\u3002\u4e0d\u4fdd\u5b58\u539f\u59cb\u5e95\u7247\u5b58\u6863\u3002"})]})]}),(0,gt.jsx)("div",{className:"fg-field",children:(0,gt.jsx)("input",{type:"file",accept:T?"image/*,.dng,.cr2,.cr3,.arw,.nef,.nrw,.orf,.raf,.rw2,.pef,.srw,.x3f,.3fr,.fff,.iiq,.raw,.rwl,.dcr,.kdc,.mrw,.erf,.mef,.mos,.srf,.sr2,.bmp,.dib":"image/*",multiple:!0,onChange:function(e){const t=Array.from(e.target.files||[]);P(t)},style:{padding:"14px",border:"2px dashed var(--fg-border)",borderRadius:8,background:"#f9fafb",cursor:"pointer",fontSize:13,width:"100%",boxSizing:"border-box"}})}),N.length>0&&(0,gt.jsxs)(gt.Fragment,{children:[Q.length>0&&(0,gt.jsxs)("div",{style:{marginBottom:12,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd"},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,gt.jsxs)("div",{style:{fontSize:13,fontWeight:600,color:"#0369a1"},children:["Shot Logs Available: ",_e," shots recorded"]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",whiteSpace:"nowrap",fontSize:12},children:[(0,gt.jsx)("input",{type:"checkbox",checked:re,onChange:e=>{const t=e.target.checked;ae(t),t&&0===Object.keys(te).length&&Se()}}),(0,gt.jsx)("span",{children:"Apply shot log"})]}),(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-sm fg-btn-primary",onClick:()=>se(!0),children:"Map Shot Logs"})]})]}),(0,gt.jsx)("div",{style:{fontSize:11,color:"#0c4a6e",display:"flex",gap:8,flexWrap:"wrap"},children:Q.map((e,t)=>(0,gt.jsxs)("span",{style:{background:"#fff",padding:"2px 6px",borderRadius:4,border:"1px solid #e0f2fe"},children:[e.date,": ",e.count]},t))}),re&&(0,gt.jsxs)("div",{style:{marginTop:8,fontSize:12,color:"#0f172a"},children:["Mapped ",Object.keys(te).length," / ",E.length," files"]})]}),(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:10},children:N.map((e,t)=>{var n;return(0,gt.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:5,padding:6,border:"1px solid var(--fg-border)",borderRadius:6,background:"#fff",transition:"all 0.2s",overflow:"hidden"},children:[(0,gt.jsxs)("div",{style:{width:"100%",aspectRatio:"1",overflow:"hidden",borderRadius:4,background:"#f5f5f5",position:"relative"},children:[(0,gt.jsx)("img",{src:e.url,alt:e.name||e.originalName,loading:"lazy",decoding:"async",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}),J[e.name]&&(0,gt.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.6)",color:"#fff",fontSize:10,padding:"2px 4px",textAlign:"center"},children:J[e.name]}),re&&void 0!==(null===(n=te[e.name])||void 0===n?void 0:n.logIndex)&&(0,gt.jsxs)("div",{style:{position:"absolute",top:4,right:4,background:"rgba(14, 116, 144, 0.85)",color:"#fff",fontSize:9,padding:"1px 5px",borderRadius:8,fontWeight:600},children:["L",te[e.name].logIndex+1]})]}),(0,gt.jsx)("div",{style:{fontSize:10,color:"#666",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3},children:e.originalName||e.name}),te[e.name]&&(te[e.name].lens||te[e.name].city)&&(0,gt.jsx)("div",{style:{fontSize:9,color:"#0369a1",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"2px 0"},children:[te[e.name].lens,te[e.name].aperture?`f/${te[e.name].aperture}`:null,te[e.name].city].filter(Boolean).join(" \xb7 ")||"\u2014"}),(0,gt.jsx)("input",{type:"date",style:{fontSize:10,padding:2,border:"1px solid #ddd",borderRadius:3,width:"100%"},value:J[e.name]||"",onChange:t=>{const n=t.target.value;ee(t=>({...t,[e.name]:n})),ne(t=>({...t,[e.name]:{...t[e.name]||{},date:n}}))}})]},t)})})]}),0===N.length&&(0,gt.jsx)("div",{style:{padding:40,textAlign:"center",color:"#999",fontSize:13,border:"1px dashed var(--fg-border)",borderRadius:8,background:"#f9fafb"},children:"No files selected"})]}),null!==k&&(0,gt.jsxs)("div",{style:{padding:16,background:"#dbeafe",borderRadius:8,textAlign:"center",fontWeight:600,color:"#1e40af",border:"1px solid #93c5fd"},children:["Uploading: ",k,"%"]}),(0,gt.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",paddingTop:12},children:(0,gt.jsx)("button",{className:"fg-btn fg-btn-primary",type:"submit",disabled:null!==k,style:{minWidth:140,padding:"12px 24px",fontSize:15,fontWeight:600},children:null!==k?"Uploading...":"Create Roll"})}),oe&&(0,gt.jsx)(Ma,{files:E.map((e,t)=>({name:e.name,preview:N[t]?N[t].url:null})),shotLogs:Q,initialAssignments:Object.keys(te).reduce((e,t)=>{var n;return void 0!==(null===(n=te[t])||void 0===n?void 0:n.logIndex)&&(e[t]=te[t].logIndex),e},{}),onSave:e=>{ne(e);const t={};Object.entries(e).forEach(([e,n])=>{n&&n.date&&(t[e]=n.date)}),ee(t),ae(!0),se(!1)},onClose:()=>se(!1)})]})}var Na=class extends $t{#u;#k=void 0;#Y;#Q;constructor(e,t){super(),this.#u=e,this.setOptions(t),this.bindMethods(),this.#Z()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#u.defaultMutationOptions(e),jt(this.options,t)||this.#u.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#Y,observer:this}),t?.mutationKey&&this.options.mutationKey&&kt(t.mutationKey)!==kt(this.options.mutationKey)?this.reset():"pending"===this.#Y?.state.status&&this.#Y.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#Y?.removeObserver(this)}onMutationUpdate(e){this.#Z(),this.#X(e)}getCurrentResult(){return this.#k}reset(){this.#Y?.removeObserver(this),this.#Y=void 0,this.#Z(),this.#X()}mutate(e,t){return this.#Q=t,this.#Y?.removeObserver(this),this.#Y=this.#u.getMutationCache().build(this.#u,this.options),this.#Y.addObserver(this),this.#Y.execute(e)}#Z(){const e=this.#Y?.state??{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};this.#k={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#X(e){Ht.batch(()=>{if(this.#Q&&this.hasListeners()){const t=this.#k.variables,n=this.#k.context,r={client:this.#u,meta:this.options.meta,mutationKey:this.options.mutationKey};"success"===e?.type?(this.#Q.onSuccess?.(e.data,t,n,r),this.#Q.onSettled?.(e.data,null,t,n,r)):"error"===e?.type&&(this.#Q.onError?.(e.error,t,n,r),this.#Q.onSettled?.(void 0,e.error,t,n,r))}this.listeners.forEach(e=>{e(this.#k)})})}};function ka(e,t){const n=At(t),[i]=r.useState(()=>new Na(n,e));r.useEffect(()=>{i.setOptions(e)},[i,e]);const a=r.useSyncExternalStore(r.useCallback(e=>i.subscribe(Ht.batchCalls(e)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=r.useCallback((e,t)=>{i.mutate(e,t).catch(wt)},[i]);if(a.error&&qt(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}var Ra=n(8994),La=n(1321);const Oa=$n("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),ja=$n("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Da=$n("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),Ia=$n("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Ba=$n("aperture",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m14.31 8 5.74 9.94",key:"1y6ab4"}],["path",{d:"M9.69 8h11.48",key:"1wxppr"}],["path",{d:"m7.38 12 5.74-9.94",key:"1grp0k"}],["path",{d:"M9.69 16 3.95 6.06",key:"libnyf"}],["path",{d:"M14.31 16H2.83",key:"x5fava"}],["path",{d:"m16.62 12-5.74 9.94",key:"1vwawt"}]]),Fa=$n("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),za=$n("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);function Ua(e){if(void 0===e||null===e||""===e)return"";let t=e;if("string"===typeof t&&/^\d+$/.test(t)&&(t=Number(t)),"number"===typeof t){t>0&&t<1e11&&(t*=1e3);const e=new Date(t);if(!isNaN(e.getTime())){return`${e.getFullYear()}.${String(e.getMonth()+1).padStart(2,"0")}.${String(e.getDate()).padStart(2,"0")}`}}const n=new Date(e);if(!isNaN(n.getTime())){return`${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,"0")}.${String(n.getDate()).padStart(2,"0")}`}return String(e)}function Va({icon:e,label:t,children:n,isEmpty:r}){return r?null:(0,gt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,gt.jsx)("div",{className:"p-2 rounded-lg bg-white/5 text-zinc-400 dark:text-zinc-500 shrink-0",children:(0,gt.jsx)(e,{size:18})}),(0,gt.jsxs)("div",{className:"min-w-0",children:[(0,gt.jsx)("p",{className:"text-[11px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-1",children:t}),(0,gt.jsx)("div",{className:"text-sm text-zinc-900 dark:text-zinc-100",children:n})]})]})}function Ga({roll:e,onEdit:t,coverUrl:n}){var r,i,a,o;if(!e)return null;const s=function(e,t){const n=Ua(e),r=Ua(t);return n||r?n&&r?n===r?n:`${n} \u2014 ${r}`:n||r||"":""}(e.start_date,e.end_date),l=function(e){return e?e.film_name_joined?e.film_name_joined:e.film&&"object"===typeof e.film?[e.film.brand,e.film.name,e.film.iso].filter(Boolean).join(" "):e.film_type?e.film_type:null:null}(e),c=e.display_seq||e.id,u=null!==e&&void 0!==e&&null!==(r=e.gear)&&void 0!==r&&null!==(i=r.cameras)&&void 0!==i&&i.length?e.gear.cameras:null!==e&&void 0!==e&&e.display_camera?[e.display_camera]:[],d=null!==e&&void 0!==e&&null!==(a=e.gear)&&void 0!==a&&null!==(o=a.lenses)&&void 0!==o&&o.length?e.gear.lenses:null!==e&&void 0!==e&&e.display_lens?[e.display_lens]:[],h=Array.isArray(null===e||void 0===e?void 0:e.locations)?e.locations:[];return(0,gt.jsx)("div",{className:"mb-6",children:(0,gt.jsxs)("div",{className:"relative rounded-2xl overflow-hidden bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5"}),(0,gt.jsxs)("div",{className:"relative flex flex-col lg:flex-row",children:[n&&(0,gt.jsx)("div",{className:"lg:w-64 xl:w-72 shrink-0",children:(0,gt.jsxs)("div",{className:"aspect-square lg:h-full relative",children:[(0,gt.jsx)("img",{src:n,alt:"Roll Cover",className:"w-full h-full object-cover"}),(0,gt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent lg:hidden"}),(0,gt.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-4 lg:hidden",children:[(0,gt.jsxs)("span",{className:"text-primary/80 font-bold text-sm",children:["#",c]}),(0,gt.jsx)("h1",{className:"text-xl font-bold text-white mt-1",children:e.title||"Untitled Roll"})]})]})}),(0,gt.jsxs)("div",{className:"flex-1 p-5 lg:p-6",children:[(0,gt.jsxs)("div",{className:n?"hidden lg:flex justify-between items-start mb-6":"flex justify-between items-start mb-6",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("span",{className:"text-primary font-bold text-base opacity-80",children:["#",c]}),(0,gt.jsx)("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 mt-1 leading-tight",children:e.title||"Untitled Roll"})]}),(0,gt.jsx)(La.T,{size:"sm",variant:"flat",className:"bg-white/5 hover:bg-white/10",startContent:(0,gt.jsx)(Oa,{size:14}),onPress:t,children:"Edit"})]}),n&&(0,gt.jsx)("div",{className:"flex justify-end mb-4 lg:hidden",children:(0,gt.jsx)(La.T,{size:"sm",variant:"flat",className:"bg-white/5 hover:bg-white/10",startContent:(0,gt.jsx)(Oa,{size:14}),onPress:t,children:"Edit"})}),(0,gt.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-5",children:[(0,gt.jsx)(Va,{icon:ja,label:"Date",isEmpty:!s,children:(0,gt.jsx)("span",{className:"text-sm",children:s})}),(0,gt.jsx)(Va,{icon:Da,label:"Film Type",isEmpty:!l,children:(0,gt.jsx)("span",{className:"text-sm",children:l})}),(0,gt.jsx)(Va,{icon:Ia,label:"Camera",isEmpty:0===u.length,children:(0,gt.jsx)("span",{className:"text-sm",children:u.join(", ")})}),(0,gt.jsx)(Va,{icon:Ba,label:"Lens",isEmpty:0===d.length,children:(0,gt.jsx)("span",{className:"text-sm",children:d.join(", ")})}),(0,gt.jsx)(Va,{icon:Fa,label:"Location",isEmpty:0===h.length,children:(0,gt.jsx)("span",{className:"text-sm",children:h.map(e=>e.city_name).join(", ")})}),(0,gt.jsx)(Va,{icon:za,label:"Notes",isEmpty:!(null!==e&&void 0!==e&&e.notes),children:(0,gt.jsx)("span",{className:"text-sm text-zinc-400 dark:text-zinc-500",children:e.notes})})]})]})]})]})})}var qa=n(2700),Wa=n(6838);var Ha=n(7287),$a=(0,Ln.Rf)((e,t)=>{const{Component:n,domRef:i,context:a,children:o,classNames:s,getButtonGroupProps:l}=function(e){var t,n;const i=(0,Bn.o)(),[a,o]=(0,Ln.rE)(e,qa.GC.variantKeys),{ref:s,as:l,children:c,color:u="default",size:d="md",variant:h="solid",radius:p,isDisabled:f=!1,isIconOnly:m=!1,disableRipple:g=null!=(t=null==i?void 0:i.disableRipple)&&t,disableAnimation:v=null!=(n=null==i?void 0:i.disableAnimation)&&n,className:A,...y}=a,b=l||"div",x=(0,Wa.zD)(s),_=(0,r.useMemo)(()=>(0,qa.GC)({...o,className:A}),[(0,In.t6)(o),A]);return{Component:b,children:c,domRef:x,context:(0,r.useMemo)(()=>({size:d,color:u,variant:h,radius:p,isIconOnly:m,isDisabled:f,disableAnimation:v,disableRipple:g,fullWidth:!!(null==e?void 0:e.fullWidth)}),[d,u,h,p,f,m,v,g,null==e?void 0:e.fullWidth]),classNames:_,getButtonGroupProps:(0,r.useCallback)(()=>({role:"group",...y}),[y])}}({...e,ref:t});return(0,gt.jsx)(Ha.l,{value:a,children:(0,gt.jsx)(n,{ref:i,className:s,...l(),children:o})})});$a.displayName="HeroUI.ButtonGroup";var Ka=$a,Xa=n(9015);var Ya=(0,On.tv)({base:"shrink-0 bg-divider border-none",variants:{orientation:{horizontal:"w-full h-divider",vertical:"h-full w-divider"}},defaultVariants:{orientation:"horizontal"}});function Qa(e){const{as:t,className:n,orientation:i,...a}=e;let o=t||"hr";"hr"===o&&"vertical"===i&&(o="div");const{separatorProps:s}=function(e){let t,n=(0,Xa.$)(e,{enabled:"string"===typeof e.elementType});return"vertical"===e.orientation&&(t="vertical"),"hr"!==e.elementType?{separatorProps:{...n,role:"separator","aria-orientation":t}}:{separatorProps:n}}({elementType:"string"===typeof o?o:"hr",orientation:i}),l=(0,r.useMemo)(()=>Ya({orientation:i,className:n}),[i,n]);return{Component:o,getDividerProps:(0,r.useCallback)((e={})=>({className:l,role:"separator","data-orientation":i,...s,...a,...e}),[l,i,s,a])}}var Za=(0,Ln.Rf)((e,t)=>{const{Component:n,getDividerProps:r}=Qa({...e});return(0,gt.jsx)(n,{ref:t,...r()})});Za.displayName="HeroUI.Divider";var Ja=Za,eo=n(151),[to,no]=(0,eo.q)({name:"DropdownContext",errorMessage:"useDropdownContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Dropdown />`"}),ro=n(681);function io(e){let t=(0,ro.T)(e),[n,i]=(0,r.useState)(null),[a,o]=(0,r.useState)([]);return{focusStrategy:n,...t,open(e=null){i(e),t.open()},toggle(e=null){i(e),t.toggle()},close(){o([]),t.close()},expandedKeysStack:a,openSubmenu:(e,t)=>{o(n=>t>n.length?n:[...n.slice(0,t),e])},closeSubmenu:(e,t)=>{o(n=>n[t]===e?n.slice(0,t):n)}}}var ao;ao={"ar-AE":{longPressMessage:"\u0627\u0636\u063a\u0637 \u0645\u0637\u0648\u0644\u0627\u064b \u0623\u0648 \u0627\u0636\u063a\u0637 \u0639\u0644\u0649 Alt + \u0627\u0644\u0633\u0647\u0645 \u0644\u0623\u0633\u0641\u0644 \u0644\u0641\u062a\u062d \u0627\u0644\u0642\u0627\u0626\u0645\u0629"},"bg-BG":{longPressMessage:"\u041d\u0430\u0442\u0438\u0441\u043d\u0435\u0442\u0435 \u043f\u0440\u043e\u0434\u044a\u043b\u0436\u0438\u0442\u0435\u043b\u043d\u043e \u0438\u043b\u0438 \u043d\u0430\u0442\u0438\u0441\u043d\u0435\u0442\u0435 Alt+ \u0441\u0442\u0440\u0435\u043b\u043a\u0430 \u043d\u0430\u0434\u043e\u043b\u0443, \u0437\u0430 \u0434\u0430 \u043e\u0442\u0432\u043e\u0440\u0438\u0442\u0435 \u043c\u0435\u043d\u044e\u0442\u043e"},"cs-CZ":{longPressMessage:"Dlouh\xfdm stiskem nebo stisknut\xedm kl\xe1ves Alt + \u0161ipka dol\u016f otev\u0159ete nab\xeddku"},"da-DK":{longPressMessage:"Langt tryk eller tryk p\xe5 Alt + pil ned for at \xe5bne menuen"},"de-DE":{longPressMessage:"Dr\xfccken Sie lange oder dr\xfccken Sie Alt + Nach-unten, um das Men\xfc zu \xf6ffnen"},"el-GR":{longPressMessage:"\u03a0\u03b9\u03ad\u03c3\u03c4\u03b5 \u03c0\u03b1\u03c1\u03b1\u03c4\u03b5\u03c4\u03b1\u03bc\u03ad\u03bd\u03b1 \u03ae \u03c0\u03b1\u03c4\u03ae\u03c3\u03c4\u03b5 Alt + \u03ba\u03ac\u03c4\u03c9 \u03b2\u03ad\u03bb\u03bf\u03c2 \u03b3\u03b9\u03b1 \u03bd\u03b1 \u03b1\u03bd\u03bf\u03af\u03be\u03b5\u03c4\u03b5 \u03c4\u03bf \u03bc\u03b5\u03bd\u03bf\u03cd"},"en-US":{longPressMessage:"Long press or press Alt + ArrowDown to open menu"},"es-ES":{longPressMessage:"Mantenga pulsado o pulse Alt + flecha abajo para abrir el men\xfa"},"et-EE":{longPressMessage:"Men\xfc\xfc avamiseks vajutage pikalt v\xf5i vajutage klahve Alt + allanool"},"fi-FI":{longPressMessage:"Avaa valikko painamalla pohjassa tai n\xe4pp\xe4inyhdistelm\xe4ll\xe4 Alt + Alanuoli"},"fr-FR":{longPressMessage:"Appuyez de mani\xe8re prolong\xe9e ou appuyez sur Alt\xa0+\xa0Fl\xe8che vers le bas pour ouvrir le menu."},"he-IL":{longPressMessage:"\u05dc\u05d7\u05e5 \u05dc\u05d7\u05d9\u05e6\u05d4 \u05d0\u05e8\u05d5\u05db\u05d4 \u05d0\u05d5 \u05d4\u05e7\u05e9 Alt + ArrowDown \u05db\u05d3\u05d9 \u05dc\u05e4\u05ea\u05d5\u05d7 \u05d0\u05ea \u05d4\u05ea\u05e4\u05e8\u05d9\u05d8"},"hr-HR":{longPressMessage:"Dugo pritisnite ili pritisnite Alt + strelicu prema dolje za otvaranje izbornika"},"hu-HU":{longPressMessage:"Nyomja meg hosszan, vagy nyomja meg az Alt + lefele ny\xedl gombot a men\xfc megnyit\xe1s\xe1hoz"},"it-IT":{longPressMessage:"Premi a lungo o premi Alt + Freccia gi\xf9 per aprire il menu"},"ja-JP":{longPressMessage:"\u9577\u62bc\u3057\u307e\u305f\u306f Alt+\u4e0b\u77e2\u5370\u30ad\u30fc\u3067\u30e1\u30cb\u30e5\u30fc\u3092\u958b\u304f"},"ko-KR":{longPressMessage:"\uae38\uac8c \ub204\ub974\uac70\ub098 Alt + \uc544\ub798\ucabd \ud654\uc0b4\ud45c\ub97c \ub20c\ub7ec \uba54\ub274 \uc5f4\uae30"},"lt-LT":{longPressMessage:"Nor\u0117dami atidaryti meniu, nuspaud\u0119 palaikykite arba paspauskite \u201eAlt + ArrowDown\u201c."},"lv-LV":{longPressMessage:"Lai atv\u0113rtu izv\u0113lni, turiet nospiestu vai nospiediet tausti\u0146u kombin\u0101ciju Alt + lejupv\u0113rst\u0101 bulti\u0146a"},"nb-NO":{longPressMessage:"Langt trykk eller trykk Alt + PilNed for \xe5 \xe5pne menyen"},"nl-NL":{longPressMessage:"Druk lang op Alt + pijl-omlaag of druk op Alt om het menu te openen"},"pl-PL":{longPressMessage:"Naci\u015bnij i przytrzymaj lub naci\u015bnij klawisze Alt + Strza\u0142ka w d\xf3\u0142, aby otworzy\u0107 menu"},"pt-BR":{longPressMessage:"Pressione e segure ou pressione Alt + Seta para baixo para abrir o menu"},"pt-PT":{longPressMessage:"Prima continuamente ou prima Alt + Seta Para Baixo para abrir o menu"},"ro-RO":{longPressMessage:"Ap\u0103sa\u021bi lung sau ap\u0103sa\u021bi pe Alt + s\u0103geat\u0103 \xeen jos pentru a deschide meniul"},"ru-RU":{longPressMessage:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u0438 \u0443\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0439\u0442\u0435 \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 Alt + \u0421\u0442\u0440\u0435\u043b\u043a\u0430 \u0432\u043d\u0438\u0437, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e"},"sk-SK":{longPressMessage:"Ponuku otvor\xedte dlh\xfdm stla\u010den\xedm alebo stla\u010den\xedm kl\xe1vesu Alt + kl\xe1vesu so \u0161\xedpkou nadol"},"sl-SI":{longPressMessage:"Za odprtje menija pritisnite in dr\u017eite gumb ali pritisnite Alt+pu\u0161\u010dica navzdol"},"sr-SP":{longPressMessage:"Dugo pritisnite ili pritisnite Alt + strelicu prema dole da otvorite meni"},"sv-SE":{longPressMessage:"H\xe5ll nedtryckt eller tryck p\xe5 Alt + pil ned\xe5t f\xf6r att \xf6ppna menyn"},"tr-TR":{longPressMessage:"Men\xfcy\xfc a\xe7mak i\xe7in uzun bas\u0131n veya Alt + A\u015fa\u011f\u0131 Ok tu\u015funa bas\u0131n"},"uk-UA":{longPressMessage:"\u0414\u043e\u0432\u0433\u043e \u0430\u0431\u043e \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u043e \u043d\u0430\u0442\u0438\u0441\u043d\u0456\u0442\u044c \u043a\u043e\u043c\u0431\u0456\u043d\u0430\u0446\u0456\u044e \u043a\u043b\u0430\u0432\u0456\u0448 Alt \u0456 \u0441\u0442\u0440\u0456\u043b\u043a\u0430 \u0432\u043d\u0438\u0437, \u0449\u043e\u0431 \u0432\u0456\u0434\u043a\u0440\u0438\u0442\u0438 \u043c\u0435\u043d\u044e"},"zh-CN":{longPressMessage:"\u957f\u6309\u6216\u6309 Alt + \u5411\u4e0b\u65b9\u5411\u952e\u4ee5\u6253\u5f00\u83dc\u5355"},"zh-TW":{longPressMessage:"\u9577\u6309\u6216\u6309 Alt+\u5411\u4e0b\u9375\u4ee5\u958b\u555f\u529f\u80fd\u8868"}};var oo=n(1389),so=n(4595),lo=n(8909),co=n(2417),uo=n(8493),ho=n(6650);let po=0;const fo=new Map;function mo(e){let[t,n]=(0,r.useState)();return(0,ho.N)(()=>{if(!e)return;let t=fo.get(e);if(t)n(t.element.id);else{let r="react-aria-description-"+po++;n(r);let i=document.createElement("div");i.id=r,i.style.display="none",i.textContent=e,document.body.appendChild(i),t={refCount:0,element:i},fo.set(e,t)}return t.refCount++,()=>{t&&0===--t.refCount&&(t.element.remove(),fo.delete(e))}},[e]),{"aria-describedby":e?t:void 0}}var go=n(2196);const vo=500;function Ao(e){let{isDisabled:t,onLongPressStart:n,onLongPressEnd:i,onLongPress:a,threshold:o=vo,accessibilityDescription:s}=e;const l=(0,r.useRef)(void 0);let{addGlobalListener:c,removeGlobalListener:u}=(0,co.A)(),{pressProps:d}=(0,lo.d)({isDisabled:t,onPressStart(e){if(e.continuePropagation(),("mouse"===e.pointerType||"touch"===e.pointerType)&&(n&&n({...e,type:"longpressstart"}),l.current=setTimeout(()=>{e.target.dispatchEvent(new PointerEvent("pointercancel",{bubbles:!0})),(0,uo.TW)(e.target).activeElement!==e.target&&(0,so.e)(e.target),a&&a({...e,type:"longpress"}),l.current=void 0},o),"touch"===e.pointerType)){let t=e=>{e.preventDefault()};c(e.target,"contextmenu",t,{once:!0}),c(window,"pointerup",()=>{setTimeout(()=>{u(e.target,"contextmenu",t)},30)},{once:!0})}},onPressEnd(e){l.current&&clearTimeout(l.current),!i||"mouse"!==e.pointerType&&"touch"!==e.pointerType||i({...e,type:"longpressend"})}}),h=mo(a&&!t?s:void 0);return{longPressProps:(0,go.v)(d,h)}}var yo=n(5529),bo=n(8225);function xo(e,t,n){let{type:r="menu",isDisabled:i,trigger:a="press"}=e,o=(0,oo.Bi)(),{triggerProps:s,overlayProps:l}=(0,bo.o)({type:r},t,n),c=(0,yo.o)(function(e){return e&&e.__esModule?e.default:e}(ao),"@react-aria/menu"),{longPressProps:u}=Ao({isDisabled:i||"longPress"!==a,accessibilityDescription:c.format("longPressMessage"),onLongPressStart(){t.close()},onLongPress(){t.open("first")}}),d={preventFocusOnPress:!0,onPressStart(e){"touch"===e.pointerType||"keyboard"===e.pointerType||i||((0,so.e)(e.target),t.open("virtual"===e.pointerType?"first":null))},onPress(e){"touch"!==e.pointerType||i||((0,so.e)(e.target),t.toggle())}};return delete s.onPress,{menuTriggerProps:{...s,..."press"===a?d:u,id:o,onKeyDown:e=>{if(!i&&("longPress"!==a||e.altKey)&&n&&n.current)switch(e.key){case"Enter":case" ":if("longPress"===a||e.isDefaultPrevented())return;case"ArrowDown":"continuePropagation"in e||e.stopPropagation(),e.preventDefault(),t.toggle("first");break;case"ArrowUp":"continuePropagation"in e||e.stopPropagation(),e.preventDefault(),t.toggle("last");break;default:"continuePropagation"in e&&e.continuePropagation()}}},menuProps:{...l,"aria-labelledby":o,autoFocus:t.focusStrategy||!0,onClose:t.close}}}function _o(...e){return t=>{e.forEach(e=>function(e,t){if(null!=e)if((0,In.Tn)(e))e(t);else try{e.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${e}'`)}}(e,t))}}var wo=(e,t,n)=>{const r=n||((e,t)=>{if(e){const n=Array.isArray(e.children)?e.children:[...(null==e?void 0:e.items)||[]];if(n&&n.length)return n.find(e=>{if(e&&e.key===t)return e})||{}}return null})(e,t);return r&&r.props&&"closeOnSelect"in r.props?r.props.closeOnSelect:null==e?void 0:e.closeOnSelect};function So(e){var t;const n=(0,Bn.o)(),{as:i,triggerRef:a,isOpen:o,defaultOpen:s,onOpenChange:l,isDisabled:c,type:u="menu",trigger:d="press",placement:h="bottom",closeOnSelect:p=!0,shouldBlockScroll:f=!0,classNames:m,disableAnimation:g=null!=(t=null==n?void 0:n.disableAnimation)&&t,onClose:v,className:A,...y}=e,b=i||"div",x=(0,r.useRef)(null),_=a||x,w=(0,r.useRef)(null),S=(0,r.useRef)(null),T=io({trigger:d,isOpen:o,defaultOpen:s,onOpenChange:e=>{null==l||l(e),e||null==v||v()}}),{menuTriggerProps:C,menuProps:M}=xo({type:u,trigger:d,isDisabled:c},T,_),E=(0,r.useMemo)(()=>(0,qa.Wm)({className:A}),[A]);return{Component:b,menuRef:w,menuProps:M,closeOnSelect:p,onClose:T.close,autoFocus:T.focusStrategy||!0,disableAnimation:g,getPopoverProps:(e={})=>{const t=(0,In.v6)(y,e);return{state:T,placement:h,ref:S,disableAnimation:g,shouldBlockScroll:f,scrollRef:w,triggerRef:_,...t,classNames:{...m,...e.classNames,content:(0,Dn.cn)(E,null==m?void 0:m.content,e.className)}}},getMenuProps:(e,t=null)=>({ref:_o(t,w),menuProps:M,closeOnSelect:p,...(0,In.v6)(e,{onAction:(t,n)=>{const r=wo(e,t,n);var i;(void 0===(i=r)||i)&&p&&T.close()},onClose:T.close})}),getMenuTriggerProps:(e={})=>{const{onPress:t,onPressStart:n,...r}=C;return(0,In.v6)(r,{isDisabled:c},e)}}}var To=n(6770),Co=e=>{const{children:t,...n}=e,i=So(n),[a,o]=r.Children.toArray(t);return(0,gt.jsx)(to,{value:i,children:(0,gt.jsxs)(To.y,{...i.getPopoverProps(),children:[a,o]})})};Co.displayName="HeroUI.Dropdown";var Mo=Co,Eo=n(4375),Po=e=>{const{getMenuTriggerProps:t}=no(),{children:n,...r}=e;return(0,gt.jsx)(Eo.T,{...t(r),children:n})};Po.displayName="HeroUI.DropdownTrigger";var No=Po,ko=n(4640),Ro=n(7508);function Lo(e){const{isSelected:t,disableAnimation:n,...r}=e;return(0,gt.jsx)("svg",{"aria-hidden":"true","data-selected":t,role:"presentation",viewBox:"0 0 17 18",...r,children:(0,gt.jsx)("polyline",{fill:"none",points:"1 9 7 14 15 4",stroke:"currentColor",strokeDasharray:22,strokeDashoffset:t?44:66,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,style:n?{}:{transition:"stroke-dashoffset 200ms ease"}})})}var Oo=n(8184);const jo=new WeakMap;var Do=n(7418),Io=n(54);function Bo(e,t){return"function"===typeof t.getChildren?t.getChildren(e.key):e.childNodes}function Fo(e){return function(e,t){if(t<0)return;let n=0;for(let r of e){if(n===t)return r;n++}}(e,0)}function zo(e,t,n){if(t.parentKey===n.parentKey)return t.index-n.index;let r=[...Uo(e,t),t],i=[...Uo(e,n),n],a=r.slice(0,i.length).findIndex((e,t)=>e!==i[t]);return-1!==a?(t=r[a],n=i[a],t.index-n.index):r.findIndex(e=>e===n)>=0?1:(i.findIndex(e=>e===t),-1)}function Uo(e,t){let n=[],r=t;for(;null!=(null===r||void 0===r?void 0:r.parentKey);)r=e.getItem(r.parentKey),r&&n.unshift(r);return n}const Vo=new WeakMap;function Go(e){let t=Vo.get(e);if(null!=t)return t;let n=0,r=t=>{for(let i of t)"section"===i.type?r(Bo(i,e)):"item"===i.type&&n++};return r(e),Vo.set(e,n),n}var qo=n(9161),Wo=n(5603),Ho=n(6296),$o=n(3255),Ko=n(9427);function Xo(e){return(0,Ko.lg)()?e.altKey:e.ctrlKey}function Yo(e,t){var n,r;let i=`[data-key="${CSS.escape(String(t))}"]`,a=null===(n=e.current)||void 0===n?void 0:n.dataset.collection;return a&&(i=`[data-collection="${CSS.escape(a)}"]${i}`),null===(r=e.current)||void 0===r?void 0:r.querySelector(i)}const Qo=new WeakMap;function Zo(e){let t=(0,oo.Bi)();return Qo.set(e,t),t}var Jo=n(1709),es=n(5033),ts=n(4338),ns=n(3941);function rs(e){let t=function(e){let t=(0,ns.bq)(e),n=null===t||void 0===t?void 0:t.getAttribute("aria-activedescendant");return n&&e.getElementById(n)||t}((0,uo.TW)(e));t!==e&&(t&&function(e,t){e.dispatchEvent(new FocusEvent("blur",{relatedTarget:t})),e.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:t}))}(t,e),e&&is(e,t))}function is(e,t){e.dispatchEvent(new FocusEvent("focus",{relatedTarget:t})),e.dispatchEvent(new FocusEvent("focusin",{bubbles:!0,relatedTarget:t}))}function as(e){let{id:t,selectionManager:n,key:i,ref:a,shouldSelectOnPressUp:o,shouldUseVirtualFocus:s,focus:l,isDisabled:c,onAction:u,allowsDifferentPressOrigin:d,linkBehavior:h="action"}=e,p=(0,Do.rd)();t=(0,oo.Bi)(t);let f=e=>{if("keyboard"===e.pointerType&&Xo(e))n.toggleSelection(i);else{if("none"===n.selectionMode)return;if(n.isLink(i)){if("selection"===h&&a.current){let t=n.getItemProps(i);return p.open(a.current,e,t.href,t.routerOptions),void n.setSelectedKeys(n.selectedKeys)}if("override"===h||"none"===h)return}"single"===n.selectionMode?n.isSelected(i)&&!n.disallowEmptySelection?n.toggleSelection(i):n.replaceSelection(i):e&&e.shiftKey?n.extendSelection(i):"toggle"===n.selectionBehavior||e&&((0,Jo.B)(e)||"touch"===e.pointerType||"virtual"===e.pointerType)?n.toggleSelection(i):n.replaceSelection(i)}};(0,r.useEffect)(()=>{i===n.focusedKey&&n.isFocused&&(s?rs(a.current):l?l():document.activeElement!==a.current&&a.current&&(0,ts.l)(a.current))},[a,i,n.focusedKey,n.childFocusStrategy,n.isFocused,s]),c=c||n.isDisabled(i);let m={};s||c?c&&(m.onMouseDown=e=>{e.preventDefault()}):m={tabIndex:i===n.focusedKey?0:-1,onFocus(e){e.target===a.current&&n.setFocusedKey(i)}};let g=n.isLink(i)&&"override"===h,v=u&&"action"===e.UNSTABLE_itemBehavior,A=n.isLink(i)&&"selection"!==h&&"none"!==h,y=!c&&n.canSelectItem(i)&&!g&&!v,b=(u||A)&&!c,x=b&&("replace"===n.selectionBehavior?!y:!y||n.isEmpty),_=b&&y&&"replace"===n.selectionBehavior,w=x||_,S=(0,r.useRef)(null),T=w&&y,C=(0,r.useRef)(!1),M=(0,r.useRef)(!1),E=n.getItemProps(i),P=e=>{var t;u&&(u(),null===(t=a.current)||void 0===t||t.dispatchEvent(new CustomEvent("react-aria-item-action",{bubbles:!0})));A&&a.current&&p.open(a.current,e,E.href,E.routerOptions)},N={ref:a};var k;if(o?(N.onPressStart=e=>{S.current=e.pointerType,C.current=T,"keyboard"!==e.pointerType||w&&!ss()||f(e)},d?(N.onPressUp=x?void 0:e=>{"mouse"===e.pointerType&&y&&f(e)},N.onPress=x?P:e=>{"keyboard"!==e.pointerType&&"mouse"!==e.pointerType&&y&&f(e)}):N.onPress=e=>{if(x||_&&"mouse"!==e.pointerType){if("keyboard"===e.pointerType&&!os())return;P(e)}else"keyboard"!==e.pointerType&&y&&f(e)}):(N.onPressStart=e=>{S.current=e.pointerType,C.current=T,M.current=x,y&&("mouse"===e.pointerType&&!x||"keyboard"===e.pointerType&&(!b||ss()))&&f(e)},N.onPress=e=>{("touch"===e.pointerType||"pen"===e.pointerType||"virtual"===e.pointerType||"keyboard"===e.pointerType&&w&&os()||"mouse"===e.pointerType&&M.current)&&(w?P(e):y&&f(e))}),m["data-collection"]=(k=n.collection,Qo.get(k)),m["data-key"]=i,N.preventFocusOnPress=s,s&&(N=(0,go.v)(N,{onPressStart(e){"touch"!==e.pointerType&&(n.setFocused(!0),n.setFocusedKey(i))},onPress(e){"touch"===e.pointerType&&(n.setFocused(!0),n.setFocusedKey(i))}})),E)for(let r of["onPressStart","onPressEnd","onPressChange","onPress","onPressUp","onClick"])E[r]&&(N[r]=(0,es.c)(N[r],E[r]));let{pressProps:R,isPressed:L}=(0,lo.d)(N),O=_?e=>{"mouse"===S.current&&(e.stopPropagation(),e.preventDefault(),P(e))}:void 0,{longPressProps:j}=Ao({isDisabled:!T,onLongPress(e){"touch"===e.pointerType&&(f(e),n.setSelectionBehavior("toggle"))}}),D="none"!==h&&n.isLink(i)?e=>{Do.Fe.isOpening||e.preventDefault()}:void 0;return{itemProps:(0,go.v)(m,y||x||s&&!c?R:{},T?j:{},{onDoubleClick:O,onDragStartCapture:e=>{"touch"===S.current&&C.current&&e.preventDefault()},onClick:D,id:t},s?{onMouseDown:e=>e.preventDefault()}:void 0),isPressed:L,isSelected:n.isSelected(i),isFocused:n.isFocused&&n.focusedKey===i,isDisabled:c,allowsSelection:y,hasAction:w}}function os(){let e=window.event;return"Enter"===(null===e||void 0===e?void 0:e.key)}function ss(){let e=window.event;return" "===(null===e||void 0===e?void 0:e.key)||"Space"===(null===e||void 0===e?void 0:e.code)}function ls(e,t,n){let{id:i,key:a,closeOnSelect:o,isVirtualized:s,"aria-haspopup":l,onPressStart:c,onPressUp:u,onPress:d,onPressChange:h,onPressEnd:p,onClick:f,onHoverStart:m,onHoverChange:g,onHoverEnd:v,onKeyDown:A,onKeyUp:y,onFocus:b,onFocusChange:x,onBlur:_,selectionManager:w=t.selectionManager}=e,S=!!l,T=S&&"true"===e["aria-expanded"];var C;let M=null!==(C=e.isDisabled)&&void 0!==C?C:w.isDisabled(a);var E;let P=null!==(E=e.isSelected)&&void 0!==E?E:w.isSelected(a),N=jo.get(t),k=t.collection.getItem(a),R=e.onClose||N.onClose,L=(0,Do.rd)(),O="menuitem";S||("single"===w.selectionMode?O="menuitemradio":"multiple"===w.selectionMode&&(O="menuitemcheckbox"));let j=(0,oo.X1)(),D=(0,oo.X1)(),I=(0,oo.X1)(),B={id:i,"aria-disabled":M||void 0,role:O,"aria-label":e["aria-label"],"aria-labelledby":j,"aria-describedby":[D,I].filter(Boolean).join(" ")||void 0,"aria-controls":e["aria-controls"],"aria-haspopup":l,"aria-expanded":e["aria-expanded"]};"none"===w.selectionMode||S||(B["aria-checked"]=P),s&&(B["aria-posinset"]=null===k||void 0===k?void 0:k.index,B["aria-setsize"]=Go(t.collection));let F=(0,r.useRef)(!1),z=(0,r.useRef)(null),{itemProps:U,isFocused:V}=as({id:i,selectionManager:w,key:a,ref:n,shouldSelectOnPressUp:!0,allowsDifferentPressOrigin:!0,linkBehavior:"none",shouldUseVirtualFocus:N.shouldUseVirtualFocus}),{pressProps:G,isPressed:q}=(0,lo.d)({onPressStart:c,onPress:d,onPressUp:e=>{"keyboard"!==e.pointerType&&(z.current={pointerType:e.pointerType}),"mouse"===e.pointerType&&(F.current||e.target.click()),null===u||void 0===u||u(e)},onPressChange:e=>{null===h||void 0===h||h(e),F.current=e},onPressEnd:p,isDisabled:M}),{hoverProps:W}=(0,qo.M)({isDisabled:M,onHoverStart(e){(0,Wo.pP)()||T&&l||(w.setFocused(!0),w.setFocusedKey(a)),null===m||void 0===m||m(e)},onHoverChange:g,onHoverEnd:v}),{keyboardProps:H}=(0,Ho.d)({onKeyDown:e=>{if(e.repeat)e.continuePropagation();else switch(e.key){case" ":z.current={pointerType:"keyboard",key:" "},e.target.click();break;case"Enter":z.current={pointerType:"keyboard",key:"Enter"},"A"!==e.target.tagName&&e.target.click();break;default:S||e.continuePropagation(),null===A||void 0===A||A(e)}},onKeyUp:y}),{focusProps:$}=(0,$o.i)({onBlur:_,onFocus:b,onFocusChange:x}),K=(0,Io.$)(null===k||void 0===k?void 0:k.props);delete K.id;let X=(0,Do._h)(null===k||void 0===k?void 0:k.props);return{menuItemProps:{...B,...(0,go.v)(K,X,S?{onFocus:U.onFocus,"data-collection":U["data-collection"],"data-key":U["data-key"]}:U,G,W,H,$,N.shouldUseVirtualFocus||S?{onMouseDown:e=>e.preventDefault()}:void 0,M?void 0:{onClick:t=>{var n,r;null===f||void 0===f||f(t),(()=>{var t;!S&&((null===k||void 0===k||null===(t=k.props)||void 0===t?void 0:t.onAction)?k.props.onAction():e.onAction&&e.onAction(a),N.onAction)&&(0,N.onAction)(a)})(),(0,Do.PJ)(t,L,k.props.href,null===k||void 0===k?void 0:k.props.routerOptions);let i="keyboard"===(null===(n=z.current)||void 0===n?void 0:n.pointerType)?"Enter"===(null===(r=z.current)||void 0===r?void 0:r.key)||"none"===w.selectionMode||w.isLink(a):"multiple"!==w.selectionMode||w.isLink(a);i=null!==o&&void 0!==o?o:i,R&&!S&&i&&R(),z.current=null}}),tabIndex:null!=U.tabIndex&&T&&!N.shouldUseVirtualFocus?-1:U.tabIndex},labelProps:{id:j},descriptionProps:{id:D},keyboardShortcutProps:{id:I},isFocused:V,isFocusVisible:V&&w.isFocused&&(0,Wo.pP)()&&!T,isSelected:P,isPressed:q,isDisabled:M}}var cs=n(60);function us(){return!(0,cs.wR)()&&"undefined"!==typeof window&&window.screen.width<=700}var ds=e=>{const{Component:t,slots:n,classNames:i,rendered:a,shortcut:o,description:s,isSelectable:l,isSelected:c,isDisabled:u,selectedIcon:d,startContent:h,endContent:p,disableAnimation:f,hideSelectedIcon:m,getItemProps:g,getLabelProps:v,getDescriptionProps:A,getKeyboardShortcutProps:y,getSelectedIconProps:b}=function(e){var t,n;const i=(0,Bn.o)(),[a,o]=(0,Ln.rE)(e,qa.j$.variantKeys),{as:s,item:l,state:c,shortcut:u,description:d,startContent:h,endContent:p,isVirtualized:f,selectedIcon:m,className:g,classNames:v,onAction:A,autoFocus:y,onPress:b,onPressStart:x,onPressUp:_,onPressEnd:w,onPressChange:S,onHoverStart:T,onHoverChange:C,onHoverEnd:M,hideSelectedIcon:E=!1,isReadOnly:P=!1,closeOnSelect:N,onClose:k,onClick:R,...L}=a,O=null!=(n=null!=(t=e.disableAnimation)?t:null==i?void 0:i.disableAnimation)&&n,j=(0,r.useRef)(null),D=s||((null==L?void 0:L.href)?"a":"li"),I="string"===typeof D,{rendered:B,key:F}=l,z=c.disabledKeys.has(F)||e.isDisabled,U="none"!==c.selectionManager.selectionMode,V=us(),{isFocusVisible:G,focusProps:q}=(0,Oo.o)({autoFocus:y}),W=(0,r.useCallback)(e=>{null==R||R(e),null==b||b(e)},[R,b]),{isPressed:H,isFocused:$,isSelected:K,isDisabled:X,menuItemProps:Y,labelProps:Q,descriptionProps:Z,keyboardShortcutProps:J}=ls({key:F,onClose:k,isDisabled:z,onPress:W,onPressStart:x,onPressUp:_,onPressEnd:w,onPressChange:S,"aria-label":a["aria-label"],closeOnSelect:N,isVirtualized:f,onAction:A},c,j);let{hoverProps:ee,isHovered:te}=(0,qo.M)({isDisabled:X,onHoverStart(e){(0,Wo.pP)()||(c.selectionManager.setFocused(!0),c.selectionManager.setFocusedKey(F)),null==T||T(e)},onHoverChange:C,onHoverEnd:M}),ne=Y;const re=(0,r.useMemo)(()=>(0,qa.j$)({...o,isDisabled:X,disableAnimation:O,hasTitleTextChild:"string"===typeof B,hasDescriptionTextChild:"string"===typeof d}),[(0,In.t6)(o),X,O,B,d]),ie=(0,Dn.cn)(null==v?void 0:v.base,g);P&&(ne=(0,In.GU)(ne));const ae=(0,r.useCallback)((e={})=>({"aria-hidden":(0,In.sE)(!0),"data-disabled":(0,In.sE)(X),className:re.selectedIcon({class:null==v?void 0:v.selectedIcon}),...e}),[X,re,v]);return{Component:D,domRef:j,slots:re,classNames:v,isSelectable:U,isSelected:K,isDisabled:X,rendered:B,shortcut:u,description:d,startContent:h,endContent:p,selectedIcon:m,disableAnimation:O,getItemProps:(e={})=>({ref:j,...(0,In.v6)(P?{}:q,(0,Xa.$)(L,{enabled:I}),ne,ee,e),"data-focus":(0,In.sE)($),"data-selectable":(0,In.sE)(U),"data-hover":(0,In.sE)(V?te||H:te),"data-disabled":(0,In.sE)(X),"data-selected":(0,In.sE)(K),"data-pressed":(0,In.sE)(H),"data-focus-visible":(0,In.sE)(G),className:re.base({class:(0,Dn.cn)(ie,e.className)})}),getLabelProps:(e={})=>({...(0,In.v6)(Q,e),className:re.title({class:null==v?void 0:v.title})}),hideSelectedIcon:E,getDescriptionProps:(e={})=>({...(0,In.v6)(Z,e),className:re.description({class:null==v?void 0:v.description})}),getKeyboardShortcutProps:(e={})=>({...(0,In.v6)(J,e),className:re.shortcut({class:null==v?void 0:v.shortcut})}),getSelectedIconProps:ae}}(e),x=(0,r.useMemo)(()=>{const e=(0,gt.jsx)(Lo,{disableAnimation:f,isSelected:c});return"function"===typeof d?d({icon:e,isSelected:c,isDisabled:u}):d||e},[d,c,u,f]);return(0,gt.jsxs)(t,{...g(),children:[h,s?(0,gt.jsxs)("div",{className:n.wrapper({class:null==i?void 0:i.wrapper}),children:[(0,gt.jsx)("span",{...v(),children:a}),(0,gt.jsx)("span",{...A(),children:s})]}):(0,gt.jsx)("span",{...v(),children:a}),o&&(0,gt.jsx)("kbd",{...y(),children:o}),l&&!m&&(0,gt.jsx)("span",{...b(),children:x}),p]})};ds.displayName="HeroUI.MenuItem";var hs=ds;var ps=(0,Ln.Rf)(({item:e,state:t,as:n,variant:i,color:a,disableAnimation:o,onAction:s,closeOnSelect:l,className:c,classNames:u,showDivider:d=!1,hideSelectedIcon:h,dividerProps:p={},itemClasses:f,title:m,...g},v)=>{const A=n||"li",y=(0,r.useMemo)(()=>(0,qa.Dt)(),[]),b=(0,Dn.cn)(null==u?void 0:u.base,c),x=(0,Dn.cn)(null==u?void 0:u.divider,null==p?void 0:p.className),{itemProps:_,headingProps:w,groupProps:S}=function(e){let{heading:t,"aria-label":n}=e,r=(0,oo.Bi)();return{itemProps:{role:"presentation"},headingProps:t?{id:r,role:"presentation"}:{},groupProps:{role:"group","aria-label":n,"aria-labelledby":t?r:void 0}}}({heading:e.rendered,"aria-label":e["aria-label"]});return(0,gt.jsxs)(A,{"data-slot":"base",...(0,In.v6)(_,g),className:y.base({class:b}),children:[e.rendered&&(0,gt.jsx)("span",{...w,className:y.heading({class:null==u?void 0:u.heading}),"data-slot":"heading",children:e.rendered}),(0,gt.jsxs)("ul",{...S,className:y.group({class:null==u?void 0:u.group}),"data-has-title":!!e.rendered,"data-slot":"group",children:[[...e.childNodes].map(e=>{const{key:n,props:r}=e;let c=(0,gt.jsx)(hs,{classNames:f,closeOnSelect:l,color:a,disableAnimation:o,hideSelectedIcon:h,item:e,state:t,variant:i,onAction:s,...r},n);return e.wrapper&&(c=e.wrapper(c)),c}),d&&(0,gt.jsx)(Ja,{as:"li",className:y.divider({class:x}),...p})]})]})});ps.displayName="HeroUI.MenuSection";var fs=ps;function ms(e){let{keyboardDelegate:t,selectionManager:n,onTypeSelect:i}=e,a=(0,r.useRef)({search:"",timeout:void 0}).current;return{typeSelectProps:{onKeyDownCapture:t.getKeyForSearch?e=>{let r=1!==(o=e.key).length&&/^[A-Z]/i.test(o)?"":o;var o;if(r&&!e.ctrlKey&&!e.metaKey&&e.currentTarget.contains(e.target)&&(0!==a.search.length||" "!==r)){if(" "===r&&a.search.trim().length>0&&(e.preventDefault(),"continuePropagation"in e||e.stopPropagation()),a.search+=r,null!=t.getKeyForSearch){let e=t.getKeyForSearch(a.search,n.focusedKey);null==e&&(e=t.getKeyForSearch(a.search)),null!=e&&(n.setFocusedKey(e),i&&i(e))}clearTimeout(a.timeout),a.timeout=setTimeout(()=>{a.search=""},1e3)}}:void 0}}}var gs=n(587),vs=n(1468);function As(e,t,n,i){let a=(0,vs.J)(n),o=null==n;(0,r.useEffect)(()=>{if(o||!e.current)return;let n=e.current;return n.addEventListener(t,a,i),()=>{n.removeEventListener(t,a,i)}},[e,t,i,o])}var ys=n(1697);function bs(e,t){const n=[];for(;e&&e!==document.documentElement;)(0,ys.o)(e,t)&&n.push(e),e=e.parentElement;return n}function xs(e,t){let n=_s(e,t,"left"),r=_s(e,t,"top"),i=t.offsetWidth,a=t.offsetHeight,o=e.scrollLeft,s=e.scrollTop,{borderTopWidth:l,borderLeftWidth:c,scrollPaddingTop:u,scrollPaddingRight:d,scrollPaddingBottom:h,scrollPaddingLeft:p}=getComputedStyle(e),f=o+parseInt(c,10),m=s+parseInt(l,10),g=f+e.clientWidth,v=m+e.clientHeight,A=parseInt(u,10)||0,y=parseInt(h,10)||0,b=parseInt(d,10)||0,x=parseInt(p,10)||0;n<=o+x?o=n-parseInt(c,10)-x:n+i>g-b&&(o+=n+i-g+b),r<=m+A?s=r-parseInt(l,10)-A:r+a>v-y&&(s+=r+a-v+y),e.scrollLeft=o,e.scrollTop=s}function _s(e,t,n){const r="left"===n?"offsetLeft":"offsetTop";let i=0;for(;t.offsetParent&&(i+=t[r],t.offsetParent!==e);){if(t.offsetParent.contains(e)){i-=e[r];break}t=t.offsetParent}return i}function ws(e,t){if(e&&document.contains(e)){let o=document.scrollingElement||document.documentElement,s="hidden"===window.getComputedStyle(o).overflow;if(s){let t=bs(e);s||t.push(o);for(let n of t)xs(n,e)}else{var n;let{left:o,top:s}=e.getBoundingClientRect();null===e||void 0===e||null===(n=e.scrollIntoView)||void 0===n||n.call(e,{block:"nearest"});let{left:l,top:c}=e.getBoundingClientRect();var r,i,a;if(Math.abs(o-l)>1||Math.abs(s-c)>1)null===t||void 0===t||null===(i=t.containingElement)||void 0===i||null===(r=i.scrollIntoView)||void 0===r||r.call(i,{block:"center",inline:"center"}),null===(a=e.scrollIntoView)||void 0===a||a.call(e,{block:"nearest"})}}}function Ss(e,t){const n=(0,r.useRef)(!0),i=(0,r.useRef)(null);(0,ho.N)(()=>(n.current=!0,()=>{n.current=!1}),[]),(0,ho.N)(()=>{n.current?n.current=!1:i.current&&!t.some((e,t)=>!Object.is(e,i[t]))||e(),i.current=t},t)}var Ts=n(269);function Cs(e){let{selectionManager:t,keyboardDelegate:n,ref:i,autoFocus:a=!1,shouldFocusWrap:o=!1,disallowEmptySelection:s=!1,disallowSelectAll:l=!1,escapeKeyBehavior:c="clearSelection",selectOnFocus:u="replace"===t.selectionBehavior,disallowTypeAhead:d=!1,shouldUseVirtualFocus:h,allowsTabNavigation:p=!1,isVirtualized:f,scrollRef:m=i,linkBehavior:g="action"}=e,{direction:v}=(0,Ts.Y)(),A=(0,Do.rd)(),y=(0,r.useRef)({top:0,left:0});As(m,"scroll",f?void 0:()=>{var e,t,n,r;y.current={top:null!==(n=null===(e=m.current)||void 0===e?void 0:e.scrollTop)&&void 0!==n?n:0,left:null!==(r=null===(t=m.current)||void 0===t?void 0:t.scrollLeft)&&void 0!==r?r:0}});let b=(0,r.useRef)(!1);As(i,"react-aria-focus",h?e=>{let{detail:n}=e;e.stopPropagation(),t.setFocused(!0),"first"===(null===n||void 0===n?void 0:n.focusStrategy)&&(b.current=!0)}:void 0),Ss(()=>{if(b.current){var e,r;let a=null!==(r=null===(e=n.getFirstKey)||void 0===e?void 0:e.call(n))&&void 0!==r?r:null;if(null==a){let e=(0,ns.bq)();rs(i.current),is(e,null),t.collection.size>0&&(b.current=!1)}else t.setFocusedKey(a),b.current=!1}},[t.collection]),Ss(()=>{t.collection.size>0&&(b.current=!1)},[t.focusedKey]),As(i,"react-aria-clear-focus",h?e=>{var n;e.stopPropagation(),t.setFocused(!1),(null===(n=e.detail)||void 0===n?void 0:n.clearFocusKey)&&t.setFocusedKey(null)}:void 0);const x=(0,r.useRef)(a),_=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(x.current){var e,r;let l=null;var o,s;"first"===a&&(l=null!==(o=null===(e=n.getFirstKey)||void 0===e?void 0:e.call(n))&&void 0!==o?o:null),"last"===a&&(l=null!==(s=null===(r=n.getLastKey)||void 0===r?void 0:r.call(n))&&void 0!==s?s:null);let c=t.selectedKeys;if(c.size)for(let e of c)if(t.canSelectItem(e)){l=e;break}t.setFocused(!0),t.setFocusedKey(l),null==l&&!h&&i.current&&(0,ts.l)(i.current),t.collection.size>0&&(x.current=!1,_.current=!0)}});let w=(0,r.useRef)(t.focusedKey),S=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(t.isFocused&&null!=t.focusedKey&&(t.focusedKey!==w.current||_.current)&&m.current&&i.current){let e=(0,Wo.ME)(),n=Yo(i,t.focusedKey);if(!(n instanceof HTMLElement))return;("keyboard"===e||_.current)&&(S.current&&cancelAnimationFrame(S.current),S.current=requestAnimationFrame(()=>{m.current&&(xs(m.current,n),"virtual"!==e&&ws(n,{containingElement:i.current}))}))}!h&&t.isFocused&&null==t.focusedKey&&null!=w.current&&i.current&&(0,ts.l)(i.current),w.current=t.focusedKey,_.current=!1}),(0,r.useEffect)(()=>()=>{S.current&&cancelAnimationFrame(S.current)},[]),As(i,"react-aria-focus-scope-restore",e=>{e.preventDefault(),t.setFocused(!0)});let T,C={onKeyDown:e=>{var r;if(e.altKey&&"Tab"===e.key&&e.preventDefault(),!(null===(r=i.current)||void 0===r?void 0:r.contains(e.target)))return;const a=(n,r)=>{if(null!=n){if(t.isLink(n)&&"selection"===g&&u&&!Xo(e)){(0,Ca.flushSync)(()=>{t.setFocusedKey(n,r)});let a=Yo(i,n),o=t.getItemProps(n);return void(a&&A.open(a,e,o.href,o.routerOptions))}if(t.setFocusedKey(n,r),t.isLink(n)&&"override"===g)return;e.shiftKey&&"multiple"===t.selectionMode?t.extendSelection(n):u&&!Xo(e)&&t.replaceSelection(n)}};switch(e.key){case"ArrowDown":if(n.getKeyBelow){var d,h,f;let r=null!=t.focusedKey?null===(d=n.getKeyBelow)||void 0===d?void 0:d.call(n,t.focusedKey):null===(h=n.getFirstKey)||void 0===h?void 0:h.call(n);null==r&&o&&(r=null===(f=n.getFirstKey)||void 0===f?void 0:f.call(n,t.focusedKey)),null!=r&&(e.preventDefault(),a(r))}break;case"ArrowUp":if(n.getKeyAbove){var m,y,b;let r=null!=t.focusedKey?null===(m=n.getKeyAbove)||void 0===m?void 0:m.call(n,t.focusedKey):null===(y=n.getLastKey)||void 0===y?void 0:y.call(n);null==r&&o&&(r=null===(b=n.getLastKey)||void 0===b?void 0:b.call(n,t.focusedKey)),null!=r&&(e.preventDefault(),a(r))}break;case"ArrowLeft":if(n.getKeyLeftOf){var x,_,w;let r=null!=t.focusedKey?null===(x=n.getKeyLeftOf)||void 0===x?void 0:x.call(n,t.focusedKey):null;null==r&&o&&(r="rtl"===v?null===(_=n.getFirstKey)||void 0===_?void 0:_.call(n,t.focusedKey):null===(w=n.getLastKey)||void 0===w?void 0:w.call(n,t.focusedKey)),null!=r&&(e.preventDefault(),a(r,"rtl"===v?"first":"last"))}break;case"ArrowRight":if(n.getKeyRightOf){var S,T,C;let r=null!=t.focusedKey?null===(S=n.getKeyRightOf)||void 0===S?void 0:S.call(n,t.focusedKey):null;null==r&&o&&(r="rtl"===v?null===(T=n.getLastKey)||void 0===T?void 0:T.call(n,t.focusedKey):null===(C=n.getFirstKey)||void 0===C?void 0:C.call(n,t.focusedKey)),null!=r&&(e.preventDefault(),a(r,"rtl"===v?"last":"first"))}break;case"Home":if(n.getFirstKey){if(null===t.focusedKey&&e.shiftKey)return;e.preventDefault();let r=n.getFirstKey(t.focusedKey,(0,Jo.B)(e));t.setFocusedKey(r),null!=r&&((0,Jo.B)(e)&&e.shiftKey&&"multiple"===t.selectionMode?t.extendSelection(r):u&&t.replaceSelection(r))}break;case"End":if(n.getLastKey){if(null===t.focusedKey&&e.shiftKey)return;e.preventDefault();let r=n.getLastKey(t.focusedKey,(0,Jo.B)(e));t.setFocusedKey(r),null!=r&&((0,Jo.B)(e)&&e.shiftKey&&"multiple"===t.selectionMode?t.extendSelection(r):u&&t.replaceSelection(r))}break;case"PageDown":if(n.getKeyPageBelow&&null!=t.focusedKey){let r=n.getKeyPageBelow(t.focusedKey);null!=r&&(e.preventDefault(),a(r))}break;case"PageUp":if(n.getKeyPageAbove&&null!=t.focusedKey){let r=n.getKeyPageAbove(t.focusedKey);null!=r&&(e.preventDefault(),a(r))}break;case"a":(0,Jo.B)(e)&&"multiple"===t.selectionMode&&!0!==l&&(e.preventDefault(),t.selectAll());break;case"Escape":"clearSelection"!==c||s||0===t.selectedKeys.size||(e.stopPropagation(),e.preventDefault(),t.clearSelection());break;case"Tab":if(!p){if(e.shiftKey)i.current.focus();else{let e,t,n=(0,Ro.N$)(i.current,{tabbable:!0});do{t=n.lastChild(),t&&(e=t)}while(t);e&&(!e.contains(document.activeElement)||document.activeElement&&!(0,gs.A)(document.activeElement))&&(0,so.e)(e)}break}}},onFocus:e=>{if(t.isFocused)e.currentTarget.contains(e.target)||t.setFocused(!1);else if(e.currentTarget.contains(e.target)){if(t.setFocused(!0),null==t.focusedKey){var r,a;let i=e=>{null!=e&&(t.setFocusedKey(e),u&&!t.isSelected(e)&&t.replaceSelection(e))},l=e.relatedTarget;var o,s;l&&e.currentTarget.compareDocumentPosition(l)&Node.DOCUMENT_POSITION_FOLLOWING?i(null!==(o=t.lastSelectedKey)&&void 0!==o?o:null===(r=n.getLastKey)||void 0===r?void 0:r.call(n)):i(null!==(s=t.firstSelectedKey)&&void 0!==s?s:null===(a=n.getFirstKey)||void 0===a?void 0:a.call(n))}else!f&&m.current&&(m.current.scrollTop=y.current.top,m.current.scrollLeft=y.current.left);if(null!=t.focusedKey&&m.current){let e=Yo(i,t.focusedKey);if(e instanceof HTMLElement){e.contains(document.activeElement)||h||(0,so.e)(e),"keyboard"===(0,Wo.ME)()&&ws(e,{containingElement:i.current})}}}},onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||t.setFocused(!1)},onMouseDown(e){m.current===e.target&&e.preventDefault()}},{typeSelectProps:M}=ms({keyboardDelegate:n,selectionManager:t});d||(C=(0,go.v)(M,C)),h||(T=null==t.focusedKey?0:-1);let E=Zo(t.collection);return{collectionProps:(0,go.v)(C,{tabIndex:T,"data-collection":E})}}class Ms{getItemRect(e){let t=this.ref.current;if(!t)return null;let n=null!=e?Yo(this.ref,e):null;if(!n)return null;let r=t.getBoundingClientRect(),i=n.getBoundingClientRect();return{x:i.left-r.left-t.clientLeft+t.scrollLeft,y:i.top-r.top-t.clientTop+t.scrollTop,width:i.width,height:i.height}}getContentSize(){let e=this.ref.current;var t,n;return{width:null!==(t=null===e||void 0===e?void 0:e.scrollWidth)&&void 0!==t?t:0,height:null!==(n=null===e||void 0===e?void 0:e.scrollHeight)&&void 0!==n?n:0}}getVisibleRect(){let e=this.ref.current;var t,n,r,i;return{x:null!==(t=null===e||void 0===e?void 0:e.scrollLeft)&&void 0!==t?t:0,y:null!==(n=null===e||void 0===e?void 0:e.scrollTop)&&void 0!==n?n:0,width:null!==(r=null===e||void 0===e?void 0:e.clientWidth)&&void 0!==r?r:0,height:null!==(i=null===e||void 0===e?void 0:e.clientHeight)&&void 0!==i?i:0}}constructor(e){this.ref=e}}class Es{isDisabled(e){var t;return"all"===this.disabledBehavior&&((null===(t=e.props)||void 0===t?void 0:t.isDisabled)||this.disabledKeys.has(e.key))}findNextNonDisabled(e,t){let n=e;for(;null!=n;){let e=this.collection.getItem(n);if("item"===(null===e||void 0===e?void 0:e.type)&&!this.isDisabled(e))return n;n=t(n)}return null}getNextKey(e){let t=e;return t=this.collection.getKeyAfter(t),this.findNextNonDisabled(t,e=>this.collection.getKeyAfter(e))}getPreviousKey(e){let t=e;return t=this.collection.getKeyBefore(t),this.findNextNonDisabled(t,e=>this.collection.getKeyBefore(e))}findKey(e,t,n){let r=e,i=this.layoutDelegate.getItemRect(r);if(!i||null==r)return null;let a=i;do{if(r=t(r),null==r)break;i=this.layoutDelegate.getItemRect(r)}while(i&&n(a,i)&&null!=r);return r}isSameRow(e,t){return e.y===t.y||e.x!==t.x}isSameColumn(e,t){return e.x===t.x||e.y!==t.y}getKeyBelow(e){return"grid"===this.layout&&"vertical"===this.orientation?this.findKey(e,e=>this.getNextKey(e),this.isSameRow):this.getNextKey(e)}getKeyAbove(e){return"grid"===this.layout&&"vertical"===this.orientation?this.findKey(e,e=>this.getPreviousKey(e),this.isSameRow):this.getPreviousKey(e)}getNextColumn(e,t){return t?this.getPreviousKey(e):this.getNextKey(e)}getKeyRightOf(e){let t="ltr"===this.direction?"getKeyRightOf":"getKeyLeftOf";return this.layoutDelegate[t]?(e=this.layoutDelegate[t](e),this.findNextNonDisabled(e,e=>this.layoutDelegate[t](e))):"grid"===this.layout?"vertical"===this.orientation?this.getNextColumn(e,"rtl"===this.direction):this.findKey(e,e=>this.getNextColumn(e,"rtl"===this.direction),this.isSameColumn):"horizontal"===this.orientation?this.getNextColumn(e,"rtl"===this.direction):null}getKeyLeftOf(e){let t="ltr"===this.direction?"getKeyLeftOf":"getKeyRightOf";return this.layoutDelegate[t]?(e=this.layoutDelegate[t](e),this.findNextNonDisabled(e,e=>this.layoutDelegate[t](e))):"grid"===this.layout?"vertical"===this.orientation?this.getNextColumn(e,"ltr"===this.direction):this.findKey(e,e=>this.getNextColumn(e,"ltr"===this.direction),this.isSameColumn):"horizontal"===this.orientation?this.getNextColumn(e,"ltr"===this.direction):null}getFirstKey(){let e=this.collection.getFirstKey();return this.findNextNonDisabled(e,e=>this.collection.getKeyAfter(e))}getLastKey(){let e=this.collection.getLastKey();return this.findNextNonDisabled(e,e=>this.collection.getKeyBefore(e))}getKeyPageAbove(e){let t=this.ref.current,n=this.layoutDelegate.getItemRect(e);if(!n)return null;if(t&&!(0,ys.o)(t))return this.getFirstKey();let r=e;if("horizontal"===this.orientation){let e=Math.max(0,n.x+n.width-this.layoutDelegate.getVisibleRect().width);for(;n&&n.x>e&&null!=r;)r=this.getKeyAbove(r),n=null==r?null:this.layoutDelegate.getItemRect(r)}else{let e=Math.max(0,n.y+n.height-this.layoutDelegate.getVisibleRect().height);for(;n&&n.y>e&&null!=r;)r=this.getKeyAbove(r),n=null==r?null:this.layoutDelegate.getItemRect(r)}return null!==r&&void 0!==r?r:this.getFirstKey()}getKeyPageBelow(e){let t=this.ref.current,n=this.layoutDelegate.getItemRect(e);if(!n)return null;if(t&&!(0,ys.o)(t))return this.getLastKey();let r=e;if("horizontal"===this.orientation){let e=Math.min(this.layoutDelegate.getContentSize().width,n.y-n.width+this.layoutDelegate.getVisibleRect().width);for(;n&&n.x<e&&null!=r;)r=this.getKeyBelow(r),n=null==r?null:this.layoutDelegate.getItemRect(r)}else{let e=Math.min(this.layoutDelegate.getContentSize().height,n.y-n.height+this.layoutDelegate.getVisibleRect().height);for(;n&&n.y<e&&null!=r;)r=this.getKeyBelow(r),n=null==r?null:this.layoutDelegate.getItemRect(r)}return null!==r&&void 0!==r?r:this.getLastKey()}getKeyForSearch(e,t){if(!this.collator)return null;let n=this.collection,r=t||this.getFirstKey();for(;null!=r;){let t=n.getItem(r);if(!t)return null;let i=t.textValue.slice(0,e.length);if(t.textValue&&0===this.collator.compare(i,e))return r;r=this.getNextKey(r)}return null}constructor(...e){if(1===e.length){let t=e[0];this.collection=t.collection,this.ref=t.ref,this.collator=t.collator,this.disabledKeys=t.disabledKeys||new Set,this.disabledBehavior=t.disabledBehavior||"all",this.orientation=t.orientation||"vertical",this.direction=t.direction,this.layout=t.layout||"stack",this.layoutDelegate=t.layoutDelegate||new Ms(t.ref)}else this.collection=e[0],this.disabledKeys=e[1],this.ref=e[2],this.collator=e[3],this.layout="stack",this.orientation="vertical",this.disabledBehavior="all",this.layoutDelegate=new Ms(this.ref);"stack"===this.layout&&"vertical"===this.orientation&&(this.getKeyLeftOf=void 0,this.getKeyRightOf=void 0)}}let Ps=new Map;function Ns(e){let{locale:t}=(0,Ts.Y)(),n=t+(e?Object.entries(e).sort((e,t)=>e[0]<t[0]?-1:1).join():"");if(Ps.has(n))return Ps.get(n);let r=new Intl.Collator(t,e);return Ps.set(n,r),r}function ks(e){let{selectionManager:t,collection:n,disabledKeys:i,ref:a,keyboardDelegate:o,layoutDelegate:s}=e,l=Ns({usage:"search",sensitivity:"base"}),c=t.disabledBehavior,u=(0,r.useMemo)(()=>o||new Es({collection:n,disabledKeys:i,disabledBehavior:c,ref:a,collator:l,layoutDelegate:s}),[o,s,n,i,a,l,c]),{collectionProps:d}=Cs({...e,ref:a,selectionManager:t,keyboardDelegate:u});return{listProps:d}}class Rs{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);var n;return t&&null!==(n=t.prevKey)&&void 0!==n?n:null}getKeyAfter(e){let t=this.keyMap.get(e);var n;return t&&null!==(n=t.nextKey)&&void 0!==n?n:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){var t;return null!==(t=this.keyMap.get(e))&&void 0!==t?t:null}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}constructor(e,{expandedKeys:t}={}){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=e,t=t||new Set;let n=e=>{if(this.keyMap.set(e.key,e),e.childNodes&&("section"===e.type||t.has(e.key)))for(let t of e.childNodes)n(t)};for(let o of e)n(o);let r=null,i=0;for(let[o,s]of this.keyMap)r?(r.nextKey=o,s.prevKey=r.key):(this.firstKey=o,s.prevKey=void 0),"item"===s.type&&(s.index=i++),r=s,r.nextKey=void 0;var a;this.lastKey=null!==(a=null===r||void 0===r?void 0:r.key)&&void 0!==a?a:null}}class Ls extends Set{constructor(e,t,n){super(e),e instanceof Ls?(this.anchorKey=null!==t&&void 0!==t?t:e.anchorKey,this.currentKey=null!==n&&void 0!==n?n:e.currentKey):(this.anchorKey=null!==t&&void 0!==t?t:null,this.currentKey=null!==n&&void 0!==n?n:null)}}var Os=n(8987);function js(e){let{selectionMode:t="none",disallowEmptySelection:n=!1,allowDuplicateSelectionEvents:i,selectionBehavior:a="toggle",disabledBehavior:o="all"}=e,s=(0,r.useRef)(!1),[,l]=(0,r.useState)(!1),c=(0,r.useRef)(null),u=(0,r.useRef)(null),[,d]=(0,r.useState)(null),h=(0,r.useMemo)(()=>Ds(e.selectedKeys),[e.selectedKeys]),p=(0,r.useMemo)(()=>Ds(e.defaultSelectedKeys,new Ls),[e.defaultSelectedKeys]),[f,m]=(0,Os.P)(h,p,e.onSelectionChange),g=(0,r.useMemo)(()=>e.disabledKeys?new Set(e.disabledKeys):new Set,[e.disabledKeys]),[v,A]=(0,r.useState)(a);"replace"===a&&"toggle"===v&&"object"===typeof f&&0===f.size&&A("replace");let y=(0,r.useRef)(a);return(0,r.useEffect)(()=>{a!==y.current&&(A(a),y.current=a)},[a]),{selectionMode:t,disallowEmptySelection:n,selectionBehavior:v,setSelectionBehavior:A,get isFocused(){return s.current},setFocused(e){s.current=e,l(e)},get focusedKey(){return c.current},get childFocusStrategy(){return u.current},setFocusedKey(e,t="first"){c.current=e,u.current=t,d(e)},selectedKeys:f,setSelectedKeys(e){!i&&function(e,t){if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}(e,f)||m(e)},disabledKeys:g,disabledBehavior:o}}function Ds(e,t){return e?"all"===e?"all":new Ls(e):t}class Is{get selectionMode(){return this.state.selectionMode}get disallowEmptySelection(){return this.state.disallowEmptySelection}get selectionBehavior(){return this.state.selectionBehavior}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}get isFocused(){return this.state.isFocused}setFocused(e){this.state.setFocused(e)}get focusedKey(){return this.state.focusedKey}get childFocusStrategy(){return this.state.childFocusStrategy}setFocusedKey(e,t){(null==e||this.collection.getItem(e))&&this.state.setFocusedKey(e,t)}get selectedKeys(){return"all"===this.state.selectedKeys?new Set(this.getSelectAllKeys()):this.state.selectedKeys}get rawSelection(){return this.state.selectedKeys}isSelected(e){if("none"===this.state.selectionMode)return!1;let t=this.getKey(e);return null!=t&&("all"===this.state.selectedKeys?this.canSelectItem(t):this.state.selectedKeys.has(t))}get isEmpty(){return"all"!==this.state.selectedKeys&&0===this.state.selectedKeys.size}get isSelectAll(){if(this.isEmpty)return!1;if("all"===this.state.selectedKeys)return!0;if(null!=this._isSelectAll)return this._isSelectAll;let e=this.getSelectAllKeys(),t=this.state.selectedKeys;return this._isSelectAll=e.every(e=>t.has(e)),this._isSelectAll}get firstSelectedKey(){let e=null;for(let n of this.state.selectedKeys){let t=this.collection.getItem(n);(!e||t&&zo(this.collection,t,e)<0)&&(e=t)}var t;return null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:null}get lastSelectedKey(){let e=null;for(let n of this.state.selectedKeys){let t=this.collection.getItem(n);(!e||t&&zo(this.collection,t,e)>0)&&(e=t)}var t;return null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:null}get disabledKeys(){return this.state.disabledKeys}get disabledBehavior(){return this.state.disabledBehavior}extendSelection(e){if("none"===this.selectionMode)return;if("single"===this.selectionMode)return void this.replaceSelection(e);let t,n=this.getKey(e);if(null!=n){if("all"===this.state.selectedKeys)t=new Ls([n],n,n);else{let e=this.state.selectedKeys;var r;let a=null!==(r=e.anchorKey)&&void 0!==r?r:n;var i;t=new Ls(e,a,n);for(let r of this.getKeyRange(a,null!==(i=e.currentKey)&&void 0!==i?i:n))t.delete(r);for(let r of this.getKeyRange(n,a))this.canSelectItem(r)&&t.add(r)}this.state.setSelectedKeys(t)}}getKeyRange(e,t){let n=this.collection.getItem(e),r=this.collection.getItem(t);return n&&r?zo(this.collection,n,r)<=0?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){var n;if(null===(n=this.layoutDelegate)||void 0===n?void 0:n.getKeyRange)return this.layoutDelegate.getKeyRange(e,t);let r=[],i=e;for(;null!=i;){let e=this.collection.getItem(i);if(e&&("item"===e.type||"cell"===e.type&&this.allowsCellSelection)&&r.push(i),i===t)return r;i=this.collection.getKeyAfter(i)}return[]}getKey(e){let t=this.collection.getItem(e);if(!t)return e;if("cell"===t.type&&this.allowsCellSelection)return e;for(;t&&"item"!==t.type&&null!=t.parentKey;)t=this.collection.getItem(t.parentKey);return t&&"item"===t.type?t.key:null}toggleSelection(e){if("none"===this.selectionMode)return;if("single"===this.selectionMode&&!this.isSelected(e))return void this.replaceSelection(e);let t=this.getKey(e);if(null==t)return;let n=new Ls("all"===this.state.selectedKeys?this.getSelectAllKeys():this.state.selectedKeys);n.has(t)?n.delete(t):this.canSelectItem(t)&&(n.add(t),n.anchorKey=t,n.currentKey=t),this.disallowEmptySelection&&0===n.size||this.state.setSelectedKeys(n)}replaceSelection(e){if("none"===this.selectionMode)return;let t=this.getKey(e);if(null==t)return;let n=this.canSelectItem(t)?new Ls([t],t,t):new Ls;this.state.setSelectedKeys(n)}setSelectedKeys(e){if("none"===this.selectionMode)return;let t=new Ls;for(let n of e){let e=this.getKey(n);if(null!=e&&(t.add(e),"single"===this.selectionMode))break}this.state.setSelectedKeys(t)}getSelectAllKeys(){let e=[],t=n=>{for(;null!=n;){if(this.canSelectItem(n)){var r;let a=this.collection.getItem(n);var i;"item"===(null===a||void 0===a?void 0:a.type)&&e.push(n),(null===a||void 0===a?void 0:a.hasChildNodes)&&(this.allowsCellSelection||"item"!==a.type)&&t(null!==(i=null===(r=Fo(Bo(a,this.collection)))||void 0===r?void 0:r.key)&&void 0!==i?i:null)}n=this.collection.getKeyAfter(n)}};return t(this.collection.getFirstKey()),e}selectAll(){this.isSelectAll||"multiple"!==this.selectionMode||this.state.setSelectedKeys("all")}clearSelection(){!this.disallowEmptySelection&&("all"===this.state.selectedKeys||this.state.selectedKeys.size>0)&&this.state.setSelectedKeys(new Ls)}toggleSelectAll(){this.isSelectAll?this.clearSelection():this.selectAll()}select(e,t){"none"!==this.selectionMode&&("single"===this.selectionMode?this.isSelected(e)&&!this.disallowEmptySelection?this.toggleSelection(e):this.replaceSelection(e):"toggle"===this.selectionBehavior||t&&("touch"===t.pointerType||"virtual"===t.pointerType)?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys)return!0;let t=this.selectedKeys;if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;for(let n of t)if(!e.has(n))return!1;return!0}canSelectItem(e){var t;if("none"===this.state.selectionMode||this.state.disabledKeys.has(e))return!1;let n=this.collection.getItem(e);return!(!n||(null===n||void 0===n||null===(t=n.props)||void 0===t?void 0:t.isDisabled)||"cell"===n.type&&!this.allowsCellSelection)}isDisabled(e){var t,n;return"all"===this.state.disabledBehavior&&(this.state.disabledKeys.has(e)||!!(null===(n=this.collection.getItem(e))||void 0===n||null===(t=n.props)||void 0===t?void 0:t.isDisabled))}isLink(e){var t,n;return!!(null===(n=this.collection.getItem(e))||void 0===n||null===(t=n.props)||void 0===t?void 0:t.href)}getItemProps(e){var t;return null===(t=this.collection.getItem(e))||void 0===t?void 0:t.props}withCollection(e){return new Is(e,this.state,{allowsCellSelection:this.allowsCellSelection,layoutDelegate:this.layoutDelegate||void 0})}constructor(e,t,n){var r;this.collection=e,this.state=t,this.allowsCellSelection=null!==(r=null===n||void 0===n?void 0:n.allowsCellSelection)&&void 0!==r&&r,this._isSelectAll=null,this.layoutDelegate=(null===n||void 0===n?void 0:n.layoutDelegate)||null}}class Bs{build(e,t){return this.context=t,Fs(()=>this.iterateCollection(e))}*iterateCollection(e){let{children:t,items:n}=e;if(r.isValidElement(t)&&t.type===r.Fragment)yield*this.iterateCollection({children:t.props.children,items:n});else if("function"===typeof t){if(!n)throw new Error("props.children was a function but props.items is missing");let e=0;for(let r of n)yield*this.getFullNode({value:r,index:e},{renderer:t}),e++}else{let e=[];r.Children.forEach(t,t=>{t&&e.push(t)});let n=0;for(let t of e){let e=this.getFullNode({element:t,index:n},{});for(let t of e)n++,yield t}}}getKey(e,t,n,r){if(null!=e.key)return e.key;if("cell"===t.type&&null!=t.key)return`${r}${t.key}`;let i=t.value;if(null!=i){var a;let e=null!==(a=i.key)&&void 0!==a?a:i.id;if(null==e)throw new Error("No key found for item");return e}return r?`${r}.${t.index}`:`$.${t.index}`}getChildState(e,t){return{renderer:t.renderer||e.renderer}}*getFullNode(e,t,n,i){if(r.isValidElement(e.element)&&e.element.type===r.Fragment){let o=[];var a;r.Children.forEach(e.element.props.children,e=>{o.push(e)});let s=null!==(a=e.index)&&void 0!==a?a:0;for(const e of o)yield*this.getFullNode({element:e,index:s++},t,n,i);return}let o=e.element;if(!o&&e.value&&t&&t.renderer){let n=this.cache.get(e.value);if(n&&(!n.shouldInvalidate||!n.shouldInvalidate(this.context)))return n.index=e.index,n.parentKey=i?i.key:null,void(yield n);o=t.renderer(e.value)}if(r.isValidElement(o)){let r=o.type;if("function"!==typeof r&&"function"!==typeof r.getCollectionNode){let e=o.type;throw new Error(`Unknown element <${e}> in collection.`)}let a=r.getCollectionNode(o.props,this.context);var s;let h=null!==(s=e.index)&&void 0!==s?s:0,p=a.next();for(;!p.done&&p.value;){let r=p.value;var l;e.index=h;let s=null!==(l=r.key)&&void 0!==l?l:null;null==s&&(s=r.element?null:this.getKey(o,e,t,n));let f=[...this.getFullNode({...r,key:s,index:h,wrapper:zs(e.wrapper,r.wrapper)},this.getChildState(t,r),n?`${n}${o.key}`:o.key,i)];for(let t of f){var c,u,d;if(t.value=null!==(u=null!==(c=r.value)&&void 0!==c?c:e.value)&&void 0!==u?u:null,t.value&&this.cache.set(t.value,t),e.type&&t.type!==e.type)throw new Error(`Unsupported type <${Us(t.type)}> in <${Us(null!==(d=null===i||void 0===i?void 0:i.type)&&void 0!==d?d:"unknown parent type")}>. Only <${Us(e.type)}> is supported.`);h++,yield t}p=a.next(f)}return}if(null==e.key||null==e.type)return;let h=this;var p,f;let m={type:e.type,props:e.props,key:e.key,parentKey:i?i.key:null,value:null!==(p=e.value)&&void 0!==p?p:null,level:i?i.level+1:0,index:e.index,rendered:e.rendered,textValue:null!==(f=e.textValue)&&void 0!==f?f:"","aria-label":e["aria-label"],wrapper:e.wrapper,shouldInvalidate:e.shouldInvalidate,hasChildNodes:e.hasChildNodes||!1,childNodes:Fs(function*(){if(!e.hasChildNodes||!e.childNodes)return;let n=0;for(let r of e.childNodes()){null!=r.key&&(r.key=`${m.key}${r.key}`);let e=h.getFullNode({...r,index:n},h.getChildState(t,r),m.key,m);for(let t of e)n++,yield t}})};yield m}constructor(){this.cache=new WeakMap}}function Fs(e){let t=[],n=null;return{*[Symbol.iterator](){for(let e of t)yield e;n||(n=e());for(let e of n)t.push(e),yield e}}}function zs(e,t){return e&&t?n=>e(t(n)):e||(t||void 0)}function Us(e){return e[0].toUpperCase()+e.slice(1)}function Vs(e,t,n){let i=(0,r.useMemo)(()=>new Bs,[]),{children:a,items:o,collection:s}=e,l=(0,r.useMemo)(()=>{if(s)return s;let e=i.build({children:a,items:o},n);return t(e)},[i,a,o,s,n,t]);return l}function Gs(e){let{onExpandedChange:t}=e,[n,i]=(0,Os.P)(e.expandedKeys?new Set(e.expandedKeys):void 0,e.defaultExpandedKeys?new Set(e.defaultExpandedKeys):new Set,t),a=js(e),o=(0,r.useMemo)(()=>e.disabledKeys?new Set(e.disabledKeys):new Set,[e.disabledKeys]),s=Vs(e,(0,r.useCallback)(e=>new Rs(e,{expandedKeys:n}),[n]),null);(0,r.useEffect)(()=>{null==a.focusedKey||s.getItem(a.focusedKey)||a.setFocusedKey(null)},[s,a.focusedKey]);return{collection:s,expandedKeys:n,disabledKeys:o,toggleKey:e=>{i(function(e,t){let n=new Set(e);n.has(t)?n.delete(t):n.add(t);return n}(n,e))},setExpandedKeys:i,selectionManager:new Is(s,a)}}function qs(e){var t;const n=(0,Bn.o)(),{as:i,ref:a,variant:o,color:s,children:l,disableAnimation:c=null!=(t=null==n?void 0:n.disableAnimation)&&t,onAction:u,closeOnSelect:d,itemClasses:h,className:p,state:f,topContent:m,bottomContent:g,hideEmptyContent:v=!1,hideSelectedIcon:A=!1,emptyContent:y="No items.",menuProps:b,onClose:x,classNames:_,...w}=e,S=i||"ul",T=(0,Wa.zD)(a),C="string"===typeof S,M=Gs({...w,...b,children:l}),E=f||M,{menuProps:P}=function(e,t,n){let{shouldFocusWrap:r=!0,onKeyDown:i,onKeyUp:a,...o}=e;!e["aria-label"]&&e["aria-labelledby"];let s=(0,Io.$)(e,{labelable:!0}),{listProps:l}=ks({...o,ref:n,selectionManager:t.selectionManager,collection:t.collection,disabledKeys:t.disabledKeys,shouldFocusWrap:r,linkBehavior:"override"});return jo.set(t,{onClose:e.onClose,onAction:e.onAction,shouldUseVirtualFocus:e.shouldUseVirtualFocus}),{menuProps:(0,go.v)(s,{onKeyDown:i,onKeyUp:a},{role:"menu",...l,onKeyDown:t=>{var n;("Escape"!==t.key||e.shouldUseVirtualFocus)&&(null===(n=l.onKeyDown)||void 0===n||n.call(l,t))}})}}({...w,...b,onAction:u},E,T),N=(0,r.useMemo)(()=>(0,qa.MK)({className:p}),[p]),k=(0,Dn.cn)(null==_?void 0:_.base,p);return{Component:S,state:E,variant:o,color:s,disableAnimation:c,onClose:x,topContent:m,bottomContent:g,closeOnSelect:d,className:p,itemClasses:h,getBaseProps:(e={})=>({ref:T,"data-slot":"base",className:N.base({class:k}),...(0,Xa.$)(w,{enabled:C}),...e}),getListProps:(e={})=>({"data-slot":"list",className:N.list({class:null==_?void 0:_.list}),...P,...e}),hideEmptyContent:v,hideSelectedIcon:A,getEmptyContentProps:(e={})=>({children:y,className:N.emptyContent({class:null==_?void 0:_.emptyContent}),...e})}}var Ws=(0,Ln.Rf)(function(e,t){const{Component:n,state:r,closeOnSelect:i,color:a,disableAnimation:o,hideSelectedIcon:s,hideEmptyContent:l,variant:c,onClose:u,topContent:d,bottomContent:h,itemClasses:p,getBaseProps:f,getListProps:m,getEmptyContentProps:g}=qs({...e,ref:t}),v=(0,gt.jsxs)(n,{...m(),children:[!r.collection.size&&!l&&(0,gt.jsx)("li",{children:(0,gt.jsx)("div",{...g()})}),[...r.collection].map(e=>{const t={closeOnSelect:i,color:a,disableAnimation:o,item:e,state:r,variant:c,onClose:u,hideSelectedIcon:s,...e.props},n=(0,qa.zP)(p,null==t?void 0:t.classNames);if("section"===e.type)return(0,gt.jsx)(fs,{...t,itemClasses:n},e.key);let l=(0,gt.jsx)(hs,{...t,classNames:n},e.key);return e.wrapper&&(l=e.wrapper(l)),l})]});return(0,gt.jsxs)("div",{...f(),children:[d,v,h]})}),Hs=Ws,$s=(0,Ln.Rf)(function(e,t){const{getMenuProps:n}=no();return(0,gt.jsx)(ko.C,{children:(0,gt.jsx)(Ro.n1,{contain:!0,restoreFocus:!0,children:(0,gt.jsx)(Hs,{...n(e,t)})})})});function Ks(e){return null}function Xs(e){return null!=e.hasChildItems?e.hasChildItems:!!e.childItems||!!(e.title&&r.Children.count(e.children)>0)}Ks.getCollectionNode=function*(e,t){let{childItems:n,title:i,children:a}=e,o=e.title||e.children,s=e.textValue||("string"===typeof o?o:"")||e["aria-label"]||"";!s&&(null===t||void 0===t||t.suppressTextValueWarning),yield{type:"item",props:e,rendered:o,textValue:s,"aria-label":e["aria-label"],hasChildNodes:Xs(e),*childNodes(){if(n)for(let e of n)yield{type:"item",value:e};else if(i){let e=[];r.Children.forEach(a,t=>{e.push({type:"item",element:t})}),yield*e}}}};let Ys=Ks;var Qs=Ys;var Zs=e=>(0,gt.jsx)("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 0 24 24",width:"1em",...e,children:(0,gt.jsx)("path",{d:"M12 2a10 10 0 1010 10A10.016 10.016 0 0012 2zm3.36 12.3a.754.754 0 010 1.06.748.748 0 01-1.06 0l-2.3-2.3-2.3 2.3a.748.748 0 01-1.06 0 .754.754 0 010-1.06l2.3-2.3-2.3-2.3A.75.75 0 019.7 8.64l2.3 2.3 2.3-2.3a.75.75 0 011.06 1.06l-2.3 2.3z",fill:"currentColor"})}),Js=(0,Ln.Rf)((e,t)=>{const{Component:n,children:i,slots:a,classNames:o,isDot:s,isCloseable:l,startContent:c,endContent:u,getCloseButtonProps:d,getChipProps:h}=function(e){const[t,n]=(0,Ln.rE)(e,qa.jw.variantKeys),{ref:i,as:a,children:o,avatar:s,startContent:l,endContent:c,onClose:u,classNames:d,className:h,...p}=t,f=a||"div",m=(0,Wa.zD)(i),g=(0,Dn.cn)(null==d?void 0:d.base,h),v=!!u,A="dot"===e.variant,{focusProps:y,isFocusVisible:b}=(0,Oo.o)(),x=(0,r.useMemo)(()=>"string"===typeof o&&1===(null==o?void 0:o.length),[o]),_=(0,r.useMemo)(()=>!!s||!!l,[s,l]),w=(0,r.useMemo)(()=>!!c||v,[c,v]),S=(0,r.useMemo)(()=>(0,qa.jw)({...n,hasStartContent:_,hasEndContent:w,isOneChar:x,isCloseable:v,isCloseButtonFocusVisible:b}),[(0,In.t6)(n),b,_,w,x,v]),{pressProps:T}=(0,lo.d)({isDisabled:!!(null==e?void 0:e.isDisabled),onPress:u}),C=e=>(0,r.isValidElement)(e)?(0,r.cloneElement)(e,{className:(0,Dn.cn)("max-h-[80%]",e.props.className)}):null;return{Component:f,children:o,slots:S,classNames:d,isDot:A,isCloseable:v,startContent:(M=s,((0,r.isValidElement)(M)?(0,r.cloneElement)(M,{className:S.avatar({class:null==d?void 0:d.avatar})}):null)||C(l)),endContent:C(c),getCloseButtonProps:()=>({role:"button",tabIndex:0,className:S.closeButton({class:null==d?void 0:d.closeButton}),"aria-label":"close chip",...(0,In.v6)(T,y)}),getChipProps:()=>({ref:m,className:S.base({class:g}),...p})};var M}({...e,ref:t}),p=(0,r.useMemo)(()=>s&&!c?(0,gt.jsx)("span",{className:a.dot({class:null==o?void 0:o.dot})}):c,[a,c,s]),f=(0,r.useMemo)(()=>l?(0,gt.jsx)("span",{...d(),children:u||(0,gt.jsx)(Zs,{})}):u,[u,l,d]);return(0,gt.jsxs)(n,{...h(),children:[p,(0,gt.jsx)("span",{className:a.content({class:null==o?void 0:o.content}),children:i}),f]})});Js.displayName="HeroUI.Chip";var el=Js,tl=n(2220),nl=n(8332),rl=n(9715),il=n(3965),al=n(4760),ol=n(106);var sl=n(7449),ll=n(8412),cl=n(1853),ul=n(9565),dl=n(6031),hl=n(3861),pl=n(8945);function fl(e,t,n,r){return(0,hl.k)(e,t,(0,pl.F)(n),r)}var ml=n(6772);function gl(e){return e.max-e.min}function vl(e,t,n,r=.5){e.origin=r,e.originPoint=(0,cl.k)(t.min,t.max,e.origin),e.scale=gl(n)/gl(t),e.translate=(0,cl.k)(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Al(e,t,n,r){vl(e.x,t.x,n.x,r?r.originX:void 0),vl(e.y,t.y,n.y,r?r.originY:void 0)}function yl(e,t,n){e.min=n.min+t.min,e.max=e.min+gl(t)}function bl(e,t,n){e.min=t.min-n.min,e.max=e.min+gl(t)}function xl(e,t,n){bl(e.x,t.x,n.x),bl(e.y,t.y,n.y)}var _l=n(8093);function wl(e){return[e("x"),e("y")]}var Sl=n(6358);const Tl=({current:e})=>e?e.ownerDocument.defaultView:null;var Cl=n(7380),Ml=n(6268),El=n(7475),Pl=n(8560),Nl=n(3084);const kl=(e,t)=>Math.abs(e-t);class Rl{constructor(e,t,{transformPagePoint:n,contextWindow:r=window,dragSnapToOrigin:i=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=jl(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=kl(e.x,t.x),r=kl(e.y,t.y);return Math.sqrt(n**2+r**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!n)return;const{point:r}=e,{timestamp:i}=ll.uv;this.history.push({...r,timestamp:i});const{onStart:a,onMove:o}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Ll(t,this.transformPagePoint),ll.Gt.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:r,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=jl("pointercancel"===e.type?this.lastMoveEventInfo:Ll(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,a),r&&r(e,a)},!(0,El.M)(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=a,this.contextWindow=r||window;const o=Ll((0,pl.e)(e),this.transformPagePoint),{point:s}=o,{timestamp:l}=ll.uv;this.history=[{...s,timestamp:l}];const{onSessionStart:c}=t;c&&c(e,jl(o,this.history)),this.removeListeners=(0,Pl.F)(fl(this.contextWindow,"pointermove",this.handlePointerMove),fl(this.contextWindow,"pointerup",this.handlePointerUp),fl(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),(0,ll.WG)(this.updatePoint)}}function Ll(e,t){return t?{point:t(e.point)}:e}function Ol(e,t){return{x:e.x-t.x,y:e.y-t.y}}function jl({point:e},t){return{point:e,delta:Ol(e,Il(t)),offset:Ol(e,Dl(t)),velocity:Bl(t,.1)}}function Dl(e){return e[0]}function Il(e){return e[e.length-1]}function Bl(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null;const i=Il(e);for(;n>=0&&(r=e[n],!(i.timestamp-r.timestamp>(0,Nl.f)(t)));)n--;if(!r)return{x:0,y:0};const a=(0,Nl.X)(i.timestamp-r.timestamp);if(0===a)return{x:0,y:0};const o={x:(i.x-r.x)/a,y:(i.y-r.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}var Fl=n(2349),zl=n(217);function Ul(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function Vl(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}const Gl=.35;function ql(e,t,n){return{min:Wl(e,t),max:Wl(e,n)}}function Wl(e,t){return"number"===typeof e?e:e[t]||0}const Hl=new WeakMap;class $l{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=(0,_l.ge)(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:n}={}){const{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Rl(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor((0,pl.e)(e).point)},onStart:(e,t)=>{const{drag:n,dragPropagation:r,onDragStart:i}=this.getProps();if(n&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=n)||"y"===a?ol.I[a]?null:(ol.I[a]=!0,()=>{ol.I[a]=!1}):ol.I.x||ol.I.y?null:(ol.I.x=ol.I.y=!0,()=>{ol.I.x=ol.I.y=!1}),!this.openDragLock))return;var a;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),wl(e=>{let t=this.getAxisMotionValue(e).get()||0;if(sl.KN.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const r=n.layout.layoutBox[e];if(r){t=gl(r)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),i&&ll.Gt.postRender(()=>i(e,t)),(0,Ml.g)(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:n,dragDirectionLock:r,onDirectionLock:i,onDrag:a}=this.getProps();if(!n&&!this.openDragLock)return;const{offset:o}=t;if(r&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(o),void(null!==this.currentDirection&&i&&i(this.currentDirection));this.updateAxis("x",t.point,o),this.updateAxis("y",t.point,o),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>wl(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play())},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,distanceThreshold:n,contextWindow:Tl(this.visualElement)})}stop(e,t){const n=e||this.latestPointerEvent,r=t||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!r||!n)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&ll.Gt.postRender(()=>o(n,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!Kl(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:t,max:n},r){return void 0!==t&&e<t?e=r?(0,cl.k)(t,e,r.min):Math.max(e,t):void 0!==n&&e>n&&(e=r?(0,cl.k)(n,e,r.max):Math.min(e,n)),e}(a,this.constraints[e],this.elastic[e])),i.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&(0,Cl.X)(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!n)&&function(e,{top:t,left:n,bottom:r,right:i}){return{x:Ul(e.x,n,i),y:Ul(e.y,t,r)}}(n.layoutBox,e),this.elastic=function(e=Gl){return!1===e?e=0:!0===e&&(e=Gl),{x:ql(e,"left","right"),y:ql(e,"top","bottom")}}(t),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&wl(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(n.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!(0,Cl.X)(e))return!1;const n=e.current;(0,ul.V)(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");const{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=(0,Sl.L)(n,r.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:Vl(e.x,t.x),y:Vl(e.y,t.y)}}(r.layout.layoutBox,i);if(t){const e=t((0,ml.pA)(a));this.hasMutatedConstraints=!!e,e&&(a=(0,ml.FY)(e))}return a}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},l=wl(o=>{if(!Kl(o,t,this.currentDirection))return;let l=s&&s[o]||{};a&&(l={min:0,max:0});const c=r?200:1e6,u=r?40:1e7,d={type:"inertia",velocity:n?e[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...i,...l};return this.startAxisValueAnimation(o,d)});return Promise.all(l).then(o)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return(0,Ml.g)(this.visualElement,e),n.start((0,dl.f)(e,n,0,t,this.visualElement,!1))}stopAnimation(){wl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){wl(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){wl(t=>{const{drag:n}=this.getProps();if(!Kl(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:n,max:a}=r.layout.layoutBox[t];i.set(e[t]-(0,cl.k)(n,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!(0,Cl.X)(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};wl(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();r[e]=function(e,t){let n=.5;const r=gl(e),i=gl(t);return i>r?n=(0,Fl.q)(t.min,t.max-r,e.min):r>i&&(n=(0,Fl.q)(e.min,e.max-i,t.min)),(0,zl.q)(0,1,n)}({min:n,max:n},this.constraints[e])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),wl(t=>{if(!Kl(t,e,null))return;const n=this.getAxisMotionValue(t),{min:i,max:a}=this.constraints[t];n.set((0,cl.k)(i,a,r[t]))})}addListeners(){if(!this.visualElement.current)return;Hl.set(this.visualElement,this);const e=fl(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();(0,Cl.X)(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,r=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),ll.Gt.read(t);const i=(0,hl.k)(window,"resize",()=>this.scalePositionWithinConstraints()),a=n.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(wl(t=>{const n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{i(),e(),r(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:a=Gl,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:a,dragMomentum:o}}}function Kl(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}class Xl extends il.X{constructor(e){super(e),this.removeGroupControls=al.l,this.removeListeners=al.l,this.controls=new $l(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||al.l}unmount(){this.removeGroupControls(),this.removeListeners()}}const Yl=e=>(t,n)=>{e&&ll.Gt.postRender(()=>e(t,n))};class Ql extends il.X{constructor(){super(...arguments),this.removePointerDownListener=al.l}onPointerDown(e){this.session=new Rl(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Tl(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:Yl(e),onStart:Yl(t),onMove:n,onEnd:(e,t)=>{delete this.session,r&&ll.Gt.postRender(()=>r(e,t))}}}mount(){this.removePointerDownListener=fl(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}var Zl=n(2408),Jl=n(8917),ec=n(2190),tc=n(3874);const nc={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function rc(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ic={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!sl.px.test(e))return e;e=parseFloat(e)}return`${rc(e,t.target.x)}% ${rc(e,t.target.y)}%`}};var ac=n(2326);const oc={correct:(e,{treeScale:t,projectionDelta:n})=>{const r=e,i=ac.f.parse(e);if(i.length>5)return r;const a=ac.f.createTransformer(e),o="number"!==typeof i[0]?1:0,s=n.x.scale*t.x,l=n.y.scale*t.y;i[0+o]/=s,i[1+o]/=l;const c=(0,cl.k)(s,l,.5);return"number"===typeof i[2+o]&&(i[2+o]/=c),"number"===typeof i[3+o]&&(i[3+o]/=c),a(i)}};var sc=n(4886);let lc=!1;class cc extends r.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;(0,sc.$)(dc),i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),lc&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),nc.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,{projection:a}=n;return a?(a.isPresent=i,lc=!0,r||e.layoutDependency!==t||void 0===t||e.isPresent!==i?a.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?a.promote():a.relegate()||ll.Gt.postRender(()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Zl.k.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;lc=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function uc(e){const[t,n]=(0,Jl.xQ)(),i=(0,r.useContext)(ec.L);return(0,gt.jsx)(cc,{...e,layoutGroup:i,switchLayoutGroup:(0,r.useContext)(tc.N),isPresent:t,safeToRemove:n})}const dc={borderRadius:{...ic,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ic,borderTopRightRadius:ic,borderBottomLeftRadius:ic,borderBottomRightRadius:ic,boxShadow:oc};var hc=n(7151),pc=n(8328);function fc(e){return(0,pc.G)(e)&&"ownerSVGElement"in e}var mc=n(8878),gc=n(7178),vc=n(8523),Ac=n(7189),yc=n(6317),bc=n(3964);var xc=n(6485),_c=n(9755);const wc=(e,t)=>e.depth-t.depth;class Sc{constructor(){this.children=[],this.isDirty=!1}add(e){(0,_c.Kq)(this.children,e),this.isDirty=!0}remove(e){(0,_c.Ai)(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(wc),this.isDirty=!1,this.children.forEach(e)}}function Tc(e,t){const n=gc.k.now(),r=({timestamp:i})=>{const a=i-n;a>=t&&((0,ll.WG)(r),e(a-t))};return ll.Gt.setup(r,!0),()=>(0,ll.WG)(r)}var Cc=n(6061),Mc=n(2427);const Ec=["TopLeft","TopRight","BottomLeft","BottomRight"],Pc=Ec.length,Nc=e=>"string"===typeof e?parseFloat(e):e,kc=e=>"number"===typeof e||sl.px.test(e);function Rc(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Lc=jc(0,.5,Mc.yT),Oc=jc(.5,.95,al.l);function jc(e,t,n){return r=>r<e?0:r>t?1:n((0,Fl.q)(e,t,r))}function Dc(e,t){e.min=t.min,e.max=t.max}function Ic(e,t){Dc(e.x,t.x),Dc(e.y,t.y)}function Bc(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}var Fc=n(7664);function zc(e,t,n,r,i){return e-=t,e=(0,Fc.hq)(e,1/n,r),void 0!==i&&(e=(0,Fc.hq)(e,1/i,r)),e}function Uc(e,t,[n,r,i],a,o){!function(e,t=0,n=1,r=.5,i,a=e,o=e){sl.KN.test(t)&&(t=parseFloat(t),t=(0,cl.k)(o.min,o.max,t/100)-o.min);if("number"!==typeof t)return;let s=(0,cl.k)(a.min,a.max,r);e===a&&(s-=t),e.min=zc(e.min,t,n,s,i),e.max=zc(e.max,t,n,s,i)}(e,t[n],t[r],t[i],t.scale,a,o)}const Vc=["x","scaleX","originX"],Gc=["y","scaleY","originY"];function qc(e,t,n,r){Uc(e.x,t,Vc,n?n.x:void 0,r?r.x:void 0),Uc(e.y,t,Gc,n?n.y:void 0,r?r.y:void 0)}function Wc(e){return 0===e.translate&&1===e.scale}function Hc(e){return Wc(e.x)&&Wc(e.y)}function $c(e,t){return e.min===t.min&&e.max===t.max}function Kc(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Xc(e,t){return Kc(e.x,t.x)&&Kc(e.y,t.y)}function Yc(e){return gl(e.x)/gl(e.y)}function Qc(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Zc{constructor(){this.members=[]}add(e){(0,_c.Kq)(this.members,e),e.scheduleRender()}remove(e){if((0,_c.Ai)(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let n;for(let r=t;r>=0;r--){const e=this.members[r];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}var Jc=n(4077);const eu={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},tu=["","X","Y","Z"];let nu=0;function ru(e,t,n,r){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),r&&(r[e]=0))}function iu(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=(0,xc.P)(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:t,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",ll.Gt,!(t||r))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&iu(r)}function au({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(e={},n=t?.()){this.id=nu++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,hc.Q.value&&(eu.nodes=eu.calculatedTargetDeltas=eu.calculatedProjections=0),this.nodes.forEach(lu),this.nodes.forEach(mu),this.nodes.forEach(gu),this.nodes.forEach(cu),hc.Q.addProjectionMetrics&&hc.Q.addProjectionMetrics(eu)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new Sc)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new yc.v),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const n=this.eventHandlers.get(e);n&&n.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var n;this.isSVG=fc(t)&&!(fc(n=t)&&"svg"===n.tagName),this.instance=t;const{layoutId:r,layout:i,visualElement:a}=this.options;if(a&&!a.current&&a.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(i||r)&&(this.isLayoutDirty=!0),e){let n,r=0;const i=()=>this.root.updateBlockedByResize=!1;ll.Gt.read(()=>{r=window.innerWidth}),e(t,()=>{const e=window.innerWidth;e!==r&&(r=e,this.root.updateBlockedByResize=!0,n&&n(),n=Tc(i,250),nc.hasAnimatedSinceResize&&(nc.hasAnimatedSinceResize=!1,this.nodes.forEach(fu)))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&a&&(r||i)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:n,layout:r})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const i=this.options.transition||a.getDefaultTransition()||_u,{onLayoutAnimationStart:o,onLayoutAnimationComplete:s}=a.getProps(),l=!this.targetLayout||!Xc(this.targetLayout,r),c=!t&&n;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...(0,mc.r)(i,"layout"),onPlay:o,onComplete:s};(a.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||fu(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),(0,ll.WG)(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(vu),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&iu(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let i=0;i<this.path.length;i++){const e=this.path[i];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(du);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(hu);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(pu),this.nodes.forEach(ou),this.nodes.forEach(su)):this.nodes.forEach(hu),this.clearAllSnapshots();const e=gc.k.now();ll.uv.delta=(0,zl.q)(0,1e3/60,e-ll.uv.timestamp),ll.uv.timestamp=e,ll.uv.isProcessing=!0,ll.PP.update.process(ll.uv),ll.PP.preRender.process(ll.uv),ll.PP.render.process(ll.uv),ll.uv.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Zl.k.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(uu),this.sharedNodes.forEach(Au)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ll.Gt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ll.Gt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||gl(this.snapshot.measuredBox.x)||gl(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected=(0,_l.ge)(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Hc(this.projectionDelta),n=this.getTransformTemplate(),r=n?n(this.latestValues,""):void 0,a=r!==this.prevTransformTemplateValue;e&&this.instance&&(t||(0,Jc.HD)(this.latestValues)||a)&&(i(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let n=this.removeElementScroll(t);var r;return e&&(n=this.removeTransform(n)),Tu((r=n).x),Tu(r.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return(0,_l.ge)();const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Mu))){const{scroll:e}=this.root;e&&((0,Fc.Ql)(t.x,e.offset.x),(0,Fc.Ql)(t.y,e.offset.y))}return t}removeElementScroll(e){const t=(0,_l.ge)();if(Ic(t,e),this.scroll?.wasRoot)return t;for(let n=0;n<this.path.length;n++){const r=this.path[n],{scroll:i,options:a}=r;r!==this.root&&i&&a.layoutScroll&&(i.wasRoot&&Ic(t,e),(0,Fc.Ql)(t.x,i.offset.x),(0,Fc.Ql)(t.y,i.offset.y))}return t}applyTransform(e,t=!1){const n=(0,_l.ge)();Ic(n,e);for(let r=0;r<this.path.length;r++){const e=this.path[r];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&(0,Fc.Ww)(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),(0,Jc.HD)(e.latestValues)&&(0,Fc.Ww)(n,e.latestValues)}return(0,Jc.HD)(this.latestValues)&&(0,Fc.Ww)(n,this.latestValues),n}removeTransform(e){const t=(0,_l.ge)();Ic(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!(0,Jc.HD)(e.latestValues))continue;(0,Jc.vk)(e.latestValues)&&e.updateSnapshot();const r=(0,_l.ge)();Ic(r,e.measurePageBox()),qc(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,r)}return(0,Jc.HD)(this.latestValues)&&qc(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ll.uv.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==t;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:i}=this.options;if(this.layout&&(r||i)){if(this.resolvedRelativeTargetAt=ll.uv.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=(0,_l.ge)(),this.relativeTargetOrigin=(0,_l.ge)(),xl(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Ic(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var a,o,s;if(this.target||(this.target=(0,_l.ge)(),this.targetWithTransforms=(0,_l.ge)()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),a=this.target,o=this.relativeTarget,s=this.relativeParent.target,yl(a.x,o.x,s.x),yl(a.y,o.y,s.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Ic(this.target,this.layout.layoutBox),(0,Fc.o4)(this.target,this.targetDelta)):Ic(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=(0,_l.ge)(),this.relativeTargetOrigin=(0,_l.ge)(),xl(this.relativeTargetOrigin,this.target,e.target),Ic(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}hc.Q.value&&eu.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!(0,Jc.vk)(this.parent.latestValues)&&!(0,Jc.vF)(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let n=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(n=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===ll.uv.timestamp&&(n=!1),n)return;const{layout:r,layoutId:i}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!i)return;Ic(this.layoutCorrected,this.layout.layoutBox);const a=this.treeScale.x,o=this.treeScale.y;(0,Fc.OU)(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms=(0,_l.ge)());const{target:s}=e;s?(this.projectionDelta&&this.prevProjectionDelta?(Bc(this.prevProjectionDelta.x,this.projectionDelta.x),Bc(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Al(this.projectionDelta,this.layoutCorrected,s,this.latestValues),this.treeScale.x===a&&this.treeScale.y===o&&Qc(this.projectionDelta.x,this.prevProjectionDelta.x)&&Qc(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",s)),hc.Q.value&&eu.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=(0,_l.xU)(),this.projectionDelta=(0,_l.xU)(),this.projectionDeltaWithTransform=(0,_l.xU)()}setAnimationOrigin(e,t=!1){const n=this.snapshot,r=n?n.latestValues:{},i={...this.latestValues},a=(0,_l.xU)();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const o=(0,_l.ge)(),s=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(xu));let d;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;yu(a.x,e.x,n),yu(a.y,e.y,n),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(xl(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,r){bu(e.x,t.x,n.x,r),bu(e.y,t.y,n.y,r)}(this.relativeTarget,this.relativeTargetOrigin,o,n),d&&function(e,t){return $c(e.x,t.x)&&$c(e.y,t.y)}(this.relativeTarget,d)&&(this.isProjectionDirty=!1),d||(d=(0,_l.ge)()),Ic(d,this.relativeTarget)),s&&(this.animationValues=i,function(e,t,n,r,i,a){i?(e.opacity=(0,cl.k)(0,n.opacity??1,Lc(r)),e.opacityExit=(0,cl.k)(t.opacity??1,0,Oc(r))):a&&(e.opacity=(0,cl.k)(t.opacity??1,n.opacity??1,r));for(let o=0;o<Pc;o++){const i=`border${Ec[o]}Radius`;let a=Rc(t,i),s=Rc(n,i);void 0===a&&void 0===s||(a||(a=0),s||(s=0),0===a||0===s||kc(a)===kc(s)?(e[i]=Math.max((0,cl.k)(Nc(a),Nc(s),r),0),(sl.KN.test(s)||sl.KN.test(a))&&(e[i]+="%")):e[i]=s)}(t.rotate||n.rotate)&&(e.rotate=(0,cl.k)(t.rotate||0,n.rotate||0,r))}(i,r,this.latestValues,n,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&((0,ll.WG)(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ll.Gt.update(()=>{nc.hasAnimatedSinceResize=!0,vc.q.layout++,this.motionValue||(this.motionValue=(0,Ac.OQ)(0)),this.currentAnimation=function(e,t,n){const r=(0,bc.S)(e)?e:(0,Ac.OQ)(e);return r.start((0,dl.f)("",r,t,n)),r.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{vc.q.layout--},onComplete:()=>{vc.q.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:r,latestValues:i}=e;if(t&&n&&r){if(this!==e&&this.layout&&r&&Cu(this.options.animationType,this.layout.layoutBox,r.layoutBox)){n=this.target||(0,_l.ge)();const t=gl(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const r=gl(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+r}Ic(t,n),(0,Fc.Ww)(t,i),Al(this.projectionDeltaWithTransform,this.layoutCorrected,t,i)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Zc);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:n}={}){const r=this.getStack();r&&r.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const r={};n.z&&ru("z",e,r,this.animationValues);for(let i=0;i<tu.length;i++)ru(`rotate${tu[i]}`,e,r,this.animationValues),ru(`skew${tu[i]}`,e,r,this.animationValues);e.render();for(const i in r)e.setStaticValue(i,r[i]),this.animationValues&&(this.animationValues[i]=r[i]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const n=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=(0,Cc.u)(t?.pointerEvents)||"",void(e.transform=n?n(this.latestValues,""):"none");const r=this.getLead();if(!this.projectionDelta||!this.layout||!r.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=(0,Cc.u)(t?.pointerEvents)||""),void(this.hasProjected&&!(0,Jc.HD)(this.latestValues)&&(e.transform=n?n({},""):"none",this.hasProjected=!1));e.visibility="";const i=r.animationValues||r.latestValues;this.applyTransformsToTarget();let a=function(e,t,n){let r="";const i=e.x.translate/t.x,a=e.y.translate/t.y,o=n?.z||0;if((i||a||o)&&(r=`translate3d(${i}px, ${a}px, ${o}px) `),1===t.x&&1===t.y||(r+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:e,rotate:t,rotateX:i,rotateY:a,skewX:o,skewY:s}=n;e&&(r=`perspective(${e}px) ${r}`),t&&(r+=`rotate(${t}deg) `),i&&(r+=`rotateX(${i}deg) `),a&&(r+=`rotateY(${a}deg) `),o&&(r+=`skewX(${o}deg) `),s&&(r+=`skewY(${s}deg) `)}const s=e.x.scale*t.x,l=e.y.scale*t.y;return 1===s&&1===l||(r+=`scale(${s}, ${l})`),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,i);n&&(a=n(i,a)),e.transform=a;const{x:o,y:s}=this.projectionDelta;e.transformOrigin=`${100*o.origin}% ${100*s.origin}% 0`,r.animationValues?e.opacity=r===this?i.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:i.opacityExit:e.opacity=r===this?void 0!==i.opacity?i.opacity:"":void 0!==i.opacityExit?i.opacityExit:0;for(const l in sc.H){if(void 0===i[l])continue;const{correct:t,applyTo:n,isCSSVariable:o}=sc.H[l],s="none"===a?i[l]:t(i[l],r);if(n){const t=n.length;for(let r=0;r<t;r++)e[n[r]]=s}else o?this.options.visualElement.renderState.vars[l]=s:e[l]=s}this.options.layoutId&&(e.pointerEvents=r===this?(0,Cc.u)(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(du),this.root.sharedNodes.clear()}}}function ou(e){e.updateLayout()}function su(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=e.layout,{animationType:i}=e.options,a=t.source!==e.layout.source;"size"===i?wl(e=>{const r=a?t.measuredBox[e]:t.layoutBox[e],i=gl(r);r.min=n[e].min,r.max=r.min+i}):Cu(i,t.layoutBox,n)&&wl(r=>{const i=a?t.measuredBox[r]:t.layoutBox[r],o=gl(n[r]);i.max=i.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+o)});const o=(0,_l.xU)();Al(o,n,t.layoutBox);const s=(0,_l.xU)();a?Al(s,e.applyTransform(r,!0),t.measuredBox):Al(s,n,t.layoutBox);const l=!Hc(o);let c=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:i,layout:a}=r;if(i&&a){const o=(0,_l.ge)();xl(o,t.layoutBox,i.layoutBox);const s=(0,_l.ge)();xl(s,n,a.layoutBox),Xc(o,s)||(c=!0),r.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=o,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:s,layoutDelta:o,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function lu(e){hc.Q.value&&eu.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cu(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function uu(e){e.clearSnapshot()}function du(e){e.clearMeasurements()}function hu(e){e.isLayoutDirty=!1}function pu(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function fu(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function mu(e){e.resolveTargetDelta()}function gu(e){e.calcProjection()}function vu(e){e.resetSkewAndRotation()}function Au(e){e.removeLeadSnapshot()}function yu(e,t,n){e.translate=(0,cl.k)(t.translate,0,n),e.scale=(0,cl.k)(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function bu(e,t,n,r){e.min=(0,cl.k)(t.min,n.min,r),e.max=(0,cl.k)(t.max,n.max,r)}function xu(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const _u={duration:.45,ease:[.4,0,.1,1]},wu=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Su=wu("applewebkit/")&&!wu("chrome/")?Math.round:al.l;function Tu(e){e.min=Su(e.min),e.max=Su(e.max)}function Cu(e,t,n){return"position"===e||"preserve-aspect"===e&&!function(e,t,n){return Math.abs(e-t)<=n}(Yc(t),Yc(n),.2)}function Mu(e){return e!==e.root&&e.scroll?.wasRoot}const Eu=au({attachResizeListener:(e,t)=>(0,hl.k)(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Pu={current:void 0},Nu=au({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Pu.current){const e=new Eu({});e.mount(window),e.setOptions({layoutScroll:!0}),Pu.current=e}return Pu.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),ku={pan:{Feature:Ql},drag:{Feature:Xl,ProjectionNode:Nu,MeasureLayout:uc}};var Ru=n(1391);const Lu={layout:{ProjectionNode:Nu,MeasureLayout:uc}},Ou={...rl.W,...Ru.n,...ku,...Lu},ju=(0,nl.H)(Ou,tl.J),Du=$n("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Iu=$n("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),Bu=$n("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Fu=$n("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),zu=$n("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Uu=$n("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Vu=$n("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Gu=$n("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),qu=$n("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),Wu=$n("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),Hu=$n("import",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m8 11 4 4 4-4",key:"1dohi6"}],["path",{d:"M8 5H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4",key:"1ywtjm"}]]),$u=$n("file-image",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]),Ku={content:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-lg"},Xu={base:"text-zinc-900 dark:text-zinc-100 data-[hover=true]:bg-zinc-100 dark:data-[hover=true]:bg-zinc-800",description:"text-zinc-500 dark:text-zinc-400"};function Yu({viewMode:e,onViewModeChange:t,multiSelect:n,onMultiSelectChange:r,selectedCount:i=0,totalCount:a=0,onUpload:o,onBatchRender:s,onBatchDownload:l,onContactSheet:c,onImportPositive:u,onRawImport:d,onEditSelected:h,onSelectAll:p,onDeselectAll:f,onInvertSelection:m}){return(0,gt.jsxs)(ju.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.3},className:"flex flex-wrap items-center justify-between gap-4 mb-6 p-4 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl",children:[(0,gt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,gt.jsxs)(Ka,{children:[(0,gt.jsx)(La.T,{size:"sm",variant:"positive"===e?"solid":"flat",color:"positive"===e?"primary":"default",onPress:()=>t("positive"),startContent:(0,gt.jsx)(Du,{size:14}),children:"Positive"}),(0,gt.jsx)(La.T,{size:"sm",variant:"negative"===e?"solid":"flat",color:"negative"===e?"primary":"default",onPress:()=>t("negative"),startContent:(0,gt.jsx)(Iu,{size:14}),children:"Negative"})]}),(0,gt.jsx)(Ja,{orientation:"vertical",className:"h-6"}),(0,gt.jsx)(La.T,{size:"sm",variant:n?"solid":"flat",color:n?"secondary":"default",onPress:()=>r(!n),startContent:n?(0,gt.jsx)(Bu,{size:14}):(0,gt.jsx)(Fu,{size:14}),children:n?`Selected ${i}`:"Select"}),n&&i>0&&(0,gt.jsx)(La.T,{size:"sm",color:"primary",variant:"solid",onPress:h,startContent:(0,gt.jsx)(zu,{size:14}),children:"Edit Selected"}),n&&(0,gt.jsxs)(Mo,{classNames:Ku,children:[(0,gt.jsx)(No,{children:(0,gt.jsx)(La.T,{size:"sm",variant:"flat",isIconOnly:!0,children:(0,gt.jsx)(Uu,{size:14})})}),(0,gt.jsxs)($s,{"aria-label":"Selection Actions",itemClasses:Xu,children:[(0,gt.jsx)(Qs,{onPress:p,children:"Select All"},"all"),(0,gt.jsx)(Qs,{onPress:m,children:"Invert"},"invert"),(0,gt.jsx)(Qs,{onPress:f,className:"text-danger",color:"danger",children:"Deselect All"},"none")]})]}),(0,gt.jsxs)(el,{size:"sm",variant:"flat",children:[a," Photos"]})]}),(0,gt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,gt.jsx)(La.T,{size:"sm",color:"primary",variant:"flat",startContent:(0,gt.jsx)(Vu,{size:14}),onPress:o,children:"Upload"}),(0,gt.jsxs)(Mo,{classNames:Ku,children:[(0,gt.jsx)(No,{children:(0,gt.jsx)(La.T,{size:"sm",variant:"flat",startContent:(0,gt.jsx)(Gu,{size:14}),children:"Batch"})}),(0,gt.jsxs)($s,{"aria-label":"Batch actions",itemClasses:Xu,children:[(0,gt.jsx)(Qs,{startContent:(0,gt.jsx)(qu,{size:14}),description:"Render all photos with settings",onPress:s,children:"Batch Render"},"render"),(0,gt.jsx)(Qs,{startContent:(0,gt.jsx)(Wu,{size:14}),description:"Download photos",onPress:l,children:"Batch Download"},"download"),(0,gt.jsx)(Qs,{startContent:(0,gt.jsx)(Gu,{size:14}),description:"Generate contact sheet",onPress:c,children:"Contact Sheet"},"contact")]})]}),(0,gt.jsxs)(Mo,{classNames:Ku,children:[(0,gt.jsx)(No,{children:(0,gt.jsx)(La.T,{size:"sm",variant:"flat",startContent:(0,gt.jsx)(Hu,{size:14}),children:"Import"})}),(0,gt.jsx)($s,{"aria-label":"Import options",itemClasses:Xu,children:(0,gt.jsx)(Qs,{startContent:(0,gt.jsx)($u,{size:14}),description:"Import processed positive images",onPress:u,children:"Import Positives"},"positive")})]})]})]})}var Qu=n(8416),Zu=n(1595);const Ju="undefined"!==typeof HTMLElement&&"inert"in HTMLElement.prototype;let ed=new WeakMap,td=[];function nd(e,t){let n=(0,uo.mD)(null===e||void 0===e?void 0:e[0]),r=t instanceof n.Element?{root:t}:t;var i;let a=null!==(i=null===r||void 0===r?void 0:r.root)&&void 0!==i?i:document.body,o=(null===r||void 0===r?void 0:r.shouldUseInert)&&Ju,s=new Set(e),l=new Set,c=(e,t)=>{o&&e instanceof n.HTMLElement?e.inert=t:t?e.setAttribute("aria-hidden","true"):(e.removeAttribute("aria-hidden"),e instanceof n.HTMLElement&&(e.inert=!1))},u=e=>{for(let i of e.querySelectorAll("[data-live-announcer], [data-react-aria-top-layer]"))s.add(i);let t=e=>{if(l.has(e)||s.has(e)||e.parentElement&&l.has(e.parentElement)&&"row"!==e.parentElement.getAttribute("role"))return NodeFilter.FILTER_REJECT;for(let t of s)if(e.contains(t))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t}),r=t(e);if(r===NodeFilter.FILTER_ACCEPT&&d(e),r!==NodeFilter.FILTER_REJECT){let e=n.nextNode();for(;null!=e;)d(e),e=n.nextNode()}},d=e=>{var t;let r=null!==(t=ed.get(e))&&void 0!==t?t:0;var i;(i=e,(o&&i instanceof n.HTMLElement?i.inert:"true"===i.getAttribute("aria-hidden"))&&0===r)||(0===r&&c(e,!0),l.add(e),ed.set(e,r+1))};td.length&&td[td.length-1].disconnect(),u(a);let h=new MutationObserver(e=>{for(let t of e)if("childList"===t.type&&![...s,...l].some(e=>e.contains(t.target)))for(let e of t.addedNodes)!(e instanceof HTMLElement||e instanceof SVGElement)||"true"!==e.dataset.liveAnnouncer&&"true"!==e.dataset.reactAriaTopLayer?e instanceof Element&&u(e):s.add(e)});h.observe(a,{childList:!0,subtree:!0});let p={visibleNodes:s,hiddenNodes:l,observe(){h.observe(a,{childList:!0,subtree:!0})},disconnect(){h.disconnect()}};return td.push(p),()=>{h.disconnect();for(let e of l){let t=ed.get(e);null!=t&&(1===t?(c(e,!1),ed.delete(e)):ed.set(e,t-1))}p===td[td.length-1]?(td.pop(),td.length&&td[td.length-1].observe()):td.splice(td.indexOf(p),1)}}var rd=n(6452);var id=n(9184);function ad(e){var t,n,i;const a=(0,Bn.o)(),[o,s]=(0,Ln.rE)(e,qa.yl.variantKeys),{ref:l,as:c,className:u,classNames:d,isOpen:h,defaultOpen:p,onOpenChange:f,motionProps:m,closeButton:g,isDismissable:v=!0,hideCloseButton:A=!1,shouldBlockScroll:y=!0,portalContainer:b,isKeyboardDismissDisabled:x=!1,onClose:_,...w}=o,S=c||"section",T=(0,Wa.zD)(l),C=(0,r.useRef)(null),[M,E]=(0,r.useState)(!1),[P,N]=(0,r.useState)(!1),k=null!=(n=null!=(t=e.disableAnimation)?t:null==a?void 0:a.disableAnimation)&&n,R=(0,r.useId)(),L=(0,r.useId)(),O=(0,r.useId)(),j=(0,ro.T)({isOpen:h,defaultOpen:p,onOpenChange:e=>{null==f||f(e),e||null==_||_()}}),{modalProps:D,underlayProps:I}=function(e={shouldBlockScroll:!0},t,n){let{overlayProps:i,underlayProps:a}=(0,rd.P)({...e,isOpen:t.isOpen,onClose:t.close},n);return(0,Qu.H)({isDisabled:!t.isOpen||!e.shouldBlockScroll}),(0,Zu.Se)(),(0,r.useEffect)(()=>{if(t.isOpen&&n.current)return nd([n.current])},[t.isOpen,n]),{modalProps:(0,go.v)(i),underlayProps:a}}({isDismissable:v,shouldBlockScroll:y,isKeyboardDismissDisabled:x},j,T),{buttonProps:B}=(0,id.l)({onPress:j.close},C),{isFocusVisible:F,focusProps:z}=(0,Oo.o)(),U=(0,Dn.cn)(null==d?void 0:d.base,u),V=(0,r.useMemo)(()=>(0,qa.yl)({...s,disableAnimation:k}),[(0,In.t6)(s),k]),G=(0,r.useCallback)((e={})=>({className:V.backdrop({class:null==d?void 0:d.backdrop}),...I,...e}),[V,d,I]);return{Component:S,slots:V,domRef:T,headerId:L,bodyId:O,motionProps:m,classNames:d,isDismissable:v,closeButton:g,hideCloseButton:A,portalContainer:b,shouldBlockScroll:y,backdrop:null!=(i=e.backdrop)?i:"opaque",isOpen:j.isOpen,onClose:j.close,disableAnimation:k,setBodyMounted:N,setHeaderMounted:E,getDialogProps:(t={},n=null)=>{var r;return{ref:(0,In.Px)(n,T),...(0,In.v6)(D,w,t),className:V.base({class:(0,Dn.cn)(U,t.className)}),id:R,"data-open":(0,In.sE)(j.isOpen),"data-dismissable":(0,In.sE)(v),"aria-modal":(0,In.sE)(!0),"data-placement":null!=(r=null==e?void 0:e.placement)?r:"right","aria-labelledby":M?L:void 0,"aria-describedby":P?O:void 0}},getBackdropProps:G,getCloseButtonProps:()=>({role:"button",tabIndex:0,"aria-label":"Close","data-focus-visible":(0,In.sE)(F),className:V.closeButton({class:null==d?void 0:d.closeButton}),...(0,In.v6)(B,z)})}}var[od,sd]=(0,eo.q)({name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Modal />`"}),ld=n(9570),cd=(0,Ln.Rf)((e,t)=>{const{children:n,...r}=e,i=ad({...r,ref:t}),a=(0,gt.jsx)(Zu.hJ,{portalContainer:i.portalContainer,children:n});return(0,gt.jsx)(od,{value:i,children:i.disableAnimation&&i.isOpen?a:(0,gt.jsx)(ld.N,{children:i.isOpen?a:null})})});cd.displayName="HeroUI.Modal";var ud=cd,dd=n(7820),hd={enter:{scale:"var(--scale-enter)",y:"var(--slide-enter)",opacity:1,willChange:"auto",transition:{scale:{duration:.4,ease:dd.xf.ease},opacity:{duration:.4,ease:dd.xf.ease},y:{type:"spring",bounce:0,duration:.6}}},exit:{scale:"var(--scale-exit)",y:"var(--slide-exit)",opacity:0,willChange:"transform",transition:{duration:.3,ease:dd.xf.ease}}},pd=n(1809),fd=e=>{const{isSelected:t,isIndeterminate:n,disableAnimation:r,...i}=e;return(0,gt.jsx)("svg",{"aria-hidden":"true",className:"fill-current",fill:"none",focusable:"false",height:"1em",role:"presentation",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:"1em",...i,children:(0,gt.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})},md=n(3456),gd=n(4900),vd=n(6808),Ad="undefined"!==typeof document&&window.visualViewport,yd=r.createContext(!1);function bd(){return!1}function xd(){return!0}function _d(e){return()=>{}}function wd(){let e="function"===typeof r.useSyncExternalStore?r.useSyncExternalStore(_d,bd,xd):(0,r.useContext)(yd),[t,n]=(0,r.useState)(()=>e?{width:0,height:0}:Sd());return(0,r.useEffect)(()=>{let e=()=>{n(e=>{let t=Sd();return t.width===e.width&&t.height===e.height?e:t})};return Ad?Ad.addEventListener("resize",e):window.addEventListener("resize",e),()=>{Ad?Ad.removeEventListener("resize",e):window.removeEventListener("resize",e)}},[]),t}function Sd(){return{width:Ad&&(null==Ad?void 0:Ad.width)||window.innerWidth,height:Ad&&(null==Ad?void 0:Ad.height)||window.innerHeight}}var Td=()=>n.e(707).then(n.bind(n,5707)).then(e=>e.default),Cd=e=>{const{as:t,children:n,role:i="dialog",...a}=e,{Component:o,domRef:s,slots:l,classNames:c,motionProps:u,backdrop:d,closeButton:h,hideCloseButton:p,disableAnimation:f,getDialogProps:m,getBackdropProps:g,getCloseButtonProps:v,onClose:A}=sd(),y=t||o||"div",b=wd(),{dialogProps:x}=(0,vd.s)({role:i},s),_=(0,r.isValidElement)(h)?(0,r.cloneElement)(h,v()):(0,gt.jsx)("button",{...v(),children:(0,gt.jsx)(fd,{})}),w=(0,r.useCallback)(e=>{"Tab"===e.key&&e.nativeEvent.isComposing&&(e.stopPropagation(),e.preventDefault())},[]),S=m((0,In.v6)(x,a)),T=(0,gt.jsxs)(y,{...S,onKeyDown:(0,In.cy)(S.onKeyDown,w),children:[(0,gt.jsx)(pd.R,{onDismiss:A}),!p&&_,"function"===typeof n?n(A):n,(0,gt.jsx)(pd.R,{onDismiss:A})]}),C=(0,r.useMemo)(()=>"transparent"===d?null:f?(0,gt.jsx)("div",{...g()}):(0,gt.jsx)(md.F,{features:Td,children:(0,gt.jsx)(gd.m.div,{animate:"enter",exit:"exit",initial:"exit",variants:dd.zF.fade,...g()})}),[d,f,g]),M={"--visual-viewport-height":b.height+"px"},E=f?(0,gt.jsx)("div",{className:l.wrapper({class:null==c?void 0:c.wrapper}),"data-slot":"wrapper",style:M,children:T}):(0,gt.jsx)(md.F,{features:Td,children:(0,gt.jsx)(gd.m.div,{animate:"enter",className:l.wrapper({class:null==c?void 0:c.wrapper}),"data-slot":"wrapper",exit:"exit",initial:"exit",variants:hd,...u,style:M,children:T})});return(0,gt.jsxs)("div",{tabIndex:-1,children:[C,E]})};Cd.displayName="HeroUI.ModalContent";var Md=Cd,Ed=(0,Ln.Rf)((e,t)=>{const{as:n,children:i,className:a,...o}=e,{slots:s,classNames:l,headerId:c,setHeaderMounted:u}=sd(),d=(0,Wa.zD)(t),h=n||"header";return(0,r.useEffect)(()=>(u(!0),()=>u(!1)),[u]),(0,gt.jsx)(h,{ref:d,className:s.header({class:(0,Dn.cn)(null==l?void 0:l.header,a)}),id:c,...o,children:i})});Ed.displayName="HeroUI.ModalHeader";var Pd=Ed,Nd=(0,Ln.Rf)((e,t)=>{const{as:n,children:i,className:a,...o}=e,{slots:s,classNames:l,bodyId:c,setBodyMounted:u}=sd(),d=(0,Wa.zD)(t),h=n||"div";return(0,r.useEffect)(()=>(u(!0),()=>u(!1)),[u]),(0,gt.jsx)(h,{ref:d,className:s.body({class:(0,Dn.cn)(null==l?void 0:l.body,a)}),id:c,...o,children:i})});Nd.displayName="HeroUI.ModalBody";var kd=Nd,Rd=(0,Ln.Rf)((e,t)=>{const{as:n,children:r,className:i,...a}=e,{slots:o,classNames:s}=sd(),l=(0,Wa.zD)(t),c=n||"footer";return(0,gt.jsx)(c,{ref:l,className:o.footer({class:(0,Dn.cn)(null==s?void 0:s.footer,i)}),...a,children:r})});Rd.displayName="HeroUI.ModalFooter";var Ld=Rd;function Od({isOpen:e,onClose:t,size:n="lg",title:r,subtitle:i,icon:a,children:o,footer:s,hideCloseButton:l=!1,isDismissable:c=!0,scrollBehavior:u="inside",className:d="",...h}){return(0,gt.jsx)(ud,{isOpen:e,onClose:t,size:n,scrollBehavior:u,isDismissable:c,backdrop:"blur",motionProps:{variants:{enter:{y:0,opacity:1,transition:{duration:.25,ease:"easeOut"}},exit:{y:10,opacity:0,transition:{duration:.15,ease:"easeIn"}}}},classNames:{backdrop:"bg-black/60",base:`max-h-[90vh] ${d}`,wrapper:"items-center justify-center",header:"border-b border-zinc-200/50 dark:border-zinc-700/50 pb-4",body:"py-6",footer:"border-t border-zinc-200/50 dark:border-zinc-700/50 pt-4",closeButton:"hover:bg-zinc-100 dark:hover:bg-zinc-800 active:bg-zinc-200 dark:active:bg-zinc-700 rounded-full"},hideCloseButton:l,...h,children:(0,gt.jsx)(Md,{className:"shadow-2xl border border-zinc-200/30 dark:border-zinc-700/30 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",style:{backdropFilter:"blur(16px)"},children:e=>(0,gt.jsxs)(gt.Fragment,{children:[(r||i)&&(0,gt.jsx)(Pd,{className:"flex flex-col gap-1",children:(0,gt.jsxs)("div",{className:"flex items-center gap-3",children:[a&&(0,gt.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-blue-500/10 dark:bg-blue-400/10 flex items-center justify-center",children:(0,gt.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:a})}),(0,gt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,gt.jsx)("h3",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 truncate",children:r}),i&&(0,gt.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 truncate",children:i})]})]})}),(0,gt.jsx)(kd,{children:o}),s&&(0,gt.jsx)(Ld,{children:s})]})})})}function jd({children:e,className:t="",hoverable:n=!1}){return(0,gt.jsx)("div",{className:`\n        rounded-xl border border-zinc-200 dark:border-zinc-700 \n        bg-white dark:bg-zinc-700/50 \n        ${n?"transition-all duration-200 hover:bg-zinc-50 dark:hover:bg-zinc-700 hover:shadow-md":""}\n        ${t}\n      `,children:e})}function Dd({filled:e}){return(0,gt.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:e?"#ff9e9e":"none",stroke:e?"none":"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"drop-shadow(0 1px 3px rgba(0,0,0,0.3))"},children:(0,gt.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}function Id(){return(0,gt.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"drop-shadow(0 1px 3px rgba(0,0,0,0.3))"},children:[(0,gt.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,gt.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function Bd({initialValue:e,onSave:t,onClose:n}){const[i,a]=r.useState(e||"");return(0,gt.jsx)("div",{onClick:e=>{e.stopPropagation()},children:(0,gt.jsx)(Od,{isOpen:!0,onClose:n,size:"md",title:"Edit Note",subtitle:"Add a description or caption for this photo",icon:(0,gt.jsx)(za,{className:"w-5 h-5"}),footer:(0,gt.jsxs)("div",{className:"flex gap-3 justify-end w-full",children:[(0,gt.jsx)(La.T,{variant:"bordered",onPress:n,className:"border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300",children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:()=>{t(i)},className:"bg-blue-600 text-white",children:"Save"})]}),children:(0,gt.jsx)("textarea",{value:i,onChange:e=>a(e.target.value),placeholder:"Enter note or caption...",rows:4,className:"w-full p-3 rounded-lg border border-zinc-200/50 dark:border-zinc-700/50 bg-white/80 dark:bg-zinc-800/60 text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-400 dark:placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none",autoFocus:!0,onClick:e=>e.stopPropagation()})})})}function Fd({p:e,onSelect:t,onSetCover:n,onDeletePhoto:i,onUpdatePhoto:a,filmName:o,onEditTags:s,viewMode:l="positive",multiSelect:c=!1,selected:u=!1,onToggleSelect:d}){const h=se(),[p,f]=r.useState(null),[m,g]=r.useState(null),[v,A]=r.useState(1===e.rating),[y,b]=r.useState(!1),x=Array.isArray(e.tags)?e.tags:[],[_,w]=r.useState({isOpen:!1,type:"alert",title:"",message:"",onConfirm:null});r.useEffect(()=>{let t=null,n=null;if("negative"===l)if(e.negative_rel_path?t=`/uploads/${e.negative_rel_path}`:e.full_rel_path?t=`/uploads/${e.full_rel_path}`:e.filename&&(t=e.filename),e.negative_thumb_rel_path)n=`/uploads/${e.negative_thumb_rel_path}`;else if(e.thumb_rel_path)n=`/uploads/${e.thumb_rel_path}`;else if(e.negative_rel_path)try{const t=e.negative_rel_path.split("/"),r=t.pop(),i=t.join("/"),a=r.lastIndexOf("."),o=r.substring(0,a),s=o.endsWith("_neg")?o.slice(0,-4):o;n=`/uploads/${i}/thumb/${`${s}-thumb.jpg`}`}catch{n=t}else n=t;else e.positive_rel_path?t=`/uploads/${e.positive_rel_path}`:e.full_rel_path?t=`/uploads/${e.full_rel_path}`:e.filename&&(t=e.filename),n=e.positive_thumb_rel_path?`/uploads/${e.positive_thumb_rel_path}`:e.thumb_rel_path?`/uploads/${e.thumb_rel_path}`:t;const r=e.updated_at?`?v=${new Date(e.updated_at).getTime()}`:"";"positive"!==l||e.full_rel_path||e.positive_rel_path?(f((0,bn.FH)(t)+r),g((0,bn.FH)(n)+r)):(f(null),g(null)),A(1===e.rating)},[e,l]);const S=async t=>{var n;n=async()=>{const n=x.filter(e=>e.id!==t).map(e=>e.name);try{await a(e.id,{tags:n})}catch(r){console.error("Failed to remove tag",r)}},w({isOpen:!0,type:"confirm",title:"Remove Tag",message:"Remove this tag?",onConfirm:()=>{n(),w(e=>({...e,isOpen:!1}))},onCancel:()=>w(e=>({...e,isOpen:!1}))})};return(0,gt.jsxs)("div",{className:"photo-item "+(u?"selected":""),onClick:()=>{c?d&&d(e):t&&t()},style:c?{outline:u?"2px solid var(--color-primary)":"1px solid var(--color-border)",position:"relative",cursor:"pointer"}:{},children:[c&&(0,gt.jsx)("div",{style:{position:"absolute",top:6,left:6,zIndex:10},children:(0,gt.jsx)("input",{type:"checkbox",checked:u,onChange:t=>{t.stopPropagation(),d&&d(e)}})}),(0,gt.jsx)(ir.A,{isOpen:_.isOpen,type:_.type,title:_.title,message:_.message,onConfirm:_.onConfirm,onCancel:_.onCancel}),(0,gt.jsx)("div",{className:"photo-like-btn",onClick:c?void 0:t=>{t.stopPropagation();const n=v?0:1;A(!v),a(e.id,{rating:n})},title:v?"Unlike":"Like",style:c?{pointerEvents:"none",opacity:.5}:{},children:(0,gt.jsx)(Dd,{filled:v})}),(0,gt.jsxs)("div",{className:"photo-tags-overlay",onClick:e=>e.stopPropagation(),children:[x&&x.length>0?(0,gt.jsx)("div",{className:"photo-tag-inline-list",children:x.map((e,t)=>(0,gt.jsxs)("span",{className:"photo-tag-wrapper",children:[(0,gt.jsx)("span",{className:"photo-tag-inline clickable",onClick:t=>{t.stopPropagation(),e.id&&h(`/themes/${e.id}`)},children:e.name||e}),(0,gt.jsx)("button",{className:"photo-tag-remove-btn",onClick:t=>{t.stopPropagation(),S(e.id)},title:"Remove tag",children:"\xd7"}),t<x.length-1?(0,gt.jsx)("span",{className:"tag-separator",children:"\xb7"}):""]},t))}):null,(0,gt.jsx)("button",{className:"photo-tag-add-btn",onClick:c?void 0:t=>{t.stopPropagation(),s&&s(e)},title:"Add / Edit tags",style:c?{pointerEvents:"none",opacity:.5}:{},children:(0,gt.jsx)(Id,{})})]}),!c&&(0,gt.jsxs)("div",{className:"photo-actions",children:[(0,gt.jsx)("button",{onClick:t=>{t.stopPropagation(),n(e.id)},children:"Set cover"}),(0,gt.jsx)("button",{onClick:e=>{e.stopPropagation(),b(!0)},children:"Note"}),(0,gt.jsx)("button",{onClick:t=>{t.stopPropagation(),i(e.id)},children:"Delete"})]}),e.caption&&(0,gt.jsx)("div",{className:"photo-caption-overlay bottom",children:e.caption}),(0,gt.jsx)("div",{className:"photo-thumb",children:m||p?(0,gt.jsx)(Yn,{alt:e.caption||"",src:m||p,aspectRatio:"1",className:"w-full h-full",objectFit:"cover",fadeInDuration:.3}):(0,gt.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0",color:"#999",fontSize:"12px",flexDirection:"column",gap:"8px"},children:[(0,gt.jsx)("span",{children:"No Photo"}),"positive"===l&&e.negative_rel_path&&(0,gt.jsx)("span",{style:{fontSize:"10px",opacity:.7},children:"(Negative Available)"})]})}),y&&(0,gt.jsx)(Bd,{initialValue:e.caption,onSave:t=>{a(e.id,{caption:t}),b(!1)},onClose:()=>b(!1)})]})}const zd=$n("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Ud=$n("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function Vd({photo:e,allTags:t,onClose:n,onSave:i}){const[a,o]=(0,r.useState)(""),[s,l]=(0,r.useState)(e.tags?e.tags.map(e=>e.name||e):[]),[c,u]=(0,r.useState)([]),d=(0,r.useRef)(null);(0,r.useEffect)(()=>{d.current&&d.current.focus()},[]),(0,r.useEffect)(()=>{const e=a.toLowerCase().trim(),n=t.filter(e=>e.photos_count>0).filter(e=>!s.includes(e.name)).filter(t=>!e||t.name.toLowerCase().includes(e));u(n)},[a,t,s]);const h=e=>{e.trim()&&(s.includes(e.trim())||(l([...s,e.trim()]),o(""),d.current&&d.current.focus()))},p=e=>{e.stopPropagation()};return(0,gt.jsx)("div",{onClick:p,children:(0,gt.jsx)(Od,{isOpen:!0,onClose:n,size:"md",title:"Edit Tags",subtitle:"Add or remove tags for this photo",icon:(0,gt.jsx)(zd,{className:"w-5 h-5"}),footer:(0,gt.jsxs)("div",{className:"flex gap-3 justify-end w-full",children:[(0,gt.jsx)(La.T,{variant:"bordered",onPress:n,className:"border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300",children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:()=>{let t=[...s];a.trim()&&!t.includes(a.trim())&&t.push(a.trim()),console.log("[TagEditModal] Saving tags:",t,"for photo:",e.id),i(e.id,t),n()},className:"bg-blue-600 text-white",children:"Save"})]}),children:(0,gt.jsxs)("div",{className:"flex flex-col gap-4",onClick:p,children:[s.length>0&&(0,gt.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(e=>(0,gt.jsx)(el,{onClose:()=>{return t=e,void l(s.filter(e=>e!==t));var t},variant:"flat",color:"success",className:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200",children:e},e))}),(0,gt.jsxs)("div",{className:"relative",children:[(0,gt.jsx)("input",{ref:d,type:"text",value:a,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),h(a))},onClick:e=>e.stopPropagation(),placeholder:"Type to add tag...",className:"w-full h-10 px-3 pr-10 rounded-lg border border-zinc-200/50 dark:border-zinc-700/50 bg-white/80 dark:bg-zinc-800/60 text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-400 dark:placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),a.trim()&&(0,gt.jsx)(La.T,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>h(a),className:"absolute right-1 top-1/2 -translate-y-1/2 text-blue-600 dark:text-blue-400",children:(0,gt.jsx)(Ud,{className:"w-4 h-4"})})]}),c.length>0&&(0,gt.jsx)("div",{className:"flex flex-wrap gap-2 max-h-[200px] overflow-y-auto custom-scrollbar",children:c.map(e=>(0,gt.jsx)(el,{onClick:()=>h(e.name),variant:"bordered",className:"cursor-pointer hover:bg-green-50 dark:hover:bg-green-900/20 border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 transition-colors",endContent:(0,gt.jsx)(Ud,{className:"w-3 h-3 text-green-600 dark:text-green-400"}),children:e.name},e.id))})]})})})}var Gd=n(8294);const qd={kodak:{name:"Kodak Gold",description:"Classic Kodak look with warm tones",preview:"#d97706"},fuji:{name:"Fujifilm C200",description:"Green edge aesthetic",preview:"#22c55e"},ilford:{name:"Ilford HP5",description:"Black & white minimalist",preview:"#ffffff"},minimal:{name:"Minimal",description:"Clean and simple",preview:"#666666"}};function Wd(e,t=0){const n=((null===e||void 0===e?void 0:e.film_name_joined)||(null===e||void 0===e?void 0:e.film_type)||"KODAK").toUpperCase(),r=parseInt(null===e||void 0===e?void 0:e.iso)||400,i=(null===e||void 0===e?void 0:e.photo_count)||36,a=n.split("").reduce((e,t,n)=>e+t.charCodeAt(0)*(n+1),0),o=[];for(let h=0;h<6;h++)o.push(1===(a>>h&1));const s={25:0,50:1,100:2,200:3,400:4,800:5,1600:6,3200:7},l=s[Object.keys(s).map(Number).reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e)]||4,c=[];for(let h=0;h<4;h++)c.push(1===(l>>h&1));const u=Math.floor(i/12),d=[];for(let h=0;h<4;h++)d.push(1===(u>>h&1));return[...o,...c,...d].map((e,n)=>n>=10&&(t+n)%7===0?!e:e)}const Hd={auto:{name:"Auto",description:"Use best available (positive > negative > thumb)"},positive:{name:"Positive",description:"Edited/inverted images"},negative:{name:"Negative",description:"Original scanned negatives"}};function $d({isOpen:e,onClose:t,roll:n,photos:i=[]}){const[a,o]=(0,r.useState)("kodak"),[s,l]=(0,r.useState)("auto"),[c,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)({current:0,total:0,message:"",percentage:0}),[p,f]=(0,r.useState)(null),m=(0,r.useRef)(null),g=(0,r.useRef)(null),v=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),A=(0,r.useCallback)(e=>{switch(s){case"positive":return e.positive_thumb_rel_path||e.thumb_rel_path||e.positive_rel_path||e.full_rel_path;case"negative":return e.negative_thumb_rel_path||e.negative_rel_path||e.thumb_rel_path;default:return e.positive_thumb_rel_path||e.thumb_rel_path||e.negative_thumb_rel_path||e.positive_rel_path||e.full_rel_path||e.negative_rel_path}},[s]),y=Math.ceil(i.length/6);(0,r.useEffect)(()=>{if(!e||!m.current||0===i.length)return;const t=m.current,r=t.getContext("2d"),o=120,s=Math.round(80),l=16,c={edgeTextHeight:"minimal"!==a?14:0,sprocketHeight:"minimal"!==a?10:0,rowGap:"minimal"===a?18:8},u=s+2*(c.edgeTextHeight+c.sprocketHeight),d=u+c.rowGap,h=32+y*u+(y-1)*c.rowGap;t.width=762,t.height=h;const p={kodak:{bg:"#1a1a1a",text:"#fbbf24",sprocket:"#0a0a0a",filmBg:"#2a2520"},fuji:{bg:"#0f1e0f",text:"#22c55e",sprocket:"#050a05",filmBg:"#1a2e1a"},ilford:{bg:"#000000",text:"#cccccc",sprocket:"#1a1a1a",filmBg:"#1a1a1a"},minimal:{bg:"#000000",text:"#666666",sprocket:"#000000",filmBg:"#000000"}}[a];r.fillStyle=p.bg,r.fillRect(0,0,762,h);const f=[];let g=0;const v=()=>{for(let e=0;e<y;e++){const t=l+e*d,h=i.slice(6*e,6*(e+1)),m=(null===n||void 0===n?void 0:n.film_name_joined)||(null===n||void 0===n?void 0:n.film_type)||"FILM";if("minimal"!==a){r.fillStyle=p.filmBg,r.fillRect(14,t-1,734,u+2),r.fillStyle=p.text,r.font="bold 8px 'Courier New', monospace",r.textAlign="left",r.fillText(m,20,t+c.edgeTextHeight-3),r.font="bold 8px 'Courier New', monospace",h.forEach((n,i)=>{const a=n.frame_number||String(6*e+i+1).padStart(2,"0"),s=l+122*i;if(i<h.length-1){const e=s+o+1;r.textAlign="right",r.fillText(`${a}A`,e-8,t+c.edgeTextHeight-3),r.textAlign="center",r.font="bold 7px Courier New, monospace",r.fillText("\u25c4\u25ba",e,t+c.edgeTextHeight-3),r.font="bold 8px 'Courier New', monospace"}else r.textAlign="right",r.fillText(`${a}A`,s+o-4,t+c.edgeTextHeight-3)});const i=6,a=8,d=o/a;r.fillStyle=p.sprocket;for(let e=0;e<h.length;e++){const n=l+122*e;for(let e=0;e<a;e++){const a=n+e*d+(d-i)/2;r.fillRect(a,t+c.edgeTextHeight,i,c.sprocketHeight),r.fillRect(a,t+c.edgeTextHeight+c.sprocketHeight+s,i,c.sprocketHeight)}}r.fillStyle=p.text,r.font="bold 8px 'Courier New', monospace",r.textAlign="center";const f=2,g=1.5,v=10;h.forEach((i,a)=>{const s=i.frame_number||String(6*e+a+1).padStart(2,"0"),c=l+122*a;r.fillText(s,c+60,t+u-2),r.globalAlpha=.9;const d=c+60+10,h=c+o-2,p=Wd(n,6*e+a);for(let e=0;e<p.length&&e<14;e++){const n=d+e*(f+g);n+f<=h&&p[e]&&r.fillRect(n,t+u-v-2,f,v)}r.globalAlpha=1})}const g=t+c.edgeTextHeight+c.sprocketHeight;h.forEach((t,n)=>{const i=l+122*n;if(f[6*e+n]){const t=f[6*e+n];if(t.naturalHeight>t.naturalWidth){r.save(),r.translate(i+60,g+s/2),r.rotate(Math.PI/2);const e=s,n=o;r.drawImage(t,-e/2,-n/2,e,n),r.restore()}else r.drawImage(t,i,g,o,s)}else r.fillStyle="#2a2a2a",r.fillRect(i,g,o,s);if("minimal"===a){const a=t.frame_number||String(6*e+n+1).padStart(2,"0");r.fillStyle=p.text,r.font="10px monospace",r.textAlign="center",r.fillText(a,i+60,g+s+12)}})}};i.forEach((e,t)=>{const n=A(e);if(n){const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{f[t]=e,g++,g===i.length&&v()},e.onerror=()=>{g++,g===i.length&&v()},e.src=(0,bn.FH)(n)}else g++}),v()},[e,i,a,s,y,n,A]);return e?(0,gt.jsx)("div",{className:"fg-modal-overlay",onClick:t,children:(0,gt.jsxs)("div",{className:"fg-modal-content",style:{maxWidth:900,width:"90%"},onClick:e=>e.stopPropagation(),children:[(0,gt.jsxs)("div",{className:"fg-modal-header",children:[(0,gt.jsx)("h3",{children:"Export Contact Sheet"}),(0,gt.jsx)("button",{className:"fg-modal-close",onClick:t,children:"\xd7"})]}),(0,gt.jsxs)("div",{className:"fg-modal-body",style:{padding:24},children:[p&&(0,gt.jsx)("div",{className:"fg-alert fg-alert-error",style:{marginBottom:20},children:p}),(0,gt.jsx)("div",{style:{marginBottom:20,padding:16,background:v?"#27272a":"#f8f9fa",borderRadius:8},children:(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,color:v?"#a1a1aa":"#666"},children:[(0,gt.jsxs)("span",{children:[(0,gt.jsx)("strong",{children:i.length})," photos"]}),(0,gt.jsxs)("span",{children:[(0,gt.jsx)("strong",{children:6})," columns \xd7 ",(0,gt.jsx)("strong",{children:y})," rows"]}),(0,gt.jsxs)("span",{children:["Max size: ",(0,gt.jsx)("strong",{children:"4000px"})]})]})}),(0,gt.jsxs)("div",{style:{marginBottom:24},children:[(0,gt.jsx)("label",{style:{display:"block",marginBottom:8,fontWeight:600,color:v?"#ECEDEE":"#333"},children:"Preview"}),(0,gt.jsx)("div",{style:{background:"#000",borderRadius:8,padding:20,display:"flex",justifyContent:"center",alignItems:"center",minHeight:300},children:(0,gt.jsx)("canvas",{ref:m,style:{maxWidth:"100%",height:"auto",border:"1px solid #333"}})})]}),(0,gt.jsxs)("div",{style:{marginBottom:24},children:[(0,gt.jsx)("label",{style:{display:"block",marginBottom:12,fontWeight:600,color:v?"#ECEDEE":"#333"},children:"Choose Style"}),(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:Object.entries(qd).map(([e,t])=>(0,gt.jsxs)("button",{onClick:()=>o(e),disabled:c,style:{padding:16,border:a===e?`3px solid ${t.preview}`:v?"2px solid #3f3f46":"2px solid #ddd",borderRadius:8,background:a===e?v?"#1e3a5f":"#f0f9ff":v?"#27272a":"#fff",cursor:c?"not-allowed":"pointer",textAlign:"left",transition:"all 0.2s",opacity:c?.6:1},children:[(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,gt.jsx)("div",{style:{width:20,height:20,borderRadius:4,background:t.preview,border:v?"1px solid #52525b":"1px solid #ccc"}}),(0,gt.jsx)("span",{style:{fontWeight:600,fontSize:14,color:v?"#ECEDEE":"#333"},children:t.name})]}),(0,gt.jsx)("div",{style:{fontSize:12,color:v?"#a1a1aa":"#666"},children:t.description})]},e))})]}),(0,gt.jsxs)("div",{style:{marginBottom:24},children:[(0,gt.jsx)("label",{style:{display:"block",marginBottom:12,fontWeight:600,color:v?"#ECEDEE":"#333"},children:"Image Source"}),(0,gt.jsx)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:Object.entries(Hd).map(([e,t])=>(0,gt.jsxs)("button",{onClick:()=>l(e),disabled:c,style:{padding:"10px 16px",border:s===e?"2px solid #0ea5e9":v?"2px solid #3f3f46":"2px solid #ddd",borderRadius:8,background:s===e?v?"#1e3a5f":"#f0f9ff":v?"#27272a":"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.2s",opacity:c?.6:1},children:[(0,gt.jsx)("div",{style:{fontWeight:600,fontSize:13,color:v?"#ECEDEE":"#333"},children:t.name}),(0,gt.jsx)("div",{style:{fontSize:11,color:v?"#a1a1aa":"#666",marginTop:2},children:t.description})]},e))})]}),c&&(0,gt.jsxs)("div",{style:{marginBottom:20},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,gt.jsx)("span",{style:{fontSize:14,color:v?"#a1a1aa":"#666"},children:d.message}),(0,gt.jsxs)("span",{style:{fontSize:14,fontWeight:600,color:"#0ea5e9"},children:[d.percentage,"%"]})]}),(0,gt.jsx)("div",{style:{width:"100%",height:8,background:v?"#27272a":"#e5e7eb",borderRadius:4,overflow:"hidden"},children:(0,gt.jsx)("div",{style:{width:`${d.percentage}%`,height:"100%",background:"linear-gradient(90deg, #0ea5e9, #06b6d4)",transition:"width 0.3s ease",borderRadius:4}})})]})]}),(0,gt.jsxs)("div",{className:"fg-modal-footer",style:{padding:20,borderTop:v?"1px solid #27272a":"1px solid #e5e7eb"},children:[(0,gt.jsx)("button",{className:"fg-btn",onClick:c?()=>{g.current&&g.current.abort(),u(!1)}:t,style:{marginRight:12},children:c?"Cancel":"Close"}),(0,gt.jsx)("button",{className:"fg-btn fg-btn-primary",onClick:async()=>{if(n&&0!==i.length){u(!0),f(null),h({current:0,total:i.length,message:"Starting...",percentage:0}),g.current=new AbortController;try{const r=(0,bn.Gi)(),i=await fetch(`${r}/api/rolls/${n.id}/contact-sheet`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({style:a,imageSource:s,columns:6,maxTotalWidth:4800,maxPhotoWidth:400,quality:95}),signal:g.current.signal});if(!i.ok)throw new Error(`Server error: ${i.status}`);const o=i.body.getReader(),l=new TextDecoder;let c="";for(;;){const{done:n,value:r}=await o.read();if(n)break;c+=l.decode(r,{stream:!0});const i=c.split("\n");c=i.pop();for(const a of i)if(a.trim())try{const e=JSON.parse(a);if("progress"===e.type)h({current:e.current,total:e.total,message:e.message,percentage:e.percentage});else if("complete"===e.type){const n=atob(e.image),r=new Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);const i=new Uint8Array(r),a=new Blob([i],{type:"image/jpeg"}),o=URL.createObjectURL(a),s=document.createElement("a");s.href=o,s.download=e.filename,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o),h({current:e.photoCount,total:e.photoCount,message:"Complete! Downloaded.",percentage:100}),setTimeout(()=>{u(!1),t()},1500)}else if("error"===e.type)throw new Error(e.message)}catch(e){console.error("Failed to parse progress:",e)}}}catch(r){"AbortError"===r.name?f("Generation cancelled"):f(r.message),u(!1)}}},disabled:c||0===i.length,style:{opacity:c||0===i.length?.6:1,cursor:c||0===i.length?"not-allowed":"pointer"},children:c?"Generating...":"Generate & Download"})]})]})}):null}const Kd=(e,t="#3b82f6")=>({width:`${e}%`,height:"100%",backgroundColor:t,transition:"width 0.2s"});function Xd({isOpen:e,onClose:t,rollId:n,onUploadComplete:i}){const[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)("positive"),[c,u]=(0,r.useState)(!1),d=(0,r.useRef)(null),h=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),p=(e=>({modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:e?"rgba(0,0,0,0.7)":"rgba(0,0,0,0.5)",zIndex:99999,display:"flex",alignItems:"center",justifyContent:"center"},modalPanel:{backgroundColor:e?"#18181b":"#ffffff",borderRadius:"12px",width:"600px",maxWidth:"90vw",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:e?"0 25px 50px -12px rgba(0, 0, 0, 0.5)":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",border:e?"1px solid #27272a":"1px solid #e4e4e7"},dropZone:{border:e?"2px dashed #3f3f46":"2px dashed #d4d4d8",borderRadius:"8px",padding:"40px",textAlign:"center",cursor:"pointer",transition:"all 0.2s",backgroundColor:e?"#09090b":"#fafafa",margin:"0 20px 20px"},fileList:{flex:1,overflowY:"auto",padding:"0 20px",minHeight:"100px",maxHeight:"300px"},fileItem:{display:"flex",alignItems:"center",padding:"8px 12px",backgroundColor:e?"#27272a":"#f4f4f5",borderRadius:"6px",marginBottom:"8px",gap:"12px",fontSize:"13px"},progressBarContainer:{flex:1,height:"6px",backgroundColor:e?"#27272a":"#e4e4e7",borderRadius:"3px",overflow:"hidden",position:"relative"},header:{padding:"20px",borderBottom:e?"1px solid #27272a":"1px solid #e4e4e7",display:"flex",justifyContent:"space-between",alignItems:"center"},headerTitle:{margin:0,fontSize:"18px",color:e?"#ECEDEE":"#11181C"},closeButton:{background:"none",border:"none",color:e?"#71717a":"#a1a1aa",cursor:"pointer"},typeSelector:{padding:"20px",display:"flex",gap:"12px"},typeLabel:(t,n)=>({flex:1,padding:"12px",borderRadius:"8px",border:t?"2px solid #3b82f6":e?"1px solid #27272a":"1px solid #e4e4e7",backgroundColor:t?"rgba(59, 130, 246, 0.1)":"transparent",cursor:n?"not-allowed":"pointer",opacity:n?.6:1}),typeLabelTitle:t=>({fontWeight:600,color:t?"#60a5fa":e?"#ECEDEE":"#11181C",marginBottom:4}),typeLabelDesc:{fontSize:"12px",color:e?"#71717a":"#a1a1aa"},dropZoneText:{color:e?"#a1a1aa":"#71717a",marginBottom:8},dropZoneHint:{fontSize:"12px",color:e?"#52525b":"#a1a1aa"},fileName:{color:e?"#ECEDEE":"#11181C",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},fileSize:{fontSize:"11px",color:e?"#71717a":"#a1a1aa"},footer:{padding:"20px",borderTop:e?"1px solid #27272a":"1px solid #e4e4e7",display:"flex",flexDirection:"column",gap:12},progressText:{fontSize:"12px",color:e?"#71717a":"#a1a1aa",minWidth:60,textAlign:"right"},statsText:{fontSize:"13px",color:e?"#71717a":"#a1a1aa"},removeButton:{background:"none",border:"none",color:e?"#52525b":"#a1a1aa",cursor:"pointer"}}))(h),f=a.filter(e=>"success"===e.status).length,m=a.filter(e=>"error"===e.status).length,g=a.length,v=g>0?f/g*100:0;if(!e)return null;const A=e=>{const t=e.map(e=>({id:Math.random().toString(36).substr(2,9),file:e,status:"pending",progress:0,error:null}));o(e=>[...e,...t])};return(0,gt.jsx)("div",{style:p.modalOverlay,onClick:t,onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),e.dataTransfer.files&&A(Array.from(e.dataTransfer.files))},children:(0,gt.jsxs)("div",{style:p.modalPanel,onClick:e=>e.stopPropagation(),children:[(0,gt.jsxs)("div",{style:p.header,children:[(0,gt.jsx)("h2",{style:p.headerTitle,children:"Upload Photos"}),(0,gt.jsx)("button",{onClick:t,style:p.closeButton,children:(0,gt.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,gt.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,gt.jsx)("div",{style:p.typeSelector,children:[{id:"positive",label:"Positive",desc:"Processed JPGs"},{id:"negative",label:"Negative",desc:"Film Scans"},{id:"original",label:"Original",desc:"RAW / Backups"}].map(e=>(0,gt.jsxs)("label",{style:p.typeLabel(s===e.id,c),children:[(0,gt.jsx)("input",{type:"radio",name:"uploadType",value:e.id,checked:s===e.id,onChange:e=>l(e.target.value),disabled:c,style:{display:"none"}}),(0,gt.jsx)("div",{style:p.typeLabelTitle(s===e.id),children:e.label}),(0,gt.jsx)("div",{style:p.typeLabelDesc,children:e.desc})]},e.id))}),!c&&(0,gt.jsxs)("div",{style:p.dropZone,onClick:()=>d.current&&d.current.click(),className:"upload-dropzone",children:[(0,gt.jsx)("input",{type:"file",multiple:!0,onChange:e=>{e.target.files&&A(Array.from(e.target.files)),d.current&&(d.current.value="")},style:{display:"none"},ref:d}),(0,gt.jsx)("div",{style:p.dropZoneText,children:"Click to browse or drag files here"}),(0,gt.jsx)("div",{style:p.dropZoneHint,children:"Supports JPG, JPEG, TIFF, DNG, CR2, NEF, ARW..."})]}),a.length>0&&(0,gt.jsx)("div",{style:p.fileList,children:a.map((e,t)=>(0,gt.jsxs)("div",{style:p.fileItem,children:[(0,gt.jsxs)("div",{style:{width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"},children:["pending"===e.status&&(0,gt.jsx)("span",{style:{color:h?"#71717a":"#a1a1aa"},children:"\u2022"}),"uploading"===e.status&&(0,gt.jsx)("div",{className:"spinner-sm",style:{borderColor:h?"#fff":"#3b82f6"}}),"success"===e.status&&(0,gt.jsx)("span",{style:{color:"#4ade80"},children:"\u2713"}),"error"===e.status&&(0,gt.jsx)("span",{style:{color:"#ef4444"},children:"\u2715"})]}),(0,gt.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,gt.jsx)("span",{style:p.fileName,children:e.file.name}),(0,gt.jsxs)("span",{style:p.fileSize,children:[(e.file.size/1024/1024).toFixed(1)," MB"]})]}),e.error&&(0,gt.jsx)("div",{style:{fontSize:"11px",color:"#ef4444",marginTop:2},children:e.error}),"uploading"===e.status&&(0,gt.jsx)("div",{style:{fontSize:"11px",color:h?"#71717a":"#a1a1aa",marginTop:2},children:"Processing..."})]}),!c&&"pending"===e.status&&(0,gt.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{c||o(t=>t.filter(t=>t.id!==e))})(e.id)},style:p.removeButton,children:"\xd7"})]},e.id))}),(0,gt.jsxs)("div",{style:p.footer,children:[c&&(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,gt.jsx)("div",{style:p.progressBarContainer,children:(0,gt.jsx)("div",{style:Kd(v)})}),(0,gt.jsxs)("div",{style:p.progressText,children:[Math.round(v),"%"]})]}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,gt.jsxs)("div",{style:p.statsText,children:[a.length," files selected",m>0&&(0,gt.jsxs)("span",{style:{color:"#ef4444",marginLeft:8},children:["(",m," failed)"]})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[!c&&(0,gt.jsx)("button",{className:"secondary-btn",onClick:()=>{o([])},disabled:0===a.length,children:"Clear"}),c?(0,gt.jsxs)("button",{className:"primary-btn",disabled:!0,style:{opacity:.7},children:["Uploading ",f,"/",g]}):(0,gt.jsx)("button",{className:"primary-btn",onClick:async()=>{u(!0);for(let t=0;t<a.length;t++){const r=a[t];if("success"!==r.status){o(e=>{const n=[...e];return n[t]={...n[t],status:"uploading",progress:0},n});try{await(0,bn.i5)(n,r.file,{uploadType:s}),o(e=>{const n=[...e];return n[t]={...n[t],status:"success",progress:100},n})}catch(e){console.error("Upload failed",e),o(n=>{const r=[...n],i=e.message||"Upload failed";return r[t]={...r[t],status:"error",error:i},r})}}}u(!1),a.every(e=>"success"===e.status),i&&i()},disabled:0===a.length||a.every(e=>"success"===e.status),style:{backgroundColor:"positive"===s?"#2563eb":"negative"===s?"#ea580c":"#7c3aed"},children:"Start Upload"})]})]})]})]})})}function Yd({current:e,total:t,status:n}){const r=t>0?Math.round(e/t*100):0;return(0,gt.jsx)("div",{style:{width:"100%",height:20,background:"#333",borderRadius:10,overflow:"hidden",marginBottom:12},children:(0,gt.jsx)("div",{style:{width:`${r}%`,height:"100%",background:(()=>{switch(n){case"completed":return"#4CAF50";case"failed":return"#f44336";case"cancelled":return"#9e9e9e";case"paused":return"#ff9800";default:return"#2196F3"}})(),transition:"width 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:r>10&&(0,gt.jsxs)("span",{style:{fontSize:11,fontWeight:600,color:"#fff"},children:[r,"%"]})})})}function Qd({jobId:e,jobType:t="render",onProgress:n,onComplete:i,onCancel:a,onPause:o,onResume:s,getProgress:l,cancelJob:c,pauseJob:u,resumeJob:d}){const[h,p]=(0,r.useState)({status:"processing",total:0,completed:0,failed:0,current:null,failedItems:[]}),f=(0,r.useCallback)(async()=>{if(e&&l)try{const t=await l(e);if(p(t),n&&n(t),"completed"===t.status||"failed"===t.status||"cancelled"===t.status)return;setTimeout(f,500)}catch(or){console.error("[BatchExportProgress] Poll error:",or),setTimeout(f,2e3)}},[e,l,n]);(0,r.useEffect)(()=>{e&&f()},[e,f]);const m="paused"===h.status,g="processing"===h.status,v="completed"===h.status,A="failed"===h.status,y="cancelled"===h.status;return(0,gt.jsxs)("div",{style:{background:"#1a1a1a",borderRadius:8,padding:20,minWidth:400},children:[(0,gt.jsx)("div",{style:{marginBottom:16},children:(0,gt.jsx)("h3",{style:{margin:0,color:"#fff"},children:"render"===t?"\u6279\u91cf\u6e32\u67d3\u8fdb\u5ea6":"\u6279\u91cf\u4e0b\u8f7d\u8fdb\u5ea6"})}),h.current&&(0,gt.jsxs)("div",{style:{padding:10,background:"#252525",borderRadius:6,marginBottom:16},children:[(0,gt.jsx)("div",{style:{fontSize:12,color:"#888",marginBottom:4},children:"\u6b63\u5728\u5904\u7406:"}),(0,gt.jsx)("div",{style:{fontSize:14,color:"#fff",fontFamily:"monospace"},children:h.current.filename||`Photo #${h.current.photoId}`})]}),(0,gt.jsx)(Yd,{current:h.completed+h.failed,total:h.total,status:h.status}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,fontSize:13},children:[(0,gt.jsxs)("span",{style:{color:"#4CAF50"},children:["\u2713 \u5df2\u5b8c\u6210: ",h.completed]}),(0,gt.jsxs)("span",{style:{color:h.failed>0?"#f44336":"#666"},children:["\u2717 \u5931\u8d25: ",h.failed]}),(0,gt.jsxs)("span",{style:{color:"#888"},children:["\u25cb \u5f85\u5904\u7406: ",Math.max(0,h.total-h.completed-h.failed)]})]}),v&&(0,gt.jsx)("div",{style:{padding:10,background:"#1a3a1a",borderRadius:6,marginBottom:16,color:"#4CAF50",textAlign:"center"},children:"\u2713 \u4efb\u52a1\u5b8c\u6210\uff01"}),A&&(0,gt.jsx)("div",{style:{padding:10,background:"#3a1a1a",borderRadius:6,marginBottom:16,color:"#f44336",textAlign:"center"},children:"\u2717 \u4efb\u52a1\u5931\u8d25"}),y&&(0,gt.jsx)("div",{style:{padding:10,background:"#2a2a2a",borderRadius:6,marginBottom:16,color:"#9e9e9e",textAlign:"center"},children:"\u4efb\u52a1\u5df2\u53d6\u6d88"}),m&&(0,gt.jsx)("div",{style:{padding:10,background:"#3a2a1a",borderRadius:6,marginBottom:16,color:"#ff9800",textAlign:"center"},children:"\u4efb\u52a1\u5df2\u6682\u505c"}),h.failedItems&&h.failedItems.length>0&&(0,gt.jsxs)("div",{style:{marginBottom:16,maxHeight:100,overflow:"auto",background:"#252525",borderRadius:6,padding:10},children:[(0,gt.jsx)("div",{style:{fontSize:12,color:"#f44336",marginBottom:8},children:"\u5931\u8d25\u9879:"}),h.failedItems.map((e,t)=>(0,gt.jsxs)("div",{style:{fontSize:11,color:"#888",marginBottom:4},children:["Photo #",e.photoId,": ",e.error]},t))]}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[(0,gt.jsxs)("div",{style:{display:"flex",gap:10},children:[g&&u&&(0,gt.jsx)("button",{onClick:async()=>{u&&(await u(e),o&&o())},style:{padding:"8px 16px",background:"#ff9800",color:"#000",border:"none",borderRadius:4,cursor:"pointer"},children:"\u6682\u505c"}),m&&d&&(0,gt.jsx)("button",{onClick:async()=>{d&&(await d(e),s&&s())},style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"\u7ee7\u7eed"}),(g||m)&&c&&(0,gt.jsx)("button",{onClick:async()=>{c&&(await c(e),a&&a())},style:{padding:"8px 16px",background:"#666",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"\u53d6\u6d88"})]}),(v||A||y)&&(0,gt.jsx)("button",{onClick:()=>i&&i(h),style:{padding:"8px 20px",background:"#2196F3",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"\u5b8c\u6210"})]})]})}var Zd=n(9277);const Jd="\ud83d\udcc1",eh="\ud83d\udcc4",th="\ud83d\uddbc\ufe0f",nh="\u2b06\ufe0f",rh="\u23f3",ih="\u274c",ah=["jpg","jpeg","png","tif","tiff","gif","bmp","webp","raw","cr2","nef","arw","dng"];function oh({isOpen:e,onClose:t,onSelect:n,mode:i="directory",fileFilter:a=null,title:o="\u9009\u62e9\u8def\u5f84",initialPath:s=null}){const[l,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[h,p]=(0,r.useState)([]),[f,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)(null),[A,y]=(0,r.useState)(null),[b,x]=(0,r.useState)(!1),[_,w]=(0,r.useState)(null),S=(0,r.useCallback)(async()=>{m(!0),v(null);try{const e=(0,bn.Gi)(),t=await fetch(`${e}/api/filesystem/roots`),n=await t.json();return n.ok?(c(n.roots||[]),n.roots||[]):(v(n.error||"Failed to load roots"),[])}catch(e){return v(e.message||"Network error"),[]}finally{m(!1)}},[]),T=(0,r.useCallback)(async e=>{m(!0),v(null),y(null);try{const t=new URLSearchParams({path:e});"file"===i&&a&&t.set("filter",a.join(","));const n=(0,bn.Gi)(),r=await fetch(`${n}/api/filesystem/browse?${t}`),o=await r.json();o.ok?(d(o.path),w(o.parent),x(o.canGoUp),p(o.items||[])):v(o.error||"Failed to browse path")}catch(t){v(t.message||"Network error")}finally{m(!1)}},[i,a]);(0,r.useEffect)(()=>{e&&(s?T(s):(S().then(e=>{1===(null===e||void 0===e?void 0:e.length)&&T(e[0].path)}),d(null),p([])))},[e,s,S,T]);const C=e=>{var t;return"directory"===e.type?Jd:ah.includes(null===(t=e.ext)||void 0===t?void 0:t.toLowerCase())?th:eh};return e?(0,gt.jsx)("div",{style:sh.overlay,onClick:t,children:(0,gt.jsxs)("div",{style:sh.modal,onClick:e=>e.stopPropagation(),children:[(0,gt.jsxs)("div",{style:sh.header,children:[(0,gt.jsx)("h3",{style:sh.title,children:o}),(0,gt.jsx)("button",{style:sh.closeBtn,onClick:t,children:"\xd7"})]}),(0,gt.jsxs)("div",{style:sh.pathBar,children:[(0,gt.jsxs)("button",{style:sh.upBtn,onClick:()=>{b&&_?T(_):(d(null),p([]),S())},disabled:!u,children:[nh," \u4e0a\u7ea7"]}),(0,gt.jsx)("div",{style:sh.currentPath,children:u||"\u6839\u76ee\u5f55"})]}),(0,gt.jsx)("div",{style:sh.content,children:f?(0,gt.jsxs)("div",{style:sh.loading,children:[rh," \u52a0\u8f7d\u4e2d..."]}):g?(0,gt.jsxs)("div",{style:sh.error,children:[ih," ",g]}):u?(0,gt.jsx)("div",{style:sh.itemList,children:0===h.length?(0,gt.jsx)("div",{style:sh.empty,children:"\u7a7a\u76ee\u5f55"}):h.map((e,r)=>{return(0,gt.jsxs)("div",{style:{...sh.item,...(null===A||void 0===A?void 0:A.path)===e.path?sh.itemSelected:{}},onClick:()=>(e=>{"directory"===e.type?T(e.path):y(e)})(e),onDoubleClick:()=>(e=>{"directory"===e.type?"directory"!==i&&"both"!==i||(n(e.path),t()):"file"!==i&&"both"!==i||(n(e.path),t())})(e),children:[(0,gt.jsx)("span",{style:sh.icon,children:C(e)}),(0,gt.jsx)("span",{style:sh.itemName,children:e.name}),"file"===e.type&&(0,gt.jsx)("span",{style:sh.itemSize,children:(a=e.size,a?a<1024?`${a} B`:a<1048576?`${(a/1024).toFixed(1)} KB`:a<1073741824?`${(a/1024/1024).toFixed(1)} MB`:`${(a/1024/1024/1024).toFixed(2)} GB`:"")}),"directory"===e.type&&e.hasChildren&&(0,gt.jsx)("span",{style:sh.itemArrow,children:"\u203a"})]},r);var a})}):(0,gt.jsx)("div",{style:sh.itemList,children:0===l.length?(0,gt.jsx)("div",{style:sh.empty,children:"\u6ca1\u6709\u53ef\u7528\u7684\u76ee\u5f55"}):l.map((e,t)=>(0,gt.jsxs)("div",{style:sh.item,onClick:()=>T(e.path),children:[(0,gt.jsx)("span",{style:sh.icon,children:Jd}),(0,gt.jsx)("span",{style:sh.itemName,children:e.name}),(0,gt.jsx)("span",{style:sh.itemPath,children:e.path})]},t))})}),(0,gt.jsxs)("div",{style:sh.footer,children:["directory"===i&&u&&(0,gt.jsx)("button",{style:sh.selectCurrentBtn,onClick:()=>{"directory"!==i&&"both"!==i||(n(u),t())},children:"\u9009\u62e9\u5f53\u524d\u76ee\u5f55"}),(0,gt.jsxs)("div",{style:sh.footerRight,children:[(0,gt.jsx)("button",{style:sh.cancelBtn,onClick:t,children:"\u53d6\u6d88"}),(0,gt.jsx)("button",{style:{...sh.confirmBtn,opacity:A||"directory"===i&&u?1:.5},onClick:()=>{A?(n(A.path),t()):!u||"directory"!==i&&"both"!==i||(n(u),t())},disabled:!A&&!("directory"===i&&u),children:"\u786e\u5b9a"})]})]})]})}):null}const sh={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},modal:{background:"#1e1e1e",borderRadius:12,width:"90%",maxWidth:700,maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",borderBottom:"1px solid #333"},title:{margin:0,color:"#fff",fontSize:18,fontWeight:600},closeBtn:{background:"none",border:"none",color:"#888",fontSize:24,cursor:"pointer",padding:0,lineHeight:1},pathBar:{display:"flex",alignItems:"center",padding:"12px 20px",borderBottom:"1px solid #333",gap:12},upBtn:{background:"#333",border:"none",color:"#fff",padding:"6px 12px",borderRadius:4,cursor:"pointer",fontSize:13},currentPath:{flex:1,color:"#888",fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},content:{flex:1,overflow:"auto",minHeight:300},loading:{display:"flex",alignItems:"center",justifyContent:"center",height:200,color:"#888",fontSize:16},error:{display:"flex",alignItems:"center",justifyContent:"center",height:200,color:"#f44336",fontSize:14},empty:{display:"flex",alignItems:"center",justifyContent:"center",height:200,color:"#666",fontSize:14},itemList:{padding:"8px 0"},item:{display:"flex",alignItems:"center",padding:"10px 20px",cursor:"pointer",gap:12,transition:"background 0.15s"},itemSelected:{background:"#2196F3",color:"#fff"},icon:{fontSize:20,width:24,textAlign:"center"},itemName:{flex:1,color:"#fff",fontSize:14,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},itemPath:{color:"#666",fontSize:12,marginLeft:"auto"},itemSize:{color:"#888",fontSize:12,marginLeft:"auto"},itemArrow:{color:"#666",fontSize:18},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",borderTop:"1px solid #333"},footerRight:{display:"flex",gap:12,marginLeft:"auto"},selectCurrentBtn:{background:"#333",border:"none",color:"#fff",padding:"8px 16px",borderRadius:6,cursor:"pointer",fontSize:14},cancelBtn:{background:"#333",border:"none",color:"#fff",padding:"8px 20px",borderRadius:6,cursor:"pointer",fontSize:14},confirmBtn:{background:"#2196F3",border:"none",color:"#fff",padding:"8px 20px",borderRadius:6,cursor:"pointer",fontSize:14,fontWeight:500}},lh="library",ch="download",uh="selected",dh="all",hh="no-positive",ph="preset",fh="custom",mh="lut";function gh({isOpen:e,onClose:t,rollId:n,selectedPhotos:i=[],allPhotos:a=[],onComplete:o,onOpenFilmLab:s}){const[l,c]=(0,r.useState)(lh),[u,d]=(0,r.useState)(""),[h,p]=(0,r.useState)(uh),[f,m]=(0,r.useState)(ph),[g,v]=(0,r.useState)(null),[A,y]=(0,r.useState)(null),[b,x]=(0,r.useState)("jpeg"),[_,w]=(0,r.useState)(95),[S,T]=(0,r.useState)(""),[C,M]=(0,r.useState)(1),[E,P]=(0,r.useState)([]),[N,k]=(0,r.useState)(null),[R,L]=(0,r.useState)(!1),[O,j]=(0,r.useState)(!1),D=(0,r.useRef)({status:"idle",total:0,completed:0,failed:0,current:0}),[I,B]=(0,r.useState)(!1),[F,z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{const e=await Zd.Ay.getServerCapabilities();z("nas"===e.mode)})()},[]),(0,r.useEffect)(()=>{e&&(k(null),L(!1))},[e]);const U=(0,r.useMemo)(()=>{const e=a.filter(e=>!e.positive_rel_path);return{selected:i.length,all:a.length,noPositive:e.length}},[i,a]);(0,r.useEffect)(()=>{e&&(0,bn.nk)().then(e=>{const t=(null===e||void 0===e?void 0:e.presets)||[];P(t),t.length>0&&!g&&v(t[0].id)}).catch(e=>console.error("Failed to load presets:",e))},[e]),(0,r.useEffect)(()=>{0===i.length&&h===uh&&p(U.noPositive>0?hh:dh)},[i.length,h,U.noPositive]);const V=()=>{if(N){if(!window.confirm("\u4efb\u52a1\u6b63\u5728\u8fdb\u884c\u4e2d\uff0c\u786e\u5b9a\u8981\u5173\u95ed\u5417\uff1f"))return;(0,bn.N8)(N).catch(()=>{})}k(null),t()};if(!e)return null;const G=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),q={overlay:G?"rgba(0,0,0,0.8)":"rgba(0,0,0,0.5)",modalBg:G?"#18181b":"#ffffff",modalBorder:G?"#27272a":"#e4e4e7",text:G?"#ECEDEE":"#11181C",textMuted:G?"#71717a":"#a1a1aa",textSecondary:G?"#d4d4d8":"#3f3f46",inputBg:G?"#27272a":"#f4f4f5",inputBorder:G?"#3f3f46":"#e4e4e7",cardBg:G?"#27272a":"#f4f4f5",buttonSecondary:G?"#27272a":"#f4f4f5",buttonSecondaryText:G?"#ECEDEE":"#11181C"};return(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(oh,{isOpen:I,onClose:()=>B(!1),onSelect:e=>{d(e)},mode:"directory",title:"\u9009\u62e9\u8f93\u51fa\u76ee\u5f55 (\u670d\u52a1\u5668\u7aef)"}),(0,gt.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:q.overlay,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:(0,gt.jsxs)("div",{style:{background:q.modalBg,border:`1px solid ${q.modalBorder}`,borderRadius:12,padding:24,minWidth:500,maxWidth:600,maxHeight:"80vh",overflow:"auto"},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,gt.jsx)("h2",{style:{margin:0,color:q.text},children:"\u6279\u91cf\u6e32\u67d3"}),(0,gt.jsx)("button",{onClick:V,style:{background:"none",border:"none",color:q.textMuted,fontSize:24,cursor:"pointer"},children:"\xd7"})]}),N?(0,gt.jsx)(Qd,{jobId:N,jobType:"render",getProgress:O?()=>Promise.resolve(D.current):bn.Wf,cancelJob:O?void 0:bn.N8,pauseJob:O?void 0:bn.lp,resumeJob:O?void 0:bn.Eq,onComplete:e=>{k(null),alert(`\u5b8c\u6210\n\u6210\u529f\u5904\u7406 ${e.completed} / ${e.total} \u5f20\u7167\u7247`),o&&o(e)}}):(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsxs)(vh,{title:"\u8f93\u51fa\u6a21\u5f0f",colors:q,children:[(0,gt.jsx)(Ah,{value:l,onChange:c,colors:q,options:[{value:lh,label:"\u5199\u5165\u5e93 (\u66f4\u65b0\u6b63\u7247\u548c\u7f29\u7565\u56fe)"},{value:ch,label:"\u6e32\u67d3\u540e\u4e0b\u8f7d\u5230\u672c\u5730"}]}),l===ch&&(0,gt.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8},children:[(0,gt.jsx)("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"\u8f93\u51fa\u76ee\u5f55",style:{flex:1,padding:"8px 12px",background:q.inputBg,border:`1px solid ${q.inputBorder}`,borderRadius:4,color:q.text}}),(0,gt.jsx)("button",{onClick:async()=>{if(!F||window.__electron)if(window.__electron&&window.__electron.selectDirectory){const e=await window.__electron.selectDirectory();e&&d(e)}else if(F)B(!0);else{const e=prompt("\u8bf7\u8f93\u5165\u8f93\u51fa\u76ee\u5f55\u8def\u5f84:",u||"D:/Exports");e&&d(e)}else B(!0)},style:{padding:"8px 16px",background:q.buttonSecondary,border:`1px solid ${q.inputBorder}`,borderRadius:4,color:q.buttonSecondaryText,cursor:"pointer"},children:"\u9009\u62e9..."})]})]}),(0,gt.jsx)(vh,{title:"\u7167\u7247\u8303\u56f4",colors:q,children:(0,gt.jsx)(Ah,{value:h,onChange:p,colors:q,options:[{value:uh,label:`\u9009\u4e2d\u7684\u7167\u7247 (${U.selected} \u5f20)`,disabled:0===U.selected},{value:dh,label:`\u6240\u6709\u7167\u7247 (${U.all} \u5f20)`},{value:hh,label:`\u4ec5\u65e0\u6b63\u7247 (${U.noPositive} \u5f20)`,disabled:0===U.noPositive}]})}),(0,gt.jsxs)(vh,{title:"\u5904\u7406\u53c2\u6570",colors:q,children:[(0,gt.jsx)(Ah,{value:f,onChange:m,colors:q,options:[{value:ph,label:"\u4f7f\u7528\u9884\u8bbe"},{value:fh,label:"\u4f7f\u7528 FilmLab \u8c03\u53c2",disabled:!s},{value:mh,label:"\u5e94\u7528 LUT \u6587\u4ef6"}]}),f===ph&&(0,gt.jsx)("div",{style:{marginTop:12},children:(0,gt.jsxs)("select",{value:g||"",onChange:e=>v(Number(e.target.value)),style:{width:"100%",padding:"8px 12px",background:q.inputBg,border:`1px solid ${q.inputBorder}`,borderRadius:4,color:q.text},children:[0===E.length&&(0,gt.jsx)("option",{value:"",children:"\u65e0\u53ef\u7528\u9884\u8bbe"}),E.map(e=>(0,gt.jsx)("option",{value:e.id,children:e.name},e.id))]})}),f===fh&&s&&(0,gt.jsxs)("div",{style:{marginTop:12},children:[(0,gt.jsx)("button",{onClick:()=>s(e=>y(e)),style:{padding:"8px 16px",background:"#2196F3",border:"none",borderRadius:4,color:"#fff",cursor:"pointer"},children:"\u6253\u5f00 FilmLab \u8c03\u53c2..."}),A&&(0,gt.jsx)("div",{style:{marginTop:8,color:"#4CAF50",fontSize:12},children:"\u2713 \u5df2\u914d\u7f6e\u81ea\u5b9a\u4e49\u53c2\u6570"})]}),f===mh&&(0,gt.jsx)(yh,{lutFileName:S,lutIntensity:C,onLutSelect:e=>T(e),onIntensityChange:e=>M(e),colors:q})]}),l===ch&&(0,gt.jsx)(vh,{title:"\u8f93\u51fa\u8bbe\u7f6e",colors:q,children:(0,gt.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,gt.jsxs)("div",{style:{flex:1},children:[(0,gt.jsx)("label",{style:{display:"block",color:q.textMuted,fontSize:12,marginBottom:4},children:"\u683c\u5f0f"}),(0,gt.jsxs)("select",{value:b,onChange:e=>x(e.target.value),style:{width:"100%",padding:"8px 12px",background:q.inputBg,border:`1px solid ${q.inputBorder}`,borderRadius:4,color:q.text},children:[(0,gt.jsx)("option",{value:"jpeg",children:"JPEG"}),(0,gt.jsx)("option",{value:"tiff16",children:"TIFF (16-bit)"})]})]}),"jpeg"===b&&(0,gt.jsxs)("div",{style:{flex:1},children:[(0,gt.jsx)("label",{style:{display:"block",color:q.textMuted,fontSize:12,marginBottom:4},children:"\u8d28\u91cf"}),(0,gt.jsx)("input",{type:"number",min:1,max:100,value:_,onChange:e=>w(Number(e.target.value)),style:{width:"100%",padding:"8px 12px",background:q.inputBg,border:`1px solid ${q.inputBorder}`,borderRadius:4,color:q.text}})]})]})}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:24},children:[(0,gt.jsx)("button",{onClick:V,style:{padding:"10px 24px",background:q.inputBorder,border:"none",borderRadius:6,color:q.text,cursor:"pointer"},children:"\u53d6\u6d88"}),(0,gt.jsx)("button",{onClick:async()=>{if(!R)if(l!==ch||u)if(f!==ph||g){L(!0);try{let e=h===uh?i.map(e=>e.id):void 0;const t=(()=>{switch(f){case ph:return{type:"preset",presetId:g};case fh:return{type:"custom",params:A||{}};case mh:return{type:"lut",lutPath:S,lutIntensity:C};default:return{type:"preset",presetId:g}}})();if(Zd.Ay.isHybridMode()){if(j(!0),!e){const t=await(0,bn.i$)(n);if(!t||!t.value)throw new Error("Failed to fetch roll photos for batch processing");{let n=t.value;h===hh&&(n=n.filter(e=>!e.positive_rel_path)),e=n.map(e=>e.id)}}if(!e||0===e.length)throw new Error("No photos to process");let t={};if(f===ph){const e=E.find(e=>e.id===g);if(!e)throw new Error("Preset not found");try{t="string"===typeof e.params_json?JSON.parse(e.params_json):e.params}catch(or){console.error("Failed to parse preset params",or)}}else f===fh?t=A:f===mh&&(t={lut:S,intensity:C});k("local-job-"+Date.now()),D.current={status:"processing",total:e.length,completed:0,failed:0,current:0},Zd.Ay.batchProcess(e,t,{format:b,outputDir:l===ch?u:void 0,uploadToServer:l===lh,onProgress:e=>{D.current={status:"processing",...e}}}).then(e=>{D.current={status:e.ok?"completed":"failed",...D.current}}).catch(e=>{console.error("Local batch failed",e),D.current={status:"failed",...D.current}})}else{let r;if(r=l===lh?await(0,bn.EG)({rollId:n,scope:h,photoIds:e,paramsSource:t}):await(0,bn.PG)({rollId:n,scope:h,photoIds:e,paramsSource:t,outputDir:u,format:b,quality:_}),!r.jobId)throw new Error(r.error||"Failed to create job");k(r.jobId)}}catch(or){console.error("Failed to start batch render:",or),alert("\u542f\u52a8\u6279\u91cf\u6e32\u67d3\u5931\u8d25: "+or.message)}finally{L(!1)}}else alert("\u8bf7\u9009\u62e9\u9884\u8bbe");else alert("\u8bf7\u9009\u62e9\u8f93\u51fa\u76ee\u5f55")},disabled:R,style:{padding:"10px 24px",background:R?q.textMuted:"#2196F3",border:"none",borderRadius:6,color:"#fff",cursor:R?"not-allowed":"pointer"},children:R?"\u542f\u52a8\u4e2d...":"\u5f00\u59cb\u6e32\u67d3"})]})]})]})})]})}function vh({title:e,children:t,colors:n}){return(0,gt.jsxs)("div",{style:{marginBottom:20},children:[(0,gt.jsxs)("div",{style:{color:(null===n||void 0===n?void 0:n.textMuted)||"#888",fontSize:12,fontWeight:600,marginBottom:10,textTransform:"uppercase"},children:["\u25bc ",e]}),t]})}function Ah({value:e,onChange:t,options:n,colors:r}){return(0,gt.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(n=>(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:n.disabled?"not-allowed":"pointer",opacity:n.disabled?.5:1},children:[(0,gt.jsx)("input",{type:"radio",checked:e===n.value,onChange:()=>!n.disabled&&t(n.value),disabled:n.disabled,style:{accentColor:"#2196F3"}}),(0,gt.jsx)("span",{style:{color:(null===r||void 0===r?void 0:r.textSecondary)||"#ddd"},children:n.label})]},n.value))})}function yh({lutFileName:e,lutIntensity:t,onLutSelect:n,onIntensityChange:i,colors:a}){const[o,s]=(0,r.useState)([]),l=r.useRef(null);(0,r.useEffect)(()=>{c()},[]);const c=async()=>{try{const e=(0,bn.Gi)(),t=await fetch(`${e}/api/luts`);if(t.ok){const e=await t.json();s(e.luts||[])}}catch(or){console.error("Failed to load LUTs:",or)}};return(0,gt.jsxs)("div",{style:{marginTop:12},children:[(0,gt.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:10},children:[(0,gt.jsxs)("select",{value:e||"",onChange:e=>n(e.target.value),style:{flex:1,padding:"8px 12px",background:(null===a||void 0===a?void 0:a.inputBg)||"#252525",border:`1px solid ${(null===a||void 0===a?void 0:a.inputBorder)||"#333"}`,borderRadius:4,color:(null===a||void 0===a?void 0:a.text)||"#fff"},children:[(0,gt.jsx)("option",{value:"",children:"\u9009\u62e9 LUT \u6587\u4ef6..."}),o.map(e=>(0,gt.jsx)("option",{value:e.name,children:e.name},e.name))]}),(0,gt.jsx)("input",{ref:l,type:"file",accept:".cube,.3dl,.csp,.lut",onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;const i=r.name.toLowerCase().split(".").pop();if(!["cube","3dl","csp","lut"].includes(i))return void alert("\u4ec5\u652f\u6301 .cube, .3dl, .csp, .lut \u683c\u5f0f");const a=new FormData;a.append("lut",r);try{const e=(0,bn.Gi)(),t=await fetch(`${e}/api/luts/upload`,{method:"POST",body:a}),r=t.headers.get("content-type");if(t.ok){const e=await t.json();await c(),n(e.filename)}else if(r&&r.includes("application/json")){const e=await t.json();alert("\u4e0a\u4f20\u5931\u8d25: "+(e.error||"\u672a\u77e5\u9519\u8bef"))}else alert("\u4e0a\u4f20\u5931\u8d25: \u670d\u52a1\u5668\u9519\u8bef ("+t.status+")")}catch(e){console.error("Failed to upload LUT:",e),alert("\u4e0a\u4f20\u5931\u8d25: "+e.message)}e.target.value=""},style:{display:"none"}}),(0,gt.jsx)("button",{onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},style:{padding:"8px 12px",background:(null===a||void 0===a?void 0:a.inputBorder)||"#333",border:"none",borderRadius:4,color:(null===a||void 0===a?void 0:a.text)||"#fff",cursor:"pointer",whiteSpace:"nowrap"},children:"\u4e0a\u4f20 LUT"})]}),(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,gt.jsx)("label",{style:{color:(null===a||void 0===a?void 0:a.textMuted)||"#888",fontSize:12,minWidth:40},children:"\u5f3a\u5ea6"}),(0,gt.jsx)("input",{type:"range",min:0,max:1,step:.01,value:t,onChange:e=>i(parseFloat(e.target.value)),style:{flex:1}}),(0,gt.jsxs)("span",{style:{color:(null===a||void 0===a?void 0:a.text)||"#fff",fontSize:12,minWidth:40,textAlign:"right"},children:[Math.round(100*t),"%"]})]}),e&&(0,gt.jsxs)("div",{style:{marginTop:8,color:"#4CAF50",fontSize:12},children:["\u2713 \u5df2\u9009\u62e9: ",e]})]})}const bh="positive",xh="negative",_h="original",wh="selected",Sh="all",Th=[{value:"{filename}",label:"\u539f\u59cb\u6587\u4ef6\u540d (DSC_0001.jpg)"},{value:"{frame}_{filename}",label:"\u5e27\u53f7_\u539f\u59cb\u6587\u4ef6\u540d (01_DSC_0001.jpg)"},{value:"{date}_{frame}",label:"\u65e5\u671f_\u5e27\u53f7 (2025-01-14_01.jpg)"},{value:"{roll}_{frame}",label:"\u5377\u540d_\u5e27\u53f7 (Portra400_01.jpg)"}];function Ch({isOpen:e,onClose:t,rollId:n,rollName:i="",selectedPhotos:a=[],allPhotos:o=[],onComplete:s}){const[l,c]=(0,r.useState)(bh),[u,d]=(0,r.useState)(""),[h,p]=(0,r.useState)(wh),[f,m]=(0,r.useState)(!0),[g,v]=(0,r.useState)("{filename}"),[A,y]=(0,r.useState)("jpeg"),[b,x]=(0,r.useState)(95),[_,w]=(0,r.useState)(null),[S,T]=(0,r.useState)(!1),[C,M]=(0,r.useState)(null),[E,P]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&(M(null),P(!1),w(null))},[e]);const N=(0,r.useMemo)(()=>h===wh?a:o,[h,a,o]);(0,r.useEffect)(()=>{if(e&&N.length>0&&n){T(!0);const e=N.map(e=>e.id);(0,bn.cx)(n,l,h,e).then(e=>w(e)).catch(e=>{console.error("Failed to check availability:",e),w(null)}).finally(()=>T(!1))}},[e,N,l,n,h]),(0,r.useEffect)(()=>{0===a.length&&h===wh&&p(Sh)},[a.length,h]);const k=()=>{if(C){if(!window.confirm("\u4e0b\u8f7d\u6b63\u5728\u8fdb\u884c\u4e2d\uff0c\u786e\u5b9a\u8981\u5173\u95ed\u5417\uff1f"))return;(0,bn.TH)(C).catch(()=>{})}M(null),t()};if(!e)return null;const R=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),L={overlay:R?"rgba(0,0,0,0.8)":"rgba(0,0,0,0.5)",modalBg:R?"#18181b":"#ffffff",modalBorder:R?"#27272a":"#e4e4e7",text:R?"#ECEDEE":"#11181C",textMuted:R?"#71717a":"#a1a1aa",textSecondary:R?"#d4d4d8":"#3f3f46",inputBg:R?"#27272a":"#f4f4f5",inputBorder:R?"#3f3f46":"#e4e4e7",buttonSecondary:R?"#27272a":"#f4f4f5",buttonSecondaryText:R?"#ECEDEE":"#11181C"};return(0,gt.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:L.overlay,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:(0,gt.jsxs)("div",{style:{background:L.modalBg,border:`1px solid ${L.modalBorder}`,borderRadius:12,padding:24,minWidth:500,maxWidth:600,maxHeight:"80vh",overflow:"auto"},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,gt.jsx)("h2",{style:{margin:0,color:L.text},children:"\u6279\u91cf\u4e0b\u8f7d"}),(0,gt.jsx)("button",{onClick:k,style:{background:"none",border:"none",color:L.textMuted,fontSize:24,cursor:"pointer"},children:"\xd7"})]}),C?(0,gt.jsx)(Qd,{jobId:C,jobType:"download",getProgress:bn.un,cancelJob:bn.TH,onComplete:e=>{M(null),alert(`\u5b8c\u6210\n\u6210\u529f\u5904\u7406 ${e.completed} / ${e.total} \u5f20\u7167\u7247`),s&&s(e)}}):(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsxs)(Eh,{title:"\u4e0b\u8f7d\u7c7b\u578b",colors:L,children:[(0,gt.jsx)(Ph,{value:l,onChange:c,colors:L,options:[{value:bh,label:"\u6b63\u7247 (\u6e32\u67d3\u540e\u7684\u56fe\u50cf)"},{value:xh,label:"\u5e95\u7247 (\u539f\u59cb\u626b\u63cf)"},{value:_h,label:"\u539f\u59cb\u6587\u4ef6 (\u4fdd\u6301\u539f\u683c\u5f0f)"}]}),S?(0,gt.jsx)("div",{style:{marginTop:8,color:L.textMuted,fontSize:12},children:"\u68c0\u67e5\u53ef\u7528\u6570\u91cf..."}):_&&(0,gt.jsxs)("div",{style:{marginTop:8,fontSize:12,color:_.available>0?"#4CAF50":"#f44336"},children:["\u53ef\u4e0b\u8f7d: ",_.available," / ",_.total," \u5f20",_.available<_.total&&(0,gt.jsxs)("span",{style:{color:L.textMuted,marginLeft:8},children:["(",_.total-_.available," \u5f20\u6587\u4ef6\u4e0d\u5b58\u5728)"]})]})]}),(0,gt.jsx)(Eh,{title:"\u7167\u7247\u8303\u56f4",colors:L,children:(0,gt.jsx)(Ph,{value:h,onChange:p,colors:L,options:[{value:wh,label:`\u9009\u4e2d\u7684\u7167\u7247 (${a.length} \u5f20)`,disabled:0===a.length},{value:Sh,label:`\u6240\u6709\u7167\u7247 (${o.length} \u5f20)`}]})}),(0,gt.jsx)(Eh,{title:"\u8f93\u51fa\u76ee\u5f55",colors:L,children:(0,gt.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,gt.jsx)("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"\u9009\u62e9\u4fdd\u5b58\u4f4d\u7f6e",style:{flex:1,padding:"8px 12px",background:L.inputBg,border:`1px solid ${L.inputBorder}`,borderRadius:4,color:L.text}}),(0,gt.jsx)("button",{onClick:async()=>{if(window.__electron&&window.__electron.selectDirectory){const e=await window.__electron.selectDirectory();e&&d(e)}else{const e=prompt("\u8bf7\u8f93\u5165\u8f93\u51fa\u76ee\u5f55\u8def\u5f84:",u||"D:/Downloads");e&&d(e)}},style:{padding:"8px 16px",background:L.buttonSecondary,border:`1px solid ${L.inputBorder}`,borderRadius:4,color:L.buttonSecondaryText,cursor:"pointer"},children:"\u9009\u62e9..."})]})}),(0,gt.jsxs)(Eh,{title:"\u547d\u540d\u89c4\u5219",colors:L,children:[(0,gt.jsx)("select",{value:g,onChange:e=>v(e.target.value),style:{width:"100%",padding:"8px 12px",background:L.inputBg,border:`1px solid ${L.inputBorder}`,borderRadius:4,color:L.text},children:Th.map(e=>(0,gt.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,gt.jsxs)("div",{style:{marginTop:8,color:L.textMuted,fontSize:12},children:["\u9884\u89c8: ",Mh(g,i)]})]}),l===bh&&(0,gt.jsx)(Eh,{title:"EXIF \u5143\u6570\u636e",colors:L,children:(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"checkbox",checked:f,onChange:e=>m(e.target.checked),style:{accentColor:"#2196F3"}}),(0,gt.jsx)("span",{style:{color:L.textSecondary},children:"\u5199\u5165 EXIF \u5143\u6570\u636e\uff08\u76f8\u673a\u3001\u955c\u5934\u3001\u5149\u5708\u3001\u5feb\u95e8\u3001ISO\u7b49\uff09"})]})}),l===bh&&(0,gt.jsx)(Eh,{title:"\u8f93\u51fa\u683c\u5f0f",colors:L,children:(0,gt.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,gt.jsxs)("div",{style:{flex:1},children:[(0,gt.jsx)("label",{style:{display:"block",color:L.textMuted,fontSize:12,marginBottom:4},children:"\u683c\u5f0f"}),(0,gt.jsxs)("select",{value:A,onChange:e=>y(e.target.value),style:{width:"100%",padding:"8px 12px",background:L.inputBg,border:`1px solid ${L.inputBorder}`,borderRadius:4,color:L.text},children:[(0,gt.jsx)("option",{value:"jpeg",children:"JPEG"}),(0,gt.jsx)("option",{value:"tiff16",children:"TIFF (16-bit)"})]})]}),"jpeg"===A&&(0,gt.jsxs)("div",{style:{flex:1},children:[(0,gt.jsx)("label",{style:{display:"block",color:L.textMuted,fontSize:12,marginBottom:4},children:"\u8d28\u91cf"}),(0,gt.jsx)("input",{type:"number",min:1,max:100,value:b,onChange:e=>x(Number(e.target.value)),style:{width:"100%",padding:"8px 12px",background:L.inputBg,border:`1px solid ${L.inputBorder}`,borderRadius:4,color:L.text}})]})]})}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:24},children:[(0,gt.jsx)("button",{onClick:k,style:{padding:"10px 24px",background:L.inputBorder,border:"none",borderRadius:6,color:L.text,cursor:"pointer"},children:"\u53d6\u6d88"}),(0,gt.jsx)("button",{onClick:async()=>{if(!E)if(u)if(_&&0===_.available)alert("\u6ca1\u6709\u53ef\u4f9b\u4e0b\u8f7d\u7684\u7167\u7247");else{P(!0);try{const e=N.map(e=>e.id),t=await(0,bn.PI)({rollId:n,scope:h,photoIds:e,type:l,outputDir:u,exif:{enabled:f},namingPattern:g});if(!t.jobId)throw new Error(t.error||"Failed to create download job");M(t.jobId)}catch(or){console.error("Failed to start batch download:",or),alert("\u542f\u52a8\u6279\u91cf\u4e0b\u8f7d\u5931\u8d25: "+or.message)}finally{P(!1)}}else alert("\u8bf7\u9009\u62e9\u8f93\u51fa\u76ee\u5f55")},disabled:E||_&&0===_.available,style:{padding:"10px 24px",background:E||_&&0===_.available?L.textMuted:"#4CAF50",border:"none",borderRadius:6,color:"#fff",cursor:E||_&&0===_.available?"not-allowed":"pointer"},children:E?"\u542f\u52a8\u4e2d...":"\u5f00\u59cb\u4e0b\u8f7d"})]})]})]})})}function Mh(e,t){const n={filename:"DSC_0001",frame:"01",date:"2025-01-14",roll:t||"Portra400"};return e.replace("{filename}",n.filename).replace("{frame}",n.frame).replace("{date}",n.date).replace("{roll}",n.roll)+".jpg"}function Eh({title:e,children:t,colors:n}){return(0,gt.jsxs)("div",{style:{marginBottom:20},children:[(0,gt.jsxs)("div",{style:{color:(null===n||void 0===n?void 0:n.textMuted)||"#888",fontSize:12,fontWeight:600,marginBottom:10,textTransform:"uppercase"},children:["\u25bc ",e]}),t]})}function Ph({value:e,onChange:t,options:n,colors:r}){return(0,gt.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(n=>(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:n.disabled?"not-allowed":"pointer",opacity:n.disabled?.5:1},children:[(0,gt.jsx)("input",{type:"radio",checked:e===n.value,onChange:()=>!n.disabled&&t(n.value),disabled:n.disabled,style:{accentColor:"#2196F3"}}),(0,gt.jsx)("span",{style:{color:(null===r||void 0===r?void 0:r.textSecondary)||"#ddd"},children:n.label})]},n.value))})}const Nh={matched:{color:"#4CAF50",icon:"\u2713",text:"\u5339\u914d"},conflict:{color:"#FF9800",icon:"\u26a0",text:"\u51b2\u7a81"},unmatched:{color:"#9E9E9E",icon:"\u25cb",text:"\u672a\u5339\u914d"},no_negative:{color:"#f44336",icon:"\u2717",text:"\u65e0\u5e95\u7247"}};function kh({matches:e=[],unmatchedPhotos:t=[],isManualMode:n=!1,onManualMatch:r,selectedFileIndex:i=null,onSelectFile:a}){return(0,gt.jsx)("div",{style:{maxHeight:300,overflow:"auto",border:"1px solid #333",borderRadius:4},children:(0,gt.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,gt.jsx)("thead",{children:(0,gt.jsxs)("tr",{style:{background:"#252525",position:"sticky",top:0,zIndex:1},children:[(0,gt.jsx)("th",{style:Lh,children:"#"}),(0,gt.jsx)("th",{style:Lh,children:"\u5bfc\u5165\u6587\u4ef6"}),(0,gt.jsx)("th",{style:Lh,children:"\u5bf9\u5e94\u5e95\u7247"}),(0,gt.jsx)("th",{style:Lh,children:"\u5e27\u53f7"}),(0,gt.jsx)("th",{style:Lh,children:"\u72b6\u6001"}),n&&(0,gt.jsx)("th",{style:Lh,children:"\u64cd\u4f5c"})]})}),(0,gt.jsx)("tbody",{children:e.map((e,t)=>{const o=Nh[e.status]||Nh.unmatched,s=i===t;return(0,gt.jsxs)("tr",{style:{background:s?"#2196F330":"transparent",cursor:n?"pointer":"default"},onClick:()=>n&&a&&a(t),children:[(0,gt.jsx)("td",{style:Oh,children:t+1}),(0,gt.jsx)("td",{style:Oh,title:e.file,children:(0,gt.jsx)("span",{style:{display:"inline-block",maxWidth:180,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename})}),(0,gt.jsx)("td",{style:Oh,children:e.photo?(0,gt.jsx)("span",{style:{color:"#ddd"},children:Rh(e.photo)}):(0,gt.jsx)("span",{style:{color:"#666",fontStyle:"italic"},children:"\u2014"})}),(0,gt.jsx)("td",{style:{...Oh,textAlign:"center"},children:e.frameNumber||"\u2014"}),(0,gt.jsxs)("td",{style:{...Oh,color:o.color},children:[o.icon," ",o.text]}),n&&(0,gt.jsx)("td",{style:Oh,children:e.photoId&&(0,gt.jsx)("button",{onClick:e=>{e.stopPropagation(),r&&r(t,null)},style:{padding:"2px 8px",background:"#f44336",border:"none",borderRadius:3,color:"#fff",fontSize:11,cursor:"pointer"},children:"\u53d6\u6d88"})})]},t)})})]})})}function Rh(e){if(!e)return null;const t=e.negative_rel_path||e.full_rel_path||e.filename;return t?t.split("/").pop():null}const Lh={padding:"8px 12px",textAlign:"left",color:"#888",fontWeight:600,borderBottom:"1px solid #333"},Oh={padding:"8px 12px",borderBottom:"1px solid #2a2a2a",color:"#ddd"};function jh({unmatchedPhotos:e=[],selectedFileIndex:t,onSelectPhoto:n,buildUploadUrl:r}){return null===t?(0,gt.jsx)("div",{style:{padding:16,background:"#252525",borderRadius:4,color:"#888",textAlign:"center"},children:"\u8bf7\u5148\u5728\u4e0a\u65b9\u8868\u683c\u4e2d\u9009\u62e9\u4e00\u4e2a\u5bfc\u5165\u6587\u4ef6"}):0===e.length?(0,gt.jsx)("div",{style:{padding:16,background:"#252525",borderRadius:4,color:"#4CAF50",textAlign:"center"},children:"\u6240\u6709\u5e95\u7247\u5df2\u5339\u914d\u5b8c\u6210"}):(0,gt.jsxs)("div",{style:{background:"#252525",borderRadius:4,padding:12},children:[(0,gt.jsxs)("div",{style:{color:"#888",fontSize:12,marginBottom:8},children:["\u70b9\u51fb\u9009\u62e9\u8981\u5339\u914d\u7684\u5e95\u7247 (",e.length," \u5f20\u53ef\u7528)"]}),(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:8,maxHeight:200,overflow:"auto"},children:e.map(e=>(0,gt.jsxs)("div",{onClick:()=>n&&n(e.id),style:{background:"#1e1e1e",borderRadius:4,padding:8,cursor:"pointer",border:"1px solid #333",transition:"border-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.borderColor="#2196F3",onMouseLeave:e=>e.currentTarget.style.borderColor="#333",children:[(0,gt.jsxs)("div",{style:{fontSize:12,color:"#ddd",textAlign:"center",marginBottom:4},children:["#",e.frameNumber||"?"]}),(0,gt.jsx)("div",{style:{fontSize:10,color:"#888",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename||`Photo ${e.id}`}),e.hasPositive&&(0,gt.jsx)("div",{style:{fontSize:10,color:"#FF9800",textAlign:"center",marginTop:4},children:"\u26a0 \u5df2\u6709\u6b63\u7247"})]},e.id))})]})}const Dh="filename",Ih="manual",Bh="overwrite",Fh="skip",zh=[{id:Dh,name:"\u6587\u4ef6\u540d\u5339\u914d",desc:"\u6839\u636e\u6587\u4ef6\u540d\u5339\u914d\uff08\u63a8\u8350\uff09",recommended:!0},{id:"frame",name:"\u5e27\u53f7\u987a\u5e8f\u5339\u914d",desc:"\u6309\u6587\u4ef6\u6392\u5e8f\u987a\u5e8f\u4e0e\u5e27\u53f7\u5bf9\u5e94"},{id:Ih,name:"\u624b\u52a8\u5339\u914d",desc:"\u624b\u52a8\u6307\u5b9a\u6bcf\u4e2a\u6587\u4ef6\u5bf9\u5e94\u7684\u7167\u7247"}];function Uh({isOpen:e,onClose:t,rollId:n,rollName:i="",onComplete:a}){const[o,s]=(0,r.useState)("select"),[l,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(""),[h,p]=(0,r.useState)(Dh),[f,m]=(0,r.useState)([]),[g,v]=(0,r.useState)({total:0,matched:0,conflict:0,unmatched:0}),[A,y]=(0,r.useState)([]),[b,x]=(0,r.useState)(null),[_,w]=(0,r.useState)(Bh),[S,T]=(0,r.useState)({completed:0,total:0,status:""}),[C,M]=(0,r.useState)(null),[E,P]=(0,r.useState)(!1),[N,k]=(0,r.useState)(null);(0,r.useEffect)(()=>{e&&(s("select"),c([]),d(""),p(Dh),m([]),v({total:0,matched:0,conflict:0,unmatched:0}),y([]),x(null),w(Bh),T({completed:0,total:0,status:""}),M(null),k(null))},[e]);const R=async(e,t)=>{P(!0);try{const r=await(0,bn.tj)(n,f,e,t);r.success&&(m(r.matches),v(r.stats),y(r.unmatchedPhotos||[]),null!==t&&x(null))}catch(or){console.error("Manual match failed:",or)}finally{P(!1)}},L=(0,r.useCallback)(async e=>{try{const t=await(0,bn.Nw)(e);T({completed:t.completed,total:t.total,status:t.status,failed:t.failed,skipped:t.skipped}),"completed"===t.status||"failed"===t.status||"cancelled"===t.status?(s("done"),M(t),a&&a(t)):setTimeout(()=>L(e),500)}catch(or){console.error("Poll progress error:",or),setTimeout(()=>L(e),1e3)}},[a]),O=()=>{("importing"!==o||window.confirm("\u5bfc\u5165\u6b63\u5728\u8fdb\u884c\u4e2d\uff0c\u786e\u5b9a\u8981\u5173\u95ed\u5417\uff1f"))&&t()};if(!e)return null;const j=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),D={overlay:j?"rgba(0,0,0,0.8)":"rgba(0,0,0,0.5)",modalBg:j?"#18181b":"#ffffff",modalBorder:j?"#27272a":"#e4e4e7",text:j?"#ECEDEE":"#11181C",textMuted:j?"#71717a":"#a1a1aa",textSecondary:j?"#d4d4d8":"#3f3f46",inputBg:j?"#27272a":"#f4f4f5",inputBorder:j?"#3f3f46":"#e4e4e7",buttonSecondary:j?"#27272a":"#f4f4f5",buttonSecondaryText:j?"#ECEDEE":"#11181C",progressBg:j?"#3f3f46":"#e4e4e7"};return(0,gt.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:D.overlay,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:(0,gt.jsxs)("div",{style:{background:D.modalBg,border:`1px solid ${D.modalBorder}`,borderRadius:12,padding:24,width:650,maxWidth:"90vw",maxHeight:"85vh",overflow:"auto"},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,gt.jsxs)("h2",{style:{margin:0,color:D.text},children:["\u5bfc\u5165\u5916\u90e8\u6b63\u7247",i&&(0,gt.jsxs)("span",{style:{color:D.textMuted,fontSize:14,marginLeft:8},children:["- ",i]})]}),(0,gt.jsx)("button",{onClick:O,style:{background:"none",border:"none",color:D.textMuted,fontSize:24,cursor:"pointer"},children:"\xd7"})]}),N&&(0,gt.jsx)("div",{style:{background:"#f4433620",border:"1px solid #f44336",borderRadius:4,padding:12,marginBottom:16,color:"#f44336"},children:N}),"select"===o&&(0,gt.jsx)(Vh,{inputPath:u,onInputChange:e=>{if(d(e),e.trim()){const t=e.split(";").map(e=>e.trim()).filter(Boolean);c(t)}else c([])},onSelectFiles:async()=>{if(window.__electron&&window.__electron.selectFiles){const e=await window.__electron.selectFiles({multiple:!0});e&&e.length>0&&(c(e),d(1===e.length?e[0]:`${e.length} \u4e2a\u6587\u4ef6`))}else alert("\u8bf7\u5728\u8f93\u5165\u6846\u4e2d\u8f93\u5165\u6587\u4ef6\u8def\u5f84\uff0c\u591a\u4e2a\u8def\u5f84\u7528\u5206\u53f7\u5206\u9694")},onSelectFolder:async()=>{if(window.__electron&&window.__electron.selectDirectory){const e=await window.__electron.selectDirectory();e&&(c([e]),d(e))}else alert("\u8bf7\u5728\u8f93\u5165\u6846\u4e2d\u8f93\u5165\u6587\u4ef6\u5939\u8def\u5f84")},strategy:h,onStrategyChange:p,loading:E,onPreview:async()=>{if(0!==l.length){P(!0),k(null);try{const e=await(0,bn.zc)(n,l,h);e.success?(m(e.matches),v(e.stats),y(e.unmatchedPhotos||[]),s("preview")):k(e.error||"\u9884\u89c8\u5931\u8d25")}catch(or){k(or.message||"\u8bf7\u6c42\u5931\u8d25")}finally{P(!1)}}else k("\u8bf7\u5148\u9009\u62e9\u8981\u5bfc\u5165\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u5939")},onClose:O,colors:D}),"preview"===o&&(0,gt.jsx)(Gh,{matches:f,stats:g,unmatchedPhotos:A,strategy:h,onStrategyChange:async e=>{if(p(e),"preview"===o&&l.length>0){P(!0);try{const t=await(0,bn.zc)(n,l,e);t.success&&(m(t.matches),v(t.stats),y(t.unmatchedPhotos||[]),x(null))}catch(or){console.error("Preview failed:",or)}finally{P(!1)}}},selectedFileIndex:b,onSelectFile:x,onManualMatch:R,onSelectPhoto:e=>{null!==b&&R(b,e)},conflictResolution:_,onConflictResolutionChange:w,loading:E,onBack:()=>s("select"),onExecute:async()=>{if(0!==g.matched+(_===Bh?g.conflict:0)){P(!0),k(null),s("importing");try{const e=await(0,bn.Js)(n,f,_);e.jobId?(T({completed:0,total:e.total,status:"processing"}),L(e.jobId)):(k(e.error||"\u542f\u52a8\u5bfc\u5165\u5931\u8d25"),s("preview"))}catch(or){k(or.message||"\u8bf7\u6c42\u5931\u8d25"),s("preview")}finally{P(!1)}}else k("\u6ca1\u6709\u53ef\u5bfc\u5165\u7684\u6587\u4ef6")},colors:D}),"importing"===o&&(0,gt.jsx)(qh,{progress:S,colors:D}),"done"===o&&(0,gt.jsx)(Wh,{result:C,onClose:O,colors:D})]})})}function Vh({inputPath:e,onInputChange:t,onSelectFiles:n,onSelectFolder:r,strategy:i,onStrategyChange:a,loading:o,onPreview:s,onClose:l,colors:c}){const u=$h(c),d=Kh(c);return(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(Hh,{title:"\u9009\u62e9\u6587\u4ef6",colors:c,children:(0,gt.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,gt.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"\u8f93\u5165\u8def\u5f84\u6216\u70b9\u51fb\u53f3\u4fa7\u6309\u94ae\u9009\u62e9",style:{flex:1,padding:"10px 12px",background:c.inputBg,border:`1px solid ${c.inputBorder}`,borderRadius:4,color:c.text}}),(0,gt.jsx)("button",{onClick:r,style:u,children:"\u9009\u62e9\u6587\u4ef6\u5939"}),(0,gt.jsx)("button",{onClick:n,style:u,children:"\u9009\u62e9\u6587\u4ef6"})]})}),(0,gt.jsx)(Hh,{title:"\u5339\u914d\u7b56\u7565",colors:c,children:zh.map(e=>(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"flex-start",gap:8,marginBottom:8,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"radio",checked:i===e.id,onChange:()=>a(e.id),style:{marginTop:3,accentColor:"#2196F3"}}),(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("span",{style:{color:c.textSecondary},children:[e.name,e.recommended&&(0,gt.jsx)("span",{style:{color:"#4CAF50",marginLeft:4},children:"(\u63a8\u8350)"})]}),(0,gt.jsx)("div",{style:{color:c.textMuted,fontSize:12},children:e.desc})]})]},e.id))}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:24},children:[(0,gt.jsx)("button",{onClick:l,style:u,children:"\u53d6\u6d88"}),(0,gt.jsx)("button",{onClick:s,disabled:o,style:d,children:o?"\u52a0\u8f7d\u4e2d...":"\u9884\u89c8\u5339\u914d"})]})]})}function Gh({matches:e,stats:t,unmatchedPhotos:n,strategy:r,onStrategyChange:i,selectedFileIndex:a,onSelectFile:o,onManualMatch:s,onSelectPhoto:l,conflictResolution:c,onConflictResolutionChange:u,loading:d,onBack:h,onExecute:p,colors:f}){const m=r===Ih,g=t.matched+(c===Bh?t.conflict:0),v=$h(f),A=Kh(f);return(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(Hh,{title:"\u5339\u914d\u7b56\u7565",colors:f,children:(0,gt.jsx)("div",{style:{display:"flex",gap:12},children:zh.map(e=>(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"radio",checked:r===e.id,onChange:()=>i(e.id),style:{accentColor:"#2196F3"}}),(0,gt.jsx)("span",{style:{color:f.textSecondary,fontSize:13},children:e.name})]},e.id))})}),(0,gt.jsxs)(Hh,{title:`\u5339\u914d\u9884\u89c8 (${t.matched+t.conflict}/${t.total})`,colors:f,children:[(0,gt.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:12,fontSize:13},children:[(0,gt.jsxs)("span",{style:{color:"#4CAF50"},children:["\u2713 \u5339\u914d: ",t.matched]}),(0,gt.jsxs)("span",{style:{color:"#FF9800"},children:["\u26a0 \u51b2\u7a81: ",t.conflict]}),(0,gt.jsxs)("span",{style:{color:f.textMuted},children:["\u25cb \u672a\u5339\u914d: ",t.unmatched]})]}),(0,gt.jsx)(kh,{matches:e,unmatchedPhotos:n,isManualMode:m,onManualMatch:s,selectedFileIndex:a,onSelectFile:o})]}),m&&(0,gt.jsx)(Hh,{title:"\u9009\u62e9\u5e95\u7247",colors:f,children:(0,gt.jsx)(jh,{unmatchedPhotos:n,selectedFileIndex:a,onSelectPhoto:l})}),t.conflict>0&&(0,gt.jsxs)(Hh,{title:`\u51b2\u7a81\u5904\u7406 (${t.conflict} \u5f20\u5df2\u6709\u6b63\u7247)`,colors:f,children:[(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"radio",checked:c===Bh,onChange:()=>u(Bh),style:{accentColor:"#2196F3"}}),(0,gt.jsx)("span",{style:{color:f.textSecondary},children:"\u8986\u76d6\u73b0\u6709\u6b63\u7247"})]}),(0,gt.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"radio",checked:c===Fh,onChange:()=>u(Fh),style:{accentColor:"#2196F3"}}),(0,gt.jsx)("span",{style:{color:f.textSecondary},children:"\u8df3\u8fc7\u5df2\u6709\u6b63\u7247"})]})]}),(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:24},children:[(0,gt.jsx)("button",{onClick:h,style:v,children:"\u8fd4\u56de"}),(0,gt.jsx)("button",{onClick:p,disabled:d||0===g,style:{...A,background:0===g?f.textMuted:"#4CAF50"},children:d?"\u5904\u7406\u4e2d...":`\u5bfc\u5165 ${g} \u5f20`})]})]})}function qh({progress:e,colors:t}){const n=e.total>0?e.completed/e.total*100:0;return(0,gt.jsxs)("div",{style:{textAlign:"center",padding:40},children:[(0,gt.jsx)("div",{style:{fontSize:48,marginBottom:16},children:"\ud83d\udce5"}),(0,gt.jsx)("div",{style:{color:t.text,fontSize:18,marginBottom:20},children:"\u6b63\u5728\u5bfc\u5165..."}),(0,gt.jsx)("div",{style:{width:"100%",height:8,background:t.progressBg,borderRadius:4,overflow:"hidden",marginBottom:12},children:(0,gt.jsx)("div",{style:{width:`${n}%`,height:"100%",background:"#4CAF50",transition:"width 0.3s"}})}),(0,gt.jsxs)("div",{style:{color:t.textMuted},children:[e.completed," / ",e.total]})]})}function Wh({result:e,onClose:t,colors:n}){const r="completed"===(null===e||void 0===e?void 0:e.status),i=Kh(n);return(0,gt.jsxs)("div",{style:{textAlign:"center",padding:40},children:[(0,gt.jsx)("div",{style:{fontSize:48,marginBottom:16},children:r?"\u2705":"\u26a0\ufe0f"}),(0,gt.jsx)("div",{style:{color:n.text,fontSize:18,marginBottom:20},children:r?"\u5bfc\u5165\u5b8c\u6210":"\u5bfc\u5165\u7ed3\u675f"}),e&&(0,gt.jsxs)("div",{style:{color:n.textMuted,marginBottom:20},children:[(0,gt.jsxs)("div",{children:["\u6210\u529f: ",e.completed," \u5f20"]}),e.failed>0&&(0,gt.jsxs)("div",{style:{color:"#f44336"},children:["\u5931\u8d25: ",e.failed," \u5f20"]}),e.skipped>0&&(0,gt.jsxs)("div",{children:["\u8df3\u8fc7: ",e.skipped," \u5f20"]})]}),(0,gt.jsx)("button",{onClick:t,style:i,children:"\u5173\u95ed"})]})}function Hh({title:e,children:t,colors:n}){return(0,gt.jsxs)("div",{style:{marginBottom:20},children:[(0,gt.jsxs)("div",{style:{color:(null===n||void 0===n?void 0:n.textMuted)||"#888",fontSize:12,fontWeight:600,marginBottom:10,textTransform:"uppercase"},children:["\u25bc ",e]}),t]})}const $h=e=>({padding:"10px 16px",background:(null===e||void 0===e?void 0:e.buttonSecondary)||"#333",border:`1px solid ${(null===e||void 0===e?void 0:e.inputBorder)||"#333"}`,borderRadius:6,color:(null===e||void 0===e?void 0:e.buttonSecondaryText)||"#fff",cursor:"pointer"}),Kh=e=>({padding:"10px 24px",background:"#2196F3",border:"none",borderRadius:6,color:"#fff",cursor:"pointer"}),Xh={colorSpace:"srgb",whiteBalance:"camera",quality:"high",halfSize:!1,autoRotate:!0,outputFormat:"tiff"},Yh=[{value:"raw",label:"RAW (\u65e0\u8272\u5f69\u7a7a\u95f4)"},{value:"srgb",label:"sRGB"},{value:"adobe",label:"Adobe RGB"},{value:"wide",label:"Wide Gamut"},{value:"prophoto",label:"ProPhoto RGB"},{value:"xyz",label:"CIE XYZ"}],Qh=[{value:"camera",label:"\u76f8\u673a\u767d\u5e73\u8861"},{value:"auto",label:"\u81ea\u52a8\u767d\u5e73\u8861"},{value:"daylight",label:"\u65e5\u5149"},{value:"tungsten",label:"\u94a8\u4e1d\u706f"},{value:"fluorescent",label:"\u8367\u5149\u706f"}],Zh=[{value:"preview",label:"\u9884\u89c8 (\u5feb\u901f)"},{value:"standard",label:"\u6807\u51c6"},{value:"high",label:"\u9ad8\u8d28\u91cf"}],Jh=[{value:"tiff",label:"TIFF (16-bit, \u63a8\u8350)"},{value:"ppm",label:"PPM (\u65e0\u538b\u7f29)"}];function ep({isOpen:e,onClose:t,rollId:n,onImportComplete:i}){const[a,o]=(0,r.useState)(1),[s,l]=(0,r.useState)(null),[c,u]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(Xh),[m,g]=(0,r.useState)(!1),[v,A]=(0,r.useState)({current:0,total:0,file:"",percent:0}),[y,b]=(0,r.useState)([]),[x,_]=(0,r.useState)(null),[w,S]=(0,r.useState)(!1),[T,C]=(0,r.useState)(!1),[M,E]=(0,r.useState)(null),P=(0,r.useRef)(null),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{e&&(k(),R())},[e]);const k=async()=>{try{const e=await(0,bn.vQ)();l(e),e.available||E("RAW \u89e3\u7801\u5668\u4e0d\u53ef\u7528\u3002\u8bf7\u786e\u4fdd\u5df2\u5b89\u88c5 dcraw\u3002")}catch(e){E("\u65e0\u6cd5\u68c0\u67e5 RAW \u89e3\u7801\u5668\u72b6\u6001"),console.error("Failed to check decoder status:",e)}},R=async()=>{try{const e=await(0,bn.Di)();e.success&&u(e.formats)}catch(e){console.error("Failed to load supported formats:",e)}},L=(0,r.useCallback)(e=>{const t=e.name.split(".").pop().toLowerCase();return c.includes(t)||["dng","cr2","cr3","arw","nef","orf","raf","rw2","pef","srw","raw","3fr","fff","iiq","dcr","kdc","mrw","x3f"].includes(t)},[c]),O=(0,r.useCallback)(e=>{const t=Array.from(e).filter(L);if(0===t.length)return void E("\u6ca1\u6709\u627e\u5230\u6709\u6548\u7684 RAW \u6587\u4ef6");const n=t.map(e=>({file:e,id:`${e.name}-${Date.now()}-${Math.random()}`,name:e.name,size:e.size,status:"pending",progress:0,preview:null,metadata:null,result:null,error:null}));h(e=>[...e,...n]),E(null)},[L]),j=(e,t)=>{f(n=>({...n,[e]:t}))},D=()=>{o(1),h([]),f(Xh),g(!1),A({current:0,total:0,file:"",percent:0}),b([]),_(null),E(null),t()},I=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`;return e?(0,gt.jsx)("div",{className:"raw-import-wizard-overlay",children:(0,gt.jsxs)("div",{className:"raw-import-wizard",children:[(0,gt.jsxs)("div",{className:"raw-import-wizard-header",children:[(0,gt.jsx)("h2",{children:"RAW \u6587\u4ef6\u5bfc\u5165"}),(0,gt.jsx)("button",{className:"close-btn",onClick:D,children:"\xd7"})]}),(0,gt.jsxs)("div",{className:"raw-import-steps",children:[(0,gt.jsxs)("div",{className:`step ${a>=1?"active":""} ${a>1?"done":""}`,children:[(0,gt.jsx)("span",{className:"step-number",children:"1"}),(0,gt.jsx)("span",{className:"step-label",children:"\u9009\u62e9\u6587\u4ef6"})]}),(0,gt.jsxs)("div",{className:`step ${a>=2?"active":""} ${a>2?"done":""}`,children:[(0,gt.jsx)("span",{className:"step-number",children:"2"}),(0,gt.jsx)("span",{className:"step-label",children:"\u914d\u7f6e\u9009\u9879"})]}),(0,gt.jsxs)("div",{className:`step ${a>=3?"active":""} ${a>3?"done":""}`,children:[(0,gt.jsx)("span",{className:"step-number",children:"3"}),(0,gt.jsx)("span",{className:"step-label",children:"\u5bfc\u5165"})]}),(0,gt.jsxs)("div",{className:"step "+(a>=4?"active":""),children:[(0,gt.jsx)("span",{className:"step-number",children:"4"}),(0,gt.jsx)("span",{className:"step-label",children:"\u5b8c\u6210"})]})]}),M&&(0,gt.jsxs)("div",{className:"raw-import-error",children:[(0,gt.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,gt.jsx)("span",{children:M}),(0,gt.jsx)("button",{onClick:()=>E(null),children:"\xd7"})]}),s&&!s.available&&(0,gt.jsxs)("div",{className:"raw-import-warning",children:[(0,gt.jsx)("h4",{children:"\u26a0\ufe0f RAW \u89e3\u7801\u5668\u672a\u5b89\u88c5"}),(0,gt.jsx)("p",{children:"\u9700\u8981\u5b89\u88c5 dcraw \u624d\u80fd\u89e3\u7801 RAW \u6587\u4ef6\u3002"}),(0,gt.jsxs)("p",{children:["Windows: \u4e0b\u8f7d dcraw.exe \u5e76\u6dfb\u52a0\u5230 PATH",(0,gt.jsx)("br",{}),"Mac: ",(0,gt.jsx)("code",{children:"brew install dcraw"}),(0,gt.jsx)("br",{}),"Linux: ",(0,gt.jsx)("code",{children:"sudo apt install dcraw"})]})]}),(0,gt.jsxs)("div",{className:"raw-import-content",children:[1===a&&(0,gt.jsxs)("div",{className:"step-content step-1",children:[(0,gt.jsxs)("div",{ref:N,className:"drop-zone "+(T?"drag-over":""),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),C(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),C(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),C(!1);const t=e.dataTransfer.files;t.length>0&&O(t)},onClick:()=>{var e;null===(e=P.current)||void 0===e||e.click()},children:[(0,gt.jsxs)("div",{className:"drop-zone-content",children:[(0,gt.jsx)("span",{className:"drop-icon",children:"\ud83d\udcc1"}),(0,gt.jsx)("p",{children:"\u62d6\u62fd RAW \u6587\u4ef6\u5230\u8fd9\u91cc"}),(0,gt.jsx)("p",{className:"or",children:"\u6216"}),(0,gt.jsx)("button",{className:"select-btn",children:"\u9009\u62e9\u6587\u4ef6"}),(0,gt.jsxs)("p",{className:"formats",children:["\u652f\u6301\u683c\u5f0f: ",c.length>0?c.slice(0,8).join(", ").toUpperCase()+(c.length>8?" ...":""):"DNG, CR2, ARW, NEF, ORF, RAF..."]})]}),(0,gt.jsx)("input",{ref:P,type:"file",multiple:!0,accept:c.map(e=>`.${e}`).join(","),onChange:e=>{var t;(null===(t=e.target.files)||void 0===t?void 0:t.length)>0&&O(e.target.files)},style:{display:"none"}})]}),d.length>0&&(0,gt.jsxs)("div",{className:"file-list",children:[(0,gt.jsxs)("h4",{children:["\u5df2\u9009\u62e9 ",d.length," \u4e2a\u6587\u4ef6"]}),(0,gt.jsx)("div",{className:"file-items",children:d.map(e=>(0,gt.jsxs)("div",{className:"file-item",children:[(0,gt.jsxs)("div",{className:"file-info",children:[(0,gt.jsx)("span",{className:"file-name",children:e.name}),(0,gt.jsx)("span",{className:"file-size",children:I(e.size)})]}),(0,gt.jsxs)("div",{className:"file-actions",children:[(0,gt.jsx)("button",{className:"preview-btn",onClick:t=>{t.stopPropagation(),(async e=>{S(!0),_(null);try{h(t=>t.map(t=>t.id===e.id?{...t,status:"previewing"}:t));const[t,n]=await Promise.all([(0,bn.Xp)(e.file),(0,bn.ft)(e.file)]);h(r=>r.map(r=>r.id===e.id?{...r,status:"pending",preview:t.previewPath,metadata:n.metadata}:r)),_({fileId:e.id,fileName:e.name,previewUrl:t.success?t.previewPath:null,metadata:n.success?n.metadata:null})}catch(t){console.error("Preview failed:",t),h(n=>n.map(n=>n.id===e.id?{...n,status:"pending",error:t.message}:n))}finally{S(!1)}})(e)},disabled:w,children:"\ud83d\udc41\ufe0f"}),(0,gt.jsx)("button",{className:"remove-btn",onClick:t=>{var n;t.stopPropagation(),n=e.id,h(e=>e.filter(e=>e.id!==n))},children:"\u2715"})]})]},e.id))})]}),w&&(0,gt.jsxs)("div",{className:"preview-panel loading",children:[(0,gt.jsx)("div",{className:"loading-spinner"}),(0,gt.jsx)("p",{children:"\u6b63\u5728\u751f\u6210\u9884\u89c8..."})]}),x&&!w&&(0,gt.jsxs)("div",{className:"preview-panel",children:[(0,gt.jsxs)("h4",{children:["\u9884\u89c8: ",x.fileName]}),x.previewUrl&&(0,gt.jsx)("div",{className:"preview-image",children:(0,gt.jsx)("img",{src:x.previewUrl,alt:"Preview"})}),x.metadata&&(0,gt.jsxs)("div",{className:"preview-metadata",children:[(0,gt.jsxs)("div",{className:"metadata-item",children:[(0,gt.jsx)("span",{className:"label",children:"\u76f8\u673a:"}),(0,gt.jsx)("span",{className:"value",children:x.metadata.camera||"N/A"})]}),x.metadata.timestamp&&(0,gt.jsxs)("div",{className:"metadata-item",children:[(0,gt.jsx)("span",{className:"label",children:"\u62cd\u6444\u65f6\u95f4:"}),(0,gt.jsx)("span",{className:"value",children:new Date(x.metadata.timestamp).toLocaleString()})]})]})]})]}),2===a&&(0,gt.jsxs)("div",{className:"step-content step-2",children:[(0,gt.jsxs)("div",{className:"options-grid",children:[(0,gt.jsxs)("div",{className:"option-group",children:[(0,gt.jsx)("label",{children:"\u8272\u5f69\u7a7a\u95f4"}),(0,gt.jsx)("select",{value:p.colorSpace,onChange:e=>j("colorSpace",e.target.value),children:Yh.map(e=>(0,gt.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,gt.jsxs)("div",{className:"option-group",children:[(0,gt.jsx)("label",{children:"\u767d\u5e73\u8861"}),(0,gt.jsx)("select",{value:p.whiteBalance,onChange:e=>j("whiteBalance",e.target.value),children:Qh.map(e=>(0,gt.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,gt.jsxs)("div",{className:"option-group",children:[(0,gt.jsx)("label",{children:"\u89e3\u7801\u8d28\u91cf"}),(0,gt.jsx)("select",{value:p.quality,onChange:e=>j("quality",e.target.value),children:Zh.map(e=>(0,gt.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,gt.jsxs)("div",{className:"option-group",children:[(0,gt.jsx)("label",{children:"\u8f93\u51fa\u683c\u5f0f"}),(0,gt.jsx)("select",{value:p.outputFormat,onChange:e=>j("outputFormat",e.target.value),children:Jh.map(e=>(0,gt.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,gt.jsx)("div",{className:"option-group checkbox",children:(0,gt.jsxs)("label",{children:[(0,gt.jsx)("input",{type:"checkbox",checked:p.halfSize,onChange:e=>j("halfSize",e.target.checked)}),"\u534a\u5c3a\u5bf8\u8f93\u51fa (\u66f4\u5feb)"]})}),(0,gt.jsx)("div",{className:"option-group checkbox",children:(0,gt.jsxs)("label",{children:[(0,gt.jsx)("input",{type:"checkbox",checked:p.autoRotate,onChange:e=>j("autoRotate",e.target.checked)}),"\u81ea\u52a8\u65cb\u8f6c"]})})]}),(0,gt.jsxs)("div",{className:"import-target",children:[(0,gt.jsx)("span",{className:"label",children:"\u5bfc\u5165\u5230:"}),(0,gt.jsxs)("span",{className:"value",children:["Roll #",n]})]}),(0,gt.jsxs)("div",{className:"files-summary",children:[(0,gt.jsxs)("span",{children:["\u5c06\u5bfc\u5165 ",d.length," \u4e2a RAW \u6587\u4ef6"]}),(0,gt.jsxs)("span",{className:"total-size",children:["\u603b\u5927\u5c0f: ",I(d.reduce((e,t)=>e+t.size,0))]})]})]}),3===a&&(0,gt.jsxs)("div",{className:"step-content step-3",children:[(0,gt.jsxs)("div",{className:"import-progress",children:[(0,gt.jsxs)("div",{className:"progress-header",children:[(0,gt.jsxs)("span",{children:["\u6b63\u5728\u5bfc\u5165 (",v.current,"/",v.total,")"]}),(0,gt.jsx)("span",{children:v.file})]}),(0,gt.jsx)("div",{className:"progress-bar-container",children:(0,gt.jsx)("div",{className:"progress-bar",style:{width:`${v.percent}%`}})}),(0,gt.jsxs)("div",{className:"progress-percent",children:[v.percent,"%"]})]}),(0,gt.jsx)("div",{className:"import-file-list",children:d.map(e=>(0,gt.jsxs)("div",{className:`import-file-item ${e.status}`,children:[(0,gt.jsxs)("span",{className:"status-icon",children:["pending"===e.status&&"\u23f3","importing"===e.status&&"\u23f3","done"===e.status&&"\u2705","error"===e.status&&"\u274c"]}),(0,gt.jsx)("span",{className:"file-name",children:e.name}),"importing"===e.status&&(0,gt.jsxs)("span",{className:"file-progress",children:[e.progress,"%"]}),"error"===e.status&&(0,gt.jsx)("span",{className:"file-error",children:e.error})]},e.id))})]}),4===a&&(0,gt.jsx)("div",{className:"step-content step-4",children:(0,gt.jsxs)("div",{className:"import-complete",children:[(0,gt.jsx)("span",{className:"complete-icon",children:"\ud83c\udf89"}),(0,gt.jsx)("h3",{children:"\u5bfc\u5165\u5b8c\u6210"}),(0,gt.jsxs)("div",{className:"import-summary",children:[(0,gt.jsxs)("div",{className:"summary-item success",children:[(0,gt.jsx)("span",{className:"count",children:y.filter(e=>"done"===e.status).length}),(0,gt.jsx)("span",{className:"label",children:"\u6210\u529f"})]}),(0,gt.jsxs)("div",{className:"summary-item error",children:[(0,gt.jsx)("span",{className:"count",children:y.filter(e=>"error"===e.status).length}),(0,gt.jsx)("span",{className:"label",children:"\u5931\u8d25"})]})]}),y.filter(e=>"error"===e.status).length>0&&(0,gt.jsxs)("div",{className:"failed-files",children:[(0,gt.jsx)("h4",{children:"\u5bfc\u5165\u5931\u8d25\u7684\u6587\u4ef6:"}),y.filter(e=>"error"===e.status).map(e=>(0,gt.jsxs)("div",{className:"failed-file",children:[(0,gt.jsx)("span",{className:"file-name",children:e.name}),(0,gt.jsx)("span",{className:"error-msg",children:e.error})]},e.id))]})]})})]}),(0,gt.jsxs)("div",{className:"raw-import-footer",children:[1===a&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("button",{className:"btn-secondary",onClick:D,children:"\u53d6\u6d88"}),(0,gt.jsx)("button",{className:"btn-primary",onClick:()=>o(2),disabled:0===d.length||!(null!==s&&void 0!==s&&s.available),children:"\u4e0b\u4e00\u6b65"})]}),2===a&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("button",{className:"btn-secondary",onClick:()=>o(1),children:"\u4e0a\u4e00\u6b65"}),(0,gt.jsx)("button",{className:"btn-primary",onClick:async()=>{if(!n)return void E("\u8bf7\u5148\u9009\u62e9\u76ee\u6807\u76f8\u518c");if(0===d.length)return void E("\u8bf7\u5148\u6dfb\u52a0 RAW \u6587\u4ef6");g(!0),o(3),b([]);const e=[];for(let r=0;r<d.length;r++){const i=d[r];A({current:r+1,total:d.length,file:i.name,percent:0}),h(e=>e.map(e=>e.id===i.id?{...e,status:"importing",progress:0}:e));try{const t=await(0,bn.s7)(i.file,n,p,e=>{A(t=>({...t,percent:e})),h(t=>t.map(t=>t.id===i.id?{...t,progress:e}:t))});t.success?(e.push({...i,status:"done",result:t}),h(e=>e.map(e=>e.id===i.id?{...e,status:"done",result:t}:e))):(e.push({...i,status:"error",error:t.error}),h(e=>e.map(e=>e.id===i.id?{...e,status:"error",error:t.error}:e)))}catch(t){e.push({...i,status:"error",error:t.message}),h(e=>e.map(e=>e.id===i.id?{...e,status:"error",error:t.message}:e))}}b(e),g(!1),o(4)},disabled:!n,children:"\u5f00\u59cb\u5bfc\u5165"})]}),3===a&&(0,gt.jsx)("button",{className:"btn-secondary",disabled:m,children:m?"\u5bfc\u5165\u4e2d...":"\u8bf7\u7b49\u5f85"}),4===a&&(0,gt.jsx)("button",{className:"btn-primary",onClick:()=>{const e=y.filter(e=>"done"===e.status).length;e>0&&i&&i(y),D()},children:"\u5b8c\u6210"})]})]})}):null}n(1972);function tp(){const{id:e}=le(),t=At(),[n,i]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),[s,l]=(0,r.useState)({}),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)("positive"),[p,f]=(0,r.useState)([]),[m,g]=(0,r.useState)({cameras:[],lenses:[],photographers:[]}),[v,A]=(0,r.useState)({isOpen:!1,type:"alert",title:"",message:"",onConfirm:null}),[y,b]=(0,r.useState)(!1),[x,_]=(0,r.useState)([]),[w,S]=(0,r.useState)(!1),[T,C]=(0,r.useState)(!1),[M,E]=(0,r.useState)(!1),[P,N]=(0,r.useState)(null),[k,R]=(0,r.useState)(!1),[L,O]=(0,r.useState)(!1),[j,D]=(0,r.useState)(!1),[I,B]=(0,r.useState)(!1),[F,z]=(0,r.useState)(!1),[U,V]=(0,r.useState)(null),G=(e,t)=>{A({isOpen:!0,type:"alert",title:e,message:t,onConfirm:()=>A(e=>({...e,isOpen:!1}))})},q=(e,t,n)=>{A({isOpen:!0,type:"confirm",title:e,message:t,onConfirm:()=>{n(),A(e=>({...e,isOpen:!1}))},onCancel:()=>A(e=>({...e,isOpen:!1}))})},{data:W}=Rn({queryKey:["roll",e],queryFn:()=>(0,bn.EF)(e),...vn("rolls")}),{data:H=[]}=Rn({queryKey:["rollPhotos",e],queryFn:()=>(0,bn.i$)(e),...vn("photos")}),{data:$=[]}=Rn({queryKey:["tags"],queryFn:bn.Q2,...vn("tags")}),K=ka({mutationFn:bn.IM,onSuccess:()=>{t.invalidateQueries(["rollPhotos",e]),t.invalidateQueries(["roll",e])}}),X=ka({mutationFn:({rollId:e,photoId:t})=>(0,bn.Du)(e,{photoId:t}),onSuccess:()=>t.invalidateQueries(["roll",e])}),Y=ka({mutationFn:({rollId:e,data:t})=>(0,bn.Zt)(e,t),onSuccess:()=>t.invalidateQueries(["roll",e])}),Q=ka({mutationFn:({photoId:e,data:t})=>(0,bn.oN)(e,t),onSuccess:()=>t.invalidateQueries(["rollPhotos",e])});const Z=(J=W)?J.film_name_joined?J.film_name_joined:J.film&&"object"===typeof J.film&&J.film.name?J.film.name:J.film_type?J.film_type:null:null;var J;async function ee(e){q("Delete Photo","Delete this photo?",async()=>{try{await K.mutateAsync(e)}catch(t){console.error("Delete failed",t),G("Error","Delete failed: "+(t.message||t))}})}async function te(t){q("Set Cover","Set this photo as roll cover?",async()=>{try{await X.mutateAsync({rollId:e,photoId:t})}catch(n){console.error("Set cover failed",n),G("Error","Set cover failed")}})}async function ne(e,t){try{await Q.mutateAsync({photoId:e,data:t}),y&&_(n=>n.map(n=>n.id===e?{...n,...t}:n))}catch(n){console.error(n)}}function re(n){t.invalidateQueries(["rollPhotos",e]),t.invalidateQueries(["roll",e]),"completed"===n.status&&G("\u5b8c\u6210",`\u6210\u529f\u5904\u7406 ${n.completed} / ${n.total} \u5f20\u7167\u7247`)}const[ie,ae]=(0,r.useState)([]);if(!W)return(0,gt.jsx)("div",{children:"Loading..."});return(0,gt.jsxs)("div",{className:"roll-detail-page flex flex-col min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100",children:[(0,gt.jsx)(ir.A,{isOpen:v.isOpen,type:v.type,title:v.title,message:v.message,onConfirm:v.onConfirm,onCancel:v.onCancel}),(0,gt.jsx)(Xd,{isOpen:F,onClose:()=>z(!1),rollId:e,onUploadComplete:function(){t.invalidateQueries(["rollPhotos",e]),t.invalidateQueries(["roll",e])}}),(0,gt.jsx)(Ga,{roll:W,onEdit:async function(){try{const[e,t]=await Promise.all([(0,bn.ip)(),(0,bn.ET)()]);f(Array.isArray(e)?e:[]),g(t||{cameras:[],lenses:[],photographers:[]})}catch(e){console.error("Failed to load films/options for edit",e),f([]),g({cameras:[],lenses:[],photographers:[]})}l({title:W.title||"",start_date:W.start_date||"",end_date:W.end_date||"",camera_equip_id:W.camera_equip_id||null,lens_equip_id:W.lens_equip_id||null,photographer:W.photographer||"",film_type:W.film_type||"",filmId:W.filmId||W.film_id||"",notes:W.notes||"",develop_lab:W.develop_lab||"",develop_process:W.develop_process||"",develop_date:W.develop_date||"",purchase_cost:W.purchase_cost||"",develop_cost:W.develop_cost||"",purchase_channel:W.purchase_channel||"",develop_note:W.develop_note||"",scanner_equip_id:W.scanner_equip_id||null,scan_resolution:W.scan_resolution||"",scan_software:W.scan_software||"",scan_lab:W.scan_lab||"",scan_date:W.scan_date||"",scan_cost:W.scan_cost||"",scan_notes:W.scan_notes||""}),N(null),ae(Array.isArray(W.locations)?W.locations.slice():[]),o(!1),C(!0)},coverUrl:(()=>{const e=W.coverPath||W.cover_photo;if(e)return(0,bn.FH)(e);const t=H.find(e=>e.positive_rel_path||e.full_rel_path||e.negative_rel_path);if(t){const e=t.positive_rel_path||t.full_rel_path||t.negative_rel_path;return(0,bn.FH)(e)}return null})()}),(0,gt.jsx)(Yu,{viewMode:d,onViewModeChange:h,multiSelect:y,onMultiSelectChange:e=>{b(e),e||_([])},selectedCount:x.length,totalCount:H?H.length:0,onUpload:()=>z(!0),onBatchRender:function(){0!==H.length?R(!0):G("No Photos","No photos to render.")},onBatchDownload:function(){0!==H.length?O(!0):G("No Photos","No photos to download.")},onImportPositive:()=>D(!0),onContactSheet:()=>E(!0),onEditSelected:()=>S(!0),onSelectAll:()=>_([...H||[]]),onDeselectAll:()=>_([]),onInvertSelection:()=>{if(!H)return;const e=new Set(x.map(e=>e.id));_(H.filter(t=>!e.has(t.id)))}}),a&&(0,gt.jsx)("div",{style:{marginTop:12,marginBottom:20}}),(()=>{const e=H.filter(e=>!!e.full_rel_path||!!e.positive_rel_path).length,t=H.filter(e=>!!e.negative_rel_path).length,n=H.filter(e=>"positive"===d?!!e.full_rel_path||!!e.positive_rel_path:"negative"!==d||!!e.negative_rel_path);return 0===n.length?"positive"===d&&t>0?(0,gt.jsxs)("div",{style:{padding:"60px 0",textAlign:"center",color:"#888"},children:[(0,gt.jsx)("p",{children:"No positive photos available."}),(0,gt.jsxs)("button",{className:"btn btn-secondary",onClick:()=>h("negative"),children:["Switch to Negative View (",t," photos)"]})]}):(0,gt.jsxs)("div",{style:{padding:"60px 0",textAlign:"center",color:"#999",fontSize:"15px",background:"#f9f9f9",borderRadius:"12px",border:"1px dashed #ddd",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:[(0,gt.jsx)("div",{children:"positive"===d?"No positive photos available.":"No negative photos available."}),"positive"===d&&t>0&&(0,gt.jsxs)("button",{className:"primary-btn",onClick:()=>h("negative"),style:{fontSize:"14px",padding:"8px 16px"},children:["Switch to Negative View (",t," photos)"]}),"negative"===d&&e>0&&(0,gt.jsxs)("button",{className:"primary-btn",onClick:()=>h("positive"),style:{fontSize:"14px",padding:"8px 16px"},children:["Switch to Positive View (",e," photos)"]})]}):(0,gt.jsx)("div",{className:"photo-grid",children:n.map((e,t)=>(0,gt.jsx)(Fd,{p:e,filmName:Z,viewMode:d,onSelect:()=>i(t),onSetCover:te,onDeletePhoto:ee,onUpdatePhoto:ne,onEditTags:e=>u(e),multiSelect:y,selected:x.some(t=>t.id===e.id),onToggleSelect:e=>{_(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])}},e.id))})})(),c&&(0,gt.jsx)(Vd,{photo:c,allTags:$,onClose:()=>u(null),onSave:async(e,n)=>{try{console.log("[RollDetail] Calling onUpdatePhoto with:",{photoId:e,tags:n}),await ne(e,{tags:n}),console.log("[RollDetail] Tags saved successfully"),t.invalidateQueries(["tags"]),window.dispatchEvent(new Event("refresh-tags"))}catch(r){console.error("[RollDetail] Failed to save tags:",r)}u(null)}}),null!==n&&(0,gt.jsx)(Ra.default,{images:H.filter(e=>"positive"===d?!!e.full_rel_path||!!e.positive_rel_path:"negative"!==d||!!e.negative_rel_path),index:n,viewMode:d,onClose:()=>{i(null),U&&(R(!0),V(null))},onPhotoUpdate:()=>{t.invalidateQueries(["rollPhotos",e]),t.invalidateQueries(["roll",e])},roll:W,batchRenderCallback:U}),w&&y&&x.length>0&&(0,gt.jsx)(Gd.A,{photos:x,roll:W,onClose:()=>S(!1),onSaved:()=>{S(!1),t.invalidateQueries(["rollPhotos",e]),t.invalidateQueries(["roll",e])}},`batch-${x.map(e=>e.id).join(",")}`),T&&(0,gt.jsx)("div",{role:"presentation",onClick:()=>C(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.25)",zIndex:10019},children:(0,gt.jsxs)("aside",{className:"fg-sidepanel fade-slide-enter-active",role:"dialog","aria-modal":"true","aria-label":"Edit roll",onClick:e=>e.stopPropagation(),children:[(0,gt.jsxs)("header",{className:"fg-sidepanel-header",children:[(0,gt.jsx)("h3",{className:"fg-sidepanel-title",children:"Edit Roll"}),(0,gt.jsx)("button",{className:"fg-sidepanel-close","aria-label":"Close",onClick:()=>C(!1),children:"\xd7"})]}),(0,gt.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,gt.jsx)("div",{className:"fg-section-label",children:"Basic"}),(0,gt.jsx)("div",{className:"fg-separator"}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Title"}),(0,gt.jsx)("input",{className:"fg-input",value:s.title,onChange:e=>l({...s,title:e.target.value})})]}),(0,gt.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Start Date"}),(0,gt.jsx)("input",{className:"fg-input",type:"date",value:s.start_date,onChange:e=>l({...s,start_date:e.target.value})})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"End Date"}),(0,gt.jsx)("input",{className:"fg-input",type:"date",value:s.end_date,onChange:e=>l({...s,end_date:e.target.value})})]})]}),(0,gt.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Camera"}),(0,gt.jsx)(ar.A,{type:"camera",value:s.camera_equip_id,onChange:(e,t)=>{N(t),l(n=>({...n,camera_equip_id:e,lens_equip_id:null!==t&&void 0!==t&&t.has_fixed_lens?null:n.lens_equip_id}))},placeholder:"Select camera..."})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Lens"}),null!==P&&void 0!==P&&P.has_fixed_lens?(0,gt.jsxs)("div",{className:"fg-input",style:{background:"#f5f5f5",cursor:"not-allowed",color:"#666"},children:["Fixed: ",P.fixed_lens_focal_length?`${P.fixed_lens_focal_length}mm`:"Built-in",P.fixed_lens_max_aperture?` f/${P.fixed_lens_max_aperture}`:""]}):(0,gt.jsx)(ar.A,{type:"lens",value:s.lens_equip_id,cameraId:s.camera_equip_id,onChange:e=>l(t=>({...t,lens_equip_id:e})),placeholder:"Select lens..."})]})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Photographer"}),(0,gt.jsx)("input",{className:"fg-input",list:"photographer-options",value:s.photographer||"",onChange:e=>l({...s,photographer:e.target.value})}),(0,gt.jsx)("datalist",{id:"photographer-options",children:(m.photographers||[]).map((e,t)=>(0,gt.jsx)("option",{value:e},t))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Film"}),(0,gt.jsxs)("select",{className:"fg-select",value:s.filmId||"",onChange:e=>{const t=e.target.value,n=p.find(e=>String(e.id)===String(t));l({...s,filmId:t,film_type:n?n.name:""})},children:[(0,gt.jsx)("option",{value:"",children:"Select film"}),p.map(e=>(0,gt.jsxs)("option",{value:e.id,children:[e.name," (ISO ",e.iso,")"]},e.id))]})]})]}),(0,gt.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,gt.jsx)("div",{className:"fg-section-label",children:"Shooting Cities"}),(0,gt.jsx)("div",{className:"fg-separator"}),(0,gt.jsx)(nr,{value:null,onChange:e=>{e&&e.location_id&&ae(t=>t.some(t=>t.location_id===e.location_id)?t:[...t,e])}}),(0,gt.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:6},children:ie.map(e=>(0,gt.jsx)("span",{className:"fg-pill",children:e.city_name},e.location_id))})]}),(0,gt.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,gt.jsx)("div",{className:"fg-section-label",children:"Development"}),(0,gt.jsx)("div",{className:"fg-separator"}),(0,gt.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,gt.jsx)("input",{className:"fg-input",placeholder:"Lab",value:s.develop_lab,onChange:e=>l(t=>({...t,develop_lab:e.target.value}))}),(0,gt.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,gt.jsxs)("select",{className:"fg-select",value:s.develop_process||"",onChange:e=>l(t=>({...t,develop_process:e.target.value})),children:[(0,gt.jsx)("option",{value:"",children:"Preset"}),["C-41","E-6","BW","ECN-2"].map(e=>(0,gt.jsx)("option",{value:e,children:e},e))]}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Custom",value:s.develop_process||"",onChange:e=>l(t=>({...t,develop_process:e.target.value}))})]}),(0,gt.jsx)("input",{className:"fg-input",type:"date",placeholder:"Develop Date",value:s.develop_date,onChange:e=>l(t=>({...t,develop_date:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",type:"number",placeholder:"Purchase Cost",value:s.purchase_cost,onChange:e=>l(t=>({...t,purchase_cost:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",type:"number",placeholder:"Develop Cost",value:s.develop_cost,onChange:e=>l(t=>({...t,develop_cost:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Purchase Channel",value:s.purchase_channel,onChange:e=>l(t=>({...t,purchase_channel:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Note",value:s.develop_note,onChange:e=>l(t=>({...t,develop_note:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{marginTop:12},children:[(0,gt.jsx)("label",{className:"fg-label",children:"Notes"}),(0,gt.jsx)("textarea",{className:"fg-textarea",style:{minHeight:80},value:s.notes,onChange:e=>l({...s,notes:e.target.value})})]})]}),(0,gt.jsxs)("section",{className:"fg-sidepanel-section",children:[(0,gt.jsx)("div",{className:"fg-section-label",children:"Scanning Info"}),(0,gt.jsx)("div",{className:"fg-separator"}),(0,gt.jsxs)("div",{className:"fg-sidepanel-groupGrid cols-2",children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scanner"}),(0,gt.jsx)(ar.A,{type:"scanner",value:s.scanner_equip_id,onChange:e=>l(t=>({...t,scanner_equip_id:e})),placeholder:"Select scanner..."})]}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Scan Lab",value:s.scan_lab,onChange:e=>l(t=>({...t,scan_lab:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",type:"date",placeholder:"Scan Date",value:s.scan_date,onChange:e=>l(t=>({...t,scan_date:e.target.value})),lang:"en-US"}),(0,gt.jsx)("input",{className:"fg-input",type:"number",placeholder:"Resolution (DPI)",value:s.scan_resolution,onChange:e=>l(t=>({...t,scan_resolution:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",placeholder:"Scan Software",value:s.scan_software,onChange:e=>l(t=>({...t,scan_software:e.target.value}))}),(0,gt.jsx)("input",{className:"fg-input",type:"number",placeholder:"Scan Cost",value:s.scan_cost,onChange:e=>l(t=>({...t,scan_cost:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{marginTop:12},children:[(0,gt.jsx)("label",{className:"fg-label",children:"Scan Notes"}),(0,gt.jsx)("textarea",{className:"fg-textarea",style:{minHeight:60},placeholder:"Scan parameters, issues, etc...",value:s.scan_notes,onChange:e=>l(t=>({...t,scan_notes:e.target.value}))})]})]}),(0,gt.jsxs)("section",{className:"fg-sidepanel-section",style:{marginTop:"auto"},children:[(0,gt.jsx)("div",{className:"fg-separator"}),(0,gt.jsxs)("div",{className:"fg-sidepanel-actions",children:[(0,gt.jsx)("button",{type:"button",className:"fg-btn",onClick:()=>C(!1),children:"Cancel"}),(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-primary",onClick:async function(){try{await Y.mutateAsync({rollId:e,data:{...s,locations:ie.map(e=>e.location_id)}}),C(!1)}catch(t){console.error(t),alert("Update failed: "+t.message)}},children:"Save"})]})]})]})}),(0,gt.jsx)($d,{isOpen:M,onClose:()=>E(!1),roll:W,photos:H}),(0,gt.jsx)(gh,{isOpen:k,onClose:()=>R(!1),rollId:Number(e),selectedPhotos:y?x:[],allPhotos:H,onComplete:re,onOpenFilmLab:e=>{if(R(!1),V(()=>e),y&&x.length>0){const e=x[0].id,t=H.findIndex(t=>t.id===e);i(-1!==t?t:0)}else i(0)}}),(0,gt.jsx)(Ch,{isOpen:L,onClose:()=>O(!1),rollId:Number(e),rollName:(null===W||void 0===W?void 0:W.title)||"",selectedPhotos:y?x:[],allPhotos:H,onComplete:re}),(0,gt.jsx)(Uh,{isOpen:j,onClose:()=>D(!1),rollId:Number(e),rollName:(null===W||void 0===W?void 0:W.title)||"",onComplete:()=>{t.invalidateQueries({queryKey:["photos",e]}),D(!1)}}),(0,gt.jsx)(ep,{isOpen:I,onClose:()=>B(!1),rollId:Number(e),onImportComplete:()=>{t.invalidateQueries({queryKey:["rollPhotos",e]}),t.invalidateQueries({queryKey:["roll",e]})}})]})}var np=n(6764);const rp=$n("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),ip=$n("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function ap(e){const t=(0,Bn.o)(),n=null==t?void 0:t.labelPlacement;return(0,r.useMemo)(()=>{var t,r;const i=null!=(r=null!=(t=e.labelPlacement)?t:n)?r:"inside";return"inside"!==i||e.label?i:"outside"},[e.labelPlacement,n,e.label])}class op{*[Symbol.iterator](){yield*this.iterable}get size(){return this._size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);var n;return t&&null!==(n=t.prevKey)&&void 0!==n?n:null}getKeyAfter(e){let t=this.keyMap.get(e);var n;return t&&null!==(n=t.nextKey)&&void 0!==n?n:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){var t;return null!==(t=this.keyMap.get(e))&&void 0!==t?t:null}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}getChildren(e){let t=this.keyMap.get(e);return(null===t||void 0===t?void 0:t.childNodes)||[]}constructor(e){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=e;let t=e=>{if(this.keyMap.set(e.key,e),e.childNodes&&"section"===e.type)for(let n of e.childNodes)t(n)};for(let o of e)t(o);let n=null,r=0,i=0;for(let[o,s]of this.keyMap)n?(n.nextKey=o,s.prevKey=n.key):(this.firstKey=o,s.prevKey=void 0),"item"===s.type&&(s.index=r++),"section"!==s.type&&"item"!==s.type||i++,n=s,n.nextKey=void 0;var a;this._size=i,this.lastKey=null!==(a=null===n||void 0===n?void 0:n.key)&&void 0!==a?a:null}}function sp(e){let{filter:t,layoutDelegate:n}=e,i=js(e),a=(0,r.useMemo)(()=>e.disabledKeys?new Set(e.disabledKeys):new Set,[e.disabledKeys]),o=(0,r.useCallback)(e=>new op(t?t(e):e),[t]),s=(0,r.useMemo)(()=>({suppressTextValueWarning:e.suppressTextValueWarning}),[e.suppressTextValueWarning]),l=Vs(e,o,s),c=(0,r.useMemo)(()=>new Is(l,i,{layoutDelegate:n}),[l,i,n]);return lp(l,c),{collection:l,disabledKeys:a,selectionManager:c}}function lp(e,t){const n=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(null!=t.focusedKey&&!e.getItem(t.focusedKey)&&n.current){const u=n.current.getItem(t.focusedKey),d=[...n.current.getKeys()].map(e=>{const t=n.current.getItem(e);return"item"===(null===t||void 0===t?void 0:t.type)?t:null}).filter(e=>null!==e),h=[...e.getKeys()].map(t=>{const n=e.getItem(t);return"item"===(null===n||void 0===n?void 0:n.type)?n:null}).filter(e=>null!==e);var r,i;const p=(null!==(r=null===d||void 0===d?void 0:d.length)&&void 0!==r?r:0)-(null!==(i=null===h||void 0===h?void 0:h.length)&&void 0!==i?i:0);var a,o,s;let f=Math.min(p>1?Math.max((null!==(a=null===u||void 0===u?void 0:u.index)&&void 0!==a?a:0)-p+1,0):null!==(o=null===u||void 0===u?void 0:u.index)&&void 0!==o?o:0,(null!==(s=null===h||void 0===h?void 0:h.length)&&void 0!==s?s:0)-1),m=null,g=!1;for(;f>=0;){if(!t.isDisabled(h[f].key)){m=h[f];break}var l,c;if(f<h.length-1&&!g)f++;else g=!0,f>(null!==(l=null===u||void 0===u?void 0:u.index)&&void 0!==l?l:0)&&(f=null!==(c=null===u||void 0===u?void 0:u.index)&&void 0!==c?c:0),f--}t.setFocusedKey(m?m.key:null)}n.current=e},[e,t])}const cp={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},up={...cp,customError:!0,valid:!1},dp={isInvalid:!1,validationDetails:cp,validationErrors:[]},hp=(0,r.createContext)({}),pp="__formValidationState"+Date.now();function fp(e){if(e[pp]){let{realtimeValidation:t,displayValidation:n,updateValidation:r,resetValidation:i,commitValidation:a}=e[pp];return{realtimeValidation:t,displayValidation:n,updateValidation:r,resetValidation:i,commitValidation:a}}return function(e){let{isInvalid:t,validationState:n,name:i,value:a,builtinValidation:o,validate:s,validationBehavior:l="aria"}=e;n&&(t||(t="invalid"===n));let c=void 0!==t?{isInvalid:t,validationErrors:[],validationDetails:up}:null,u=(0,r.useMemo)(()=>{if(!s||null==a)return null;let e=function(e,t){if("function"===typeof e){let n=e(t);if(n&&"boolean"!==typeof n)return mp(n)}return[]}(s,a);return gp(e)},[s,a]);(null===o||void 0===o?void 0:o.validationDetails.valid)&&(o=void 0);let d=(0,r.useContext)(hp),h=(0,r.useMemo)(()=>i?Array.isArray(i)?i.flatMap(e=>mp(d[e])):mp(d[i]):[],[d,i]),[p,f]=(0,r.useState)(d),[m,g]=(0,r.useState)(!1);d!==p&&(f(d),g(!1));let v=(0,r.useMemo)(()=>gp(m?[]:h),[m,h]),A=(0,r.useRef)(dp),[y,b]=(0,r.useState)(dp),x=(0,r.useRef)(dp),_=()=>{if(!w)return;S(!1);let e=u||o||A.current;vp(e,x.current)||(x.current=e,b(e))},[w,S]=(0,r.useState)(!1);return(0,r.useEffect)(_),{realtimeValidation:c||v||u||o||dp,displayValidation:"native"===l?c||v||y:c||v||u||o||y,updateValidation(e){"aria"!==l||vp(y,e)?A.current=e:b(e)},resetValidation(){let e=dp;vp(e,x.current)||(x.current=e,b(e)),"native"===l&&S(!1),g(!0)},commitValidation(){"native"===l&&S(!0),g(!0)}}}(e)}function mp(e){return e?Array.isArray(e)?e:[e]:[]}function gp(e){return e.length?{isInvalid:!0,validationErrors:e,validationDetails:up}:null}function vp(e,t){return e===t||!!e&&!!t&&e.isInvalid===t.isInvalid&&e.validationErrors.length===t.validationErrors.length&&e.validationErrors.every((e,n)=>e===t.validationErrors[n])&&Object.entries(e.validationDetails).every(([e,n])=>t.validationDetails[e]===n)}function Ap({validate:e,validationBehavior:t,...n}){const[i,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)(null),l=io(n),c=function(e){const{collection:t,disabledKeys:n,selectionManager:i,selectionManager:{setSelectedKeys:a,selectedKeys:o,selectionMode:s}}=sp(e),l=(0,r.useMemo)(()=>e.isLoading||0===o.size?[]:Array.from(o).filter(Boolean).filter(e=>!t.getItem(e)),[o,t]),c=0!==o.size?Array.from(o).map(e=>t.getItem(e)).filter(Boolean):null;return l.length&&console.warn(`Select: Keys "${l.join(", ")}" passed to "selectedKeys" are not present in the collection.`),{collection:t,disabledKeys:n,selectionManager:i,selectionMode:s,selectedKeys:o,setSelectedKeys:a.bind(i),selectedItems:c}}({...n,onSelectionChange:e=>{null!=n.onSelectionChange&&("all"===e?n.onSelectionChange(new Set(c.collection.getKeys())):n.onSelectionChange(e)),"single"===n.selectionMode&&l.close()}}),u=fp({...n,validationBehavior:t,validate:t=>{if(!e)return;const r=Array.from(t);return e("single"===n.selectionMode?r[0]:r)},value:c.selectedKeys}),d=0===c.collection.size&&n.hideEmptyContent;return{...u,...c,...l,focusStrategy:o,close(){l.close()},open(e=null){d||(s(e),l.open())},toggle(e=null){d||(s(e),l.toggle())},isFocused:i,setFocused:a}}var yp=n(4962);function bp(e){let{id:t,label:n,"aria-labelledby":r,"aria-label":i,labelElementType:a="label"}=e;t=(0,oo.Bi)(t);let o=(0,oo.Bi)(),s={};return n&&(r=r?`${o} ${r}`:o,s={id:o,htmlFor:"label"===a?t:void 0}),{labelProps:s,fieldProps:(0,yp.b)({id:t,"aria-label":i,"aria-labelledby":r})}}function xp(e){let{description:t,errorMessage:n,isInvalid:r,validationState:i}=e,{labelProps:a,fieldProps:o}=bp(e),s=(0,oo.X1)([Boolean(t),Boolean(n),r,i]),l=(0,oo.X1)([Boolean(t),Boolean(n),r,i]);return o=(0,go.v)(o,{"aria-describedby":[s,l,e["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:a,fieldProps:o,descriptionProps:{id:s},errorMessageProps:{id:l}}}var _p=n(76),wp=Symbol("default");function Sp(e,t){let n=(0,r.useContext)(e);if(null===t)return null;if(n&&"object"===typeof n&&"slots"in n&&n.slots){let e=(new Intl.ListFormat).format(Object.keys(n.slots).map(e=>`"${e}"`));if(!t&&!n.slots[wp])throw new Error(`A slot prop is required. Valid slot names are ${e}.`);let r=t||wp;if(!n.slots[r])throw new Error(`Invalid slot "${t}". Valid slot names are ${e}.`);return n.slots[r]}return n}function Tp(e,t,n){let i=Sp(n,e.slot)||{},{ref:a,...o}=i,s=function(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(void 0),i=(0,r.useCallback)(t=>{if("function"===typeof e){const n=e,r=n(t);return()=>{"function"===typeof r?r():n(null)}}if(e)return e.current=t,()=>{e.current=null}},[e]);return(0,r.useMemo)(()=>({get current(){return t.current},set current(e){t.current=e,n.current&&(n.current(),n.current=void 0),null!=e&&(n.current=i(e))}}),[i])}((0,r.useMemo)(()=>(0,In.Px)(t,a),[t,a])),l=(0,In.v6)(o,e);return"style"in o&&o.style&&"style"in e&&e.style&&("function"===typeof o.style||"function"===typeof e.style?l.style=t=>{let n="function"===typeof o.style?o.style(t):o.style,r={...t.defaultStyle,...n},i="function"===typeof e.style?e.style({...t,defaultStyle:r}):e.style;return{...r,...i}}:l.style={...o.style,...e.style}),[l,s]}var Cp=(0,On.tv)({base:"flex flex-col gap-2 items-start"}),Mp=(0,r.createContext)(null),Ep=((0,r.forwardRef)(function(e,t){[e,t]=Tp(e,t,Mp);let{validationErrors:n,validationBehavior:i="native",children:a,className:o,...s}=e;const l=(0,r.useMemo)(()=>Cp({className:o}),[o]);return(0,gt.jsx)("form",{noValidate:"native"!==i,...s,ref:t,className:l,children:(0,gt.jsx)(Mp.Provider,{value:{...e,validationBehavior:i},children:(0,gt.jsx)(hp.Provider,{value:null!=n?n:{},children:a})})})}),new WeakMap);function Pp(e){var t,n,i,a,o,s;const l=(0,Bn.o)(),{validationBehavior:c}=Sp(Mp)||{},[u,d]=(0,Ln.rE)(e,qa.Lt.variantKeys),h=null!=(n=null!=(t=e.disableAnimation)?t:null==l?void 0:l.disableAnimation)&&n,{ref:p,as:f,label:m,name:g,isLoading:v,selectorIcon:A,isOpen:y,defaultOpen:b,onOpenChange:x,startContent:_,endContent:w,description:S,renderValue:T,onSelectionChange:C,placeholder:M,isVirtualized:E,itemHeight:P=36,maxListboxHeight:N=256,children:k,disallowEmptySelection:R=!1,selectionMode:L="single",spinnerRef:O,scrollRef:j,popoverProps:D={},scrollShadowProps:I={},listboxProps:B={},spinnerProps:F={},validationState:z,onChange:U,onClose:V,className:G,classNames:q,validationBehavior:W=(null!=(i=null!=c?c:null==l?void 0:l.validationBehavior)?i:"native"),hideEmptyContent:H=!1,onClear:$,...K}=u,X=(0,Wa.zD)(j),Y={popoverProps:(0,In.v6)({placement:"bottom",triggerScaleOnOpen:!1,offset:5,disableAnimation:h},D),scrollShadowProps:(0,In.v6)({ref:X,isEnabled:null==(a=e.showScrollIndicators)||a,hideScrollBar:!0,offset:15},I),listboxProps:(0,In.v6)({disableAnimation:h},B)},Q=f||"button",Z="string"===typeof Q,J=(0,Wa.zD)(p),ee=(0,r.useRef)(null),te=(0,r.useRef)(null),ne=(0,r.useRef)(null);let re=Ap({...u,isOpen:y,selectionMode:L,disallowEmptySelection:R,validationBehavior:W,children:k,isRequired:e.isRequired,isDisabled:e.isDisabled,isInvalid:e.isInvalid,defaultOpen:b,hideEmptyContent:H,onOpenChange:e=>{null==x||x(e),e||null==V||V()},onSelectionChange:e=>{null==C||C(e),U&&"function"===typeof U&&U({target:{...J.current&&{...J.current,name:J.current.name},value:Array.from(e).join(",")}}),re.commitValidation()}});re={...re,...e.isDisabled&&{disabledKeys:new Set([...re.collection.getKeys()])}},(0,_p.U)(()=>{var e;(null==(e=J.current)?void 0:e.value)&&re.setSelectedKeys(new Set([...re.selectedKeys,J.current.value]))},[J.current]);const{labelProps:ie,triggerProps:ae,valueProps:oe,menuProps:se,descriptionProps:le,errorMessageProps:ce,isInvalid:ue,validationErrors:de,validationDetails:he}=function(e,t,n){const{disallowEmptySelection:i,isDisabled:a}=e,o=Ns({usage:"search",sensitivity:"base"}),s=(0,r.useMemo)(()=>new Es(t.collection,t.disabledKeys,null,o),[t.collection,t.disabledKeys,o]),{menuTriggerProps:l,menuProps:c}=xo({isDisabled:a,type:"listbox"},t,n),{typeSelectProps:u}=ms({keyboardDelegate:s,selectionManager:t.selectionManager,onTypeSelect(e){t.setSelectedKeys([e])}}),{isInvalid:d,validationErrors:h,validationDetails:p}=t.displayValidation,{labelProps:f,fieldProps:m,descriptionProps:g,errorMessageProps:v}=xp({...e,labelElementType:"span",isInvalid:d,errorMessage:e.errorMessage||h});u.onKeyDown=u.onKeyDownCapture,delete u.onKeyDownCapture,l.onPressStart=e=>{"touch"===e.pointerType||"keyboard"===e.pointerType||a||t.toggle("virtual"===e.pointerType?"first":null)};const A=(0,Io.$)(e,{labelable:!0}),y=(0,go.v)(u,l,m),b=(0,oo.Bi)();return{labelProps:{...f,onClick:()=>{var t;e.isDisabled||(null==(t=n.current)||t.focus(),(0,Wo.Cl)("keyboard"))}},triggerProps:(0,go.v)(A,{...y,onKeyDown:(0,es.c)(y.onKeyDown,e=>{if("single"===t.selectionMode)switch(e.key){case"ArrowLeft":{e.preventDefault();const n=t.selectedKeys.size>0?s.getKeyAbove(t.selectedKeys.values().next().value):s.getFirstKey();n&&t.setSelectedKeys([n]);break}case"ArrowRight":{e.preventDefault();const n=t.selectedKeys.size>0?s.getKeyBelow(t.selectedKeys.values().next().value):s.getFirstKey();n&&t.setSelectedKeys([n]);break}}},e.onKeyDown),onKeyUp:e.onKeyUp,"aria-labelledby":[b,y["aria-labelledby"],y["aria-label"]&&!y["aria-labelledby"]?y.id:null].join(" "),onFocus(n){t.isFocused||(e.onFocus&&e.onFocus(n),t.setFocused(!0))},onBlur(n){t.isOpen||(e.onBlur&&e.onBlur(n),t.setFocused(!1))}}),valueProps:{id:b},menuProps:{...c,disallowEmptySelection:i,autoFocus:t.focusStrategy||!0,shouldSelectOnPressUp:!0,shouldFocusOnHover:!0,onBlur:n=>{n.currentTarget.contains(n.relatedTarget)||(e.onBlur&&e.onBlur(n),t.setFocused(!1))},onFocus:null==c?void 0:c.onFocus,"aria-labelledby":[m["aria-labelledby"],y["aria-label"]&&!m["aria-labelledby"]?y.id:null].filter(Boolean).join(" ")},descriptionProps:g,errorMessageProps:v,isInvalid:d,validationErrors:h,validationDetails:p}}({...u,disallowEmptySelection:R,isDisabled:e.isDisabled},re,ee),pe=(0,r.useCallback)(()=>{var e;re.setSelectedKeys(new Set([])),null==$||$(),null==(e=ee.current)||e.focus()},[$,re]),{pressProps:fe}=(0,lo.d)({isDisabled:!!(null==e?void 0:e.isDisabled),onPress:pe}),me=e.isInvalid||"invalid"===z||ue,{isPressed:ge,buttonProps:ve}=(0,id.l)(ae,ee),{focusProps:Ae,isFocused:ye,isFocusVisible:be}=(0,Oo.o)(),{focusProps:xe,isFocusVisible:_e}=(0,Oo.o)(),{isHovered:we,hoverProps:Se}=(0,qo.M)({isDisabled:e.isDisabled}),Te=ap({labelPlacement:e.labelPlacement,label:m}),Ce=!!M,Me="outside-left"===Te||"outside"===Te||"outside-top"===Te,Ee="inside"===Te,Pe="outside-left"===Te,Ne=e.isClearable,ke=re.isOpen||Ce||!!(null==(o=re.selectedItems)?void 0:o.length)||!!_||!!w||!!e.isMultiline,Re=!!(null==(s=re.selectedItems)?void 0:s.length),Le=!!m,Oe=Le&&(Pe||Me&&Ce),je=(0,Dn.cn)(null==q?void 0:q.base,G),De=(0,r.useMemo)(()=>(0,qa.Lt)({...d,isInvalid:me,isClearable:Ne,labelPlacement:Te,disableAnimation:h}),[(0,In.t6)(d),me,Te,h]);(0,Qu.H)({isDisabled:!re.isOpen});const Ie="function"===typeof u.errorMessage?u.errorMessage({isInvalid:me,validationErrors:de,validationDetails:he}):u.errorMessage||(null==de?void 0:de.join(" ")),Be=!!S||!!Ie,Fe=!!w;(0,r.useEffect)(()=>{if(re.isOpen&&ne.current&&ee.current){let e=ee.current.getBoundingClientRect();ne.current.style.width=e.width+"px"}},[re.isOpen]);const ze=(0,r.useCallback)((e={})=>({"data-slot":"base","data-filled":(0,In.sE)(ke),"data-has-value":(0,In.sE)(Re),"data-has-label":(0,In.sE)(Le),"data-has-helper":(0,In.sE)(Be),"data-has-end-content":(0,In.sE)(Fe),"data-invalid":(0,In.sE)(me),"data-has-label-outside":(0,In.sE)(Oe),className:De.base({class:(0,Dn.cn)(je,e.className)}),...e}),[De,Be,Re,Le,Oe,ke,je]),Ue=(0,r.useCallback)((t={})=>({ref:ee,"data-slot":"trigger","data-open":(0,In.sE)(re.isOpen),"data-disabled":(0,In.sE)(null==e?void 0:e.isDisabled),"data-focus":(0,In.sE)(ye),"data-pressed":(0,In.sE)(ge),"data-focus-visible":(0,In.sE)(be),"data-hover":(0,In.sE)(we),className:De.trigger({class:null==q?void 0:q.trigger}),...(0,In.v6)(ve,Ae,Se,(0,Xa.$)(K,{enabled:Z}),(0,Xa.$)(t))}),[De,ee,re.isOpen,null==q?void 0:q.trigger,null==e?void 0:e.isDisabled,ye,ge,be,we,ve,Ae,Se,K,Z]),Ve=(0,r.useCallback)((t={})=>({state:re,triggerRef:ee,selectRef:J,selectionMode:L,label:null==e?void 0:e.label,name:null==e?void 0:e.name,isRequired:null==e?void 0:e.isRequired,autoComplete:null==e?void 0:e.autoComplete,isDisabled:null==e?void 0:e.isDisabled,form:null==e?void 0:e.form,onChange:U,...t}),[re,L,null==e?void 0:e.label,null==e?void 0:e.autoComplete,null==e?void 0:e.name,null==e?void 0:e.isDisabled,ee]),Ge=(0,r.useCallback)((e={})=>({"data-slot":"label",className:De.label({class:(0,Dn.cn)(null==q?void 0:q.label,e.className)}),...ie,...e}),[De,null==q?void 0:q.label,ie]),qe=(0,r.useCallback)((e={})=>({"data-slot":"value",className:De.value({class:(0,Dn.cn)(null==q?void 0:q.value,e.className)}),...oe,...e}),[De,null==q?void 0:q.value,oe]),We=(0,r.useCallback)((e={})=>({"data-slot":"listboxWrapper",className:De.listboxWrapper({class:(0,Dn.cn)(null==q?void 0:q.listboxWrapper,null==e?void 0:e.className)}),style:{maxHeight:null!=N?N:256,...e.style},...(0,In.v6)(Y.scrollShadowProps,e)}),[De.listboxWrapper,null==q?void 0:q.listboxWrapper,Y.scrollShadowProps,N]),He=(0,r.useCallback)((e={})=>{var t,n;const r=(0,In.v6)(Y.popoverProps,e);return{state:re,triggerRef:ee,ref:ne,"data-slot":"popover",scrollRef:te,triggerType:"listbox",classNames:{content:De.popoverContent({class:(0,Dn.cn)(null==q?void 0:q.popoverContent,e.className)})},...r,offset:re.selectedItems&&re.selectedItems.length>0?1e-8*re.selectedItems.length+((null==(t=Y.popoverProps)?void 0:t.offset)||0):null==(n=Y.popoverProps)?void 0:n.offset}},[De,null==q?void 0:q.popoverContent,Y.popoverProps,ee,re,re.selectedItems]),$e=(0,r.useCallback)(()=>({"data-slot":"selectorIcon","aria-hidden":(0,In.sE)(!0),"data-open":(0,In.sE)(re.isOpen),className:De.selectorIcon({class:null==q?void 0:q.selectorIcon})}),[De,null==q?void 0:q.selectorIcon,re.isOpen]),Ke=(0,r.useCallback)((e={})=>({...e,"data-slot":"innerWrapper",className:De.innerWrapper({class:(0,Dn.cn)(null==q?void 0:q.innerWrapper,null==e?void 0:e.className)})}),[De,null==q?void 0:q.innerWrapper]),Xe=(0,r.useCallback)((e={})=>({...e,"data-slot":"helperWrapper",className:De.helperWrapper({class:(0,Dn.cn)(null==q?void 0:q.helperWrapper,null==e?void 0:e.className)})}),[De,null==q?void 0:q.helperWrapper]),Ye=(0,r.useCallback)((e={})=>({...e,...le,"data-slot":"description",className:De.description({class:(0,Dn.cn)(null==q?void 0:q.description,null==e?void 0:e.className)})}),[De,null==q?void 0:q.description]),Qe=(0,r.useCallback)((e={})=>({...e,"data-slot":"mainWrapper",className:De.mainWrapper({class:(0,Dn.cn)(null==q?void 0:q.mainWrapper,null==e?void 0:e.className)})}),[De,null==q?void 0:q.mainWrapper]),Ze=(0,r.useCallback)((e={})=>({...e,"data-slot":"end-wrapper",className:De.endWrapper({class:(0,Dn.cn)(null==q?void 0:q.endWrapper,null==e?void 0:e.className)})}),[De,null==q?void 0:q.endWrapper]),Je=(0,r.useCallback)((e={})=>({...e,"data-slot":"end-content",className:De.endContent({class:(0,Dn.cn)(null==q?void 0:q.endContent,null==e?void 0:e.className)})}),[De,null==q?void 0:q.endContent]),et=(0,r.useCallback)((e={})=>({...e,...ce,"data-slot":"error-message",className:De.errorMessage({class:(0,Dn.cn)(null==q?void 0:q.errorMessage,null==e?void 0:e.className)})}),[De,ce,null==q?void 0:q.errorMessage]),tt=(0,r.useCallback)((e={})=>({"aria-hidden":(0,In.sE)(!0),"data-slot":"spinner",color:"current",size:"sm",...F,...e,ref:O,className:De.spinner({class:(0,Dn.cn)(null==q?void 0:q.spinner,null==e?void 0:e.className)})}),[De,O,F,null==q?void 0:q.spinner]),nt=(0,r.useCallback)((e={})=>({...e,type:"button",tabIndex:-1,"aria-label":"clear selection","data-slot":"clear-button","data-focus-visible":(0,In.sE)(_e),className:De.clearButton({class:(0,Dn.cn)(null==q?void 0:q.clearButton,null==e?void 0:e.className)}),...(0,In.v6)(fe,xe)}),[De,_e,fe,xe,null==q?void 0:q.clearButton]);return Ep.set(re,{isDisabled:null==e?void 0:e.isDisabled,isRequired:null==e?void 0:e.isRequired,name:null==e?void 0:e.name,isInvalid:me,validationBehavior:W}),{Component:Q,domRef:J,state:re,label:m,name:g,triggerRef:ee,isLoading:v,placeholder:M,startContent:_,endContent:w,description:S,selectorIcon:A,hasHelper:Be,labelPlacement:Te,hasPlaceholder:Ce,renderValue:T,selectionMode:L,disableAnimation:h,isOutsideLeft:Pe,shouldLabelBeOutside:Me,shouldLabelBeInside:Ee,isInvalid:me,errorMessage:Ie,isClearable:Ne,getClearButtonProps:nt,getBaseProps:ze,getTriggerProps:Ue,getLabelProps:Ge,getValueProps:qe,getListboxProps:(e={})=>{const t=null!=E?E:re.collection.size>50;return{state:re,ref:te,isVirtualized:t,virtualization:t?{maxListboxHeight:N,itemHeight:P}:void 0,"data-slot":"listbox",className:De.listbox({class:(0,Dn.cn)(null==q?void 0:q.listbox,null==e?void 0:e.className)}),scrollShadowProps:Y.scrollShadowProps,...(0,In.v6)(Y.listboxProps,e,se)}},getPopoverProps:He,getSpinnerProps:tt,getMainWrapperProps:Qe,getListboxWrapperProps:We,getHiddenSelectProps:Ve,getInnerWrapperProps:Ke,getHelperWrapperProps:Xe,getDescriptionProps:Ye,getErrorMessageProps:et,getSelectorIconProps:$e,getEndWrapperProps:Ze,getEndContentProps:Je}}var Np="undefined"!==typeof document?r.useLayoutEffect:()=>{};function kp(e,t,n){let i=(0,r.useRef)(t),a=function(e){const t=(0,r.useRef)(null);return Np(()=>{t.current=e},[e]),(0,r.useCallback)((...e)=>{const n=t.current;return null==n?void 0:n(...e)},[])}(()=>{n&&n(i.current)});(0,r.useEffect)(()=>{var t;let n=null==(t=null==e?void 0:e.current)?void 0:t.form;return null==n||n.addEventListener("reset",a),()=>{null==n||n.removeEventListener("reset",a)}},[e,a])}var Rp=n(3194);function Lp(e,t,n){let{validationBehavior:i,focus:a}=e;(0,ho.N)(()=>{if("native"===i&&(null===n||void 0===n?void 0:n.current)&&!n.current.disabled){let r=t.realtimeValidation.isInvalid?t.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";n.current.setCustomValidity(r),n.current.hasAttribute("title")||(n.current.title=""),t.realtimeValidation.isInvalid||t.updateValidation({isInvalid:!(e=n.current).validity.valid,validationDetails:Op(e),validationErrors:e.validationMessage?[e.validationMessage]:[]})}var e});let o=(0,r.useRef)(!1),s=(0,vs.J)(()=>{o.current||t.resetValidation()}),l=(0,vs.J)(e=>{var r;t.displayValidation.isInvalid||t.commitValidation();let i=null===n||void 0===n||null===(r=n.current)||void 0===r?void 0:r.form;var o;!e.defaultPrevented&&n&&i&&function(e){for(let t=0;t<e.elements.length;t++){let n=e.elements[t];if(!n.validity.valid)return n}return null}(i)===n.current&&(a?a():null===(o=n.current)||void 0===o||o.focus(),(0,Wo.Cl)("keyboard"));e.preventDefault()}),c=(0,vs.J)(()=>{t.commitValidation()});(0,r.useEffect)(()=>{let e=null===n||void 0===n?void 0:n.current;if(!e)return;let t=e.form,r=null===t||void 0===t?void 0:t.reset;return t&&(t.reset=()=>{o.current=!window.event||"message"===window.event.type&&window.event.target instanceof MessagePort,null===r||void 0===r||r.call(t),o.current=!1}),e.addEventListener("invalid",l),e.addEventListener("change",c),null===t||void 0===t||t.addEventListener("reset",s),()=>{e.removeEventListener("invalid",l),e.removeEventListener("change",c),null===t||void 0===t||t.removeEventListener("reset",s),t&&(t.reset=r)}},[n,i])}function Op(e){let t=e.validity;return{badInput:t.badInput,customError:t.customError,patternMismatch:t.patternMismatch,rangeOverflow:t.rangeOverflow,rangeUnderflow:t.rangeUnderflow,stepMismatch:t.stepMismatch,tooLong:t.tooLong,tooShort:t.tooShort,typeMismatch:t.typeMismatch,valueMissing:t.valueMissing,valid:t.valid}}function jp(e){var t;let{state:n,triggerRef:r,selectRef:i,label:a,name:o,isDisabled:s,form:l}=e,{containerProps:c,selectProps:u}=function(e,t,n){var r;let i=Ep.get(t)||{},{autoComplete:a,name:o=i.name,isDisabled:s=i.isDisabled,selectionMode:l,onChange:c,form:u}=e,{validationBehavior:d,isRequired:h,isInvalid:p}=i,{visuallyHiddenProps:f}=(0,Rp.B)();return kp(e.selectRef,t.selectedKeys,t.setSelectedKeys),Lp({validationBehavior:d,focus:()=>{var e;return null==(e=n.current)?void 0:e.focus()}},t,e.selectRef),{containerProps:{...f,"aria-hidden":!0,"data-a11y-ignore":"aria-hidden-focus"},inputProps:{style:{display:"none"}},selectProps:{form:u,autoComplete:a,disabled:s,"aria-invalid":p||void 0,"aria-required":h&&"aria"===d||void 0,required:h&&"native"===d,name:o,tabIndex:-1,value:"multiple"===l?[...t.selectedKeys].map(e=>String(e)):null!=(r=[...t.selectedKeys][0])?r:"",multiple:"multiple"===l,onChange:e=>{t.setSelectedKeys(e.target.value),null==c||c(e)}}}}({...e,selectRef:i},n,r);return n.collection.size<=300?(0,gt.jsx)("div",{...c,"data-testid":"hidden-select-container",children:(0,gt.jsxs)("label",{children:[a,(0,gt.jsxs)("select",{...u,ref:i,children:[(0,gt.jsx)("option",{}),[...n.collection.getKeys()].map(e=>{let t=n.collection.getItem(e);if("item"===(null==t?void 0:t.type))return(0,gt.jsx)("option",{value:t.key,children:t.textValue},t.key)})]})]})}):o?(0,gt.jsx)("input",{autoComplete:u.autoComplete,disabled:s,form:l,name:o,type:"hidden",value:null!=(t=[...n.selectedKeys].join(","))?t:""}):null}const Dp=new WeakMap;function Ip(e,t){let n=Dp.get(e);if(!n)throw new Error("Unknown list");return`${n.id}-option-${r=t,"string"===typeof r?r.replace(/\s*/g,""):""+r}`;var r}var Bp=n(2598);function Fp(e){var t;const n=(0,Bn.o)(),{ref:i,as:a,state:o,variant:s,color:l,onAction:c,children:u,onSelectionChange:d,disableAnimation:h=null!=(t=null==n?void 0:n.disableAnimation)&&t,itemClasses:p,className:f,topContent:m,bottomContent:g,emptyContent:v="No items.",hideSelectedIcon:A=!1,hideEmptyContent:y=!1,shouldHighlightOnFocus:b=!1,classNames:x,..._}=e,w=a||"ul",S="string"===typeof w,T=(0,Wa.zD)(i),C=sp({...e,children:u,onSelectionChange:d}),M=o||C,{listBoxProps:E}=function(e,t,n){let r=(0,Io.$)(e,{labelable:!0}),i=e.selectionBehavior||"toggle",a=e.linkBehavior||("replace"===i?"action":"override");"toggle"===i&&"action"===a&&(a="override");let{listProps:o}=ks({...e,ref:n,selectionManager:t.selectionManager,collection:t.collection,disabledKeys:t.disabledKeys,linkBehavior:a}),{focusWithinProps:s}=(0,Bp.R)({onFocusWithin:e.onFocus,onBlurWithin:e.onBlur,onFocusWithinChange:e.onFocusChange}),l=(0,oo.Bi)(e.id);Dp.set(t,{id:l,shouldUseVirtualFocus:e.shouldUseVirtualFocus,shouldSelectOnPressUp:e.shouldSelectOnPressUp,shouldFocusOnHover:e.shouldFocusOnHover,isVirtualized:e.isVirtualized,onAction:e.onAction,linkBehavior:a,UNSTABLE_itemBehavior:e.UNSTABLE_itemBehavior});let{labelProps:c,fieldProps:u}=bp({...e,id:l,labelElementType:"span"});return{labelProps:c,listBoxProps:(0,go.v)(r,s,"multiple"===t.selectionManager.selectionMode?{"aria-multiselectable":"true"}:{},{role:"listbox",...(0,go.v)(u,o)})}}({...e,onAction:c},M,T),P=(0,r.useMemo)(()=>(0,qa.MK)(),[]),N=(0,Dn.cn)(null==x?void 0:x.base,f);return{Component:w,state:M,variant:s,color:l,slots:P,classNames:x,topContent:m,bottomContent:g,emptyContent:v,hideEmptyContent:y,shouldHighlightOnFocus:b,hideSelectedIcon:A,disableAnimation:h,className:f,itemClasses:p,getBaseProps:(e={})=>({ref:T,"data-slot":"base",className:P.base({class:N}),...(0,Xa.$)(_,{enabled:S}),...e}),getListProps:(e={})=>({"data-slot":"list",className:P.list({class:null==x?void 0:x.list}),...E,...e}),getEmptyContentProps:(e={})=>({"data-slot":"empty-content",children:v,className:P.emptyContent({class:null==x?void 0:x.emptyContent}),...e})}}function zp(e){const{isSelected:t,disableAnimation:n,...r}=e;return(0,gt.jsx)("svg",{"aria-hidden":"true","data-selected":t,role:"presentation",viewBox:"0 0 17 18",...r,children:(0,gt.jsx)("polyline",{fill:"none",points:"1 9 7 14 15 4",stroke:"currentColor",strokeDasharray:22,strokeDashoffset:t?44:66,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,style:n?{}:{transition:"stroke-dashoffset 200ms ease"}})})}function Up(e,t,n){var r,i;let{key:a}=e,o=Dp.get(t);var s;let l=null!==(s=e.isDisabled)&&void 0!==s?s:t.selectionManager.isDisabled(a);var c;let u=null!==(c=e.isSelected)&&void 0!==c?c:t.selectionManager.isSelected(a);var d;let h=null!==(d=e.shouldSelectOnPressUp)&&void 0!==d?d:null===o||void 0===o?void 0:o.shouldSelectOnPressUp;var p;let f=null!==(p=e.shouldFocusOnHover)&&void 0!==p?p:null===o||void 0===o?void 0:o.shouldFocusOnHover;var m;let g=null!==(m=e.shouldUseVirtualFocus)&&void 0!==m?m:null===o||void 0===o?void 0:o.shouldUseVirtualFocus;var v;let A=null!==(v=e.isVirtualized)&&void 0!==v?v:null===o||void 0===o?void 0:o.isVirtualized,y=(0,oo.X1)(),b=(0,oo.X1)(),x={role:"option","aria-disabled":l||void 0,"aria-selected":"none"!==t.selectionManager.selectionMode?u:void 0};(0,Ko.cX)()&&(0,Ko.Tc)()||(x["aria-label"]=e["aria-label"],x["aria-labelledby"]=y,x["aria-describedby"]=b);let _=t.collection.getItem(a);if(A){let e=Number(null===_||void 0===_?void 0:_.index);x["aria-posinset"]=Number.isNaN(e)?void 0:e+1,x["aria-setsize"]=Go(t.collection)}let w=(null===o||void 0===o?void 0:o.onAction)?()=>{var e;return null===o||void 0===o||null===(e=o.onAction)||void 0===e?void 0:e.call(o,a)}:void 0,S=Ip(t,a),{itemProps:T,isPressed:C,isFocused:M,hasAction:E,allowsSelection:P}=as({selectionManager:t.selectionManager,key:a,ref:n,shouldSelectOnPressUp:h,allowsDifferentPressOrigin:h&&f,isVirtualized:A,shouldUseVirtualFocus:g,isDisabled:l,onAction:w||(null===_||void 0===_||null===(r=_.props)||void 0===r?void 0:r.onAction)?(0,es.c)(null===_||void 0===_||null===(i=_.props)||void 0===i?void 0:i.onAction,w):void 0,linkBehavior:null===o||void 0===o?void 0:o.linkBehavior,UNSTABLE_itemBehavior:null===o||void 0===o?void 0:o.UNSTABLE_itemBehavior,id:S}),{hoverProps:N}=(0,qo.M)({isDisabled:l||!f,onHoverStart(){(0,Wo.pP)()||(t.selectionManager.setFocused(!0),t.selectionManager.setFocusedKey(a))}}),k=(0,Io.$)(null===_||void 0===_?void 0:_.props);delete k.id;let R=(0,Do._h)(null===_||void 0===_?void 0:_.props);return{optionProps:{...x,...(0,go.v)(k,T,N,R),id:S},labelProps:{id:y},descriptionProps:{id:b},isFocused:M,isFocusVisible:M&&t.selectionManager.isFocused&&(0,Wo.pP)(),isSelected:u,isDisabled:l,isPressed:C,allowsSelection:P,hasAction:E}}var Vp=e=>{const{Component:t,rendered:n,description:i,isSelectable:a,isSelected:o,isDisabled:s,selectedIcon:l,startContent:c,endContent:u,hideSelectedIcon:d,disableAnimation:h,getItemProps:p,getLabelProps:f,getWrapperProps:m,getDescriptionProps:g,getSelectedIconProps:v}=function(e){var t,n;const i=(0,Bn.o)(),[a,o]=(0,Ln.rE)(e,qa.j$.variantKeys),{as:s,item:l,state:c,description:u,startContent:d,endContent:h,isVirtualized:p,selectedIcon:f,className:m,classNames:g,autoFocus:v,onPress:A,onPressUp:y,onPressStart:b,onPressEnd:x,onPressChange:_,onClick:w,shouldHighlightOnFocus:S,hideSelectedIcon:T=!1,isReadOnly:C=!1,...M}=a,E=null!=(n=null!=(t=e.disableAnimation)?t:null==i?void 0:i.disableAnimation)&&n,P=(0,r.useRef)(null),N=s||(e.href?"a":"li"),k="string"===typeof N,{rendered:R,key:L}=l,O=c.disabledKeys.has(L)||e.isDisabled,j="none"!==c.selectionManager.selectionMode,D=us(),{pressProps:I,isPressed:B}=(0,lo.d)({ref:P,isDisabled:O,onClick:w,onPress:A,onPressUp:y,onPressStart:b,onPressEnd:x,onPressChange:_}),{isHovered:F,hoverProps:z}=(0,qo.M)({isDisabled:O}),{isFocusVisible:U,focusProps:V}=(0,Oo.o)({autoFocus:v}),{isFocused:G,isSelected:q,optionProps:W,labelProps:H,descriptionProps:$}=Up({key:L,isDisabled:O,"aria-label":a["aria-label"],isVirtualized:p},c,P);let K=W;const X=(0,r.useMemo)(()=>(0,qa.j$)({...o,isDisabled:O,disableAnimation:E,hasTitleTextChild:"string"===typeof R,hasDescriptionTextChild:"string"===typeof u}),[(0,In.t6)(o),O,E,R,u]),Y=(0,Dn.cn)(null==g?void 0:g.base,m);C&&(K=(0,In.GU)(K));const Q=S&&G||(D?F||B:F||G&&!U),Z=(0,r.useCallback)((e={})=>({"aria-hidden":(0,In.sE)(!0),"data-disabled":(0,In.sE)(O),className:X.selectedIcon({class:null==g?void 0:g.selectedIcon}),...e}),[O,X,g]);return{Component:N,domRef:P,slots:X,classNames:g,isSelectable:j,isSelected:q,isDisabled:O,rendered:R,description:u,startContent:d,endContent:h,selectedIcon:f,hideSelectedIcon:T,disableAnimation:E,getItemProps:(e={})=>({ref:P,...(0,In.v6)(K,C?{}:(0,In.v6)(V,I),z,(0,Xa.$)(M,{enabled:k}),e),"data-selectable":(0,In.sE)(j),"data-focus":(0,In.sE)(G),"data-hover":(0,In.sE)(Q),"data-disabled":(0,In.sE)(O),"data-selected":(0,In.sE)(q),"data-pressed":(0,In.sE)(B),"data-focus-visible":(0,In.sE)(U),className:X.base({class:(0,Dn.cn)(Y,e.className)})}),getLabelProps:(e={})=>({...(0,In.v6)(H,e),"data-label":(0,In.sE)(!0),className:X.title({class:null==g?void 0:g.title})}),getWrapperProps:(e={})=>({...(0,In.v6)(e),className:X.wrapper({class:null==g?void 0:g.wrapper})}),getDescriptionProps:(e={})=>({...(0,In.v6)($,e),className:X.description({class:null==g?void 0:g.description})}),getSelectedIconProps:Z}}(e),A=(0,r.useMemo)(()=>{const e=(0,gt.jsx)(zp,{disableAnimation:h,isSelected:o});return"function"===typeof l?l({icon:e,isSelected:o,isDisabled:s}):l||e},[l,o,s,h]);return(0,gt.jsxs)(t,{...p(),children:[c,i?(0,gt.jsxs)("div",{...m(),children:[(0,gt.jsx)("span",{...f(),children:n}),(0,gt.jsx)("span",{...g(),children:i})]}):(0,gt.jsx)("span",{...f(),children:n}),a&&!d&&(0,gt.jsx)("span",{...v(),children:A}),u]})};Vp.displayName="HeroUI.ListboxItem";var Gp=Vp;var qp=(0,Ln.Rf)(({item:e,state:t,as:n,variant:i,color:a,disableAnimation:o,className:s,classNames:l,hideSelectedIcon:c,showDivider:u=!1,dividerProps:d={},itemClasses:h,title:p,items:f,...m},g)=>{const v=n||"li",A=(0,r.useMemo)(()=>(0,qa.Dt)(),[]),y=(0,Dn.cn)(null==l?void 0:l.base,s),b=(0,Dn.cn)(null==l?void 0:l.divider,null==d?void 0:d.className),{itemProps:x,headingProps:_,groupProps:w}=function(e){let{heading:t,"aria-label":n}=e,r=(0,oo.Bi)();return{itemProps:{role:"presentation"},headingProps:t?{id:r,role:"presentation"}:{},groupProps:{role:"group","aria-label":n,"aria-labelledby":t?r:void 0}}}({heading:e.rendered,"aria-label":e["aria-label"]});return(0,gt.jsxs)(v,{"data-slot":"base",...(0,In.v6)(x,m),className:A.base({class:y}),children:[e.rendered&&(0,gt.jsx)("span",{..._,className:A.heading({class:null==l?void 0:l.heading}),"data-slot":"heading",children:e.rendered}),(0,gt.jsxs)("ul",{...w,className:A.group({class:null==l?void 0:l.group}),"data-has-title":!!e.rendered,"data-slot":"group",children:[[...e.childNodes].map(e=>{const{key:n,props:r}=e;let s=(0,gt.jsx)(Gp,{classNames:h,color:a,disableAnimation:o,hideSelectedIcon:c,item:e,state:t,variant:i,...r},n);return e.wrapper&&(s=e.wrapper(s)),s}),u&&(0,gt.jsx)(Ja,{as:"li",className:A.divider({class:b}),...d})]})]},e.key)});qp.displayName="HeroUI.ListboxSection";var Wp=qp;function Hp(e,t,n){let r,i=n.initialDeps??[];return()=>{var a,o,s,l;let c;n.key&&(null==(a=n.debug)?void 0:a.call(n))&&(c=Date.now());const u=e(),d=u.length!==i.length||u.some((e,t)=>i[t]!==e);if(!d)return r;let h;if(i=u,n.key&&(null==(o=n.debug)?void 0:o.call(n))&&(h=Date.now()),r=t(...u),n.key&&(null==(s=n.debug)?void 0:s.call(n))){const e=Math.round(100*(Date.now()-c))/100,t=Math.round(100*(Date.now()-h))/100,r=t/16,i=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c\u23f1 ${i(t,5)} /${i(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*r,120))}deg 100% 31%);`,null==n?void 0:n.key)}return null==(l=null==n?void 0:n.onChange)||l.call(n,r),r}}function $p(e,t){if(void 0===e)throw new Error("Unexpected undefined"+(t?`: ${t}`:""));return e}const Kp=(e,t,n)=>{let r;return function(...i){e.clearTimeout(r),r=e.setTimeout(()=>t.apply(this,i),n)}},Xp=e=>e,Yp=e=>{const t=Math.max(e.startIndex-e.overscan,0),n=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let i=t;i<=n;i++)r.push(i);return r},Qp=(e,t)=>{const n=e.scrollElement;if(!n)return;const r=e.targetWindow;if(!r)return;const i=e=>{const{width:n,height:r}=e;t({width:Math.round(n),height:Math.round(r)})};if(i(n.getBoundingClientRect()),!r.ResizeObserver)return()=>{};const a=new r.ResizeObserver(e=>{const t=e[0];if(null==t?void 0:t.borderBoxSize){const e=t.borderBoxSize[0];if(e)return void i({width:e.inlineSize,height:e.blockSize})}i(n.getBoundingClientRect())});return a.observe(n,{box:"border-box"}),()=>{a.unobserve(n)}},Zp={passive:!0},Jp="undefined"==typeof window||"onscrollend"in window,ef=(e,t)=>{const n=e.scrollElement;if(!n)return;const r=e.targetWindow;if(!r)return;let i=0;const a=e.options.useScrollendEvent&&Jp?()=>{}:Kp(r,()=>{t(i,!1)},e.options.isScrollingResetDelay),o=r=>()=>{const{horizontal:o,isRtl:s}=e.options;i=o?n.scrollLeft*(s?-1:1):n.scrollTop,a(),t(i,r)},s=o(!0),l=o(!1);return l(),n.addEventListener("scroll",s,Zp),n.addEventListener("scrollend",l,Zp),()=>{n.removeEventListener("scroll",s),n.removeEventListener("scrollend",l)}},tf=(e,t,n)=>{if(null==t?void 0:t.borderBoxSize){const e=t.borderBoxSize[0];if(e){return Math.round(e[n.options.horizontal?"inlineSize":"blockSize"])}}return Math.round(e.getBoundingClientRect()[n.options.horizontal?"width":"height"])},nf=(e,{adjustments:t=0,behavior:n},r)=>{var i,a;const o=e+t;null==(a=null==(i=r.scrollElement)?void 0:i.scrollTo)||a.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:n})};class rf{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{this._measureElement(e.target,e)})}):null);return{disconnect:()=>{var n;null==(n=t())||n.disconnect(),e=null},observe:e=>{var n;return null==(n=t())?void 0:n.observe(e,{box:"border-box"})},unobserve:e=>{var n;return null==(n=t())?void 0:n.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,n])=>{"undefined"===typeof n&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Xp,rangeExtractor:Yp,onChange:()=>{},measureElement:tf,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!0,...e}},this.notify=e=>{var t,n;null==(n=(t=this.options).onChange)||n.call(t,this,e)},this.maybeNotify=Hp(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"===typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{const n=new Map,r=new Map;for(let i=t-1;i>=0;i--){const t=e[i];if(n.has(t.lane))continue;const a=r.get(t.lane);if(null==a||t.end>a.end?r.set(t.lane,t):t.end<a.end&&n.set(t.lane,!0),n.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=Hp(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,t,n,r,i)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:n,getItemKey:r,enabled:i}),{key:!1}),this.getMeasurements=Hp(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:n,getItemKey:r,enabled:i},a)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const o=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const s=this.measurementsCache.slice(0,o);for(let l=o;l<e;l++){const e=r(l),i=1===this.options.lanes?s[l-1]:this.getFurthestMeasurement(s,l),o=i?i.end+this.options.gap:t+n,c=a.get(e),u="number"===typeof c?c:this.options.estimateSize(l),d=o+u,h=i?i.lane:l%this.options.lanes;s[l]={index:l,start:o,size:u,end:d,key:e,lane:h}}return this.measurementsCache=s,s},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Hp(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset()],(e,t,n)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:n}){const r=e.length-1,i=t=>e[t].start,a=af(0,r,i,n);let o=a;for(;o<r&&e[o].end<n+t;)o++;return{startIndex:a,endIndex:o}}({measurements:e,outerSize:t,scrollOffset:n}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=Hp(()=>{let e=null,t=null;const n=this.calculateRange();return n&&(e=n.startIndex,t=n.endIndex),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,n,r,i)=>null===r||null===i?[]:e({startIndex:r,endIndex:i,overscan:t,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,n=e.getAttribute(t);return n?parseInt(n,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const n=this.indexFromElement(e),r=this.measurementsCache[n];if(!r)return;const i=r.key,a=this.elementsCache.get(i);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected&&this.resizeItem(n,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{const n=this.measurementsCache[e];if(!n)return;const r=t-(this.itemSizeCache.get(n.key)??n.size);0!==r&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(n,r,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=r,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=Hp(()=>[this.getIndexes(),this.getMeasurements()],(e,t)=>{const n=[];for(let r=0,i=e.length;r<i;r++){const i=t[e[r]];n.push(i)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const t=this.getMeasurements();if(0!==t.length)return $p(t[af(0,t.length-1,e=>$p(t[e]).start,e)])},this.getOffsetForAlignment=(e,t)=>{const n=this.getSize(),r=this.getScrollOffset();"auto"===t&&e>=r+n&&(t="end"),"end"===t&&(e-=n);const i=this.options.horizontal?"scrollWidth":"scrollHeight",a=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[i]:this.scrollElement[i]:0)-n;return Math.max(Math.min(a,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const n=this.measurementsCache[e];if(!n)return;const r=this.getSize(),i=this.getScrollOffset();if("auto"===t)if(n.end>=i+r-this.options.scrollPaddingEnd)t="end";else{if(!(n.start<=i+this.options.scrollPaddingStart))return[i,t];t="start"}const a=n.start-this.options.scrollPaddingStart+(n.size-r)/2;switch(t){case"center":return[this.getOffsetForAlignment(a,t),t];case"end":return[this.getOffsetForAlignment(n.end+this.options.scrollPaddingEnd,t),t];default:return[this.getOffsetForAlignment(n.start-this.options.scrollPaddingStart,t),t]}},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{null!==this.scrollToIndexTimeoutId&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:t="start",behavior:n}={})=>{this.cancelScrollToIndex(),"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:n})},this.scrollToIndex=(e,{align:t="auto",behavior:n}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const r=this.getOffsetForIndex(e,t);if(!r)return;const[i,a]=r;this._scrollToOffset(i,{adjustments:void 0,behavior:n}),"smooth"!==n&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{this.scrollToIndexTimeoutId=null;if(this.elementsCache.has(this.options.getItemKey(e))){const[t]=$p(this.getOffsetForIndex(e,a));((e,t)=>Math.abs(e-t)<1)(t,this.getScrollOffset())||this.scrollToIndex(e,{align:a,behavior:n})}else this.scrollToIndex(e,{align:a,behavior:n})}))},this.scrollBy=(e,{behavior:t}={})=>{this.cancelScrollToIndex(),"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;const t=this.getMeasurements();let n;return n=0===t.length?this.options.paddingStart:1===this.options.lanes?(null==(e=t[t.length-1])?void 0:e.end)??0:Math.max(...t.slice(-this.options.lanes).map(e=>e.end)),Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const af=(e,t,n,r)=>{for(;e<=t;){const i=(e+t)/2|0,a=n(i);if(a<r)e=i+1;else{if(!(a>r))return i;t=i-1}}return e>0?e-1:0};const of="undefined"!==typeof document?r.useLayoutEffect:r.useEffect;function sf(e){const t=r.useReducer(()=>({}),{})[1],n={...e,onChange:(n,r)=>{var i;r?(0,Ca.flushSync)(t):t(),null==(i=e.onChange)||i.call(e,n,r)}},[i]=r.useState(()=>new rf(n));return i.setOptions(n),of(()=>i._didMount(),[]),of(()=>i._willUpdate()),i}var lf=(0,On.tv)({base:[],variants:{orientation:{vertical:["overflow-y-auto","data-[top-scroll=true]:[mask-image:linear-gradient(0deg,#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]","data-[bottom-scroll=true]:[mask-image:linear-gradient(180deg,#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]","data-[top-bottom-scroll=true]:[mask-image:linear-gradient(#000,#000,transparent_0,#000_var(--scroll-shadow-size),#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]"],horizontal:["overflow-x-auto","data-[left-scroll=true]:[mask-image:linear-gradient(270deg,#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]","data-[right-scroll=true]:[mask-image:linear-gradient(90deg,#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]","data-[left-right-scroll=true]:[mask-image:linear-gradient(to_right,#000,#000,transparent_0,#000_var(--scroll-shadow-size),#000_calc(100%_-_var(--scroll-shadow-size)),transparent)]"]},hideScrollBar:{true:"scrollbar-hide",false:""}},defaultVariants:{orientation:"vertical",hideScrollBar:!1}});function cf(e){var t;const[n,i]=(0,Ln.rE)(e,lf.variantKeys),{ref:a,as:o,children:s,className:l,style:c,size:u=40,offset:d=0,visibility:h="auto",isEnabled:p=!0,onVisibilityChange:f,...m}=n,g=o||"div",v=(0,Wa.zD)(a);!function(e={}){const{domRef:t,isEnabled:n=!0,overflowCheck:i="vertical",visibility:a="auto",offset:o=0,onVisibilityChange:s,updateDeps:l=[]}=e,c=(0,r.useRef)(a);(0,r.useEffect)(()=>{const e=null==t?void 0:t.current;if(!e||!n)return;const r=(t,n,r,i,o)=>{if("auto"===a){const t=`${i}${(0,In.ZH)(o)}Scroll`;n&&r?(e.dataset[t]="true",e.removeAttribute(`data-${i}-scroll`),e.removeAttribute(`data-${o}-scroll`)):(e.dataset[`${i}Scroll`]=n.toString(),e.dataset[`${o}Scroll`]=r.toString(),e.removeAttribute(`data-${i}-${o}-scroll`))}else{const e=n&&r?"both":n?i:r?o:"none";e!==c.current&&(null==s||s(e),c.current=e)}},l=()=>{var t,n;const a=[{type:"vertical",prefix:"top",suffix:"bottom"},{type:"horizontal",prefix:"left",suffix:"right"}],s=e.querySelector('ul[data-slot="list"]'),l=+(null!=(t=null==s?void 0:s.getAttribute("data-virtual-scroll-height"))?t:e.scrollHeight),c=+(null!=(n=null==s?void 0:s.getAttribute("data-virtual-scroll-top"))?n:e.scrollTop);for(const{type:u,prefix:d,suffix:h}of a)if(i===u||"both"===i){const t="vertical"===u?c>o:e.scrollLeft>o,n="vertical"===u?c+e.clientHeight+o<l:e.scrollLeft+e.clientWidth+o<e.scrollWidth;r(0,t,n,d,h)}},u=()=>{["top","bottom","top-bottom","left","right","left-right"].forEach(t=>{e.removeAttribute(`data-${t}-scroll`)})};return l(),e.addEventListener("scroll",l,!0),"auto"!==a&&(u(),"both"===a?(e.dataset.topBottomScroll=String("vertical"===i),e.dataset.leftRightScroll=String("horizontal"===i)):(e.dataset.topBottomScroll="false",e.dataset.leftRightScroll="false",["top","bottom","left","right"].forEach(t=>{e.dataset[`${t}Scroll`]=String(a===t)}))),()=>{e.removeEventListener("scroll",l,!0),u()}},[...l,n,a,i,s,t])}({domRef:v,offset:d,visibility:h,isEnabled:p,onVisibilityChange:f,updateDeps:[s],overflowCheck:null!=(t=e.orientation)?t:"vertical"});const A=(0,r.useMemo)(()=>lf({...i,className:l}),[(0,In.t6)(i),l]);return{Component:g,styles:A,domRef:v,children:s,getBaseProps:(t={})=>{var n;return{ref:v,className:A,"data-orientation":null!=(n=e.orientation)?n:"vertical",style:{"--scroll-shadow-size":`${u}px`,...c,...t.style},...m,...t}}}}var uf=e=>{var t;const{Component:n,state:i,color:a,variant:o,itemClasses:s,getBaseProps:l,topContent:c,bottomContent:u,hideEmptyContent:d,hideSelectedIcon:h,shouldHighlightOnFocus:p,disableAnimation:f,getEmptyContentProps:m,getListProps:g,scrollShadowProps:v}=e,{virtualization:A}=e;if(!A||!(0,In.Im)(A)&&!A.maxListboxHeight&&!A.itemHeight)throw new Error("You are using a virtualized listbox. VirtualizedListbox requires 'virtualization' props with 'maxListboxHeight' and 'itemHeight' properties. This error might have originated from autocomplete components that use VirtualizedListbox. Please provide these props to use the virtualized listbox.");const{maxListboxHeight:y,itemHeight:b}=A,x=Math.min(y,b*i.collection.size),_=(0,r.useRef)(null),w=(0,r.useMemo)(()=>((e,t)=>{const n=[];for(const r of e)"section"===r.type?n.push(([...r.childNodes].length+1)*t):n.push(t);return n})([...i.collection],b),[i.collection,b]),S=(T={count:[...i.collection].length,getScrollElement:()=>_.current,estimateSize:e=>w[e]},sf({observeElementRect:Qp,observeElementOffset:ef,scrollToFn:nf,...T}));var T;const C=S.getVirtualItems(),M=S.getTotalSize(),{getBaseProps:E}=cf({...v}),[P,N]=(0,r.useState)({isTop:!1,isBottom:!0,isMiddle:!1}),k=(0,gt.jsxs)(n,{...g(),"data-virtual-scroll-height":M,"data-virtual-scroll-top":null==(t=null==_?void 0:_.current)?void 0:t.scrollTop,children:[!i.collection.size&&!d&&(0,gt.jsx)("li",{children:(0,gt.jsx)("div",{...m()})}),(0,gt.jsx)("div",{...(0,Xa.$)(E()),ref:_,style:{height:y,overflow:"auto"},onScroll:e=>{N((e=>{if(!e||void 0===e.scrollTop||void 0===e.clientHeight||void 0===e.scrollHeight)return{isTop:!1,isBottom:!1,isMiddle:!1};const t=0===e.scrollTop,n=Math.ceil(e.scrollTop+e.clientHeight)>=e.scrollHeight;return{isTop:t,isBottom:n,isMiddle:!t&&!n}})(e.target))},children:x>0&&b>0&&(0,gt.jsx)("div",{style:{height:`${M}px`,width:"100%",position:"relative"},children:C.map(e=>(e=>{var t;const n=[...i.collection][e.index];if(!n)return null;const r={color:a,item:n,state:i,variant:o,disableAnimation:f,hideSelectedIcon:h,...n.props},l={position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`};if("section"===n.type)return(0,gt.jsx)(Wp,{...r,itemClasses:s,style:{...l,...r.style}},n.key);let c=(0,gt.jsx)(Gp,{...r,classNames:(0,In.v6)(s,null==(t=n.props)?void 0:t.classNames),shouldHighlightOnFocus:p,style:{...l,...r.style}},n.key);return n.wrapper&&(c=n.wrapper(c)),c})(e))})})]});return(0,gt.jsxs)("div",{...l(),children:[c,k,u]})},df=(0,Ln.Rf)(function(e,t){const{isVirtualized:n,...r}=e,i=Fp({...r,ref:t}),{Component:a,state:o,color:s,variant:l,itemClasses:c,getBaseProps:u,topContent:d,bottomContent:h,hideEmptyContent:p,hideSelectedIcon:f,shouldHighlightOnFocus:m,disableAnimation:g,getEmptyContentProps:v,getListProps:A}=i;if(n)return(0,gt.jsx)(uf,{...e,...i});const y=(0,gt.jsxs)(a,{...A(),children:[!o.collection.size&&!p&&(0,gt.jsx)("li",{children:(0,gt.jsx)("div",{...v()})}),[...o.collection].map(e=>{var t;const n={color:s,item:e,state:o,variant:l,disableAnimation:g,hideSelectedIcon:f,...e.props};if("section"===e.type)return(0,gt.jsx)(Wp,{...n,itemClasses:c},e.key);let r=(0,gt.jsx)(Gp,{...n,classNames:(0,In.v6)(c,null==(t=e.props)?void 0:t.classNames),shouldHighlightOnFocus:m},e.key);return e.wrapper&&(r=e.wrapper(r)),r})]});return(0,gt.jsxs)("div",{...u(),children:[d,y,h]})}),hf=df,pf=n(2425),ff=n(6280),mf=()=>n.e(707).then(n.bind(n,5707)).then(e=>e.default),gf=(0,Ln.Rf)(({children:e,motionProps:t,placement:n,disableAnimation:r,style:i={},transformOrigin:a={},...o},s)=>{let l=i;return void 0!==a.originX||void 0!==a.originY?l={...l,transformOrigin:a}:n&&(l={...l,...(0,ff.kn)("center"===n?"top":n)}),r?(0,gt.jsx)("div",{...o,ref:s,children:e}):(0,gt.jsx)(md.F,{features:mf,children:(0,gt.jsx)(gd.m.div,{ref:s,animate:"enter",exit:"exit",initial:"initial",style:l,variants:dd.zF.scaleSpringOpacity,...(0,In.v6)(o,t),children:e})})});gf.displayName="HeroUI.FreeSoloPopoverWrapper";var vf=(0,Ln.Rf)(({children:e,transformOrigin:t,disableDialogFocus:n=!1,...i},a)=>{const{Component:o,state:s,placement:l,backdrop:c,portalContainer:u,disableAnimation:d,motionProps:h,isNonModal:p,getPopoverProps:f,getBackdropProps:m,getDialogProps:g,getContentProps:v}=(0,pf.f)({...i,ref:a}),A=r.useRef(null),{dialogProps:y,titleProps:b}=(0,vd.s)({},A),x=g({...!n&&{ref:A},...y}),_=r.useMemo(()=>"transparent"===c?null:d?(0,gt.jsx)("div",{...m()}):(0,gt.jsx)(md.F,{features:mf,children:(0,gt.jsx)(gd.m.div,{animate:"enter",exit:"exit",initial:"exit",variants:dd.zF.fade,...m()})}),[c,d,m]);return(0,gt.jsxs)(Zu.hJ,{portalContainer:u,children:[!p&&_,(0,gt.jsx)(o,{...f(),children:(0,gt.jsxs)(gf,{disableAnimation:d,motionProps:h,placement:l,tabIndex:-1,transformOrigin:t,...x,children:[!p&&(0,gt.jsx)(pd.R,{onDismiss:s.close}),(0,gt.jsx)("div",{...v(),children:"function"===typeof e?e(b):e}),(0,gt.jsx)(pd.R,{onDismiss:s.close})]})})]})});vf.displayName="HeroUI.FreeSoloPopover";var Af=vf,yf=({strokeWidth:e=1.5,...t})=>(0,gt.jsx)("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",role:"presentation",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,viewBox:"0 0 24 24",width:"1em",...t,children:(0,gt.jsx)("path",{d:"m6 9 6 6 6-6"})});function bf(e){var t;const[n,i]=(0,Ln.rE)(e,lf.variantKeys),{ref:a,as:o,children:s,className:l,style:c,size:u=40,offset:d=0,visibility:h="auto",isEnabled:p=!0,onVisibilityChange:f,...m}=n,g=o||"div",v=(0,Wa.zD)(a);!function(e={}){const{domRef:t,isEnabled:n=!0,overflowCheck:i="vertical",visibility:a="auto",offset:o=0,onVisibilityChange:s,updateDeps:l=[]}=e,c=(0,r.useRef)(a);(0,r.useEffect)(()=>{const e=null==t?void 0:t.current;if(!e||!n)return;const r=(t,n,r,i,o)=>{if("auto"===a){const t=`${i}${(0,In.ZH)(o)}Scroll`;n&&r?(e.dataset[t]="true",e.removeAttribute(`data-${i}-scroll`),e.removeAttribute(`data-${o}-scroll`)):(e.dataset[`${i}Scroll`]=n.toString(),e.dataset[`${o}Scroll`]=r.toString(),e.removeAttribute(`data-${i}-${o}-scroll`))}else{const e=n&&r?"both":n?i:r?o:"none";e!==c.current&&(null==s||s(e),c.current=e)}},l=()=>{var t,n;const a=[{type:"vertical",prefix:"top",suffix:"bottom"},{type:"horizontal",prefix:"left",suffix:"right"}],s=e.querySelector('ul[data-slot="list"]'),l=+(null!=(t=null==s?void 0:s.getAttribute("data-virtual-scroll-height"))?t:e.scrollHeight),c=+(null!=(n=null==s?void 0:s.getAttribute("data-virtual-scroll-top"))?n:e.scrollTop);for(const{type:u,prefix:d,suffix:h}of a)if(i===u||"both"===i){const t="vertical"===u?c>o:e.scrollLeft>o,n="vertical"===u?c+e.clientHeight+o<l:e.scrollLeft+e.clientWidth+o<e.scrollWidth;r(0,t,n,d,h)}},u=()=>{["top","bottom","top-bottom","left","right","left-right"].forEach(t=>{e.removeAttribute(`data-${t}-scroll`)})};return l(),e.addEventListener("scroll",l,!0),"auto"!==a&&(u(),"both"===a?(e.dataset.topBottomScroll=String("vertical"===i),e.dataset.leftRightScroll=String("horizontal"===i)):(e.dataset.topBottomScroll="false",e.dataset.leftRightScroll="false",["top","bottom","left","right"].forEach(t=>{e.dataset[`${t}Scroll`]=String(a===t)}))),()=>{e.removeEventListener("scroll",l,!0),u()}},[...l,n,a,i,s,t])}({domRef:v,offset:d,visibility:h,isEnabled:p,onVisibilityChange:f,updateDeps:[s],overflowCheck:null!=(t=e.orientation)?t:"vertical"});const A=(0,r.useMemo)(()=>lf({...i,className:l}),[(0,In.t6)(i),l]);return{Component:g,styles:A,domRef:v,children:s,getBaseProps:(t={})=>{var n;return{ref:v,className:A,"data-orientation":null!=(n=e.orientation)?n:"vertical",style:{"--scroll-shadow-size":`${u}px`,...c,...t.style},...m,...t}}}}var xf=(0,Ln.Rf)((e,t)=>{const{Component:n,children:r,getBaseProps:i}=bf({...e,ref:t});return(0,gt.jsx)(n,{...i(),children:r})});xf.displayName="HeroUI.ScrollShadow";var _f=xf,wf=(0,Ln.Rf)(function(e,t){var n;const{Component:i,state:a,label:o,hasHelper:s,isLoading:l,triggerRef:c,selectorIcon:u=(0,gt.jsx)(yf,{}),description:d,errorMessage:h,isInvalid:p,startContent:f,endContent:m,placeholder:g,renderValue:v,shouldLabelBeOutside:A,disableAnimation:y,getBaseProps:b,getLabelProps:x,getTriggerProps:_,getValueProps:w,getListboxProps:S,getPopoverProps:T,getSpinnerProps:C,getMainWrapperProps:M,getInnerWrapperProps:E,getHiddenSelectProps:P,getHelperWrapperProps:N,getListboxWrapperProps:k,getDescriptionProps:R,getErrorMessageProps:L,getSelectorIconProps:O,isClearable:j,getClearButtonProps:D,getEndWrapperProps:I,getEndContentProps:B}=Pp({...e,ref:t}),F=o?(0,gt.jsx)("label",{...x(),children:o}):null,z=(0,r.cloneElement)(u,O()),U=(0,r.useMemo)(()=>{var e;return j&&(null==(e=a.selectedItems)?void 0:e.length)?(0,gt.jsx)("span",{...D(),children:(0,gt.jsx)(Zs,{})}):null},[j,D,null==(n=a.selectedItems)?void 0:n.length]),V=(0,r.useMemo)(()=>U?(0,gt.jsxs)("div",{...I(),children:[U,m&&(0,gt.jsx)("span",{...B(),children:m})]}):m&&(0,gt.jsx)("span",{...B(),children:m}),[U,m,I,B]),G=(0,r.useMemo)(()=>{const e=p&&h;return s&&(e||d)?(0,gt.jsx)("div",{...N(),children:e?(0,gt.jsx)("div",{...L(),children:h}):(0,gt.jsx)("div",{...R(),children:d})}):null},[s,p,h,d,N,L,R]),q=(0,r.useMemo)(()=>{var e;if(!(null==(e=a.selectedItems)?void 0:e.length))return g;if(v&&"function"===typeof v){const e=[...a.selectedItems].map(e=>({key:e.key,data:e.value,type:e.type,props:e.props,textValue:e.textValue,rendered:e.rendered,"aria-label":e["aria-label"]}));return v(e)}return a.selectedItems.map(e=>e.textValue).join(", ")},[a.selectedItems,v,g]),W=(0,r.useMemo)(()=>l?(0,gt.jsx)(np.o,{...C()}):z,[l,z,C]),H=(0,r.useMemo)(()=>a.isOpen?(0,gt.jsx)(Af,{...T(),children:(0,gt.jsx)(_f,{...k(),children:(0,gt.jsx)(hf,{...S()})})}):null,[a.isOpen,T,a,c,k,S]);return(0,gt.jsxs)("div",{...b(),children:[(0,gt.jsx)(jp,{...P()}),A?F:null,(0,gt.jsxs)("div",{...M(),children:[(0,gt.jsxs)(i,{..._(),children:[A?null:F,(0,gt.jsxs)("div",{...E(),children:[f,(0,gt.jsx)("span",{...w(),children:q}),m&&a.selectedItems&&(0,gt.jsx)(Rp.s,{elementType:"span",children:","}),V]}),W]}),G]}),y?H:(0,gt.jsx)(ld.N,{children:H})]})}),Sf=wf,Tf=Ys;function Cf(e,t,n){let i=(0,vs.J)(()=>{n&&n(t)});(0,r.useEffect)(()=>{var t;let n=null===e||void 0===e||null===(t=e.current)||void 0===t?void 0:t.form;return null===n||void 0===n||n.addEventListener("reset",i),()=>{null===n||void 0===n||n.removeEventListener("reset",i)}},[e])}var Mf=n(8603);function Ef(e){var t,n,i,a,o,s,l;const c=(0,Bn.o)(),{validationBehavior:u}=Sp(Mp)||{},[d,h]=(0,Ln.rE)(e,qa.hF.variantKeys),{ref:p,as:f,type:m,label:g,baseRef:v,wrapperRef:A,description:y,className:b,classNames:x,autoFocus:_,startContent:w,endContent:S,onClear:T,onChange:C,validationState:M,validationBehavior:E=(null!=(t=null!=u?u:null==c?void 0:c.validationBehavior)?t:"native"),innerWrapperRef:P,onValueChange:N=()=>{},...k}=d,R=(0,r.useCallback)(e=>{N(null!=e?e:"")},[N]),[L,O]=(0,r.useState)(!1),j=f||"div",D=null!=(i=null!=(n=e.disableAnimation)?n:null==c?void 0:c.disableAnimation)&&i,I=(0,Wa.zD)(p),B=(0,Wa.zD)(v),F=(0,Wa.zD)(A),z=(0,Wa.zD)(P),[U,V]=(0,Os.P)(d.value,null!=(a=d.defaultValue)?a:"",R),G="file"===m,q=(null!=(l=null==(s=null==(o=null==I?void 0:I.current)?void 0:o.files)?void 0:s.length)?l:0)>0,W=["date","time","month","week","range"].includes(m),H=!(0,In.Im)(U)||W||q,$=H||L,K="hidden"===m,X=e.isMultiline,Y=(0,Dn.cn)(null==x?void 0:x.base,b,H?"is-filled":""),Q=(0,r.useCallback)(()=>{var e;G?I.current.value="":V(""),null==T||T(),null==(e=I.current)||e.focus()},[V,T,G]);(0,_p.U)(()=>{I.current&&V(I.current.value)},[I.current]);const{labelProps:Z,inputProps:J,isInvalid:ee,validationErrors:te,validationDetails:ne,descriptionProps:re,errorMessageProps:ie}=function(e,t){let{inputElementType:n="input",isDisabled:i=!1,isRequired:a=!1,isReadOnly:o=!1,type:s="text",validationBehavior:l="aria"}=e,[c,u]=(0,Os.P)(e.value,e.defaultValue||"",e.onChange),{focusableProps:d}=(0,Mf.Wc)(e,t),h=fp({...e,value:c}),{isInvalid:p,validationErrors:f,validationDetails:m}=h.displayValidation,{labelProps:g,fieldProps:v,descriptionProps:A,errorMessageProps:y}=xp({...e,isInvalid:p,errorMessage:e.errorMessage||f}),b=(0,Io.$)(e,{labelable:!0});const x={type:s,pattern:e.pattern};let[_]=(0,r.useState)(c);var w;return Cf(t,null!==(w=e.defaultValue)&&void 0!==w?w:_,u),Lp(e,h,t),{labelProps:g,inputProps:(0,go.v)(b,"input"===n?x:void 0,{disabled:i,readOnly:o,required:a&&"native"===l,"aria-required":a&&"aria"===l||void 0,"aria-invalid":p||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],"aria-controls":e["aria-controls"],value:c,onChange:e=>u(e.target.value),autoComplete:e.autoComplete,autoCapitalize:e.autoCapitalize,maxLength:e.maxLength,minLength:e.minLength,name:e.name,form:e.form,placeholder:e.placeholder,inputMode:e.inputMode,autoCorrect:e.autoCorrect,spellCheck:e.spellCheck,[parseInt(r.version,10)>=17?"enterKeyHint":"enterkeyhint"]:e.enterKeyHint,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput,...d,...v}),descriptionProps:A,errorMessageProps:y,isInvalid:p,validationErrors:f,validationDetails:m}}({...e,validationBehavior:E,autoCapitalize:e.autoCapitalize,value:U,"aria-label":e.label?e["aria-label"]:(0,In.j1)(e["aria-label"],e.placeholder),inputElementType:X?"textarea":"input",onChange:V},I);G&&(delete J.value,delete J.onChange);const{isFocusVisible:ae,isFocused:oe,focusProps:se}=(0,Oo.o)({autoFocus:_,isTextInput:!0}),{isHovered:le,hoverProps:ce}=(0,qo.M)({isDisabled:!!(null==e?void 0:e.isDisabled)}),{isHovered:ue,hoverProps:de}=(0,qo.M)({isDisabled:!!(null==e?void 0:e.isDisabled)}),{focusProps:he,isFocusVisible:pe}=(0,Oo.o)(),{focusWithinProps:fe}=(0,Bp.R)({onFocusWithinChange:O}),{pressProps:me}=(0,lo.d)({isDisabled:!!(null==e?void 0:e.isDisabled)||!!(null==e?void 0:e.isReadOnly),onPress:Q}),ge="invalid"===M||ee,ve=ap({labelPlacement:e.labelPlacement,label:g}),Ae="function"===typeof d.errorMessage?d.errorMessage({isInvalid:ge,validationErrors:te,validationDetails:ne}):d.errorMessage||(null==te?void 0:te.join(" ")),ye=!!T||e.isClearable,be=!!g||!!y||!!Ae,xe=!!d.placeholder,_e=!!g,we=!!y||!!Ae,Se="outside-left"===ve,Te="outside-top"===ve,Ce="outside"===ve||Se||Te,Me="inside"===ve,Ee=!!I.current&&((!I.current.value||""===I.current.value||!U||""===U)&&xe),Pe=!!w,Ne=!!Ce&&(Se||Te||xe||"outside"===ve&&Pe),ke="outside"===ve&&!xe&&!Pe,Re=(0,r.useMemo)(()=>(0,qa.hF)({...h,isInvalid:ge,labelPlacement:ve,isClearable:ye,disableAnimation:D}),[(0,In.t6)(h),ge,ve,ye,Pe,D]),Le=(0,r.useCallback)((t={})=>({ref:B,className:Re.base({class:Y}),"data-slot":"base","data-filled":(0,In.sE)(H||xe||Pe||Ee||G),"data-filled-within":(0,In.sE)($||xe||Pe||Ee||G),"data-focus-within":(0,In.sE)(L),"data-focus-visible":(0,In.sE)(ae),"data-readonly":(0,In.sE)(e.isReadOnly),"data-focus":(0,In.sE)(oe),"data-hover":(0,In.sE)(le||ue),"data-required":(0,In.sE)(e.isRequired),"data-invalid":(0,In.sE)(ge),"data-disabled":(0,In.sE)(e.isDisabled),"data-has-elements":(0,In.sE)(be),"data-has-helper":(0,In.sE)(we),"data-has-label":(0,In.sE)(_e),"data-has-value":(0,In.sE)(!Ee),"data-hidden":(0,In.sE)(K),...fe,...t}),[Re,Y,H,oe,le,ue,ge,we,_e,be,Ee,Pe,L,ae,$,xe,fe,K,e.isReadOnly,e.isRequired,e.isDisabled]),Oe=(0,r.useCallback)((e={})=>({"data-slot":"label",className:Re.label({class:null==x?void 0:x.label}),...(0,In.v6)(Z,de,e)}),[Re,ue,Z,null==x?void 0:x.label]),je=(0,r.useCallback)(t=>{"Escape"===t.key&&U&&(ye||T)&&!e.isReadOnly&&(V(""),null==T||T())},[U,V,T,ye,e.isReadOnly]),De=(0,r.useCallback)((t={})=>({"data-slot":"input","data-filled":(0,In.sE)(H),"data-filled-within":(0,In.sE)($),"data-has-start-content":(0,In.sE)(Pe),"data-has-end-content":(0,In.sE)(!!S),"data-type":m,className:Re.input({class:(0,Dn.cn)(null==x?void 0:x.input,H?"is-filled":"",X?"pe-0":"","password"===m?"[&::-ms-reveal]:hidden":"")}),...(0,In.v6)(se,J,(0,Xa.$)(k,{enabled:!0,labelable:!0,omitEventNames:new Set(Object.keys(J))}),t),"aria-readonly":(0,In.sE)(e.isReadOnly),onChange:(0,In.cy)(J.onChange,C),onKeyDown:(0,In.cy)(J.onKeyDown,t.onKeyDown,je),ref:I}),[Re,U,se,J,k,H,$,Pe,S,null==x?void 0:x.input,e.isReadOnly,e.isRequired,C,je]),Ie=(0,r.useCallback)((e={})=>({ref:F,"data-slot":"input-wrapper","data-hover":(0,In.sE)(le||ue),"data-focus-visible":(0,In.sE)(ae),"data-focus":(0,In.sE)(oe),className:Re.inputWrapper({class:(0,Dn.cn)(null==x?void 0:x.inputWrapper,H?"is-filled":"")}),...(0,In.v6)(e,ce),onClick:e=>{I.current&&e.currentTarget===e.target&&I.current.focus()},style:{cursor:"text",...e.style}}),[Re,le,ue,ae,oe,U,null==x?void 0:x.inputWrapper]),Be=(0,r.useCallback)((e={})=>({...e,ref:z,"data-slot":"inner-wrapper",onClick:e=>{I.current&&e.currentTarget===e.target&&I.current.focus()},className:Re.innerWrapper({class:(0,Dn.cn)(null==x?void 0:x.innerWrapper,null==e?void 0:e.className)})}),[Re,null==x?void 0:x.innerWrapper]),Fe=(0,r.useCallback)((e={})=>({...e,"data-slot":"main-wrapper",className:Re.mainWrapper({class:(0,Dn.cn)(null==x?void 0:x.mainWrapper,null==e?void 0:e.className)})}),[Re,null==x?void 0:x.mainWrapper]),ze=(0,r.useCallback)((e={})=>({...e,"data-slot":"helper-wrapper",className:Re.helperWrapper({class:(0,Dn.cn)(null==x?void 0:x.helperWrapper,null==e?void 0:e.className)})}),[Re,null==x?void 0:x.helperWrapper]),Ue=(0,r.useCallback)((e={})=>({...e,...re,"data-slot":"description",className:Re.description({class:(0,Dn.cn)(null==x?void 0:x.description,null==e?void 0:e.className)})}),[Re,null==x?void 0:x.description]),Ve=(0,r.useCallback)((e={})=>({...e,...ie,"data-slot":"error-message",className:Re.errorMessage({class:(0,Dn.cn)(null==x?void 0:x.errorMessage,null==e?void 0:e.className)})}),[Re,ie,null==x?void 0:x.errorMessage]),Ge=(0,r.useCallback)((t={})=>({...t,type:"button",tabIndex:-1,disabled:e.isDisabled,"aria-label":"clear input","data-slot":"clear-button","data-focus-visible":(0,In.sE)(pe),className:Re.clearButton({class:(0,Dn.cn)(null==x?void 0:x.clearButton,null==t?void 0:t.className)}),...(0,In.v6)(me,he)}),[Re,pe,me,he,null==x?void 0:x.clearButton]);return{Component:j,classNames:x,domRef:I,label:g,description:y,startContent:w,endContent:S,labelPlacement:ve,isClearable:ye,hasHelper:we,hasStartContent:Pe,isLabelOutside:Ne,isOutsideLeft:Se,isOutsideTop:Te,isLabelOutsideAsPlaceholder:ke,shouldLabelBeOutside:Ce,shouldLabelBeInside:Me,hasPlaceholder:xe,isInvalid:ge,errorMessage:Ae,getBaseProps:Le,getLabelProps:Oe,getInputProps:De,getMainWrapperProps:Fe,getInputWrapperProps:Ie,getInnerWrapperProps:Be,getHelperWrapperProps:ze,getDescriptionProps:Ue,getErrorMessageProps:Ve,getClearButtonProps:Ge}}var Pf=(0,Ln.Rf)((e,t)=>{const{Component:n,label:i,description:a,isClearable:o,startContent:s,endContent:l,labelPlacement:c,hasHelper:u,isOutsideLeft:d,isOutsideTop:h,shouldLabelBeOutside:p,errorMessage:f,isInvalid:m,getBaseProps:g,getLabelProps:v,getInputProps:A,getInnerWrapperProps:y,getInputWrapperProps:b,getMainWrapperProps:x,getHelperWrapperProps:_,getDescriptionProps:w,getErrorMessageProps:S,getClearButtonProps:T}=Ef({...e,ref:t}),C=i?(0,gt.jsx)("label",{...v(),children:i}):null,M=(0,r.useMemo)(()=>o?(0,gt.jsx)("button",{...T(),children:l||(0,gt.jsx)(Zs,{})}):l,[o,T]),E=(0,r.useMemo)(()=>{const e=m&&f;return u&&(e||a)?(0,gt.jsx)("div",{..._(),children:e?(0,gt.jsx)("div",{...S(),children:f}):(0,gt.jsx)("div",{...w(),children:a})}):null},[u,m,f,a,_,S,w]),P=(0,r.useMemo)(()=>(0,gt.jsxs)("div",{...y(),children:[s,(0,gt.jsx)("input",{...A()}),M]}),[s,M,A,y]),N=(0,r.useMemo)(()=>p?(0,gt.jsxs)("div",{...x(),children:[(0,gt.jsxs)("div",{...b(),children:[d||h?null:C,P]}),E]}):(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsxs)("div",{...b(),children:[C,P]}),E]}),[c,E,p,C,P,f,a,x,b,S,w]);return(0,gt.jsxs)(n,{...g(),children:[d||h?C:null,N]})});Pf.displayName="HeroUI.Input";var Nf=Pf;const kf=$n("disc-3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M6 12c0-1.7.7-3.2 1.8-4.2",key:"oqkarx"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M18 12c0 1.7-.7 3.2-1.8 4.2",key:"1eah9h"}]]),Rf=$n("flask-conical",[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]]),Lf=$n("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Of=$n("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),jf=$n("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),Df=$n("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),If=$n("store",[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]]),Bf=$n("beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]),Ff={base:"bg-transparent",mainWrapper:"bg-transparent",inputWrapper:"h-10 min-h-10 bg-transparent shadow-none",innerWrapper:"bg-transparent",input:"text-zinc-900 dark:text-zinc-100"},zf={base:"bg-transparent",mainWrapper:"bg-transparent",inputWrapper:"h-10 min-h-10 bg-transparent shadow-none",innerWrapper:"bg-transparent",input:"text-zinc-900 dark:text-zinc-100 dark:[color-scheme:dark]"},Uf={base:"bg-transparent",trigger:"h-10 min-h-10 bg-transparent shadow-none",value:"text-sm truncate text-zinc-900 dark:text-zinc-100",selectorIcon:"right-2 text-zinc-500 dark:text-zinc-400",listbox:"bg-white dark:bg-zinc-800",popoverContent:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700"},Vf={classNames:{content:"min-w-[180px] bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-lg"}},Gf={itemClasses:{base:"text-zinc-900 dark:text-zinc-100 data-[hover=true]:bg-zinc-100 dark:data-[hover=true]:bg-zinc-700 data-[selected=true]:bg-primary/20 data-[selected=true]:text-primary data-[focus=true]:bg-zinc-100 dark:data-[focus=true]:bg-zinc-700"}},qf=[{key:"in_stock",label:"In Stock",icon:rp,color:"success"},{key:"loaded",label:"Loaded",icon:Ia,color:"primary"},{key:"shot",label:"Shot",icon:kf,color:"warning"},{key:"sent_to_lab",label:"Sent to Lab",icon:Rf,color:"secondary"},{key:"developed",label:"Developed",icon:Lf,color:"success"},{key:"archived",label:"Archived",icon:Of,color:"default"}],Wf=["C-41","E-6","BW","ECN-2"];function Hf({icon:e,children:t}){return(0,gt.jsxs)("div",{className:"flex items-center gap-2.5 mt-4 mb-2",children:[(0,gt.jsx)("div",{className:"w-6 h-6 rounded-md bg-primary/10 flex items-center justify-center",children:(0,gt.jsx)(e,{size:13,className:"text-primary"})}),(0,gt.jsx)("span",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:t}),(0,gt.jsx)("div",{className:"flex-1 h-px bg-divider/50 ml-1"})]})}function $f({item:e,isOpen:t,onClose:n,onUpdated:i}){const a={status:"in_stock",label:"",loaded_camera:"",camera_equip_id:null,purchase_price:"",purchase_shipping_share:"",purchase_date:"",expiry_date:"",batch_number:"",purchase_channel:"",purchase_vendor:"",purchase_order_id:"",purchase_note:"",loaded_date:"",finished_date:"",develop_lab:"",develop_process:"",develop_price:"",develop_shipping:"",develop_channel:"",develop_date:"",sent_to_lab_at:"",scan_date:"",develop_note:""},[o,s]=(0,r.useState)(a),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{var t,n,r,i;e?(s({status:e.status||"in_stock",label:e.label||"",loaded_camera:e.loaded_camera||"",camera_equip_id:e.camera_equip_id||null,purchase_price:null!==(t=e.purchase_price)&&void 0!==t?t:"",purchase_shipping_share:null!==(n=e.purchase_shipping_share)&&void 0!==n?n:"",purchase_date:e.purchase_date||"",expiry_date:e.expiry_date||"",batch_number:e.batch_number||"",purchase_channel:e.purchase_channel||"",purchase_vendor:e.purchase_vendor||"",purchase_order_id:e.purchase_order_id||"",purchase_note:e.purchase_note||"",loaded_date:e.loaded_date||"",finished_date:e.finished_date||"",develop_lab:e.develop_lab||"",develop_process:e.develop_process||"",develop_price:null!==(r=e.develop_price)&&void 0!==r?r:"",develop_shipping:null!==(i=e.develop_shipping)&&void 0!==i?i:"",develop_channel:e.develop_channel||"",develop_date:e.develop_date||"",sent_to_lab_at:e.sent_to_lab_at||"",scan_date:e.scan_date||"",develop_note:e.develop_note||""}),d(null)):s(a)},[e]);const h=(e,t)=>{s(n=>({...n,[e]:t}))},p=["sent_to_lab","developed","archived"].includes(o.status),f=["loaded","shot","sent_to_lab","developed","archived"].includes(o.status);return(0,gt.jsxs)(Od,{isOpen:t,onClose:n,size:"lg",title:`Edit Film Item #${(null===e||void 0===e?void 0:e.id)||""}`,icon:(0,gt.jsx)(zu,{size:18}),footer:(0,gt.jsxs)("div",{className:"flex gap-2 w-full justify-end",children:[(0,gt.jsx)(La.T,{variant:"flat",onPress:n,size:"sm",children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:async()=>{if(!l&&e){c(!0),d(null);try{const t={...o};""!==t.purchase_price&&(t.purchase_price=Number(t.purchase_price)),""!==t.purchase_shipping_share&&(t.purchase_shipping_share=Number(t.purchase_shipping_share)),""!==t.develop_price&&(t.develop_price=Number(t.develop_price)),""!==t.develop_shipping&&(t.develop_shipping=Number(t.develop_shipping));const r=await(0,bn.lm)(e.id,t);if(!r||!1===r.ok)throw new Error(r&&r.error||"Update failed");i&&await i(),n()}catch(t){d(t.message||"Failed to update")}finally{c(!1)}}},isLoading:l,size:"sm",children:"Save Changes"})]}),children:[u&&(0,gt.jsx)("div",{className:"bg-danger-50 dark:bg-danger-900/30 border border-danger-200 dark:border-danger-800 text-danger-700 dark:text-danger-400 px-3 py-2 rounded-lg text-sm mb-4",children:u}),(0,gt.jsxs)("div",{className:"space-y-3",children:[(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Status"}),(0,gt.jsx)(Sf,{selectedKeys:o.status?[o.status]:[],onSelectionChange:e=>h("status",Array.from(e)[0]),size:"sm",variant:"flat",classNames:Uf,style:{maxWidth:"100%"},popoverProps:Vf,listboxProps:Gf,children:qf.map(e=>(0,gt.jsx)(Tf,{textValue:e.label,children:(0,gt.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,gt.jsx)(e.icon,{size:14}),(0,gt.jsx)("span",{children:e.label})]})},e.key))})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Label"}),(0,gt.jsx)(Nf,{value:o.label,onValueChange:e=>h("label",e),placeholder:"Optional label",size:"sm",variant:"bordered",classNames:Ff})]})]}),"loaded"===o.status&&(0,gt.jsxs)("div",{className:"mt-3",children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Loaded Camera"}),(0,gt.jsx)(ar.A,{type:"camera",value:o.camera_equip_id,onChange:(e,t)=>{s(n=>({...n,camera_equip_id:e,loaded_camera:t?`${t.brand} ${t.model}`:""}))},placeholder:"Select camera..."})]})]}),(0,gt.jsx)(Hf,{icon:jf,children:"Purchase Info"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Price"}),(0,gt.jsx)(Nf,{type:"number",step:"0.01",value:o.purchase_price,onValueChange:e=>h("purchase_price",e),placeholder:"0.00",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(Df,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Shipping Share"}),(0,gt.jsx)(Nf,{type:"number",step:"0.01",value:o.purchase_shipping_share,onValueChange:e=>h("purchase_shipping_share",e),placeholder:"0.00",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(Df,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Purchase Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.purchase_date,onValueChange:e=>h("purchase_date",e),size:"sm",variant:"bordered",classNames:zf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Expiry Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.expiry_date,onValueChange:e=>h("expiry_date",e),size:"sm",variant:"bordered",classNames:zf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Batch #"}),(0,gt.jsx)(Nf,{value:o.batch_number,onValueChange:e=>h("batch_number",e),placeholder:"Batch number",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(zd,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Order ID"}),(0,gt.jsx)(Nf,{value:o.purchase_order_id,onValueChange:e=>h("purchase_order_id",e),placeholder:"Order number",size:"sm",variant:"bordered",classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Channel"}),(0,gt.jsx)(Nf,{value:o.purchase_channel,onValueChange:e=>h("purchase_channel",e),placeholder:"Taobao, Amazon, etc.",size:"sm",variant:"bordered",classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Vendor"}),(0,gt.jsx)(Nf,{value:o.purchase_vendor,onValueChange:e=>h("purchase_vendor",e),placeholder:"Store name",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(If,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]})]}),(0,gt.jsxs)("div",{className:"mt-3",children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Purchase Note"}),(0,gt.jsx)(Nf,{value:o.purchase_note,onValueChange:e=>h("purchase_note",e),placeholder:"Additional notes...",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(za,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]})]}),f&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(Hf,{icon:ja,children:"Usage Info"}),(0,gt.jsx)(jd,{className:"p-4",children:(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Loaded Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.loaded_date,onValueChange:e=>h("loaded_date",e),size:"sm",variant:"bordered",classNames:zf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Finished Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.finished_date,onValueChange:e=>h("finished_date",e),size:"sm",variant:"bordered",classNames:zf})]})]})})]}),p&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(Hf,{icon:Bf,children:"Develop Info"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Lab"}),(0,gt.jsx)(Nf,{value:o.develop_lab,onValueChange:e=>h("develop_lab",e),placeholder:"Lab name",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(Rf,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Process"}),(0,gt.jsx)(Sf,{selectedKeys:o.develop_process?[o.develop_process]:[],onSelectionChange:e=>h("develop_process",Array.from(e)[0]||""),size:"sm",variant:"flat",placeholder:"Select process",classNames:Uf,popoverProps:Vf,listboxProps:Gf,children:Wf.map(e=>(0,gt.jsx)(Tf,{textValue:e,children:e},e))})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Dev Price"}),(0,gt.jsx)(Nf,{type:"number",step:"0.01",value:o.develop_price,onValueChange:e=>h("develop_price",e),placeholder:"0.00",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(Df,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Dev Shipping"}),(0,gt.jsx)(Nf,{type:"number",step:"0.01",value:o.develop_shipping,onValueChange:e=>h("develop_shipping",e),placeholder:"0.00",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(Df,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Dev Channel"}),(0,gt.jsx)(Nf,{value:o.develop_channel,onValueChange:e=>h("develop_channel",e),placeholder:"Taobao, direct, etc.",size:"sm",variant:"bordered",classNames:Ff})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Sent Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.sent_to_lab_at,onValueChange:e=>h("sent_to_lab_at",e),size:"sm",variant:"bordered",classNames:zf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Developed Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.develop_date,onValueChange:e=>h("develop_date",e),size:"sm",variant:"bordered",classNames:zf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Scan Date"}),(0,gt.jsx)(Nf,{type:"date",value:o.scan_date,onValueChange:e=>h("scan_date",e),size:"sm",variant:"bordered",classNames:zf})]})]}),(0,gt.jsxs)("div",{className:"mt-3",children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Develop Note"}),(0,gt.jsx)(Nf,{value:o.develop_note,onValueChange:e=>h("develop_note",e),placeholder:"Development notes...",size:"sm",variant:"bordered",startContent:(0,gt.jsx)(za,{size:14,className:"text-zinc-400 dark:text-zinc-500 mr-1"}),classNames:Ff})]})]})]})]})]})}const Kf=$n("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Xf={inputWrapper:"bg-zinc-100 dark:bg-zinc-700/50 border-none shadow-sm",input:"text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-500 dark:placeholder:text-zinc-400"},Yf={inputWrapper:"bg-zinc-100 dark:bg-zinc-700/50 border-none shadow-sm",input:"text-zinc-900 dark:text-zinc-100 [&::-webkit-calendar-picker-indicator]:dark:invert"},Qf={trigger:"bg-zinc-100 dark:bg-zinc-700/50 border-none shadow-sm data-[hover=true]:bg-zinc-200 dark:data-[hover=true]:bg-zinc-600",value:"text-zinc-900 dark:text-zinc-100",selectorIcon:"text-zinc-500 dark:text-zinc-400 absolute right-3",popoverContent:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700"},Zf={classNames:{content:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700"}},Jf={itemClasses:{base:"text-zinc-900 dark:text-zinc-100 data-[hover=true]:bg-zinc-100 dark:data-[hover=true]:bg-zinc-700 data-[selected=true]:bg-primary/20 data-[selected=true]:text-primary data-[focus=true]:bg-zinc-100 dark:data-[focus=true]:bg-zinc-700"}},em=["C-41","E-6","BW","ECN-2"];function tm({item:e,isOpen:t,onClose:n,onLoaded:i}){const[a,o]=(0,r.useState)(""),[s,l]=(0,r.useState)(null),[c,u]=(0,r.useState)((new Date).toISOString().split("T")[0]),[,d]=(0,r.useState)({cameras:[]}),[h,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=!1;return(0,bn.ET)().then(t=>{e||d(t||{cameras:[]})}),()=>{e=!0}},[]);return(0,gt.jsx)(Od,{isOpen:t,onClose:n,size:"md",title:"Load Film into Camera",icon:(0,gt.jsx)(Ia,{size:18}),footer:(0,gt.jsxs)("div",{className:"flex gap-2 w-full justify-end",children:[(0,gt.jsx)(La.T,{variant:"flat",onPress:n,size:"sm",isDisabled:h,children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:async()=>{if(h||!e)return;p(!0);const t={status:"loaded",loaded_camera:a,camera_equip_id:s,loaded_date:c||null};i&&e&&i({ok:!0,optimistic:!0,patch:t,item:{...e,...t}}),n();try{const t=await(0,bn.lm)(e.id,{status:"loaded",loaded_camera:a,camera_equip_id:s,loaded_at:(new Date).toISOString(),loaded_date:c||null});if(!t||!1===t.ok)throw new Error(t&&t.error||"Update failed");i&&await i(t)}catch(r){alert("Failed to load film: "+r.message)}finally{p(!1)}},isLoading:h,size:"sm",children:"Load Film"})]}),children:(0,gt.jsx)("div",{className:"space-y-4",children:(0,gt.jsx)(jd,{className:"p-4",children:(0,gt.jsxs)("div",{className:"space-y-4",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Load Date"}),(0,gt.jsx)(Nf,{type:"date",value:c,onValueChange:u,size:"sm",variant:"flat",classNames:Yf,isRequired:!0})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Camera (Optional)"}),(0,gt.jsx)(ar.A,{type:"camera",value:s,onChange:(e,t)=>{l(e),o(t?`${t.brand} ${t.model}`:"")},placeholder:"Select camera...",disabled:h})]})]})})})})}function nm({item:e,isOpen:t,onClose:n,onUnloaded:i}){const[a,o]=(0,r.useState)((new Date).toISOString().split("T")[0]),[s,l]=(0,r.useState)(!1);return(0,gt.jsx)(Od,{isOpen:t,onClose:n,size:"sm",title:"Unload Film (Finished)",icon:(0,gt.jsx)(Da,{size:18}),footer:(0,gt.jsxs)("div",{className:"flex gap-2 w-full justify-end",children:[(0,gt.jsx)(La.T,{variant:"flat",onPress:n,size:"sm",isDisabled:s,children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:async()=>{if(s||!e)return;l(!0);const t={status:"shot",finished_date:a};i&&e&&i({ok:!0,optimistic:!0,patch:t,item:{...e,...t}}),n();try{const t=await(0,bn.lm)(e.id,{status:"shot",shot_at:(new Date).toISOString(),finished_date:a});if(!t||!1===t.ok)throw new Error(t&&t.error||"Update failed");i&&await i(t)}catch(r){alert("Failed to unload film: "+r.message)}finally{l(!1)}},isLoading:s,size:"sm",children:"Mark as Shot"})]}),children:(0,gt.jsx)("div",{className:"space-y-4",children:(0,gt.jsx)(jd,{className:"p-4",children:(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Finished Date"}),(0,gt.jsx)(Nf,{type:"date",value:a,onValueChange:o,size:"sm",variant:"flat",classNames:Yf,isRequired:!0})]})})})})}function rm({item:e,isOpen:t,onClose:n,onDeveloped:i}){const a=(new Date).toISOString().split("T")[0],[o,s]=(0,r.useState)({sent_date:a,develop_lab:"",develop_process:"",develop_date:"",develop_price:"",develop_note:""}),[l,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&s({sent_date:(new Date).toISOString().split("T")[0],develop_lab:"",develop_process:"",develop_date:"",develop_price:"",develop_note:""})},[t]);const u=(e,t)=>{s(n=>({...n,[e]:t}))};return(0,gt.jsx)(Od,{isOpen:t,onClose:n,size:"lg",title:"Send to Lab / Develop",icon:(0,gt.jsx)(Rf,{size:18}),footer:(0,gt.jsxs)("div",{className:"flex gap-2 w-full justify-end",children:[(0,gt.jsx)(La.T,{variant:"flat",onPress:n,size:"sm",isDisabled:l,children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:async()=>{if(l||!e)return;c(!0);const t={status:"sent_to_lab",sent_to_lab_at:o.sent_date,develop_lab:o.develop_lab,develop_process:o.develop_process,develop_date:o.develop_date,develop_price:o.develop_price?Number(o.develop_price):null,develop_note:o.develop_note};i&&e&&i({ok:!0,optimistic:!0,patch:t,item:{...e,...t}}),n();try{const t=await(0,bn.lm)(e.id,{status:"sent_to_lab",sent_to_lab_at:o.sent_date||(new Date).toISOString(),develop_lab:o.develop_lab,develop_process:o.develop_process,develop_date:o.develop_date,develop_price:o.develop_price?Number(o.develop_price):null,develop_note:o.develop_note});if(!t||!1===t.ok)throw new Error(t&&t.error||"Update failed");i&&await i(t)}catch(r){alert("Failed to update status: "+r.message)}finally{c(!1)}},isLoading:l,size:"sm",children:"Confirm"})]}),children:(0,gt.jsx)("div",{className:"space-y-3",children:(0,gt.jsx)(jd,{className:"p-4",children:(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:[(0,gt.jsx)(Kf,{size:12,className:"inline mr-1"}),"Sent Date"]}),(0,gt.jsx)(Nf,{type:"date",value:o.sent_date,onValueChange:e=>u("sent_date",e),size:"sm",variant:"flat",classNames:Yf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Lab Name"}),(0,gt.jsx)(Nf,{value:o.develop_lab,onValueChange:e=>u("develop_lab",e),placeholder:"e.g. FilmNeverDie",size:"sm",variant:"flat",classNames:Xf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Process"}),(0,gt.jsx)(Sf,{selectedKeys:o.develop_process?[o.develop_process]:[],onSelectionChange:e=>u("develop_process",Array.from(e)[0]||""),size:"sm",variant:"flat",placeholder:"Select process",classNames:Qf,popoverProps:Zf,listboxProps:Jf,children:em.map(e=>(0,gt.jsx)(Tf,{textValue:e,children:e},e))})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:[(0,gt.jsx)(ja,{size:12,className:"inline mr-1"}),"Develop Date"]}),(0,gt.jsx)(Nf,{type:"date",value:o.develop_date,onValueChange:e=>u("develop_date",e),size:"sm",variant:"flat",classNames:Yf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:[(0,gt.jsx)(Df,{size:12,className:"inline mr-1"}),"Cost"]}),(0,gt.jsx)(Nf,{type:"number",step:"0.01",value:o.develop_price,onValueChange:e=>u("develop_price",e),placeholder:"0.00",size:"sm",variant:"flat",classNames:Xf})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:[(0,gt.jsx)(za,{size:12,className:"inline mr-1"}),"Note"]}),(0,gt.jsx)(Nf,{value:o.develop_note,onValueChange:e=>u("develop_note",e),placeholder:"Optional notes",size:"sm",variant:"flat",classNames:Xf})]})]})})})})}function im({item:e,isOpen:t,onClose:n,onArchived:i}){const[a,o]=(0,r.useState)((new Date).toISOString().split("T")[0]),[s,l]=(0,r.useState)(""),[c,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&(o((new Date).toISOString().split("T")[0]),l(""))},[t]);return(0,gt.jsx)(Od,{isOpen:t,onClose:n,size:"sm",title:"Archive Film",icon:(0,gt.jsx)(Of,{size:18}),footer:(0,gt.jsxs)("div",{className:"flex gap-2 w-full justify-end",children:[(0,gt.jsx)(La.T,{variant:"flat",onPress:n,size:"sm",isDisabled:c,children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:async()=>{if(c||!e)return;u(!0);const t={status:"archived",archived_at:a};i&&e&&i({ok:!0,optimistic:!0,patch:t,item:{...e,...t}}),n();try{const t=await(0,bn.lm)(e.id,{status:"archived",archived_at:a||(new Date).toISOString()});if(!t||!1===t.ok)throw new Error(t&&t.error||"Update failed");i&&await i(t)}catch(r){alert("Failed to archive film: "+r.message)}finally{u(!1)}},isLoading:c,size:"sm",children:"Archive"})]}),children:(0,gt.jsxs)("div",{className:"space-y-4",children:[(0,gt.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Archive this film item to mark it as fully processed and stored."}),(0,gt.jsx)(jd,{className:"p-4",children:(0,gt.jsxs)("div",{className:"space-y-4",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Archive Date"}),(0,gt.jsx)(Nf,{type:"date",value:a,onValueChange:o,size:"sm",variant:"flat",classNames:Yf,isRequired:!0})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-1.5",children:"Note (Optional)"}),(0,gt.jsx)(Nf,{value:s,onValueChange:l,placeholder:"Storage location, etc.",size:"sm",variant:"flat",classNames:Xf})]})]})})]})})}var am=n(6601),om=n(6898);const sm=["50mm f/1.8","35mm f/1.4","28mm f/2.8","85mm f/1.8","24-70mm f/2.8","70-200mm f/2.8"];function lm({entry:e,index:t,onSave:n,onClose:i,countries:a,citiesByCountry:o,lensOptions:s,nativeLenses:l,adaptedLenses:c,fixedLensInfo:u,cameraMount:d}){var h,p,f,m;const[g,v]=(0,r.useState)({...e}),A=document.documentElement.classList.contains("dark");return(0,gt.jsx)("div",{className:"fg-modal-overlay",style:{zIndex:1100},onClick:i,children:(0,gt.jsxs)("div",{className:"fg-modal-content",style:{maxWidth:600,width:"90%",background:A?"#1e293b":"#fff",color:A?"#f1f5f9":"#333"},onClick:e=>e.stopPropagation(),children:[(0,gt.jsxs)("div",{className:"fg-modal-header",style:{borderBottom:A?"1px solid #334155":"1px solid #eee",paddingBottom:16},children:[(0,gt.jsxs)("h3",{style:{margin:0,fontSize:18,fontWeight:600,color:A?"#f1f5f9":"#1e293b"},children:["Edit Entry - ",e.date]}),(0,gt.jsx)("button",{className:"fg-modal-close",onClick:i,style:{color:A?"#94a3b8":"#64748b"},children:"\xd7"})]}),(0,gt.jsxs)("div",{className:"fg-modal-body",style:{padding:24},children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:16,marginBottom:20},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Shots"}),(0,gt.jsx)("input",{type:"number",className:"fg-input",value:g.count,min:"0",onChange:e=>v(t=>({...t,count:Number(e.target.value)||0}))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Aperture (f/)"}),(0,gt.jsx)("input",{type:"number",step:"0.1",className:"fg-input",value:null!==(h=g.aperture)&&void 0!==h?h:"",placeholder:"e.g. 2.8",onChange:e=>{const t=""===e.target.value?null:Number(e.target.value);v(e=>({...e,aperture:Number.isFinite(t)?t:null}))}})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Shutter Speed"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",value:g.shutter_speed||"",placeholder:"e.g. 1/125",onChange:e=>v(t=>({...t,shutter_speed:e.target.value}))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Focal (mm)"}),(0,gt.jsx)("input",{type:"number",step:"1",min:"1",max:"2000",className:"fg-input",value:null!==(p=g.focal_length)&&void 0!==p?p:"",placeholder:"e.g. 50",onChange:e=>{const t=""===e.target.value?null:Number(e.target.value);v(e=>({...e,focal_length:Number.isFinite(t)?t:null}))}})]})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{marginBottom:20},children:[(0,gt.jsxs)("label",{className:"fg-label",children:["Lens ",u&&(0,gt.jsx)("span",{style:{color:"#10b981"},children:"(Fixed)"})]}),u?(0,gt.jsxs)("div",{style:{padding:"10px 12px",background:A?"#064e3b":"#f0fdf4",border:A?"1px solid #10b981":"1px solid #86efac",borderRadius:6,color:A?"#d1fae5":"#166534"},children:["\ud83d\udd12 ",u.text]}):(0,gt.jsx)("input",{type:"text",className:"fg-input",value:g.lens||"",placeholder:"Lens model",onChange:e=>v(t=>({...t,lens:e.target.value})),list:"edit-lens-options"}),(0,gt.jsx)("datalist",{id:"edit-lens-options",children:s.map(e=>(0,gt.jsx)("option",{value:e},e))})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:20},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Country"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",value:g.country||"",placeholder:"Country",onChange:e=>v(t=>({...t,country:e.target.value})),list:"edit-country-options"}),(0,gt.jsx)("datalist",{id:"edit-country-options",children:a.map(e=>(0,gt.jsx)("option",{value:e.country_name||e.country_code},e.country_code||e.country_name))})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"City"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",value:g.city||"",placeholder:"City",onChange:e=>v(t=>({...t,city:e.target.value}))})]})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{marginBottom:20},children:[(0,gt.jsx)("label",{className:"fg-label",children:"Detail / Address (Search for GPS)"}),(0,gt.jsx)(om.A,{value:g.detail_location||"",onChange:e=>v(t=>({...t,detail_location:e})),onSelect:e=>{v(t=>({...t,detail_location:e.detail||e.displayName||"",country:e.country||t.country||"",city:e.city||t.city||"",latitude:e.latitude,longitude:e.longitude}))},placeholder:"Search address to get coordinates..."})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:20},children:[(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Latitude"}),(0,gt.jsx)("input",{type:"number",step:"0.00001",className:"fg-input",value:null!==(f=g.latitude)&&void 0!==f?f:"",placeholder:"e.g. 40.00119",onChange:e=>{const t=""===e.target.value?null:Number(e.target.value);v(e=>({...e,latitude:Number.isFinite(t)?t:null}))}})]}),(0,gt.jsxs)("div",{className:"fg-field",children:[(0,gt.jsx)("label",{className:"fg-label",children:"Longitude"}),(0,gt.jsx)("input",{type:"number",step:"0.00001",className:"fg-input",value:null!==(m=g.longitude)&&void 0!==m?m:"",placeholder:"e.g. 116.32000",onChange:e=>{const t=""===e.target.value?null:Number(e.target.value);v(e=>({...e,longitude:Number.isFinite(t)?t:null}))}})]})]}),g.latitude&&g.longitude&&(0,gt.jsxs)("div",{style:{padding:12,background:A?"#064e3b":"#f0fdf4",borderRadius:8,marginBottom:20,display:"flex",alignItems:"center",gap:8},children:[(0,gt.jsx)("span",{style:{fontSize:18},children:"\ud83d\udccd"}),(0,gt.jsxs)("span",{style:{color:A?"#d1fae5":"#166534",fontSize:14},children:[g.latitude.toFixed(5),", ",g.longitude.toFixed(5)]})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{marginBottom:20},children:[(0,gt.jsx)("label",{className:"fg-label",children:"Caption (Photo Description)"}),(0,gt.jsx)("textarea",{className:"fg-input",rows:3,value:g.caption||"",placeholder:"Describe what you shot, e.g. 'Sunset at the Great Wall'",onChange:e=>v(t=>({...t,caption:e.target.value})),style:{resize:"vertical",fontFamily:"inherit"}})]})]}),(0,gt.jsxs)("div",{className:"fg-modal-footer",style:{borderTop:A?"1px solid #334155":"1px solid #eee",padding:16,display:"flex",gap:12,justifyContent:"flex-end"},children:[(0,gt.jsx)("button",{className:"fg-btn fg-btn-secondary",onClick:i,children:"Cancel"}),(0,gt.jsx)("button",{className:"fg-btn fg-btn-primary",onClick:()=>n(t,g),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"Save Changes"})]})]})})}function cm({item:e,isOpen:t,onClose:n,onUpdated:i}){const a=document.documentElement.classList.contains("dark"),[o,s]=(0,r.useState)([]),[l,c]=(0,r.useState)((new Date).toISOString().split("T")[0]),[u,d]=(0,r.useState)("1"),[h,p]=(0,r.useState)(""),[f,m]=(0,r.useState)(""),[g,v]=(0,r.useState)(""),[A,y]=(0,r.useState)(""),[b,x]=(0,r.useState)(""),[_,w]=(0,r.useState)(""),[S,T]=(0,r.useState)(""),[C,M]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),[N,k]=(0,r.useState)(sm),[R,L]=(0,r.useState)([]),[O,j]=(0,r.useState)([]),[D,I]=(0,r.useState)([]),[B,F]=(0,r.useState)({}),[z,U]=(0,r.useState)(""),[V,G]=(0,r.useState)(!1),[q,W]=(0,r.useState)(new Date),[H,$]=(0,r.useState)((new Date).toISOString().split("T")[0]),[K,X]=(0,r.useState)(!1),[Y,Q]=(0,r.useState)(null),[Z,J]=(0,r.useState)(""),[ee,te]=(0,r.useState)(""),[ne,re]=(0,r.useState)(null),[ie,ae]=(0,r.useState)(null),[oe,se]=(0,r.useState)(null),[le,ce]=(0,r.useState)(!1),[ue,de]=(0,r.useState)(!1),[he,pe]=(0,r.useState)(null),fe=(0,r.useRef)(null),me=e=>{if(!he)return;let t;switch(e){case"replace":t=he;break;case"append":default:t=[...o,...he];break;case"merge":const e={};o.forEach(t=>{e[t.date]||(e[t.date]=[]),e[t.date].push(t)}),he.forEach(t=>{e[t.date]||(e[t.date]=[]),e[t.date].push(t)}),t=Object.values(e).flat()}t.sort((e,t)=>e.date.localeCompare(t.date)),s(t),de(!1),pe(null),alert(`Successfully imported ${he.length} entries!`)},ge=e=>{const t=`${e.brand||""} ${e.model||""}`.trim();if(e.focal_length_min){const n=e.focal_length_min!==e.focal_length_max&&e.focal_length_max?`${e.focal_length_min}-${e.focal_length_max}mm`:`${e.focal_length_min}mm`,r=e.max_aperture?` f/${e.max_aperture}`:"";return t?`${t} ${n}${r}`:`${n}${r}`}return t||e.name||"Unknown Lens"},ve=e=>Array.from(new Set((e||[]).filter(Boolean))).sort((e,t)=>e.localeCompare(t));(0,r.useEffect)(()=>{if(e&&e.shot_logs)try{const t=JSON.parse(e.shot_logs);if(Array.isArray(t)){const e=t.map(e=>({date:e.date,count:Number(e.count||e.shots||0)||0,lens:e.lens||"",focal_length:void 0!==e.focal_length&&null!==e.focal_length?Number(e.focal_length):null,aperture:void 0!==e.aperture&&null!==e.aperture?Number(e.aperture):null,shutter_speed:e.shutter_speed||"",country:e.country||"",city:e.city||"",detail_location:e.detail_location||"",latitude:void 0!==e.latitude&&null!==e.latitude?Number(e.latitude):null,longitude:void 0!==e.longitude&&null!==e.longitude?Number(e.longitude):null,caption:e.caption||""})).filter(e=>e.date&&e.count>0);s(e),k(t=>ve([...t,...e.map(e=>e.lens).filter(Boolean)]))}}catch(or){console.error("Failed to parse shot_logs",or)}else s([]);if(e&&e.shot_logs){const e=(new Date).toISOString().split("T")[0];$(e)}},[e]),(0,r.useEffect)(()=>{let t=!0;return(async()=>{if(null===e||void 0===e||!e.camera_equip_id)return Q(null),J(""),te(""),L([]),void j([]);try{const n=await(0,bn.$N)(e.camera_equip_id);if(!t)return;if(n.fixed_lens){const e=n.focal_length?`${n.focal_length}mm${n.max_aperture?` f/${n.max_aperture}`:""}`:"Fixed Lens";J(n.camera_name||""),te(""),Q({text:e,focal_length:n.focal_length,max_aperture:n.max_aperture}),L([]),j([]),P(e),p(""),n.focal_length&&y(String(n.focal_length))}else{Q(null),J(n.camera_name||""),te(n.camera_mount||"");const e=(n.lenses||[]).map(e=>({...e,displayName:ge(e)}));L(e);const t=(n.adapted_lenses||[]).map(e=>({...e,displayName:ge(e)}));j(t);const r=[...e,...t].map(e=>e.displayName).filter(Boolean);k(e=>ve([...r,...e]))}}catch(n){console.warn("Failed to fetch camera/lens info",n),t&&(Q(null),J(""),te(""),L([]),j([]))}})(),()=>{t=!1}},[null===e||void 0===e?void 0:e.camera_equip_id]),(0,r.useEffect)(()=>{let e=!0;return(0,bn.Tu)().then(t=>{if(!e)return;const n=(Array.isArray(t)?t:[]).map(e=>ge(e));k(e=>ve([...e,...n]))}).catch(e=>{console.warn("Failed to fetch library lenses:",e),k(e=>ve([...e,...sm]))}),(0,bn.X6)().then(t=>{if(!e)return;const n=(Array.isArray(t)?t:[]).sort((e,t)=>(e.country_name||"").localeCompare(t.country_name||""));I(n)}).catch(()=>I([])),()=>{e=!1}},[]),(0,r.useEffect)(()=>{const e=o[o.length-1];if(!e)return;b||x(e.country||""),_||w(e.city||""),S||T(e.detail_location||""),f||!e.aperture&&0!==e.aperture||m(String(e.aperture)),!g&&e.shutter_speed&&v(e.shutter_speed);const t=D.find(t=>(t.country_name||"").toLowerCase()===(e.country||"").toLowerCase());t&&U(t.country_code)},[o.length]),(0,r.useEffect)(()=>{const e=D.find(e=>(e.country_name||"").toLowerCase()===(b||"").toLowerCase()),t=e?e.country_code:"";U(t||""),t&&!B[t]&&(0,bn.X8)({country:t}).then(e=>{F(n=>({...n,[t]:Array.isArray(e)?e:[]}))}).catch(()=>{})},[b,D,B]);const Ae=()=>{var e,t,n;if(!l||!u||Number(u)<=0)return;const r=Y?Y.text:h.trim()||E||"",i=o[o.length-1]||{},a=""!==f?Number(f):null!==(e=i.aperture)&&void 0!==e?e:null,c=g||i.shutter_speed||"",P=""!==A?Number(A):null!==(t=null!==(n=null===Y||void 0===Y?void 0:Y.focal_length)&&void 0!==n?n:i.focal_length)&&void 0!==t?t:null,N={date:l,count:Number(u),lens:r,focal_length:Number.isFinite(P)?P:null,aperture:Number.isFinite(a)?a:null,shutter_speed:c,country:b||i.country||"",city:_||i.city||"",detail_location:S||i.detail_location||"",latitude:ne,longitude:ie,caption:C.trim()},R=[...o,N].sort((e,t)=>e.date.localeCompare(t.date));var L;s(R),r&&((L=r)&&k(e=>ve([...e,L]))),d("1"),p(""),m(null!==a&&void 0!==a&&""!==a?String(a):""),v(c||""),y(null!==P&&void 0!==P?String(P):""),x(N.country||""),w(N.city||""),T(N.detail_location||""),re(null),ae(null),M("")},ye=e=>{const t=[...o];t.splice(e,1),s(t)},be=e=>{se({index:e,entry:o[e]})},xe=o.reduce((e,t)=>e+t.count,0),_e=new Set(o.map(e=>e.date)).size,we=o.map((e,t)=>({...e,idx:t})).filter(e=>e.date===H);return t?(0,gt.jsxs)("div",{className:"fg-modal-overlay",children:[(0,gt.jsxs)("div",{className:"fg-modal-content",style:{maxWidth:1100,width:"94%",background:a?"#1e293b":"#fff",color:a?"#f1f5f9":"#333",display:"flex",flexDirection:"column",maxHeight:"90vh"},children:[(0,gt.jsxs)("div",{className:"fg-modal-header",style:{borderBottom:a?"1px solid #334155":"1px solid #eee",paddingBottom:16,marginBottom:0},children:[(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[(0,gt.jsxs)("h3",{style:{margin:0,fontSize:20,fontWeight:600,color:a?"#f1f5f9":"#1e293b"},children:["Shot Log - ",e.label||`Item #${e.id}`]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-sm",onClick:async()=>{X(!0);try{const t=await(0,bn.Oi)(e.id),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`shot-logs-${e.id}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}catch(t){alert("Export failed: "+(t.message||t))}finally{X(!1)}},disabled:K,style:{background:a?"#334155":"#fff",border:a?"1px solid #475569":"1px solid #e2e8f0",color:a?"#f1f5f9":"#0f172a",padding:"6px 10px",fontSize:12},children:K?"Exporting\u2026":"\ud83d\udce4 Export CSV"}),(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-sm",onClick:()=>{var e;return null===(e=fe.current)||void 0===e?void 0:e.click()},disabled:le,style:{background:a?"#334155":"#fff",border:a?"1px solid #475569":"1px solid #e2e8f0",color:a?"#f1f5f9":"#0f172a",padding:"6px 10px",fontSize:12},children:le?"Importing\u2026":"\ud83d\udce5 Import CSV"}),(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-sm",onClick:()=>{const e=new Blob(["date,count,lens,focal_length,aperture,shutter_speed,country,city,detail_location,latitude,longitude\n2026-01-01,1,50mm f/1.8,50,2.8,1/125,China,Beijing,Sample Location,39.9042,116.4074"],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="shot-log-template.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},style:{background:a?"#334155":"#fff",border:a?"1px solid #475569":"1px solid #e2e8f0",color:a?"#94a3b8":"#64748b",padding:"6px 10px",fontSize:12},title:"Download CSV template",children:"\ud83d\udccb Template"})]}),(0,gt.jsx)("input",{ref:fe,type:"file",accept:".csv,text/csv",onChange:async e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){ce(!0);try{const e=(e=>{const t=e.trim().split(/\r?\n/);if(t.length<2)return[];const n=t[0].toLowerCase().split(",").map(e=>e.trim()),r=[];for(let i=1;i<t.length;i++){const e=t[i];if(!e.trim())continue;const a=[];let o=!1,s="";for(const t of e)'"'===t?o=!o:","!==t||o?s+=t:(a.push(s.trim()),s="");a.push(s.trim());const l={};n.forEach((e,t)=>{const n=a[t]||"";switch(e){case"date":l.date=n;break;case"count":case"shots":l.count=Number(n)||0;break;case"lens":l.lens=n;break;case"focal_length":case"focal":l.focal_length=n?Number(n):null;break;case"aperture":case"f":l.aperture=n?Number(n):null;break;case"shutter_speed":case"shutter":case"s":l.shutter_speed=n;break;case"country":l.country=n;break;case"city":l.city=n;break;case"detail_location":case"detail":case"address":l.detail_location=n;break;case"latitude":case"lat":l.latitude=n?Number(n):null;break;case"longitude":case"lng":case"lon":l.longitude=n?Number(n):null}}),l.date&&l.count>0&&r.push({date:l.date,count:l.count,lens:l.lens||"",focal_length:Number.isFinite(l.focal_length)?l.focal_length:null,aperture:Number.isFinite(l.aperture)?l.aperture:null,shutter_speed:l.shutter_speed||"",country:l.country||"",city:l.city||"",detail_location:l.detail_location||"",latitude:Number.isFinite(l.latitude)?l.latitude:null,longitude:Number.isFinite(l.longitude)?l.longitude:null})}return r})(await n.text());if(0===e.length)return void alert("No valid entries found in CSV. Please check the format.");pe(e),de(!0)}catch(r){alert("Failed to read CSV: "+(r.message||r))}finally{ce(!1),fe.current&&(fe.current.value="")}}},style:{display:"none"}})]}),(0,gt.jsx)("button",{className:"fg-modal-close",onClick:n,style:{color:a?"#94a3b8":"#64748b"},children:"\xd7"})]}),ue&&he&&(0,gt.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,borderRadius:8},children:(0,gt.jsxs)("div",{style:{background:a?"#1e293b":"#fff",borderRadius:12,padding:24,maxWidth:400,width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.2)"},children:[(0,gt.jsxs)("h4",{style:{margin:"0 0 16px",fontSize:18,fontWeight:600,color:a?"#f1f5f9":"#1e293b"},children:["Import ",he.length," Entries"]}),(0,gt.jsx)("p",{style:{margin:"0 0 20px",color:a?"#94a3b8":"#64748b",fontSize:14},children:"How would you like to import these entries?"}),(0,gt.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,gt.jsxs)("button",{className:"fg-btn",onClick:()=>me("append"),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",border:"none",padding:"12px 16px",borderRadius:8,fontWeight:500},children:["\u2795 Append to existing (",o.length," + ",he.length,")"]}),(0,gt.jsx)("button",{className:"fg-btn",onClick:()=>me("merge"),style:{background:a?"#334155":"#fff",color:a?"#f1f5f9":"#475569",border:a?"1px solid #475569":"1px solid #e2e8f0",padding:"12px 16px",borderRadius:8,fontWeight:500},children:"\ud83d\udd00 Merge (combine entries by date)"}),(0,gt.jsxs)("button",{className:"fg-btn",onClick:()=>me("replace"),style:{background:"#fff",color:"#ef4444",border:"1px solid #fecaca",padding:"12px 16px",borderRadius:8,fontWeight:500},children:["\ud83d\udd04 Replace all (delete existing ",o.length," entries)"]}),(0,gt.jsx)("button",{className:"fg-btn",onClick:()=>{de(!1),pe(null)},style:{background:a?"#0f172a":"#f8fafc",color:a?"#94a3b8":"#64748b",border:"none",padding:"10px 16px",borderRadius:8,marginTop:8},children:"Cancel"})]})]})}),(0,gt.jsxs)("div",{className:"fg-modal-body",style:{padding:24,overflowY:"auto"},children:[(0,gt.jsxs)("div",{style:{marginBottom:24,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:20,borderRadius:12,boxShadow:"0 4px 12px rgba(102, 126, 234, 0.25)"},children:[(0,gt.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:12},children:[(0,gt.jsxs)("div",{className:"fg-field",style:{flex:"0 0 140px"},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"Date"}),(0,gt.jsx)("input",{type:"date",className:"fg-input",value:l,onChange:e=>c(e.target.value),style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13}})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:"0 0 80px"},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"Shots"}),(0,gt.jsx)("input",{type:"number",className:"fg-input",value:u,onChange:e=>d(e.target.value),placeholder:"#",min:"1",style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13},onKeyDown:e=>"Enter"===e.key&&Ae()})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:"0 0 90px"},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"f/"}),(0,gt.jsx)("input",{type:"number",step:"0.1",className:"fg-input",value:f,onChange:e=>m(e.target.value),placeholder:"1.8",style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13},onKeyDown:e=>"Enter"===e.key&&Ae()})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:"0 0 100px"},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"s"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",value:g,onChange:e=>v(e.target.value),placeholder:"1/125",style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13},onKeyDown:e=>"Enter"===e.key&&Ae()})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:"0 0 80px"},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"mm"}),(0,gt.jsx)("input",{type:"number",step:"1",min:"1",max:"2000",className:"fg-input",value:A,onChange:e=>y(e.target.value),placeholder:"50",style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13},onKeyDown:e=>"Enter"===e.key&&Ae()})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:1,minWidth:0},children:[(0,gt.jsxs)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:["Lens ",Y&&(0,gt.jsx)("span",{style:{opacity:.7},children:"(Fixed)"}),ee&&!Y&&(0,gt.jsxs)("span",{style:{opacity:.6,fontSize:10,marginLeft:4},children:["(",ee,")"]})]}),Y?(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#f0fdf4",border:"1px solid #86efac",borderRadius:6,padding:"8px 12px",height:38,boxSizing:"border-box"},children:[(0,gt.jsx)("span",{style:{fontSize:14},children:"\ud83d\udd12"}),(0,gt.jsx)("span",{style:{fontSize:13,color:"#166534",fontWeight:500},children:Y.text}),Z&&(0,gt.jsx)("span",{style:{fontSize:11,color:"#15803d",marginLeft:"auto"},children:Z})]}):(0,gt.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,gt.jsxs)("select",{className:"fg-input",value:E,onChange:e=>{const t=[...R,...O].find(t=>t.name===e.target.value);if(P(e.target.value),t){t.focal_length_min&&(!t.focal_length_max||t.focal_length_min===t.focal_length_max)&&y(String(t.focal_length_min))}},style:{background:"#fff",color:"#1f2937",height:38,border:"none",flex:1,minWidth:0,fontSize:13},children:[(0,gt.jsx)("option",{value:"",children:"Select lens..."}),R.length>0&&(0,gt.jsx)("optgroup",{label:"\ud83d\udcf7 Native Lenses"+(ee?` (${ee})`:""),children:R.map(e=>(0,gt.jsx)("option",{value:e.name,children:e.displayName},`native-${e.id}`))}),O.length>0&&(0,gt.jsx)("optgroup",{label:"\ud83d\udd04 Adapted Lenses",children:O.map(e=>(0,gt.jsxs)("option",{value:e.name,children:[e.displayName," [",e.mount,"]"]},`adapted-${e.id}`))}),0===R.length&&0===O.length&&N.length>0&&(0,gt.jsx)("optgroup",{label:"Other Lenses",children:N.map(e=>(0,gt.jsx)("option",{value:e,children:e},e))})]}),(0,gt.jsx)("input",{type:"text",className:"fg-input",value:h,onChange:e=>p(e.target.value),placeholder:"Custom",style:{background:"#fff",color:"#1f2937",height:38,border:"none",flex:1,minWidth:0,fontSize:13},onKeyDown:e=>"Enter"===e.key&&Ae()})]})]})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-end"},children:[(0,gt.jsxs)("div",{className:"fg-field",style:{flex:1,minWidth:0},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"Country"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",list:"fg-country-options",value:b,onChange:e=>x(e.target.value),placeholder:"From DB",style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13}}),(0,gt.jsx)("datalist",{id:"fg-country-options",children:D.map(e=>(0,gt.jsx)("option",{value:e.country_name||e.country_code},e.country_code||e.country_name))})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:1,minWidth:0},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"City"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",list:"fg-city-options",value:_,onChange:e=>w(e.target.value),placeholder:z?"Filtered":"Country first",disabled:!z&&!b,style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13}}),(0,gt.jsx)("datalist",{id:"fg-city-options",children:(B[z]||[]).map(e=>(0,gt.jsx)("option",{value:e.city_name},e.id))})]}),(0,gt.jsxs)("div",{className:"fg-field",style:{flex:1.2,minWidth:0,position:"relative"},children:[(0,gt.jsxs)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:["Detail / Address",ne&&ie&&(0,gt.jsxs)("span",{style:{marginLeft:8,color:"#4ade80",fontSize:11},children:["\ud83d\udccd ",ne.toFixed(5),", ",ie.toFixed(5)]})]}),(0,gt.jsx)(om.A,{value:S,onChange:T,onSelect:e=>{re(e.latitude),ae(e.longitude),e.country&&x(e.country),e.city&&w(e.city),e.detail&&T(e.detail)},placeholder:"Search address or type detail",style:{background:"transparent"}})]})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-end"},children:[(0,gt.jsxs)("div",{className:"fg-field",style:{flex:1,minWidth:0},children:[(0,gt.jsx)("label",{className:"fg-label",style:{color:"rgba(255,255,255,0.95)",marginBottom:6,fontSize:12,fontWeight:600},children:"Caption (Photo Description)"}),(0,gt.jsx)("input",{type:"text",className:"fg-input",value:C,onChange:e=>M(e.target.value),placeholder:"Describe the shot, e.g. 'Sunset at the Great Wall'",style:{background:"#fff",color:"#1f2937",height:38,border:"none",fontSize:13},onKeyDown:e=>"Enter"===e.key&&Ae()})]}),(0,gt.jsx)("button",{type:"button",className:"fg-btn",onClick:()=>{ne||ie||!b&&!_||(async()=>{if((!ne||!ie)&&(b||_))try{const e=await(0,am.lN)(b,_);e&&(re(e.latitude),ae(e.longitude))}catch(e){console.error("Auto-fill coordinates failed:",e)}})(),Ae()},disabled:!u,style:{height:38,padding:"0 20px",fontSize:13,fontWeight:600,background:"#fff",color:"#667eea",border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",whiteSpace:"nowrap"},children:"Add Log"})]})]}),(0,gt.jsxs)("div",{style:{marginBottom:20},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,gt.jsx)("h4",{style:{margin:0,fontSize:16,fontWeight:600,color:a?"#f1f5f9":"#1e293b"},children:"Selected Day"}),(0,gt.jsx)("span",{style:{fontSize:13,color:"#fff",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"4px 12px",borderRadius:6,fontWeight:500},children:H||"Pick a date"})]}),0===we.length?(0,gt.jsxs)("div",{style:{border:a?"2px dashed #475569":"2px dashed #e2e8f0",borderRadius:12,padding:20,color:"#94a3b8",fontSize:13,textAlign:"center"},children:[(0,gt.jsx)("div",{style:{marginBottom:4},children:"\ud83d\udcc5"}),"No entries for this day. Click the calendar to choose a date, then add logs above."]}):(0,gt.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:we.map(e=>(0,gt.jsxs)("div",{style:{border:a?"1px solid #475569":"1px solid #e2e8f0",borderRadius:10,padding:12,background:a?"#334155":"#fff",display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flex:1},children:[(0,gt.jsxs)("span",{style:{background:"#eff6ff",color:"#2563eb",padding:"4px 10px",borderRadius:6,fontWeight:600,fontSize:13},children:[e.count," shot",1!==e.count?"s":""]}),e.aperture&&(0,gt.jsxs)("span",{style:{color:"#64748b",fontSize:13},children:["f/",e.aperture]}),e.shutter_speed&&(0,gt.jsx)("span",{style:{color:"#64748b",fontSize:13},children:e.shutter_speed}),e.focal_length&&(0,gt.jsxs)("span",{style:{color:"#64748b",fontSize:13},children:[e.focal_length,"mm"]}),e.lens&&(0,gt.jsxs)("span",{style:{color:"#475569",fontSize:13},children:["\u2022 ",e.lens]})]}),(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.caption&&(0,gt.jsxs)("span",{style:{color:a?"#a5b4fc":"#6366f1",fontSize:12,maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.caption,children:["\ud83d\udcac ",e.caption]}),(e.country||e.city)&&(0,gt.jsxs)("span",{style:{color:"#64748b",fontSize:12},children:["\ud83d\udccd ",[e.country,e.city].filter(Boolean).join(" / ")]}),e.latitude&&e.longitude&&(0,gt.jsx)("span",{style:{background:"#dcfce7",color:"#166534",padding:"2px 6px",borderRadius:4,fontSize:10,fontFamily:"monospace"},children:"GPS \u2713"})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,gt.jsx)("button",{className:"fg-btn",style:{background:a?"#1e293b":"#fff",border:a?"1px solid #64748b":"1px solid #e2e8f0",color:a?"#cbd5e1":"#475569",padding:"4px 10px",fontSize:12},onClick:()=>be(e.idx),children:"\u270f\ufe0f"}),(0,gt.jsx)("button",{className:"fg-btn",style:{background:a?"#1e293b":"#fff",border:"1px solid #fecaca",color:"#ef4444",padding:"4px 10px",fontSize:12},onClick:()=>{window.confirm("Delete this log entry?")&&ye(e.idx)},children:"\ud83d\uddd1\ufe0f"})]})]},`${e.date}-${e.idx}`))})]}),(0,gt.jsxs)("div",{style:{marginBottom:20},children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,padding:"0 8px"},children:[(0,gt.jsx)("button",{type:"button",onClick:()=>W(new Date(q.getFullYear(),q.getMonth()-1,1)),style:{border:a?"1px solid #475569":"1px solid #e2e8f0",background:a?"#334155":"#fff",padding:"8px 16px",borderRadius:8,cursor:"pointer",fontSize:14,color:a?"#f1f5f9":"#475569",fontWeight:500},children:"\u2190 Prev"}),(0,gt.jsx)("h4",{style:{margin:0,fontSize:18,fontWeight:600,color:a?"#f1f5f9":"#1e293b"},children:q.toLocaleDateString("en-US",{year:"numeric",month:"long"})}),(0,gt.jsx)("button",{type:"button",onClick:()=>W(new Date(q.getFullYear(),q.getMonth()+1,1)),style:{border:a?"1px solid #475569":"1px solid #e2e8f0",background:a?"#334155":"#fff",padding:"8px 16px",borderRadius:8,cursor:"pointer",fontSize:14,color:a?"#f1f5f9":"#475569",fontWeight:500},children:"Next \u2192"})]}),(0,gt.jsxs)("div",{style:{border:a?"1px solid #475569":"1px solid #e2e8f0",borderRadius:12,overflow:"hidden",background:a?"#1e293b":"#fff"},children:[(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",background:a?"#0f172a":"#f8fafc",borderBottom:a?"1px solid #475569":"1px solid #e2e8f0"},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,gt.jsx)("div",{style:{padding:"12px 8px",textAlign:"center",fontSize:12,fontWeight:600,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em"},children:e},e))}),(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)"},children:(()=>{const e=q.getFullYear(),t=q.getMonth(),n=new Date(e,t,1).getDay(),r=new Date(e,t+1,0).getDate(),i=[];for(let o=0;o<n;o++)i.push((0,gt.jsx)("div",{style:{aspectRatio:"1",borderTop:a?"1px solid #334155":"1px solid #f1f5f9",borderLeft:o>0?a?"1px solid #334155":"1px solid #f1f5f9":"none",background:a?"#0f172a":"#fafafa"}},`empty-${o}`));for(let s=1;s<=r;s++){const r=`${e}-${String(t+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`,l=o.filter(e=>e.date===r),u=l.length>0,d=r===(new Date).toISOString().split("T")[0],h=(n+s-1)%7,p=l.reduce((e,t)=>e+t.count,0);i.push((0,gt.jsxs)("div",{onClick:()=>{c(r),$(r)},style:{aspectRatio:"1",borderTop:a?"1px solid #475569":"1px solid #e2e8f0",borderLeft:h>0?a?"1px solid #475569":"1px solid #e2e8f0":"none",padding:8,cursor:"pointer",position:"relative",background:u?a?"#1e3a5f":"#eff6ff":d?a?"#451a03":"#fef3c7":a?"#1e293b":"#fff",transition:"all 0.2s",display:"flex",flexDirection:"column",justifyContent:"space-between"},onMouseEnter:e=>{u||(e.currentTarget.style.background=a?"#334155":"#f8fafc")},onMouseLeave:e=>{e.currentTarget.style.background=u?a?"#1e3a5f":"#eff6ff":d?a?"#451a03":"#fef3c7":a?"#1e293b":"#fff"},children:[(0,gt.jsx)("div",{style:{fontSize:13,fontWeight:d?700:500,color:u?a?"#60a5fa":"#2563eb":d?a?"#fbbf24":"#92400e":a?"#cbd5e1":"#475569"},children:s}),u&&(0,gt.jsxs)("div",{style:{fontSize:11,fontWeight:700,color:"#fff",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:6,padding:"4px 6px",textAlign:"center",boxShadow:"0 2px 4px rgba(102, 126, 234, 0.3)"},children:[p," \ud83d\udcf8"]})]},s))}return i})()})]})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16,marginTop:20,marginBottom:24},children:[(0,gt.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:20,borderRadius:12,color:"#fff",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.25)"},children:[(0,gt.jsx)("div",{style:{fontSize:13,opacity:.9,marginBottom:4},children:"Total Shots"}),(0,gt.jsx)("div",{style:{fontSize:32,fontWeight:700},children:xe})]}),(0,gt.jsxs)("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",padding:20,borderRadius:12,color:"#fff",boxShadow:"0 4px 12px rgba(245, 87, 108, 0.25)"},children:[(0,gt.jsx)("div",{style:{fontSize:13,opacity:.9,marginBottom:4},children:"Days Logged"}),(0,gt.jsx)("div",{style:{fontSize:32,fontWeight:700},children:_e})]})]}),(0,gt.jsxs)("div",{style:{marginTop:8},children:[(0,gt.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:(0,gt.jsxs)("h4",{style:{margin:0,fontSize:16,fontWeight:600,color:a?"#f1f5f9":"#1e293b"},children:["All Entries (",o.length,")"]})}),0===o.length?(0,gt.jsxs)("div",{style:{border:a?"2px dashed #475569":"2px dashed #e2e8f0",borderRadius:12,padding:32,textAlign:"center",color:"#94a3b8"},children:[(0,gt.jsx)("div",{style:{fontSize:32,marginBottom:8},children:"\ud83d\udcf7"}),(0,gt.jsx)("div",{style:{fontSize:14},children:"No entries yet. Use the form above to add your first shot log."})]}):(0,gt.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:o.map((e,t)=>(0,gt.jsxs)("div",{style:{border:a?"1px solid #475569":"1px solid #e2e8f0",borderRadius:12,padding:16,background:a?"#334155":"#fff",transition:"box-shadow 0.2s",cursor:"pointer"},onMouseEnter:e=>e.currentTarget.style.boxShadow=a?"0 4px 12px rgba(0,0,0,0.3)":"0 4px 12px rgba(0,0,0,0.08)",onMouseLeave:e=>e.currentTarget.style.boxShadow="none",onClick:()=>be(t),children:[(0,gt.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,gt.jsx)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",padding:"8px 12px",borderRadius:8,fontWeight:600,fontSize:14},children:e.date}),(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,gt.jsxs)("span",{style:{background:"#eff6ff",color:"#2563eb",padding:"4px 10px",borderRadius:6,fontWeight:600,fontSize:13},children:[e.count," shot",1!==e.count?"s":""]}),e.aperture&&(0,gt.jsxs)("span",{style:{color:"#64748b",fontSize:13},children:["f/",e.aperture]}),e.shutter_speed&&(0,gt.jsx)("span",{style:{color:"#64748b",fontSize:13},children:e.shutter_speed})]})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,gt.jsx)("button",{className:"fg-btn",style:{background:a?"#1e293b":"#fff",border:a?"1px solid #64748b":"1px solid #e2e8f0",color:a?"#cbd5e1":"#475569",padding:"6px 12px",fontSize:12},onClick:e=>{e.stopPropagation(),be(t)},children:"\u270f\ufe0f Edit"}),(0,gt.jsx)("button",{className:"fg-btn",style:{background:a?"#1e293b":"#fff",border:"1px solid #fecaca",color:"#ef4444",padding:"6px 12px",fontSize:12},onClick:e=>{e.stopPropagation(),window.confirm("Delete this log entry?")&&ye(t)},children:"\ud83d\uddd1\ufe0f"})]})]}),(e.lens||e.focal_length)&&(0,gt.jsxs)("div",{style:{marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,gt.jsx)("span",{style:{color:"#94a3b8",fontSize:12},children:"\ud83d\udcf7"}),(0,gt.jsxs)("span",{style:{color:"#475569",fontSize:13},children:[e.lens,e.focal_length?` @ ${e.focal_length}mm`:""]})]}),(e.country||e.city||e.detail_location)&&(0,gt.jsxs)("div",{style:{background:a?"#1e293b":"#f8fafc",borderRadius:8,padding:10,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,gt.jsx)("span",{style:{fontSize:14},children:"\ud83d\udccd"}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("div",{style:{color:a?"#f1f5f9":"#1e293b",fontSize:13,fontWeight:500},children:[e.country,e.city].filter(Boolean).join(" / ")||"Unknown Location"}),e.detail_location&&(0,gt.jsx)("div",{style:{color:"#64748b",fontSize:12,marginTop:2},children:e.detail_location})]})]}),e.latitude&&e.longitude&&(0,gt.jsxs)("div",{style:{background:"#dcfce7",color:"#166534",padding:"4px 8px",borderRadius:6,fontSize:11,fontFamily:"monospace"},children:[e.latitude.toFixed(4),", ",e.longitude.toFixed(4)]})]}),!e.country&&!e.city&&!e.detail_location&&(0,gt.jsxs)("div",{style:{color:"#94a3b8",fontSize:12,fontStyle:"italic",display:"flex",alignItems:"center",gap:6},children:[(0,gt.jsx)("span",{children:"\ud83d\udccd"}),(0,gt.jsx)("span",{children:"No location set - click Edit to add"})]})]},`${e.date}-${t}`))})]})]}),(0,gt.jsxs)("div",{className:"fg-modal-footer",style:{padding:20,borderTop:a?"1px solid #334155":"1px solid #eee",display:"flex",justifyContent:"flex-end",gap:12,background:a?"#1e293b":"#fff",borderRadius:"0 0 8px 8px"},children:[(0,gt.jsx)("button",{type:"button",className:"fg-btn",onClick:n,disabled:V,style:{background:a?"#334155":"#fff",border:a?"1px solid #64748b":"1px solid #cbd5e1",color:a?"#f1f5f9":"#475569",padding:"8px 20px"},children:"Cancel"}),(0,gt.jsx)("button",{type:"button",className:"fg-btn fg-btn-primary",onClick:async()=>{G(!0);try{const t=await(0,bn.lm)(e.id,{shot_logs:JSON.stringify(o)});if(!t.ok)throw new Error(t.error||"Update failed");i&&await i(),n()}catch(t){alert("Failed to save logs: "+t.message)}finally{G(!1)}},disabled:V,style:{padding:"8px 24px"},children:V?"Saving...":"Save Logs"})]})]}),oe&&(0,gt.jsx)(lm,{entry:oe.entry,index:oe.index,onSave:(e,t)=>{s(n=>{const r=[...n];return r[e]=t,r}),se(null)},onClose:()=>se(null),countries:D,citiesByCountry:B,lensOptions:N,nativeLenses:R,adaptedLenses:O,fixedLensInfo:Y,cameraMount:ee})]}):null}const um=$n("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),dm=$n("sliders-horizontal",[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]]),hm=[{value:"all",label:"All",icon:um,color:"default",gradient:"from-slate-500 to-gray-600"},{value:"in_stock",label:"In Stock",icon:rp,color:"success",gradient:"from-emerald-500 to-green-600"},{value:"loaded",label:"Loaded",icon:Ia,color:"primary",gradient:"from-blue-500 to-indigo-600"},{value:"shot",label:"Shot",icon:kf,color:"warning",gradient:"from-amber-500 to-orange-600"},{value:"sent_to_lab",label:"At Lab",icon:Rf,color:"secondary",gradient:"from-purple-500 to-violet-600"},{value:"developed",label:"Developed",icon:Lf,color:"success",gradient:"from-teal-500 to-cyan-600"},{value:"archived",label:"Archived",icon:Of,color:"default",gradient:"from-slate-400 to-gray-500"}];function pm({selectedStatus:e="all",onStatusChange:t,statusCounts:n={},totalCount:r=0,formatFilter:i="",onFormatChange:a,availableFormats:o=[]}){return(0,gt.jsx)("div",{className:"flex flex-col gap-4 mb-6",children:(0,gt.jsx)(_f,{orientation:"horizontal",className:"w-full pb-2",hideScrollBar:!0,children:(0,gt.jsxs)("div",{className:"flex items-center gap-2 min-w-max",children:[hm.map(i=>{const a=i.icon,o="all"===(s=i.value)?r:n[s]||0;var s;const l=e===i.value;return(0,gt.jsx)(ju.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,gt.jsx)(La.T,{size:"sm",variant:l?"shadow":"flat",className:`\n                    gap-2 font-medium transition-all duration-200\n                    ${l?`bg-gradient-to-r ${i.gradient} text-white shadow-lg`:"bg-default-100/50 dark:bg-default-100/30 hover:bg-default-200/50"}\n                  `,onPress:()=>null===t||void 0===t?void 0:t(i.value),startContent:(0,gt.jsx)(a,{className:"w-4 h-4"}),endContent:(0,gt.jsx)(el,{size:"sm",variant:l?"solid":"flat",className:`\n                        h-5 min-w-6 text-xs\n                        ${l?"bg-white/20 text-white":"bg-default-200/50 dark:bg-default-300/30"}\n                      `,children:o}),children:(0,gt.jsx)("span",{className:"hidden sm:inline",children:i.label})})},i.value)}),(0,gt.jsx)("div",{className:"w-px h-6 bg-divider mx-2"}),(0,gt.jsx)(Sf,{size:"sm",variant:"flat",placeholder:"All Formats",selectedKeys:i?[i]:[],onSelectionChange:e=>{const t=Array.from(e)[0]||"";null===a||void 0===a||a(t)},className:"w-36",classNames:{trigger:"h-8 min-h-8 bg-default-100/50 dark:bg-default-100/30",value:"text-xs"},startContent:(0,gt.jsx)(dm,{className:"w-3.5 h-3.5 text-default-400"}),children:o.map(e=>(0,gt.jsx)(Tf,{textValue:e,children:"135"===e?"35mm (135)":"120"===e?"Medium (120)":e},e))})]})})})}const fm=$n("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),mm=$n("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),gm=$n("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),vm={in_stock:{label:"In Stock",icon:rp,color:"success"},loaded:{label:"Loaded",icon:Ia,color:"primary"},shot:{label:"Shot",icon:kf,color:"warning"},sent_to_lab:{label:"At Lab",icon:Rf,color:"secondary"},developed:{label:"Developed",icon:Lf,color:"cyan"},archived:{label:"Archived",icon:Of,color:"default"}};function Am({item:e,film:t,isExpanded:n=!1,onToggleExpand:r,onLoad:i,onUnload:a,onLogShots:o,onDevelop:s,onCreateRoll:l,onArchive:c,onEdit:u,onDelete:d,onViewRoll:h}){const p=vm[e.status]||vm.in_stock,f=p.icon,m=(e=>{if(!e)return null;const t=e.thumbPath||e.thumbnail_url;return t?t.startsWith("http")?t:(0,bn.FH)(t.startsWith("/")?t:`/uploads/films/${t}`):null})(t),g=e.expiry_date&&new Date(e.expiry_date)<new Date,v=(null===t||void 0===t?void 0:t.name)||"Unknown Film",A=(null===t||void 0===t?void 0:t.format)||"135",y=document.documentElement.classList.contains("dark")||"dark"===document.documentElement.getAttribute("data-theme"),b="loaded"===e.status&&e.loaded_camera?`Loaded on ${e.loaded_camera}`:p.label,x=(()=>{const t=[];return"in_stock"===e.status?t.push({label:"Load",icon:Ia,color:"primary",onClick:()=>null===i||void 0===i?void 0:i(e.id)}):"loaded"===e.status?(t.push({label:"Log Shots",icon:fm,color:"secondary",onClick:()=>null===o||void 0===o?void 0:o(e.id)}),t.push({label:"Unload",icon:kf,color:"warning",onClick:()=>null===a||void 0===a?void 0:a(e.id)})):"shot"===e.status?t.push({label:"Develop",icon:Rf,color:"primary",onClick:()=>null===s||void 0===s?void 0:s(e.id)}):"sent_to_lab"===e.status?t.push({label:"Create Roll",icon:Lf,color:"success",onClick:()=>null===l||void 0===l?void 0:l(e)}):"developed"!==e.status&&"archived"!==e.status||!e.roll_id||(t.push({label:"View Roll",icon:mm,color:"primary",onClick:()=>null===h||void 0===h?void 0:h(e.roll_id)}),"developed"===e.status&&t.push({label:"Archive",icon:Of,color:"default",onClick:()=>null===c||void 0===c?void 0:c(e)})),t.push({label:"Edit",icon:zu,color:"default",variant:"flat",onClick:()=>null===u||void 0===u?void 0:u(e)}),e.roll_id||t.push({label:"Delete",icon:gm,color:"danger",variant:"flat",onClick:()=>null===d||void 0===d?void 0:d(e.id)}),t})();return(0,gt.jsx)("div",{className:"group relative overflow-hidden rounded-xl cursor-pointer bg-black shadow-sm hover:shadow-lg",style:{aspectRatio:n?"2/1":"1/1",width:"100%",height:"100%",transition:"box-shadow 0.2s ease"},onClick:()=>null===r||void 0===r?void 0:r(),children:(0,gt.jsxs)("div",{style:{display:"flex",width:"100%",height:"100%"},children:[(0,gt.jsxs)("div",{style:{position:"relative",width:n?"50%":"100%",height:"100%",flexShrink:0,transition:"width 0.3s ease-out"},children:[m?(0,gt.jsx)("img",{src:m,alt:v,className:`w-full h-full object-cover ${!n&&"group-hover:scale-105"}`,style:{transition:"transform 0.5s ease"},loading:"lazy"}):(0,gt.jsx)("div",{className:"w-full h-full bg-zinc-800 flex items-center justify-center",children:(0,gt.jsx)(Da,{size:n?64:40,className:"text-zinc-600"})}),e.expiry_date&&(0,gt.jsxs)("div",{className:`\n              absolute top-2 right-2 px-2 py-1 rounded text-[10px] font-bold tracking-wide\n              backdrop-blur-md shadow-sm border border-white/10\n              ${g?"bg-red-500/80 text-white":"bg-black/40 text-white/90"}\n            `,children:["EXP ",e.expiry_date]}),(0,gt.jsxs)("div",{className:"absolute inset-x-0 bottom-0 min-h-[80px] flex flex-col justify-end p-4 bg-gradient-to-t from-black via-black/70 to-transparent",children:[(0,gt.jsxs)("div",{className:"text-white font-bold leading-tight dropshadow-md mb-2 truncate "+(n?"text-xl":"text-lg"),children:[v,"135"!==A&&(0,gt.jsxs)("span",{className:"text-xs opacity-60 ml-1 font-normal align-middle",children:["(",A,")"]})]}),(0,gt.jsx)("div",{className:"flex items-center",children:(0,gt.jsxs)("div",{className:`\n                inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full \n                text-[11px] font-medium tracking-wide backdrop-blur-md\n                ${"success"===p.color?"bg-green-500/20 text-green-300":""}\n                ${"primary"===p.color?"bg-blue-500/20 text-blue-300":""}\n                ${"warning"===p.color?"bg-yellow-500/20 text-yellow-300":""}\n                ${"secondary"===p.color?"bg-purple-500/20 text-purple-300":""}\n                ${"cyan"===p.color?"bg-cyan-500/20 text-cyan-300":""}\n                ${"default"===p.color?"bg-zinc-500/30 text-zinc-300":""}\n              `,children:[(0,gt.jsx)(f,{size:12,strokeWidth:2.5}),(0,gt.jsx)("span",{children:b})]})})]})]}),(0,gt.jsx)("div",{style:{width:n?"50%":"0%",height:"100%",background:y?"#18181b":"#f4f4f5",borderLeft:n?"1px solid "+(y?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.08)"):"none",overflow:"hidden",flexShrink:0,opacity:n?1:0,transition:"width 0.3s ease-out, opacity 0.2s ease-out"},onClick:e=>{var t;null===e||void 0===e||null===(t=e.stopPropagation)||void 0===t||t.call(e)},children:(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr 1fr",width:"100%",height:"100%",gap:"8px",padding:"8px"},children:x.slice(0,4).map((e,t)=>(0,gt.jsxs)("button",{onClick:e.onClick,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",height:"100%",background:"#27272a",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"12px",cursor:"pointer",transition:"background 0.15s, transform 0.1s",gridColumn:2===t&&3===x.length?"span 2":"auto"},onMouseEnter:e=>{e.currentTarget.style.background="#3f3f46",e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.background="#27272a",e.currentTarget.style.transform="scale(1)"},children:[(0,gt.jsx)(e.icon,{size:28,strokeWidth:1.5,color:"danger"===e.color?"#f87171":"primary"===e.color?"#60a5fa":"success"===e.color?"#4ade80":"warning"===e.color?"#facc15":"#a1a1aa"}),(0,gt.jsx)("span",{style:{fontSize:"13px",fontWeight:500,color:"danger"===e.color?"#f87171":"primary"===e.color?"#60a5fa":"success"===e.color?"#4ade80":"warning"===e.color?"#facc15":"#a1a1aa"},children:e.label})]},t))})})]})})}const ym={base:"bg-transparent",mainWrapper:"bg-transparent",inputWrapper:"h-10 min-h-10 bg-transparent shadow-none",innerWrapper:"bg-transparent",input:"text-sm text-zinc-900 dark:text-zinc-100"},bm={base:"bg-transparent",mainWrapper:"bg-transparent",inputWrapper:"h-10 min-h-10 bg-transparent shadow-none",innerWrapper:"bg-transparent",input:"text-center text-sm text-zinc-900 dark:text-zinc-100"},xm={film_id:"",quantity:1,unit_price:"",expiry_date:"",batch_code:""},_m=e=>{if(!e)return null;const t=e.thumbPath||e.thumbnail_url;return t?t.startsWith("http")?t:(0,bn.FH)(t.startsWith("/")?t:`/uploads/films/${t}`):null};function wm({isOpen:e,onClose:t,onSubmit:n,films:i=[],isLoading:a=!1}){const[o,s]=(0,r.useState)({order_date:(new Date).toISOString().slice(0,10),channel:"",vendor:"",shipping_cost:"",notes:"",items:[{...xm}]}),{totalQuantity:l,totalCost:c,perItemShipping:u}=(0,r.useMemo)(()=>{const e=o.items.reduce((e,t)=>e+Number(t.quantity||0),0),t=Number(o.shipping_cost||0),n=e>0?t/e:0;return{totalQuantity:e,totalCost:o.items.reduce((e,t)=>e+Number(t.quantity||0)*Number(t.unit_price||0),0)+t,perItemShipping:n}},[o.items,o.shipping_cost]),d=(e,t)=>s(n=>({...n,[e]:t})),h=(e,t,n)=>{s(r=>({...r,items:r.items.map((r,i)=>i===e?{...r,[t]:n}:r)}))},p=()=>s(e=>({...e,items:[...e.items,{...xm}]})),f=()=>{null===n||void 0===n||n({purchase_date:o.order_date||null,purchase_channel:o.channel||null,purchase_vendor:o.vendor||null,purchase_order_id:null,total_shipping:Number(o.shipping_cost||0),purchase_currency:"CNY",note:o.notes||null,items:o.items.map(e=>({film_id:e.film_id?Number(e.film_id):null,quantity:Number(e.quantity||0),unit_price:""===e.unit_price?null:Number(e.unit_price),expiry_date:e.expiry_date||null,batch_number:e.batch_code||null,label:null,note_purchase:null}))})};return(0,gt.jsx)(ud,{isOpen:e,onClose:()=>{s({order_date:(new Date).toISOString().slice(0,10),channel:"",vendor:"",shipping_cost:"",notes:"",items:[{...xm}]}),null===t||void 0===t||t()},size:"3xl",scrollBehavior:"inside",backdrop:"blur",motionProps:{variants:{enter:{y:0,opacity:1,transition:{duration:.25,ease:"easeOut"}},exit:{y:10,opacity:0,transition:{duration:.15,ease:"easeIn"}}}},classNames:{backdrop:"bg-black/60",base:"shadow-2xl border border-zinc-200 dark:border-zinc-700",header:"border-b border-zinc-200 dark:border-zinc-700 px-6 py-4",body:"p-6",footer:"border-t border-zinc-200 dark:border-zinc-700 px-6 py-4"},children:(0,gt.jsx)(Md,{className:"bg-white dark:bg-zinc-800",children:e=>(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsxs)(Pd,{className:"flex items-center gap-3",children:[(0,gt.jsx)("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:(0,gt.jsx)(jf,{className:"w-5 h-5 text-primary"})}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h3",{className:"text-lg font-semibold",children:"Record Purchase"}),(0,gt.jsx)("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 font-normal",children:"Add film rolls from a single order"})]})]}),(0,gt.jsxs)(kd,{className:"gap-6",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("p",{className:"text-sm font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wide mb-3",children:"Order Details"}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"140px 1fr 1fr 120px",gap:"16px"},children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-2",children:"Date"}),(0,gt.jsx)(Nf,{type:"date",size:"md",value:o.order_date,onChange:e=>d("order_date",e.target.value),classNames:ym})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-2",children:"Channel"}),(0,gt.jsx)(Nf,{size:"md",placeholder:"Taobao, eBay...",value:o.channel,onChange:e=>d("channel",e.target.value),classNames:ym})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-2",children:"Vendor"}),(0,gt.jsx)(Nf,{size:"md",placeholder:"Vendor name",value:o.vendor,onChange:e=>d("vendor",e.target.value),classNames:ym})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("label",{className:"block text-sm text-zinc-500 dark:text-zinc-400 mb-2",children:"Shipping"}),(0,gt.jsx)(Nf,{type:"number",size:"md",placeholder:"0.00",startContent:(0,gt.jsx)("span",{className:"text-zinc-400 dark:text-zinc-500 text-sm pr-1",children:"\xa5"}),value:o.shipping_cost,onChange:e=>d("shipping_cost",e.target.value),classNames:ym})]})]})]}),(0,gt.jsx)(Ja,{}),(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,gt.jsxs)("p",{className:"text-sm font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wide flex items-center gap-2",children:[(0,gt.jsx)(Da,{size:16}),"Films (",o.items.length,")"]}),(0,gt.jsx)(La.T,{size:"sm",variant:"flat",color:"primary",startContent:(0,gt.jsx)(Ud,{size:14}),onPress:p,children:"Add Row"})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 55px 90px 130px 70px 36px",gap:"12px",padding:"0 10px",marginBottom:"10px"},className:"text-xs text-zinc-400 dark:text-zinc-500 font-medium",children:[(0,gt.jsx)("div",{children:"Film Type"}),(0,gt.jsx)("div",{style:{textAlign:"center"},children:"Qty"}),(0,gt.jsx)("div",{children:"Price"}),(0,gt.jsx)("div",{children:"Expiry"}),(0,gt.jsx)("div",{children:"Batch"}),(0,gt.jsx)("div",{})]}),(0,gt.jsx)(_f,{className:"max-h-[240px]",children:(0,gt.jsx)("div",{className:"space-y-2",children:(0,gt.jsx)(ld.N,{children:o.items.map((e,t)=>{const n=(r=e.film_id,i.find(e=>String(e.id)===String(r)));var r;const a=_m(n);return(0,gt.jsxs)(ju.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,height:0},transition:{duration:.15},style:{display:"grid",gridTemplateColumns:"1fr 55px 90px 130px 70px 36px",gap:"12px",alignItems:"center",padding:"10px",borderRadius:"8px",background:"rgba(255,255,255,0.03)"},className:"hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:[(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,gt.jsx)("div",{style:{width:"36px",height:"36px",borderRadius:"6px",overflow:"hidden",background:"#27272a",flexShrink:0},children:a?(0,gt.jsx)("img",{src:a,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,gt.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,gt.jsx)(Da,{size:16,className:"text-zinc-400 dark:text-zinc-500"})})}),(0,gt.jsx)(Sf,{size:"md","aria-label":"Select film",placeholder:"Select...",selectedKeys:e.film_id?[String(e.film_id)]:[],onSelectionChange:e=>{const n=Array.from(e)[0]||"";h(t,"film_id",n)},classNames:{base:"bg-transparent",trigger:"h-10 min-h-10 bg-transparent dark:bg-zinc-700/50 border-zinc-300 dark:border-zinc-600",value:"text-sm pr-6 text-zinc-900 dark:text-zinc-100",innerWrapper:"pr-6 bg-transparent",selectorIcon:"right-2 text-zinc-500 dark:text-zinc-400",popoverContent:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-xl",listbox:"bg-white dark:bg-zinc-800"},popoverProps:{classNames:{content:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-2xl"}},style:{flex:1,minWidth:0},children:i.map(e=>{const t=_m(e);return(0,gt.jsx)(Tf,{textValue:`${e.brand||""} ${e.name}`,className:"py-2",children:(0,gt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,gt.jsx)("div",{style:{width:"28px",height:"28px",borderRadius:"4px",overflow:"hidden",background:"#3f3f46",flexShrink:0},children:t?(0,gt.jsx)("img",{src:t,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,gt.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,gt.jsx)(Da,{size:12,className:"text-zinc-500"})})}),(0,gt.jsxs)("span",{className:"text-sm text-zinc-900 dark:text-zinc-100",children:[e.brand?`${e.brand} `:"",e.name]})]})},String(e.id))})})]}),(0,gt.jsx)("div",{children:(0,gt.jsx)(Nf,{type:"number",size:"md",min:1,value:String(e.quantity),onChange:e=>h(t,"quantity",e.target.value),classNames:bm})}),(0,gt.jsx)("div",{children:(0,gt.jsx)(Nf,{type:"number",size:"md",placeholder:"0.00",startContent:(0,gt.jsx)("span",{className:"text-zinc-400 dark:text-zinc-500 text-sm pr-1",children:"\xa5"}),value:e.unit_price,onChange:e=>h(t,"unit_price",e.target.value),classNames:ym})}),(0,gt.jsx)("div",{children:(0,gt.jsx)(Nf,{type:"date",size:"md",value:e.expiry_date,onChange:e=>h(t,"expiry_date",e.target.value),classNames:ym})}),(0,gt.jsx)("div",{children:(0,gt.jsx)(Nf,{size:"md",placeholder:"#",value:e.batch_code,onChange:e=>h(t,"batch_code",e.target.value),classNames:ym})}),(0,gt.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,gt.jsx)(La.T,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:o.items.length<=1,onPress:()=>(e=>{o.items.length<=1||s(t=>({...t,items:t.items.filter((t,n)=>n!==e)}))})(t),style:{minWidth:"28px",width:"28px",height:"28px"},children:(0,gt.jsx)(gm,{size:14})})})]},t)})})})})]})]}),(0,gt.jsxs)(Ld,{children:[(0,gt.jsxs)("div",{className:"flex-1 flex items-center gap-6 text-sm",children:[(0,gt.jsxs)("span",{className:"flex items-center gap-2 text-zinc-500 dark:text-zinc-400",children:[(0,gt.jsx)(rp,{size:16}),(0,gt.jsx)("span",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:l})," rolls"]}),(0,gt.jsxs)("span",{className:"text-zinc-500 dark:text-zinc-400",children:["\xa5",u.toFixed(2),"/roll shipping"]}),(0,gt.jsxs)("span",{className:"font-semibold text-lg text-zinc-900 dark:text-zinc-100",children:["Total: \xa5",c.toFixed(2)]})]}),(0,gt.jsx)(La.T,{variant:"flat",onPress:e,children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:f,isLoading:a,children:"Save Purchase"})]})]})})})}function Sm(){const e=se(),t=At(),[n,i]=(0,r.useState)({isOpen:!1,type:"alert",title:"",message:"",onConfirm:null}),[a,o]=(0,r.useState)("all"),[s,l]=(0,r.useState)(""),[c,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[m,g]=(0,r.useState)(null),[v,A]=(0,r.useState)(null),[y,b]=(0,r.useState)(null),[x,_]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),T=(e,t)=>{i({isOpen:!0,type:"alert",title:e,message:t,onConfirm:()=>i(e=>({...e,isOpen:!1}))})},{data:C}=Rn({queryKey:["films"],queryFn:bn.ip,...vn("films")}),{data:M,isLoading:E}=Rn({queryKey:["filmItems"],queryFn:()=>(0,bn.t1)(),...vn("filmItems")}),P=Array.isArray(C)?C:[],N=M&&Array.isArray(M.items)?M.items:[],k=[...new Set(P.map(e=>e.format).filter(Boolean))].sort(),R=N.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),L=N.length;let O="all"===a?N:N.filter(e=>e.status===a);s&&(O=O.filter(e=>{const t=P.find(t=>t.id===e.film_id);return t&&t.format===s})),O=r.useMemo(()=>{const e=["loaded","in_stock","shot","sent_to_lab","developed","archived"];return[...O].sort((t,n)=>{const r=t.status||"in_stock",i=n.status||"in_stock",o=e.indexOf(r),s=e.indexOf(i);if("all"===a)if(-1!==o&&-1!==s){if(o!==s)return o-s}else{if(-1!==o)return-1;if(-1!==s)return 1}if("in_stock"===r)return t.expiry_date?n.expiry_date?t.expiry_date.localeCompare(n.expiry_date):-1:1;{const e=e=>"loaded"===e.status?e.loaded_date:e.finished_date||e.loaded_date||e.purchase_date||"",r=e(t)||"",i=e(n)||"";return r===i?(n.id||0)-(t.id||0):i.localeCompare(r)}})},[O,a]);const j=ka({mutationFn:bn.HW,onSuccess:()=>{t.invalidateQueries(["filmItems"])}});return(0,gt.jsxs)("div",{className:"min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6 pb-20",children:[(0,gt.jsx)(ir.A,{isOpen:n.isOpen,type:n.type,title:n.title,message:n.message,onConfirm:n.onConfirm,onCancel:n.onCancel}),(0,gt.jsx)(ju.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6",children:(0,gt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,gt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,gt.jsx)(rp,{className:"w-7 h-7 text-primary"}),(0,gt.jsx)("h1",{className:"text-2xl font-semibold text-zinc-900 dark:text-zinc-100",children:"Film Inventory"})]}),(0,gt.jsx)(La.T,{color:"primary",startContent:(0,gt.jsx)(Ud,{className:"w-4 h-4"}),onPress:()=>u(!0),children:"Add Purchase"})]})}),(0,gt.jsx)(pm,{selectedStatus:a,onStatusChange:o,statusCounts:R,totalCount:L,formatFilter:s,onFormatChange:l,availableFormats:k}),(0,gt.jsx)(ju.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:E?(0,gt.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,gt.jsx)(np.o,{size:"lg",color:"primary"})}):0===O.length?(0,gt.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-zinc-400 dark:text-zinc-500",children:[(0,gt.jsx)(ip,{className:"w-12 h-12 mb-4"}),(0,gt.jsx)("p",{className:"text-lg",children:"No inventory records found"}),(0,gt.jsx)("p",{className:"text-sm",children:"Try adjusting your filters or add a new purchase"})]}):(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-6 gap-5",style:{alignItems:"start"},children:O.map((n,r)=>{const a=P.find(e=>e.id===n.film_id),o=w===n.id;return(0,gt.jsx)("div",{className:o?"col-span-4 row-span-2":"",style:{transition:"none"},children:(0,gt.jsx)(Am,{isExpanded:o,onToggleExpand:()=>S(o?null:n.id),item:n,film:a,onLoad:()=>f(n.id),onUnload:()=>g(n.id),onLogShots:()=>_(n.id),onDevelop:()=>A(n.id),onCreateRoll:()=>{e("/rolls/new",{state:{filmItemId:n.id,developInfo:{develop_lab:n.develop_lab,develop_process:n.develop_process,develop_date:n.develop_date,develop_cost:n.develop_price,develop_note:n.develop_note}}})},onArchive:()=>{b(n.id)},onEdit:()=>h(n),onDelete:()=>{var e;e=async()=>{try{const e=await(0,bn.Jv)(n.id,!0);if(!e.ok)throw new Error(e.error||"Delete failed");t.invalidateQueries(["filmItems"])}catch(e){console.error(e),T("Error","Failed to delete: "+e.message)}},i({isOpen:!0,type:"confirm",title:"Delete Film Item",message:"Permanently delete this film item? This cannot be undone.",onConfirm:()=>{e(),i(e=>({...e,isOpen:!1}))},onCancel:()=>i(e=>({...e,isOpen:!1}))})},onViewRoll:t=>e(`/rolls/${t}`),onToggleNegativeArchived:async()=>{await(0,bn.lm)(n.id,{negative_archived:n.negative_archived?0:1}),t.invalidateQueries(["filmItems"])}})},n.id)})})}),p&&(0,gt.jsx)(tm,{item:N.find(e=>e.id===p),isOpen:!!p,onClose:()=>f(null),onLoaded:async e=>{(e&&e.optimistic&&e.item||e&&e.item)&&t.setQueryData(["filmItems"],t=>t&&Array.isArray(t.items)?{...t,items:t.items.map(t=>t.id===e.item.id?e.item:t)}:t)}}),m&&(0,gt.jsx)(nm,{item:N.find(e=>e.id===m),isOpen:!!m,onClose:()=>g(null),onUnloaded:async e=>{(e&&e.optimistic&&e.item||e&&e.item)&&t.setQueryData(["filmItems"],t=>t&&Array.isArray(t.items)?{...t,items:t.items.map(t=>t.id===e.item.id?e.item:t)}:t)}}),v&&(0,gt.jsx)(rm,{item:N.find(e=>e.id===v),isOpen:!!v,onClose:()=>A(null),onDeveloped:async e=>{(e&&e.optimistic&&e.item||e&&e.item)&&t.setQueryData(["filmItems"],t=>t&&Array.isArray(t.items)?{...t,items:t.items.map(t=>t.id===e.item.id?e.item:t)}:t)}}),x&&(0,gt.jsx)(cm,{item:N.find(e=>e.id===x),isOpen:!!x,onClose:()=>_(null),onUpdated:async()=>{await t.invalidateQueries(["filmItems"])}}),y&&(0,gt.jsx)(im,{item:N.find(e=>e.id===y),isOpen:!!y,onClose:()=>b(null),onArchived:async e=>{b(null),(e&&e.optimistic||e&&e.item)&&t.setQueryData(["filmItems"],t=>t&&Array.isArray(t.items)?{...t,items:t.items.map(t=>t.id===e.item.id?e.item:t)}:t)}}),d&&(0,gt.jsx)($f,{item:d,isOpen:!!d,onClose:()=>h(null),onUpdated:async()=>{await t.invalidateQueries(["filmItems"])}}),c&&(0,gt.jsx)(wm,{isOpen:c,onClose:()=>u(!1),films:P,isLoading:j.isLoading,onSubmit:async e=>{try{await j.mutateAsync(e),u(!1)}catch(t){console.error(t),T("Error","Create film items failed")}}})]})}var[Tm,Cm]=(0,eo.q)({name:"CardContext",strict:!0,errorMessage:"useCardContext: `context` is undefined. Seems you forgot to wrap component within <Card />"}),Mm=n(5773);var Em=n(7157),Pm=(0,Ln.Rf)((e,t)=>{const{children:n,context:i,Component:a,isPressable:o,disableAnimation:s,disableRipple:l,getCardProps:c,getRippleProps:u}=function(e){var t,n,i,a;const o=(0,Bn.o)(),[s,l]=(0,Ln.rE)(e,qa.Nr.variantKeys),{ref:c,as:u,children:d,onClick:h,onPress:p,autoFocus:f,className:m,classNames:g,allowTextSelectionOnPress:v=!0,...A}=s,y=(0,Wa.zD)(c),b=u||(e.isPressable?"button":"div"),x="string"===typeof b,_=null!=(n=null!=(t=e.disableAnimation)?t:null==o?void 0:o.disableAnimation)&&n,w=null!=(a=null!=(i=e.disableRipple)?i:null==o?void 0:o.disableRipple)&&a,S=(0,Dn.cn)(null==g?void 0:g.base,m),{onClear:T,onPress:C,ripples:M}=(0,Mm.k)(),E=(0,r.useCallback)(e=>{w||_||y.current&&C(e)},[w,_,y,C]),{buttonProps:P,isPressed:N}=(0,id.l)({onPress:(0,In.cy)(p,E),elementType:u,isDisabled:!e.isPressable,onClick:h,allowTextSelectionOnPress:v,...A},y),{hoverProps:k,isHovered:R}=(0,qo.M)({isDisabled:!e.isHoverable,...A}),{isFocusVisible:L,isFocused:O,focusProps:j}=(0,Oo.o)({autoFocus:f}),D=(0,r.useMemo)(()=>(0,qa.Nr)({...l,disableAnimation:_}),[(0,In.t6)(l),_]),I=(0,r.useMemo)(()=>({slots:D,classNames:g,disableAnimation:_,isDisabled:e.isDisabled,isFooterBlurred:e.isFooterBlurred,fullWidth:e.fullWidth}),[D,g,e.isDisabled,e.isFooterBlurred,_,e.fullWidth]),B=(0,r.useCallback)((t={})=>({ref:y,className:D.base({class:S}),tabIndex:e.isPressable?0:-1,"data-hover":(0,In.sE)(R),"data-pressed":(0,In.sE)(N),"data-focus":(0,In.sE)(O),"data-focus-visible":(0,In.sE)(L),"data-disabled":(0,In.sE)(e.isDisabled),...(0,In.v6)(e.isPressable?{...P,...j,role:"button"}:{},e.isHoverable?k:{},(0,Xa.$)(A,{enabled:x}),(0,Xa.$)(t))}),[y,D,S,x,e.isPressable,e.isHoverable,e.isDisabled,R,N,L,P,j,k,A]),F=(0,r.useCallback)(()=>({ripples:M,onClear:T}),[M,T]);return{context:I,domRef:y,Component:b,classNames:g,children:d,isHovered:R,isPressed:N,disableAnimation:_,isPressable:e.isPressable,isHoverable:e.isHoverable,disableRipple:w,handlePress:E,isFocusVisible:L,getCardProps:B,getRippleProps:F}}({...e,ref:t});return(0,gt.jsxs)(a,{...c(),children:[(0,gt.jsx)(Tm,{value:i,children:n}),o&&!s&&!l&&(0,gt.jsx)(Em.j,{...u()})]})});Pm.displayName="HeroUI.Card";var Nm=Pm,km=(0,Ln.Rf)((e,t)=>{var n;const{as:r,className:i,children:a,...o}=e,s=r||"div",l=(0,Wa.zD)(t),{slots:c,classNames:u}=Cm(),d=(0,Dn.cn)(null==u?void 0:u.body,i);return(0,gt.jsx)(s,{ref:l,className:null==(n=c.body)?void 0:n.call(c,{class:d}),...o,children:a})});km.displayName="HeroUI.CardBody";var Rm=km;const Lm=$n("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Om=$n("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),jm=$n("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function Dm({onPhotoClick:e}){const[t,n]=(0,r.useState)([]),[i,a]=(0,r.useState)(0),[o,s]=(0,r.useState)(!0),[l,c]=(0,r.useState)(!1),u=(0,r.useCallback)(async()=>{try{c(!0);const e=(0,bn.Gi)(),t=await fetch(`${e}/api/photos/random?limit=8`),r=await t.json();if(Array.isArray(r)){const e=r.filter(e=>e.positive_rel_path||e.full_rel_path);n(e),a(0)}}catch(or){console.error("Failed to load random photos:",or)}finally{s(!1),c(!1)}},[]);(0,r.useEffect)(()=>{u()},[u]),(0,r.useEffect)(()=>{if(t.length<=1)return;const e=setInterval(()=>{a(e=>(e+1)%t.length)},8e3);return()=>clearInterval(e)},[t.length]);const d=e=>e?(0,bn.FH)(e.positive_rel_path||e.full_rel_path):"";if(o)return(0,gt.jsx)(Nm,{className:"w-full aspect-[3/2] max-h-[75vh] mb-8 bg-default-100 border-none",children:(0,gt.jsx)(Rm,{className:"flex items-center justify-center",children:(0,gt.jsx)(np.o,{size:"lg",color:"primary"})})});if(0===t.length)return(0,gt.jsx)(Nm,{className:"w-full aspect-[3/2] max-h-[75vh] mb-8 bg-default-100 border-none",children:(0,gt.jsxs)(Rm,{className:"flex flex-col items-center justify-center gap-4 text-default-400",children:[(0,gt.jsx)("p",{children:"No photos available"}),(0,gt.jsx)(La.T,{variant:"flat",color:"primary",onPress:u,startContent:(0,gt.jsx)(Lm,{size:16}),children:"Retry"})]})});const h=t[i],p=(i+1)%t.length,f=(i-1+t.length)%t.length;return(0,gt.jsx)(Nm,{className:"w-full aspect-[3/2] max-h-[75vh] mb-8 overflow-hidden group shadow-2xl border-none bg-black relative isolate",children:(0,gt.jsxs)(Rm,{className:"p-0 relative w-full h-full overflow-hidden",children:[(0,gt.jsx)("div",{className:"absolute inset-0 z-30 cursor-pointer",onClick:()=>null===e||void 0===e?void 0:e(h,t),role:"button","aria-label":"View photo details"}),t.map((e,t)=>(0,gt.jsx)("img",{src:d(e),alt:e.caption||e.roll_title||"",className:"absolute inset-0 w-full h-full object-cover z-0",style:{opacity:t===i?1:0,transition:"opacity 0.8s ease-in-out",willChange:t===i||t===p||t===f?"opacity":"auto"},draggable:!1},e.id)),(0,gt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-80 z-0 pointer-events-none"}),(0,gt.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 z-20 pointer-events-none",children:(0,gt.jsxs)("div",{className:"transition-opacity duration-500",style:{opacity:1},children:[(0,gt.jsx)("h2",{className:"text-white text-3xl md:text-4xl font-bold mb-3 tracking-tight drop-shadow-lg",children:h.roll_title||"Untitled"}),(0,gt.jsx)("p",{className:"text-white/70 text-xs md:text-sm drop-shadow-lg",children:[h.date&&new Date(h.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),h.city,h.camera_name,h.lens_name,h.film_name].filter(Boolean).join(" \xb7 ")}),(()=>{const e=h.aperture,t=h.shutter_speed,n=h.iso||h.roll_iso||h.film_iso;if(!(e||t))return null;const r=[];return e&&r.push(`\u0192/${e}`),t&&r.push(t),n&&r.push(`ISO ${n}`),(0,gt.jsx)("p",{className:"text-white/60 text-xs md:text-sm drop-shadow-lg mt-1",children:r.join(" \xb7 ")})})(),h.caption&&(0,gt.jsx)("p",{className:"text-white/60 text-xs md:text-sm drop-shadow-lg mt-2 max-w-2xl line-clamp-2",children:h.caption})]})}),t.length>1&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"flat",radius:"full",className:"absolute left-6 top-1/2 -translate-y-1/2 bg-black/30 text-white opacity-0 group-hover:opacity-100 transition-all hover:bg-black/50 backdrop-blur-sm z-50",onPress:e=>{a(e=>(e-1+t.length)%t.length)},children:(0,gt.jsx)(Om,{size:28})}),(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"flat",radius:"full",className:"absolute right-6 top-1/2 -translate-y-1/2 bg-black/30 text-white opacity-0 group-hover:opacity-100 transition-all hover:bg-black/50 backdrop-blur-sm z-50",onPress:e=>{a(e=>(e+1)%t.length)},children:(0,gt.jsx)(jm,{size:28})})]}),(0,gt.jsx)("div",{className:"absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 z-50",children:(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"flat",radius:"full",className:"bg-black/40 text-white backdrop-blur-md hover:bg-black/60",isLoading:l,onPress:u,children:(0,gt.jsx)(Lm,{size:18})})}),t.length>1&&(0,gt.jsx)("div",{className:"absolute bottom-6 right-1/2 translate-x-1/2 md:right-12 md:translate-x-0 flex gap-2 z-50",children:t.map((e,t)=>(0,gt.jsx)("button",{onClick:e=>{e.stopPropagation(),a(t)},className:"h-1.5 rounded-full transition-all duration-300 cursor-pointer "+(t===i?"bg-white w-8 opacity-100":"bg-white/40 w-2 hover:bg-white/60")},t))})]})})}const Im=$n("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),Bm=[{key:"rolls",icon:Ia,label:"Rolls",color:"text-primary",path:"/rolls"},{key:"photos",icon:Du,label:"Photos",color:"text-success",path:"/rolls"},{key:"favorites",icon:Im,label:"Favorites",color:"text-danger",path:"/favorites"},{key:"locations",icon:Fa,label:"Locations",color:"text-warning",path:"/map"},{key:"films",icon:Da,label:"Films",color:"text-secondary",path:"/films"}];async function Fm(){const e=(0,bn.Gi)(),[t,n,r,i,a]=await Promise.all([fetch(`${e}/api/rolls`).then(e=>e.json()),fetch(`${e}/api/photos`).then(e=>e.json()),fetch(`${e}/api/photos?favorite=true`).then(e=>e.json()),fetch(`${e}/api/locations?hasRecords=true`).then(e=>e.json()),fetch(`${e}/api/films`).then(e=>e.json())]);return{rolls:Array.isArray(t)?t.length:0,photos:Array.isArray(n)?n.length:0,favorites:Array.isArray(r)?r.length:0,locations:Array.isArray(i)?i.length:0,films:Array.isArray(a)?a.length:0}}function zm(){const e=se(),{data:t,isLoading:n}=Rn({queryKey:["quickStats"],queryFn:Fm,...vn("stats")});return(0,gt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8",children:Bm.map((r,i)=>{var a;return(0,gt.jsx)(ju.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*i,duration:.3},className:"h-full",children:(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-900 shadow-none hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group h-full border-none",isPressable:!0,onPress:()=>r.path&&e(r.path),children:(0,gt.jsxs)(Rm,{className:"p-4 flex flex-row items-center gap-5",children:[(0,gt.jsx)("div",{className:`p-4 rounded-2xl bg-zinc-100 dark:bg-zinc-800 ${r.color} group-hover:scale-110 group-hover:rotate-3 transition-all duration-300`,children:(0,gt.jsx)(r.icon,{size:28})}),(0,gt.jsx)("div",{className:"flex-1",children:n?(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(zn,{className:"w-16 h-8 rounded-lg mb-2"}),(0,gt.jsx)(zn,{className:"w-12 h-4 rounded-lg"})]}):(0,gt.jsxs)("div",{className:"flex flex-col items-start",children:[(0,gt.jsx)("span",{className:"text-3xl font-black text-zinc-900 dark:text-zinc-100 tracking-tight",children:(null===t||void 0===t||null===(a=t[r.key])||void 0===a?void 0:a.toLocaleString())||0}),(0,gt.jsx)("span",{className:"text-xs text-zinc-400 dark:text-zinc-500 font-medium uppercase tracking-wider",children:r.label})]})})]})})},r.key)})})}const Um=new WeakMap;function Vm(e,t,n){if(!e)return"";return"string"===typeof t&&(t=t.replace(/\s+/g,"")),`${Um.get(e)}-${n}-${t}`}function Gm(e,t){let n=null===t||void 0===t?void 0:t.isDisabled,[i,a]=(0,r.useState)(!1);return(0,ho.N)(()=>{if((null===e||void 0===e?void 0:e.current)&&!n){let t=()=>{if(e.current){let t=(0,Ro.N$)(e.current,{tabbable:!0});a(!!t.nextNode())}};t();let n=new MutationObserver(t);return n.observe(e.current,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["tabIndex","disabled"]}),()=>{n.disconnect()}}}),!n&&i}function qm(e,t,n){let r=Gm(n)?void 0:0;var i;const a=Vm(t,null!==(i=e.id)&&void 0!==i?i:null===t||void 0===t?void 0:t.selectedKey,"tabpanel"),o=(0,yp.b)({...e,id:a,"aria-labelledby":Vm(t,null===t||void 0===t?void 0:t.selectedKey,"tab")});return{tabPanelProps:(0,go.v)(o,{tabIndex:r,role:"tabpanel","aria-describedby":e["aria-describedby"],"aria-details":e["aria-details"]})}}var Wm=(0,Ln.Rf)((e,t)=>{var n,r;const{as:i,tabKey:a,destroyInactiveTabPanel:o,state:s,className:l,slots:c,classNames:u,...d}=e,h=i||"div",p=(0,Wa.zD)(t),{tabPanelProps:f}=qm({...e,id:String(a)},s,p),{focusProps:m,isFocused:g,isFocusVisible:v}=(0,Oo.o)(),A=s.selectedItem,y=s.collection.getItem(a).props.children,b=(0,Dn.cn)(null==u?void 0:u.panel,l,null==(n=null==A?void 0:A.props)?void 0:n.className),x=a===(null==A?void 0:A.key);return!y||!x&&o?null:(0,gt.jsx)(h,{ref:p,"data-focus":g,"data-focus-visible":v,"data-inert":x?void 0:"true",inert:(0,In.QA)(!x),...x&&(0,In.v6)(f,m,d),className:null==(r=c.panel)?void 0:r.call(c,{class:b}),"data-slot":"panel",children:y})});Wm.displayName="HeroUI.TabPanel";var Hm=Wm;const $m=e=>"object"==typeof e&&null!=e&&1===e.nodeType,Km=(e,t)=>(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e,Xm=(e,t)=>{if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){const n=getComputedStyle(e,null);return Km(n.overflowY,t)||Km(n.overflowX,t)||(e=>{const t=(e=>{if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}})(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)})(e)}return!1},Ym=(e,t,n,r,i,a,o,s)=>a<e&&o>t||a>e&&o<t?0:a<=e&&s<=n||o>=t&&s>=n?a-e-r:o>t&&s<n||a<e&&s>n?o-t+i:0,Qm=e=>{const t=e.parentElement;return null==t?e.getRootNode().host||null:t},Zm=(e,t)=>{var n,r,i,a;if("undefined"==typeof document)return[];const{scrollMode:o,block:s,inline:l,boundary:c,skipOverflowHiddenElements:u}=t,d="function"==typeof c?c:e=>e!==c;if(!$m(e))throw new TypeError("Invalid target");const h=document.scrollingElement||document.documentElement,p=[];let f=e;for(;$m(f)&&d(f);){if(f=Qm(f),f===h){p.push(f);break}null!=f&&f===document.body&&Xm(f)&&!Xm(document.documentElement)||null!=f&&Xm(f,u)&&p.push(f)}const m=null!=(r=null==(n=window.visualViewport)?void 0:n.width)?r:innerWidth,g=null!=(a=null==(i=window.visualViewport)?void 0:i.height)?a:innerHeight,{scrollX:v,scrollY:A}=window,{height:y,width:b,top:x,right:_,bottom:w,left:S}=e.getBoundingClientRect(),{top:T,right:C,bottom:M,left:E}=(e=>{const t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e);let P="start"===s||"nearest"===s?x-T:"end"===s?w+M:x+y/2-T+M,N="center"===l?S+b/2-E+C:"end"===l?_+C:S-E;const k=[];for(let R=0;R<p.length;R++){const e=p[R],{height:t,width:n,top:r,right:i,bottom:a,left:c}=e.getBoundingClientRect();if("if-needed"===o&&x>=0&&S>=0&&w<=g&&_<=m&&(e===h&&!Xm(e)||x>=r&&w<=a&&S>=c&&_<=i))return k;const u=getComputedStyle(e),d=parseInt(u.borderLeftWidth,10),f=parseInt(u.borderTopWidth,10),T=parseInt(u.borderRightWidth,10),C=parseInt(u.borderBottomWidth,10);let M=0,E=0;const L="offsetWidth"in e?e.offsetWidth-e.clientWidth-d-T:0,O="offsetHeight"in e?e.offsetHeight-e.clientHeight-f-C:0,j="offsetWidth"in e?0===e.offsetWidth?0:n/e.offsetWidth:0,D="offsetHeight"in e?0===e.offsetHeight?0:t/e.offsetHeight:0;if(h===e)M="start"===s?P:"end"===s?P-g:"nearest"===s?Ym(A,A+g,g,f,C,A+P,A+P+y,y):P-g/2,E="start"===l?N:"center"===l?N-m/2:"end"===l?N-m:Ym(v,v+m,m,d,T,v+N,v+N+b,b),M=Math.max(0,M+A),E=Math.max(0,E+v);else{M="start"===s?P-r-f:"end"===s?P-a+C+O:"nearest"===s?Ym(r,a,t,f,C+O,P,P+y,y):P-(r+t/2)+O/2,E="start"===l?N-c-d:"center"===l?N-(c+n/2)+L/2:"end"===l?N-i+T+L:Ym(c,i,n,d,T+L,N,N+b,b);const{scrollLeft:o,scrollTop:u}=e;M=0===D?0:Math.max(0,Math.min(u+M/D,e.scrollHeight-t/D+O)),E=0===j?0:Math.max(0,Math.min(o+E/j,e.scrollWidth-n/j+L)),P+=u-M,N+=o-E}k.push({el:e,top:M,left:E})}return k};function Jm(e,t){if(!e.isConnected||!(e=>{let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1})(e))return;if((e=>"object"==typeof e&&"function"==typeof e.behavior)(t))return t.behavior(Zm(e,t));const n="boolean"==typeof t||null==t?void 0:t.behavior;for(const{el:r,top:i,left:a}of Zm(e,(e=>!1===e?{block:"end",inline:"nearest"}:(e=>e===Object(e)&&0!==Object.keys(e).length)(e)?e:{block:"start",inline:"nearest"})(t)))r.scroll({top:i,left:a,behavior:n})}var eg=(0,Ln.Rf)((e,t)=>{var n;const{className:r,as:i,item:a,state:o,classNames:s,isDisabled:l,listRef:c,slots:u,shouldSelectOnPressUp:d,tabRef:h,...p}=e,{key:f}=a,m=(0,Wa.zD)(t),g=i||(e.href?"a":"button"),v="string"===typeof g,{tabProps:A,isSelected:y,isDisabled:b,isPressed:x}=function(e,t,n){let{key:r,isDisabled:i,shouldSelectOnPressUp:a}=e,{selectionManager:o,selectedKey:s}=t,l=r===s,c=i||t.isDisabled||t.selectionManager.isDisabled(r),{itemProps:u,isPressed:d}=as({selectionManager:o,key:r,ref:n,isDisabled:c,shouldSelectOnPressUp:a,linkBehavior:"selection"}),h=Vm(t,r,"tab"),p=Vm(t,r,"tabpanel"),{tabIndex:f}=u,m=t.collection.getItem(r),g=(0,Io.$)(null===m||void 0===m?void 0:m.props,{labelable:!0});delete g.id;let v=(0,Do._h)(null===m||void 0===m?void 0:m.props),{focusableProps:A}=(0,Mf.Wc)({isDisabled:c},n);return{tabProps:(0,go.v)(g,A,v,u,{id:h,"aria-selected":l,"aria-disabled":c||void 0,"aria-controls":l?p:void 0,tabIndex:c?void 0:f,role:"tab"}),isSelected:l,isDisabled:c,isPressed:d}}({key:f,isDisabled:l,shouldSelectOnPressUp:d},o,m);null==e.children&&delete A["aria-controls"];const _=l||b,{focusProps:w,isFocused:S,isFocusVisible:T}=(0,Oo.o)(),{hoverProps:C,isHovered:M}=(0,qo.M)({isDisabled:_}),E=(0,Dn.cn)(null==s?void 0:s.tab,r);return(0,gt.jsx)(g,{ref:_o(m,h),"data-disabled":(0,In.sE)(b),"data-focus":(0,In.sE)(S),"data-focus-visible":(0,In.sE)(T),"data-hover":(0,In.sE)(M),"data-hover-unselected":(0,In.sE)((M||x)&&!y),"data-key":f,"data-pressed":(0,In.sE)(x),"data-selected":(0,In.sE)(y),"data-slot":"tab",...(0,In.v6)(A,_?{}:{...w,...C},(0,Xa.$)(p,{enabled:v,omitPropNames:new Set(["title"]),omitEventNames:new Set(["onClick"])}),{onClick:(0,In.cy)(()=>{(null==m?void 0:m.current)&&(null==c?void 0:c.current)&&Jm(m.current,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"end",boundary:null==c?void 0:c.current})},A.onClick)}),className:null==(n=u.tab)?void 0:n.call(u,{class:E}),title:null==p?void 0:p.titleValue,type:"button"===g?"button":void 0,children:(0,gt.jsx)("div",{className:u.tabContent({class:null==s?void 0:s.tabContent}),"data-slot":"tabContent",children:a.rendered})})});eg.displayName="HeroUI.Tab";var tg=eg;function ng(e){var t;let[n,i]=(0,Os.P)(e.selectedKey,null!==(t=e.defaultSelectedKey)&&void 0!==t?t:null,e.onSelectionChange),a=(0,r.useMemo)(()=>null!=n?[n]:[],[n]),{collection:o,disabledKeys:s,selectionManager:l}=sp({...e,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:a,onSelectionChange:t=>{if("all"===t)return;var r;let a=null!==(r=t.values().next().value)&&void 0!==r?r:null;a===n&&e.onSelectionChange&&e.onSelectionChange(a),i(a)}}),c=null!=n?o.getItem(n):null;return{collection:o,disabledKeys:s,selectionManager:l,selectedKey:n,setSelectedKey:i,selectedItem:c}}function rg(e){var t,n;let i=ng({...e,onSelectionChange:e.onSelectionChange?t=>{var n;null!=t&&(null===(n=e.onSelectionChange)||void 0===n||n.call(e,t))}:void 0,suppressTextValueWarning:!0,defaultSelectedKey:null!==(n=null!==(t=e.defaultSelectedKey)&&void 0!==t?t:ig(e.collection,e.disabledKeys?new Set(e.disabledKeys):new Set))&&void 0!==n?n:void 0}),{selectionManager:a,collection:o,selectedKey:s}=i,l=(0,r.useRef)(s);return(0,r.useEffect)(()=>{let t=s;null!=e.selectedKey||!a.isEmpty&&null!=t&&o.getItem(t)||(t=ig(o,i.disabledKeys),null!=t&&a.setSelectedKeys([t])),(null!=t&&null==a.focusedKey||!a.isFocused&&t!==l.current)&&a.setFocusedKey(t),l.current=t}),{...i,isDisabled:e.isDisabled||!1}}function ig(e,t){let n=null;if(e){var r,i,a,o;for(n=e.getFirstKey();null!=n&&(t.has(n)||(null===(i=e.getItem(n))||void 0===i||null===(r=i.props)||void 0===r?void 0:r.isDisabled))&&n!==e.getLastKey();)n=e.getKeyAfter(n);null!=n&&(t.has(n)||(null===(o=e.getItem(n))||void 0===o||null===(a=o.props)||void 0===a?void 0:a.isDisabled))&&n===e.getLastKey()&&(n=e.getFirstKey())}return n}class ag{getKeyLeftOf(e){return this.flipDirection?this.getNextKey(e):this.getPreviousKey(e)}getKeyRightOf(e){return this.flipDirection?this.getPreviousKey(e):this.getNextKey(e)}isDisabled(e){var t,n;return this.disabledKeys.has(e)||!!(null===(n=this.collection.getItem(e))||void 0===n||null===(t=n.props)||void 0===t?void 0:t.isDisabled)}getFirstKey(){let e=this.collection.getFirstKey();return null!=e&&this.isDisabled(e)&&(e=this.getNextKey(e)),e}getLastKey(){let e=this.collection.getLastKey();return null!=e&&this.isDisabled(e)&&(e=this.getPreviousKey(e)),e}getKeyAbove(e){return this.tabDirection?null:this.getPreviousKey(e)}getKeyBelow(e){return this.tabDirection?null:this.getNextKey(e)}getNextKey(e){let t=e;do{t=this.collection.getKeyAfter(t),null==t&&(t=this.collection.getFirstKey())}while(null!=t&&this.isDisabled(t));return t}getPreviousKey(e){let t=e;do{t=this.collection.getKeyBefore(t),null==t&&(t=this.collection.getLastKey())}while(null!=t&&this.isDisabled(t));return t}constructor(e,t,n,r=new Set){this.collection=e,this.flipDirection="rtl"===t&&"horizontal"===n,this.disabledKeys=r,this.tabDirection="horizontal"===n}}function og(e){var t,n,i;const a=(0,Bn.o)(),[o,s]=(0,Ln.rE)(e,qa.vR.variantKeys),{ref:l,as:c,className:u,classNames:d,children:h,disableCursorAnimation:p,isVertical:f=!1,shouldSelectOnPressUp:m=!0,destroyInactiveTabPanel:g=!0,...v}=o,A=c||"div",y="string"===typeof A,b=(0,Wa.zD)(l),x=null!=(n=null!=(t=null==e?void 0:e.disableAnimation)?t:null==a?void 0:a.disableAnimation)&&n,_=null!=(i=s.placement)?i:f?"start":"top",w=f||"start"===_||"end"===_?"vertical":"horizontal",S=rg({children:h,...v}),{tabListProps:T}=function(e,t,n){let{orientation:i="horizontal",keyboardActivation:a="automatic"}=e,{collection:o,selectionManager:s,disabledKeys:l}=t,{direction:c}=(0,Ts.Y)(),u=(0,r.useMemo)(()=>new ag(o,c,i,l),[o,l,i,c]),{collectionProps:d}=Cs({ref:n,selectionManager:s,keyboardDelegate:u,selectOnFocus:"automatic"===a,disallowEmptySelection:!0,scrollRef:n,linkBehavior:"selection"}),h=(0,oo.Bi)();Um.set(t,h);let p=(0,yp.b)({...e,id:h});return{tabListProps:{...(0,go.v)(d,p),role:"tablist","aria-orientation":i,tabIndex:void 0}}}({...v,orientation:w},S,b),C=(0,r.useMemo)(()=>(0,qa.vR)({...s,disableAnimation:x,...f?{placement:"start"}:{}}),[(0,In.t6)(s),x,f]),M=(0,Dn.cn)(null==d?void 0:d.base,u),E=(0,r.useMemo)(()=>({state:S,slots:C,classNames:d,disableAnimation:x,listRef:b,shouldSelectOnPressUp:m,disableCursorAnimation:p,isDisabled:null==e?void 0:e.isDisabled}),[S,C,b,x,p,m,null==e?void 0:e.isDisabled,d]),P=(0,r.useCallback)(e=>({"data-slot":"base",className:C.base({class:(0,Dn.cn)(M,null==e?void 0:e.className)}),...(0,In.v6)((0,Xa.$)(v,{enabled:y}),e)}),[M,v,C]),N=(0,r.useCallback)(e=>({"data-slot":"tabWrapper",className:C.tabWrapper({class:(0,Dn.cn)(null==d?void 0:d.tabWrapper,null==e?void 0:e.className)}),"data-placement":_,"data-vertical":f||"start"===_||"end"===_?"vertical":"horizontal"}),[d,C,_,f]),k=(0,r.useCallback)(e=>({ref:b,"data-slot":"tabList",className:C.tabList({class:(0,Dn.cn)(null==d?void 0:d.tabList,null==e?void 0:e.className)}),...(0,In.v6)(T,e)}),[b,T,d,C]),R=(0,r.useCallback)(e=>({"data-slot":"cursor",className:C.cursor({class:(0,Dn.cn)(null==d?void 0:d.cursor,null==e?void 0:e.className)})}),[d,C]);return{Component:A,domRef:b,state:S,values:E,destroyInactiveTabPanel:g,getBaseProps:P,getTabListProps:k,getWrapperProps:N,getTabCursorProps:R}}var sg=(0,Ln.Rf)(function(e,t){const{Component:n,values:i,state:a,domRef:o,destroyInactiveTabPanel:s,getBaseProps:l,getTabListProps:c,getWrapperProps:u,getTabCursorProps:d}=og({...e,ref:t}),h={state:a,listRef:i.listRef,slots:i.slots,classNames:i.classNames,isDisabled:i.isDisabled,shouldSelectOnPressUp:i.shouldSelectOnPressUp},p=[...a.collection].map(e=>(0,gt.jsx)(tg,{item:e,...h,...e.props},e.key)),f=null==e?void 0:e.variant,m=(0,r.useRef)(void 0),g=null==e?void 0:e.isVertical,v=(0,r.useRef)(void 0),A=null==e?void 0:e.placement,y=(0,r.useRef)(void 0),b=(0,r.useRef)(null),x=a.selectedItem,_=null==x?void 0:x.key,w=(0,r.useCallback)(e=>"underlined"===f?{left:`${e.left+.1*e.width}px`,top:e.top+e.height-2+"px",width:.8*e.width+"px",height:""}:{left:`${e.left}px`,top:`${e.top}px`,width:`${e.width}px`,height:`${e.height}px`},[f]),S=(0,r.useCallback)(e=>{var t;f===m.current&&g===v.current&&A===y.current||null==(t=b.current)||t.removeAttribute("data-animated"),e(),m.current=f,v.current=g,y.current=A,requestAnimationFrame(()=>{var e,t;null==(e=b.current)||e.setAttribute("data-animated","true"),null==(t=b.current)||t.setAttribute("data-initialized","true")})},[g,f,A]),T=(0,r.useCallback)(e=>{if(!b.current)return;const t={width:e.offsetWidth,height:e.offsetHeight,left:e.offsetLeft,top:e.offsetTop},n=w(t);S(()=>{b.current.style.left=n.left,b.current.style.top=n.top,b.current.style.width=n.width,b.current.style.height=n.height})},[b.current,w,S]),C=(0,r.useCallback)(e=>{const t=e[0].contentRect;0===t.width&&0===t.height||T(e[0].target)},[T]);(0,r.useEffect)(()=>{var e;const t=null==(e=o.current)?void 0:e.querySelector(`[data-key="${_}"]`);if(!t)return;const n=new ResizeObserver(C);return n.observe(t),()=>n.disconnect()},[o.current,C,_]);const M=(0,r.useMemo)(()=>(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("div",{...l(),children:(0,gt.jsxs)(n,{...c(),children:[!i.disableAnimation&&!i.disableCursorAnimation&&null!=_&&(0,gt.jsx)("span",{...d(),ref:b}),p]})}),[...a.collection].map(e=>(0,gt.jsx)(Hm,{classNames:i.classNames,destroyInactiveTabPanel:s,slots:i.slots,state:i.state,tabKey:e.key},e.key))]}),[n,l,c,d,p,_,a.collection,i.disableAnimation,i.disableCursorAnimation,i.classNames,i.slots,i.state,s,o,b,f,g]);return"placement"in e||"isVertical"in e?(0,gt.jsx)("div",{...u(),children:M}):M}),lg=sg,cg=Ys;const ug=$n("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function dg(e,t=500){const[n,i]=(0,r.useState)(e);return(0,r.useEffect)(()=>{const n=setTimeout(()=>{i(e)},t);return()=>{clearTimeout(n)}},[e,t]),n}function hg(e={}){var t,n,r;const{rollId:i,dateRange:a,bounds:o,limit:s}=e,l=Rn({queryKey:["geoPhotos",i||"all",(null===a||void 0===a?void 0:a.start)||"",(null===a||void 0===a?void 0:a.end)||""],queryFn:()=>async function({rollId:e,dateRange:t,bounds:n,limit:r=2e3}){const i=bn.tE,a=new URLSearchParams;r&&a.append("limit",r),e&&a.append("roll_id",e),null!==t&&void 0!==t&&t.start&&a.append("date_start",t.start),null!==t&&void 0!==t&&t.end&&a.append("date_end",t.end),n&&a.append("bounds",`${n.sw_lat},${n.sw_lng},${n.ne_lat},${n.ne_lng}`);const o=`${i}/api/photos/geo?${a.toString()}`,s=await fetch(o);if(!s.ok)throw new Error(`Failed to fetch geo photos: ${s.statusText}`);return await s.json()}({rollId:i,dateRange:a,bounds:o,limit:s}),staleTime:3e5,cacheTime:18e5,refetchOnWindowFocus:!1,retry:2});return{photos:(null===(t=l.data)||void 0===t?void 0:t.photos)||[],total:(null===(n=l.data)||void 0===n?void 0:n.total)||0,returned:(null===(r=l.data)||void 0===r?void 0:r.returned)||0,isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,refetch:l.refetch}}function pg(){return pg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pg.apply(null,arguments)}function fg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mg(e,t){return mg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mg(e,t)}function gg(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,mg(e,t)}var vg=Number.isNaN||function(e){return"number"===typeof e&&e!==e};function Ag(e,t){return e===t||!(!vg(e)||!vg(t))}function yg(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Ag(e[n],t[n]))return!1;return!0}var bg=function(e,t){var n;void 0===t&&(t=yg);var r,i=[],a=!1;return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return a&&n===this&&t(o,i)||(r=e.apply(this,o),a=!0,n=this,i=o),r}},xg="object"===typeof performance&&"function"===typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function _g(e){cancelAnimationFrame(e.id)}function wg(e,t){var n=xg();var r={id:requestAnimationFrame(function i(){xg()-n>=t?e.call(null):r.id=requestAnimationFrame(i)})};return r}var Sg=-1;function Tg(e){if(void 0===e&&(e=!1),-1===Sg||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),Sg=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Sg}var Cg=null;function Mg(e){if(void 0===e&&(e=!1),null===Cg||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var r=document.createElement("div"),i=r.style;return i.width="100px",i.height="100px",t.appendChild(r),document.body.appendChild(t),t.scrollLeft>0?Cg="positive-descending":(t.scrollLeft=1,Cg=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),Cg}return Cg}var Eg=function(e){var t=e.columnIndex;e.data;return e.rowIndex+":"+t};function Pg(e){var t,n=e.getColumnOffset,i=e.getColumnStartIndexForOffset,a=e.getColumnStopIndexForStartIndex,o=e.getColumnWidth,s=e.getEstimatedTotalHeight,l=e.getEstimatedTotalWidth,c=e.getOffsetForColumnAndAlignment,u=e.getOffsetForRowAndAlignment,d=e.getRowHeight,h=e.getRowOffset,p=e.getRowStartIndexForOffset,f=e.getRowStopIndexForStartIndex,m=e.initInstanceProps,g=e.shouldResetStyleCacheOnItemSizeChange,v=e.validateProps;return t=function(e){function t(t){var r;return(r=e.call(this,t)||this)._instanceProps=m(r.props,fg(r)),r._resetIsScrollingTimeoutId=null,r._outerRef=void 0,r.state={instance:fg(r),isScrolling:!1,horizontalScrollDirection:"forward",scrollLeft:"number"===typeof r.props.initialScrollLeft?r.props.initialScrollLeft:0,scrollTop:"number"===typeof r.props.initialScrollTop?r.props.initialScrollTop:0,scrollUpdateWasRequested:!1,verticalScrollDirection:"forward"},r._callOnItemsRendered=void 0,r._callOnItemsRendered=bg(function(e,t,n,i,a,o,s,l){return r.props.onItemsRendered({overscanColumnStartIndex:e,overscanColumnStopIndex:t,overscanRowStartIndex:n,overscanRowStopIndex:i,visibleColumnStartIndex:a,visibleColumnStopIndex:o,visibleRowStartIndex:s,visibleRowStopIndex:l})}),r._callOnScroll=void 0,r._callOnScroll=bg(function(e,t,n,i,a){return r.props.onScroll({horizontalScrollDirection:n,scrollLeft:e,scrollTop:t,verticalScrollDirection:i,scrollUpdateWasRequested:a})}),r._getItemStyle=void 0,r._getItemStyle=function(e,t){var i,a=r.props,s=a.columnWidth,l=a.direction,c=a.rowHeight,u=r._getItemStyleCache(g&&s,g&&l,g&&c),p=e+":"+t;if(u.hasOwnProperty(p))i=u[p];else{var f=n(r.props,t,r._instanceProps),m="rtl"===l;u[p]=i={position:"absolute",left:m?void 0:f,right:m?f:void 0,top:h(r.props,e,r._instanceProps),height:d(r.props,e,r._instanceProps),width:o(r.props,t,r._instanceProps)}}return i},r._getItemStyleCache=void 0,r._getItemStyleCache=bg(function(e,t,n){return{}}),r._onScroll=function(e){var t=e.currentTarget,n=t.clientHeight,i=t.clientWidth,a=t.scrollLeft,o=t.scrollTop,s=t.scrollHeight,l=t.scrollWidth;r.setState(function(e){if(e.scrollLeft===a&&e.scrollTop===o)return null;var t=r.props.direction,c=a;if("rtl"===t)switch(Mg()){case"negative":c=-a;break;case"positive-descending":c=l-i-a}c=Math.max(0,Math.min(c,l-i));var u=Math.max(0,Math.min(o,s-n));return{isScrolling:!0,horizontalScrollDirection:e.scrollLeft<a?"forward":"backward",scrollLeft:c,scrollTop:u,verticalScrollDirection:e.scrollTop<o?"forward":"backward",scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._outerRefSetter=function(e){var t=r.props.outerRef;r._outerRef=e,"function"===typeof t?t(e):null!=t&&"object"===typeof t&&t.hasOwnProperty("current")&&(t.current=e)},r._resetIsScrollingDebounced=function(){null!==r._resetIsScrollingTimeoutId&&_g(r._resetIsScrollingTimeoutId),r._resetIsScrollingTimeoutId=wg(r._resetIsScrolling,150)},r._resetIsScrolling=function(){r._resetIsScrollingTimeoutId=null,r.setState({isScrolling:!1},function(){r._getItemStyleCache(-1)})},r}gg(t,e),t.getDerivedStateFromProps=function(e,t){return Ng(e,t),v(e),null};var A=t.prototype;return A.scrollTo=function(e){var t=e.scrollLeft,n=e.scrollTop;void 0!==t&&(t=Math.max(0,t)),void 0!==n&&(n=Math.max(0,n)),this.setState(function(e){return void 0===t&&(t=e.scrollLeft),void 0===n&&(n=e.scrollTop),e.scrollLeft===t&&e.scrollTop===n?null:{horizontalScrollDirection:e.scrollLeft<t?"forward":"backward",scrollLeft:t,scrollTop:n,scrollUpdateWasRequested:!0,verticalScrollDirection:e.scrollTop<n?"forward":"backward"}},this._resetIsScrollingDebounced)},A.scrollToItem=function(e){var t=e.align,n=void 0===t?"auto":t,r=e.columnIndex,i=e.rowIndex,a=this.props,o=a.columnCount,d=a.height,h=a.rowCount,p=a.width,f=this.state,m=f.scrollLeft,g=f.scrollTop,v=Tg();void 0!==r&&(r=Math.max(0,Math.min(r,o-1))),void 0!==i&&(i=Math.max(0,Math.min(i,h-1)));var A=s(this.props,this._instanceProps),y=l(this.props,this._instanceProps)>p?v:0,b=A>d?v:0;this.scrollTo({scrollLeft:void 0!==r?c(this.props,r,n,m,this._instanceProps,b):m,scrollTop:void 0!==i?u(this.props,i,n,g,this._instanceProps,y):g})},A.componentDidMount=function(){var e=this.props,t=e.initialScrollLeft,n=e.initialScrollTop;if(null!=this._outerRef){var r=this._outerRef;"number"===typeof t&&(r.scrollLeft=t),"number"===typeof n&&(r.scrollTop=n)}this._callPropsCallbacks()},A.componentDidUpdate=function(){var e=this.props.direction,t=this.state,n=t.scrollLeft,r=t.scrollTop;if(t.scrollUpdateWasRequested&&null!=this._outerRef){var i=this._outerRef;if("rtl"===e)switch(Mg()){case"negative":i.scrollLeft=-n;break;case"positive-ascending":i.scrollLeft=n;break;default:var a=i.clientWidth,o=i.scrollWidth;i.scrollLeft=o-a-n}else i.scrollLeft=Math.max(0,n);i.scrollTop=Math.max(0,r)}this._callPropsCallbacks()},A.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&_g(this._resetIsScrollingTimeoutId)},A.render=function(){var e=this.props,t=e.children,n=e.className,i=e.columnCount,a=e.direction,o=e.height,c=e.innerRef,u=e.innerElementType,d=e.innerTagName,h=e.itemData,p=e.itemKey,f=void 0===p?Eg:p,m=e.outerElementType,g=e.outerTagName,v=e.rowCount,A=e.style,y=e.useIsScrolling,b=e.width,x=this.state.isScrolling,_=this._getHorizontalRangeToRender(),w=_[0],S=_[1],T=this._getVerticalRangeToRender(),C=T[0],M=T[1],E=[];if(i>0&&v)for(var P=C;P<=M;P++)for(var N=w;N<=S;N++)E.push((0,r.createElement)(t,{columnIndex:N,data:h,isScrolling:y?x:void 0,key:f({columnIndex:N,data:h,rowIndex:P}),rowIndex:P,style:this._getItemStyle(P,N)}));var k=s(this.props,this._instanceProps),R=l(this.props,this._instanceProps);return(0,r.createElement)(m||g||"div",{className:n,onScroll:this._onScroll,ref:this._outerRefSetter,style:pg({position:"relative",height:o,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:a},A)},(0,r.createElement)(u||d||"div",{children:E,ref:c,style:{height:k,pointerEvents:x?"none":void 0,width:R}}))},A._callPropsCallbacks=function(){var e=this.props,t=e.columnCount,n=e.onItemsRendered,r=e.onScroll,i=e.rowCount;if("function"===typeof n&&t>0&&i>0){var a=this._getHorizontalRangeToRender(),o=a[0],s=a[1],l=a[2],c=a[3],u=this._getVerticalRangeToRender(),d=u[0],h=u[1],p=u[2],f=u[3];this._callOnItemsRendered(o,s,d,h,l,c,p,f)}if("function"===typeof r){var m=this.state,g=m.horizontalScrollDirection,v=m.scrollLeft,A=m.scrollTop,y=m.scrollUpdateWasRequested,b=m.verticalScrollDirection;this._callOnScroll(v,A,g,b,y)}},A._getHorizontalRangeToRender=function(){var e=this.props,t=e.columnCount,n=e.overscanColumnCount,r=e.overscanColumnsCount,o=e.overscanCount,s=e.rowCount,l=this.state,c=l.horizontalScrollDirection,u=l.isScrolling,d=l.scrollLeft,h=n||r||o||1;if(0===t||0===s)return[0,0,0,0];var p=i(this.props,d,this._instanceProps),f=a(this.props,p,d,this._instanceProps),m=u&&"backward"!==c?1:Math.max(1,h),g=u&&"forward"!==c?1:Math.max(1,h);return[Math.max(0,p-m),Math.max(0,Math.min(t-1,f+g)),p,f]},A._getVerticalRangeToRender=function(){var e=this.props,t=e.columnCount,n=e.overscanCount,r=e.overscanRowCount,i=e.overscanRowsCount,a=e.rowCount,o=this.state,s=o.isScrolling,l=o.verticalScrollDirection,c=o.scrollTop,u=r||i||n||1;if(0===t||0===a)return[0,0,0,0];var d=p(this.props,c,this._instanceProps),h=f(this.props,d,c,this._instanceProps),m=s&&"backward"!==l?1:Math.max(1,u),g=s&&"forward"!==l?1:Math.max(1,u);return[Math.max(0,d-m),Math.max(0,Math.min(a-1,h+g)),d,h]},t}(r.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,useIsScrolling:!1},t}var Ng=function(e,t){e.children,e.direction,e.height,e.innerTagName,e.outerTagName,e.overscanColumnsCount,e.overscanCount,e.overscanRowsCount,e.width,t.instance};var kg=Pg({getColumnOffset:function(e,t){return t*e.columnWidth},getColumnWidth:function(e,t){return e.columnWidth},getRowOffset:function(e,t){return t*e.rowHeight},getRowHeight:function(e,t){return e.rowHeight},getEstimatedTotalHeight:function(e){var t=e.rowCount;return e.rowHeight*t},getEstimatedTotalWidth:function(e){var t=e.columnCount;return e.columnWidth*t},getOffsetForColumnAndAlignment:function(e,t,n,r,i,a){var o=e.columnCount,s=e.columnWidth,l=e.width,c=Math.max(0,o*s-l),u=Math.min(c,t*s),d=Math.max(0,t*s-l+a+s);switch("smart"===n&&(n=r>=d-l&&r<=u+l?"auto":"center"),n){case"start":return u;case"end":return d;case"center":var h=Math.round(d+(u-d)/2);return h<Math.ceil(l/2)?0:h>c+Math.floor(l/2)?c:h;default:return r>=d&&r<=u?r:d>u||r<d?d:u}},getOffsetForRowAndAlignment:function(e,t,n,r,i,a){var o=e.rowHeight,s=e.height,l=e.rowCount,c=Math.max(0,l*o-s),u=Math.min(c,t*o),d=Math.max(0,t*o-s+a+o);switch("smart"===n&&(n=r>=d-s&&r<=u+s?"auto":"center"),n){case"start":return u;case"end":return d;case"center":var h=Math.round(d+(u-d)/2);return h<Math.ceil(s/2)?0:h>c+Math.floor(s/2)?c:h;default:return r>=d&&r<=u?r:d>u||r<d?d:u}},getColumnStartIndexForOffset:function(e,t){var n=e.columnWidth,r=e.columnCount;return Math.max(0,Math.min(r-1,Math.floor(t/n)))},getColumnStopIndexForStartIndex:function(e,t,n){var r=e.columnWidth,i=e.columnCount,a=e.width,o=t*r,s=Math.ceil((a+n-o)/r);return Math.max(0,Math.min(i-1,t+s-1))},getRowStartIndexForOffset:function(e,t){var n=e.rowHeight,r=e.rowCount;return Math.max(0,Math.min(r-1,Math.floor(t/n)))},getRowStopIndexForStartIndex:function(e,t,n){var r=e.rowHeight,i=e.rowCount,a=e.height,o=t*r,s=Math.ceil((a+n-o)/r);return Math.max(0,Math.min(i-1,t+s-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.columnWidth,e.rowHeight}});var Rg=(0,r.memo)(function({items:e=[],render:t,itemSize:n=180,gap:i=12,style:a}){const o=(0,r.useRef)(null),[s,l]=(0,r.useState)({width:800,height:600});(0,r.useLayoutEffect)(()=>{const e=o.current;if(!e)return;const t=new ResizeObserver(()=>{const t=e.getBoundingClientRect();l({width:t.width,height:t.height||.7*window.innerHeight})});return t.observe(e),()=>t.disconnect()},[]);const{columnCount:c,rowCount:u,itemW:d,itemH:h}=(0,r.useMemo)(()=>{const t=Math.max(1,e.length),r=Math.max(1,s.width),a=Math.max(1,Math.floor((r+i)/(n+i)));return{columnCount:a,rowCount:Math.ceil(t/a),itemW:n+i,itemH:n+i}},[s.width,e.length,n,i]);return(0,gt.jsx)("div",{ref:o,style:{width:"100%",height:"70vh",...a},children:(0,gt.jsx)(kg,{columnCount:c,columnWidth:d,height:s.height,rowCount:u,rowHeight:h,width:s.width,children:({columnIndex:n,rowIndex:r,style:a})=>{const o=r*c+n;if(o>=e.length)return null;const s=t(e[o],o);return(0,gt.jsx)("div",{style:{...a,left:a.left+i,top:a.top+i,width:d-i,height:h-i},children:s})}})})});const Lg=r.lazy(()=>Promise.resolve().then(n.bind(n,8994)));function Og({photos:e=[],horizontal:t=!1}){const[n,i]=(0,r.useState)(null);if(!Array.isArray(e)||0===e.length)return(0,gt.jsx)("div",{style:{color:"#666"},children:"No photos found."});if(t)return(0,gt.jsxs)("div",{children:[(0,gt.jsx)(Zn,{height:220,padding:8,loop:e.length>=4,showEdges:e.length>=4,children:e.map((e,t)=>(0,gt.jsx)("div",{style:{width:220,minWidth:220,height:"100%"},children:(0,gt.jsx)(jg,{photo:e,onClick:()=>i(t)})},e.id||t))}),null!==n&&(0,gt.jsx)(r.Suspense,{fallback:null,children:(0,gt.jsx)(Lg,{images:e,index:n,onClose:()=>i(null)})})]});const a=e.length>400;return(0,gt.jsxs)("div",{children:[a?(0,gt.jsx)(Rg,{items:e,itemSize:180,gap:12,render:(e,t)=>(0,gt.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,gt.jsx)(jg,{photo:e,onClick:()=>i(t)})},e.id||t)}):(0,gt.jsx)("div",{className:"grid",children:e.map((e,t)=>(0,gt.jsx)(jg,{photo:e,onClick:()=>i(t)},e.id||t))}),null!==n&&(0,gt.jsx)(r.Suspense,{fallback:null,children:(0,gt.jsx)(Lg,{images:e,index:n,onClose:()=>i(null)})})]})}const jg=r.memo(function({photo:e,onClick:t}){const n=(0,r.useMemo)(()=>{let t=null;return e.positive_thumb_rel_path?t=`/uploads/${e.positive_thumb_rel_path}`:e.thumb_rel_path?t=`/uploads/${e.thumb_rel_path}`:e.positive_rel_path?t=`/uploads/${e.positive_rel_path}`:e.full_rel_path?t=`/uploads/${e.full_rel_path}`:e.filename&&(t=e.filename),(0,bn.FH)(t)},[e]);return(0,gt.jsx)("div",{className:"photo-item",onClick:t,style:{width:"100%",height:"100%"},children:(0,gt.jsx)("div",{className:"photo-thumb",style:{width:"100%",height:"100%"},children:(0,gt.jsx)("img",{src:n,alt:e.caption||"",loading:"lazy",decoding:"async",draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}})})})});var Dg=r.memo(Og);function Ig(e,t,n){let{item:i,isDisabled:a}=e,o=i.key,s=t.selectionManager,l=(0,r.useId)(),c=(0,r.useId)(),u=t.disabledKeys.has(i.key)||a;(0,r.useEffect)(()=>{o===t.focusedKey&&document.activeElement!==n.current&&n.current&&(0,ts.l)(n.current)},[n,o,t.focusedKey]);let d=(0,r.useCallback)(e=>{s.canSelectItem(o)&&(s.select(o,e),t.toggleKey(o))},[o,s]);const h=(0,r.useCallback)(e=>{"replace"===s.selectionBehavior&&s.extendSelection(e),s.setFocusedKey(e)},[s]),p=(0,r.useCallback)(e=>{const n={ArrowDown:()=>{const e=t.collection.getKeyAfter(o);if(e&&t.disabledKeys.has(e)){const n=t.collection.getKeyAfter(e);n&&h(n)}else e&&h(e)},ArrowUp:()=>{const e=t.collection.getKeyBefore(o);if(e&&t.disabledKeys.has(e)){const n=t.collection.getKeyBefore(e);n&&h(n)}else e&&h(e)},Home:()=>{const e=t.collection.getFirstKey();e&&h(e)},End:()=>{const e=t.collection.getLastKey();e&&h(e)}}[e.key];n&&(e.preventDefault(),s.canSelectItem(o)&&n(e))},[o,s]);let{buttonProps:f}=function(e,t){let n,{elementType:r="button",isDisabled:i,onPress:a,onPressStart:o,onPressEnd:s,onPressUp:l,onPressChange:c,preventFocusOnPress:u,allowFocusWhenDisabled:d,onClick:h,href:p,target:f,rel:m,type:g="button"}=e;n="button"===r?{type:g,disabled:i,form:e.form,formAction:e.formAction,formEncType:e.formEncType,formMethod:e.formMethod,formNoValidate:e.formNoValidate,formTarget:e.formTarget,name:e.name,value:e.value}:{role:"button",href:"a"!==r||i?void 0:p,target:"a"===r?f:void 0,type:"input"===r?g:void 0,disabled:"input"===r?i:void 0,"aria-disabled":i&&"input"!==r?i:void 0,rel:"a"===r?m:void 0};let{pressProps:v,isPressed:A}=(0,lo.d)({onPressStart:o,onPressEnd:s,onPressChange:c,onPress:a,onPressUp:l,onClick:h,isDisabled:i,preventFocusOnPress:u,ref:t}),{focusableProps:y}=(0,Mf.Wc)(e,t);d&&(y.tabIndex=i?-1:y.tabIndex);let b=(0,go.v)(y,v,(0,Io.$)(e,{labelable:!0}));return{isPressed:A,buttonProps:(0,go.v)(n,b,{"aria-haspopup":e["aria-haspopup"],"aria-expanded":e["aria-expanded"],"aria-controls":e["aria-controls"],"aria-pressed":e["aria-pressed"],"aria-current":e["aria-current"],"aria-disabled":e["aria-disabled"]})}}({id:l,elementType:"button",isDisabled:u,onKeyDown:p,onPress:d},n),m=t.selectionManager.isSelected(i.key);return{buttonProps:{...f,"aria-expanded":m,"aria-controls":m?c:void 0},regionProps:{id:c,role:"region","aria-labelledby":l}}}var Bg=e=>(0,gt.jsx)("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",role:"presentation",viewBox:"0 0 24 24",width:"1em",...e,children:(0,gt.jsx)("path",{d:"M15.5 19l-7-7 7-7",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})}),Fg=n(4930),zg=n(8689);const Ug=new Set(["opacity","clipPath","filter","transform"]);class Vg extends Ac.KG{constructor(){super(...arguments),this.isEnabled=!1}add(e){(zg.f.has(e)||Ug.has(e))&&(this.isEnabled=!0,this.update())}update(){this.set(this.isEnabled?"transform":"auto")}}var Gg=()=>n.e(707).then(n.bind(n,5707)).then(e=>e.default),qg=(0,Ln.Rf)((e,t)=>{const{Component:n,HeadingComponent:i,classNames:a,slots:o,indicator:s,children:l,title:c,subtitle:u,startContent:d,isOpen:h,isDisabled:p,hideIndicator:f,keepContentMounted:m,disableAnimation:g,motionProps:v,getBaseProps:A,getHeadingProps:y,getButtonProps:b,getTitleProps:x,getSubtitleProps:_,getContentProps:w,getIndicatorProps:S}=function(e){var t,n;const i=(0,Bn.o)(),{ref:a,as:o,item:s,onFocusChange:l}=e,{state:c,className:u,indicator:d,children:h,title:p,subtitle:f,startContent:m,motionProps:g,focusedKey:v,variant:A,isCompact:y=!1,classNames:b={},isDisabled:x=!1,hideIndicator:_=!1,disableAnimation:w=null!=(t=null==i?void 0:i.disableAnimation)&&t,keepContentMounted:S=!1,disableIndicatorAnimation:T=!1,HeadingComponent:C=o||"h2",onPress:M,onPressStart:E,onPressEnd:P,onPressChange:N,onPressUp:k,onClick:R,...L}=e,O=o||"div",j="string"===typeof O,D=(0,Wa.zD)(a),I=c.disabledKeys.has(s.key)||x,B=c.selectionManager.isSelected(s.key),{buttonProps:F,regionProps:z}=Ig({item:s,isDisabled:I},{...c,focusedKey:v},D),{onFocus:U,onBlur:V,...G}=F,{isFocused:q,isFocusVisible:W,focusProps:H}=(0,Oo.o)({autoFocus:null==(n=s.props)?void 0:n.autoFocus}),{isHovered:$,hoverProps:K}=(0,qo.M)({isDisabled:I}),{pressProps:X,isPressed:Y}=(0,lo.d)({ref:D,isDisabled:I,onPress:M,onPressStart:E,onPressEnd:P,onPressChange:N,onPressUp:k}),Q=(0,r.useCallback)(()=>{null==l||l(!0,s.key)},[]),Z=(0,r.useCallback)(()=>{null==l||l(!1,s.key)},[]),J=(0,r.useMemo)(()=>({...b}),[(0,In.t6)(b)]),ee=(0,r.useMemo)(()=>(0,qa.et)({isCompact:y,isDisabled:I,hideIndicator:_,disableAnimation:w,disableIndicatorAnimation:T,variant:A}),[y,I,_,w,T,A]),te=(0,Dn.cn)(null==J?void 0:J.base,u),ne=(0,r.useCallback)((e={})=>({"data-open":(0,In.sE)(B),"data-disabled":(0,In.sE)(I),"data-slot":"base",className:ee.base({class:te}),...(0,In.v6)((0,Xa.$)(L,{enabled:j}),e)}),[te,j,L,ee,s.props,B,I]),re=(0,r.useCallback)((e={})=>({"data-open":(0,In.sE)(B),"data-disabled":(0,In.sE)(I),"data-slot":"content",className:ee.content({class:null==J?void 0:J.content}),...(0,In.v6)(z,e)}),[ee,J,z,B,I,null==J?void 0:J.content]),ie=(0,r.useCallback)((e={})=>({"aria-hidden":(0,In.sE)(!0),"data-open":(0,In.sE)(B),"data-disabled":(0,In.sE)(I),"data-slot":"indicator",className:ee.indicator({class:null==J?void 0:J.indicator}),...e}),[ee,null==J?void 0:J.indicator,B,I,null==J?void 0:J.indicator]),ae=(0,r.useCallback)((e={})=>({"data-open":(0,In.sE)(B),"data-disabled":(0,In.sE)(I),"data-slot":"heading",className:ee.heading({class:null==J?void 0:J.heading}),...e}),[ee,null==J?void 0:J.heading,B,I,null==J?void 0:J.heading]),oe=(0,r.useCallback)((e={})=>({"data-open":(0,In.sE)(B),"data-disabled":(0,In.sE)(I),"data-slot":"title",className:ee.title({class:null==J?void 0:J.title}),...e}),[ee,null==J?void 0:J.title,B,I,null==J?void 0:J.title]),se=(0,r.useCallback)((e={})=>({"data-open":(0,In.sE)(B),"data-disabled":(0,In.sE)(I),"data-slot":"subtitle",className:ee.subtitle({class:null==J?void 0:J.subtitle}),...e}),[ee,J,B,I,null==J?void 0:J.subtitle]);return{Component:O,HeadingComponent:C,item:s,slots:ee,classNames:J,domRef:D,indicator:d,children:h,title:p,subtitle:f,startContent:m,isOpen:B,isDisabled:I,hideIndicator:_,keepContentMounted:S,disableAnimation:w,motionProps:g,getBaseProps:ne,getHeadingProps:ae,getButtonProps:(e={})=>{var t,n;return{ref:D,"data-open":(0,In.sE)(B),"data-focus":(0,In.sE)(q),"data-focus-visible":(0,In.sE)(W),"data-disabled":(0,In.sE)(I),"data-hover":(0,In.sE)($),"data-pressed":(0,In.sE)(Y),"data-slot":"trigger",className:ee.trigger({class:null==J?void 0:J.trigger}),onFocus:(0,In.Hj)(Q,U,H.onFocus,L.onFocus,null==(t=s.props)?void 0:t.onFocus),onBlur:(0,In.Hj)(Z,V,H.onBlur,L.onBlur,null==(n=s.props)?void 0:n.onBlur),...(0,In.v6)(G,K,X,e,{onClick:(0,In.cy)(X.onClick,R)})}},getContentProps:re,getIndicatorProps:ie,getTitleProps:oe,getSubtitleProps:se}}({...e,ref:t}),T=(0,Fg.M)(()=>new Vg("auto")),C=(0,r.useMemo)(()=>"function"===typeof s?s({indicator:(0,gt.jsx)(Bg,{}),isOpen:h,isDisabled:p}):s||null,[s,h,p])||(0,gt.jsx)(Bg,{}),M=(0,r.useMemo)(()=>{if(g)return(m||h)&&(0,gt.jsx)("div",{...w(),children:l});const e={exit:{...dd.zF.collapse.exit,overflowY:"hidden"},enter:{...dd.zF.collapse.enter,overflowY:"unset"}};return m?(0,gt.jsx)(md.F,{features:Gg,children:(0,gt.jsx)(gd.m.section,{animate:h?"enter":"exit",exit:"exit",initial:"exit",style:{willChange:T},variants:e,onKeyDown:e=>{e.stopPropagation()},...v,children:(0,gt.jsx)("div",{...w(),children:l})},"accordion-content")}):(0,gt.jsx)(ld.N,{initial:!1,children:h&&(0,gt.jsx)(md.F,{features:Gg,children:(0,gt.jsx)(gd.m.section,{animate:"enter",exit:"exit",initial:"exit",style:{willChange:T},variants:e,onKeyDown:e=>{e.stopPropagation()},...v,children:(0,gt.jsx)("div",{...w(),children:l})},"accordion-content")})})},[h,g,m,l,v]);return(0,gt.jsxs)(n,{...A(),children:[(0,gt.jsx)(i,{...y(),children:(0,gt.jsxs)("button",{...b(),children:[d&&(0,gt.jsx)("div",{className:o.startContent({class:null==a?void 0:a.startContent}),children:d}),(0,gt.jsxs)("div",{className:o.titleWrapper({class:null==a?void 0:a.titleWrapper}),children:[c&&(0,gt.jsx)("span",{...x(),children:c}),u&&(0,gt.jsx)("span",{..._(),children:u})]}),!f&&C&&(0,gt.jsx)("span",{...S(),children:C})]})}),M]})});qg.displayName="HeroUI.AccordionItem";var Wg=qg;function Hg(e){var t;const n=(0,Bn.o)(),{ref:i,as:a,className:o,items:s,variant:l,motionProps:c,expandedKeys:u,disabledKeys:d,selectedKeys:h,children:p,defaultExpandedKeys:f,selectionMode:m="single",selectionBehavior:g="toggle",keepContentMounted:v=!1,disallowEmptySelection:A,defaultSelectedKeys:y,onExpandedChange:b,onSelectionChange:x,dividerProps:_={},isCompact:w=!1,isDisabled:S=!1,showDivider:T=!0,hideIndicator:C=!1,disableAnimation:M=null!=(t=null==n?void 0:n.disableAnimation)&&t,disableIndicatorAnimation:E=!1,itemClasses:P,...N}=e,[k,R]=(0,r.useState)(null),L=a||"div",O="string"===typeof L,j=(0,Wa.zD)(i),D=(0,r.useMemo)(()=>(0,qa.JC)({variant:l,className:o}),[l,o]),I={children:(0,r.useMemo)(()=>{let e=[];return r.Children.map(p,t=>{var n;if(r.isValidElement(t)&&"string"!==typeof(null==(n=t.props)?void 0:n.children)){const n=r.cloneElement(t,{hasChildItems:!1});e.push(n)}else e.push(t)}),e},[p]),items:s},B={expandedKeys:u,defaultExpandedKeys:f,onExpandedChange:b},F=Gs({disabledKeys:d,selectedKeys:h,selectionMode:m,selectionBehavior:g,disallowEmptySelection:A,defaultSelectedKeys:null!=y?y:f,onSelectionChange:x,...I,...B});F.selectionManager.setFocusedKey=e=>{R(e)};const{accordionProps:z}=function(e,t,n){let{listProps:r}=ks({...e,...t,allowsTabNavigation:!0,disallowSelectAll:!0,ref:n});return delete r.onKeyDownCapture,{accordionProps:{...r,tabIndex:void 0}}}({...I,...B},F,j),U=(0,r.useMemo)(()=>({state:F,focusedKey:k,motionProps:c,isCompact:w,isDisabled:S,hideIndicator:C,disableAnimation:M,keepContentMounted:v,disableIndicatorAnimation:E}),[k,w,S,C,h,M,v,null==F?void 0:F.expandedKeys.values,E,F.expandedKeys.size,F.disabledKeys.size,c]),V=(0,r.useCallback)((e={})=>({ref:j,className:D,"data-orientation":"vertical",...(0,In.v6)(z,(0,Xa.$)(N,{enabled:O}),e)}),[]),G=(0,r.useCallback)((e,t)=>{e&&R(t)},[]);return{Component:L,values:U,state:F,focusedKey:k,getBaseProps:V,isSplitted:"splitted"===l,classNames:D,showDivider:T,dividerProps:_,disableAnimation:M,handleFocusChanged:G,itemClasses:P}}const $g=(0,r.createContext)(null);var Kg=n(293);function Xg(){const e=function(){const e=(0,r.useRef)(!1);return(0,Kg.E)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}(),[t,n]=(0,r.useState)(0),i=(0,r.useCallback)(()=>{e.current&&n(t+1)},[t]);return[(0,r.useCallback)(()=>ll.Gt.postRender(i),[i]),t]}const Yg=e=>!e.isLayoutDirty&&e.willUpdate(!1);function Qg(){const e=new Set,t=new WeakMap,n=()=>e.forEach(Yg);return{add:r=>{e.add(r),t.set(r,r.addEventListener("willUpdate",n))},remove:r=>{e.delete(r);const i=t.get(r);i&&(i(),t.delete(r)),n()},dirty:n}}const Zg=e=>!0===e,Jg=({children:e,id:t,inherit:n=!0})=>{const i=(0,r.useContext)(ec.L),a=(0,r.useContext)($g),[o,s]=Xg(),l=(0,r.useRef)(null),c=i.id||a;null===l.current&&((e=>Zg(!0===e)||"id"===e)(n)&&c&&(t=t?c+"-"+t:c),l.current={id:t,group:Zg(n)&&i.group||Qg()});const u=(0,r.useMemo)(()=>({...l.current,forceRender:o}),[s]);return(0,gt.jsx)(ec.L.Provider,{value:u,children:e})};var ev=(0,Ln.Rf)((e,t)=>{const{Component:n,values:i,state:a,isSplitted:o,showDivider:s,getBaseProps:l,disableAnimation:c,handleFocusChanged:u,itemClasses:d,dividerProps:h}=Hg({...e,ref:t}),p=(0,r.useCallback)((e,t)=>u(e,t),[u]),f=(0,r.useMemo)(()=>[...a.collection].map((t,n)=>{const l={...d,...t.props.classNames||{}};return(0,gt.jsxs)(r.Fragment,{children:[(0,gt.jsx)(Wg,{item:t,variant:e.variant,onFocusChange:p,...i,...t.props,classNames:l}),!t.props.hidden&&!o&&s&&n<a.collection.size-1&&(0,gt.jsx)(Ja,{...h})]},t.key)}),[i,d,p,o,s,a.collection]);return(0,gt.jsx)(n,{...l(),children:c?f:(0,gt.jsx)(Jg,{children:f})})});ev.displayName="HeroUI.Accordion";var tv=ev,nv=Ys;const rv=$n("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),iv=$n("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),av=$n("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var ov=n(2896),sv=n(1051),lv=n(5357);function cv({children:e,isValidProp:t,...n}){t&&(0,lv.D)(t),(n={...(0,r.useContext)(sv.Q),...n}).isStatic=(0,Fg.M)(()=>n.isStatic);const i=(0,r.useMemo)(()=>n,[JSON.stringify(n.transition),n.transformPagePoint,n.reducedMotion]);return(0,gt.jsx)(sv.Q.Provider,{value:i,children:e})}var uv=n(5481);const dv=r.createContext(null);function hv(e){let{children:t}=e,n=(0,r.useContext)(dv),[i,a]=(0,r.useState)(0),o=(0,r.useMemo)(()=>({parent:n,modalCount:i,addModal(){a(e=>e+1),n&&n.addModal()},removeModal(){a(e=>e-1),n&&n.removeModal()}}),[n,i]);return r.createElement(dv.Provider,{value:o},t)}function pv(e){let{modalProviderProps:t}=function(){let e=(0,r.useContext)(dv);return{modalProviderProps:{"aria-hidden":!!(e&&e.modalCount>0)||void 0}}}();return r.createElement("div",{"data-overlay-container":!0,...e,...t})}function fv(e){return r.createElement(hv,null,r.createElement(pv,e))}function mv(e){let t=(0,cs.wR)(),{portalContainer:n=(t?null:document.body),...i}=e,{getContainer:a}=(0,uv.gX)();if(!e.portalContainer&&a&&(n=a()),r.useEffect(()=>{if(null===n||void 0===n?void 0:n.closest("[data-overlay-container]"))throw new Error("An OverlayContainer must not be inside another container. Please change the portalContainer prop.")},[n]),!n)return null;let o=r.createElement(fv,i);return Ca.createPortal(o,n)}var gv=({children:e,navigate:t,disableAnimation:n,useHref:i,disableRipple:a=!1,skipFramerMotionAnimations:o=n,reducedMotion:s="never",validationBehavior:l,locale:c="en-US",labelPlacement:u,defaultDates:d,createCalendar:h,spinnerVariant:p,...f})=>{let m=e;t&&(m=(0,gt.jsx)(Do.pg,{navigate:t,useHref:i,children:m}));const g=(0,r.useMemo)(()=>(n&&o&&(ov.W.skipAnimations=!0),{createCalendar:h,defaultDates:d,disableAnimation:n,disableRipple:a,validationBehavior:l,labelPlacement:u,spinnerVariant:p}),[h,null==d?void 0:d.maxDate,null==d?void 0:d.minDate,n,a,l,u,p]);return(0,gt.jsx)(Bn.n,{value:g,children:(0,gt.jsx)(Ts.C,{locale:c,children:(0,gt.jsx)(cv,{reducedMotion:s,children:(0,gt.jsx)(fv,{...f,children:m})})})})};const vv=(0,r.createContext)({theme:"light",setTheme:()=>{},toggleTheme:()=>{}}),Av=()=>(0,r.useContext)(vv);function yv({children:e}){const t=se(),[n,i]=(0,r.useState)(()=>{const e=localStorage.getItem("theme");if("dark"===e||"light"===e)return e;const t=document.documentElement.getAttribute("data-theme");return t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}),a=e=>{i(e),localStorage.setItem("theme",e)};(0,r.useEffect)(()=>{const e=document.documentElement;e.setAttribute("data-theme",n),"dark"===n?e.classList.add("dark"):e.classList.remove("dark");const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content","dark"===n?"#000000":"#f5f7fa")},[n]),(0,r.useEffect)(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{localStorage.getItem("theme")||i(e.matches?"dark":"light")};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]);const o=r.useCallback(()=>{a("light"===n?"dark":"light")},[n]),s=(0,r.useMemo)(()=>({theme:n,setTheme:a,toggleTheme:o}),[n,o]);return(0,gt.jsx)(vv.Provider,{value:s,children:(0,gt.jsx)(gv,{navigate:t,children:(0,gt.jsx)("div",{className:"heroui-provider h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 transition-colors duration-200",children:e})})})}const bv=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function xv({isOpen:e,onClose:t,filters:n,onChange:i}){var a;const{theme:o}=Av(),s="dark"===o,[l,c]=(0,r.useState)({cameras:[],lenses:[],photographers:[],years:[],films:[]}),[u,d]=(0,r.useState)([]);(0,r.useEffect)(()=>{(0,bn.ET)().then(e=>c(t=>({...t,...e}))).catch(console.error),(0,bn.Vs)().then(d).catch(console.error),(0,bn.ip)().then(e=>c(t=>({...t,films:Array.isArray(e)?e:[]}))).catch(console.error)},[]);const h=(e,t)=>{const r=Array.isArray(n[e])?n[e]:[],a=r.includes(t)?r.filter(e=>e!==t):[...r,t];i({...n,[e]:a})},p=Object.values(n).reduce((e,t)=>e+(Array.isArray(t)?t.length:0),0),f=({title:e,icon:t,items:r=[],keyName:i,color:a="primary"})=>{const o=n[i]||[],s=(e=>e.map(e=>"object"===typeof e?e:{value:String(e),label:String(e)}))(r);return(0,gt.jsx)("div",{className:"mb-2",children:(0,gt.jsx)(tv,{isCompact:!0,variant:"light",defaultExpandedKeys:["1"],children:(0,gt.jsx)(nv,{"aria-label":e,title:(0,gt.jsxs)("div",{className:"flex items-center gap-2 text-default-600 font-medium",children:[t&&(0,gt.jsx)(t,{size:18}),(0,gt.jsx)("span",{children:e}),o.length>0&&(0,gt.jsx)(el,{size:"sm",variant:"flat",color:a,className:"h-5 min-w-5 px-0 ml-auto mr-2",children:o.length})]}),classNames:{trigger:"px-0 py-2 data-[hover=true]:bg-transparent",content:"pb-4"},children:(0,gt.jsxs)("div",{className:"flex flex-wrap gap-2 pt-1",children:[s.map((e,t)=>{const n=o.includes(e.value);return(0,gt.jsx)(el,{variant:n?"flat":"bordered",color:n?a:"default",className:"cursor-pointer transition-all hover:scale-105 border-small "+(n?"pr-1":""),onClick:()=>h(i,e.value),startContent:n?(0,gt.jsx)(rv,{size:12,className:"ml-1"}):null,children:e.label},t)}),0===r.length&&(0,gt.jsx)("span",{className:"text-default-400 text-sm italic",children:"No options available"})]})},"1")})})},m={backgroundColor:s?"rgba(24, 24, 27, 0.95)":"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(24px)"},g={backgroundColor:s?"transparent":"rgba(255, 255, 255, 0.8)"},v={backgroundColor:s?"transparent":"rgba(255, 255, 255, 0.9)"};return(0,gt.jsx)(ud,{isOpen:e,onClose:t,size:"full",hideCloseButton:!0,className:"m-0 sm:m-0 h-[100dvh] max-h-[100dvh] w-full sm:w-[400px] rounded-none sm:rounded-none fixed right-0 inset-y-0",motionProps:{variants:{enter:{x:0,opacity:1,transition:{duration:.3,ease:"easeOut"}},exit:{x:"100%",opacity:.5,transition:{duration:.2,ease:"easeIn"}}}},classNames:{wrapper:"justify-end !items-start overflow-hidden",base:"h-full max-h-screen rounded-none shadow-2xl border-l border-zinc-200 dark:border-zinc-700",header:"border-b border-zinc-200/50 dark:border-zinc-700/50 p-4 h-[60px] flex items-center",body:"p-0",footer:"border-t border-zinc-200/50 dark:border-zinc-700/50 p-4",backdrop:"bg-black/20 backdrop-blur-[2px]"},scrollBehavior:"inside",children:(0,gt.jsxs)(Md,{style:m,children:[(0,gt.jsxs)(Pd,{className:"gap-2",style:g,children:[(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"light",onPress:t,size:"sm",children:(0,gt.jsx)(ug,{size:20,style:{color:s?"#a1a1aa":"#3f3f46"}})}),(0,gt.jsxs)("div",{className:"flex flex-col",children:[(0,gt.jsx)("span",{className:"text-lg font-bold leading-tight",style:{color:s?"#fafafa":"#18181b"},children:"Filters"}),(0,gt.jsxs)("span",{className:"text-xs font-normal",style:{color:s?"#a1a1aa":"#52525b"},children:["Active filters: ",p]})]}),p>0&&(0,gt.jsx)(La.T,{size:"sm",variant:"flat",color:"danger",startContent:(0,gt.jsx)(iv,{size:14}),onPress:()=>{i({camera:[],lens:[],photographer:[],location_id:[],year:[],ym:[],film:[]})},className:"ml-auto",children:"Reset"})]}),(0,gt.jsx)(kd,{style:v,children:(0,gt.jsxs)(_f,{className:"h-full p-4 space-y-2",children:[(0,gt.jsx)(f,{title:"Camera",icon:Ia,items:l.cameras,keyName:"camera",color:"success"}),(0,gt.jsx)(Ja,{className:"my-1 opacity-50"}),(0,gt.jsx)(f,{title:"Lens",icon:Ba,items:l.lenses,keyName:"lens",color:"warning"}),(0,gt.jsx)(Ja,{className:"my-1 opacity-50"}),(0,gt.jsx)(f,{title:"Film Stock",icon:Da,items:l.films.map(e=>({value:e.id||e.name,label:e.name})),keyName:"film",color:"secondary"}),(0,gt.jsx)(Ja,{className:"my-1 opacity-50"}),(0,gt.jsx)(f,{title:"Photographer",icon:av,items:l.photographers,keyName:"photographer",color:"primary"}),(0,gt.jsx)(Ja,{className:"my-1 opacity-50"}),(0,gt.jsx)("div",{className:"mb-2",children:(0,gt.jsx)(tv,{isCompact:!0,variant:"light",defaultExpandedKeys:["1"],children:(0,gt.jsx)(nv,{title:(0,gt.jsxs)("div",{className:"flex items-center gap-2 text-default-600 font-medium",children:[(0,gt.jsx)(Fa,{size:18}),(0,gt.jsx)("span",{children:"Location"})]}),children:(0,gt.jsxs)("div",{className:"flex flex-wrap gap-2",children:[u.map((e,t)=>{const r=(n.location_id||[]).includes(e.id);return(0,gt.jsx)(el,{variant:r?"flat":"bordered",color:r?"danger":"default",className:"cursor-pointer transition-all hover:scale-105",onClick:()=>h("location_id",e.id),startContent:r?(0,gt.jsx)(rv,{size:12,className:"ml-1"}):null,children:e.name||e.city_name||`Location ${e.id}`},t)}),0===u.length&&(0,gt.jsx)("span",{className:"text-default-400 text-sm",children:"No locations"})]})},"1")})}),(0,gt.jsx)(Ja,{className:"my-1 opacity-50"}),(0,gt.jsx)("div",{className:"mb-4",children:(0,gt.jsx)(tv,{isCompact:!0,variant:"light",defaultExpandedKeys:["1"],children:(0,gt.jsx)(nv,{title:(0,gt.jsxs)("div",{className:"flex items-center gap-2 text-default-600 font-medium",children:[(0,gt.jsx)(ja,{size:18}),(0,gt.jsx)("span",{children:"Date"})]}),children:(0,gt.jsx)("div",{className:"flex flex-col gap-3",children:null===(a=l.years)||void 0===a?void 0:a.map(e=>{const t=(n.year||[]).includes(e);return(0,gt.jsxs)("div",{className:"bg-zinc-100/50 dark:bg-zinc-800/50 rounded-lg p-2",children:[(0,gt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,gt.jsx)("span",{className:"font-semibold text-small",children:e}),(0,gt.jsx)(el,{size:"sm",variant:t?"solid":"light",color:"primary",classNames:{content:"font-bold"},onClick:()=>(e=>{const t=Array.isArray(n.year)?n.year:[],r=t.includes(e)?t.filter(t=>t!==e):[...t,e],a=(n.ym||[]).filter(t=>!String(t).startsWith(`${e}-`));i({...n,year:r,ym:a})})(e),className:"cursor-pointer",children:"All Year"})]}),(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"4px"},children:bv.map((t,r)=>{const a=`${e}-${String(r+1).padStart(2,"0")}`,o=(n.ym||[]).includes(a);return(0,gt.jsx)("div",{onClick:()=>((e,t)=>{var r;const a=`${e}-${String(t+1).padStart(2,"0")}`,o=n.ym||[],s=o.includes(a)?o.filter(e=>e!==a):[...o,a],l=null!==(r=n.year)&&void 0!==r&&r.includes(e)?n.year:[...n.year||[],e];i({...n,ym:s,year:l})})(e,r),style:{textAlign:"center",fontSize:"12px",padding:"6px 0",borderRadius:"6px",cursor:"pointer",transition:"all 0.15s",backgroundColor:o?"var(--heroui-primary)":"transparent",color:o?"white":"var(--heroui-default-600)",fontWeight:o?"600":"400"},className:"hover:bg-default-200",children:t},t)})})]},e)})})},"1")})})]})}),(0,gt.jsx)(Ld,{className:"flex-col gap-2",style:g,children:(0,gt.jsx)(La.T,{fullWidth:!0,color:"primary",size:"lg",className:"font-bold shadow-lg shadow-primary/20",onPress:t,children:"Show Results"})})]})})}const _v=$n("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function wv({placeholder:e="Search...",value:t,onChange:n,onSearch:i,debounceMs:a=300,className:o="",...s}){const[l,c]=(0,r.useState)(t||""),u=void 0!==t,d=u?t:l;(0,r.useEffect)(()=>{if(!i)return;const e=setTimeout(()=>{i(d)},a);return()=>clearTimeout(e)},[d,i,a]);const h=(0,r.useCallback)(e=>{const t=e.target.value;u||c(t),null===n||void 0===n||n(t)},[u,n]),p=(0,r.useCallback)(()=>{u||c(""),null===n||void 0===n||n(""),null===i||void 0===i||i("")},[u,n,i]);return(0,gt.jsxs)("div",{className:`relative ${o}`,children:[(0,gt.jsx)(_v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-400 dark:text-zinc-500 pointer-events-none"}),(0,gt.jsx)("input",{type:"text",value:d,onChange:h,placeholder:e,className:"w-full pl-9 pr-8 py-2 rounded-lg bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 text-sm \r border border-zinc-200 dark:border-zinc-700\r focus:outline-none focus:ring-2 focus:ring-primary/30 \r placeholder:text-zinc-400 dark:placeholder:text-zinc-500 transition-shadow",...s}),d&&(0,gt.jsx)("button",{onClick:p,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded-full \r hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-400 dark:text-zinc-500 hover:text-zinc-600 dark:hover:text-zinc-300 transition-colors",type:"button",children:(0,gt.jsx)(ug,{className:"w-3.5 h-3.5"})})]})}function Sv(){const[e,t]=(0,r.useState)("rolls"),[n,i]=(0,r.useState)(""),[a,o]=(0,r.useState)(!1),[s,l]=(0,r.useState)({camera:[],lens:[],photographer:[],location_id:[],year:[],ym:[],film:[]}),c=dg(n,300),u=(0,r.useMemo)(()=>{const e={};return Object.entries(s||{}).forEach(([t,n])=>{Array.isArray(n)?e[t]=[...n].sort():e[t]=n}),c&&(e.q=c),e},[s,c]),d=Rn({queryKey:["rolls",u],queryFn:()=>(0,bn.fn)(u),enabled:"rolls"===e,...vn("rolls"),keepPreviousData:!0}),h=Rn({queryKey:["photos",u],queryFn:()=>(0,bn.Mn)(u),enabled:"photos"===e,...vn("photos"),keepPreviousData:!0}),p="rolls"===e?d.isLoading:h.isLoading,f="rolls"===e?d.data:h.data,m=Object.values(s).reduce((e,t)=>e+(Array.isArray(t)?t.length:0),0);return(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("div",{className:"flex flex-row items-center justify-between gap-4 mb-6 whitespace-nowrap overflow-x-auto pb-2 scrollbar-hide",children:[(0,gt.jsxs)(lg,{selectedKey:e,onSelectionChange:t,color:"primary",variant:"solid",size:"lg",classNames:{tabList:"bg-zinc-100 dark:bg-zinc-800/50",tab:"data-[selected=true]:bg-white data-[selected=true]:dark:bg-zinc-700"},children:[(0,gt.jsx)(cg,{title:(0,gt.jsx)("div",{className:"flex items-center gap-2",children:(0,gt.jsx)("span",{children:"\ud83c\udf9e\ufe0f Rolls"})})},"rolls"),(0,gt.jsx)(cg,{title:(0,gt.jsx)("div",{className:"flex items-center gap-2",children:(0,gt.jsx)("span",{children:"\ud83d\udcf7 Photos"})})},"photos")]}),(0,gt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,gt.jsx)(wv,{placeholder:`Search ${e}...`,value:n,onChange:i,className:"w-64"}),(0,gt.jsx)(La.T,{variant:m>0?"solid":"flat",color:m>0?"primary":"default",startContent:(0,gt.jsx)(dm,{size:16}),endContent:m>0&&(0,gt.jsx)(el,{size:"sm",color:"primary",variant:"solid",className:"ml-1",children:m}),onPress:()=>o(!0),children:"Filters"}),(m>0||n)&&(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"flat",color:"danger",onPress:()=>{l({camera:[],lens:[],photographer:[],location_id:[],year:[],ym:[],film:[]}),i("")},children:(0,gt.jsx)(ug,{size:16})})]})]}),m>0&&(0,gt.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:Object.entries(s).map(([e,t])=>Array.isArray(t)&&t.map((n,r)=>(0,gt.jsxs)(el,{onClose:()=>{const r=t.filter(e=>e!==n);l(t=>({...t,[e]:r}))},variant:"flat",color:"primary",size:"sm",children:[e,": ",n]},`${e}-${r}`)))}),(0,gt.jsx)(ld.N,{mode:"wait",children:p?(0,gt.jsx)(ju.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center justify-center py-20",children:(0,gt.jsx)(np.o,{size:"lg",color:"primary"})},"loading"):(0,gt.jsx)(ju.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:0===(null===f||void 0===f?void 0:f.length)?(0,gt.jsxs)("div",{className:"text-center py-20 text-zinc-400 dark:text-zinc-500",children:[(0,gt.jsxs)("p",{className:"text-lg mb-2",children:["No ",e," found"]}),(0,gt.jsx)("p",{className:"text-sm",children:"Try adjusting your filters or search query"})]}):"rolls"===e?(0,gt.jsx)(er,{rolls:f||[],horizontal:!0}):(0,gt.jsx)(Dg,{photos:f||[],horizontal:!0})},e)}),(0,gt.jsx)(xv,{isOpen:a,onClose:()=>o(!1),filters:s,onChange:l})]})}var Tv=function(){const[e,t]=(0,r.useState)(!1),[n,i]=(0,r.useState)([]),[a,o]=(0,r.useState)(0);return(0,gt.jsxs)("div",{className:"h-full overflow-y-auto custom-scrollbar",children:[(0,gt.jsxs)("div",{className:"p-6 max-w-[1800px] mx-auto",children:[(0,gt.jsx)(Dm,{onPhotoClick:(e,n)=>{i(n||[e]),o(n?n.findIndex(t=>t.id===e.id):0),t(!0)}}),(0,gt.jsx)(zm,{}),(0,gt.jsxs)(ju.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.5},children:[(0,gt.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4",children:"Browse Your Collection"}),(0,gt.jsx)(Sv,{})]})]}),e&&(0,gt.jsx)(Ra.default,{images:n,index:a,onClose:()=>t(!1)})]})};const Cv=$n("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function Mv(e){return Mv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mv(e)}function Ev(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Pv(e){Ev(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===Mv(e)&&"[object Date]"===t?new Date(e.getTime()):"number"===typeof e||"[object Number]"===t?new Date(e):("string"!==typeof e&&"[object String]"!==t||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function Nv(e){if(Ev(1,arguments),!function(e){return Ev(1,arguments),e instanceof Date||"object"===Mv(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!==typeof e)return!1;var t=Pv(e);return!isNaN(Number(t))}function kv(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Rv(e,t){return Ev(2,arguments),function(e,t){Ev(2,arguments);var n=Pv(e).getTime(),r=kv(t);return new Date(n+r)}(e,-kv(t))}function Lv(e){Ev(1,arguments);var t=Pv(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function Ov(e){Ev(1,arguments);var t=Pv(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=Lv(r),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var o=Lv(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function jv(e){Ev(1,arguments);var t=Pv(e),n=Lv(t).getTime()-function(e){Ev(1,arguments);var t=Ov(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),Lv(n)}(t).getTime();return Math.round(n/6048e5)+1}var Dv={};function Iv(){return Dv}function Bv(e,t){var n,r,i,a,o,s,l,c;Ev(1,arguments);var u=Iv(),d=kv(null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(s=o.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=Pv(e),p=h.getUTCDay(),f=(p<d?7:0)+p-d;return h.setUTCDate(h.getUTCDate()-f),h.setUTCHours(0,0,0,0),h}function Fv(e,t){var n,r,i,a,o,s,l,c;Ev(1,arguments);var u=Pv(e),d=u.getUTCFullYear(),h=Iv(),p=kv(null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(s=o.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==i?i:h.firstWeekContainsDate)&&void 0!==r?r:null===(l=h.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==n?n:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var f=new Date(0);f.setUTCFullYear(d+1,0,p),f.setUTCHours(0,0,0,0);var m=Bv(f,t),g=new Date(0);g.setUTCFullYear(d,0,p),g.setUTCHours(0,0,0,0);var v=Bv(g,t);return u.getTime()>=m.getTime()?d+1:u.getTime()>=v.getTime()?d:d-1}function zv(e,t){Ev(1,arguments);var n=Pv(e),r=Bv(n,t).getTime()-function(e,t){var n,r,i,a,o,s,l,c;Ev(1,arguments);var u=Iv(),d=kv(null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(s=o.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==i?i:u.firstWeekContainsDate)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==n?n:1),h=Fv(e,t),p=new Date(0);return p.setUTCFullYear(h,0,d),p.setUTCHours(0,0,0,0),Bv(p,t)}(n,t).getTime();return Math.round(r/6048e5)+1}function Uv(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var Vv={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return Uv("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):Uv(n+1,2)},d:function(e,t){return Uv(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return Uv(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Uv(e.getUTCHours(),t.length)},m:function(e,t){return Uv(e.getUTCMinutes(),t.length)},s:function(e,t){return Uv(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return Uv(Math.floor(r*Math.pow(10,n-3)),t.length)}},Gv=Vv,qv="midnight",Wv="noon",Hv="morning",$v="afternoon",Kv="evening",Xv="night",Yv={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return Gv.y(e,t)},Y:function(e,t,n,r){var i=Fv(e,r),a=i>0?i:1-i;return"YY"===t?Uv(a%100,2):"Yo"===t?n.ordinalNumber(a,{unit:"year"}):Uv(a,t.length)},R:function(e,t){return Uv(Ov(e),t.length)},u:function(e,t){return Uv(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return Uv(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return Uv(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return Gv.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return Uv(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=zv(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):Uv(i,t.length)},I:function(e,t,n){var r=jv(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):Uv(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):Gv.d(e,t)},D:function(e,t,n){var r=function(e){Ev(1,arguments);var t=Pv(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):Uv(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return Uv(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return Uv(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return Uv(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?Wv:0===i?qv:i/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?Kv:i>=12?$v:i>=4?Hv:Xv,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return Gv.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Gv.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):Uv(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):Uv(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Gv.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Gv.s(e,t)},S:function(e,t){return Gv.S(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return Zv(i);case"XXXX":case"XX":return Jv(i);default:return Jv(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return Zv(i);case"xxxx":case"xx":return Jv(i);default:return Jv(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Qv(i,":");default:return"GMT"+Jv(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Qv(i,":");default:return"GMT"+Jv(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return Uv(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return Uv((r._originalDate||e).getTime(),t.length)}};function Qv(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),a=r%60;if(0===a)return n+String(i);var o=t||"";return n+String(i)+o+Uv(a,2)}function Zv(e,t){return e%60===0?(e>0?"-":"+")+Uv(Math.abs(e)/60,2):Jv(e,t)}function Jv(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+Uv(Math.floor(i/60),2)+n+Uv(i%60,2)}var eA=Yv,tA=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},nA=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},rA={p:nA,P:function(e,t){var n,r=e.match(/(P+)(p+)?/)||[],i=r[1],a=r[2];if(!a)return tA(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",tA(i,t)).replace("{{time}}",nA(a,t))}},iA=rA;var aA=["D","DD"],oA=["YY","YYYY"];function sA(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var lA={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},cA=function(e,t,n){var r,i=lA[e];return r="string"===typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function uA(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}var dA={date:uA({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:uA({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:uA({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},hA={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},pA=function(e,t,n,r){return hA[e]};function fA(e){return function(t,n){var r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,a=null!==n&&void 0!==n&&n.width?String(n.width):i;r=e.formattingValues[a]||e.formattingValues[i]}else{var o=e.defaultWidth,s=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[s]||e.values[o]}return r[e.argumentCallback?e.argumentCallback(t):t]}}var mA={ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:fA({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:fA({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:fA({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:fA({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:fA({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function gA(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(i);if(!a)return null;var o,s=a[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return}(l,function(e){return e.test(s)}):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n;return}(l,function(e){return e.test(s)});return o=e.valueCallback?e.valueCallback(c):c,{value:o=n.valueCallback?n.valueCallback(o):o,rest:t.slice(s.length)}}}var vA,AA={ordinalNumber:(vA={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(vA.matchPattern);if(!n)return null;var r=n[0],i=e.match(vA.parsePattern);if(!i)return null;var a=vA.valueCallback?vA.valueCallback(i[0]):i[0];return{value:a=t.valueCallback?t.valueCallback(a):a,rest:e.slice(r.length)}}),era:gA({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:gA({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:gA({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:gA({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:gA({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},yA={code:"en-US",formatDistance:cA,formatLong:dA,formatRelative:pA,localize:mA,match:AA,options:{weekStartsOn:0,firstWeekContainsDate:1}},bA=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xA=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,_A=/^'([^]*?)'?$/,wA=/''/g,SA=/[a-zA-Z]/;function TA(e,t,n){var r,i,a,o,s,l,c,u,d,h,p,f,m,g,v,A,y,b;Ev(2,arguments);var x=String(t),_=Iv(),w=null!==(r=null!==(i=null===n||void 0===n?void 0:n.locale)&&void 0!==i?i:_.locale)&&void 0!==r?r:yA,S=kv(null!==(a=null!==(o=null!==(s=null!==(l=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==l?l:null===n||void 0===n||null===(c=n.locale)||void 0===c||null===(u=c.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==s?s:_.firstWeekContainsDate)&&void 0!==o?o:null===(d=_.locale)||void 0===d||null===(h=d.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==a?a:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var T=kv(null!==(p=null!==(f=null!==(m=null!==(g=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==g?g:null===n||void 0===n||null===(v=n.locale)||void 0===v||null===(A=v.options)||void 0===A?void 0:A.weekStartsOn)&&void 0!==m?m:_.weekStartsOn)&&void 0!==f?f:null===(y=_.locale)||void 0===y||null===(b=y.options)||void 0===b?void 0:b.weekStartsOn)&&void 0!==p?p:0);if(!(T>=0&&T<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!w.localize)throw new RangeError("locale must contain localize property");if(!w.formatLong)throw new RangeError("locale must contain formatLong property");var C=Pv(e);if(!Nv(C))throw new RangeError("Invalid time value");var M=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}(C),E=Rv(C,M),P={firstWeekContainsDate:S,weekStartsOn:T,locale:w,_originalDate:C};return x.match(xA).map(function(e){var t=e[0];return"p"===t||"P"===t?(0,iA[t])(e,w.formatLong):e}).join("").match(bA).map(function(r){if("''"===r)return"'";var i=r[0];if("'"===i)return function(e){var t=e.match(_A);if(!t)return e;return t[1].replace(wA,"'")}(r);var a,o=eA[i];if(o)return null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||(a=r,-1===oA.indexOf(a))||sA(r,t,String(e)),null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!function(e){return-1!==aA.indexOf(e)}(r)||sA(r,t,String(e)),o(E,r,w.localize,P);if(i.match(SA))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return r}).join("")}const CA=$n("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);function MA(e,t){Ev(2,arguments);var n=Pv(e),r=kv(t);if(isNaN(r))return new Date(NaN);if(!r)return n;var i=n.getDate(),a=new Date(n.getTime());return a.setMonth(n.getMonth()+r+1,0),i>=a.getDate()?a:(n.setFullYear(a.getFullYear(),a.getMonth(),i),n)}function EA(e,t){return Ev(2,arguments),MA(e,12*kv(t))}function PA(e,t){Ev(2,arguments);var n=Pv(e),r=kv(t),i=n.getFullYear(),a=n.getDate(),o=new Date(0);o.setFullYear(i,r,15),o.setHours(0,0,0,0);var s=function(e){Ev(1,arguments);var t=Pv(e),n=t.getFullYear(),r=t.getMonth(),i=new Date(0);return i.setFullYear(n,r+1,0),i.setHours(0,0,0,0),i.getDate()}(o);return n.setMonth(r,Math.min(a,s)),n}function NA(e,t){var n,r,i,a,o,s,l,c;Ev(1,arguments);var u=Iv(),d=kv(null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(s=o.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=Pv(e),p=h.getDay(),f=(p<d?7:0)+p-d;return h.setDate(h.getDate()-f),h.setHours(0,0,0,0),h}function kA(e){Ev(1,arguments);var t=Pv(e);return t.setDate(1),t.setHours(0,0,0,0),t}function RA(e,t){var n,r,i,a,o,s,l,c;Ev(1,arguments);var u=Iv(),d=kv(null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(s=o.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=Pv(e),p=h.getDay(),f=6+(p<d?-7:0)-(p-d);return h.setDate(h.getDate()+f),h.setHours(23,59,59,999),h}function LA(e){Ev(1,arguments);var t=Pv(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function OA(e,t){var n;Ev(1,arguments);var r=e||{},i=Pv(r.start),a=Pv(r.end).getTime();if(!(i.getTime()<=a))throw new RangeError("Invalid interval");var o=[],s=i;s.setHours(0,0,0,0);var l=Number(null!==(n=null===t||void 0===t?void 0:t.step)&&void 0!==n?n:1);if(l<1||isNaN(l))throw new RangeError("`options.step` must be a number greater than 1");for(;s.getTime()<=a;)o.push(Pv(s)),s.setDate(s.getDate()+l),s.setHours(0,0,0,0);return o}const jA=new Map,DA=new Map;function IA(e){if(!e)return Promise.resolve(!1);if(jA.has(e))return Promise.resolve(!0);if(DA.has(e))return DA.get(e);const t=new Promise(t=>{const n=new Image;n.onload=()=>{jA.set(e,!0),DA.delete(e),t(!0)},n.onerror=()=>{DA.delete(e),t(!1)},n.src=e});return DA.set(e,t),t}new class{constructor(){this.queue=[],this.isProcessing=!1,this.concurrent=3,this.loading=0}add(e,t=5){if(!e||jA.has(e))return;this.queue.some(t=>t.url===e)||(this.queue.push({url:e,priority:t}),this.queue.sort((e,t)=>e.priority-t.priority),this.process())}async process(){if(this.isProcessing||this.loading>=this.concurrent)return;const e=this.queue.shift();if(e){this.isProcessing=!0,this.loading++;try{await IA(e.url)}catch(or){}this.loading--,this.isProcessing=!1,this.queue.length>0&&this.process()}else this.isProcessing=!1}clear(){this.queue=[]}};function BA(e,t){if(!e)return"";if(!t)return e;const n=t instanceof Date?t.getTime():"string"===typeof t?new Date(t).getTime():t;if(!n||isNaN(n))return e;const r=e.includes("?")?"&":"?";return`${e}${r}v=${n}`}const FA=(0,r.createContext)(null);function zA({children:e}){const[t,n]=(0,r.useState)(new Date),[i,a]=(0,r.useState)("month"),[o,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(()=>{try{return JSON.parse(localStorage.getItem("calendar_covers")||"{}")}catch{return{}}}),u=TA(t,"yyyy"),d=TA(t,"MM"),{data:h=[],isLoading:p,error:f}=Rn({queryKey:["photos",u,"month"===i?d:"all"],queryFn:async()=>{const e=(0,bn.Gi)(),t="month"===i?`${e}/api/photos?year=${u}&month=${d}`:`${e}/api/photos?year=${u}`,n=await fetch(t),r=await n.json();return Array.isArray(r)?r:[]}}),m=(0,r.useMemo)(()=>{const e=new Map;return(Array.isArray(h)?h:[]).forEach(t=>{if(!t.date_taken)return;const n=t.date_taken.split("T")[0];e.has(n)||e.set(n,[]),e.get(n).push(t)}),e},[h]),g=(0,r.useCallback)(()=>{n("month"===i?e=>function(e,t){return Ev(2,arguments),MA(e,-kv(t))}(e,1):e=>function(e,t){return Ev(2,arguments),EA(e,-kv(t))}(e,1))},[i]),v=(0,r.useCallback)(()=>{n("month"===i?e=>MA(e,1):e=>EA(e,1))},[i]),A=(0,r.useCallback)(e=>{n(t=>PA(t,e)),a("month")},[]),y=(0,r.useCallback)((e,t)=>{c(n=>{const r={...n,[e]:t};return localStorage.setItem("calendar_covers",JSON.stringify(r)),r})},[]),b=(0,r.useCallback)(e=>{if(!e)return null;let t=e.positive_thumb_rel_path||e.thumb_rel_path||e.positive_rel_path||e.full_rel_path;return t?(t.startsWith("http")||t.startsWith("/")||t.startsWith("uploads")||t.includes(":")||(t=`uploads/${t}`),BA((0,bn.FH)(t),e.updated_at)):null},[]),x=(0,r.useMemo)(()=>OA({start:NA(kA(t)),end:RA(LA(t))}),[t]),_=(0,r.useMemo)(()=>o&&m.get(TA(o,"yyyy-MM-dd"))||[],[o,m]),w={currentDate:t,viewMode:i,selectedDay:o,year:u,month:d,setViewMode:a,setSelectedDay:s,handlePrev:g,handleNext:v,switchToMonth:A,saveCoverPref:y,photos:h,photosByDay:m,calendarDays:x,selectedPhotos:_,coverPrefs:l,isLoading:p,error:f,getPhotoUrl:b};return(0,gt.jsx)(FA.Provider,{value:w,children:e})}function UA(){const e=(0,r.useContext)(FA);if(!e)throw new Error("useLifeLog must be used within LifeLogProvider");return e}function VA(e,t){Ev(2,arguments);var n=Pv(e),r=Pv(t);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()}function GA(e){Ev(1,arguments);var t=Pv(e);return t.setHours(0,0,0,0),t}function qA(e,t){Ev(2,arguments);var n=GA(e),r=GA(t);return n.getTime()===r.getTime()}var WA=n(9634);const HA=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function $A(){const{currentDate:e,photosByDay:t,setSelectedDay:n,getPhotoUrl:i,coverPrefs:a,saveCoverPref:o}=UA(),s=(0,r.useMemo)(()=>{const t=kA(e),n=LA(e),r=OA({start:NA(t,{weekStartsOn:0}),end:RA(n,{weekStartsOn:0})}),i=[];for(let e=0;e<r.length;e+=7)i.push(r.slice(e,e+7));return i},[e]);return(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-900 shadow-none overflow-hidden border-none",children:(0,gt.jsx)(Rm,{className:"p-0",children:(0,gt.jsxs)("table",{className:"w-full border-collapse table-fixed",children:[(0,gt.jsx)("thead",{children:(0,gt.jsx)("tr",{className:"bg-zinc-100/50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-700",children:HA.map((e,t)=>(0,gt.jsx)("th",{className:`\n                    py-3 text-center text-xs font-semibold uppercase tracking-wide\n                    ${0===t||6===t?"text-primary":"text-zinc-500 dark:text-zinc-400"}\n                  `,style:{width:"14.2857%"},children:e},e))})}),(0,gt.jsx)("tbody",{children:s.map((r,s)=>(0,gt.jsx)("tr",{className:"border-b border-zinc-200/50 dark:border-zinc-700/50 last:border-b-0",children:r.map((r,s)=>{const l=TA(r,"yyyy-MM-dd"),c=t.get(l)||[],u=VA(r,e),d=c.length>0,h=qA(r,new Date),p=a[l]||0,f=d?Math.abs(p%c.length):0,m=d?c[f]:null;return(0,gt.jsx)("td",{className:`\n                        relative p-0 align-top\n                        border-r border-zinc-200/50 dark:border-zinc-700/50 last:border-r-0\n                        ${u?"bg-white dark:bg-zinc-800":"bg-zinc-100/30 dark:bg-zinc-800/30"}\n                        ${d?"cursor-pointer hover:ring-2 hover:ring-primary hover:ring-inset":""}\n                        transition-all duration-200 group\n                      `,onClick:()=>d&&n(r),children:(0,gt.jsx)("div",{className:"relative w-full",style:{paddingBottom:"100%"},children:(0,gt.jsxs)("div",{className:"absolute inset-0",children:[(0,gt.jsx)("div",{className:`\n                        absolute top-1.5 left-2 z-20\n                        text-xs font-medium\n                        ${u?"":"opacity-40"}\n                        ${m?"text-white drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]":""}\n                        ${h?"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center":""}\n                        ${h||m?"":"text-zinc-500 dark:text-zinc-400"}\n                      `,children:TA(r,"d")}),m&&u&&(0,gt.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,gt.jsx)(WA.LazyLoadImage,{src:i(m),alt:"",effect:"opacity",className:"w-full h-full object-cover",wrapperClassName:"w-full h-full block"}),(0,gt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/20"}),c.length>1&&(0,gt.jsxs)("div",{className:"absolute inset-x-0 bottom-0 flex items-center justify-between px-1 py-1 opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-t from-black/60 to-transparent z-30",children:[(0,gt.jsx)(ju.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),o(l,p-1)},className:"w-5 h-5 rounded-full bg-white/80 flex items-center justify-center text-black",children:(0,gt.jsx)(Om,{size:12})}),(0,gt.jsx)("span",{className:"text-white text-xs font-medium",children:c.length}),(0,gt.jsx)(ju.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),o(l,p+1)},className:"w-5 h-5 rounded-full bg-white/80 flex items-center justify-center text-black",children:(0,gt.jsx)(jm,{size:12})})]}),1===c.length&&(0,gt.jsx)("div",{className:"absolute bottom-1 right-1 bg-black/50 text-white text-[10px] px-1.5 py-0.5 rounded",children:"1"})]}),m&&(m.city_name||m.country_name)&&(0,gt.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity truncate z-20 pointer-events-none",children:["\ud83d\udccd ",m.city_name||m.country_name]})]})})},r.toString())})},s))})]})})})}const KA=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];function XA(){const{year:e,photosByDay:t,switchToMonth:n,getPhotoUrl:i,coverPrefs:a}=UA(),o=(0,r.useMemo)(()=>Array.from({length:12},(t,n)=>{const r=new Date(parseInt(e),n,1),i=kA(r),a=LA(r),o=OA({start:NA(i,{weekStartsOn:0}),end:RA(a,{weekStartsOn:0})}),s=[];for(let e=0;e<o.length;e+=7)s.push(o.slice(e,e+7));return{index:n,date:r,weeks:s,name:TA(r,"MMMM")}}),[e]),s=(0,r.useMemo)(()=>{const e=new Map;return t.forEach((t,n)=>{const r=n.substring(0,7);e.set(r,(e.get(r)||0)+t.length)}),e},[t]),l={display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"2px"};return(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"repeat(3, 1fr)",gap:"16px",width:"100%",height:"100%",padding:"16px"},children:o.map(({index:e,date:r,weeks:o,name:c})=>{const u=TA(r,"yyyy-MM"),d=s.get(u)||0;return(0,gt.jsx)(ju.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.02*e},style:{minHeight:0},children:(0,gt.jsx)(Nm,{isPressable:!0,onPress:()=>n(e),className:"w-full h-full bg-white dark:bg-zinc-900 hover:shadow-lg transition-all",children:(0,gt.jsxs)(Rm,{className:"p-3 h-full flex flex-col",children:[(0,gt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,gt.jsx)("h3",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:c}),d>0&&(0,gt.jsx)("span",{className:"text-[10px] bg-primary/20 text-primary px-1.5 py-0.5 rounded-full",children:d})]}),(0,gt.jsx)("div",{style:l,className:"mb-1",children:KA.map((e,t)=>(0,gt.jsx)("div",{className:"text-center text-[10px] font-medium "+(0===t||6===t?"text-primary":"text-zinc-400 dark:text-zinc-500"),children:e},t))}),(0,gt.jsx)("div",{className:"flex flex-col gap-[2px]",children:o.map((e,n)=>(0,gt.jsx)("div",{style:l,children:e.map((e,n)=>{const o=TA(e,"yyyy-MM-dd"),s=t.get(o)||[],l=s.length>0,c=VA(e,r),u=qA(e,new Date),d=a[o]||0,h=l?Math.abs(d%s.length):0,p=l?s[h]:null;return c?(0,gt.jsx)("div",{className:"relative w-full",style:{paddingBottom:"100%"},children:(0,gt.jsx)("div",{className:`\n                                absolute inset-0 rounded-sm overflow-hidden\n                                flex items-center justify-center\n                                ${l?"ring-1 ring-primary/50":""}\n                                ${u?"ring-2 ring-primary":""}\n                                ${u?"bg-primary/20":"bg-zinc-100/40 dark:bg-zinc-800/40"}\n                              `,children:l&&p?(0,gt.jsx)("img",{src:i(p),alt:"",className:"w-full h-full object-cover",loading:"lazy"}):(0,gt.jsx)("span",{className:"text-[9px] "+(u?"text-primary font-bold":"text-zinc-500 dark:text-zinc-400"),children:TA(e,"d")})})},n):(0,gt.jsx)("div",{className:"relative w-full",style:{paddingBottom:"100%"}},n)})},n))})]})})},e)})})}const YA={hidden:{opacity:0,scale:.9},visible:e=>({opacity:1,scale:1,transition:{delay:.05*e}})};function QA(){const{selectedDay:e,setSelectedDay:t,selectedPhotos:n,getPhotoUrl:i}=UA(),[a,o]=(0,r.useState)(null);if(!e)return null;return(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.7)"},onClick:e=>{e.target===e.currentTarget&&t(null)},children:(0,gt.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-700 shadow-2xl rounded-2xl w-full max-w-4xl max-h-[85vh] flex flex-col bg-white dark:bg-zinc-800",onClick:e=>e.stopPropagation(),children:[(0,gt.jsxs)("div",{className:"flex items-center justify-between gap-3 p-4 border-b border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,gt.jsx)("span",{className:"text-xl font-semibold",children:TA(e,"MMMM d, yyyy")}),(0,gt.jsxs)(el,{size:"sm",variant:"flat",color:"primary",children:[n.length," ",1===n.length?"photo":"photos"]})]}),(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"light",onPress:()=>t(null),children:(0,gt.jsx)(ug,{size:18})})]}),(0,gt.jsx)("div",{className:"flex-1 overflow-auto p-6 custom-scrollbar",children:(0,gt.jsx)(ld.N,{children:(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:n.map((e,t)=>(0,gt.jsxs)(ju.div,{custom:t,variants:YA,initial:"hidden",animate:"visible",whileHover:{scale:1.02},className:"relative aspect-square rounded-xl overflow-hidden cursor-pointer group shadow-md",onClick:()=>o(t),children:[(0,gt.jsx)(WA.LazyLoadImage,{src:i(e),alt:"",effect:"opacity",className:"w-full h-full object-cover",wrapperClassName:"w-full h-full"}),Array.isArray(e.tags)&&e.tags.length>0&&(0,gt.jsxs)("div",{className:"absolute top-2 left-2 flex flex-wrap gap-1 max-w-[calc(100%-40px)]",children:[e.tags.slice(0,3).map((e,t)=>(0,gt.jsx)(el,{size:"sm",variant:"flat",classNames:{base:"bg-black/50 backdrop-blur-sm",content:"text-white text-[10px]"},children:e.name||e},t)),e.tags.length>3&&(0,gt.jsxs)(el,{size:"sm",variant:"flat",classNames:{base:"bg-black/50 backdrop-blur-sm",content:"text-white text-[10px]"},children:["+",e.tags.length-3]})]}),Number(e.rating)>0&&(0,gt.jsx)("div",{className:"absolute top-2 right-2",children:(0,gt.jsx)(Im,{size:18,className:"text-red-400 fill-red-400 drop-shadow-lg"})}),(0,gt.jsxs)("div",{className:"absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-3 pt-8 translate-y-full group-hover:translate-y-0 transition-transform",children:[(e.city_name||e.country_name)&&(0,gt.jsxs)("div",{className:"flex items-center gap-1 text-white/80 text-xs mb-1",children:[(0,gt.jsx)(Fa,{size:12}),(0,gt.jsx)("span",{className:"truncate",children:e.city_name||e.country_name})]}),e.caption&&(0,gt.jsx)("p",{className:"text-white text-sm truncate",children:e.caption})]}),(0,gt.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]},e.id))})})}),(0,gt.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-700 flex justify-end",children:(0,gt.jsx)(La.T,{color:"default",variant:"flat",onPress:()=>t(null),startContent:(0,gt.jsx)(ug,{size:16}),children:"Close"})})]})}),null!==a&&(0,gt.jsx)(Ra.default,{images:n,index:a,onClose:()=>o(null),onPhotoUpdate:()=>{}})]})}function ZA(){const{currentDate:e,viewMode:t,setViewMode:n,handlePrev:r,handleNext:i,year:a,isLoading:o,error:s}=UA();return s?(0,gt.jsx)(Nm,{className:"bg-danger-50",children:(0,gt.jsxs)(Rm,{className:"p-6 text-center text-danger",children:["Failed to load photos: ",s.message]})}):(0,gt.jsxs)("div",{className:"h-full flex flex-col",children:[(0,gt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,gt.jsx)("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Life Log"}),(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-900 shadow-none border-none",children:(0,gt.jsxs)(Rm,{className:"flex flex-row items-center gap-4 py-2 px-4",children:[(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"light",size:"sm",onPress:r,"aria-label":"Previous",children:(0,gt.jsx)(Om,{size:20})}),(0,gt.jsx)("div",{className:"flex items-center gap-2 cursor-pointer select-none min-w-32 justify-center",onClick:()=>n("month"===t?"year":"month"),children:"month"===t?(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("span",{className:"text-lg font-semibold hover:text-primary transition-colors",children:TA(e,"MMMM")}),(0,gt.jsx)("span",{className:"text-lg font-semibold hover:text-primary transition-colors",children:a})]}):(0,gt.jsx)("span",{className:"text-lg font-semibold",children:a})}),(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"light",size:"sm",onPress:i,"aria-label":"Next",children:(0,gt.jsx)(jm,{size:20})}),(0,gt.jsx)("div",{className:"w-px h-6 bg-divider mx-1"}),(0,gt.jsxs)("div",{className:"flex gap-1",children:[(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"month"===t?"solid":"light",color:"month"===t?"primary":"default",size:"sm",onPress:()=>n("month"),"aria-label":"Month View",children:(0,gt.jsx)(ja,{size:16})}),(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"year"===t?"solid":"light",color:"year"===t?"primary":"default",size:"sm",onPress:()=>n("year"),"aria-label":"Year View",children:(0,gt.jsx)(CA,{size:16})})]})]})})]}),o&&(0,gt.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,gt.jsx)(np.o,{size:"lg",color:"primary"})}),!o&&(0,gt.jsx)(ld.N,{mode:"wait",children:(0,gt.jsx)(ju.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"flex-1 overflow-hidden",children:"month"===t?(0,gt.jsx)($A,{}):(0,gt.jsx)(XA,{})},t)}),(0,gt.jsx)(QA,{})]})}function JA(){return(0,gt.jsx)(zA,{children:(0,gt.jsx)("div",{className:"h-full p-6",children:(0,gt.jsx)(ZA,{})})})}const ey=(0,r.createContext)(null),ty=["#FFB3BA","#FFDFBA","#FFFFBA","#BAFFC9","#BAE1FF","#E6B3FF","#FFB3E6","#B3FFF0","#E2F0CB","#FFDAC1","#C7CEEA","#FF9AA2","#E2F0CB","#B5EAD7","#C7CEEA","#F0E68C","#D8BFD8","#ADD8E6","#90EE90","#FFB6C1"];function ny(e,t="start"){return"start"===t?e.start_date||e.startDate||e.shot_date||e.created_at||e.createdAt||e.date||null:e.end_date||e.endDate||null}function ry({children:e}){const[t,n]=(0,r.useState)(null),[i,a]=(0,r.useState)(null),{data:o=[],isLoading:s,error:l}=Rn({queryKey:["rolls"],queryFn:()=>(0,bn.fn)()}),c=(0,r.useMemo)(()=>function(e){const t=new Map;return e.forEach(e=>{const n=e.start_date||e.startDate||e.shot_date||e.created_at||e.createdAt||e.date||null;let r="Unknown",i="All";if(n){const e=new Date(n);isNaN(e.getTime())||(r=String(e.getFullYear()),i=String(e.getMonth()+1).padStart(2,"0"))}t.has(r)||t.set(r,new Map);const a=t.get(r);a.has(i)||a.set(i,[]),a.get(i).push(e)}),t}(o),[o]),u=(0,r.useMemo)(()=>Array.from(c.keys()).sort((e,t)=>"Unknown"===e?1:"Unknown"===t?-1:Number(t)-Number(e)),[c]),d=(0,r.useMemo)(()=>{if(!t)return[];const e=new Set,n=c.get(t)||new Map;Array.from(n.keys()).forEach(t=>e.add(t));return Array.from(n.values()).flat().forEach(n=>{const r=ny(n,"start"),i=ny(n,"end"),a=r?new Date(r):null,o=i?new Date(i):null;if(!a&&!o)return;const s=Number(t),l=a&&a.getFullYear()===s?a.getMonth()+1:1,c=o&&o.getFullYear()===s?o.getMonth()+1:12;for(let t=l;t<=c;t++)e.add(String(t).padStart(2,"0"))}),Array.from(e).sort((e,t)=>Number(e)-Number(t))},[c,t]),h=(0,r.useMemo)(()=>{const e=new Map;return c.forEach((t,n)=>{let r=0;const i=new Map;t.forEach((e,t)=>{i.set(t,e.length),r+=e.length}),e.set(n,{total:r,months:i})}),e},[c]),p=(0,r.useMemo)(()=>{if(!t)return o;const e=Number(t);o.length>0&&console.log("[Timeline] Sample roll data:",{id:o[0].id,title:o[0].title,start_date:o[0].start_date,startDate:o[0].startDate,end_date:o[0].end_date,endDate:o[0].endDate,shot_date:o[0].shot_date,date:o[0].date});return o.filter(t=>{const n=t.start_date||t.startDate||t.shot_date||t.date||null,r=t.end_date||t.endDate||null,a=n?new Date(n):null,o=r?new Date(r):null,s=a&&!isNaN(a.getTime())?a:null,l=o&&!isNaN(o.getTime())?o:null;if(!s&&!l)return!1;const c=s||l,u=l||s;let d,h;if(i&&"All"!==i){const t=Number(i)-1;d=new Date(e,t,1),h=new Date(e,t+1,0,23,59,59)}else d=new Date(e,0,1),h=new Date(e,11,31,23,59,59);return c<=h&&u>=d})},[o,t,i]),f={selectedYear:t,selectedMonth:i,setSelectedYear:n,setSelectedMonth:a,rolls:o,grouped:c,years:u,monthsForYear:d,counts:h,selectedRolls:p,isLoading:s,error:l,palette:ty,getRollColor:e=>ty[(Number(e)||0)%ty.length]};return(0,gt.jsx)(ey.Provider,{value:f,children:e})}function iy(){const e=(0,r.useContext)(ey);if(!e)throw new Error("useTimeline must be used within TimelineProvider");return e}const ay=$n("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);function oy(){const{selectedYear:e,selectedMonth:t,setSelectedYear:n,setSelectedMonth:r,years:i,monthsForYear:a,counts:o}=iy(),s=e=>{null===e?(n(null),r(null)):(n(e),r("All"))};return(0,gt.jsxs)("div",{className:"space-y-4",children:[(0,gt.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,gt.jsx)(ay,{className:"text-zinc-400 dark:text-zinc-500",size:18}),(0,gt.jsx)(La.T,{size:"sm",variant:e?"flat":"solid",color:e?"default":"primary",onPress:()=>s(null),className:"font-medium",children:"Recent"}),i.map(t=>{var n,r;const i=null!==(n=null===(r=o.get(t))||void 0===r?void 0:r.total)&&void 0!==n?n:0,a=e===t;return(0,gt.jsx)(La.T,{size:"sm",variant:a?"solid":"flat",color:a?"primary":"default",onPress:()=>s(t),className:"font-medium",endContent:(0,gt.jsx)(el,{size:"sm",variant:"flat",classNames:{base:a?"bg-primary-200/50":"bg-default-200",content:"text-xs font-medium"},children:i}),children:t},t)})]}),(0,gt.jsx)(ld.N,{mode:"wait",children:e&&(0,gt.jsx)(ju.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:(0,gt.jsxs)("div",{className:"flex items-center gap-2 flex-wrap pl-6",children:[(0,gt.jsx)(jm,{className:"text-zinc-400 dark:text-zinc-500",size:16}),(0,gt.jsx)(La.T,{size:"sm",variant:"All"===t?"solid":"bordered",color:"All"===t?"secondary":"default",onPress:()=>r("All"),className:"font-medium min-w-10",children:"All"}),a.map(n=>{var i,a,s;const l=null!==(i=null===(a=o.get(e))||void 0===a||null===(s=a.months)||void 0===s?void 0:s.get(n))&&void 0!==i?i:0,c=t===n,u=new Date(2e3,parseInt(n)-1).toLocaleString("en-US",{month:"short"});return(0,gt.jsx)(La.T,{size:"sm",variant:c?"solid":"bordered",color:c?"secondary":"default",onPress:()=>r(n),className:"font-medium min-w-16",endContent:l>0&&(0,gt.jsx)("span",{className:"text-xs opacity-70",children:l}),children:u},n)})]})})})]})}function sy(){const{selectedYear:e,selectedMonth:t,selectedRolls:n,getRollColor:i}=iy(),a=se(),o=(0,r.useMemo)(()=>{const r=(e,t)=>12*e+(t-1);let i=1/0,a=-1/0;if(e){if(!t||"All"===t){const t=Number(e);i=r(t,1),a=r(t,12)}}else{const e=new Date;a=r(e.getFullYear(),e.getMonth()+1),i=a-11}const o=n.map(t=>{const n=ny(t,"start"),o=ny(t,"end");let s=null,l=null;if(n){const e=new Date(n);isNaN(e)||(s=r(e.getFullYear(),e.getMonth()+1))}if(o){const e=new Date(o);isNaN(e)||(l=r(e.getFullYear(),e.getMonth()+1))}if(null===s&&null!==l&&(s=l),null!==s&&null===l&&(l=s),!e){var c,u;if(null===s&&null===l)return null;const e=null!==(u=s)&&void 0!==u?u:-1/0;if((null!==(c=l)&&void 0!==c?c:1/0)<i||e>a)return null}return{id:t.id,title:t.title,displaySeq:t.display_seq,startIndex:s,endIndex:l,roll:t}}).filter(Boolean),s=[];for(let e=i;e<=a;e++){const t=Math.floor(e/12),n=e%12+1;s.push({idx:e,year:String(t),month:String(n).padStart(2,"0"),monthName:new Date(t,n-1).toLocaleString("en-US",{month:"short"})})}const l=new Set;return o.forEach(e=>{if(null!=e.startIndex&&null!=e.endIndex)for(let t=e.startIndex;t<=e.endIndex;t++)l.add(t)}),{labels:s,rows:o,activeSet:l,minIdx:i,maxIdx:a}},[n,e,t]),{labels:s,rows:l}=o;return 0===s.length?(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-900 shadow-none border-none",children:(0,gt.jsx)(Rm,{className:"p-6 text-center text-zinc-500 dark:text-zinc-400",children:"No timeline data available"})}):(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-900 shadow-none border-none",children:(0,gt.jsxs)(Rm,{className:"p-4 w-full overflow-hidden",children:[(0,gt.jsxs)("div",{className:"grid gap-1 mb-4 w-full items-end pb-2 border-b border-zinc-200/50 dark:border-zinc-700/50",style:{gridTemplateColumns:`220px repeat(${s.length}, 1fr)`},children:[(0,gt.jsx)("div",{className:"font-semibold text-zinc-600 dark:text-zinc-300 text-sm px-2",children:e?`Year ${e}`:"Recent Activity"}),s.map(e=>(0,gt.jsxs)("div",{className:"text-center",children:[(0,gt.jsx)("div",{className:"text-[10px] text-zinc-400 dark:text-zinc-500 leading-tight",children:e.year}),(0,gt.jsx)("div",{className:"text-xs font-semibold text-zinc-600 dark:text-zinc-300",children:e.monthName})]},e.idx))]}),(0,gt.jsx)("div",{className:"space-y-1",children:l.map((e,t)=>{var n;return(0,gt.jsxs)(ju.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.02*t},className:"grid gap-1 group items-center",style:{gridTemplateColumns:`220px repeat(${s.length}, 1fr)`},children:[(0,gt.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded-lg cursor-pointer\r hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",onClick:()=>a(`/rolls/${e.id}`),children:[(0,gt.jsxs)(el,{size:"sm",variant:"flat",className:"min-w-10 font-semibold",style:{backgroundColor:i(e.id)+"60",color:"inherit"},children:["#",null!==(n=e.displaySeq)&&void 0!==n?n:e.id]}),(0,gt.jsx)("span",{className:"text-sm text-zinc-700 dark:text-zinc-200 truncate group-hover:text-primary transition-colors font-medium",children:e.title||"Untitled"})]}),s.map(t=>{const n=null!=e.startIndex&&null!=e.endIndex&&t.idx>=e.startIndex&&t.idx<=e.endIndex,r=t.idx===e.startIndex,o=t.idx===e.endIndex;return(0,gt.jsx)(ju.div,{whileHover:{scale:n?1.05:1},className:`\n                      h-5 rounded-sm transition-all duration-150\n                      ${n?"cursor-pointer shadow-sm":""}\n                      ${r?"rounded-l-full":""}\n                      ${o?"rounded-r-full":""}\n                    `,style:{backgroundColor:n?i(e.id):"var(--heroui-default-100)",opacity:n?.85:.4},onClick:()=>n&&a(`/rolls/${e.id}`),title:n?`${e.title||"Untitled"} - ${t.monthName} ${t.year}`:""},t.idx)})]},e.id)})})]})})}function ly(){const{selectedRolls:e,isLoading:t,getRollColor:n}=iy(),i=se(),a=(0,r.useMemo)(()=>e&&0!==e.length?e.map(e=>{var t;return{id:e.id,title:e.title,cover:e.coverPath||e.cover_photo,displaySeq:e.display_seq,photoCount:e.photo_count||(null===(t=e.photos)||void 0===t?void 0:t.length)||0,updatedAt:e.updated_at||e.cover_updated_at}}):[],[e]);return t?(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 mt-6",children:[...Array(8)].map((e,t)=>(0,gt.jsx)("div",{className:"rounded-xl overflow-hidden bg-white dark:bg-zinc-900",children:(0,gt.jsx)(zn,{className:"aspect-square"})},t))}):(console.log("[TimelineRollGrid] selectedRolls:",null===e||void 0===e?void 0:e.length,"thumbs:",a.length),0===a.length?(0,gt.jsxs)("div",{className:"text-center py-12 text-zinc-500 dark:text-zinc-400",children:[(0,gt.jsx)(Ia,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,gt.jsxs)("p",{children:["No rolls found for this period (selectedRolls: ",(null===e||void 0===e?void 0:e.length)||0,")"]})]}):(console.log("[TimelineRollGrid] Rendering grid with",a.length,"items"),(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 mt-6",children:a.map(e=>{var t;const r=BA((0,bn.FH)(e.cover),e.updatedAt),a=n(e.id);return(0,gt.jsx)("div",{onClick:()=>i(`/rolls/${e.id}`),className:"rounded-xl overflow-hidden cursor-pointer \r bg-white dark:bg-zinc-900\r hover:shadow-lg hover:scale-[1.02]\r transition-all duration-200",children:(0,gt.jsxs)("div",{className:"aspect-square relative overflow-hidden",children:[r?(0,gt.jsx)("img",{src:r,alt:e.title,className:"w-full h-full object-cover",loading:"lazy"}):(0,gt.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:a+"30"},children:(0,gt.jsx)(Ia,{size:32,className:"text-zinc-400 dark:text-zinc-500"})}),(0,gt.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent pt-8 pb-2 px-2",children:(0,gt.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,gt.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-xs font-bold text-white shrink-0",style:{backgroundColor:a},children:["#",null!==(t=e.displaySeq)&&void 0!==t?t:e.id]}),(0,gt.jsx)("p",{className:"text-sm font-medium text-white truncate",children:e.title||"Untitled"})]})})]})},e.id)})})))}function cy(){const{selectedMonth:e,isLoading:t,error:n}=iy();if(n)return(0,gt.jsx)(Nm,{className:"bg-danger-50",children:(0,gt.jsxs)(Rm,{className:"p-6 text-center text-danger",children:["Failed to load timeline data: ",n.message]})});if(t)return(0,gt.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,gt.jsx)(np.o,{size:"lg",color:"primary"})});const r=!e||"All"===e;return(0,gt.jsxs)(ju.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-6",children:[r&&(0,gt.jsx)("div",{children:(0,gt.jsx)(sy,{})}),(0,gt.jsx)(ly,{})]})}function uy(){return(0,gt.jsx)(ry,{children:(0,gt.jsxs)("div",{className:"p-6 space-y-6",children:[(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-900 shadow-none border-none",children:(0,gt.jsx)(Rm,{className:"p-4",children:(0,gt.jsx)(oy,{})})}),(0,gt.jsx)(cy,{})]})})}function dy(){const[e,t]=(0,r.useState)("timeline");return(0,gt.jsxs)("div",{className:"h-full flex flex-col",children:[(0,gt.jsx)("div",{className:"px-6 pt-8 pb-4",children:(0,gt.jsxs)(lg,{selectedKey:e,onSelectionChange:t,variant:"solid",color:"primary",size:"md",classNames:{base:"w-fit",tabList:"gap-2 bg-default-100 p-1 rounded-lg",cursor:"bg-primary shadow-sm",tab:"px-4 py-2 data-[selected=true]:text-primary-foreground",tabContent:"group-data-[selected=true]:text-primary-foreground font-medium"},children:[(0,gt.jsx)(cg,{title:(0,gt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,gt.jsx)(Cv,{size:16}),(0,gt.jsx)("span",{children:"Timeline"})]})},"timeline"),(0,gt.jsx)(cg,{title:(0,gt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,gt.jsx)(ja,{size:16}),(0,gt.jsx)("span",{children:"Life Log"})]})},"calendar")]})}),(0,gt.jsx)("div",{className:"flex-1 overflow-auto",children:"calendar"===e?(0,gt.jsx)(JA,{}):(0,gt.jsx)(uy,{})})]})}var hy=n(8387),py=n(5439),fy=n.n(py),my=n(7770),gy=n.n(my),vy=e=>0===e?0:e>0?1:-1,Ay=e=>"number"==typeof e&&e!=+e,yy=e=>"string"===typeof e&&e.indexOf("%")===e.length-1,by=e=>("number"===typeof e||e instanceof Number)&&!Ay(e),xy=e=>by(e)||"string"===typeof e,_y=0,wy=e=>{var t=++_y;return"".concat(e||"").concat(t)},Sy=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!by(e)&&"string"!==typeof e)return r;if(yy(e)){if(null==t)return r;var a=e.indexOf("%");n=t*parseFloat(e.slice(0,a))/100}else n=+e;return Ay(n)&&(n=r),i&&null!=t&&n>t&&(n=t),n},Ty=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,n={},r=0;r<t;r++){if(n[e[r]])return!0;n[e[r]]=!0}return!1};function Cy(e,t,n){return by(e)&&by(t)?e+n*(t-e):t}function My(e,t,n){if(e&&e.length)return e.find(e=>e&&("function"===typeof t?t(e):gy()(e,t))===n)}var Ey=e=>null===e||"undefined"===typeof e,Py=e=>Ey(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));function Ny(e){return null!=e}function ky(){}var Ry=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if("undefined"!==typeof console&&console.warn&&(void 0===t&&console.warn("LogUtils requires an error message argument"),!e))if(void 0===t)console.warn("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=0;console.warn(t.replace(/%s/g,()=>r[a++]))}},Ly=(e,t,n)=>{var{width:r="100%",height:i="100%",aspect:a,maxHeight:o}=n,s=yy(r)?e:Number(r),l=yy(i)?t:Number(i);return a&&a>0&&(s?l=s/a:l&&(s=l*a),o&&null!=l&&l>o&&(l=o)),{calculatedWidth:s,calculatedHeight:l}},Oy={width:0,height:0,overflow:"visible"},jy={width:0,overflowX:"visible"},Dy={height:0,overflowY:"visible"},Iy={},By=e=>{var{width:t,height:n}=e,r=yy(t),i=yy(n);return r&&i?Oy:r?jy:i?Dy:Iy};function Fy(e){return Number.isFinite(e)}function zy(e){return"number"===typeof e&&e>0&&Number.isFinite(e)}function Uy(){return Uy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Uy.apply(null,arguments)}function Vy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Gy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vy(Object(n),!0).forEach(function(t){qy(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vy(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function qy(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Wy=(0,r.createContext)({width:-1,height:-1});function Hy(e){var{children:t,width:n,height:i}=e,a=(0,r.useMemo)(()=>({width:n,height:i}),[n,i]);return function(e){return zy(e.width)&&zy(e.height)}(a)?r.createElement(Wy.Provider,{value:a},t):null}var $y=()=>(0,r.useContext)(Wy),Ky=(0,r.forwardRef)((e,t)=>{var{aspect:n,initialDimension:i={width:-1,height:-1},width:a,height:o,minWidth:s=0,minHeight:l,maxHeight:c,children:u,debounce:d=0,id:h,className:p,onResize:f,style:m={}}=e,g=(0,r.useRef)(null),v=(0,r.useRef)();v.current=f,(0,r.useImperativeHandle)(t,()=>g.current);var[A,y]=(0,r.useState)({containerWidth:i.width,containerHeight:i.height}),b=(0,r.useCallback)((e,t)=>{y(n=>{var r=Math.round(e),i=Math.round(t);return n.containerWidth===r&&n.containerHeight===i?n:{containerWidth:r,containerHeight:i}})},[]);(0,r.useEffect)(()=>{if(null==g.current||"undefined"===typeof ResizeObserver)return ky;var e=e=>{var t,{width:n,height:r}=e[0].contentRect;b(n,r),null===(t=v.current)||void 0===t||t.call(v,n,r)};d>0&&(e=fy()(e,d,{trailing:!0,leading:!1}));var t=new ResizeObserver(e),{width:n,height:r}=g.current.getBoundingClientRect();return b(n,r),t.observe(g.current),()=>{t.disconnect()}},[b,d]);var{containerWidth:x,containerHeight:_}=A;Ry(!n||n>0,"The aspect(%s) must be greater than zero.",n);var{calculatedWidth:w,calculatedHeight:S}=Ly(x,_,{width:a,height:o,aspect:n,maxHeight:c});return Ry(null!=w&&w>0||null!=S&&S>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",w,S,a,o,s,l,n),r.createElement("div",{id:h?"".concat(h):void 0,className:(0,hy.$)("recharts-responsive-container",p),style:Gy(Gy({},m),{},{width:a,height:o,minWidth:s,minHeight:l,maxHeight:c}),ref:g},r.createElement("div",{style:By({width:a,height:o})},r.createElement(Hy,{width:w,height:S},u)))}),Xy=(0,r.forwardRef)((e,t)=>{var n=$y();if(zy(n.width)&&zy(n.height))return e.children;var{width:i,height:a}=function(e){var{width:t,height:n,aspect:r}=e,i=t,a=n;return void 0===i&&void 0===a?(i="100%",a="100%"):void 0===i?i=r&&r>0?void 0:"100%":void 0===a&&(a=r&&r>0?void 0:"100%"),{width:i,height:a}}({width:e.width,height:e.height,aspect:e.aspect}),{calculatedWidth:o,calculatedHeight:s}=Ly(void 0,void 0,{width:i,height:a,aspect:e.aspect,maxHeight:e.maxHeight});return by(o)&&by(s)?r.createElement(Hy,{width:o,height:s},e.children):r.createElement(Ky,Uy({},e,{width:i,height:a,ref:t}))}),Yy=Symbol.for("immer-nothing"),Qy=Symbol.for("immer-draftable"),Zy=Symbol.for("immer-state");function Jy(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var eb=Object,tb=eb.getPrototypeOf,nb="constructor",rb="prototype",ib="configurable",ab="enumerable",ob="writable",sb="value",lb=e=>!!e&&!!e[Zy];function cb(e){return!!e&&(hb(e)||Ab(e)||!!e[Qy]||!!e[nb]?.[Qy]||yb(e)||bb(e))}var ub=eb[rb][nb].toString(),db=new WeakMap;function hb(e){if(!e||!xb(e))return!1;const t=tb(e);if(null===t||t===eb[rb])return!0;const n=eb.hasOwnProperty.call(t,nb)&&t[nb];if(n===Object)return!0;if(!_b(n))return!1;let r=db.get(n);return void 0===r&&(r=Function.toString.call(n),db.set(n,r)),r===ub}function pb(e,t,n=!0){if(0===fb(e)){(n?Reflect.ownKeys(e):eb.keys(e)).forEach(n=>{t(n,e[n],e)})}else e.forEach((n,r)=>t(r,n,e))}function fb(e){const t=e[Zy];return t?t.type_:Ab(e)?1:yb(e)?2:bb(e)?3:0}var mb=(e,t,n=fb(e))=>2===n?e.has(t):eb[rb].hasOwnProperty.call(e,t),gb=(e,t,n=fb(e))=>2===n?e.get(t):e[t],vb=(e,t,n,r=fb(e))=>{2===r?e.set(t,n):3===r?e.add(n):e[t]=n};var Ab=Array.isArray,yb=e=>e instanceof Map,bb=e=>e instanceof Set,xb=e=>"object"===typeof e,_b=e=>"function"===typeof e,wb=e=>"boolean"===typeof e,Sb=e=>e.copy_||e.base_,Tb=e=>e.modified_?e.copy_:e.base_;function Cb(e,t){if(yb(e))return new Map(e);if(bb(e))return new Set(e);if(Ab(e))return Array[rb].slice.call(e);const n=hb(e);if(!0===t||"class_only"===t&&!n){const t=eb.getOwnPropertyDescriptors(e);delete t[Zy];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],a=t[i];!1===a[ob]&&(a[ob]=!0,a[ib]=!0),(a.get||a.set)&&(t[i]={[ib]:!0,[ob]:!0,[ab]:a[ab],[sb]:e[i]})}return eb.create(tb(e),t)}{const t=tb(e);if(null!==t&&n)return{...e};const r=eb.create(t);return eb.assign(r,e)}}function Mb(e,t=!1){return Pb(e)||lb(e)||!cb(e)||(fb(e)>1&&eb.defineProperties(e,{set:Eb,add:Eb,clear:Eb,delete:Eb}),eb.freeze(e),t&&pb(e,(e,t)=>{Mb(t,!0)},!1)),e}var Eb={[sb]:function(){Jy(2)}};function Pb(e){return null===e||!xb(e)||eb.isFrozen(e)}var Nb="MapSet",kb="Patches",Rb={};function Lb(e){const t=Rb[e];return t||Jy(0),t}var Ob;var jb=()=>Ob;function Db(e,t){t&&(e.patchPlugin_=Lb(kb),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Ib(e){Bb(e),e.drafts_.forEach(zb),e.drafts_=null}function Bb(e){e===Ob&&(Ob=e.parent_)}var Fb=e=>Ob=((e,t)=>{return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:(n=Nb,Rb[n]?Lb(Nb):void 0)};var n})(Ob,e);function zb(e){const t=e[Zy];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Ub(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];if(void 0!==e&&e!==n){n[Zy].modified_&&(Ib(t),Jy(4)),cb(e)&&(e=Vb(t,e));const{patchPlugin_:r}=t;r&&r.generateReplacementPatches_(n[Zy].base_,e,t)}else e=Vb(t,n);return function(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Mb(t,n)}(t,e,!0),Ib(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Yy?e:void 0}function Vb(e,t){if(Pb(t))return t;const n=t[Zy];if(!n){return Kb(t,e.handledSet_,e)}if(!qb(n,e))return t;if(!n.modified_)return n.base_;if(!n.finalized_){const{callbacks_:t}=n;if(t)for(;t.length>0;){t.pop()(e)}$b(n,e)}return n.copy_}function Gb(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var qb=(e,t)=>e.scope_===t,Wb=[];function Hb(e,t,n,r){const i=Sb(e),a=e.type_;if(void 0!==r){if(gb(i,r,a)===t)return void vb(i,r,n,a)}if(!e.draftLocations_){const t=e.draftLocations_=new Map;pb(i,(e,n)=>{if(lb(n)){const r=t.get(n)||[];r.push(e),t.set(n,r)}})}const o=e.draftLocations_.get(t)??Wb;for(const s of o)vb(i,s,n,a)}function $b(e,t){if(e.modified_&&!e.finalized_&&(3===e.type_||(e.assigned_?.size??0)>0)){const{patchPlugin_:n}=t;if(n){const r=n.getPath(e);r&&n.generatePatches_(e,r,t)}Gb(e)}}function Kb(e,t,n){return!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||lb(e)||t.has(e)||!cb(e)||Pb(e)||(t.add(e),pb(e,(r,i)=>{if(lb(i)){const t=i[Zy];if(qb(t,n)){const n=Tb(t);vb(e,r,n,e.type_),Gb(t)}}else cb(i)&&Kb(i,t,n)})),e}var Xb={get(e,t){if(t===Zy)return e;const n=Sb(e);if(!mb(n,t,e.type_))return function(e,t,n){const r=Zb(t,n);return r?sb in r?r[sb]:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];if(e.finalized_||!cb(r))return r;if(r===Qb(e.base_,t)){ex(e);const n=1===e.type_?+t:t,i=tx(e.scope_,r,e,n);return e.copy_[n]=i}return r},has(e,t){return t in Sb(e)},ownKeys(e){return Reflect.ownKeys(Sb(e))},set(e,t,n){const r=Zb(Sb(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=Qb(Sb(e),t),i=r?.[Zy];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_.set(t,!1),!0;if(function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}(n,r)&&(void 0!==n||mb(e.base_,t,e.type_)))return!0;ex(e),Jb(e)}return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_.set(t,!0),function(e,t,n){const{scope_:r}=e;if(lb(n)){const i=n[Zy];qb(i,r)&&i.callbacks_.push(function(){ex(e);const r=Tb(i);Hb(e,n,r,t)})}else cb(n)&&e.callbacks_.push(function(){const i=Sb(e);gb(i,t,e.type_)===n&&r.drafts_.length>1&&!0===(e.assigned_.get(t)??!1)&&e.copy_&&Kb(gb(e.copy_,t,e.type_),r.handledSet_,r)})}(e,t,n)),!0},deleteProperty(e,t){return ex(e),void 0!==Qb(e.base_,t)||t in e.base_?(e.assigned_.set(t,!1),Jb(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=Sb(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{[ob]:!0,[ib]:1!==e.type_||"length"!==t,[ab]:r[ab],[sb]:n[t]}:r},defineProperty(){Jy(11)},getPrototypeOf(e){return tb(e.base_)},setPrototypeOf(){Jy(12)}},Yb={};function Qb(e,t){const n=e[Zy];return(n?Sb(n):e)[t]}function Zb(e,t){if(!(t in e))return;let n=tb(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=tb(n)}}function Jb(e){e.modified_||(e.modified_=!0,e.parent_&&Jb(e.parent_))}function ex(e){e.copy_||(e.assigned_=new Map,e.copy_=Cb(e.base_,e.scope_.immer_.useStrictShallowCopy_))}pb(Xb,(e,t)=>{Yb[e]=function(){const e=arguments;return e[0]=e[0][0],t.apply(this,e)}}),Yb.deleteProperty=function(e,t){return Yb.set.call(this,e,t,void 0)},Yb.set=function(e,t,n){return Xb.set.call(this,e[0],t,n,e[0])};function tx(e,t,n,r){const[i,a]=yb(t)?Lb(Nb).proxyMap_(t,n):bb(t)?Lb(Nb).proxySet_(t,n):function(e,t){const n=Ab(e),r={type_:n?1:0,scope_:t?t.scope_:jb(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let i=r,a=Xb;n&&(i=[r],a=Yb);const{revoke:o,proxy:s}=Proxy.revocable(i,a);return r.draft_=s,r.revoke_=o,[s,r]}(t,n);return(n?.scope_??jb()).drafts_.push(i),a.callbacks_=n?.callbacks_??[],a.key_=r,n&&void 0!==r?function(e,t,n){e.callbacks_.push(function(r){const i=t;if(!i||!qb(i,r))return;r.mapSetPlugin_?.fixSetContents(i);const a=Tb(i);Hb(e,i.draft_??i,a,n),$b(i,r)})}(n,a,r):a.callbacks_.push(function(e){e.mapSetPlugin_?.fixSetContents(a);const{patchPlugin_:t}=e;a.modified_&&t&&t.generatePatches_(a,[],e)}),i}function nx(e){return lb(e)||Jy(10),rx(e)}function rx(e){if(!cb(e)||Pb(e))return e;const t=e[Zy];let n,r=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=Cb(e,t.scope_.immer_.useStrictShallowCopy_),r=t.scope_.immer_.shouldUseStrictIteration()}else n=Cb(e,!0);return pb(n,(e,t)=>{vb(n,e,rx(t))},r),t&&(t.finalized_=!1),n}var ix=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(e,t,n)=>{if(_b(e)&&!_b(t)){const n=t;t=e;const r=this;return function(e=n,...i){return r.produce(e,e=>t.call(this,e,...i))}}let r;if(_b(t)||Jy(6),void 0===n||_b(n)||Jy(7),cb(e)){const i=Fb(this),a=tx(i,e,void 0);let o=!0;try{r=t(a),o=!1}finally{o?Ib(i):Bb(i)}return Db(i,n),Ub(r,i)}if(!e||!xb(e)){if(r=t(e),void 0===r&&(r=e),r===Yy&&(r=void 0),this.autoFreeze_&&Mb(r,!0),n){const t=[],i=[];Lb(kb).generateReplacementPatches_(e,r,{patches_:t,inversePatches_:i}),n(t,i)}return r}Jy(1)},this.produceWithPatches=(e,t)=>{if(_b(e))return(t,...n)=>this.produceWithPatches(t,t=>e(t,...n));let n,r;const i=this.produce(e,t,(e,t)=>{n=e,r=t});return[i,n,r]},wb(e?.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),wb(e?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),wb(e?.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){cb(e)||Jy(8),lb(e)&&(e=nx(e));const t=Fb(this),n=tx(t,e,void 0);return n[Zy].isManual_=!0,Bb(t),n}finishDraft(e,t){const n=e&&e[Zy];n&&n.isManual_||Jy(9);const{scope_:r}=n;return Db(r,t),Ub(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=Lb(kb).applyPatches_;return lb(e)?r(e,t):this.produce(e,e=>r(e,t))}},ax=ix.produce;function ox(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var sx=(()=>"function"===typeof Symbol&&Symbol.observable||"@@observable")(),lx=()=>Math.random().toString(36).substring(7).split("").join("."),cx={INIT:`@@redux/INIT${lx()}`,REPLACE:`@@redux/REPLACE${lx()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${lx()}`};function ux(e){if("object"!==typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function dx(e,t,n){if("function"!==typeof e)throw new Error(ox(2));if("function"===typeof t&&"function"===typeof n||"function"===typeof n&&"function"===typeof arguments[3])throw new Error(ox(0));if("function"===typeof t&&"undefined"===typeof n&&(n=t,t=void 0),"undefined"!==typeof n){if("function"!==typeof n)throw new Error(ox(1));return n(dx)(e,t)}let r=e,i=t,a=new Map,o=a,s=0,l=!1;function c(){o===a&&(o=new Map,a.forEach((e,t)=>{o.set(t,e)}))}function u(){if(l)throw new Error(ox(3));return i}function d(e){if("function"!==typeof e)throw new Error(ox(4));if(l)throw new Error(ox(5));let t=!0;c();const n=s++;return o.set(n,e),function(){if(t){if(l)throw new Error(ox(6));t=!1,c(),o.delete(n),a=null}}}function h(e){if(!ux(e))throw new Error(ox(7));if("undefined"===typeof e.type)throw new Error(ox(8));if("string"!==typeof e.type)throw new Error(ox(17));if(l)throw new Error(ox(9));try{l=!0,i=r(i,e)}finally{l=!1}return(a=o).forEach(e=>{e()}),e}h({type:cx.INIT});return{dispatch:h,subscribe:d,getState:u,replaceReducer:function(e){if("function"!==typeof e)throw new Error(ox(10));r=e,h({type:cx.REPLACE})},[sx]:function(){const e=d;return{subscribe(t){if("object"!==typeof t||null===t)throw new Error(ox(11));function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[sx](){return this}}}}}function hx(e){const t=Object.keys(e),n={};for(let a=0;a<t.length;a++){const r=t[a];0,"function"===typeof e[r]&&(n[r]=e[r])}const r=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach(t=>{const n=e[t];if("undefined"===typeof n(void 0,{type:cx.INIT}))throw new Error(ox(12));if("undefined"===typeof n(void 0,{type:cx.PROBE_UNKNOWN_ACTION()}))throw new Error(ox(13))})}(n)}catch(or){i=or}return function(e={},t){if(i)throw i;let a=!1;const o={};for(let i=0;i<r.length;i++){const s=r[i],l=n[s],c=e[s],u=l(c,t);if("undefined"===typeof u){t&&t.type;throw new Error(ox(14))}o[s]=u,a=a||u!==c}return a=a||r.length!==Object.keys(e).length,a?o:e}}function px(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce((e,t)=>(...n)=>e(t(...n)))}function fx(e){return ux(e)&&"type"in e&&"string"===typeof e.type}function mx(e){return({dispatch:t,getState:n})=>r=>i=>"function"===typeof i?i(t,n,e):r(i)}var gx=mx(),vx=mx,Ax="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"===typeof arguments[0]?px:px.apply(null,arguments)};"undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;function yx(e,t){function n(...n){if(t){let r=t(...n);if(!r)throw new Error(f_(0));return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:n[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>fx(t)&&t.type===e,n}var bx=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function xx(e){return cb(e)?ax(e,()=>{}):e}function _x(e,t,n){return e.has(t)?e.get(t):e.set(t,n(t)).get(t)}var wx="RTK_autoBatch",Sx=()=>e=>({payload:e,meta:{[wx]:!0}}),Tx=e=>t=>{setTimeout(t,e)},Cx=(e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let i=!0,a=!1,o=!1;const s=new Set,l="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:Tx(10):"callback"===e.type?e.queueNotification:Tx(e.timeout),c=()=>{o=!1,a&&(a=!1,s.forEach(e=>e()))};return Object.assign({},r,{subscribe(e){const t=r.subscribe(()=>i&&e());return s.add(e),()=>{t(),s.delete(e)}},dispatch(e){try{return i=!e?.meta?.[wx],a=!i,a&&(o||(o=!0,l(c))),r.dispatch(e)}finally{i=!0}}})};function Mx(e){const t=function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{};let a=new bx;return t&&(function(e){return"boolean"===typeof e}(t)?a.push(gx):a.push(vx(t.extraArgument))),a},{reducer:n,middleware:r,devTools:i=!0,duplicateMiddlewareCheck:a=!0,preloadedState:o,enhancers:s}=e||{};let l,c;if("function"===typeof n)l=n;else{if(!ux(n))throw new Error(f_(1));l=hx(n)}c="function"===typeof r?r(t):t();let u=px;i&&(u=Ax({trace:!1,..."object"===typeof i&&i}));const d=function(...e){return t=>(n,r)=>{const i=t(n,r);let a=()=>{throw new Error(ox(15))};const o={getState:i.getState,dispatch:(e,...t)=>a(e,...t)},s=e.map(e=>e(o));return a=px(...s)(i.dispatch),{...i,dispatch:a}}}(...c),h=(e=>function(t){const{autoBatch:n=!0}=t??{};let r=new bx(e);return n&&r.push(Cx("object"===typeof n?n:void 0)),r})(d);return dx(l,o,u(..."function"===typeof s?s(h):h()))}function Ex(e){const t={},n=[];let r;const i={addCase(e,n){const r="string"===typeof e?e:e.type;if(!r)throw new Error(f_(28));if(r in t)throw new Error(f_(29));return t[r]=n,i},addAsyncThunk(e,r){return r.pending&&(t[e.pending.type]=r.pending),r.rejected&&(t[e.rejected.type]=r.rejected),r.fulfilled&&(t[e.fulfilled.type]=r.fulfilled),r.settled&&n.push({matcher:e.settled,reducer:r.settled}),i},addMatcher(e,t){return n.push({matcher:e,reducer:t}),i},addDefaultCase(e){return r=e,i}};return e(i),[t,n,r]}var Px=(e=21)=>{let t="",n=e;for(;n--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t};var Nx=Symbol.for("rtk-slice-createasyncthunk");function kx(e,t){return`${e}/${t}`}function Rx({creators:e}={}){const t=e?.asyncThunk?.[Nx];return function(e){const{name:n,reducerPath:r=n}=e;if(!n)throw new Error(f_(11));const i=("function"===typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:e}}()):e.reducers)||{},a=Object.keys(i),o={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},s={addCase(e,t){const n="string"===typeof e?e:e.type;if(!n)throw new Error(f_(12));if(n in o.sliceCaseReducersByType)throw new Error(f_(13));return o.sliceCaseReducersByType[n]=t,s},addMatcher(e,t){return o.sliceMatchers.push({matcher:e,reducer:t}),s},exposeAction(e,t){return o.actionCreators[e]=t,s},exposeCaseReducer(e,t){return o.sliceCaseReducersByName[e]=t,s}};function l(){const[t={},n=[],r]="function"===typeof e.extraReducers?Ex(e.extraReducers):[e.extraReducers],i={...t,...o.sliceCaseReducersByType};return function(e,t){let n,[r,i,a]=Ex(t);if(function(e){return"function"===typeof e}(e))n=()=>xx(e());else{const t=xx(e);n=()=>t}function o(e=n(),t){let o=[r[t.type],...i.filter(({matcher:e})=>e(t)).map(({reducer:e})=>e)];return 0===o.filter(e=>!!e).length&&(o=[a]),o.reduce((e,n)=>{if(n){if(lb(e)){const r=n(e,t);return void 0===r?e:r}if(cb(e))return ax(e,e=>n(e,t));{const r=n(e,t);if(void 0===r){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return r}}return e},e)}return o.getInitialState=n,o}(e.initialState,e=>{for(let t in i)e.addCase(t,i[t]);for(let t of o.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)})}a.forEach(r=>{const a=i[r],o={reducerName:r,type:kx(n,r),createNotation:"function"===typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(a)?function({type:e,reducerName:t,createNotation:n},r,i){let a,o;if("reducer"in r){if(n&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(r))throw new Error(f_(17));a=r.reducer,o=r.prepare}else a=r;i.addCase(e,a).exposeCaseReducer(t,a).exposeAction(t,o?yx(e,o):yx(e))}(o,a,s):function({type:e,reducerName:t},n,r,i){if(!i)throw new Error(f_(18));const{payloadCreator:a,fulfilled:o,pending:s,rejected:l,settled:c,options:u}=n,d=i(e,a,u);r.exposeAction(t,d),o&&r.addCase(d.fulfilled,o);s&&r.addCase(d.pending,s);l&&r.addCase(d.rejected,l);c&&r.addMatcher(d.settled,c);r.exposeCaseReducer(t,{fulfilled:o||jx,pending:s||jx,rejected:l||jx,settled:c||jx})}(o,a,s,t)});const c=e=>e,u=new Map,d=new WeakMap;let h;function p(e,t){return h||(h=l()),h(e,t)}function f(){return h||(h=l()),h.getInitialState()}function m(t,n=!1){function r(e){let i=e[t];return"undefined"===typeof i&&n&&(i=_x(d,r,f)),i}function i(t=c){const r=_x(u,n,()=>new WeakMap);return _x(r,t,()=>{const r={};for(const[i,a]of Object.entries(e.selectors??{}))r[i]=Lx(a,t,()=>_x(d,t,f),n);return r})}return{reducerPath:t,getSelectors:i,get selectors(){return i(r)},selectSlice:r}}const g={name:n,reducer:p,actions:o.actionCreators,caseReducers:o.sliceCaseReducersByName,getInitialState:f,...m(r),injectInto(e,{reducerPath:t,...n}={}){const i=t??r;return e.inject({reducerPath:i,reducer:p},n),{...g,...m(i,!0)}}};return g}}function Lx(e,t,n,r){function i(i,...a){let o=t(i);return"undefined"===typeof o&&r&&(o=n()),e(o,...a)}return i.unwrapped=e,i}var Ox=Rx();function jx(){}var Dx="listener",Ix="completed",Bx="cancelled",Fx=`task-${Bx}`,zx=`task-${Ix}`,Ux=`${Dx}-${Bx}`,Vx=`${Dx}-${Ix}`,Gx=class{constructor(e){this.code=e,this.message=`task ${Bx} (reason: ${e})`}name="TaskAbortError";message},qx=(e,t)=>{if("function"!==typeof e)throw new TypeError(f_(32))},Wx=()=>{},Hx=(e,t=Wx)=>(e.catch(t),e),$x=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),Kx=(e,t)=>{const n=e.signal;n.aborted||("reason"in n||Object.defineProperty(n,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},Xx=e=>{if(e.aborted){const{reason:t}=e;throw new Gx(t)}};function Yx(e,t){let n=Wx;return new Promise((r,i)=>{const a=()=>i(new Gx(e.reason));e.aborted?a():(n=$x(e,a),t.finally(()=>n()).then(r,i))}).finally(()=>{n=Wx})}var Qx=e=>t=>Hx(Yx(e,t).then(t=>(Xx(e),t))),Zx=e=>{const t=Qx(e);return e=>t(new Promise(t=>setTimeout(t,e)))},{assign:Jx}=Object,e_={},t_="listenerMiddleware",n_=(e,t)=>(n,r)=>{qx(n);const i=new AbortController;var a;a=i,$x(e,()=>Kx(a,e.reason));const o=(async(e,t)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(tJ){return{status:tJ instanceof Gx?"cancelled":"rejected",error:tJ}}finally{t?.()}})(async()=>{Xx(e),Xx(i.signal);const t=await n({pause:Qx(i.signal),delay:Zx(i.signal),signal:i.signal});return Xx(i.signal),t},()=>Kx(i,zx));return r?.autoJoin&&t.push(o.catch(Wx)),{result:Qx(e)(o),cancel(){Kx(i,Fx)}}},r_=(e,t)=>(n,r)=>Hx((async(n,r)=>{Xx(t);let i=()=>{};const a=[new Promise((t,r)=>{let a=e({predicate:n,effect:(e,n)=>{n.unsubscribe(),t([e,n.getState(),n.getOriginalState()])}});i=()=>{a(),r()}})];null!=r&&a.push(new Promise(e=>setTimeout(e,r,null)));try{const e=await Yx(t,Promise.race(a));return Xx(t),e}finally{i()}})(n,r)),i_=e=>{let{type:t,actionCreator:n,matcher:r,predicate:i,effect:a}=e;if(t)i=yx(t).match;else if(n)t=n.type,i=n.match;else if(r)i=r;else if(!i)throw new Error(f_(21));return qx(a),{predicate:i,type:t,effect:a}},a_=Jx(e=>{const{type:t,predicate:n,effect:r}=i_(e);return{id:Px(),effect:r,type:t,predicate:n,pending:new Set,unsubscribe:()=>{throw new Error(f_(22))}}},{withTypes:()=>a_}),o_=(e,t)=>{const{type:n,effect:r,predicate:i}=i_(t);return Array.from(e.values()).find(e=>("string"===typeof n?e.type===n:e.predicate===i)&&e.effect===r)},s_=e=>{e.pending.forEach(e=>{Kx(e,Ux)})},l_=(e,t,n)=>{try{e(t,n)}catch(r){setTimeout(()=>{throw r},0)}},c_=Jx(yx(`${t_}/add`),{withTypes:()=>c_}),u_=yx(`${t_}/removeAll`),d_=Jx(yx(`${t_}/remove`),{withTypes:()=>d_}),h_=(...e)=>{console.error(`${t_}/error`,...e)},p_=(e={})=>{const t=new Map,n=new Map,{extra:r,onError:i=h_}=e;qx(i);const a=e=>(e=>(e.unsubscribe=()=>t.delete(e.id),t.set(e.id,e),t=>{e.unsubscribe(),t?.cancelActive&&s_(e)}))(o_(t,e)??a_(e));Jx(a,{withTypes:()=>a});const o=e=>{const n=o_(t,e);return n&&(n.unsubscribe(),e.cancelActive&&s_(n)),!!n};Jx(o,{withTypes:()=>o});const s=async(e,o,s,l)=>{const c=new AbortController,u=r_(a,c.signal),d=[];try{e.pending.add(c),(e=>{const t=n.get(e)??0;n.set(e,t+1)})(e),await Promise.resolve(e.effect(o,Jx({},s,{getOriginalState:l,condition:(e,t)=>u(e,t).then(Boolean),take:u,delay:Zx(c.signal),pause:Qx(c.signal),extra:r,signal:c.signal,fork:n_(c.signal,d),unsubscribe:e.unsubscribe,subscribe:()=>{t.set(e.id,e)},cancelActiveListeners:()=>{e.pending.forEach((e,t,n)=>{e!==c&&(Kx(e,Ux),n.delete(e))})},cancel:()=>{Kx(c,Ux),e.pending.delete(c)},throwIfCancelled:()=>{Xx(c.signal)}})))}catch(h){h instanceof Gx||l_(i,h,{raisedBy:"effect"})}finally{await Promise.all(d),Kx(c,Vx),(e=>{const t=n.get(e)??1;1===t?n.delete(e):n.set(e,t-1)})(e),e.pending.delete(c)}},l=((e,t)=>()=>{for(const e of t.keys())s_(e);e.clear()})(t,n);return{middleware:e=>n=>r=>{if(!fx(r))return n(r);if(c_.match(r))return a(r.payload);if(u_.match(r))return void l();if(d_.match(r))return o(r.payload);let c=e.getState();const u=()=>{if(c===e_)throw new Error(f_(23));return c};let d;try{if(d=n(r),t.size>0){const n=e.getState(),a=Array.from(t.values());for(const t of a){let a=!1;try{a=t.predicate(r,n,c)}catch(h){a=!1,l_(i,h,{raisedBy:"predicate"})}a&&s(t,r,e,u)}}}finally{c=e_}return d},startListening:a,stopListening:o,clearListeners:l}};Symbol.for("rtk-state-proxy-original");function f_(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}function m_(e,t){if(t){var n=Number.parseInt(t,10);if(!Ay(n))return null===e||void 0===e?void 0:e[n]}}var g_=Ox({name:"options",initialState:{chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},reducers:{createEventEmitter:e=>{null==e.eventEmitter&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),v_=g_.reducer,{createEventEmitter:A_}=g_.actions;n(7237);function y_(e){e()}var b_={notify(){},get:()=>[]};function x_(e,t){let n,r=b_,i=0,a=!1;function o(){c.onStateChange&&c.onStateChange()}function s(){i++,n||(n=t?t.addNestedSub(o):e.subscribe(o),r=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){y_(()=>{let t=e;for(;t;)t.callback(),t=t.next})},get(){const t=[];let n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let r=!0;const i=t={callback:n,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){r&&null!==e&&(r=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function l(){i--,n&&0===i&&(n(),n=void 0,r.clear(),r=b_)}const c={addNestedSub:function(e){s();const t=r.subscribe(e);let n=!1;return()=>{n||(n=!0,t(),l())}},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return a},trySubscribe:function(){a||(a=!0,s())},tryUnsubscribe:function(){a&&(a=!1,l())},getListeners:()=>r};return c}var __=(()=>!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement))(),w_=(()=>"undefined"!==typeof navigator&&"ReactNative"===navigator.product)(),S_=(()=>__||w_?r.useLayoutEffect:r.useEffect)();function T_(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function C_(e,t){if(T_(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(t,n[i])||!T_(e[n[i]],t[n[i]]))return!1;return!0}Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var M_=Symbol.for("react-redux-context"),E_="undefined"!==typeof globalThis?globalThis:{};function P_(){if(!r.createContext)return{};const e=E_[M_]??=new Map;let t=e.get(r.createContext);return t||(t=r.createContext(null),e.set(r.createContext,t)),t}var N_=P_();var k_=function(e){const{children:t,context:n,serverState:i,store:a}=e,o=r.useMemo(()=>{const e=x_(a);return{store:a,subscription:e,getServerState:i?()=>i:void 0}},[a,i]),s=r.useMemo(()=>a.getState(),[a]);S_(()=>{const{subscription:e}=o;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),s!==a.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}},[o,s]);const l=n||N_;return r.createElement(l.Provider,{value:o},t)};var R_=Symbol.for("immer-nothing"),L_=Symbol.for("immer-draftable"),O_=Symbol.for("immer-state");function j_(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var D_=Object.getPrototypeOf;function I_(e){return!!e&&!!e[O_]}function B_(e){return!!e&&(U_(e)||Array.isArray(e)||!!e[L_]||!!e.constructor?.[L_]||H_(e)||$_(e))}var F_=Object.prototype.constructor.toString(),z_=new WeakMap;function U_(e){if(!e||"object"!==typeof e)return!1;const t=Object.getPrototypeOf(e);if(null===t||t===Object.prototype)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(n===Object)return!0;if("function"!==typeof n)return!1;let r=z_.get(n);return void 0===r&&(r=Function.toString.call(n),z_.set(n,r)),r===F_}function V_(e,t,n=!0){if(0===G_(e)){(n?Reflect.ownKeys(e):Object.keys(e)).forEach(n=>{t(n,e[n],e)})}else e.forEach((n,r)=>t(r,n,e))}function G_(e){const t=e[O_];return t?t.type_:Array.isArray(e)?1:H_(e)?2:$_(e)?3:0}function q_(e,t){return 2===G_(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function W_(e,t,n){const r=G_(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function H_(e){return e instanceof Map}function $_(e){return e instanceof Set}function K_(e){return e.copy_||e.base_}function X_(e,t){if(H_(e))return new Map(e);if($_(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=U_(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[O_];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],a=t[i];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(D_(e),t)}{const t=D_(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function Y_(e,t=!1){return Z_(e)||I_(e)||!B_(e)||(G_(e)>1&&Object.defineProperties(e,{set:Q_,add:Q_,clear:Q_,delete:Q_}),Object.freeze(e),t&&Object.values(e).forEach(e=>Y_(e,!0))),e}var Q_={value:function(){j_(2)}};function Z_(e){return null===e||"object"!==typeof e||Object.isFrozen(e)}var J_,ew={};function tw(e){const t=ew[e];return t||j_(0),t}function nw(){return J_}function rw(e,t){t&&(tw("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function iw(e){aw(e),e.drafts_.forEach(sw),e.drafts_=null}function aw(e){e===J_&&(J_=e.parent_)}function ow(e){return J_={drafts_:[],parent_:J_,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function sw(e){const t=e[O_];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function lw(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[O_].modified_&&(iw(t),j_(4)),B_(e)&&(e=cw(t,e),t.parent_||dw(t,e)),t.patches_&&tw("Patches").generateReplacementPatches_(n[O_].base_,e,t.patches_,t.inversePatches_)):e=cw(t,n,[]),iw(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==R_?e:void 0}function cw(e,t,n){if(Z_(t))return t;const r=e.immer_.shouldUseStrictIteration(),i=t[O_];if(!i)return V_(t,(r,a)=>uw(e,i,t,r,a,n),r),t;if(i.scope_!==e)return t;if(!i.modified_)return dw(e,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const t=i.copy_;let a=t,o=!1;3===i.type_&&(a=new Set(t),t.clear(),o=!0),V_(a,(r,a)=>uw(e,i,t,r,a,n,o),r),dw(e,t,!1),n&&e.patches_&&tw("Patches").generatePatches_(i,n,e.patches_,e.inversePatches_)}return i.copy_}function uw(e,t,n,r,i,a,o){if(null==i)return;if("object"!==typeof i&&!o)return;const s=Z_(i);if(!s||o){if(I_(i)){const o=cw(e,i,a&&t&&3!==t.type_&&!q_(t.assigned_,r)?a.concat(r):void 0);if(W_(n,r,o),!I_(o))return;e.canAutoFreeze_=!1}else o&&n.add(i);if(B_(i)&&!s){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;if(t&&t.base_&&t.base_[r]===i&&s)return;cw(e,i),t&&t.scope_.parent_||"symbol"===typeof r||!(H_(n)?n.has(r):Object.prototype.propertyIsEnumerable.call(n,r))||dw(e,i)}}}function dw(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Y_(t,n)}var hw={get(e,t){if(t===O_)return e;const n=K_(e);if(!q_(n,t))return function(e,t,n){const r=mw(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!B_(r)?r:r===fw(e.base_,t)?(vw(e),e.copy_[t]=Aw(r,e)):r},has(e,t){return t in K_(e)},ownKeys(e){return Reflect.ownKeys(K_(e))},set(e,t,n){const r=mw(K_(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=fw(K_(e),t),i=r?.[O_];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}(n,r)&&(void 0!==n||q_(e.base_,t)))return!0;vw(e),gw(e)}return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return void 0!==fw(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,vw(e),gw(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=K_(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){j_(11)},getPrototypeOf(e){return D_(e.base_)},setPrototypeOf(){j_(12)}},pw={};function fw(e,t){const n=e[O_];return(n?K_(n):e)[t]}function mw(e,t){if(!(t in e))return;let n=D_(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=D_(n)}}function gw(e){e.modified_||(e.modified_=!0,e.parent_&&gw(e.parent_))}function vw(e){e.copy_||(e.copy_=X_(e.base_,e.scope_.immer_.useStrictShallowCopy_))}V_(hw,(e,t)=>{pw[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),pw.deleteProperty=function(e,t){return pw.set.call(this,e,t,void 0)},pw.set=function(e,t,n){return hw.set.call(this,e[0],t,n,e[0])};function Aw(e,t){const n=H_(e)?tw("MapSet").proxyMap_(e,t):$_(e)?tw("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:nw(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,a=hw;n&&(i=[r],a=pw);const{revoke:o,proxy:s}=Proxy.revocable(i,a);return r.draft_=s,r.revoke_=o,s}(e,t);return(t?t.scope_:nw()).drafts_.push(n),n}function yw(e){if(!B_(e)||Z_(e))return e;const t=e[O_];let n,r=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=X_(e,t.scope_.immer_.useStrictShallowCopy_),r=t.scope_.immer_.shouldUseStrictIteration()}else n=X_(e,!0);return V_(n,(e,t)=>{W_(n,e,yw(t))},r),t&&(t.finalized_=!1),n}var bw=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,n)=>{if("function"===typeof e&&"function"!==typeof t){const n=t;t=e;const r=this;return function(e=n,...i){return r.produce(e,e=>t.call(this,e,...i))}}let r;if("function"!==typeof t&&j_(6),void 0!==n&&"function"!==typeof n&&j_(7),B_(e)){const i=ow(this),a=Aw(e,void 0);let o=!0;try{r=t(a),o=!1}finally{o?iw(i):aw(i)}return rw(i,n),lw(r,i)}if(!e||"object"!==typeof e){if(r=t(e),void 0===r&&(r=e),r===R_&&(r=void 0),this.autoFreeze_&&Y_(r,!0),n){const t=[],i=[];tw("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}j_(1)},this.produceWithPatches=(e,t)=>{if("function"===typeof e)return(t,...n)=>this.produceWithPatches(t,t=>e(t,...n));let n,r;const i=this.produce(e,t,(e,t)=>{n=e,r=t});return[i,n,r]},"boolean"===typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"===typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),"boolean"===typeof e?.useStrictIteration&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){B_(e)||j_(8),I_(e)&&(e=function(e){I_(e)||j_(10);return yw(e)}(e));const t=ow(this),n=Aw(e,void 0);return n[O_].isManual_=!0,aw(t),n}finishDraft(e,t){const n=e&&e[O_];n&&n.isManual_||j_(9);const{scope_:r}=n;return rw(r,t),lw(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=tw("Patches").applyPatches_;return I_(e)?r(e,t):this.produce(e,e=>r(e,t))}};bw.produce;var xw={active:!1,index:null,dataKey:void 0,graphicalItemId:void 0,coordinate:void 0},_w=Ox({name:"tooltip",initialState:{itemInteraction:{click:xw,hover:xw},axisInteraction:{click:xw,hover:xw},keyboardInteraction:xw,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0,graphicalItemId:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},reducers:{addTooltipEntrySettings:{reducer(e,t){e.tooltipItemPayloads.push(t.payload)},prepare:Sx()},replaceTooltipEntrySettings:{reducer(e,t){var{prev:n,next:r}=t.payload,i=nx(e).tooltipItemPayloads.indexOf(n);i>-1&&(e.tooltipItemPayloads[i]=r)},prepare:Sx()},removeTooltipEntrySettings:{reducer(e,t){var n=nx(e).tooltipItemPayloads.indexOf(t.payload);n>-1&&e.tooltipItemPayloads.splice(n,1)},prepare:Sx()},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate,e.keyboardInteraction.dataKey=t.payload.activeDataKey}}}),{addTooltipEntrySettings:ww,replaceTooltipEntrySettings:Sw,removeTooltipEntrySettings:Tw,setTooltipSettingsState:Cw,setActiveMouseOverItemIndex:Mw,mouseLeaveItem:Ew,mouseLeaveChart:Pw,setActiveClickItemIndex:Nw,setMouseOverAxisIndex:kw,setMouseClickAxisIndex:Rw,setSyncInteraction:Lw,setKeyboardInteraction:Ow}=_w.actions,jw=_w.reducer,Dw=Ox({name:"chartData",initialState:{chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},reducers:{setChartData(e,t){if(e.chartData=t.payload,null==t.payload)return e.dataStartIndex=0,void(e.dataEndIndex=0);t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:n,endIndex:r}=t.payload;null!=n&&(e.dataStartIndex=n),null!=r&&(e.dataEndIndex=r)}}}),{setChartData:Iw,setDataStartEndIndexes:Bw,setComputedData:Fw}=Dw.actions,zw=Dw.reducer,Uw=Ox({name:"chartLayout",initialState:{layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){var n,r,i,a;e.margin.top=null!==(n=t.payload.top)&&void 0!==n?n:0,e.margin.right=null!==(r=t.payload.right)&&void 0!==r?r:0,e.margin.bottom=null!==(i=t.payload.bottom)&&void 0!==i?i:0,e.margin.left=null!==(a=t.payload.left)&&void 0!==a?a:0},setScale(e,t){e.scale=t.payload}}}),{setMargin:Vw,setLayout:Gw,setChartSize:qw,setScale:Ww}=Uw.actions,Hw=Uw.reducer;function $w(e,t="expected a function, instead received "+typeof e){if("function"!==typeof e)throw new TypeError(t)}var Kw=e=>Array.isArray(e)?e:[e];function Xw(e){const t=Array.isArray(e[0])?e[0]:e;return function(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(e=>"function"===typeof e)){const n=e.map(e=>"function"===typeof e?`function ${e.name||"unnamed"}()`:typeof e).join(", ");throw new TypeError(`${t}[${n}]`)}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}Symbol(),Object.getPrototypeOf({});var Yw="undefined"!==typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}};function Qw(){return{s:0,v:void 0,o:null,p:null}}function Zw(e,t={}){let n={s:0,v:void 0,o:null,p:null};const{resultEqualityCheck:r}=t;let i,a=0;function o(){let t=n;const{length:o}=arguments;for(let e=0,n=o;e<n;e++){const n=arguments[e];if("function"===typeof n||"object"===typeof n&&null!==n){let e=t.o;null===e&&(t.o=e=new WeakMap);const r=e.get(n);void 0===r?(t=Qw(),e.set(n,t)):t=r}else{let e=t.p;null===e&&(t.p=e=new Map);const r=e.get(n);void 0===r?(t=Qw(),e.set(n,t)):t=r}}const s=t;let l;if(1===t.s)l=t.v;else if(l=e.apply(null,arguments),a++,r){const e=i?.deref?.()??i;null!=e&&r(e,l)&&(l=e,0!==a&&a--);i="object"===typeof l&&null!==l||"function"===typeof l?new Yw(l):l}return s.s=1,s.v=l,l}return o.clearCache=()=>{n={s:0,v:void 0,o:null,p:null},o.resetResultsCount()},o.resultsCount=()=>a,o.resetResultsCount=()=>{a=0},o}function Jw(e,...t){const n="function"===typeof e?{memoize:e,memoizeOptions:t}:e,r=(...e)=>{let t,r=0,i=0,a={},o=e.pop();"object"===typeof o&&(a=o,o=e.pop()),$w(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);const s={...n,...a},{memoize:l,memoizeOptions:c=[],argsMemoize:u=Zw,argsMemoizeOptions:d=[],devModeChecks:h={}}=s,p=Kw(c),f=Kw(d),m=Xw(e),g=l(function(){return r++,o.apply(null,arguments)},...p);const v=u(function(){i++;const e=function(e,t){const n=[],{length:r}=e;for(let i=0;i<r;i++)n.push(e[i].apply(null,t));return n}(m,arguments);return t=g.apply(null,e),t},...f);return Object.assign(v,{resultFunc:o,memoizedResultFunc:g,dependencies:m,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>t,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:l,argsMemoize:u})};return Object.assign(r,{withTypes:()=>r}),r}var eS=Jw(Zw),tS=Object.assign((e,t=eS)=>{!function(e,t="expected an object, instead received "+typeof e){if("object"!==typeof e)throw new TypeError(t)}(e,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);const n=Object.keys(e),r=t(n.map(t=>e[t]),(...e)=>e.reduce((e,t,r)=>(e[n[r]]=t,e),{}));return r},{withTypes:()=>tS}),nS=n(8443),rS=(0,r.createContext)(null),iS=e=>e,aS=()=>{var e=(0,r.useContext)(rS);return e?e.store.dispatch:iS},oS=()=>{},sS=()=>oS,lS=(e,t)=>e===t;function cS(e){var t=(0,r.useContext)(rS);return(0,nS.useSyncExternalStoreWithSelector)(t?t.subscription.addNestedSub:sS,t?t.store.getState:oS,t?t.store.getState:oS,t?e:oS,lS)}var uS=n(3821),dS=n.n(uS),hS=e=>e.legend.settings,pS=eS([e=>e.legend.payload,hS],(e,t)=>{var{itemSorter:n}=t,r=e.flat(1);return n?dS()(r,n):r});function fS(e,t){if((i=e.length)>1)for(var n,r,i,a=1,o=e[t[0]],s=o.length;a<i;++a)for(r=o,o=e[t[a]],n=0;n<s;++n)o[n][1]+=o[n][0]=isNaN(r[n][1])?r[n][0]:r[n][1]}Array.prototype.slice;function mS(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function gS(e){return function(){return e}}function vS(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function AS(e,t){return e[t]}function yS(e){const t=[];return t.key=e,t}function bS(e,t,n){return Array.isArray(e)&&e&&t+n!==0?e.slice(t,n+1):e}function xS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xS(Object(n),!0).forEach(function(t){wS(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xS(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function wS(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SS(e,t,n){return Ey(e)||Ey(t)?n:xy(t)?gy()(e,t,n):"function"===typeof t?t(e):n}var TS=(e,t)=>"horizontal"===e&&"xAxis"===t||"vertical"===e&&"yAxis"===t||"centric"===e&&"angleAxis"===t||"radial"===e&&"radiusAxis"===t,CS=(e,t,n,r)=>{if(r)return e.map(e=>e.coordinate);var i,a,o=e.map(e=>(e.coordinate===t&&(i=!0),e.coordinate===n&&(a=!0),e.coordinate));return i||o.push(t),a||o.push(n),o},MS=(e,t,n)=>{if(!e)return null;var{duplicateDomain:r,type:i,range:a,scale:o,realScaleType:s,isCategorical:l,categoricalDomain:c,tickCount:u,ticks:d,niceTicks:h,axisType:p}=e;if(!o)return null;var f="scaleBand"===s&&o.bandwidth?o.bandwidth()/2:2,m=(t||n)&&"category"===i&&o.bandwidth?o.bandwidth()/f:0;if(m="angleAxis"===p&&a&&a.length>=2?2*vy(a[0]-a[1])*m:m,t&&(d||h)){var g=(d||h||[]).map((e,t)=>{var n=r?r.indexOf(e):e;return{coordinate:o(n)+m,value:e,offset:m,index:t}});return g.filter(e=>!Ay(e.coordinate))}return l&&c?c.map((e,t)=>({coordinate:o(e)+m,value:e,index:t,offset:m})):o.ticks&&!n&&null!=u?o.ticks(u).map((e,t)=>({coordinate:o(e)+m,value:e,offset:m,index:t})):o.domain().map((e,t)=>({coordinate:o(e)+m,value:r?r[e]:e,index:t,offset:m}))},ES=1e-4,PS={sign:e=>{var t=e.length;if(!(t<=0))for(var n=0,r=e[0].length;n<r;++n)for(var i=0,a=0,o=0;o<t;++o){var s=Ay(e[o][n][1])?e[o][n][0]:e[o][n][1];s>=0?(e[o][n][0]=i,e[o][n][1]=i+s,i=e[o][n][1]):(e[o][n][0]=a,e[o][n][1]=a+s,a=e[o][n][1])}},expand:function(e,t){if((r=e.length)>0){for(var n,r,i,a=0,o=e[0].length;a<o;++a){for(i=n=0;n<r;++n)i+=e[n][a][1]||0;if(i)for(n=0;n<r;++n)e[n][a][1]/=i}fS(e,t)}},none:fS,silhouette:function(e,t){if((n=e.length)>0){for(var n,r=0,i=e[t[0]],a=i.length;r<a;++r){for(var o=0,s=0;o<n;++o)s+=e[o][r][1]||0;i[r][1]+=i[r][0]=-s/2}fS(e,t)}},wiggle:function(e,t){if((i=e.length)>0&&(r=(n=e[t[0]]).length)>0){for(var n,r,i,a=0,o=1;o<r;++o){for(var s=0,l=0,c=0;s<i;++s){for(var u=e[t[s]],d=u[o][1]||0,h=(d-(u[o-1][1]||0))/2,p=0;p<s;++p){var f=e[t[p]];h+=(f[o][1]||0)-(f[o-1][1]||0)}l+=d,c+=h*d}n[o-1][1]+=n[o-1][0]=a,l&&(a-=c/l)}n[o-1][1]+=n[o-1][0]=a,fS(e,t)}},positive:e=>{var t=e.length;if(!(t<=0))for(var n=0,r=e[0].length;n<r;++n)for(var i=0,a=0;a<t;++a){var o=Ay(e[a][n][1])?e[a][n][0]:e[a][n][1];o>=0?(e[a][n][0]=i,e[a][n][1]=i+o,i=e[a][n][1]):(e[a][n][0]=0,e[a][n][1]=0)}}},NS=(e,t,n)=>{var r=PS[n],i=function(){var e=gS([]),t=vS,n=fS,r=AS;function i(i){var a,o,s=Array.from(e.apply(this,arguments),yS),l=s.length,c=-1;for(const e of i)for(a=0,++c;a<l;++a)(s[a][c]=[0,+r(e,s[a].key,c,i)]).data=e;for(a=0,o=mS(t(s));a<l;++a)s[o[a]].index=a;return n(s,o),s}return i.keys=function(t){return arguments.length?(e="function"===typeof t?t:gS(Array.from(t)),i):e},i.value=function(e){return arguments.length?(r="function"===typeof e?e:gS(+e),i):r},i.order=function(e){return arguments.length?(t=null==e?vS:"function"===typeof e?e:gS(Array.from(e)),i):t},i.offset=function(e){return arguments.length?(n=null==e?fS:e,i):n},i}().keys(t).value((e,t)=>Number(SS(e,t,0))).order(vS).offset(r);return i(e)};function kS(e){return null==e?void 0:String(e)}function RS(e){var{axis:t,ticks:n,bandSize:r,entry:i,index:a,dataKey:o}=e;if("category"===t.type){if(!t.allowDuplicatedCategory&&t.dataKey&&!Ey(i[t.dataKey])){var s=My(n,"value",i[t.dataKey]);if(s)return s.coordinate+r/2}return n[a]?n[a].coordinate+r/2:null}var l=SS(i,Ey(o)?t.dataKey:o);return Ey(l)?null:t.scale(l)}var LS=e=>{var{axis:t,ticks:n,offset:r,bandSize:i,entry:a,index:o}=e;if("category"===t.type)return n[o]?n[o].coordinate+r:null;var s=SS(a,t.dataKey,t.scale.domain()[o]);return Ey(s)?null:t.scale(s)-i/2+r},OS=(e,t,n)=>{var r;if(null!=e)return r=Object.keys(e).reduce((r,i)=>{var a=e[i],{stackedData:o}=a,s=o.reduce((e,r)=>{var i=(e=>{var t=e.flat(2).filter(by);return[Math.min(...t),Math.max(...t)]})(bS(r,t,n));return[Math.min(e[0],i[0]),Math.max(e[1],i[1])]},[1/0,-1/0]);return[Math.min(s[0],r[0]),Math.max(s[1],r[1])]},[1/0,-1/0]),[r[0]===1/0?0:r[0],r[1]===-1/0?0:r[1]]},jS=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,DS=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,IS=(e,t,n)=>{if(e&&e.scale&&e.scale.bandwidth){var r=e.scale.bandwidth();if(!n||r>0)return r}if(e&&t&&t.length>=2){for(var i=dS()(t,e=>e.coordinate),a=1/0,o=1,s=i.length;o<s;o++){var l=i[o],c=i[o-1];a=Math.min((l.coordinate||0)-(c.coordinate||0),a)}return a===1/0?0:a}return n?void 0:0};function BS(e){var{tooltipEntrySettings:t,dataKey:n,payload:r,value:i,name:a}=e;return _S(_S({},t),{},{dataKey:n,payload:r,value:i,name:a})}function FS(e,t){return e?String(e):"string"===typeof t?t:void 0}var zS=e=>e.layout.width,US=e=>e.layout.height,VS=e=>e.layout.scale,GS=e=>e.layout.margin,qS=eS(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),WS=eS(e=>e.cartesianAxis.yAxis,e=>Object.values(e)),HS="data-recharts-item-index",$S="data-recharts-item-data-key";function KS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function XS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KS(Object(n),!0).forEach(function(t){YS(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KS(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function YS(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var QS=eS([zS,US,GS,e=>e.brush.height,function(e){return WS(e).reduce((e,t)=>"left"!==t.orientation||t.mirror||t.hide?e:e+("number"===typeof t.width?t.width:60),0)},function(e){return WS(e).reduce((e,t)=>"right"!==t.orientation||t.mirror||t.hide?e:e+("number"===typeof t.width?t.width:60),0)},function(e){return qS(e).reduce((e,t)=>"top"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},function(e){return qS(e).reduce((e,t)=>"bottom"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},hS,e=>e.legend.size],(e,t,n,r,i,a,o,s,l,c)=>{var u={left:(n.left||0)+i,right:(n.right||0)+a},d=XS(XS({},{top:(n.top||0)+o,bottom:(n.bottom||0)+s}),u),h=d.bottom;d.bottom+=r,d=((e,t,n)=>{if(t&&n){var{width:r,height:i}=n,{align:a,verticalAlign:o,layout:s}=t;if(("vertical"===s||"horizontal"===s&&"middle"===o)&&"center"!==a&&by(e[a]))return _S(_S({},e),{},{[a]:e[a]+(r||0)});if(("horizontal"===s||"vertical"===s&&"center"===a)&&"middle"!==o&&by(e[o]))return _S(_S({},e),{},{[o]:e[o]+(i||0)})}return e})(d,l,c);var p=e-d.left-d.right,f=t-d.top-d.bottom;return XS(XS({brushBottom:h},d),{},{width:Math.max(p,0),height:Math.max(f,0)})}),ZS=eS(QS,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),JS=eS(zS,US,(e,t)=>({x:0,y:0,width:e,height:t})),eT=(0,r.createContext)(null),tT=()=>null!=(0,r.useContext)(eT),nT=e=>e.brush,rT=eS([nT,QS,GS],(e,t,n)=>({height:e.height,x:by(e.x)?e.x:t.left,y:by(e.y)?e.y:t.top+t.height+t.brushBottom-((null===n||void 0===n?void 0:n.bottom)||0),width:by(e.width)?e.width:t.width}));function iT(e){if(e)return{x:e.x,y:e.y,upperWidth:"upperWidth"in e?e.upperWidth:e.width,lowerWidth:"lowerWidth"in e?e.lowerWidth:e.width,width:e.width,height:e.height}}var aT=()=>{var e,t=tT(),n=cS(ZS),r=cS(rT),i=null===(e=cS(nT))||void 0===e?void 0:e.padding;return t&&r&&i?{width:r.width-i.left-i.right,height:r.height-i.top-i.bottom,x:i.left,y:i.top}:n},oT={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},sT=()=>{var e;return null!==(e=cS(QS))&&void 0!==e?e:oT},lT=()=>cS(zS),cT=()=>cS(US),uT=e=>e.layout.layoutType,dT=()=>cS(uT),hT=e=>{var t=aS(),n=tT(),{width:i,height:a}=e,o=$y(),s=i,l=a;return o&&(s=o.width>0?o.width:i,l=o.height>0?o.height:a),(0,r.useEffect)(()=>{!n&&zy(s)&&zy(l)&&t(qw({width:s,height:l}))},[t,n,s,l]),null},pT=n(9859),fT=n.n(pT);function mT(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function gT(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function vT(e,t){switch(arguments.length){case 0:break;case 1:"function"===typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"===typeof t?this.interpolator(t):this.range(t)}return this}class AT extends Map{constructor(e,t=_T){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(yT(this,e))}has(e){return super.has(yT(this,e))}set(e,t){return super.set(bT(this,e),t)}delete(e){return super.delete(xT(this,e))}}Set;function yT({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function bT({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function xT({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}function _T(e){return null!==e&&"object"===typeof e?e.valueOf():e}const wT=Symbol("implicit");function ST(){var e=new AT,t=[],n=[],r=wT;function i(i){let a=e.get(i);if(void 0===a){if(r!==wT)return r;e.set(i,a=t.push(i)-1)}return n[a%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new AT;for(const r of n)e.has(r)||e.set(r,t.push(r)-1);return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return ST(t,n).unknown(r)},gT.apply(i,arguments),i}function TT(){var e,t,n=ST().unknown(void 0),r=n.domain,i=n.range,a=0,o=1,s=!1,l=0,c=0,u=.5;function d(){var n=r().length,d=o<a,h=d?o:a,p=d?a:o;e=(p-h)/Math.max(1,n-l+2*c),s&&(e=Math.floor(e)),h+=(p-h-e*(n-l))*u,t=e*(1-l),s&&(h=Math.round(h),t=Math.round(t));var f=mT(n).map(function(t){return h+e*t});return i(d?f.reverse():f)}return delete n.unknown,n.domain=function(e){return arguments.length?(r(e),d()):r()},n.range=function(e){return arguments.length?([a,o]=e,a=+a,o=+o,d()):[a,o]},n.rangeRound=function(e){return[a,o]=e,a=+a,o=+o,s=!0,d()},n.bandwidth=function(){return t},n.step=function(){return e},n.round=function(e){return arguments.length?(s=!!e,d()):s},n.padding=function(e){return arguments.length?(l=Math.min(1,c=+e),d()):l},n.paddingInner=function(e){return arguments.length?(l=Math.min(1,e),d()):l},n.paddingOuter=function(e){return arguments.length?(c=+e,d()):c},n.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),d()):u},n.copy=function(){return TT(r(),[a,o]).round(s).paddingInner(l).paddingOuter(c).align(u)},gT.apply(d(),arguments)}function CT(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return CT(t())},e}function MT(){return CT(TT.apply(null,arguments).paddingInner(1))}const ET=Math.sqrt(50),PT=Math.sqrt(10),NT=Math.sqrt(2);function kT(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=ET?10:a>=PT?5:a>=NT?2:1;let s,l,c;return i<0?(c=Math.pow(10,-i)/o,s=Math.round(e*c),l=Math.round(t*c),s/c<e&&++s,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*o,s=Math.round(e/c),l=Math.round(t/c),s*c<e&&++s,l*c>t&&--l),l<s&&.5<=n&&n<2?kT(e,t,2*n):[s,l,c]}function RT(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const r=t<e,[i,a,o]=r?kT(t,e,n):kT(e,t,n);if(!(a>=i))return[];const s=a-i+1,l=new Array(s);if(r)if(o<0)for(let c=0;c<s;++c)l[c]=(a-c)/-o;else for(let c=0;c<s;++c)l[c]=(a-c)*o;else if(o<0)for(let c=0;c<s;++c)l[c]=(i+c)/-o;else for(let c=0;c<s;++c)l[c]=(i+c)*o;return l}function LT(e,t,n){return kT(e=+e,t=+t,n=+n)[2]}function OT(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?LT(t,e,n):LT(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function jT(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function DT(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function IT(e){let t,n,r;function i(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=jT,n=(t,n)=>jT(e(t),n),r=(t,n)=>e(t)-n):(t=e===jT||e===DT?e:BT,n=e,r=e),{left:i,center:function(e,t,n=0,a=e.length){const o=i(e,t,n,a-1);return o>n&&r(e[o-1],t)>-r(e[o],t)?o-1:o},right:function(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<=0?i=t+1:a=t}while(i<a)}return i}}}function BT(){return 0}function FT(e){return null===e?NaN:+e}const zT=IT(jT),UT=zT.right;zT.left,IT(FT).center;var VT=UT;function GT(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function qT(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function WT(){}var HT=.7,$T=1/HT,KT="\\s*([+-]?\\d+)\\s*",XT="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",YT="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",QT=/^#([0-9a-f]{3,8})$/,ZT=new RegExp(`^rgb\\(${KT},${KT},${KT}\\)$`),JT=new RegExp(`^rgb\\(${YT},${YT},${YT}\\)$`),eC=new RegExp(`^rgba\\(${KT},${KT},${KT},${XT}\\)$`),tC=new RegExp(`^rgba\\(${YT},${YT},${YT},${XT}\\)$`),nC=new RegExp(`^hsl\\(${XT},${YT},${YT}\\)$`),rC=new RegExp(`^hsla\\(${XT},${YT},${YT},${XT}\\)$`),iC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function aC(){return this.rgb().formatHex()}function oC(){return this.rgb().formatRgb()}function sC(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=QT.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?lC(t):3===n?new dC(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?cC(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?cC(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ZT.exec(e))?new dC(t[1],t[2],t[3],1):(t=JT.exec(e))?new dC(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=eC.exec(e))?cC(t[1],t[2],t[3],t[4]):(t=tC.exec(e))?cC(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=nC.exec(e))?vC(t[1],t[2]/100,t[3]/100,1):(t=rC.exec(e))?vC(t[1],t[2]/100,t[3]/100,t[4]):iC.hasOwnProperty(e)?lC(iC[e]):"transparent"===e?new dC(NaN,NaN,NaN,0):null}function lC(e){return new dC(e>>16&255,e>>8&255,255&e,1)}function cC(e,t,n,r){return r<=0&&(e=t=n=NaN),new dC(e,t,n,r)}function uC(e,t,n,r){return 1===arguments.length?function(e){return e instanceof WT||(e=sC(e)),e?new dC((e=e.rgb()).r,e.g,e.b,e.opacity):new dC}(e):new dC(e,t,n,null==r?1:r)}function dC(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function hC(){return`#${gC(this.r)}${gC(this.g)}${gC(this.b)}`}function pC(){const e=fC(this.opacity);return`${1===e?"rgb(":"rgba("}${mC(this.r)}, ${mC(this.g)}, ${mC(this.b)}${1===e?")":`, ${e})`}`}function fC(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function mC(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function gC(e){return((e=mC(e))<16?"0":"")+e.toString(16)}function vC(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new yC(e,t,n,r)}function AC(e){if(e instanceof yC)return new yC(e.h,e.s,e.l,e.opacity);if(e instanceof WT||(e=sC(e)),!e)return new yC;if(e instanceof yC)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new yC(o,s,l,e.opacity)}function yC(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function bC(e){return(e=(e||0)%360)<0?e+360:e}function xC(e){return Math.max(0,Math.min(1,e||0))}function _C(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function wC(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}GT(WT,sC,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:aC,formatHex:aC,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return AC(this).formatHsl()},formatRgb:oC,toString:oC}),GT(dC,uC,qT(WT,{brighter(e){return e=null==e?$T:Math.pow($T,e),new dC(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?HT:Math.pow(HT,e),new dC(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new dC(mC(this.r),mC(this.g),mC(this.b),fC(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hC,formatHex:hC,formatHex8:function(){return`#${gC(this.r)}${gC(this.g)}${gC(this.b)}${gC(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:pC,toString:pC})),GT(yC,function(e,t,n,r){return 1===arguments.length?AC(e):new yC(e,t,n,null==r?1:r)},qT(WT,{brighter(e){return e=null==e?$T:Math.pow($T,e),new yC(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?HT:Math.pow(HT,e),new yC(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new dC(_C(e>=240?e-240:e+120,i,r),_C(e,i,r),_C(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new yC(bC(this.h),xC(this.s),xC(this.l),fC(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=fC(this.opacity);return`${1===e?"hsl(":"hsla("}${bC(this.h)}, ${100*xC(this.s)}%, ${100*xC(this.l)}%${1===e?")":`, ${e})`}`}}));var SC=e=>()=>e;function TC(e,t){return function(n){return e+n*t}}function CC(e){return 1===(e=+e)?MC:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):SC(isNaN(t)?n:t)}}function MC(e,t){var n=t-e;return n?TC(e,n):SC(isNaN(e)?t:e)}var EC=function e(t){var n=CC(t);function r(e,t){var r=n((e=uC(e)).r,(t=uC(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=MC(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function PC(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=uC(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}PC(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return wC((n-r/t)*t,o,i,a,s)}}),PC(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return wC((n-r/t)*t,i,a,o,s)}});function NC(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function kC(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function RC(e,t){return(kC(t)?NC:LC)(e,t)}function LC(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=zC(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function OC(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function jC(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function DC(e,t){var n,r={},i={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?r[n]=zC(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var IC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BC=new RegExp(IC.source,"g");function FC(e,t){var n,r,i,a=IC.lastIndex=BC.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=IC.exec(e))&&(r=BC.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:jC(n,r)})),a=BC.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function zC(e,t){var n,r=typeof t;return null==t||"boolean"===r?SC(t):("number"===r?jC:"string"===r?(n=sC(t))?(t=n,EC):FC:t instanceof sC?EC:t instanceof Date?OC:kC(t)?NC:Array.isArray(t)?LC:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?DC:jC)(e,t)}function UC(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function VC(e){return+e}var GC=[0,1];function qC(e){return e}function WC(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function HC(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=WC(i,r),a=n(o,a)):(r=WC(r,i),a=n(a,o)),function(e){return a(r(e))}}function $C(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=WC(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=VT(e,t,1,r)-1;return a[n](i[n](t))}}function KC(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function XC(){var e,t,n,r,i,a,o=GC,s=GC,l=zC,c=qC;function u(){var e=Math.min(o.length,s.length);return c!==qC&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?$C:HC,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(c(t)))}return d.invert=function(n){return c(t((a||(a=r(s,o.map(e),jC)))(n)))},d.domain=function(e){return arguments.length?(o=Array.from(e,VC),u()):o.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),u()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),l=UC,u()},d.clamp=function(e){return arguments.length?(c=!!e||qC,u()):c!==qC},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,u()}}function YC(){return XC()(qC,qC)}var QC,ZC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function JC(e){if(!(t=ZC.exec(e)))throw new Error("invalid format: "+e);var t;return new eM({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function eM(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function tM(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function nM(e){return(e=tM(Math.abs(e)))?e[1]:NaN}function rM(e,t){var n=tM(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}JC.prototype=eM.prototype,eM.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var iM={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>rM(100*e,t),r:rM,s:function(e,t){var n=tM(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(QC=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+tM(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function aM(e){return e}var oM,sM,lM,cM=Array.prototype.map,uM=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function dM(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?aM:(t=cM.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?aM:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(cM.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"\u2212":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=JC(e)).fill,n=e.align,d=e.sign,h=e.symbol,p=e.zero,f=e.width,m=e.comma,g=e.precision,v=e.trim,A=e.type;"n"===A?(m=!0,A="g"):iM[A]||(void 0===g&&(g=12),v=!0,A="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var y="$"===h?i:"#"===h&&/[boxX]/.test(A)?"0"+A.toLowerCase():"",b="$"===h?a:/[%p]/.test(A)?l:"",x=iM[A],_=/[defgprs%]/.test(A);function w(e){var i,a,l,h=y,w=b;if("c"===A)w=x(e)+w,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:x(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0===+e&&"+"!==d&&(S=!1),h=(S?"("===d?d:c:"-"===d||"("===d?"":d)+h,w=("s"===A?uM[8+QC/3]:"")+w+(S&&"("===d?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){w=(46===l?o+e.slice(i+1):e.slice(i))+w,e=e.slice(0,i);break}}m&&!p&&(e=r(e,1/0));var T=h.length+e.length+w.length,C=T<f?new Array(f-T+1).join(t):"";switch(m&&p&&(e=r(C+e,C.length?f-w.length:1/0),C=""),n){case"<":e=h+e+w+C;break;case"=":e=h+C+e+w;break;case"^":e=C.slice(0,T=C.length>>1)+h+e+w+C.slice(T);break;default:e=C+h+e+w}return s(e)}return g=void 0===g?6:/[gprs]/.test(A)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),w.toString=function(){return e+""},w}return{format:d,formatPrefix:function(e,t){var n=d(((e=JC(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(nM(t)/3))),i=Math.pow(10,-r),a=uM[8+r/3];return function(e){return n(i*e)+a}}}}function hM(e,t,n,r){var i,a=OT(e,t,n);switch((r=JC(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(nM(t)/3)))-nM(Math.abs(e)))}(a,o))||(r.precision=i),lM(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,nM(t)-nM(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-nM(Math.abs(e)))}(a))||(r.precision=i-2*("%"===r.type))}return sM(r)}function pM(e){var t=e.domain;return e.ticks=function(e){var n=t();return RT(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return hM(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],c=a[s],u=10;for(c<l&&(i=l,l=c,c=i,i=o,o=s,s=i);u-- >0;){if((i=LT(l,c,n))===r)return a[o]=l,a[s]=c,t(a);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function fM(){var e=YC();return e.copy=function(){return KC(e,fM())},gT.apply(e,arguments),pM(e)}function mM(e){var t;function n(e){return null==e||isNaN(e=+e)?t:e}return n.invert=n,n.domain=n.range=function(t){return arguments.length?(e=Array.from(t,VC),n):e.slice()},n.unknown=function(e){return arguments.length?(t=e,n):t},n.copy=function(){return mM(e).unknown(t)},e=arguments.length?Array.from(e,VC):[0,1],pM(n)}function gM(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function vM(e){return Math.log(e)}function AM(e){return Math.exp(e)}function yM(e){return-Math.log(-e)}function bM(e){return-Math.exp(-e)}function xM(e){return isFinite(e)?+("1e"+e):e<0?0:e}function _M(e){return(t,n)=>-e(-t,n)}function wM(e){const t=e(vM,AM),n=t.domain;let r,i,a=10;function o(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?xM:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),n()[0]<0?(r=_M(r),i=_M(i),e(yM,bM)):e(vM,AM),t}return t.base=function(e){return arguments.length?(a=+e,o()):a},t.domain=function(e){return arguments.length?(n(e),o()):n()},t.ticks=e=>{const t=n();let o=t[0],s=t[t.length-1];const l=s<o;l&&([o,s]=[s,o]);let c,u,d=r(o),h=r(s);const p=null==e?10:+e;let f=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),o>0){for(;d<=h;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<o)){if(u>s)break;f.push(u)}}else for(;d<=h;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<o)){if(u>s)break;f.push(u)}2*f.length<p&&(f=RT(o,s,p))}else f=RT(d,h,Math.min(h-d,p)).map(i);return l?f.reverse():f},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===a?"s":","),"function"!==typeof n&&(a%1||null!=(n=JC(n)).precision||(n.trim=!0),n=sM(n)),e===1/0)return n;const o=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(r(e)));return t*a<a-.5&&(t*=a),t<=o?n(e):""}},t.nice=()=>n(gM(n(),{floor:e=>i(Math.floor(r(e))),ceil:e=>i(Math.ceil(r(e)))})),t}function SM(){const e=wM(XC()).domain([1,10]);return e.copy=()=>KC(e,SM()).base(e.base()),gT.apply(e,arguments),e}function TM(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function CM(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function MM(e){var t=1,n=e(TM(t),CM(t));return n.constant=function(n){return arguments.length?e(TM(t=+n),CM(t)):t},pM(n)}function EM(){var e=MM(XC());return e.copy=function(){return KC(e,EM()).constant(e.constant())},gT.apply(e,arguments)}function PM(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function NM(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function kM(e){return e<0?-e*e:e*e}function RM(e){var t=e(qC,qC),n=1;return t.exponent=function(t){return arguments.length?1===(n=+t)?e(qC,qC):.5===n?e(NM,kM):e(PM(n),PM(1/n)):n},pM(t)}function LM(){var e=RM(XC());return e.copy=function(){return KC(e,LM()).exponent(e.exponent())},gT.apply(e,arguments),e}function OM(){return LM.apply(null,arguments).exponent(.5)}function jM(e){return Math.sign(e)*e*e}function DM(){var e,t=YC(),n=[0,1],r=!1;function i(n){var i=function(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}(t(n));return isNaN(i)?e:r?Math.round(i):i}return i.invert=function(e){return t.invert(jM(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain()},i.range=function(e){return arguments.length?(t.range((n=Array.from(e,VC)).map(jM)),i):n.slice()},i.rangeRound=function(e){return i.range(e).round(!0)},i.round=function(e){return arguments.length?(r=!!e,i):r},i.clamp=function(e){return arguments.length?(t.clamp(e),i):t.clamp()},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return DM(t.domain(),n).round(r).clamp(t.clamp()).unknown(e)},gT.apply(i,arguments),pM(i)}function IM(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function BM(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function FM(e=jT){if(e===jT)return zM;if("function"!==typeof e)throw new TypeError("compare is not a function");return(t,n)=>{const r=e(t,n);return r||0===r?r:(0===e(n,n))-(0===e(t,t))}}function zM(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}function UM(e,t,n=0,r=1/0,i){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(e.length-1,r)),!(n<=t&&t<=r))return e;for(i=void 0===i?zM:FM(i);r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);UM(e,t,Math.max(n,Math.floor(t-o*l/a+c)),Math.min(r,Math.floor(t+(a-o)*l/a+c)),i)}const a=e[t];let o=n,s=r;for(VM(e,n,t),i(e[r],a)>0&&VM(e,n,r);o<s;){for(VM(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}0===i(e[n],a)?VM(e,n,s):(++s,VM(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function VM(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function GM(e,t,n){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n)),(r=e.length)&&!isNaN(t=+t)){if(t<=0||r<2)return BM(e);if(t>=1)return IM(e);var r,i=(r-1)*t,a=Math.floor(i),o=IM(UM(e,a).subarray(0,a+1));return o+(BM(e.subarray(a+1))-o)*(i-a)}}function qM(e,t,n=FT){if((r=e.length)&&!isNaN(t=+t)){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function WM(){var e,t=[],n=[],r=[];function i(){var e=0,i=Math.max(1,n.length);for(r=new Array(i-1);++e<i;)r[e-1]=qM(t,e/i);return a}function a(t){return null==t||isNaN(t=+t)?e:n[VT(r,t)]}return a.invertExtent=function(e){var i=n.indexOf(e);return i<0?[NaN,NaN]:[i>0?r[i-1]:t[0],i<r.length?r[i]:t[t.length-1]]},a.domain=function(e){if(!arguments.length)return t.slice();t=[];for(let n of e)null==n||isNaN(n=+n)||t.push(n);return t.sort(jT),i()},a.range=function(e){return arguments.length?(n=Array.from(e),i()):n.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return r.slice()},a.copy=function(){return WM().domain(t).range(n).unknown(e)},gT.apply(a,arguments)}function HM(){var e,t=0,n=1,r=1,i=[.5],a=[0,1];function o(t){return null!=t&&t<=t?a[VT(i,t,0,r)]:e}function s(){var e=-1;for(i=new Array(r);++e<r;)i[e]=((e+1)*n-(e-r)*t)/(r+1);return o}return o.domain=function(e){return arguments.length?([t,n]=e,t=+t,n=+n,s()):[t,n]},o.range=function(e){return arguments.length?(r=(a=Array.from(e)).length-1,s()):a.slice()},o.invertExtent=function(e){var o=a.indexOf(e);return o<0?[NaN,NaN]:o<1?[t,i[0]]:o>=r?[i[r-1],n]:[i[o-1],i[o]]},o.unknown=function(t){return arguments.length?(e=t,o):o},o.thresholds=function(){return i.slice()},o.copy=function(){return HM().domain([t,n]).range(a).unknown(e)},gT.apply(pM(o),arguments)}function $M(){var e,t=[.5],n=[0,1],r=1;function i(i){return null!=i&&i<=i?n[VT(t,i,0,r)]:e}return i.domain=function(e){return arguments.length?(t=Array.from(e),r=Math.min(t.length,n.length-1),i):t.slice()},i.range=function(e){return arguments.length?(n=Array.from(e),r=Math.min(t.length,n.length-1),i):n.slice()},i.invertExtent=function(e){var r=n.indexOf(e);return[t[r-1],t[r]]},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return $M().domain(t).range(n).unknown(e)},gT.apply(i,arguments)}oM=dM({thousands:",",grouping:[3],currency:["$",""]}),sM=oM.format,lM=oM.formatPrefix;const KM=1e3,XM=6e4,YM=36e5,QM=864e5,ZM=6048e5,JM=2592e6,eE=31536e6,tE=new Date,nE=new Date;function rE(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=t=>(e(t=new Date(+t)),t),i.ceil=n=>(e(n=new Date(n-1)),t(n,1),e(n),n),i.round=e=>{const t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=(e,n)=>(t(e=new Date(+e),null==n?1:Math.floor(n)),e),i.range=(n,r,a)=>{const o=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r)||!(a>0))return o;let s;do{o.push(s=new Date(+n)),t(n,a),e(n)}while(s<n&&n<r);return o},i.filter=n=>rE(t=>{if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},(e,r)=>{if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}),n&&(i.count=(t,r)=>(tE.setTime(+t),nE.setTime(+r),e(tE),e(nE),Math.floor(n(tE,nE))),i.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?t=>r(t)%e===0:t=>i.count(0,t)%e===0):i:null)),i}const iE=rE(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);iE.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?rE(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):iE:null);iE.range;const aE=rE(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*KM)},(e,t)=>(t-e)/KM,e=>e.getUTCSeconds()),oE=(aE.range,rE(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*KM)},(e,t)=>{e.setTime(+e+t*XM)},(e,t)=>(t-e)/XM,e=>e.getMinutes())),sE=(oE.range,rE(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*XM)},(e,t)=>(t-e)/XM,e=>e.getUTCMinutes())),lE=(sE.range,rE(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*KM-e.getMinutes()*XM)},(e,t)=>{e.setTime(+e+t*YM)},(e,t)=>(t-e)/YM,e=>e.getHours())),cE=(lE.range,rE(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*YM)},(e,t)=>(t-e)/YM,e=>e.getUTCHours())),uE=(cE.range,rE(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*XM)/QM,e=>e.getDate()-1)),dE=(uE.range,rE(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/QM,e=>e.getUTCDate()-1)),hE=(dE.range,rE(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/QM,e=>Math.floor(e/QM)));hE.range;function pE(e){return rE(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*XM)/ZM)}const fE=pE(0),mE=pE(1),gE=pE(2),vE=pE(3),AE=pE(4),yE=pE(5),bE=pE(6);fE.range,mE.range,gE.range,vE.range,AE.range,yE.range,bE.range;function xE(e){return rE(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/ZM)}const _E=xE(0),wE=xE(1),SE=xE(2),TE=xE(3),CE=xE(4),ME=xE(5),EE=xE(6),PE=(_E.range,wE.range,SE.range,TE.range,CE.range,ME.range,EE.range,rE(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth())),NE=(PE.range,rE(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth())),kE=(NE.range,rE(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear()));kE.every=e=>isFinite(e=Math.floor(e))&&e>0?rE(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null;kE.range;const RE=rE(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());RE.every=e=>isFinite(e=Math.floor(e))&&e>0?rE(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null;RE.range;function LE(e,t,n,r,i,a){const o=[[aE,1,KM],[aE,5,5e3],[aE,15,15e3],[aE,30,3e4],[a,1,XM],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,YM],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,QM],[r,2,1728e5],[n,1,ZM],[t,1,JM],[t,3,7776e6],[e,1,eE]];function s(t,n,r){const i=Math.abs(n-t)/r,a=IT(([,,e])=>e).right(o,i);if(a===o.length)return e.every(OT(t/eE,n/eE,r));if(0===a)return iE.every(Math.max(OT(t,n,r),1));const[s,l]=o[i/o[a-1][2]<o[a][2]/i?a-1:a];return s.every(l)}return[function(e,t,n){const r=t<e;r&&([e,t]=[t,e]);const i=n&&"function"===typeof n.range?n:s(e,t,n),a=i?i.range(e,+t+1):[];return r?a.reverse():a},s]}const[OE,jE]=LE(RE,NE,_E,hE,cE,sE),[DE,IE]=LE(kE,PE,fE,uE,lE,oE);function BE(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function FE(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function zE(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var UE,VE,GE,qE={"-":"",_:" ",0:"0"},WE=/^\s*\d+/,HE=/^%/,$E=/[\\^$*+?|[\]().{}]/g;function KE(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function XE(e){return e.replace($E,"\\$&")}function YE(e){return new RegExp("^(?:"+e.map(XE).join("|")+")","i")}function QE(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function ZE(e,t,n){var r=WE.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function JE(e,t,n){var r=WE.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function eP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function tP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function nP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function rP(e,t,n){var r=WE.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function iP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function aP(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function oP(e,t,n){var r=WE.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function sP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function lP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function cP(e,t,n){var r=WE.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function uP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function dP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function hP(e,t,n){var r=WE.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function pP(e,t,n){var r=WE.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function fP(e,t,n){var r=WE.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function mP(e,t,n){var r=HE.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function gP(e,t,n){var r=WE.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function vP(e,t,n){var r=WE.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function AP(e,t){return KE(e.getDate(),t,2)}function yP(e,t){return KE(e.getHours(),t,2)}function bP(e,t){return KE(e.getHours()%12||12,t,2)}function xP(e,t){return KE(1+uE.count(kE(e),e),t,3)}function _P(e,t){return KE(e.getMilliseconds(),t,3)}function wP(e,t){return _P(e,t)+"000"}function SP(e,t){return KE(e.getMonth()+1,t,2)}function TP(e,t){return KE(e.getMinutes(),t,2)}function CP(e,t){return KE(e.getSeconds(),t,2)}function MP(e){var t=e.getDay();return 0===t?7:t}function EP(e,t){return KE(fE.count(kE(e)-1,e),t,2)}function PP(e){var t=e.getDay();return t>=4||0===t?AE(e):AE.ceil(e)}function NP(e,t){return e=PP(e),KE(AE.count(kE(e),e)+(4===kE(e).getDay()),t,2)}function kP(e){return e.getDay()}function RP(e,t){return KE(mE.count(kE(e)-1,e),t,2)}function LP(e,t){return KE(e.getFullYear()%100,t,2)}function OP(e,t){return KE((e=PP(e)).getFullYear()%100,t,2)}function jP(e,t){return KE(e.getFullYear()%1e4,t,4)}function DP(e,t){var n=e.getDay();return KE((e=n>=4||0===n?AE(e):AE.ceil(e)).getFullYear()%1e4,t,4)}function IP(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+KE(t/60|0,"0",2)+KE(t%60,"0",2)}function BP(e,t){return KE(e.getUTCDate(),t,2)}function FP(e,t){return KE(e.getUTCHours(),t,2)}function zP(e,t){return KE(e.getUTCHours()%12||12,t,2)}function UP(e,t){return KE(1+dE.count(RE(e),e),t,3)}function VP(e,t){return KE(e.getUTCMilliseconds(),t,3)}function GP(e,t){return VP(e,t)+"000"}function qP(e,t){return KE(e.getUTCMonth()+1,t,2)}function WP(e,t){return KE(e.getUTCMinutes(),t,2)}function HP(e,t){return KE(e.getUTCSeconds(),t,2)}function $P(e){var t=e.getUTCDay();return 0===t?7:t}function KP(e,t){return KE(_E.count(RE(e)-1,e),t,2)}function XP(e){var t=e.getUTCDay();return t>=4||0===t?CE(e):CE.ceil(e)}function YP(e,t){return e=XP(e),KE(CE.count(RE(e),e)+(4===RE(e).getUTCDay()),t,2)}function QP(e){return e.getUTCDay()}function ZP(e,t){return KE(wE.count(RE(e)-1,e),t,2)}function JP(e,t){return KE(e.getUTCFullYear()%100,t,2)}function eN(e,t){return KE((e=XP(e)).getUTCFullYear()%100,t,2)}function tN(e,t){return KE(e.getUTCFullYear()%1e4,t,4)}function nN(e,t){var n=e.getUTCDay();return KE((e=n>=4||0===n?CE(e):CE.ceil(e)).getUTCFullYear()%1e4,t,4)}function rN(){return"+0000"}function iN(){return"%"}function aN(e){return+e}function oN(e){return Math.floor(+e/1e3)}function sN(e){return new Date(e)}function lN(e){return e instanceof Date?+e:+new Date(+e)}function cN(e,t,n,r,i,a,o,s,l,c){var u=YC(),d=u.invert,h=u.domain,p=c(".%L"),f=c(":%S"),m=c("%I:%M"),g=c("%I %p"),v=c("%a %d"),A=c("%b %d"),y=c("%B"),b=c("%Y");function x(e){return(l(e)<e?p:s(e)<e?f:o(e)<e?m:a(e)<e?g:r(e)<e?i(e)<e?v:A:n(e)<e?y:b)(e)}return u.invert=function(e){return new Date(d(e))},u.domain=function(e){return arguments.length?h(Array.from(e,lN)):h().map(sN)},u.ticks=function(t){var n=h();return e(n[0],n[n.length-1],null==t?10:t)},u.tickFormat=function(e,t){return null==t?x:c(t)},u.nice=function(e){var n=h();return e&&"function"===typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?h(gM(n,e)):u},u.copy=function(){return KC(u,cN(e,t,n,r,i,a,o,s,l,c))},u}function uN(){return gT.apply(cN(DE,IE,kE,PE,fE,uE,lE,oE,aE,VE).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function dN(){return gT.apply(cN(OE,jE,RE,NE,_E,dE,cE,sE,aE,GE).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function hN(){var e,t,n,r,i,a=0,o=1,s=qC,l=!1;function c(t){return null==t||isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function u(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),c):[s(0),s(1)]}}return c.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),c):[a,o]},c.clamp=function(e){return arguments.length?(l=!!e,c):l},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.range=u(zC),c.rangeRound=u(UC),c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),c}}function pN(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function fN(){var e=pM(hN()(qC));return e.copy=function(){return pN(e,fN())},vT.apply(e,arguments)}function mN(){var e=wM(hN()).domain([1,10]);return e.copy=function(){return pN(e,mN()).base(e.base())},vT.apply(e,arguments)}function gN(){var e=MM(hN());return e.copy=function(){return pN(e,gN()).constant(e.constant())},vT.apply(e,arguments)}function vN(){var e=RM(hN());return e.copy=function(){return pN(e,vN()).exponent(e.exponent())},vT.apply(e,arguments)}function AN(){return vN.apply(null,arguments).exponent(.5)}function yN(){var e=[],t=qC;function n(n){if(null!=n&&!isNaN(n=+n))return t((VT(e,n,1)-1)/(e.length-1))}return n.domain=function(t){if(!arguments.length)return e.slice();e=[];for(let n of t)null==n||isNaN(n=+n)||e.push(n);return e.sort(jT),n},n.interpolator=function(e){return arguments.length?(t=e,n):t},n.range=function(){return e.map((n,r)=>t(r/(e.length-1)))},n.quantiles=function(t){return Array.from({length:t+1},(n,r)=>GM(e,r/t))},n.copy=function(){return yN(t).domain(e)},vT.apply(n,arguments)}function bN(){var e,t,n,r,i,a,o,s=0,l=.5,c=1,u=1,d=qC,h=!1;function p(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(u*e<u*t?r:i),d(h?Math.max(0,Math.min(1,e)):e))}function f(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,d=function(e,t){void 0===t&&(t=e,e=zC);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}(e,[n,r,i]),p):[d(0),d(.5),d(1)]}}return p.domain=function(o){return arguments.length?([s,l,c]=o,e=a(s=+s),t=a(l=+l),n=a(c=+c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),u=t<e?-1:1,p):[s,l,c]},p.clamp=function(e){return arguments.length?(h=!!e,p):h},p.interpolator=function(e){return arguments.length?(d=e,p):d},p.range=f(zC),p.rangeRound=f(UC),p.unknown=function(e){return arguments.length?(o=e,p):o},function(o){return a=o,e=o(s),t=o(l),n=o(c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),u=t<e?-1:1,p}}function xN(){var e=pM(bN()(qC));return e.copy=function(){return pN(e,xN())},vT.apply(e,arguments)}function _N(){var e=wM(bN()).domain([.1,1,10]);return e.copy=function(){return pN(e,_N()).base(e.base())},vT.apply(e,arguments)}function wN(){var e=MM(bN());return e.copy=function(){return pN(e,wN()).constant(e.constant())},vT.apply(e,arguments)}function SN(){var e=RM(bN());return e.copy=function(){return pN(e,SN()).exponent(e.exponent())},vT.apply(e,arguments)}function TN(){return SN.apply(null,arguments).exponent(.5)}!function(e){UE=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,c=YE(i),u=QE(i),d=YE(a),h=QE(a),p=YE(o),f=QE(o),m=YE(s),g=QE(s),v=YE(l),A=QE(l),y={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:AP,e:AP,f:wP,g:OP,G:DP,H:yP,I:bP,j:xP,L:_P,m:SP,M:TP,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:aN,s:oN,S:CP,u:MP,U:EP,V:NP,w:kP,W:RP,x:null,X:null,y:LP,Y:jP,Z:IP,"%":iN},b={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:BP,e:BP,f:GP,g:eN,G:nN,H:FP,I:zP,j:UP,L:VP,m:qP,M:WP,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:aN,s:oN,S:HP,u:$P,U:KP,V:YP,w:QP,W:ZP,x:null,X:null,y:JP,Y:tN,Z:rN,"%":iN},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=f.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=A.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return S(e,t,n,r)},d:lP,e:lP,f:fP,g:iP,G:rP,H:uP,I:uP,j:cP,L:pP,m:sP,M:dP,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=u.get(r[0].toLowerCase()),n+r[0].length):-1},q:oP,Q:gP,s:vP,S:hP,u:JE,U:eP,V:tP,w:ZE,W:nP,x:function(e,t,r){return S(e,n,t,r)},X:function(e,t,n){return S(e,r,t,n)},y:iP,Y:rP,Z:aP,"%":mP};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=qE[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function w(e,t){return function(n){var r,i,a=zE(1900,void 0,1);if(S(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=FE(zE(a.y,0,1))).getUTCDay(),r=i>4||0===i?wE.ceil(r):wE(r),r=dE.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=BE(zE(a.y,0,1))).getDay(),r=i>4||0===i?mE.ceil(r):mE(r),r=uE.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?FE(zE(a.y,0,1)).getUTCDay():BE(zE(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,FE(a)):BE(a)}}function S(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=x[i in qE?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return y.x=_(n,y),y.X=_(r,y),y.c=_(t,y),b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),{format:function(e){var t=_(e+="",y);return t.toString=function(){return e},t},parse:function(e){var t=w(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=w(e+="",!0);return t.toString=function(){return e},t}}}(e),VE=UE.format,UE.parse,GE=UE.utcFormat,UE.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var CN=e=>e.chartData,MN=eS([CN],e=>{var t=null!=e.chartData?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),EN=(e,t,n,r)=>r?MN(e):CN(e);function PN(e){if(Array.isArray(e)&&2===e.length){var[t,n]=e;if(Fy(t)&&Fy(n))return!0}return!1}function NN(e,t,n){return n?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function kN(e,t){if(t&&"function"!==typeof e&&Array.isArray(e)&&2===e.length){var n,r,[i,a]=e;if(Fy(i))n=i;else if("function"===typeof i)return;if(Fy(a))r=a;else if("function"===typeof a)return;var o=[n,r];if(PN(o))return o}}var RN,LN=n(8210),ON=n.n(LN),jN=e=>e,DN={"@@functional/placeholder":!0},IN=e=>e===DN,BN=e=>function t(){return 0===arguments.length||1===arguments.length&&IN(arguments.length<=0?void 0:arguments[0])?t:e(...arguments)},FN=(e,t)=>1===e?t:BN(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r.filter(e=>e!==DN).length;return a>=e?t(...r):FN(e-a,BN(function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var a=r.map(e=>IN(e)?n.shift():e);return t(...a,...n)}))}),zN=(e,t)=>{for(var n=[],r=e;r<t;++r)n[r-e]=r;return n},UN=FN((RN=(e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(e=>t[e]).map(e)).length,RN),VN=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join("");function GN(e){return 0===e?1:Math.floor(new(ON())(e).abs().log(10).toNumber())+1}function qN(e,t,n){for(var r=new(ON())(e),i=0,a=[];r.lt(t)&&i<1e5;)a.push(r.toNumber()),r=r.add(n),i++;return a}var WN=e=>{var[t,n]=e,[r,i]=[t,n];return t>n&&([r,i]=[n,t]),[r,i]},HN=(e,t,n)=>{if(e.lte(0))return new(ON())(0);var r=GN(e.toNumber()),i=new(ON())(10).pow(r),a=e.div(i),o=1!==r?.05:.1,s=new(ON())(Math.ceil(a.div(o).toNumber())).add(n).mul(o).mul(i);return t?new(ON())(s.toNumber()):new(ON())(Math.ceil(s.toNumber()))},$N=(e,t,n)=>{var r=new(ON())(1),i=new(ON())(e);if(!i.isint()&&n){var a=Math.abs(e);a<1?(r=new(ON())(10).pow(GN(e)-1),i=new(ON())(Math.floor(i.div(r).toNumber())).mul(r)):a>1&&(i=new(ON())(Math.floor(e)))}else 0===e?i=new(ON())(Math.floor((t-1)/2)):n||(i=new(ON())(Math.floor(e)));var o=Math.floor((t-1)/2),s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.length)return jN;var r=t.reverse(),i=r[0],a=r.slice(1);return function(){return a.reduce((e,t)=>t(e),i(...arguments))}}(UN(e=>i.add(new(ON())(e-o).mul(r)).toNumber()),zN);return s(0,t)},KN=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!Number.isFinite((t-e)/(n-1)))return{step:new(ON())(0),tickMin:new(ON())(0),tickMax:new(ON())(0)};var a,o=HN(new(ON())(t).sub(e).div(n-1),r,i);a=e<=0&&t>=0?new(ON())(0):(a=new(ON())(e).add(t).div(2)).sub(new(ON())(a).mod(o));var s=Math.ceil(a.sub(e).div(o).toNumber()),l=Math.ceil(new(ON())(t).sub(a).div(o).toNumber()),c=s+l+1;return c>n?KN(e,t,n,r,i+1):(c<n&&(l=t>0?l+(n-c):l,s=t>0?s:s+(n-c)),{step:o,tickMin:a.sub(new(ON())(s).mul(o)),tickMax:a.add(new(ON())(l).mul(o))})},XN=e=>e.rootProps.maxBarSize,YN=e=>e.rootProps.barCategoryGap,QN=e=>e.rootProps.stackOffset,ZN=e=>e.rootProps.reverseStackOrder,JN=e=>e.options.chartName,ek=e=>e.rootProps.syncId,tk=e=>e.rootProps.syncMethod,nk=e=>e.options.eventEmitter;function rk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ik(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rk(Object(n),!0).forEach(function(t){ak(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rk(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ak(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ok=Math.PI/180,sk=e=>180*e/Math.PI,lk=(e,t,n,r)=>({x:e+Math.cos(-ok*r)*n,y:t+Math.sin(-ok*r)*n}),ck=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{top:0,right:0,bottom:0,left:0,width:0,height:0,brushBottom:0};return Math.min(Math.abs(e-(n.left||0)-(n.right||0)),Math.abs(t-(n.top||0)-(n.bottom||0)))/2},uk=(e,t)=>{var{x:n,y:r}=e,{cx:i,cy:a}=t,o=((e,t)=>{var{x:n,y:r}=e,{x:i,y:a}=t;return Math.sqrt((n-i)**2+(r-a)**2)})({x:n,y:r},{x:i,y:a});if(o<=0)return{radius:o,angle:0};var s=(n-i)/o,l=Math.acos(s);return r>a&&(l=2*Math.PI-l),{radius:o,angle:sk(l),angleInRadian:l}},dk=(e,t)=>{var{startAngle:n,endAngle:r}=t,i=Math.floor(n/360),a=Math.floor(r/360);return e+360*Math.min(i,a)},hk=(e,t)=>{var{chartX:n,chartY:r}=e,{radius:i,angle:a}=uk({x:n,y:r},t),{innerRadius:o,outerRadius:s}=t;if(i<o||i>s)return null;if(0===i)return null;var l,{startAngle:c,endAngle:u}=(e=>{var{startAngle:t,endAngle:n}=e,r=Math.floor(t/360),i=Math.floor(n/360),a=Math.min(r,i);return{startAngle:t-360*a,endAngle:n-360*a}})(t),d=a;if(c<=u){for(;d>u;)d-=360;for(;d<c;)d+=360;l=d>=c&&d<=u}else{for(;d>c;)d-=360;for(;d<u;)d+=360;l=d>=u&&d<=c}return l?ik(ik({},t),{},{radius:i,angle:dk(d,t)}):null},pk={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},fk=!0,mk=0,gk=!1,vk="auto",Ak=!0,yk="category",bk=(pk.axis,!1),xk=!0,_k=0,wk="auto",Sk=!0,Tk=5,Ck="number",Mk=(pk.axis,(e,t)=>{if(e&&t)return null!==e&&void 0!==e&&e.reversed?[t[1],t[0]]:t}),Ek={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:mk,includeHidden:!1,name:void 0,reversed:gk,scale:vk,tick:Ak,tickCount:void 0,ticks:void 0,type:yk,unit:void 0},Pk={allowDataOverflow:bk,allowDecimals:!1,allowDuplicatedCategory:xk,dataKey:void 0,domain:void 0,id:_k,includeHidden:!1,name:void 0,reversed:!1,scale:wk,tick:Sk,tickCount:Tk,ticks:void 0,type:Ck,unit:void 0},Nk={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:fk,dataKey:void 0,domain:void 0,id:mk,includeHidden:!1,name:void 0,reversed:!1,scale:vk,tick:Ak,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},kk={allowDataOverflow:bk,allowDecimals:!1,allowDuplicatedCategory:xk,dataKey:void 0,domain:void 0,id:_k,includeHidden:!1,name:void 0,reversed:!1,scale:wk,tick:Sk,tickCount:Tk,ticks:void 0,type:"category",unit:void 0},Rk=(e,t)=>null!=e.polarAxis.angleAxis[t]?e.polarAxis.angleAxis[t]:"radial"===e.layout.layoutType?Nk:Ek,Lk=(e,t)=>null!=e.polarAxis.radiusAxis[t]?e.polarAxis.radiusAxis[t]:"radial"===e.layout.layoutType?kk:Pk,Ok=e=>e.polarOptions,jk=eS([zS,US,QS],ck),Dk=eS([Ok,jk],(e,t)=>{if(null!=e)return Sy(e.innerRadius,t,0)}),Ik=eS([Ok,jk],(e,t)=>{if(null!=e)return Sy(e.outerRadius,t,.8*t)}),Bk=eS([Ok],e=>{if(null==e)return[0,0];var{startAngle:t,endAngle:n}=e;return[t,n]}),Fk=(eS([Rk,Bk],Mk),eS([jk,Dk,Ik],(e,t,n)=>{if(null!=e&&null!=t&&null!=n)return[t,n]})),zk=(eS([Lk,Fk],Mk),eS([uT,Ok,Dk,Ik,zS,US],(e,t,n,r,i,a)=>{if(("centric"===e||"radial"===e)&&null!=t&&null!=n&&null!=r){var{cx:o,cy:s,startAngle:l,endAngle:c}=t;return{cx:Sy(o,i,i/2),cy:Sy(s,a,a/2),innerRadius:n,outerRadius:r,startAngle:l,endAngle:c,clockWise:!1}}})),Uk=(e,t)=>t,Vk=(e,t,n)=>n;function Gk(e){return null===e||void 0===e?void 0:e.id}function qk(e,t,n){var{chartData:r=[]}=t,{allowDuplicatedCategory:i,dataKey:a}=n,o=new Map;return e.forEach(e=>{var t,n=null!==(t=e.data)&&void 0!==t?t:r;if(null!=n&&0!==n.length){var s=Gk(e);n.forEach((t,n)=>{var r,l=null==a||i?n:String(SS(t,a,null)),c=SS(t,e.dataKey,0);r=o.has(l)?o.get(l):{},Object.assign(r,{[s]:c}),o.set(l,r)})}}),Array.from(o.values())}function Wk(e){return null!=e.stackId&&null!=e.dataKey}var Hk=(e,t)=>e===t||null!=e&&null!=t&&(e[0]===t[0]&&e[1]===t[1]);function $k(e,t){return!(!Array.isArray(e)||!Array.isArray(t)||0!==e.length||0!==t.length)||e===t}var Kk=e=>{var t=uT(e);return"horizontal"===t?"xAxis":"vertical"===t?"yAxis":"centric"===t?"angleAxis":"radiusAxis"},Xk=e=>e.tooltip.settings.axisId;function Yk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Qk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yk(Object(n),!0).forEach(function(t){Zk(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yk(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Zk(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jk=[0,"auto"],eR={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},tR=(e,t)=>e.cartesianAxis.xAxis[t],nR=(e,t)=>{var n=tR(e,t);return null==n?eR:n},rR={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:Jk,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:60},iR=(e,t)=>e.cartesianAxis.yAxis[t],aR=(e,t)=>{var n=iR(e,t);return null==n?rR:n},oR={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},sR=(e,t)=>{var n=e.cartesianAxis.zAxis[t];return null==n?oR:n},lR=(e,t,n)=>{switch(t){case"xAxis":return nR(e,n);case"yAxis":return aR(e,n);case"zAxis":return sR(e,n);case"angleAxis":return Rk(e,n);case"radiusAxis":return Lk(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},cR=(e,t,n)=>{switch(t){case"xAxis":return nR(e,n);case"yAxis":return aR(e,n);case"angleAxis":return Rk(e,n);case"radiusAxis":return Lk(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},uR=e=>e.graphicalItems.cartesianItems.some(e=>"bar"===e.type)||e.graphicalItems.polarItems.some(e=>"radialBar"===e.type);function dR(e,t){return n=>{switch(e){case"xAxis":return"xAxisId"in n&&n.xAxisId===t;case"yAxis":return"yAxisId"in n&&n.yAxisId===t;case"zAxis":return"zAxisId"in n&&n.zAxisId===t;case"angleAxis":return"angleAxisId"in n&&n.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in n&&n.radiusAxisId===t;default:return!1}}}var hR=e=>e.graphicalItems.cartesianItems,pR=eS([Uk,Vk],dR),fR=(e,t,n)=>e.filter(n).filter(e=>!0===(null===t||void 0===t?void 0:t.includeHidden)||!e.hide),mR=eS([hR,lR,pR],fR,{memoizeOptions:{resultEqualityCheck:$k}}),gR=eS([mR],e=>e.filter(e=>"area"===e.type||"bar"===e.type).filter(Wk)),vR=e=>e.filter(e=>!("stackId"in e)||void 0===e.stackId),AR=eS([mR],vR),yR=e=>e.map(e=>e.data).filter(Boolean).flat(1),bR=eS([mR],yR,{memoizeOptions:{resultEqualityCheck:$k}}),xR=(e,t)=>{var{chartData:n=[],dataStartIndex:r,dataEndIndex:i}=t;return e.length>0?e:n.slice(r,i+1)},_R=eS([bR,EN],xR),wR=(e,t,n)=>null!=(null===t||void 0===t?void 0:t.dataKey)?e.map(e=>({value:SS(e,t.dataKey)})):n.length>0?n.map(e=>e.dataKey).flatMap(t=>e.map(e=>({value:SS(e,t)}))):e.map(e=>({value:e})),SR=eS([_R,lR,mR],wR);function TR(e,t){switch(e){case"xAxis":return"x"===t.direction;case"yAxis":return"y"===t.direction;default:return!1}}function CR(e){if(xy(e)||e instanceof Date){var t=Number(e);if(Fy(t))return t}}function MR(e){if(Array.isArray(e)){var t=[CR(e[0]),CR(e[1])];return PN(t)?t:void 0}var n=CR(e);if(null!=n)return[n,n]}function ER(e){return e.map(CR).filter(Ny)}var PR=e=>{var t=Kk(e),n=Xk(e);return cR(e,t,n)},NR=eS([PR],e=>null===e||void 0===e?void 0:e.dataKey),kR=eS([gR,EN,PR],qk),RR=(e,t,n,r)=>{var i=t.reduce((e,t)=>(null==t.stackId||(null==e[t.stackId]&&(e[t.stackId]=[]),e[t.stackId].push(t)),e),{});return Object.fromEntries(Object.entries(i).map(t=>{var[i,a]=t,o=r?[...a].reverse():a,s=o.map(Gk);return[i,{stackedData:NS(e,s,n),graphicalItems:o}]}))},LR=eS([kR,gR,QN,ZN],RR),OR=(e,t,n,r)=>{var{dataStartIndex:i,dataEndIndex:a}=t;if(null==r&&"zAxis"!==n){var o=OS(e,i,a);if(null==o||0!==o[0]||0!==o[1])return o}},jR=eS([lR],e=>e.allowDataOverflow),DR=e=>{var t;if(null==e||!("domain"in e))return Jk;if(null!=e.domain)return e.domain;if(null!=e.ticks){if("number"===e.type){var n=ER(e.ticks);return[Math.min(...n),Math.max(...n)]}if("category"===e.type)return e.ticks.map(String)}return null!==(t=null===e||void 0===e?void 0:e.domain)&&void 0!==t?t:Jk},IR=eS([lR],DR),BR=eS([IR,jR],kN),FR=eS([LR,CN,Uk,BR],OR,{memoizeOptions:{resultEqualityCheck:Hk}}),zR=e=>e.errorBars,UR=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(Boolean);if(0!==r.length){var i=r.flat();return[Math.min(...i),Math.max(...i)]}},VR=(e,t,n,r,i)=>{var a,o;if(n.length>0&&e.forEach(e=>{n.forEach(n=>{var s,l,c=null===(s=r[n.id])||void 0===s?void 0:s.filter(e=>TR(i,e)),u=SS(e,null!==(l=t.dataKey)&&void 0!==l?l:n.dataKey),d=function(e,t,n){return!n||"number"!==typeof t||Ay(t)?[]:n.length?ER(n.flatMap(n=>{var r,i,a=SS(e,n.dataKey);if(Array.isArray(a)?[r,i]=a:r=i=a,Fy(r)&&Fy(i))return[t-r,t+i]})):[]}(e,u,c);if(d.length>=2){var h=Math.min(...d),p=Math.max(...d);(null==a||h<a)&&(a=h),(null==o||p>o)&&(o=p)}var f=MR(u);null!=f&&(a=null==a?f[0]:Math.min(a,f[0]),o=null==o?f[1]:Math.max(o,f[1]))})}),null!=(null===t||void 0===t?void 0:t.dataKey)&&e.forEach(e=>{var n=MR(SS(e,t.dataKey));null!=n&&(a=null==a?n[0]:Math.min(a,n[0]),o=null==o?n[1]:Math.max(o,n[1]))}),Fy(a)&&Fy(o))return[a,o]},GR=eS([_R,lR,AR,zR,Uk],VR,{memoizeOptions:{resultEqualityCheck:Hk}});function qR(e){var{value:t}=e;if(xy(t)||t instanceof Date)return t}var WR=e=>e.referenceElements.dots,HR=(e,t,n)=>e.filter(e=>"extendDomain"===e.ifOverflow).filter(e=>"xAxis"===t?e.xAxisId===n:e.yAxisId===n),$R=eS([WR,Uk,Vk],HR),KR=e=>e.referenceElements.areas,XR=eS([KR,Uk,Vk],HR),YR=e=>e.referenceElements.lines,QR=eS([YR,Uk,Vk],HR),ZR=(e,t)=>{var n=ER(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==n.length)return[Math.min(...n),Math.max(...n)]},JR=eS($R,Uk,ZR),eL=(e,t)=>{var n=ER(e.flatMap(e=>["xAxis"===t?e.x1:e.y1,"xAxis"===t?e.x2:e.y2]));if(0!==n.length)return[Math.min(...n),Math.max(...n)]},tL=eS([XR,Uk],eL);var nL=(e,t)=>{var n=e.flatMap(e=>"xAxis"===t?function(e){var t;if(null!=e.x)return ER([e.x]);var n=null===(t=e.segment)||void 0===t?void 0:t.map(e=>e.x);return null==n||0===n.length?[]:ER(n)}(e):function(e){var t;if(null!=e.y)return ER([e.y]);var n=null===(t=e.segment)||void 0===t?void 0:t.map(e=>e.y);return null==n||0===n.length?[]:ER(n)}(e));if(0!==n.length)return[Math.min(...n),Math.max(...n)]},rL=eS([QR,Uk],nL),iL=eS(JR,rL,tL,(e,t,n)=>UR(e,n,t)),aL=(e,t,n,r,i,a,o,s)=>null!=n?n:function(e,t,n){if(n||null!=t){if("function"===typeof e&&null!=t)try{var r=e(t,n);if(PN(r))return NN(r,t,n)}catch(p){}if(Array.isArray(e)&&2===e.length){var i,a,[o,s]=e;if("auto"===o)null!=t&&(i=Math.min(...t));else if(by(o))i=o;else if("function"===typeof o)try{null!=t&&(i=o(null===t||void 0===t?void 0:t[0]))}catch(f){}else if("string"===typeof o&&jS.test(o)){var l=jS.exec(o);if(null==l||null==t)i=void 0;else{var c=+l[1];i=t[0]-c}}else i=null===t||void 0===t?void 0:t[0];if("auto"===s)null!=t&&(a=Math.max(...t));else if(by(s))a=s;else if("function"===typeof s)try{null!=t&&(a=s(null===t||void 0===t?void 0:t[1]))}catch(m){}else if("string"===typeof s&&DS.test(s)){var u=DS.exec(s);if(null==u||null==t)a=void 0;else{var d=+u[1];a=t[1]+d}}else a=null===t||void 0===t?void 0:t[1];var h=[i,a];if(PN(h))return null==t?h:NN(h,t,n)}}}(t,"vertical"===o&&"xAxis"===s||"horizontal"===o&&"yAxis"===s?UR(r,a,i):UR(a,i),e.allowDataOverflow),oL=eS([lR,IR,BR,FR,GR,iL,uT,Uk],aL,{memoizeOptions:{resultEqualityCheck:Hk}}),sL=[0,1],lL=(e,t,n,r,i,a,o)=>{if(null!=e&&null!=n&&0!==n.length||void 0!==o){var s,{dataKey:l,type:c}=e,u=TS(t,a);return u&&null==l?fT()(0,null!==(s=null===n||void 0===n?void 0:n.length)&&void 0!==s?s:0):"category"===c?((e,t,n)=>{var r=e.map(qR).filter(e=>null!=e);return n&&(null==t.dataKey||t.allowDuplicatedCategory&&Ty(r))?fT()(0,e.length):t.allowDuplicatedCategory?r:Array.from(new Set(r))})(r,e,u):"expand"===i?sL:o}},cL=eS([lR,uT,_R,SR,QN,Uk,oL],lL),uL=(t,n,r,i,a)=>{if(null!=t){var{scale:o,type:s}=t;if("auto"===o)return"radial"===n&&"radiusAxis"===a?"band":"radial"===n&&"angleAxis"===a?"linear":"category"===s&&i&&(i.indexOf("LineChart")>=0||i.indexOf("AreaChart")>=0||i.indexOf("ComposedChart")>=0&&!r)?"point":"category"===s?"band":"linear";if("string"===typeof o){var l="scale".concat(Py(o));return l in e?l:"point"}}},dL=eS([lR,uT,uR,JN,Uk],uL);function hL(t,n,r,i){if(null!=r&&null!=i){if("function"===typeof t.scale)return t.scale.copy().domain(r).range(i);var a=function(t){if(null!=t){if(t in e)return e[t]();var n="scale".concat(Py(t));return n in e?e[n]():void 0}}(n);if(null!=a){var o=a.domain(r).range(i);return(e=>{var t=e.domain();if(t&&!(t.length<=2)){var n=t.length,r=e.range(),i=Math.min(r[0],r[1])-ES,a=Math.max(r[0],r[1])+ES,o=e(t[0]),s=e(t[n-1]);(o<i||o>a||s<i||s>a)&&e.domain([t[0],t[n-1]])}})(o),o}}}var pL=(e,t,n)=>{var r=DR(t);if("auto"===n||"linear"===n)return null!=t&&t.tickCount&&Array.isArray(r)&&("auto"===r[0]||"auto"===r[1])&&PN(e)?function(e){var[t,n]=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Math.max(r,2),[o,s]=WN([t,n]);if(o===-1/0||s===1/0){var l=s===1/0?[o,...zN(0,r-1).map(()=>1/0)]:[...zN(0,r-1).map(()=>-1/0),s];return t>n?VN(l):l}if(o===s)return $N(o,r,i);var{step:c,tickMin:u,tickMax:d}=KN(o,s,a,i,0),h=qN(u,d.add(new(ON())(.1).mul(c)),c);return t>n?VN(h):h}(e,t.tickCount,t.allowDecimals):null!=t&&t.tickCount&&"number"===t.type&&PN(e)?function(e,t){var[n,r]=e,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],[a,o]=WN([n,r]);if(a===-1/0||o===1/0)return[n,r];if(a===o)return[a];var s=Math.max(t,2),l=HN(new(ON())(o).sub(a).div(s-1),i,0),c=[...qN(new(ON())(a),new(ON())(o),l),o];return!1===i&&(c=c.map(e=>Math.round(e))),n>r?VN(c):c}(e,t.tickCount,t.allowDecimals):void 0},fL=eS([cL,cR,dL],pL),mL=(e,t,n,r)=>{if("angleAxis"!==r&&"number"===(null===e||void 0===e?void 0:e.type)&&PN(t)&&Array.isArray(n)&&n.length>0){var i=t[0],a=n[0],o=t[1],s=n[n.length-1];return[Math.min(i,a),Math.max(o,s)]}return t},gL=eS([lR,cL,fL,Uk],mL),vL=eS(SR,lR,(e,t)=>{if(t&&"number"===t.type){var n=1/0,r=Array.from(ER(e.map(e=>e.value))).sort((e,t)=>e-t);if(r.length<2)return 1/0;var i=r[r.length-1]-r[0];if(0===i)return 1/0;for(var a=0;a<r.length-1;a++){var o=r[a+1]-r[a];n=Math.min(n,o)}return n/i}}),AL=eS(vL,uT,YN,QS,(e,t,n,r)=>r,(e,t,n,r,i)=>{if(!Fy(e))return 0;var a="vertical"===t?r.height:r.width;if("gap"===i)return e*a/2;if("no-gap"===i){var o=Sy(n,e*a),s=e*a/2;return s-o-(s-o)/a*o}return 0}),yL=eS(nR,(e,t)=>{var n=nR(e,t);return null==n||"string"!==typeof n.padding?0:AL(e,"xAxis",t,n.padding)},(e,t)=>{var n,r;if(null==e)return{left:0,right:0};var{padding:i}=e;return"string"===typeof i?{left:t,right:t}:{left:(null!==(n=i.left)&&void 0!==n?n:0)+t,right:(null!==(r=i.right)&&void 0!==r?r:0)+t}}),bL=eS(aR,(e,t)=>{var n=aR(e,t);return null==n||"string"!==typeof n.padding?0:AL(e,"yAxis",t,n.padding)},(e,t)=>{var n,r;if(null==e)return{top:0,bottom:0};var{padding:i}=e;return"string"===typeof i?{top:t,bottom:t}:{top:(null!==(n=i.top)&&void 0!==n?n:0)+t,bottom:(null!==(r=i.bottom)&&void 0!==r?r:0)+t}}),xL=eS([QS,yL,rT,nT,(e,t,n)=>n],(e,t,n,r,i)=>{var{padding:a}=r;return i?[a.left,n.width-a.right]:[e.left+t.left,e.left+e.width-t.right]}),_L=eS([QS,uT,bL,rT,nT,(e,t,n)=>n],(e,t,n,r,i,a)=>{var{padding:o}=i;return a?[r.height-o.bottom,o.top]:"horizontal"===t?[e.top+e.height-n.bottom,e.top+n.top]:[e.top+n.top,e.top+e.height-n.bottom]}),wL=(e,t,n,r)=>{var i;switch(t){case"xAxis":return xL(e,n,r);case"yAxis":return _L(e,n,r);case"zAxis":return null===(i=sR(e,n))||void 0===i?void 0:i.range;case"angleAxis":return Bk(e);case"radiusAxis":return Fk(e,n);default:return}},SL=eS([lR,wL],Mk),TL=eS([lR,dL,gL,SL],hL);eS([mR,zR,Uk],(e,t,n)=>e.flatMap(e=>t[e.id]).filter(Boolean).filter(e=>TR(n,e)));function CL(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var ML=(e,t)=>t,EL=(e,t,n)=>n,PL=eS(qS,ML,EL,(e,t,n)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===n).sort(CL)),NL=eS(WS,ML,EL,(e,t,n)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===n).sort(CL)),kL=(e,t)=>({width:e.width,height:t.height}),RL=eS(QS,nR,kL),LL=eS(US,QS,PL,ML,EL,(e,t,n,r,i)=>{var a,o={};return n.forEach(n=>{var s=kL(t,n);null==a&&(a=((e,t,n)=>{switch(t){case"top":return e.top;case"bottom":return n-e.bottom;default:return 0}})(t,r,e));var l="top"===r&&!i||"bottom"===r&&i;o[n.id]=a-Number(l)*s.height,a+=(l?-1:1)*s.height}),o}),OL=eS(zS,QS,NL,ML,EL,(e,t,n,r,i)=>{var a,o={};return n.forEach(n=>{var s=((e,t)=>({width:"number"===typeof t.width?t.width:60,height:e.height}))(t,n);null==a&&(a=((e,t,n)=>{switch(t){case"left":return e.left;case"right":return n-e.right;default:return 0}})(t,r,e));var l="left"===r&&!i||"right"===r&&i;o[n.id]=a-Number(l)*s.width,a+=(l?-1:1)*s.width}),o}),jL=eS([QS,nR,(e,t)=>{var n=nR(e,t);if(null!=n)return LL(e,n.orientation,n.mirror)},(e,t)=>t],(e,t,n,r)=>{if(null!=t){var i=null===n||void 0===n?void 0:n[r];return null==i?{x:e.left,y:0}:{x:e.left,y:i}}}),DL=eS([QS,aR,(e,t)=>{var n=aR(e,t);if(null!=n)return OL(e,n.orientation,n.mirror)},(e,t)=>t],(e,t,n,r)=>{if(null!=t){var i=null===n||void 0===n?void 0:n[r];return null==i?{x:0,y:e.top}:{x:i,y:e.top}}}),IL=eS(QS,aR,(e,t)=>({width:"number"===typeof t.width?t.width:60,height:e.height})),BL=(e,t,n)=>{switch(t){case"xAxis":return RL(e,n).width;case"yAxis":return IL(e,n).height;default:return}},FL=(e,t,n,r)=>{if(null!=n){var{allowDuplicatedCategory:i,type:a,dataKey:o}=n,s=TS(e,r),l=t.map(e=>e.value);return o&&s&&"category"===a&&i&&Ty(l)?l:void 0}},zL=eS([uT,SR,lR,Uk],FL),UL=(e,t,n,r)=>{if(null!=n&&null!=n.dataKey){var{type:i,scale:a}=n;return!TS(e,r)||"number"!==i&&"auto"===a?void 0:t.map(e=>e.value)}},VL=eS([uT,SR,cR,Uk],UL),GL=eS([uT,(e,t,n)=>{switch(t){case"xAxis":return nR(e,n);case"yAxis":return aR(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},dL,TL,zL,VL,wL,fL,Uk],(e,t,n,r,i,a,o,s,l)=>{if(null!=t){var c=TS(e,l);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:l,categoricalDomain:a,duplicateDomain:i,isCategorical:c,niceTicks:s,range:o,realScaleType:n,scale:r}}}),qL=eS([uT,cR,dL,TL,fL,wL,zL,VL,Uk],(e,t,n,r,i,a,o,s,l)=>{if(null!=t&&null!=r){var c=TS(e,l),{type:u,ticks:d,tickCount:h}=t,p="scaleBand"===n&&"function"===typeof r.bandwidth?r.bandwidth()/2:2,f="category"===u&&r.bandwidth?r.bandwidth()/p:0;f="angleAxis"===l&&null!=a&&a.length>=2?2*vy(a[0]-a[1])*f:f;var m=d||i;if(m){var g=m.map((e,t)=>{var n=o?o.indexOf(e):e;return{index:t,coordinate:r(n)+f,value:e,offset:f}});return g.filter(e=>Fy(e.coordinate))}return c&&s?s.map((e,t)=>({coordinate:r(e)+f,value:e,index:t,offset:f})).filter(e=>Fy(e.coordinate)):r.ticks?r.ticks(h).map(e=>({coordinate:r(e)+f,value:e,offset:f})):r.domain().map((e,t)=>({coordinate:r(e)+f,value:o?o[e]:e,index:t,offset:f}))}}),WL=eS([uT,cR,TL,wL,zL,VL,Uk],(e,t,n,r,i,a,o)=>{if(null!=t&&null!=n&&null!=r&&r[0]!==r[1]){var s=TS(e,o),{tickCount:l}=t,c=0;return c="angleAxis"===o&&(null===r||void 0===r?void 0:r.length)>=2?2*vy(r[0]-r[1])*c:c,s&&a?a.map((e,t)=>({coordinate:n(e)+c,value:e,index:t,offset:c})):n.ticks?n.ticks(l).map(e=>({coordinate:n(e)+c,value:e,offset:c})):n.domain().map((e,t)=>({coordinate:n(e)+c,value:i?i[e]:e,index:t,offset:c}))}}),HL=eS(lR,TL,(e,t)=>{if(null!=e&&null!=t)return Qk(Qk({},e),{},{scale:t})}),$L=eS([lR,dL,cL,SL],hL),KL=(eS((e,t,n)=>sR(e,n),$L,(e,t)=>{if(null!=e&&null!=t)return Qk(Qk({},e),{},{scale:t})}),eS([uT,qS,WS],(e,t,n)=>{switch(e){case"horizontal":return t.some(e=>e.reversed)?"right-to-left":"left-to-right";case"vertical":return n.some(e=>e.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}})),XL=e=>e.options.defaultTooltipEventType,YL=e=>e.options.validateTooltipEventTypes;function QL(e,t,n){if(null==e)return t;var r=e?"axis":"item";return null==n?t:n.includes(r)?r:t}function ZL(e,t){return QL(t,XL(e),YL(e))}var JL=(e,t)=>{var n,r=Number(t);if(!Ay(r)&&null!=t)return r>=0?null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.value:void 0};function eO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eO(Object(n),!0).forEach(function(t){nO(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nO(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var rO=(e,t,n,r)=>{if(null==t)return xw;var i=function(e,t,n){return"axis"===t?"click"===n?e.axisInteraction.click:e.axisInteraction.hover:"click"===n?e.itemInteraction.click:e.itemInteraction.hover}(e,t,n);if(null==i)return xw;if(i.active)return i;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&null!=e.syncInteraction.index)return e.syncInteraction;var a=!0===e.settings.active;if(null!=i.index){if(a)return tO(tO({},i),{},{active:!0})}else if(null!=r)return{active:!0,coordinate:void 0,dataKey:void 0,index:r,graphicalItemId:void 0};return tO(tO({},xw),{},{coordinate:i.coordinate})};function iO(e,t){var n=function(e){if("number"===typeof e)return Number.isFinite(e)?e:void 0;if(e instanceof Date){var t=e.valueOf();return Number.isFinite(t)?t:void 0}var n=Number(e);return Number.isFinite(n)?n:void 0}(e),r=t[0],i=t[1];if(void 0===n)return!1;var a=Math.min(r,i),o=Math.max(r,i);return n>=a&&n<=o}var aO=(e,t,n,r)=>{var i=null===e||void 0===e?void 0:e.index;if(null==i)return null;var a=Number(i);if(!Fy(a))return i;var o=1/0;t.length>0&&(o=t.length-1);var s=Math.max(0,Math.min(a,o)),l=t[s];return null==l||function(e,t,n){if(null==n||null==t)return!0;var r=SS(e,t);return null==r||!PN(n)||iO(r,n)}(l,n,r)?String(s):null},oO=(e,t,n,r,i,a,o,s)=>{if(null!=a&&null!=s){var l=o[0],c=null==l?void 0:s(l.positions,a);if(null!=c)return c;var u=null===i||void 0===i?void 0:i[Number(a)];if(u)return"horizontal"===n?{x:u.coordinate,y:(r.top+t)/2}:{x:(r.left+e)/2,y:u.coordinate}}},sO=(e,t,n,r)=>{return"axis"===t?e.tooltipItemPayloads:0===e.tooltipItemPayloads.length?[]:null==(i="hover"===n?e.itemInteraction.hover.dataKey:e.itemInteraction.click.dataKey)&&null!=r?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(e=>{var t;return(null===(t=e.settings)||void 0===t?void 0:t.dataKey)===i});var i},lO=e=>e.options.tooltipPayloadSearcher,cO=e=>e.tooltip;function uO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function dO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uO(Object(n),!0).forEach(function(t){hO(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function hO(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pO=(e,t,n,r,i,a,o)=>{if(null!=t&&null!=a){var{chartData:s,computedData:l,dataStartIndex:c,dataEndIndex:u}=n;return e.reduce((e,n)=>{var d,h,p,{dataDefinedOnItem:f,settings:m}=n,g=function(e,t){return null!=e?e:t}(f,s),v=Array.isArray(g)?bS(g,c,u):g,A=null!==(d=null===m||void 0===m?void 0:m.dataKey)&&void 0!==d?d:r,y=null===m||void 0===m?void 0:m.nameKey;(h=r&&Array.isArray(v)&&!Array.isArray(v[0])&&"axis"===o?My(v,r,i):a(v,t,l,y),Array.isArray(h))?h.forEach(t=>{var n=dO(dO({},m),{},{name:t.name,unit:t.unit,color:void 0,fill:void 0});e.push(BS({tooltipEntrySettings:n,dataKey:t.dataKey,payload:t.payload,value:SS(t.payload,t.dataKey),name:t.name}))}):e.push(BS({tooltipEntrySettings:m,dataKey:A,payload:h,value:SS(h,A),name:null!==(p=SS(h,y))&&void 0!==p?p:null===m||void 0===m?void 0:m.name}));return e},[])}},fO=eS([PR,uT,uR,JN,Kk],uL),mO=eS([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),gO=eS([Kk,Xk],dR),vO=eS([mO,PR,gO],fR,{memoizeOptions:{resultEqualityCheck:$k}}),AO=eS([vO],e=>e.filter(Wk)),yO=eS([vO],yR,{memoizeOptions:{resultEqualityCheck:$k}}),bO=eS([yO,CN],xR),xO=eS([AO,CN,PR],qk),_O=eS([bO,PR,vO],wR),wO=eS([PR],DR),SO=eS([PR],e=>e.allowDataOverflow),TO=eS([wO,SO],kN),CO=eS([vO],e=>e.filter(Wk)),MO=eS([xO,CO,QN,ZN],RR),EO=eS([MO,CN,Kk,TO],OR),PO=eS([vO],vR),NO=eS([bO,PR,PO,zR,Kk],VR,{memoizeOptions:{resultEqualityCheck:Hk}}),kO=eS([WR,Kk,Xk],HR),RO=eS([kO,Kk],ZR),LO=eS([KR,Kk,Xk],HR),OO=eS([LO,Kk],eL),jO=eS([YR,Kk,Xk],HR),DO=eS([jO,Kk],nL),IO=eS([RO,DO,OO],UR),BO=eS([PR,wO,TO,EO,NO,IO,uT,Kk],aL),FO=eS([PR,uT,bO,_O,QN,Kk,BO],lL),zO=eS([FO,PR,fO],pL),UO=eS([PR,FO,zO,Kk],mL),VO=e=>{var t=Kk(e),n=Xk(e);return wL(e,t,n,!1)},GO=eS([PR,VO],Mk),qO=eS([PR,fO,UO,GO],hL),WO=eS([uT,_O,PR,Kk],FL),HO=eS([uT,_O,PR,Kk],UL),$O=eS([uT,PR,fO,qO,VO,WO,HO,Kk],(e,t,n,r,i,a,o,s)=>{if(t){var{type:l}=t,c=TS(e,s);if(r){var u="scaleBand"===n&&r.bandwidth?r.bandwidth()/2:2,d="category"===l&&r.bandwidth?r.bandwidth()/u:0;return d="angleAxis"===s&&null!=i&&(null===i||void 0===i?void 0:i.length)>=2?2*vy(i[0]-i[1])*d:d,c&&o?o.map((e,t)=>({coordinate:r(e)+d,value:e,index:t,offset:d})):r.domain().map((e,t)=>({coordinate:r(e)+d,value:a?a[e]:e,index:t,offset:d}))}}}),KO=eS([XL,YL,e=>e.tooltip.settings],(e,t,n)=>QL(n.shared,e,t)),XO=e=>e.tooltip.settings.trigger,YO=e=>e.tooltip.settings.defaultIndex,QO=eS([cO,KO,XO,YO],rO),ZO=eS([QO,bO,NR,FO],aO),JO=eS([$O,ZO],JL),ej=eS([QO],e=>{if(e)return e.dataKey}),tj=eS([QO],e=>{if(e)return e.graphicalItemId}),nj=eS([cO,KO,XO,YO],sO),rj=eS([zS,US,uT,QS,$O,YO,nj,lO],oO),ij=eS([QO,rj],(e,t)=>null!==e&&void 0!==e&&e.coordinate?e.coordinate:t),aj=eS([QO],e=>e.active),oj=eS([nj,ZO,CN,NR,JO,lO,KO],pO),sj=eS([oj],e=>{if(null!=e){var t=e.map(e=>e.payload).filter(e=>null!=e);return Array.from(new Set(t))}});function lj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lj(Object(n),!0).forEach(function(t){uj(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lj(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function uj(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dj=(e,t,n,r,i)=>{var a,o=-1,s=null!==(a=null===t||void 0===t?void 0:t.length)&&void 0!==a?a:0;if(s<=1||null==e)return 0;if("angleAxis"===r&&null!=i&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var l=0;l<s;l++){var c=l>0?n[l-1].coordinate:n[s-1].coordinate,u=n[l].coordinate,d=l>=s-1?n[0].coordinate:n[l+1].coordinate,h=void 0;if(vy(u-c)!==vy(d-u)){var p=[];if(vy(d-u)===vy(i[1]-i[0])){h=d;var f=u+i[1]-i[0];p[0]=Math.min(f,(f+c)/2),p[1]=Math.max(f,(f+c)/2)}else{h=c;var m=d+i[1]-i[0];p[0]=Math.min(u,(m+u)/2),p[1]=Math.max(u,(m+u)/2)}var g=[Math.min(u,(h+u)/2),Math.max(u,(h+u)/2)];if(e>g[0]&&e<=g[1]||e>=p[0]&&e<=p[1]){({index:o}=n[l]);break}}else{var v=Math.min(c,d),A=Math.max(c,d);if(e>(v+u)/2&&e<=(A+u)/2){({index:o}=n[l]);break}}}else if(t)for(var y=0;y<s;y++)if(0===y&&e<=(t[y].coordinate+t[y+1].coordinate)/2||y>0&&y<s-1&&e>(t[y].coordinate+t[y-1].coordinate)/2&&e<=(t[y].coordinate+t[y+1].coordinate)/2||y===s-1&&e>(t[y].coordinate+t[y-1].coordinate)/2){({index:o}=t[y]);break}return o},hj=()=>cS(JN),pj=(e,t)=>t,fj=(e,t,n)=>n,mj=(e,t,n,r)=>r,gj=eS($O,e=>dS()(e,e=>e.coordinate)),vj=eS([cO,pj,fj,mj],rO),Aj=eS([vj,bO,NR,FO],aO),yj=eS([cO,pj,fj,mj],sO),bj=eS([zS,US,uT,QS,$O,mj,yj,lO],oO),xj=eS([vj,bj],(e,t)=>{var n;return null!==(n=e.coordinate)&&void 0!==n?n:t}),_j=eS([$O,Aj],JL),wj=eS([yj,Aj,CN,NR,_j,lO,pj],pO),Sj=eS([vj,Aj],(e,t)=>({isActive:e.active&&null!=t,activeIndex:t})),Tj=(e,t,n,r,i,a,o)=>{if(e&&r&&i&&a&&n){var s=hk(e,n);if(s){var l=((e,t)=>"centric"===t?e.angle:e.radius)(s,t),c=dj(l,o,a,r,i),u=((e,t,n,r)=>{var i=t.find(e=>e&&e.index===n);if(i){if("centric"===e){var a=i.coordinate,{radius:o}=r;return cj(cj(cj({},r),lk(r.cx,r.cy,o,a)),{},{angle:a,radius:o})}var s=i.coordinate,{angle:l}=r;return cj(cj(cj({},r),lk(r.cx,r.cy,s,l)),{},{angle:l,radius:s})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}})(t,a,c,s);return{activeIndex:String(c),activeCoordinate:u}}}},Cj=eS([(e,t)=>t,uT,zk,Kk,GO,$O,gj,QS],(e,t,n,r,i,a,o,s)=>{if(e&&t&&r&&i&&a)return"horizontal"===t||"vertical"===t?((e,t,n,r,i,a,o)=>{if(e&&n&&r&&i&&function(e,t){var{chartX:n,chartY:r}=e;return n>=t.left&&n<=t.left+t.width&&r>=t.top&&r<=t.top+t.height}(e,o)){var s=((e,t)=>"horizontal"===t?e.chartX:"vertical"===t?e.chartY:void 0)(e,t),l=dj(s,a,i,n,r),c=((e,t,n,r)=>{var i=t.find(e=>e&&e.index===n);if(i){if("horizontal"===e)return{x:i.coordinate,y:r.chartY};if("vertical"===e)return{x:r.chartX,y:i.coordinate}}return{x:0,y:0}})(t,i,l,e);return{activeIndex:String(l),activeCoordinate:c}}})(e,t,r,i,a,o,s):Tj(e,t,n,r,i,a,o)}),Mj=e=>{var t=e.currentTarget.getBoundingClientRect(),n=t.width/e.currentTarget.offsetWidth,r=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/n),chartY:Math.round((e.clientY-t.top)/r)}},Ej=yx("mouseClick"),Pj=p_();Pj.startListening({actionCreator:Ej,effect:(e,t)=>{var n=e.payload,r=Cj(t.getState(),Mj(n));null!=(null===r||void 0===r?void 0:r.activeIndex)&&t.dispatch(Rw({activeIndex:r.activeIndex,activeDataKey:void 0,activeCoordinate:r.activeCoordinate}))}});var Nj=yx("mouseMove"),kj=p_(),Rj=null;function Lj(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":"children"===e&&"object"===typeof t&&null!==t?"<<CHILDREN>>":t}function Oj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oj(Object(n),!0).forEach(function(t){Dj(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oj(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Dj(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}kj.startListening({actionCreator:Nj,effect:(e,t)=>{var n=e.payload;null!==Rj&&cancelAnimationFrame(Rj);var r=Mj(n);Rj=requestAnimationFrame(()=>{var e=t.getState();if("axis"===ZL(e,e.tooltip.settings.shared)){var n=Cj(e,r);null!=(null===n||void 0===n?void 0:n.activeIndex)?t.dispatch(kw({activeIndex:n.activeIndex,activeDataKey:void 0,activeCoordinate:n.activeCoordinate})):t.dispatch(Pw())}Rj=null})}});var Ij=Ox({name:"cartesianAxis",initialState:{xAxis:{},yAxis:{},zAxis:{}},reducers:{addXAxis:{reducer(e,t){e.xAxis[t.payload.id]=t.payload},prepare:Sx()},replaceXAxis:{reducer(e,t){var{prev:n,next:r}=t.payload;void 0!==e.xAxis[n.id]&&(n.id!==r.id&&delete e.xAxis[n.id],e.xAxis[r.id]=r)},prepare:Sx()},removeXAxis:{reducer(e,t){delete e.xAxis[t.payload.id]},prepare:Sx()},addYAxis:{reducer(e,t){e.yAxis[t.payload.id]=t.payload},prepare:Sx()},replaceYAxis:{reducer(e,t){var{prev:n,next:r}=t.payload;void 0!==e.yAxis[n.id]&&(n.id!==r.id&&delete e.yAxis[n.id],e.yAxis[r.id]=r)},prepare:Sx()},removeYAxis:{reducer(e,t){delete e.yAxis[t.payload.id]},prepare:Sx()},addZAxis:{reducer(e,t){e.zAxis[t.payload.id]=t.payload},prepare:Sx()},replaceZAxis:{reducer(e,t){var{prev:n,next:r}=t.payload;void 0!==e.zAxis[n.id]&&(n.id!==r.id&&delete e.zAxis[n.id],e.zAxis[r.id]=r)},prepare:Sx()},removeZAxis:{reducer(e,t){delete e.zAxis[t.payload.id]},prepare:Sx()},updateYAxisWidth(e,t){var{id:n,width:r}=t.payload,i=e.yAxis[n];if(i){var a=i.widthHistory||[];if(3===a.length&&a[0]===a[2]&&r===a[1]&&r!==i.width&&Math.abs(r-a[0])<=1)return;var o=[...a,r].slice(-3);e.yAxis[n]=jj(jj({},e.yAxis[n]),{},{width:r,widthHistory:o})}}}}),{addXAxis:Bj,replaceXAxis:Fj,removeXAxis:zj,addYAxis:Uj,replaceYAxis:Vj,removeYAxis:Gj,addZAxis:qj,replaceZAxis:Wj,removeZAxis:Hj,updateYAxisWidth:$j}=Ij.actions,Kj=Ij.reducer,Xj=Ox({name:"graphicalItems",initialState:{cartesianItems:[],polarItems:[]},reducers:{addCartesianGraphicalItem:{reducer(e,t){e.cartesianItems.push(t.payload)},prepare:Sx()},replaceCartesianGraphicalItem:{reducer(e,t){var{prev:n,next:r}=t.payload,i=nx(e).cartesianItems.indexOf(n);i>-1&&(e.cartesianItems[i]=r)},prepare:Sx()},removeCartesianGraphicalItem:{reducer(e,t){var n=nx(e).cartesianItems.indexOf(t.payload);n>-1&&e.cartesianItems.splice(n,1)},prepare:Sx()},addPolarGraphicalItem:{reducer(e,t){e.polarItems.push(t.payload)},prepare:Sx()},removePolarGraphicalItem:{reducer(e,t){var n=nx(e).polarItems.indexOf(t.payload);n>-1&&e.polarItems.splice(n,1)},prepare:Sx()}}}),{addCartesianGraphicalItem:Yj,replaceCartesianGraphicalItem:Qj,removeCartesianGraphicalItem:Zj,addPolarGraphicalItem:Jj,removePolarGraphicalItem:eD}=Xj.actions,tD=Xj.reducer,nD=Ox({name:"referenceElements",initialState:{dots:[],areas:[],lines:[]},reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var n=nx(e).dots.findIndex(e=>e===t.payload);-1!==n&&e.dots.splice(n,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var n=nx(e).areas.findIndex(e=>e===t.payload);-1!==n&&e.areas.splice(n,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var n=nx(e).lines.findIndex(e=>e===t.payload);-1!==n&&e.lines.splice(n,1)}}}),{addDot:rD,removeDot:iD,addArea:aD,removeArea:oD,addLine:sD,removeLine:lD}=nD.actions,cD=nD.reducer,uD={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},dD=Ox({name:"brush",initialState:uD,reducers:{setBrushSettings(e,t){return null==t.payload?uD:t.payload}}}),{setBrushSettings:hD}=dD.actions,pD=dD.reducer,fD=Ox({name:"legend",initialState:{settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload:{reducer(e,t){e.payload.push(t.payload)},prepare:Sx()},replaceLegendPayload:{reducer(e,t){var{prev:n,next:r}=t.payload,i=nx(e).payload.indexOf(n);i>-1&&(e.payload[i]=r)},prepare:Sx()},removeLegendPayload:{reducer(e,t){var n=nx(e).payload.indexOf(t.payload);n>-1&&e.payload.splice(n,1)},prepare:Sx()}}}),{setLegendSize:mD,setLegendSettings:gD,addLegendPayload:vD,replaceLegendPayload:AD,removeLegendPayload:yD}=fD.actions,bD=fD.reducer,xD={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0,reverseStackOrder:!1},_D=Ox({name:"rootProps",initialState:xD,reducers:{updateOptions:(e,t)=>{var n;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=null!==(n=t.payload.barGap)&&void 0!==n?n:xD.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className,e.baseValue=t.payload.baseValue,e.reverseStackOrder=t.payload.reverseStackOrder}}}),wD=_D.reducer,{updateOptions:SD}=_D.actions,TD=Ox({name:"polarAxis",initialState:{radiusAxis:{},angleAxis:{}},reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:CD,removeRadiusAxis:MD,addAngleAxis:ED,removeAngleAxis:PD}=TD.actions,ND=TD.reducer,kD=Ox({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:RD}=kD.actions,LD=kD.reducer,OD=yx("keyDown"),jD=yx("focus"),DD=p_();DD.startListening({actionCreator:OD,effect:(e,t)=>{var n=t.getState();if(!1!==n.rootProps.accessibilityLayer){var{keyboardInteraction:r}=n.tooltip,i=e.payload;if("ArrowRight"===i||"ArrowLeft"===i||"Enter"===i){var a=aO(r,bO(n),NR(n),FO(n)),o=null==a?-1:Number(a);if(Number.isFinite(o)&&!(o<0)){var s=$O(n);if("Enter"!==i){var l=o+("ArrowRight"===i?1:-1)*("left-to-right"===KL(n)?1:-1);if(!(null==s||l>=s.length||l<0)){var c=bj(n,"axis","hover",String(l));t.dispatch(Ow({active:!0,activeIndex:l.toString(),activeDataKey:void 0,activeCoordinate:c}))}}else{var u=bj(n,"axis","hover",String(r.index));t.dispatch(Ow({active:!r.active,activeIndex:r.index,activeDataKey:r.dataKey,activeCoordinate:u}))}}}}}}),DD.startListening({actionCreator:jD,effect:(e,t)=>{var n=t.getState();if(!1!==n.rootProps.accessibilityLayer){var{keyboardInteraction:r}=n.tooltip;if(!r.active&&null==r.index){var i=bj(n,"axis","hover",String("0"));t.dispatch(Ow({activeDataKey:void 0,active:!0,activeIndex:"0",activeCoordinate:i}))}}}});var ID=yx("externalEvent"),BD=p_(),FD=new Map;BD.startListening({actionCreator:ID,effect:(e,t)=>{var{handler:n,reactEvent:r}=e.payload;if(null!=n){r.persist();var i=r.type,a=FD.get(i);void 0!==a&&cancelAnimationFrame(a);var o=requestAnimationFrame(()=>{try{var e=t.getState(),a={activeCoordinate:ij(e),activeDataKey:ej(e),activeIndex:ZO(e),activeLabel:JO(e),activeTooltipIndex:ZO(e),isTooltipActive:aj(e)};n(a,r)}finally{FD.delete(i)}});FD.set(i,o)}}});var zD=eS([cO],e=>e.tooltipItemPayloads),UD=eS([zD,lO,(e,t,n)=>t,(e,t,n)=>n],(e,t,n,r)=>{var i=e.find(e=>e.settings.dataKey===r);if(null!=i){var{positions:a}=i;if(null!=a)return t(a,n)}}),VD=yx("touchMove"),GD=p_();GD.startListening({actionCreator:VD,effect:(e,t)=>{var n=e.payload;if(null!=n.touches&&0!==n.touches.length){var r=t.getState(),i=ZL(r,r.tooltip.settings.shared);if("axis"===i){var a=Cj(r,Mj({clientX:n.touches[0].clientX,clientY:n.touches[0].clientY,currentTarget:n.currentTarget}));null!=(null===a||void 0===a?void 0:a.activeIndex)&&t.dispatch(kw({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate}))}else if("item"===i){var o,s=n.touches[0];if(null==document.elementFromPoint)return;var l=document.elementFromPoint(s.clientX,s.clientY);if(!l||!l.getAttribute)return;var c=l.getAttribute(HS),u=null!==(o=l.getAttribute($S))&&void 0!==o?o:void 0,d=UD(t.getState(),c,u);t.dispatch(Mw({activeDataKey:u,activeIndex:c,activeCoordinate:d}))}}}});var qD=Ox({name:"errorBars",initialState:{},reducers:{addErrorBar:(e,t)=>{var{itemId:n,errorBar:r}=t.payload;e[n]||(e[n]=[]),e[n].push(r)},replaceErrorBar:(e,t)=>{var{itemId:n,prev:r,next:i}=t.payload;e[n]&&(e[n]=e[n].map(e=>e.dataKey===r.dataKey&&e.direction===r.direction?i:e))},removeErrorBar:(e,t)=>{var{itemId:n,errorBar:r}=t.payload;e[n]&&(e[n]=e[n].filter(e=>e.dataKey!==r.dataKey||e.direction!==r.direction))}}}),{addErrorBar:WD,replaceErrorBar:HD,removeErrorBar:$D}=qD.actions,KD=qD.reducer,XD=!1,YD=!("undefined"!==typeof window&&window.document&&Boolean(window.document.createElement)&&window.setTimeout);function QD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ZD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QD(Object(n),!0).forEach(function(t){JD(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QD(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function JD(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eI={zIndexMap:Object.values(pk).reduce((e,t)=>ZD(ZD({},e),{},{[t]:{elementId:void 0,panoramaElementId:void 0,consumers:0}}),{})},tI=new Set(Object.values(pk));var nI=Ox({name:"zIndex",initialState:eI,reducers:{registerZIndexPortal:{reducer:(e,t)=>{var{zIndex:n}=t.payload;e.zIndexMap[n]?e.zIndexMap[n].consumers+=1:e.zIndexMap[n]={consumers:1,elementId:void 0,panoramaElementId:void 0}},prepare:Sx()},unregisterZIndexPortal:{reducer:(e,t)=>{var{zIndex:n}=t.payload;e.zIndexMap[n]&&(e.zIndexMap[n].consumers-=1,e.zIndexMap[n].consumers<=0&&!function(e){return tI.has(e)}(n)&&delete e.zIndexMap[n])},prepare:Sx()},registerZIndexPortalId:{reducer:(e,t)=>{var{zIndex:n,elementId:r,isPanorama:i}=t.payload;e.zIndexMap[n]?i?e.zIndexMap[n].panoramaElementId=r:e.zIndexMap[n].elementId=r:e.zIndexMap[n]={consumers:0,elementId:i?void 0:r,panoramaElementId:i?r:void 0}},prepare:Sx()},unregisterZIndexPortalId:{reducer:(e,t)=>{var{zIndex:n}=t.payload;e.zIndexMap[n]&&(t.payload.isPanorama?e.zIndexMap[n].panoramaElementId=void 0:e.zIndexMap[n].elementId=void 0)},prepare:Sx()}}}),{registerZIndexPortal:rI,unregisterZIndexPortal:iI,registerZIndexPortalId:aI,unregisterZIndexPortalId:oI}=nI.actions,sI=hx({brush:pD,cartesianAxis:Kj,chartData:zw,errorBars:KD,graphicalItems:tD,layout:Hw,legend:bD,options:v_,polarAxis:ND,polarOptions:LD,referenceElements:cD,rootProps:wD,tooltip:jw,zIndex:nI.reducer});function lI(e){var{preloadedState:t,children:n,reduxStoreName:i}=e,a=tT(),o=(0,r.useRef)(null);if(a)return n;null==o.current&&(o.current=function(e){return Mx({reducer:sI,preloadedState:e,middleware:e=>e({serializableCheck:!1,immutableCheck:!["commonjs","es6","production"].includes("es6")}).concat([Pj.middleware,kj.middleware,DD.middleware,BD.middleware,GD.middleware]),enhancers:e=>{var t=e;return"function"===typeof e&&(t=e()),t.concat(Cx({type:"raf"}))},devTools:XD&&{serialize:{replacer:Lj},name:"recharts-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart")}})}(t,i));var s=rS;return r.createElement(k_,{context:s,store:o.current},n)}var cI=e=>{var{chartData:t}=e,n=aS(),i=tT();return(0,r.useEffect)(()=>i?()=>{}:(n(Iw(t)),()=>{n(Iw(void 0))}),[t,n,i]),null},uI=new Set(["axisLine","tickLine","activeBar","activeDot","activeLabel","activeShape","allowEscapeViewBox","background","cursor","dot","label","line","margin","padding","position","shape","style","tick","wrapperStyle"]);function dI(e,t){return null==e&&null==t||("number"===typeof e&&"number"===typeof t?e===t||e!==e&&t!==t:e===t)}function hI(e,t){var n=new Set([...Object.keys(e),...Object.keys(t)]);for(var r of n)if(uI.has(r)){if(null==e[r]&&null==t[r])continue;if(!C_(e[r],t[r]))return!1}else if(!dI(e[r],t[r]))return!1;return!0}function pI(e){var{layout:t,margin:n}=e,i=aS(),a=tT();return(0,r.useEffect)(()=>{a||(i(Gw(t)),i(Vw(n)))},[i,a,t,n]),null}var fI=(0,r.memo)(pI,hI);function mI(e){var t=aS();return(0,r.useEffect)(()=>{t(SD(e))},[t,e]),null}var gI=()=>{var e;return null===(e=cS(e=>e.rootProps.accessibilityLayer))||void 0===e||e},vI=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function AI(e){return"string"===typeof e&&vI.includes(e)}var yI=new Set(["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"]);function bI(e){return"string"===typeof e&&yI.has(e)}function xI(e){return"string"===typeof e&&e.startsWith("data-")}function _I(e){if("object"!==typeof e||null===e)return{};var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(bI(n)||xI(n))&&(t[n]=e[n]);return t}function wI(e){return null==e?null:(0,r.isValidElement)(e)&&"object"===typeof e.props&&null!==e.props?_I(e.props):"object"!==typeof e||Array.isArray(e)?null:_I(e)}function SI(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(bI(n)||xI(n)||AI(n))&&(t[n]=e[n]);return t}var TI=["children","width","height","viewBox","className","style","title","desc"];function CI(){return CI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},CI.apply(null,arguments)}var MI,EI=(0,r.forwardRef)((e,t)=>{var{children:n,width:i,height:a,viewBox:o,className:s,style:l,title:c,desc:u}=e,d=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,TI),h=o||{width:i,height:a,x:0,y:0},p=(0,hy.$)("recharts-surface",s);return r.createElement("svg",CI({},SI(d),{className:p,width:i,height:a,style:l,viewBox:"".concat(h.x," ").concat(h.y," ").concat(h.width," ").concat(h.height),ref:t}),r.createElement("title",null,c),r.createElement("desc",null,u),n)}),PI=null!==(MI=i["useId".toString()])&&void 0!==MI?MI:()=>{var[e]=r.useState(()=>wy("uid-"));return e};function NI(e,t){var n=PI();return t||(e?"".concat(e,"-").concat(n):n)}var kI=eS(e=>e.zIndex.zIndexMap,(e,t)=>t,(e,t,n)=>n,(e,t,n)=>{if(null!=t){var r=e[t];if(null!=r)return n?r.panoramaElementId:r.elementId}}),RI=eS(e=>e.zIndex.zIndexMap,e=>{var t=Object.keys(e).map(e=>parseInt(e,10)).concat(Object.values(pk));return Array.from(new Set(t)).sort((e,t)=>e-t)},{memoizeOptions:{resultEqualityCheck:function(e,t){if(e.length===t.length){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}}});function LI(e){var{zIndex:t,isPanorama:n}=e,i=NI("".concat(n?"recharts-zindex-panorama-":"recharts-zindex-").concat(t)),a=aS();return(0,r.useLayoutEffect)(()=>(a(aI({zIndex:t,elementId:i,isPanorama:n})),()=>{a(oI({zIndex:t,isPanorama:n}))}),[a,t,i,n]),r.createElement("g",{tabIndex:-1,id:i})}function OI(e){var{children:t,isPanorama:n}=e,i=cS(RI);if(!i||0===i.length)return t;var a=i.filter(e=>e<0),o=i.filter(e=>e>0);return r.createElement(r.Fragment,null,a.map(e=>r.createElement(LI,{key:e,zIndex:e,isPanorama:n})),t,o.map(e=>r.createElement(LI,{key:e,zIndex:e,isPanorama:n})))}var jI=["children"];function DI(){return DI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},DI.apply(null,arguments)}var II={width:"100%",height:"100%",display:"block"},BI=(0,r.forwardRef)((e,t)=>{var n=lT(),i=cT(),a=gI();if(!zy(n)||!zy(i))return null;var o,s,{children:l,otherAttributes:c,title:u,desc:d}=e;return null!=c&&(o="number"===typeof c.tabIndex?c.tabIndex:a?0:void 0,s="string"===typeof c.role?c.role:a?"application":void 0),r.createElement(EI,DI({},c,{title:u,desc:d,role:s,tabIndex:o,width:n,height:i,style:II,ref:t}),l)}),FI=e=>{var{children:t}=e,n=cS(rT);if(!n)return null;var{width:i,height:a,y:o,x:s}=n;return r.createElement(EI,{width:i,height:a,x:s,y:o},t)},zI=(0,r.forwardRef)((e,t)=>{var{children:n}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,jI);return tT()?r.createElement(FI,null,r.createElement(OI,{isPanorama:!0},n)):r.createElement(BI,DI({ref:t},i),r.createElement(OI,{isPanorama:!1},n))}),UI=new(n(8499)),VI="recharts.syncEvent.tooltip",GI="recharts.syncEvent.brush";function qI(e){return e.tooltip.syncInteraction}var WI=["x","y"];function HI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HI(Object(n),!0).forEach(function(t){KI(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HI(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function KI(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XI(){var e=cS(ek),t=cS(nk),n=aS(),i=cS(tk),a=cS($O),o=dT(),s=aT(),l=cS(e=>e.rootProps.className);(0,r.useEffect)(()=>{if(null==e)return ky;var r=(r,l,c)=>{var u;if(t!==c&&e===r)if("index"!==i){if(null!=a){var d;if("function"===typeof i){var h={activeTooltipIndex:null==l.payload.index?void 0:Number(l.payload.index),isTooltipActive:l.payload.active,activeIndex:null==l.payload.index?void 0:Number(l.payload.index),activeLabel:l.payload.label,activeDataKey:l.payload.dataKey,activeCoordinate:l.payload.coordinate},p=i(a,h);d=a[p]}else"value"===i&&(d=a.find(e=>String(e.value)===l.payload.label));var{coordinate:f}=l.payload;if(null!=d&&!1!==l.payload.active&&null!=f&&null!=s){var{x:m,y:g}=f,v=Math.min(m,s.x+s.width),A=Math.min(g,s.y+s.height),y={x:"horizontal"===o?d.coordinate:v,y:"horizontal"===o?A:d.coordinate},b=Lw({active:l.payload.active,coordinate:y,dataKey:l.payload.dataKey,index:String(d.index),label:l.payload.label,sourceViewBox:l.payload.sourceViewBox,graphicalItemId:l.payload.graphicalItemId});n(b)}else n(Lw({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0,graphicalItemId:void 0}))}}else if(s&&null!==l&&void 0!==l&&null!==(u=l.payload)&&void 0!==u&&u.coordinate&&l.payload.sourceViewBox){var x=l.payload.coordinate,{x:_,y:w}=x,S=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(x,WI),{x:T,y:C,width:M,height:E}=l.payload.sourceViewBox,P=$I($I({},S),{},{x:s.x+(M?(_-T)/M:0)*s.width,y:s.y+(E?(w-C)/E:0)*s.height});n($I($I({},l),{},{payload:$I($I({},l.payload),{},{coordinate:P})}))}else n(l)};return UI.on(VI,r),()=>{UI.off(VI,r)}},[l,n,t,e,i,a,o,s])}function YI(){var e=aS();(0,r.useEffect)(()=>{e(A_())},[e]),XI(),function(){var e=cS(ek),t=cS(nk),n=aS();(0,r.useEffect)(()=>{if(null==e)return ky;var r=(r,i,a)=>{t!==a&&e===r&&n(Bw(i))};return UI.on(GI,r),()=>{UI.off(GI,r)}},[n,t,e])}()}function QI(e,t,n,i,a,o){var s=cS(n=>((e,t,n)=>{if(null!=t){var r=cO(e);return"axis"===t?"hover"===n?r.axisInteraction.hover.dataKey:r.axisInteraction.click.dataKey:"hover"===n?r.itemInteraction.hover.dataKey:r.itemInteraction.click.dataKey}})(n,e,t)),l=cS(nk),c=cS(ek),u=cS(tk),d=cS(qI),h=null===d||void 0===d?void 0:d.active,p=aT();(0,r.useEffect)(()=>{if(!h&&null!=c&&null!=l){var e=Lw({active:o,coordinate:n,dataKey:s,index:a,label:"number"===typeof i?String(i):i,sourceViewBox:p,graphicalItemId:void 0});UI.emit(VI,c,e,l)}},[h,n,s,a,i,l,c,u,o,p])}var ZI=(0,r.createContext)(null),JI=(0,r.createContext)(null);function eB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eB(Object(n),!0).forEach(function(t){nB(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nB(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rB(){return rB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rB.apply(null,arguments)}var iB=()=>(YI(),null);function aB(e){if("number"===typeof e)return e;if("string"===typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return 0}var oB=(0,r.forwardRef)((e,t)=>{var n,i,a=(0,r.useRef)(null),[o,s]=(0,r.useState)({containerWidth:aB(null===(n=e.style)||void 0===n?void 0:n.width),containerHeight:aB(null===(i=e.style)||void 0===i?void 0:i.height)}),l=(0,r.useCallback)((e,t)=>{s(n=>{var r=Math.round(e),i=Math.round(t);return n.containerWidth===r&&n.containerHeight===i?n:{containerWidth:r,containerHeight:i}})},[]),c=(0,r.useCallback)(e=>{if("function"===typeof t&&t(e),null!=e&&"undefined"!==typeof ResizeObserver){var{width:n,height:r}=e.getBoundingClientRect();l(n,r);var i=new ResizeObserver(e=>{var{width:t,height:n}=e[0].contentRect;l(t,n)});i.observe(e),a.current=i}},[t,l]);return(0,r.useEffect)(()=>()=>{var e=a.current;null!=e&&e.disconnect()},[l]),r.createElement(r.Fragment,null,r.createElement(hT,{width:o.containerWidth,height:o.containerHeight}),r.createElement("div",rB({ref:c},e)))}),sB=(0,r.forwardRef)((e,t)=>{var{width:n,height:i}=e,[a,o]=(0,r.useState)({containerWidth:aB(n),containerHeight:aB(i)}),s=(0,r.useCallback)((e,t)=>{o(n=>{var r=Math.round(e),i=Math.round(t);return n.containerWidth===r&&n.containerHeight===i?n:{containerWidth:r,containerHeight:i}})},[]),l=(0,r.useCallback)(e=>{if("function"===typeof t&&t(e),null!=e){var{width:n,height:r}=e.getBoundingClientRect();s(n,r)}},[t,s]);return r.createElement(r.Fragment,null,r.createElement(hT,{width:a.containerWidth,height:a.containerHeight}),r.createElement("div",rB({ref:l},e)))}),lB=(0,r.forwardRef)((e,t)=>{var{width:n,height:i}=e;return r.createElement(r.Fragment,null,r.createElement(hT,{width:n,height:i}),r.createElement("div",rB({ref:t},e)))}),cB=(0,r.forwardRef)((e,t)=>{var{width:n,height:i}=e;return yy(n)||yy(i)?r.createElement(sB,rB({},e,{ref:t})):r.createElement(lB,rB({},e,{ref:t}))});var uB=(0,r.forwardRef)((e,t)=>{var{children:n,className:i,height:a,onClick:o,onContextMenu:s,onDoubleClick:l,onMouseDown:c,onMouseEnter:u,onMouseLeave:d,onMouseMove:h,onMouseUp:p,onTouchEnd:f,onTouchMove:m,onTouchStart:g,style:v,width:A,responsive:y,dispatchTouchEvents:b=!0}=e,x=(0,r.useRef)(null),_=aS(),[w,S]=(0,r.useState)(null),[T,C]=(0,r.useState)(null),M=function(){var e=aS(),[t,n]=(0,r.useState)(null),i=cS(VS);return(0,r.useEffect)(()=>{if(null!=t){var n=t.getBoundingClientRect().width/t.offsetWidth;Fy(n)&&n!==i&&e(Ww(n))}},[t,e,i]),n}(),E=$y(),P=(null===E||void 0===E?void 0:E.width)>0?E.width:A,N=(null===E||void 0===E?void 0:E.height)>0?E.height:a,k=(0,r.useCallback)(e=>{M(e),"function"===typeof t&&t(e),S(e),C(e),null!=e&&(x.current=e)},[M,t,S,C]),R=(0,r.useCallback)(e=>{_(Ej(e)),_(ID({handler:o,reactEvent:e}))},[_,o]),L=(0,r.useCallback)(e=>{_(Nj(e)),_(ID({handler:u,reactEvent:e}))},[_,u]),O=(0,r.useCallback)(e=>{_(Pw()),_(ID({handler:d,reactEvent:e}))},[_,d]),j=(0,r.useCallback)(e=>{_(Nj(e)),_(ID({handler:h,reactEvent:e}))},[_,h]),D=(0,r.useCallback)(()=>{_(jD())},[_]),I=(0,r.useCallback)(e=>{_(OD(e.key))},[_]),B=(0,r.useCallback)(e=>{_(ID({handler:s,reactEvent:e}))},[_,s]),F=(0,r.useCallback)(e=>{_(ID({handler:l,reactEvent:e}))},[_,l]),z=(0,r.useCallback)(e=>{_(ID({handler:c,reactEvent:e}))},[_,c]),U=(0,r.useCallback)(e=>{_(ID({handler:p,reactEvent:e}))},[_,p]),V=(0,r.useCallback)(e=>{_(ID({handler:g,reactEvent:e}))},[_,g]),G=(0,r.useCallback)(e=>{b&&_(VD(e)),_(ID({handler:m,reactEvent:e}))},[_,b,m]),q=(0,r.useCallback)(e=>{_(ID({handler:f,reactEvent:e}))},[_,f]),W=function(e){return!0===e?oB:cB}(y);return r.createElement(ZI.Provider,{value:w},r.createElement(JI.Provider,{value:T},r.createElement(W,{width:null!==P&&void 0!==P?P:null===v||void 0===v?void 0:v.width,height:null!==N&&void 0!==N?N:null===v||void 0===v?void 0:v.height,className:(0,hy.$)("recharts-wrapper",i),style:tB({position:"relative",cursor:"default",width:P,height:N},v),onClick:R,onContextMenu:B,onDoubleClick:F,onFocus:D,onKeyDown:I,onMouseDown:z,onMouseEnter:L,onMouseLeave:O,onMouseMove:j,onMouseUp:U,onTouchEnd:q,onTouchMove:G,onTouchStart:V,ref:k},r.createElement(iB,null),n)))}),dB=eS([QS],e=>({top:e.top,bottom:e.bottom,left:e.left,right:e.right})),hB=eS([dB,zS,US],(e,t,n)=>{if(e&&null!=t&&null!=n)return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,n-e.top-e.bottom)}}),pB=()=>cS(hB),fB=(0,r.createContext)(void 0),mB=e=>{var{children:t}=e,[n]=(0,r.useState)("".concat(wy("recharts"),"-clip")),i=pB();if(null==i)return null;var{x:a,y:o,width:s,height:l}=i;return r.createElement(fB.Provider,{value:n},r.createElement("defs",null,r.createElement("clipPath",{id:n},r.createElement("rect",{x:a,y:o,height:l,width:s}))),t)},gB=["width","height","responsive","children","className","style","compact","title","desc"];var vB=(0,r.forwardRef)((e,t)=>{var{width:n,height:i,responsive:a,children:o,className:s,style:l,compact:c,title:u,desc:d}=e,h=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,gB),p=_I(h);return c?r.createElement(r.Fragment,null,r.createElement(hT,{width:n,height:i}),r.createElement(zI,{otherAttributes:p,title:u,desc:d},o)):r.createElement(uB,{className:s,style:l,width:n,height:i,responsive:null!==a&&void 0!==a&&a,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},r.createElement(zI,{otherAttributes:p,title:u,desc:d,ref:t},r.createElement(mB,null,o)))});function AB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function yB(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bB(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AB(Object(n),!0).forEach(function(t){yB(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e),r=t;return Object.keys(t).reduce((e,t)=>(void 0===e[t]&&void 0!==r[t]&&(e[t]=r[t]),e),n)}function xB(){return xB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xB.apply(null,arguments)}var _B={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,layout:"horizontal",margin:{top:5,right:5,bottom:5,left:5},responsive:!1,reverseStackOrder:!1,stackOffset:"none",syncMethod:"index"},wB=(0,r.forwardRef)(function(e,t){var n,i=bB(e.categoricalChartProps,_B),{chartName:a,defaultTooltipEventType:o,validateTooltipEventTypes:s,tooltipPayloadSearcher:l,categoricalChartProps:c}=e,u={chartName:a,defaultTooltipEventType:o,validateTooltipEventTypes:s,tooltipPayloadSearcher:l,eventEmitter:void 0};return r.createElement(lI,{preloadedState:{options:u},reduxStoreName:null!==(n=c.id)&&void 0!==n?n:a},r.createElement(cI,{chartData:c.data}),r.createElement(fI,{layout:i.layout,margin:i.margin}),r.createElement(mI,{baseValue:i.baseValue,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),r.createElement(vB,xB({},i,{ref:t})))}),SB=["axis"],TB=(0,r.forwardRef)((e,t)=>r.createElement(wB,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:SB,tooltipPayloadSearcher:m_,categoricalChartProps:e,ref:t}));function CB(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function EB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?MB(Object(n),!0).forEach(function(t){PB(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function PB(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var NB=EB({},{cacheSize:2e3,enableCache:!0}),kB=new class{constructor(e){CB(this,"cache",new Map),this.maxSize=e}get(e){var t=this.cache.get(e);return void 0!==t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var n=this.cache.keys().next().value;null!=n&&this.cache.delete(n)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}}(NB.cacheSize),RB={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},LB="recharts_measurement_span";var OB=(e,t)=>{try{var n=document.getElementById(LB);n||((n=document.createElement("span")).setAttribute("id",LB),n.setAttribute("aria-hidden","true"),document.body.appendChild(n)),Object.assign(n.style,RB,t),n.textContent="".concat(e);var r=n.getBoundingClientRect();return{width:r.width,height:r.height}}catch(i){return{width:0,height:0}}},jB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e||null===e||YD)return{width:0,height:0};if(!NB.enableCache)return OB(e,t);var n=function(e,t){var n=t.fontSize||"",r=t.fontFamily||"",i=t.fontWeight||"",a=t.fontStyle||"",o=t.letterSpacing||"",s=t.textTransform||"";return"".concat(e,"|").concat(n,"|").concat(r,"|").concat(i,"|").concat(a,"|").concat(o,"|").concat(s)}(e,t),r=kB.get(n);if(r)return r;var i=OB(e,t);return kB.set(n,i),i};function DB(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class IB{static create(e){return new IB(e)}constructor(e){this.scale=e}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(e){var{bandAware:t,position:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==e){if(n)switch(n){case"start":default:return this.scale(e);case"middle":var r=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+r;case"end":var i=this.bandwidth?this.bandwidth():0;return this.scale(e)+i}if(t){var a=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+a}return this.scale(e)}}isInRange(e){var t=this.range(),n=t[0],r=t[t.length-1];return n<=r?e>=n&&e<=r:e>=r&&e<=n}}DB(IB,"EPS",1e-4);function BB(e,t){if(t<1)return[];if(1===t)return e;for(var n=[],r=0;r<e.length;r+=t)n.push(e[r]);return n}function FB(e,t,n){return function(e){var{width:t,height:n}=e,r=function(e){return(e%180+180)%180}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),i=r*Math.PI/180,a=Math.atan(n/t),o=i>a&&i<Math.PI-a?n/Math.sin(i):t/Math.cos(i);return Math.abs(o)}({width:e.width+t.width,height:e.height+t.height},n)}function zB(e,t,n,r,i){if(e*t<e*r||e*t>e*i)return!1;var a=n();return e*(t-e*a/2-r)>=0&&e*(t+e*a/2-i)<=0}function UB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function VB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UB(Object(n),!0).forEach(function(t){GB(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function GB(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qB(e,t,n){var r,{tick:i,ticks:a,viewBox:o,minTickGap:s,orientation:l,interval:c,tickFormatter:u,unit:d,angle:h}=e;if(!a||!a.length||!i)return[];if(by(c)||YD)return null!==(r=function(e,t){return BB(e,t+1)}(a,by(c)?c:0))&&void 0!==r?r:[];var p=[],f="top"===l||"bottom"===l?"width":"height",m=d&&"width"===f?jB(d,{fontSize:t,letterSpacing:n}):{width:0,height:0},g=(e,r)=>{var i="function"===typeof u?u(e.value,r):e.value;return"width"===f?FB(jB(i,{fontSize:t,letterSpacing:n}),m,h):jB(i,{fontSize:t,letterSpacing:n})[f]},v=a.length>=2?vy(a[1].coordinate-a[0].coordinate):1,A=function(e,t,n){var r="width"===n,{x:i,y:a,width:o,height:s}=e;return 1===t?{start:r?i:a,end:r?i+o:a+s}:{start:r?i+o:a+s,end:r?i:a}}(o,v,f);return"equidistantPreserveStart"===c?function(e,t,n,r,i){for(var a,o=(r||[]).slice(),{start:s,end:l}=t,c=0,u=1,d=s,h=function(){var t=null===r||void 0===r?void 0:r[c];if(void 0===t)return{v:BB(r,u)};var a,o=c,h=()=>(void 0===a&&(a=n(t,o)),a),p=t.coordinate,f=0===c||zB(e,p,h,d,l);f||(c=0,d=s,u+=1),f&&(d=p+e*(h()/2+i),c+=u)};u<=o.length;)if(a=h())return a.v;return[]}(v,A,g,a,s):(p="preserveStart"===c||"preserveStartEnd"===c?function(e,t,n,r,i,a){var o=(r||[]).slice(),s=o.length,{start:l,end:c}=t;if(a){var u=r[s-1],d=n(u,s-1),h=e*(u.coordinate+e*d/2-c);o[s-1]=u=VB(VB({},u),{},{tickCoord:h>0?u.coordinate-h*e:u.coordinate}),null!=u.tickCoord&&zB(e,u.tickCoord,()=>d,l,c)&&(c=u.tickCoord-e*(d/2+i),o[s-1]=VB(VB({},u),{},{isShow:!0}))}for(var p=a?s-1:s,f=function(t){var r,a=o[t],s=()=>(void 0===r&&(r=n(a,t)),r);if(0===t){var u=e*(a.coordinate-e*s()/2-l);o[t]=a=VB(VB({},a),{},{tickCoord:u<0?a.coordinate-u*e:a.coordinate})}else o[t]=a=VB(VB({},a),{},{tickCoord:a.coordinate});null!=a.tickCoord&&zB(e,a.tickCoord,s,l,c)&&(l=a.tickCoord+e*(s()/2+i),o[t]=VB(VB({},a),{},{isShow:!0}))},m=0;m<p;m++)f(m);return o}(v,A,g,a,s,"preserveStartEnd"===c):function(e,t,n,r,i){for(var a=(r||[]).slice(),o=a.length,{start:s}=t,{end:l}=t,c=function(t){var r,c=a[t],u=()=>(void 0===r&&(r=n(c,t)),r);if(t===o-1){var d=e*(c.coordinate+e*u()/2-l);a[t]=c=VB(VB({},c),{},{tickCoord:d>0?c.coordinate-d*e:c.coordinate})}else a[t]=c=VB(VB({},c),{},{tickCoord:c.coordinate});null!=c.tickCoord&&zB(e,c.tickCoord,u,s,l)&&(l=c.tickCoord-e*(u()/2+i),a[t]=VB(VB({},c),{},{isShow:!0}))},u=o-1;u>=0;u--)c(u);return a}(v,A,g,a,s),p.filter(e=>e.isShow))}var WB=["children","className"];function HB(){return HB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},HB.apply(null,arguments)}var $B=r.forwardRef((e,t)=>{var{children:n,className:i}=e,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,WB),o=(0,hy.$)("recharts-layer",i);return r.createElement("g",HB({className:o},SI(a),{ref:t}),n)}),KB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,XB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,YB=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,QB=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,ZB={cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,in:96,Q:96/101.6,px:1},JB=Object.keys(ZB),eF="NaN";class tF{static parse(e){var t,[,n,r]=null!==(t=QB.exec(e))&&void 0!==t?t:[];return new tF(parseFloat(n),null!==r&&void 0!==r?r:"")}constructor(e,t){this.num=e,this.unit=t,this.num=e,this.unit=t,Ay(e)&&(this.unit=""),""===t||YB.test(t)||(this.num=NaN,this.unit=""),JB.includes(t)&&(this.num=function(e,t){return e*ZB[t]}(e,t),this.unit="px")}add(e){return this.unit!==e.unit?new tF(NaN,""):new tF(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new tF(NaN,""):new tF(this.num-e.num,this.unit)}multiply(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new tF(NaN,""):new tF(this.num*e.num,this.unit||e.unit)}divide(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new tF(NaN,""):new tF(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return Ay(this.num)}}function nF(e){if(e.includes(eF))return eF;for(var t=e;t.includes("*")||t.includes("/");){var n,[,r,i,a]=null!==(n=KB.exec(t))&&void 0!==n?n:[],o=tF.parse(null!==r&&void 0!==r?r:""),s=tF.parse(null!==a&&void 0!==a?a:""),l="*"===i?o.multiply(s):o.divide(s);if(l.isNaN())return eF;t=t.replace(KB,l.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var c,[,u,d,h]=null!==(c=XB.exec(t))&&void 0!==c?c:[],p=tF.parse(null!==u&&void 0!==u?u:""),f=tF.parse(null!==h&&void 0!==h?h:""),m="+"===d?p.add(f):p.subtract(f);if(m.isNaN())return eF;t=t.replace(XB,m.toString())}return t}var rF=/\(([^()]*)\)/;function iF(e){var t=e.replace(/\s+/g,"");return t=function(e){for(var t,n=e;null!=(t=rF.exec(n));){var[,r]=t;n=n.replace(rF,nF(r))}return n}(t),t=nF(t)}function aF(e){var t=function(e){try{return iF(e)}catch(t){return eF}}(e.slice(5,-1));return t===eF?"":t}var oF=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],sF=["dx","dy","angle","className","breakAll"];function lF(){return lF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lF.apply(null,arguments)}function cF(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var uF=/[ \f\n\r\t\v\u2028\u2029]+/,dF=e=>{var{children:t,breakAll:n,style:r}=e;try{var i=[];return Ey(t)||(i=n?t.toString().split(""):t.toString().split(uF)),{wordsWithComputedWidth:i.map(e=>({word:e,width:jB(e,r).width})),spaceWidth:n?0:jB("\xa0",r).width}}catch(a){return null}};function hF(e){return"start"===e||"middle"===e||"end"===e||"inherit"===e}var pF=(e,t,n,r)=>e.reduce((e,i)=>{var{word:a,width:o}=i,s=e[e.length-1];if(s&&null!=o&&(null==t||r||s.width+o+n<Number(t)))s.words.push(a),s.width+=o+n;else{var l={words:[a],width:o};e.push(l)}return e},[]),fF=e=>e.reduce((e,t)=>e.width>t.width?e:t),mF=(e,t,n,r,i,a,o,s)=>{var l=e.slice(0,t),c=dF({breakAll:n,style:r,children:l+"\u2026"});if(!c)return[!1,[]];var u=pF(c.wordsWithComputedWidth,a,o,s);return[u.length>i||fF(u).width>Number(a),u]},gF=e=>[{words:Ey(e)?[]:e.toString().split(uF),width:void 0}],vF=e=>{var{width:t,scaleToFit:n,children:r,style:i,breakAll:a,maxLines:o}=e;if((t||n)&&!YD){var s=dF({breakAll:a,children:r,style:i});if(!s)return gF(r);var{wordsWithComputedWidth:l,spaceWidth:c}=s;return((e,t,n,r,i)=>{var{maxLines:a,children:o,style:s,breakAll:l}=e,c=by(a),u=String(o),d=pF(t,r,n,i);if(!c||i)return d;if(!(d.length>a||fF(d).width>Number(r)))return d;for(var h,p=0,f=u.length-1,m=0;p<=f&&m<=u.length-1;){var g=Math.floor((p+f)/2),v=g-1,[A,y]=mF(u,v,l,s,a,r,n,i),[b]=mF(u,g,l,s,a,r,n,i);if(A||b||(p=g+1),A&&b&&(f=g-1),!A&&b){h=y;break}m++}return h||d})({breakAll:a,children:r,maxLines:o,style:i},l,c,t,Boolean(n))}return gF(r)},AF="#808080",yF={angle:0,breakAll:!1,capHeight:"0.71em",fill:AF,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},bF=(0,r.forwardRef)((e,t)=>{var n=bB(e,yF),{x:i,y:a,lineHeight:o,capHeight:s,fill:l,scaleToFit:c,textAnchor:u,verticalAnchor:d}=n,h=cF(n,oF),p=(0,r.useMemo)(()=>vF({breakAll:h.breakAll,children:h.children,maxLines:h.maxLines,scaleToFit:c,style:h.style,width:h.width}),[h.breakAll,h.children,h.maxLines,c,h.style,h.width]),{dx:f,dy:m,angle:g,className:v,breakAll:A}=h,y=cF(h,sF);if(!xy(i)||!xy(a)||0===p.length)return null;var b,x=Number(i)+(by(f)?f:0),_=Number(a)+(by(m)?m:0);if(!Fy(x)||!Fy(_))return null;switch(d){case"start":b=aF("calc(".concat(s,")"));break;case"middle":b=aF("calc(".concat((p.length-1)/2," * -").concat(o," + (").concat(s," / 2))"));break;default:b=aF("calc(".concat(p.length-1," * -").concat(o,")"))}var w=[];if(c){var S=p[0].width,{width:T}=h;w.push("scale(".concat(by(T)&&by(S)?T/S:1,")"))}return g&&w.push("rotate(".concat(g,", ").concat(x,", ").concat(_,")")),w.length&&(y.transform=w.join(" ")),r.createElement("text",lF({},SI(y),{ref:t,x:x,y:_,className:(0,hy.$)("recharts-text",v),textAnchor:u,fill:l.includes("url")?AF:l}),p.map((e,t)=>{var n=e.words.join(A?"":" ");return r.createElement("tspan",{x:x,dy:0===t?b:o,key:"".concat(n,"-").concat(t)},n)}))});function xF(e){var{zIndex:t,children:n}=e,i=void 0!==dT()&&void 0!==t&&0!==t,a=tT(),o=aS();(0,r.useLayoutEffect)(()=>i?(o(rI({zIndex:t})),()=>{o(iI({zIndex:t}))}):ky,[o,t,i]);var s=cS(e=>kI(e,t,a));if(!i)return n;if(!s)return null;var l=document.getElementById(s);return l?(0,Ca.createPortal)(n,l):null}bF.displayName="Text";var _F=["labelRef"];function wF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function SF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wF(Object(n),!0).forEach(function(t){TF(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function TF(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CF(){return CF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},CF.apply(null,arguments)}var MF=(0,r.createContext)(null),EF=e=>{var{x:t,y:n,upperWidth:i,lowerWidth:a,width:o,height:s,children:l}=e,c=(0,r.useMemo)(()=>({x:t,y:n,upperWidth:i,lowerWidth:a,width:o,height:s}),[t,n,i,a,o,s]);return r.createElement(MF.Provider,{value:c},l)},PF=()=>{var e=(0,r.useContext)(MF),t=aT();return e||iT(t)},NF=(0,r.createContext)(null),kF=()=>{var e=(0,r.useContext)(NF),t=cS(zk);return e||t},RF=e=>null!=e&&"function"===typeof e,LF=(e,t,n,i,a)=>{var o,s,{offset:l,className:c}=e,{cx:u,cy:d,innerRadius:h,outerRadius:p,startAngle:f,endAngle:m,clockWise:g}=a,v=(h+p)/2,A=((e,t)=>vy(t-e)*Math.min(Math.abs(t-e),360))(f,m),y=A>=0?1:-1;switch(t){case"insideStart":o=f+y*l,s=g;break;case"insideEnd":o=m-y*l,s=!g;break;case"end":o=m+y*l,s=g;break;default:throw new Error("Unsupported position ".concat(t))}s=A<=0?s:!s;var b=lk(u,d,v,o),x=lk(u,d,v,o+359*(s?1:-1)),_="M".concat(b.x,",").concat(b.y,"\n    A").concat(v,",").concat(v,",0,1,").concat(s?0:1,",\n    ").concat(x.x,",").concat(x.y),w=Ey(e.id)?wy("recharts-radial-line-"):e.id;return r.createElement("text",CF({},i,{dominantBaseline:"central",className:(0,hy.$)("recharts-radial-bar-label",c)}),r.createElement("defs",null,r.createElement("path",{id:w,d:_})),r.createElement("textPath",{xlinkHref:"#".concat(w)},n))},OF=e=>"cx"in e&&by(e.cx),jF={angle:0,offset:5,zIndex:pk.label,position:"middle",textBreakAll:!1};function DF(e){var t,n,i,a=bB(e,jF),{viewBox:o,position:s,value:l,children:c,content:u,className:d="",textBreakAll:h,labelRef:p}=a,f=kF(),m=PF();if(!(t=null==o?"center"===s?m:null!==f&&void 0!==f?f:m:OF(o)?o:iT(o))||Ey(l)&&Ey(c)&&!(0,r.isValidElement)(u)&&"function"!==typeof u)return null;var g=SF(SF({},a),{},{viewBox:t});if((0,r.isValidElement)(u)){var{labelRef:v}=g,A=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(g,_F);return(0,r.cloneElement)(u,A)}if("function"===typeof u){if(n=(0,r.createElement)(u,g),(0,r.isValidElement)(n))return n}else n=(e=>{var{value:t,formatter:n}=e,r=Ey(e.children)?t:e.children;return"function"===typeof n?n(r):r})(a);var y=SI(a);if(OF(t)){if("insideStart"===s||"insideEnd"===s||"end"===s)return LF(a,s,n,y,t);i=((e,t,n)=>{var{cx:r,cy:i,innerRadius:a,outerRadius:o,startAngle:s,endAngle:l}=e,c=(s+l)/2;if("outside"===n){var{x:u,y:d}=lk(r,i,o+t,c);return{x:u,y:d,textAnchor:u>=r?"start":"end",verticalAnchor:"middle"}}if("center"===n)return{x:r,y:i,textAnchor:"middle",verticalAnchor:"middle"};if("centerTop"===n)return{x:r,y:i,textAnchor:"middle",verticalAnchor:"start"};if("centerBottom"===n)return{x:r,y:i,textAnchor:"middle",verticalAnchor:"end"};var h=(a+o)/2,{x:p,y:f}=lk(r,i,h,c);return{x:p,y:f,textAnchor:"middle",verticalAnchor:"middle"}})(t,a.offset,a.position)}else i=((e,t)=>{var n,{parentViewBox:r,offset:i,position:a}=e;null==r||OF(r)||(n=r);var{x:o,y:s,upperWidth:l,lowerWidth:c,height:u}=t,d=o,h=o+(l-c)/2,p=(d+h)/2,f=(l+c)/2,m=d+l/2,g=u>=0?1:-1,v=g*i,A=g>0?"end":"start",y=g>0?"start":"end",b=l>=0?1:-1,x=b*i,_=b>0?"end":"start",w=b>0?"start":"end";if("top"===a)return SF(SF({},{x:d+l/2,y:s-v,textAnchor:"middle",verticalAnchor:A}),n?{height:Math.max(s-n.y,0),width:l}:{});if("bottom"===a)return SF(SF({},{x:h+c/2,y:s+u+v,textAnchor:"middle",verticalAnchor:y}),n?{height:Math.max(n.y+n.height-(s+u),0),width:c}:{});if("left"===a){var S={x:p-x,y:s+u/2,textAnchor:_,verticalAnchor:"middle"};return SF(SF({},S),n?{width:Math.max(S.x-n.x,0),height:u}:{})}if("right"===a){var T={x:p+f+x,y:s+u/2,textAnchor:w,verticalAnchor:"middle"};return SF(SF({},T),n?{width:Math.max(n.x+n.width-T.x,0),height:u}:{})}var C=n?{width:f,height:u}:{};return"insideLeft"===a?SF({x:p+x,y:s+u/2,textAnchor:w,verticalAnchor:"middle"},C):"insideRight"===a?SF({x:p+f-x,y:s+u/2,textAnchor:_,verticalAnchor:"middle"},C):"insideTop"===a?SF({x:d+l/2,y:s+v,textAnchor:"middle",verticalAnchor:y},C):"insideBottom"===a?SF({x:h+c/2,y:s+u-v,textAnchor:"middle",verticalAnchor:A},C):"insideTopLeft"===a?SF({x:d+x,y:s+v,textAnchor:w,verticalAnchor:y},C):"insideTopRight"===a?SF({x:d+l-x,y:s+v,textAnchor:_,verticalAnchor:y},C):"insideBottomLeft"===a?SF({x:h+x,y:s+u-v,textAnchor:w,verticalAnchor:A},C):"insideBottomRight"===a?SF({x:h+c-x,y:s+u-v,textAnchor:_,verticalAnchor:A},C):a&&"object"===typeof a&&(by(a.x)||yy(a.x))&&(by(a.y)||yy(a.y))?SF({x:o+Sy(a.x,f),y:s+Sy(a.y,u),textAnchor:"end",verticalAnchor:"end"},C):SF({x:m,y:s+u/2,textAnchor:"middle",verticalAnchor:"middle"},C)})(a,t);return r.createElement(xF,{zIndex:a.zIndex},r.createElement(bF,CF({ref:p,className:(0,hy.$)("recharts-label",d)},y,i,{textAnchor:hF(y.textAnchor)?y.textAnchor:i.textAnchor,breakAll:h}),n))}DF.displayName="Label";var IF=(e,t,n)=>{if(!e)return null;var i={viewBox:t,labelRef:n};return!0===e?r.createElement(DF,CF({key:"label-implicit"},i)):xy(e)?r.createElement(DF,CF({key:"label-implicit",value:e},i)):(0,r.isValidElement)(e)?e.type===DF?(0,r.cloneElement)(e,SF({key:"label-implicit"},i)):r.createElement(DF,CF({key:"label-implicit",content:e},i)):RF(e)?r.createElement(DF,CF({key:"label-implicit",content:e},i)):e&&"object"===typeof e?r.createElement(DF,CF({},e,{key:"label-implicit"},i)):null};function BF(e){var{label:t,labelRef:n}=e,r=PF();return IF(t,r,n)||null}var FF=e=>"radius"in e&&"startAngle"in e&&"endAngle"in e,zF=(e,t)=>{if(!e||"function"===typeof e||"boolean"===typeof e)return null;var n=e;if((0,r.isValidElement)(e)&&(n=e.props),"object"!==typeof n&&"function"!==typeof n)return null;var i={};return Object.keys(n).forEach(e=>{AI(e)&&(i[e]=t||(t=>n[e](n,t)))}),i},UF=(e,t,n)=>{if(null===e||"object"!==typeof e&&"function"!==typeof e)return null;var r=null;return Object.keys(e).forEach(i=>{var a=e[i];AI(i)&&"function"===typeof a&&(r||(r={}),r[i]=((e,t,n)=>r=>(e(t,n,r),null))(a,t,n))}),r},VF=["axisLine","width","height","className","hide","ticks","axisType"];function GF(){return GF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},GF.apply(null,arguments)}function qF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function WF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qF(Object(n),!0).forEach(function(t){HF(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function HF(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $F={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd",zIndex:pk.axis};function KF(e){var{x:t,y:n,width:i,height:a,orientation:o,mirror:s,axisLine:l,otherSvgProps:c}=e;if(!l)return null;var u=WF(WF(WF({},c),_I(l)),{},{fill:"none"});if("top"===o||"bottom"===o){var d=+("top"===o&&!s||"bottom"===o&&s);u=WF(WF({},u),{},{x1:t,y1:n+d*a,x2:t+i,y2:n+d*a})}else{var h=+("left"===o&&!s||"right"===o&&s);u=WF(WF({},u),{},{x1:t+h*i,y1:n,x2:t+h*i,y2:n+a})}return r.createElement("line",GF({},u,{className:(0,hy.$)("recharts-cartesian-axis-line",gy()(l,"className"))}))}function XF(e){var t,{option:n,tickProps:i,value:a}=e,o=(0,hy.$)(i.className,"recharts-cartesian-axis-tick-value");if(r.isValidElement(n))t=r.cloneElement(n,WF(WF({},i),{},{className:o}));else if("function"===typeof n)t=n(WF(WF({},i),{},{className:o}));else{var s="recharts-cartesian-axis-tick-value";"boolean"!==typeof n&&(s=(0,hy.$)(s,null===n||void 0===n?void 0:n.className)),t=r.createElement(bF,GF({},i,{className:s}),a)}return t}var YF=(0,r.forwardRef)((e,t)=>{var{ticks:n=[],tick:i,tickLine:a,stroke:o,tickFormatter:s,unit:l,padding:c,tickTextProps:u,orientation:d,mirror:h,x:p,y:f,width:m,height:g,tickSize:v,tickMargin:A,fontSize:y,letterSpacing:b,getTicksConfig:x,events:_,axisType:w}=e,S=qB(WF(WF({},x),{},{ticks:n}),y,b),T=function(e,t){switch(e){case"left":return t?"start":"end";case"right":return t?"end":"start";default:return"middle"}}(d,h),C=function(e,t){switch(e){case"left":case"right":return"middle";case"top":return t?"start":"end";default:return t?"end":"start"}}(d,h),M=_I(x),E=wI(i),P={};"object"===typeof a&&(P=a);var N=WF(WF({},M),{},{fill:"none"},P),k=S.map(e=>WF({entry:e},function(e,t,n,r,i,a,o,s,l){var c,u,d,h,p,f,m=s?-1:1,g=e.tickSize||o,v=by(e.tickCoord)?e.tickCoord:e.coordinate;switch(a){case"top":c=u=e.coordinate,f=(d=(h=n+ +!s*i)-m*g)-m*l,p=v;break;case"left":d=h=e.coordinate,p=(c=(u=t+ +!s*r)-m*g)-m*l,f=v;break;case"right":d=h=e.coordinate,p=(c=(u=t+ +s*r)+m*g)+m*l,f=v;break;default:c=u=e.coordinate,f=(d=(h=n+ +s*i)+m*g)+m*l,p=v}return{line:{x1:c,y1:d,x2:u,y2:h},tick:{x:p,y:f}}}(e,p,f,m,g,d,v,h,A))),R=k.map(e=>{var{entry:t,line:n}=e;return r.createElement($B,{className:"recharts-cartesian-axis-tick",key:"tick-".concat(t.value,"-").concat(t.coordinate,"-").concat(t.tickCoord)},a&&r.createElement("line",GF({},N,n,{className:(0,hy.$)("recharts-cartesian-axis-tick-line",gy()(a,"className"))})))}),L=k.map((e,t)=>{var{entry:n,tick:a}=e,d=WF(WF(WF(WF({textAnchor:T,verticalAnchor:C},M),{},{stroke:"none",fill:o},E),a),{},{index:t,payload:n,visibleTicksCount:S.length,tickFormatter:s,padding:c},u);return r.createElement($B,GF({className:"recharts-cartesian-axis-tick-label",key:"tick-label-".concat(n.value,"-").concat(n.coordinate,"-").concat(n.tickCoord)},UF(_,n,t)),i&&r.createElement(XF,{option:i,tickProps:d,value:"".concat("function"===typeof s?s(n.value,t):n.value).concat(l||"")}))});return r.createElement("g",{className:"recharts-cartesian-axis-ticks recharts-".concat(w,"-ticks")},L.length>0&&r.createElement(xF,{zIndex:pk.label},r.createElement("g",{className:"recharts-cartesian-axis-tick-labels recharts-".concat(w,"-tick-labels"),ref:t},L)),R.length>0&&r.createElement("g",{className:"recharts-cartesian-axis-tick-lines recharts-".concat(w,"-tick-lines")},R))}),QF=(0,r.forwardRef)((e,t)=>{var{axisLine:n,width:i,height:a,className:o,hide:s,ticks:l,axisType:c}=e,u=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,VF),[d,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),m=(0,r.useRef)(null);(0,r.useImperativeHandle)(t,()=>({getCalculatedWidth:()=>{var t;return(e=>{var{ticks:t,label:n,labelGapWithTick:r=5,tickSize:i=0,tickMargin:a=0}=e,o=0;if(t){Array.from(t).forEach(e=>{if(e){var t=e.getBoundingClientRect();t.width>o&&(o=t.width)}});var s=n?n.getBoundingClientRect().width:0,l=o+(i+a)+s+(n?r:0);return Math.round(l)}return 0})({ticks:m.current,label:null===(t=e.labelRef)||void 0===t?void 0:t.current,labelGapWithTick:5,tickSize:e.tickSize,tickMargin:e.tickMargin})}}));var g=(0,r.useCallback)(e=>{if(e){var t=e.getElementsByClassName("recharts-cartesian-axis-tick-value");m.current=t;var n=t[0];if(n){var r=window.getComputedStyle(n),i=r.fontSize,a=r.letterSpacing;i===d&&a===p||(h(i),f(a))}}},[d,p]);return s||null!=i&&i<=0||null!=a&&a<=0?null:r.createElement(xF,{zIndex:e.zIndex},r.createElement($B,{className:(0,hy.$)("recharts-cartesian-axis",o)},r.createElement(KF,{x:e.x,y:e.y,width:i,height:a,orientation:e.orientation,mirror:e.mirror,axisLine:n,otherSvgProps:_I(e)}),r.createElement(YF,{ref:g,axisType:c,events:u,fontSize:d,getTicksConfig:e,height:e.height,letterSpacing:p,mirror:e.mirror,orientation:e.orientation,padding:e.padding,stroke:e.stroke,tick:e.tick,tickFormatter:e.tickFormatter,tickLine:e.tickLine,tickMargin:e.tickMargin,tickSize:e.tickSize,tickTextProps:e.tickTextProps,ticks:l,unit:e.unit,width:e.width,x:e.x,y:e.y}),r.createElement(EF,{x:e.x,y:e.y,width:e.width,height:e.height,lowerWidth:e.width,upperWidth:e.width},r.createElement(BF,{label:e.label,labelRef:e.labelRef}),e.children)))}),ZF=r.forwardRef((e,t)=>{var n=bB(e,$F);return r.createElement(QF,GF({},n,{ref:t}))});ZF.displayName="CartesianAxis";var JF=["x1","y1","x2","y2","key"],ez=["offset"],tz=["xAxisId","yAxisId"],nz=["xAxisId","yAxisId"];function rz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rz(Object(n),!0).forEach(function(t){az(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rz(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function az(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oz(){return oz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},oz.apply(null,arguments)}function sz(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var lz=e=>{var{fill:t}=e;if(!t||"none"===t)return null;var{fillOpacity:n,x:i,y:a,width:o,height:s,ry:l}=e;return r.createElement("rect",{x:i,y:a,ry:l,width:o,height:s,stroke:"none",fill:t,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function cz(e){var t,{option:n,lineItemProps:i}=e;if(r.isValidElement(n))t=r.cloneElement(n,i);else if("function"===typeof n)t=n(i);else{var a,{x1:o,y1:s,x2:l,y2:c,key:u}=i,d=null!==(a=_I(sz(i,JF)))&&void 0!==a?a:{},{offset:h}=d,p=sz(d,ez);t=r.createElement("line",oz({},p,{x1:o,y1:s,x2:l,y2:c,fill:"none",key:u}))}return t}function uz(e){var{x:t,width:n,horizontal:i=!0,horizontalPoints:a}=e;if(!i||!a||!a.length)return null;var{xAxisId:o,yAxisId:s}=e,l=sz(e,tz),c=a.map((e,a)=>{var o=iz(iz({},l),{},{x1:t,y1:e,x2:t+n,y2:e,key:"line-".concat(a),index:a});return r.createElement(cz,{key:"line-".concat(a),option:i,lineItemProps:o})});return r.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function dz(e){var{y:t,height:n,vertical:i=!0,verticalPoints:a}=e;if(!i||!a||!a.length)return null;var{xAxisId:o,yAxisId:s}=e,l=sz(e,nz),c=a.map((e,a)=>{var o=iz(iz({},l),{},{x1:e,y1:t,x2:e,y2:t+n,key:"line-".concat(a),index:a});return r.createElement(cz,{option:i,lineItemProps:o,key:"line-".concat(a)})});return r.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function hz(e){var{horizontalFill:t,fillOpacity:n,x:i,y:a,width:o,height:s,horizontalPoints:l,horizontal:c=!0}=e;if(!c||!t||!t.length||null==l)return null;var u=l.map(e=>Math.round(e+a-a)).sort((e,t)=>e-t);a!==u[0]&&u.unshift(0);var d=u.map((e,l)=>{var c=!u[l+1]?a+s-e:u[l+1]-e;if(c<=0)return null;var d=l%t.length;return r.createElement("rect",{key:"react-".concat(l),y:e,x:i,height:c,width:o,stroke:"none",fill:t[d],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return r.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},d)}function pz(e){var{vertical:t=!0,verticalFill:n,fillOpacity:i,x:a,y:o,width:s,height:l,verticalPoints:c}=e;if(!t||!n||!n.length)return null;var u=c.map(e=>Math.round(e+a-a)).sort((e,t)=>e-t);a!==u[0]&&u.unshift(0);var d=u.map((e,t)=>{var c=!u[t+1]?a+s-e:u[t+1]-e;if(c<=0)return null;var d=t%n.length;return r.createElement("rect",{key:"react-".concat(t),x:e,y:o,width:c,height:l,stroke:"none",fill:n[d],fillOpacity:i,className:"recharts-cartesian-grid-bg"})});return r.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},d)}var fz=(e,t)=>{var{xAxis:n,width:r,height:i,offset:a}=e;return CS(qB(iz(iz(iz({},$F),n),{},{ticks:MS(n,!0),viewBox:{x:0,y:0,width:r,height:i}})),a.left,a.left+a.width,t)},mz=(e,t)=>{var{yAxis:n,width:r,height:i,offset:a}=e;return CS(qB(iz(iz(iz({},$F),n),{},{ticks:MS(n,!0),viewBox:{x:0,y:0,width:r,height:i}})),a.top,a.top+a.height,t)},gz={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0,syncWithTicks:!1,zIndex:pk.grid};function vz(e){var t=lT(),n=cT(),i=sT(),a=iz(iz({},bB(e,gz)),{},{x:by(e.x)?e.x:i.left,y:by(e.y)?e.y:i.top,width:by(e.width)?e.width:i.width,height:by(e.height)?e.height:i.height}),{xAxisId:o,yAxisId:s,x:l,y:c,width:u,height:d,syncWithTicks:h,horizontalValues:p,verticalValues:f}=a,m=tT(),g=cS(e=>GL(e,"xAxis",o,m)),v=cS(e=>GL(e,"yAxis",s,m));if(!zy(u)||!zy(d)||!by(l)||!by(c))return null;var A=a.verticalCoordinatesGenerator||fz,y=a.horizontalCoordinatesGenerator||mz,{horizontalPoints:b,verticalPoints:x}=a;if((!b||!b.length)&&"function"===typeof y){var _=p&&p.length,w=y({yAxis:v?iz(iz({},v),{},{ticks:_?p:v.ticks}):void 0,width:null!==t&&void 0!==t?t:u,height:null!==n&&void 0!==n?n:d,offset:i},!!_||h);Ry(Array.isArray(w),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof w,"]")),Array.isArray(w)&&(b=w)}if((!x||!x.length)&&"function"===typeof A){var S=f&&f.length,T=A({xAxis:g?iz(iz({},g),{},{ticks:S?f:g.ticks}):void 0,width:null!==t&&void 0!==t?t:u,height:null!==n&&void 0!==n?n:d,offset:i},!!S||h);Ry(Array.isArray(T),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof T,"]")),Array.isArray(T)&&(x=T)}return r.createElement(xF,{zIndex:a.zIndex},r.createElement("g",{className:"recharts-cartesian-grid"},r.createElement(lz,{fill:a.fill,fillOpacity:a.fillOpacity,x:a.x,y:a.y,width:a.width,height:a.height,ry:a.ry}),r.createElement(hz,oz({},a,{horizontalPoints:b})),r.createElement(pz,oz({},a,{verticalPoints:x})),r.createElement(uz,oz({},a,{offset:i,horizontalPoints:b,xAxis:g,yAxis:v})),r.createElement(dz,oz({},a,{offset:i,verticalPoints:x,xAxis:g,yAxis:v}))))}vz.displayName="CartesianGrid";var Az=["domain","range"],yz=["domain","range"];function bz(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function xz(e,t){return e===t||!(!Array.isArray(e)||2!==e.length||!Array.isArray(t)||2!==t.length)&&(e[0]===t[0]&&e[1]===t[1])}function _z(e,t){if(e===t)return!0;var{domain:n,range:r}=e,i=bz(e,Az),{domain:a,range:o}=t,s=bz(t,yz);return!!xz(n,a)&&(!!xz(r,o)&&hI(i,s))}var wz=["dangerouslySetInnerHTML","ticks"],Sz=["id"];function Tz(){return Tz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Tz.apply(null,arguments)}function Cz(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Mz(e){var t=aS(),n=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{null===n.current?t(Bj(e)):n.current!==e&&t(Fj({prev:n.current,next:e})),n.current=e},[e,t]),(0,r.useLayoutEffect)(()=>()=>{n.current&&(t(zj(n.current)),n.current=null)},[t]),null}var Ez=e=>{var{xAxisId:t,className:n}=e,i=cS(JS),a=tT(),o="xAxis",s=cS(e=>TL(e,o,t,a)),l=cS(e=>qL(e,o,t,a)),c=cS(e=>RL(e,t)),u=cS(e=>jL(e,t)),d=cS(e=>tR(e,t));if(null==c||null==u||null==d)return null;var{dangerouslySetInnerHTML:h,ticks:p}=e,f=Cz(e,wz),{id:m}=d,g=Cz(d,Sz);return r.createElement(ZF,Tz({},f,g,{scale:s,x:u.x,y:u.y,width:c.width,height:c.height,className:(0,hy.$)("recharts-".concat(o," ").concat(o),n),viewBox:i,ticks:l,axisType:o}))},Pz={allowDataOverflow:eR.allowDataOverflow,allowDecimals:eR.allowDecimals,allowDuplicatedCategory:eR.allowDuplicatedCategory,angle:eR.angle,axisLine:$F.axisLine,height:eR.height,hide:!1,includeHidden:eR.includeHidden,interval:eR.interval,minTickGap:eR.minTickGap,mirror:eR.mirror,orientation:eR.orientation,padding:eR.padding,reversed:eR.reversed,scale:eR.scale,tick:eR.tick,tickCount:eR.tickCount,tickLine:$F.tickLine,tickSize:$F.tickSize,type:eR.type,xAxisId:0},Nz=e=>{var t=bB(e,Pz);return r.createElement(r.Fragment,null,r.createElement(Mz,{allowDataOverflow:t.allowDataOverflow,allowDecimals:t.allowDecimals,allowDuplicatedCategory:t.allowDuplicatedCategory,angle:t.angle,dataKey:t.dataKey,domain:t.domain,height:t.height,hide:t.hide,id:t.xAxisId,includeHidden:t.includeHidden,interval:t.interval,minTickGap:t.minTickGap,mirror:t.mirror,name:t.name,orientation:t.orientation,padding:t.padding,reversed:t.reversed,scale:t.scale,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit}),r.createElement(Ez,t))},kz=r.memo(Nz,_z);kz.displayName="XAxis";var Rz=["dangerouslySetInnerHTML","ticks"],Lz=["id"];function Oz(){return Oz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Oz.apply(null,arguments)}function jz(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Dz(e){var t=aS(),n=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{null===n.current?t(Uj(e)):n.current!==e&&t(Vj({prev:n.current,next:e})),n.current=e},[e,t]),(0,r.useLayoutEffect)(()=>()=>{n.current&&(t(Gj(n.current)),n.current=null)},[t]),null}var Iz=e=>{var{yAxisId:t,className:n,width:i,label:a}=e,o=(0,r.useRef)(null),s=(0,r.useRef)(null),l=cS(JS),c=tT(),u=aS(),d="yAxis",h=cS(e=>TL(e,d,t,c)),p=cS(e=>IL(e,t)),f=cS(e=>DL(e,t)),m=cS(e=>qL(e,d,t,c)),g=cS(e=>iR(e,t));if((0,r.useLayoutEffect)(()=>{if("auto"===i&&p&&!RF(a)&&!(0,r.isValidElement)(a)&&null!=g){var e=o.current;if(e){var n=e.getCalculatedWidth();Math.round(p.width)!==Math.round(n)&&u($j({id:t,width:n}))}}},[m,p,u,a,t,i,g]),null==p||null==f||null==g)return null;var{dangerouslySetInnerHTML:v,ticks:A}=e,y=jz(e,Rz),{id:b}=g,x=jz(g,Lz);return r.createElement(ZF,Oz({},y,x,{ref:o,labelRef:s,scale:h,x:f.x,y:f.y,tickTextProps:"auto"===i?{width:void 0}:{width:i},width:p.width,height:p.height,className:(0,hy.$)("recharts-".concat(d," ").concat(d),n),viewBox:l,ticks:m,axisType:d}))},Bz={allowDataOverflow:rR.allowDataOverflow,allowDecimals:rR.allowDecimals,allowDuplicatedCategory:rR.allowDuplicatedCategory,angle:rR.angle,axisLine:$F.axisLine,hide:!1,includeHidden:rR.includeHidden,interval:rR.interval,minTickGap:rR.minTickGap,mirror:rR.mirror,orientation:rR.orientation,padding:rR.padding,reversed:rR.reversed,scale:rR.scale,tick:rR.tick,tickCount:rR.tickCount,tickLine:$F.tickLine,tickSize:$F.tickSize,type:rR.type,width:rR.width,yAxisId:0},Fz=e=>{var t=bB(e,Bz);return r.createElement(r.Fragment,null,r.createElement(Dz,{interval:t.interval,id:t.yAxisId,scale:t.scale,type:t.type,domain:t.domain,allowDataOverflow:t.allowDataOverflow,dataKey:t.dataKey,allowDuplicatedCategory:t.allowDuplicatedCategory,allowDecimals:t.allowDecimals,tickCount:t.tickCount,padding:t.padding,includeHidden:t.includeHidden,reversed:t.reversed,ticks:t.ticks,width:t.width,orientation:t.orientation,mirror:t.mirror,hide:t.hide,unit:t.unit,name:t.name,angle:t.angle,minTickGap:t.minTickGap,tick:t.tick,tickFormatter:t.tickFormatter}),r.createElement(Iz,t))},zz=r.memo(Fz,_z);function Uz(){return Uz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Uz.apply(null,arguments)}function Vz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Gz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vz(Object(n),!0).forEach(function(t){qz(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vz(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function qz(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wz(e){return Array.isArray(e)&&xy(e[0])&&xy(e[1])?e.join(" ~ "):e}zz.displayName="YAxis";var Hz=e=>{var{separator:t=" : ",contentStyle:n={},itemStyle:i={},labelStyle:a={},payload:o,formatter:s,itemSorter:l,wrapperClassName:c,labelClassName:u,label:d,labelFormatter:h,accessibilityLayer:p=!1}=e,f=Gz({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},n),m=Gz({margin:0},a),g=!Ey(d),v=g?d:"",A=(0,hy.$)("recharts-default-tooltip",c),y=(0,hy.$)("recharts-tooltip-label",u);g&&h&&void 0!==o&&null!==o&&(v=h(d,o));var b=p?{role:"status","aria-live":"assertive"}:{};return r.createElement("div",Uz({className:A,style:f},b),r.createElement("p",{className:y,style:m},r.isValidElement(v)?v:"".concat(v)),(()=>{if(o&&o.length){var e=(l?dS()(o,l):o).map((e,n)=>{if("none"===e.type)return null;var a=e.formatter||s||Wz,{value:l,name:c}=e,u=l,d=c;if(a){var h=a(l,c,e,n,o);if(Array.isArray(h))[u,d]=h;else{if(null==h)return null;u=h}}var p=Gz({display:"block",paddingTop:4,paddingBottom:4,color:e.color||"#000"},i);return r.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(n),style:p},xy(d)?r.createElement("span",{className:"recharts-tooltip-item-name"},d):null,xy(d)?r.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,r.createElement("span",{className:"recharts-tooltip-item-value"},u),r.createElement("span",{className:"recharts-tooltip-item-unit"},e.unit||""))});return r.createElement("ul",{className:"recharts-tooltip-item-list",style:{padding:0,margin:0}},e)}return null})())},$z="recharts-tooltip-wrapper",Kz={visibility:"hidden"};function Xz(e){var{coordinate:t,translateX:n,translateY:r}=e;return(0,hy.$)($z,{["".concat($z,"-right")]:by(n)&&t&&by(t.x)&&n>=t.x,["".concat($z,"-left")]:by(n)&&t&&by(t.x)&&n<t.x,["".concat($z,"-bottom")]:by(r)&&t&&by(t.y)&&r>=t.y,["".concat($z,"-top")]:by(r)&&t&&by(t.y)&&r<t.y})}function Yz(e){var{allowEscapeViewBox:t,coordinate:n,key:r,offsetTopLeft:i,position:a,reverseDirection:o,tooltipDimension:s,viewBox:l,viewBoxDimension:c}=e;if(a&&by(a[r]))return a[r];var u=n[r]-s-(i>0?i:0),d=n[r]+i;if(t[r])return o[r]?u:d;var h=l[r];return null==h?0:o[r]?u<h?Math.max(d,h):Math.max(u,h):null==c?0:d+s>h+c?Math.max(u,h):Math.max(d,h)}function Qz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Zz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qz(Object(n),!0).forEach(function(t){Jz(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qz(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Jz(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class eU extends r.PureComponent{constructor(){super(...arguments),Jz(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),Jz(this,"handleKeyDown",e=>{var t,n,r,i;"Escape"===e.key&&this.setState({dismissed:!0,dismissedAtCoordinate:{x:null!==(t=null===(n=this.props.coordinate)||void 0===n?void 0:n.x)&&void 0!==t?t:0,y:null!==(r=null===(i=this.props.coordinate)||void 0===i?void 0:i.y)&&void 0!==r?r:0}})})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,t;this.state.dismissed&&((null===(e=this.props.coordinate)||void 0===e?void 0:e.x)===this.state.dismissedAtCoordinate.x&&(null===(t=this.props.coordinate)||void 0===t?void 0:t.y)===this.state.dismissedAtCoordinate.y||(this.state.dismissed=!1))}render(){var{active:e,allowEscapeViewBox:t,animationDuration:n,animationEasing:i,children:a,coordinate:o,hasPayload:s,isAnimationActive:l,offset:c,position:u,reverseDirection:d,useTranslate3d:h,viewBox:p,wrapperStyle:f,lastBoundingBox:m,innerRef:g,hasPortalFromProps:v}=this.props,{cssClasses:A,cssProperties:y}=function(e){var t,n,r,{allowEscapeViewBox:i,coordinate:a,offsetTopLeft:o,position:s,reverseDirection:l,tooltipBox:c,useTranslate3d:u,viewBox:d}=e;return t=c.height>0&&c.width>0&&a?function(e){var{translateX:t,translateY:n,useTranslate3d:r}=e;return{transform:r?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}({translateX:n=Yz({allowEscapeViewBox:i,coordinate:a,key:"x",offsetTopLeft:o,position:s,reverseDirection:l,tooltipDimension:c.width,viewBox:d,viewBoxDimension:d.width}),translateY:r=Yz({allowEscapeViewBox:i,coordinate:a,key:"y",offsetTopLeft:o,position:s,reverseDirection:l,tooltipDimension:c.height,viewBox:d,viewBoxDimension:d.height}),useTranslate3d:u}):Kz,{cssProperties:t,cssClasses:Xz({translateX:n,translateY:r,coordinate:a})}}({allowEscapeViewBox:t,coordinate:o,offsetTopLeft:c,position:u,reverseDirection:d,tooltipBox:{height:m.height,width:m.width},useTranslate3d:h,viewBox:p}),b=v?{}:Zz(Zz({transition:l&&e?"transform ".concat(n,"ms ").concat(i):void 0},y),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&s?"visible":"hidden",position:"absolute",top:0,left:0}),x=Zz(Zz({},b),{},{visibility:!this.state.dismissed&&e&&s?"visible":"hidden"},f);return r.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:A,style:x,ref:g},a)}}var tU=n(4332),nU=n.n(tU);function rU(e,t,n){return!0===t?nU()(e,n):"function"===typeof t?nU()(e,t):e}function iU(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,n]=(0,r.useState)({height:0,left:0,top:0,width:0}),i=(0,r.useCallback)(e=>{if(null!=e){var r=e.getBoundingClientRect(),i={height:r.height,left:r.left,top:r.top,width:r.width};(Math.abs(i.height-t.height)>1||Math.abs(i.left-t.left)>1||Math.abs(i.top-t.top)>1||Math.abs(i.width-t.width)>1)&&n({height:i.height,left:i.left,top:i.top,width:i.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,i]}function aU(){}function oU(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function sU(e){this._context=e}function lU(e){this._context=e}function cU(e){this._context=e}sU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:oU(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:oU(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},lU.prototype={areaStart:aU,areaEnd:aU,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:oU(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},cU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:oU(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};class uU{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function dU(e){this._context=e}function hU(e){this._context=e}function pU(e){return new hU(e)}function fU(e){return e<0?-1:1}function mU(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(fU(a)+fU(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function gU(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function vU(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function AU(e){this._context=e}function yU(e){this._context=new bU(e)}function bU(e){this._context=e}function xU(e){this._context=e}function _U(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function wU(e,t){this._context=e,this._t=t}dU.prototype={areaStart:aU,areaEnd:aU,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},hU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},AU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:vU(this,this._t0,gU(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,vU(this,gU(this,n=mU(this,e,t)),n);break;default:vU(this,this._t0,n=mU(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(yU.prototype=Object.create(AU.prototype)).point=function(e,t){AU.prototype.point.call(this,t,e)},bU.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},xU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=_U(e),i=_U(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},wU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const SU=Math.PI,TU=2*SU,CU=1e-6,MU=TU-CU;function EU(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class PU{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?EU:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return EU;const n=10**t;return function(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,r){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(e,t,n,r,i,a){this._append`C${+e},${+t},${+n},${+r},${this._x1=+i},${this._y1=+a}`}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let a=this._x1,o=this._y1,s=n-e,l=r-t,c=a-e,u=o-t,d=c*c+u*u;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(d>CU)if(Math.abs(u*s-l*c)>CU&&i){let h=n-a,p=r-o,f=s*s+l*l,m=h*h+p*p,g=Math.sqrt(f),v=Math.sqrt(d),A=i*Math.tan((SU-Math.acos((f+d-m)/(2*g*v)))/2),y=A/v,b=A/g;Math.abs(y-1)>CU&&this._append`L${e+y*c},${t+y*u}`,this._append`A${i},${i},0,0,${+(u*h>c*p)},${this._x1=e+b*s},${this._y1=t+b*l}`}else this._append`L${this._x1=e},${this._y1=t}`;else;}arc(e,t,n,r,i,a){if(e=+e,t=+t,a=!!a,(n=+n)<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(r),s=n*Math.sin(r),l=e+o,c=t+s,u=1^a,d=a?r-i:i-r;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>CU||Math.abs(this._y1-c)>CU)&&this._append`L${l},${c}`,n&&(d<0&&(d=d%TU+TU),d>MU?this._append`A${n},${n},0,1,${u},${e-o},${t-s}A${n},${n},0,1,${u},${this._x1=l},${this._y1=c}`:d>CU&&this._append`A${n},${n},0,${+(d>=SU)},${u},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function NU(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const e=Math.floor(n);if(!(e>=0))throw new RangeError(`invalid digits: ${n}`);t=e}return e},()=>new PU(t)}function kU(e){return e[0]}function RU(e){return e[1]}function LU(e,t){var n=gS(!0),r=null,i=pU,a=null,o=NU(s);function s(s){var l,c,u,d=(s=mS(s)).length,h=!1;for(null==r&&(a=i(u=o())),l=0;l<=d;++l)!(l<d&&n(c=s[l],l,s))===h&&((h=!h)?a.lineStart():a.lineEnd()),h&&a.point(+e(c,l,s),+t(c,l,s));if(u)return a=null,u+""||null}return e="function"===typeof e?e:void 0===e?kU:gS(e),t="function"===typeof t?t:void 0===t?RU:gS(t),s.x=function(t){return arguments.length?(e="function"===typeof t?t:gS(+t),s):e},s.y=function(e){return arguments.length?(t="function"===typeof e?e:gS(+e),s):t},s.defined=function(e){return arguments.length?(n="function"===typeof e?e:gS(!!e),s):n},s.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),s):i},s.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),s):r},s}function OU(e,t,n){var r=null,i=gS(!0),a=null,o=pU,s=null,l=NU(c);function c(c){var u,d,h,p,f,m=(c=mS(c)).length,g=!1,v=new Array(m),A=new Array(m);for(null==a&&(s=o(f=l())),u=0;u<=m;++u){if(!(u<m&&i(p=c[u],u,c))===g)if(g=!g)d=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=u-1;h>=d;--h)s.point(v[h],A[h]);s.lineEnd(),s.areaEnd()}g&&(v[u]=+e(p,u,c),A[u]=+t(p,u,c),s.point(r?+r(p,u,c):v[u],n?+n(p,u,c):A[u]))}if(f)return s=null,f+""||null}function u(){return LU().defined(i).curve(o).context(a)}return e="function"===typeof e?e:void 0===e?kU:gS(+e),t="function"===typeof t?t:gS(void 0===t?0:+t),n="function"===typeof n?n:void 0===n?RU:gS(+n),c.x=function(t){return arguments.length?(e="function"===typeof t?t:gS(+t),r=null,c):e},c.x0=function(t){return arguments.length?(e="function"===typeof t?t:gS(+t),c):e},c.x1=function(e){return arguments.length?(r=null==e?null:"function"===typeof e?e:gS(+e),c):r},c.y=function(e){return arguments.length?(t="function"===typeof e?e:gS(+e),n=null,c):t},c.y0=function(e){return arguments.length?(t="function"===typeof e?e:gS(+e),c):t},c.y1=function(e){return arguments.length?(n=null==e?null:"function"===typeof e?e:gS(+e),c):n},c.lineX0=c.lineY0=function(){return u().x(e).y(t)},c.lineY1=function(){return u().x(e).y(n)},c.lineX1=function(){return u().x(r).y(t)},c.defined=function(e){return arguments.length?(i="function"===typeof e?e:gS(!!e),c):i},c.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),c):o},c.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),c):a},c}function jU(){return jU=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jU.apply(null,arguments)}function DU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function IU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DU(Object(n),!0).forEach(function(t){BU(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function BU(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var FU={curveBasisClosed:function(e){return new lU(e)},curveBasisOpen:function(e){return new cU(e)},curveBasis:function(e){return new sU(e)},curveBumpX:function(e){return new uU(e,!0)},curveBumpY:function(e){return new uU(e,!1)},curveLinearClosed:function(e){return new dU(e)},curveLinear:pU,curveMonotoneX:function(e){return new AU(e)},curveMonotoneY:function(e){return new yU(e)},curveNatural:function(e){return new xU(e)},curveStep:function(e){return new wU(e,.5)},curveStepAfter:function(e){return new wU(e,1)},curveStepBefore:function(e){return new wU(e,0)}},zU=e=>Fy(e.x)&&Fy(e.y),UU=e=>null!=e.base&&zU(e.base)&&zU(e),VU=e=>e.x,GU=e=>e.y,qU=e=>{var t,{type:n="linear",points:r=[],baseLine:i,layout:a,connectNulls:o=!1}=e,s=((e,t)=>{if("function"===typeof e)return e;var n="curve".concat(Py(e));return"curveMonotone"!==n&&"curveBump"!==n||!t?FU[n]||pU:FU["".concat(n).concat("vertical"===t?"Y":"X")]})(n,a),l=o?r.filter(zU):r;if(Array.isArray(i)){var c=r.map((e,t)=>IU(IU({},e),{},{base:i[t]}));return t="vertical"===a?OU().y(GU).x1(VU).x0(e=>e.base.x):OU().x(VU).y1(GU).y0(e=>e.base.y),t.defined(UU).curve(s)(o?c.filter(UU):c)}return(t="vertical"===a&&by(i)?OU().y(GU).x1(VU).x0(i):by(i)?OU().x(VU).y1(GU).y0(i):LU().x(VU).y(GU)).defined(zU).curve(s)(l)},WU=e=>{var{className:t,points:n,path:i,pathRef:a}=e;if((!n||!n.length)&&!i)return null;var o=n&&n.length?qU(e):i;return r.createElement("path",jU({},_I(e),zF(e),{className:(0,hy.$)("recharts-curve",t),d:null===o?void 0:o,ref:a}))},HU=["x","y","top","left","width","height","className"];function $U(){return $U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$U.apply(null,arguments)}function KU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function XU(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var YU=(e,t,n,r,i,a)=>"M".concat(e,",").concat(i,"v").concat(r,"M").concat(a,",").concat(t,"h").concat(n),QU=e=>{var{x:t=0,y:n=0,top:i=0,left:a=0,width:o=0,height:s=0,className:l}=e,c=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,HU),u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KU(Object(n),!0).forEach(function(t){XU(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({x:t,y:n,top:i,left:a,width:o,height:s},c);return by(t)&&by(n)&&by(o)&&by(s)&&by(i)&&by(a)?r.createElement("path",$U({},SI(u),{className:(0,hy.$)("recharts-cross",l),d:YU(t,n,o,s,i,a)})):null};function ZU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function JU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZU(Object(n),!0).forEach(function(t){eV(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function eV(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tV=(e,t,n)=>e.map(e=>{return"".concat((r=e,r.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())))," ").concat(t,"ms ").concat(n);var r}).join(","),nV=(e,t)=>Object.keys(t).reduce((n,r)=>JU(JU({},n),{},{[r]:e(r,t[r])}),{});function rV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rV(Object(n),!0).forEach(function(t){aV(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function aV(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oV=(e,t,n)=>e+(t-e)*n,sV=e=>{var{from:t,to:n}=e;return t!==n},lV=(e,t,n)=>{var r=nV((t,n)=>{if(sV(n)){var[r,i]=e(n.from,n.to,n.velocity);return iV(iV({},n),{},{from:r,velocity:i})}return n},t);return n<1?nV((e,t)=>sV(t)?iV(iV({},t),{},{velocity:oV(t.velocity,r[e].velocity,n),from:oV(t.from,r[e].from,n)}):t,t):lV(e,r,n-1)};function cV(e,t,n,r,i,a){var o,s=r.reduce((n,r)=>iV(iV({},n),{},{[r]:{from:e[r],velocity:0,to:t[r]}}),{}),l=null,c=r=>{o||(o=r);var u=(r-o)/n.dt;s=lV(n,s,u),i(iV(iV(iV({},e),t),nV((e,t)=>t.from,s))),o=r,Object.values(s).filter(sV).length&&(l=a.setTimeout(c))};return()=>(l=a.setTimeout(c),()=>{var e;null===(e=l)||void 0===e||e()})}var uV=(e,t,n,r,i,a)=>{var o,s,l=(o=e,s=t,[Object.keys(o),Object.keys(s)].reduce((e,t)=>e.filter(e=>t.includes(e))));return null==n?()=>(i(iV(iV({},e),t)),()=>{}):!0===n.isStepper?cV(e,t,n,l,i,a):function(e,t,n,r,i,a,o){var s,l=null,c=i.reduce((n,r)=>iV(iV({},n),{},{[r]:[e[r],t[r]]}),{}),u=i=>{s||(s=i);var d=(i-s)/r,h=nV((e,t)=>oV(...t,n(d)),c);if(a(iV(iV(iV({},e),t),h)),d<1)l=o.setTimeout(u);else{var p=nV((e,t)=>oV(...t,n(1)),c);a(iV(iV(iV({},e),t),p))}};return()=>(l=o.setTimeout(u),()=>{var e;null===(e=l)||void 0===e||e()})}(e,t,n,r,l,i,a)},dV=1e-4,hV=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],pV=(e,t)=>e.map((e,n)=>e*t**n).reduce((e,t)=>e+t),fV=(e,t)=>n=>{var r=hV(e,t);return pV(r,n)},mV=(e,t,n,r)=>{var i,a,o=fV(e,n),s=fV(t,r),l=(i=e,a=n,e=>{var t=[...hV(i,a).map((e,t)=>e*t).slice(1),0];return pV(t,e)}),c=e=>e>1?1:e<0?0:e,u=e=>{for(var t=e>1?1:e,n=t,r=0;r<8;++r){var i=o(n)-t,a=l(n);if(Math.abs(i-t)<dV||a<dV)return s(n);n=c(n-i/a)}return s(n)};return u.isStepper=!1,u},gV=function(){return mV(...function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(1===t.length)switch(t[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:var r,i=t[0].split("(");if("cubic-bezier"===i[0]&&4===(null===(r=i[1])||void 0===r?void 0:r.split(")")[0].split(",").length)){var a=i[1].split(")")[0].split(",").map(e=>parseFloat(e));return[a[0],a[1],a[2],a[3]]}}return 4===t.length?t:[0,0,1,1]}(...arguments))},vV=e=>{if("string"===typeof e)switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return gV(e);case"spring":return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stiff:t=100,damping:n=8,dt:r=17}=e,i=(e,i,a)=>{var o=a+(-(e-i)*t-a*n)*r/1e3,s=a*r/1e3+e;return Math.abs(s-i)<dV&&Math.abs(o)<dV?[i,0]:[s,o]};return i.isStepper=!0,i.dt=r,i}();default:if("cubic-bezier"===e.split("(")[0])return gV(e)}return"function"===typeof e?e:null};class AV{setTimeout(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=performance.now(),r=null,i=a=>{a-n>=t?e(a):"function"===typeof requestAnimationFrame&&(r=requestAnimationFrame(i))};return r=requestAnimationFrame(i),()=>{null!=r&&cancelAnimationFrame(r)}}}function yV(){return function(e){var t=()=>null,n=!1,r=null,i=a=>{if(!n){if(Array.isArray(a)){if(!a.length)return;var o=a,[s,...l]=o;return"number"===typeof s?void(r=e.setTimeout(i.bind(null,l),s)):(i(s),void(r=e.setTimeout(i.bind(null,l))))}"string"===typeof a&&t(a),"object"===typeof a&&t(a),"function"===typeof a&&a()}};return{stop:()=>{n=!0},start:e=>{n=!1,r&&(r(),r=null),i(e)},subscribe:e=>(t=e,()=>{t=()=>null}),getTimeoutController:()=>e}}(new AV)}var bV=(0,r.createContext)(yV);var xV={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},_V={t:0},wV={t:1};function SV(e){var t=bB(e,xV),{isActive:n,canBegin:i,duration:a,easing:o,begin:s,onAnimationEnd:l,onAnimationStart:c,children:u}=t,d="auto"===n?!YD:n,h=function(e,t){var n=(0,r.useContext)(bV);return(0,r.useMemo)(()=>null!==t&&void 0!==t?t:n(e),[e,t,n])}(t.animationId,t.animationManager),[p,f]=(0,r.useState)(d?_V:wV),m=(0,r.useRef)(null);return(0,r.useEffect)(()=>{d||f(wV)},[d]),(0,r.useEffect)(()=>{if(!d||!i)return ky;var e=uV(_V,wV,vV(o),a,f,h.getTimeoutController());return h.start([c,s,()=>{m.current=e()},a,l]),()=>{h.stop(),m.current&&m.current(),l()}},[d,i,a,o,s,c,l,h]),u(p.t)}function TV(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"animation-",n=(0,r.useRef)(wy(t)),i=(0,r.useRef)(e);return i.current!==e&&(n.current=wy(t),i.current=e),n.current}var CV=["radius"],MV=["radius"];function EV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function PV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EV(Object(n),!0).forEach(function(t){NV(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function NV(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kV(){return kV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kV.apply(null,arguments)}function RV(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var LV=(e,t,n,r,i)=>{var a,o=Math.min(Math.abs(n)/2,Math.abs(r)/2),s=r>=0?1:-1,l=n>=0?1:-1,c=r>=0&&n>=0||r<0&&n<0?1:0;if(o>0&&i instanceof Array){for(var u=[0,0,0,0],d=0;d<4;d++)u[d]=i[d]>o?o:i[d];a="M".concat(e,",").concat(t+s*u[0]),u[0]>0&&(a+="A ".concat(u[0],",").concat(u[0],",0,0,").concat(c,",").concat(e+l*u[0],",").concat(t)),a+="L ".concat(e+n-l*u[1],",").concat(t),u[1]>0&&(a+="A ".concat(u[1],",").concat(u[1],",0,0,").concat(c,",\n        ").concat(e+n,",").concat(t+s*u[1])),a+="L ".concat(e+n,",").concat(t+r-s*u[2]),u[2]>0&&(a+="A ".concat(u[2],",").concat(u[2],",0,0,").concat(c,",\n        ").concat(e+n-l*u[2],",").concat(t+r)),a+="L ".concat(e+l*u[3],",").concat(t+r),u[3]>0&&(a+="A ".concat(u[3],",").concat(u[3],",0,0,").concat(c,",\n        ").concat(e,",").concat(t+r-s*u[3])),a+="Z"}else if(o>0&&i===+i&&i>0){var h=Math.min(o,i);a="M ".concat(e,",").concat(t+s*h,"\n            A ").concat(h,",").concat(h,",0,0,").concat(c,",").concat(e+l*h,",").concat(t,"\n            L ").concat(e+n-l*h,",").concat(t,"\n            A ").concat(h,",").concat(h,",0,0,").concat(c,",").concat(e+n,",").concat(t+s*h,"\n            L ").concat(e+n,",").concat(t+r-s*h,"\n            A ").concat(h,",").concat(h,",0,0,").concat(c,",").concat(e+n-l*h,",").concat(t+r,"\n            L ").concat(e+l*h,",").concat(t+r,"\n            A ").concat(h,",").concat(h,",0,0,").concat(c,",").concat(e,",").concat(t+r-s*h," Z")}else a="M ".concat(e,",").concat(t," h ").concat(n," v ").concat(r," h ").concat(-n," Z");return a},OV={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},jV=e=>{var t=bB(e,OV),n=(0,r.useRef)(null),[i,a]=(0,r.useState)(-1);(0,r.useEffect)(()=>{if(n.current&&n.current.getTotalLength)try{var e=n.current.getTotalLength();e&&a(e)}catch(t){}},[]);var{x:o,y:s,width:l,height:c,radius:u,className:d}=t,{animationEasing:h,animationDuration:p,animationBegin:f,isAnimationActive:m,isUpdateAnimationActive:g}=t,v=(0,r.useRef)(l),A=(0,r.useRef)(c),y=(0,r.useRef)(o),b=(0,r.useRef)(s),x=TV((0,r.useMemo)(()=>({x:o,y:s,width:l,height:c,radius:u}),[o,s,l,c,u]),"rectangle-");if(o!==+o||s!==+s||l!==+l||c!==+c||0===l||0===c)return null;var _=(0,hy.$)("recharts-rectangle",d);if(!g){var w=SI(t),{radius:S}=w,T=RV(w,CV);return r.createElement("path",kV({},T,{radius:"number"===typeof u?u:void 0,className:_,d:LV(o,s,l,c,u)}))}var C=v.current,M=A.current,E=y.current,P=b.current,N="0px ".concat(-1===i?1:i,"px"),k="".concat(i,"px 0px"),R=tV(["strokeDasharray"],p,"string"===typeof h?h:OV.animationEasing);return r.createElement(SV,{animationId:x,key:x,canBegin:i>0,duration:p,easing:h,isActive:g,begin:f},e=>{var i,a=Cy(C,l,e),d=Cy(M,c,e),h=Cy(E,o,e),p=Cy(P,s,e);n.current&&(v.current=a,A.current=d,y.current=h,b.current=p),i=m?e>0?{transition:R,strokeDasharray:k}:{strokeDasharray:N}:{strokeDasharray:k};var f=SI(t),{radius:g}=f,x=RV(f,MV);return r.createElement("path",kV({},x,{radius:"number"===typeof u?u:void 0,className:_,d:LV(h,p,a,d,u),ref:n,style:PV(PV({},i),t.style)}))})};function DV(e){var{cx:t,cy:n,radius:r,startAngle:i,endAngle:a}=e;return{points:[lk(t,n,r,i),lk(t,n,r,a)],cx:t,cy:n,radius:r,startAngle:i,endAngle:a}}function IV(){return IV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},IV.apply(null,arguments)}var BV=e=>{var{cx:t,cy:n,radius:r,angle:i,sign:a,isExternal:o,cornerRadius:s,cornerIsExternal:l}=e,c=s*(o?1:-1)+r,u=Math.asin(s/c)/ok,d=l?i:i+a*u,h=l?i-a*u:i;return{center:lk(t,n,c,d),circleTangency:lk(t,n,r,d),lineTangency:lk(t,n,c*Math.cos(u*ok),h),theta:u}},FV=e=>{var{cx:t,cy:n,innerRadius:r,outerRadius:i,startAngle:a,endAngle:o}=e,s=((e,t)=>vy(t-e)*Math.min(Math.abs(t-e),359.999))(a,o),l=a+s,c=lk(t,n,i,a),u=lk(t,n,i,l),d="M ".concat(c.x,",").concat(c.y,"\n    A ").concat(i,",").concat(i,",0,\n    ").concat(+(Math.abs(s)>180),",").concat(+(a>l),",\n    ").concat(u.x,",").concat(u.y,"\n  ");if(r>0){var h=lk(t,n,r,a),p=lk(t,n,r,l);d+="L ".concat(p.x,",").concat(p.y,"\n            A ").concat(r,",").concat(r,",0,\n            ").concat(+(Math.abs(s)>180),",").concat(+(a<=l),",\n            ").concat(h.x,",").concat(h.y," Z")}else d+="L ".concat(t,",").concat(n," Z");return d},zV={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},UV=e=>{var t=bB(e,zV),{cx:n,cy:i,innerRadius:a,outerRadius:o,cornerRadius:s,forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d,className:h}=t;if(o<a||u===d)return null;var p,f=(0,hy.$)("recharts-sector",h),m=o-a,g=Sy(s,m,0,!0);return p=g>0&&Math.abs(u-d)<360?(e=>{var{cx:t,cy:n,innerRadius:r,outerRadius:i,cornerRadius:a,forceCornerRadius:o,cornerIsExternal:s,startAngle:l,endAngle:c}=e,u=vy(c-l),{circleTangency:d,lineTangency:h,theta:p}=BV({cx:t,cy:n,radius:i,angle:l,sign:u,cornerRadius:a,cornerIsExternal:s}),{circleTangency:f,lineTangency:m,theta:g}=BV({cx:t,cy:n,radius:i,angle:c,sign:-u,cornerRadius:a,cornerIsExternal:s}),v=s?Math.abs(l-c):Math.abs(l-c)-p-g;if(v<0)return o?"M ".concat(h.x,",").concat(h.y,"\n        a").concat(a,",").concat(a,",0,0,1,").concat(2*a,",0\n        a").concat(a,",").concat(a,",0,0,1,").concat(2*-a,",0\n      "):FV({cx:t,cy:n,innerRadius:r,outerRadius:i,startAngle:l,endAngle:c});var A="M ".concat(h.x,",").concat(h.y,"\n    A").concat(a,",").concat(a,",0,0,").concat(+(u<0),",").concat(d.x,",").concat(d.y,"\n    A").concat(i,",").concat(i,",0,").concat(+(v>180),",").concat(+(u<0),",").concat(f.x,",").concat(f.y,"\n    A").concat(a,",").concat(a,",0,0,").concat(+(u<0),",").concat(m.x,",").concat(m.y,"\n  ");if(r>0){var{circleTangency:y,lineTangency:b,theta:x}=BV({cx:t,cy:n,radius:r,angle:l,sign:u,isExternal:!0,cornerRadius:a,cornerIsExternal:s}),{circleTangency:_,lineTangency:w,theta:S}=BV({cx:t,cy:n,radius:r,angle:c,sign:-u,isExternal:!0,cornerRadius:a,cornerIsExternal:s}),T=s?Math.abs(l-c):Math.abs(l-c)-x-S;if(T<0&&0===a)return"".concat(A,"L").concat(t,",").concat(n,"Z");A+="L".concat(w.x,",").concat(w.y,"\n      A").concat(a,",").concat(a,",0,0,").concat(+(u<0),",").concat(_.x,",").concat(_.y,"\n      A").concat(r,",").concat(r,",0,").concat(+(T>180),",").concat(+(u>0),",").concat(y.x,",").concat(y.y,"\n      A").concat(a,",").concat(a,",0,0,").concat(+(u<0),",").concat(b.x,",").concat(b.y,"Z")}else A+="L".concat(t,",").concat(n,"Z");return A})({cx:n,cy:i,innerRadius:a,outerRadius:o,cornerRadius:Math.min(g,m/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d}):FV({cx:n,cy:i,innerRadius:a,outerRadius:o,startAngle:u,endAngle:d}),r.createElement("path",IV({},SI(t),{className:f,d:p}))};function VV(e,t,n){if("horizontal"===e)return[{x:t.x,y:n.top},{x:t.x,y:n.top+n.height}];if("vertical"===e)return[{x:n.left,y:t.y},{x:n.left+n.width,y:t.y}];if(FF(t)){if("centric"===e){var{cx:r,cy:i,innerRadius:a,outerRadius:o,angle:s}=t,l=lk(r,i,a,s),c=lk(r,i,o,s);return[{x:l.x,y:l.y},{x:c.x,y:c.y}]}return DV(t)}}function GV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GV(Object(n),!0).forEach(function(t){WV(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function WV(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var HV=()=>{var e=cS(PR),t=cS($O),n=cS(qO);return IS(e&&n?qV(qV({},e),{},{scale:n}):void 0,t)};function $V(){return $V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$V.apply(null,arguments)}function KV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function XV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KV(Object(n),!0).forEach(function(t){YV(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function YV(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QV(e){var{cursor:t,cursorComp:n,cursorProps:i}=e;return(0,r.isValidElement)(t)?(0,r.cloneElement)(t,i):(0,r.createElement)(n,i)}function ZV(e){var t,n,i,a,{coordinate:o,payload:s,index:l,offset:c,tooltipAxisBandSize:u,layout:d,cursor:h,tooltipEventType:p,chartName:f}=e,m=o,g=s,v=l;if(!h||!m||"ScatterChart"!==f&&"axis"!==p)return null;if("ScatterChart"===f)n=m,i=QU,a=pk.cursorLine;else if("BarChart"===f)n=function(e,t,n,r){var i=r/2;return{stroke:"none",fill:"#ccc",x:"horizontal"===e?t.x-i:n.left+.5,y:"horizontal"===e?n.top+.5:t.y-i,width:"horizontal"===e?r:n.width-1,height:"horizontal"===e?n.height-1:r}}(d,m,c,u),i=jV,a=pk.cursorRectangle;else if("radial"===d&&FF(m)){var{cx:A,cy:y,radius:b,startAngle:x,endAngle:_}=DV(m);n={cx:A,cy:y,startAngle:x,endAngle:_,innerRadius:b,outerRadius:b},i=UV,a=pk.cursorLine}else n={points:VV(d,m,c)},i=WU,a=pk.cursorLine;var w="object"===typeof h&&"className"in h?h.className:void 0,S=XV(XV(XV(XV({stroke:"#ccc",pointerEvents:"none"},c),n),wI(h)),{},{payload:g,payloadIndex:v,className:(0,hy.$)("recharts-tooltip-cursor",w)});return r.createElement(xF,{zIndex:null!==(t=e.zIndex)&&void 0!==t?t:a},r.createElement(QV,{cursor:h,cursorComp:i,cursorProps:S}))}function JV(e){var t=HV(),n=sT(),i=dT(),a=hj();return null==t||null==n||null==i||null==a?null:r.createElement(ZV,$V({},e,{offset:n,layout:i,tooltipAxisBandSize:t,chartName:a}))}function eG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eG(Object(n),!0).forEach(function(t){nG(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nG(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rG(e){return e.dataKey}var iG=[],aG={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:"auto",itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function oG(e){var t,n,i=bB(e,aG),{active:a,allowEscapeViewBox:o,animationDuration:s,animationEasing:l,content:c,filterNull:u,isAnimationActive:d,offset:h,payloadUniqBy:p,position:f,reverseDirection:m,useTranslate3d:g,wrapperStyle:v,cursor:A,shared:y,trigger:b,defaultIndex:x,portal:_,axisId:w}=i,S=aS(),T="number"===typeof x?String(x):x;(0,r.useEffect)(()=>{S(Cw({shared:y,trigger:b,axisId:w,active:a,defaultIndex:T}))},[S,y,b,w,a,T]);var C=aT(),M=gI(),E=function(e){return cS(t=>ZL(t,e))}(y),{activeIndex:P,isActive:N}=null!==(t=cS(e=>Sj(e,E,b,T)))&&void 0!==t?t:{},k=cS(e=>wj(e,E,b,T)),R=cS(e=>_j(e,E,b,T)),L=cS(e=>xj(e,E,b,T)),O=k,j=(0,r.useContext)(ZI),D=null!==(n=null!==a&&void 0!==a?a:N)&&void 0!==n&&n,[I,B]=iU([O,D]),F="axis"===E?R:void 0;QI(E,b,L,F,P,D);var z=null!==_&&void 0!==_?_:j;if(null==z||null==C||null==E)return null;var U=null!==O&&void 0!==O?O:iG;D||(U=iG),u&&U.length&&(U=rU(U.filter(e=>null!=e.value&&(!0!==e.hide||i.includeHidden)),p,rG));var V=U.length>0,G=r.createElement(eU,{allowEscapeViewBox:o,animationDuration:s,animationEasing:l,isAnimationActive:d,active:D,coordinate:L,hasPayload:V,offset:h,position:f,reverseDirection:m,useTranslate3d:g,viewBox:C,wrapperStyle:v,lastBoundingBox:I,innerRef:B,hasPortalFromProps:Boolean(_)},function(e,t){return r.isValidElement(e)?r.cloneElement(e,t):"function"===typeof e?r.createElement(e,t):r.createElement(Hz,t)}(c,tG(tG({},i),{},{payload:U,label:F,active:D,activeIndex:P,coordinate:L,accessibilityLayer:M})));return r.createElement(r.Fragment,null,(0,Ca.createPortal)(G,z),D&&r.createElement(JV,{cursor:A,tooltipEventType:E,coordinate:L,payload:U,index:P}))}var sG=n(356),lG=n.n(sG),cG=["valueAccessor"],uG=["dataKey","clockWise","id","textBreakAll","zIndex"];function dG(){return dG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dG.apply(null,arguments)}function hG(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var pG=e=>Array.isArray(e.value)?lG()(e.value):e.value,fG=(0,r.createContext)(void 0),mG=fG.Provider,gG=(0,r.createContext)(void 0),vG=gG.Provider;function AG(e){var{valueAccessor:t=pG}=e,n=hG(e,cG),{dataKey:i,clockWise:a,id:o,textBreakAll:s,zIndex:l}=n,c=hG(n,uG),u=(0,r.useContext)(fG),d=(0,r.useContext)(gG),h=u||d;return h&&h.length?r.createElement(xF,{zIndex:null!==l&&void 0!==l?l:pk.label},r.createElement($B,{className:"recharts-label-list"},h.map((e,a)=>{var l,u=Ey(i)?t(e,a):SS(e&&e.payload,i),d=Ey(o)?{}:{id:"".concat(o,"-").concat(a)};return r.createElement(DF,dG({key:"label-".concat(a)},SI(e),c,d,{fill:null!==(l=n.fill)&&void 0!==l?l:e.fill,parentViewBox:e.parentViewBox,value:u,textBreakAll:s,viewBox:e.viewBox,index:a,zIndex:0}))}))):null}function yG(e){var{label:t}=e;return t?!0===t?r.createElement(AG,{key:"labelList-implicit"}):r.isValidElement(t)||RF(t)?r.createElement(AG,{key:"labelList-implicit",content:t}):"object"===typeof t?r.createElement(AG,dG({key:"labelList-implicit"},t,{type:String(t.type)})):null:null}function bG(){return bG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bG.apply(null,arguments)}AG.displayName="LabelList";var xG=e=>{var{cx:t,cy:n,r:i,className:a}=e,o=(0,hy.$)("recharts-dot",a);return by(t)&&by(n)&&by(i)?r.createElement("circle",bG({},_I(e),zF(e),{className:o,cx:t,cy:n,r:i})):null},_G=n(2086),wG=e=>"string"===typeof e?e:e?e.displayName||e.name||"Component":"",SG=null,TG=null,CG=e=>{if(e===SG&&Array.isArray(TG))return TG;var t=[];return r.Children.forEach(e,e=>{Ey(e)||((0,_G.isFragment)(e)?t=t.concat(CG(e.props.children)):t.push(e))}),TG=t,SG=e,t};function MG(e,t){var n=[],r=[];return r=Array.isArray(t)?t.map(e=>wG(e)):[wG(t)],CG(e).forEach(e=>{var t=gy()(e,"type.displayName")||gy()(e,"type.name");t&&-1!==r.indexOf(t)&&n.push(e)}),n}var EG=e=>!e||"object"!==typeof e||!("clipDot"in e)||Boolean(e.clipDot),PG=["points"];function NG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function kG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NG(Object(n),!0).forEach(function(t){RG(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function RG(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LG(){return LG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},LG.apply(null,arguments)}function OG(e){var{option:t,dotProps:n,className:i}=e;if((0,r.isValidElement)(t))return(0,r.cloneElement)(t,n);if("function"===typeof t)return t(n);var a=(0,hy.$)(i,"boolean"!==typeof t?t.className:""),o=null!==n&&void 0!==n?n:{},{points:s}=o,l=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(o,PG);return r.createElement(xG,LG({},l,{className:a}))}function jG(e){var{points:t,dot:n,className:i,dotClassName:a,dataKey:o,baseProps:s,needClip:l,clipPathId:c,zIndex:u=pk.scatter}=e;if(!function(e,t){return null!=e&&(!!t||1===e.length)}(t,n))return null;var d,h=EG(n),p=null==(d=n)?null:(0,r.isValidElement)(d)?SI(d.props):"object"!==typeof d||Array.isArray(d)?null:SI(d),f=t.map((e,i)=>{var l,c,u=kG(kG(kG({r:3},s),p),{},{index:i,cx:null!==(l=e.x)&&void 0!==l?l:void 0,cy:null!==(c=e.y)&&void 0!==c?c:void 0,dataKey:o,value:e.value,payload:e.payload,points:t});return r.createElement(OG,{key:"dot-".concat(i),option:n,dotProps:u,className:a})}),m={};return l&&null!=c&&(m.clipPath="url(#clipPath-".concat(h?"":"dots-").concat(c,")")),r.createElement(xF,{zIndex:u},r.createElement($B,LG({className:i},m),f))}function DG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function IG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DG(Object(n),!0).forEach(function(t){BG(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function BG(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var FG=e=>{var{point:t,childIndex:n,mainColor:i,activeDot:a,dataKey:o,clipPath:s}=e;if(!1===a||null==t.x||null==t.y)return null;var l,c=IG(IG(IG({},{index:n,dataKey:o,cx:t.x,cy:t.y,r:4,fill:null!==i&&void 0!==i?i:"none",strokeWidth:2,stroke:"#fff",payload:t.payload,value:t.value}),wI(a)),zF(a));return l=(0,r.isValidElement)(a)?(0,r.cloneElement)(a,c):"function"===typeof a?a(c):r.createElement(xG,c),r.createElement($B,{className:"recharts-active-dot",clipPath:s},l)};function zG(e){var{points:t,mainColor:n,activeDot:i,itemDataKey:a,clipPath:o,zIndex:s=pk.activeDot}=e,l=cS(ZO),c=cS(sj);if(null==t||null==c)return null;var u=t.find(e=>c.includes(e.payload));return Ey(u)?null:r.createElement(xF,{zIndex:s},r.createElement(FG,{point:u,childIndex:Number(l),mainColor:n,dataKey:a,activeDot:i,clipPath:o}))}function UG(e){var{tooltipEntrySettings:t}=e,n=aS(),i=tT(),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{i||(null===a.current?n(ww(t)):a.current!==t&&n(Sw({prev:a.current,next:t})),a.current=t)},[t,n,i]),(0,r.useLayoutEffect)(()=>()=>{a.current&&(n(Tw(a.current)),a.current=null)},[n]),null}function VG(e,t){var n,r,i=cS(t=>nR(t,e)),a=cS(e=>aR(e,t)),o=null!==(n=null===i||void 0===i?void 0:i.allowDataOverflow)&&void 0!==n?n:eR.allowDataOverflow,s=null!==(r=null===a||void 0===a?void 0:a.allowDataOverflow)&&void 0!==r?r:rR.allowDataOverflow;return{needClip:o||s,needClipX:o,needClipY:s}}function GG(e){var{xAxisId:t,yAxisId:n,clipPathId:i}=e,a=pB(),{needClipX:o,needClipY:s,needClip:l}=VG(t,n);if(!l||!a)return null;var{x:c,y:u,width:d,height:h}=a;return r.createElement("clipPath",{id:"clipPath-".concat(i)},r.createElement("rect",{x:o?c:c-d/2,y:s?u:u-h/2,width:o?d:2*d,height:s?h:2*h}))}var qG=(e,t,n,r)=>HL(e,"xAxis",t,r),WG=(e,t,n,r)=>WL(e,"xAxis",t,r),HG=(e,t,n,r)=>HL(e,"yAxis",n,r),$G=(e,t,n,r)=>WL(e,"yAxis",n,r),KG=eS([uT,qG,HG,WG,$G],(e,t,n,r,i)=>TS(e,"xAxis")?IS(t,r,!1):IS(n,i,!1)),XG=eS([hR,(e,t,n,r,i)=>i],(e,t)=>e.filter(e=>"area"===e.type).find(e=>e.id===t)),YG=eS([uT,qG,HG,WG,$G,(e,t,n,r,i)=>{var a,o=XG(e,t,n,r,i);if(null!=o){var s,l=uT(e);if(null!=(s=TS(l,"xAxis")?LR(e,"yAxis",n,r):LR(e,"xAxis",t,r))){var{stackId:c}=o,u=Gk(o);if(null!=c&&null!=u){var d=null===(a=s[c])||void 0===a?void 0:a.stackedData;return null===d||void 0===d?void 0:d.find(e=>e.key===u)}}}},EN,KG,XG,e=>e.rootProps.baseValue],(e,t,n,r,i,a,o,s,l,c)=>{var{chartData:u,dataStartIndex:d,dataEndIndex:h}=o;if(null!=l&&("horizontal"===e||"vertical"===e)&&null!=t&&null!=n&&null!=r&&null!=i&&0!==r.length&&0!==i.length&&null!=s){var p,{data:f}=l;if(null!=(p=f&&f.length>0?f:null===u||void 0===u?void 0:u.slice(d,h+1)))return function(e){var t,{areaSettings:{connectNulls:n,baseValue:r,dataKey:i},stackedData:a,layout:o,chartBaseValue:s,xAxis:l,yAxis:c,displayedData:u,dataStartIndex:d,xAxisTicks:h,yAxisTicks:p,bandSize:f}=e,m=a&&a.length,g=Tq(o,s,r,l,c),v="horizontal"===o,A=!1,y=u.map((e,t)=>{var r;m?r=a[d+t]:(r=SS(e,i),Array.isArray(r)?A=!0:r=[g,r]);var o=null==r[1]||m&&!n&&null==SS(e,i);return v?{x:RS({axis:l,ticks:h,bandSize:f,entry:e,index:t}),y:o?null:c.scale(r[1]),value:r,payload:e}:{x:o?null:l.scale(r[1]),y:RS({axis:c,ticks:p,bandSize:f,entry:e,index:t}),value:r,payload:e}});t=m||A?y.map(e=>{var t=Array.isArray(e.value)?e.value[0]:null;return v?{x:e.x,y:null!=t&&null!=e.y?c.scale(t):null,payload:e.payload}:{x:null!=t?l.scale(t):null,y:e.y,payload:e.payload}}):v?c.scale(g):l.scale(g);return{points:y,baseLine:t,isRange:A}}({layout:e,xAxis:t,yAxis:n,xAxisTicks:r,yAxisTicks:i,dataStartIndex:d,areaSettings:l,stackedData:a,displayedData:p,chartBaseValue:c,bandSize:s})}});function QG(e){var{legendPayload:t}=e,n=aS(),i=tT(),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{i||(null===a.current?n(vD(t)):a.current!==t&&n(AD({prev:a.current,next:t})),a.current=t)},[n,i,t]),(0,r.useLayoutEffect)(()=>()=>{a.current&&(n(yD(a.current)),a.current=null)},[n]),null}function ZG(e){var{legendPayload:t}=e,n=aS(),i=cS(uT),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{"centric"!==i&&"radial"!==i||(null===a.current?n(vD(t)):a.current!==t&&n(AD({prev:a.current,next:t})),a.current=t)},[n,i,t]),(0,r.useLayoutEffect)(()=>()=>{a.current&&(n(yD(a.current)),a.current=null)},[n]),null}var JG=(0,r.createContext)(void 0),eq=e=>{var{id:t,type:n,children:i}=e,a=NI("recharts-".concat(n),t);return r.createElement(JG.Provider,{value:a},i(a))};var tq=e=>{var t=aS(),n=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{null===n.current?t(Yj(e)):n.current!==e&&t(Qj({prev:n.current,next:e})),n.current=e},[t,e]),(0,r.useLayoutEffect)(()=>()=>{n.current&&(t(Zj(n.current)),n.current=null)},[t]),null},nq=(0,r.memo)(tq);function rq(e){var t=aS();return(0,r.useLayoutEffect)(()=>(t(Jj(e)),()=>{t(eD(e))}),[t,e]),null}var iq=["id"],aq=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function oq(){return oq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},oq.apply(null,arguments)}function sq(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function lq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lq(Object(n),!0).forEach(function(t){uq(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function uq(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dq(e,t){return e&&"none"!==e?e:t}var hq=e=>{var{dataKey:t,name:n,stroke:r,fill:i,legendType:a,hide:o}=e;return[{inactive:o,dataKey:t,type:a,color:dq(r,i),value:FS(n,t),payload:e}]},pq=r.memo(e=>{var{dataKey:t,data:n,stroke:i,strokeWidth:a,fill:o,name:s,hide:l,unit:c,tooltipType:u}=e,d={dataDefinedOnItem:n,positions:void 0,settings:{stroke:i,strokeWidth:a,fill:o,dataKey:t,nameKey:void 0,name:FS(s,t),hide:l,type:u,color:dq(i,o),unit:c}};return r.createElement(UG,{tooltipEntrySettings:d})});function fq(e){var{clipPathId:t,points:n,props:i}=e,{needClip:a,dot:o,dataKey:s}=i,l=_I(i);return r.createElement(jG,{points:n,dot:o,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:s,baseProps:l,needClip:a,clipPathId:t})}function mq(e){var{showLabels:t,children:n,points:i}=e,a=i.map(e=>{var t,n,r={x:null!==(t=e.x)&&void 0!==t?t:0,y:null!==(n=e.y)&&void 0!==n?n:0,width:0,lowerWidth:0,upperWidth:0,height:0};return cq(cq({},r),{},{value:e.value,payload:e.payload,parentViewBox:void 0,viewBox:r,fill:void 0})});return r.createElement(mG,{value:t?a:void 0},n)}function gq(e){var{points:t,baseLine:n,needClip:i,clipPathId:a,props:o}=e,{layout:s,type:l,stroke:c,connectNulls:u,isRange:d}=o,{id:h}=o,p=sq(o,iq),f=_I(p),m=SI(p);return r.createElement(r.Fragment,null,(null===t||void 0===t?void 0:t.length)>1&&r.createElement($B,{clipPath:i?"url(#clipPath-".concat(a,")"):void 0},r.createElement(WU,oq({},m,{id:h,points:t,connectNulls:u,type:l,baseLine:n,layout:s,stroke:"none",className:"recharts-area-area"})),"none"!==c&&r.createElement(WU,oq({},f,{className:"recharts-area-curve",layout:s,type:l,connectNulls:u,fill:"none",points:t})),"none"!==c&&d&&r.createElement(WU,oq({},f,{className:"recharts-area-curve",layout:s,type:l,connectNulls:u,fill:"none",points:n}))),r.createElement(fq,{points:t,props:p,clipPathId:a}))}function vq(e){var{alpha:t,baseLine:n,points:i,strokeWidth:a}=e,o=i[0].y,s=i[i.length-1].y;if(!Fy(o)||!Fy(s))return null;var l=t*Math.abs(o-s),c=Math.max(...i.map(e=>e.x||0));return by(n)?c=Math.max(n,c):n&&Array.isArray(n)&&n.length&&(c=Math.max(...n.map(e=>e.x||0),c)),by(c)?r.createElement("rect",{x:0,y:o<s?o:o-l,width:c+(a?parseInt("".concat(a),10):1),height:Math.floor(l)}):null}function Aq(e){var{alpha:t,baseLine:n,points:i,strokeWidth:a}=e,o=i[0].x,s=i[i.length-1].x;if(!Fy(o)||!Fy(s))return null;var l=t*Math.abs(o-s),c=Math.max(...i.map(e=>e.y||0));return by(n)?c=Math.max(n,c):n&&Array.isArray(n)&&n.length&&(c=Math.max(...n.map(e=>e.y||0),c)),by(c)?r.createElement("rect",{x:o<s?o:o-l,y:0,width:l,height:Math.floor(c+(a?parseInt("".concat(a),10):1))}):null}function yq(e){var{alpha:t,layout:n,points:i,baseLine:a,strokeWidth:o}=e;return"vertical"===n?r.createElement(vq,{alpha:t,points:i,baseLine:a,strokeWidth:o}):r.createElement(Aq,{alpha:t,points:i,baseLine:a,strokeWidth:o})}function bq(e){var{needClip:t,clipPathId:n,props:i,previousPointsRef:a,previousBaselineRef:o}=e,{points:s,baseLine:l,isAnimationActive:c,animationBegin:u,animationDuration:d,animationEasing:h,onAnimationStart:p,onAnimationEnd:f}=i,m=TV((0,r.useMemo)(()=>({points:s,baseLine:l}),[s,l]),"recharts-area-"),g=(()=>{var e=dT();if("horizontal"===e||"vertical"===e)return e})(),[v,A]=(0,r.useState)(!1),y=!v,b=(0,r.useCallback)(()=>{"function"===typeof f&&f(),A(!1)},[f]),x=(0,r.useCallback)(()=>{"function"===typeof p&&p(),A(!0)},[p]);if(null==g)return null;var _=a.current,w=o.current;return r.createElement(mq,{showLabels:y,points:s},i.children,r.createElement(SV,{animationId:m,begin:u,duration:d,isActive:c,easing:h,onAnimationEnd:b,onAnimationStart:x,key:m},e=>{if(_){var u,d=_.length/s.length,h=1===e?s:s.map((t,n)=>{var r=Math.floor(n*d);if(_[r]){var i=_[r];return cq(cq({},t),{},{x:Cy(i.x,t.x,e),y:Cy(i.y,t.y,e)})}return t});return u=by(l)?Cy(w,l,e):Ey(l)||Ay(l)?Cy(w,0,e):l.map((t,n)=>{var r=Math.floor(n*d);if(Array.isArray(w)&&w[r]){var i=w[r];return cq(cq({},t),{},{x:Cy(i.x,t.x,e),y:Cy(i.y,t.y,e)})}return t}),e>0&&(a.current=h,o.current=u),r.createElement(gq,{points:h,baseLine:u,needClip:t,clipPathId:n,props:i})}return e>0&&(a.current=s,o.current=l),r.createElement($B,null,c&&r.createElement("defs",null,r.createElement("clipPath",{id:"animationClipPath-".concat(n)},r.createElement(yq,{alpha:e,points:s,baseLine:l,layout:g,strokeWidth:i.strokeWidth}))),r.createElement($B,{clipPath:"url(#animationClipPath-".concat(n,")")},r.createElement(gq,{points:s,baseLine:l,needClip:t,clipPathId:n,props:i})))}),r.createElement(yG,{label:i.label}))}function xq(e){var{needClip:t,clipPathId:n,props:i}=e,a=(0,r.useRef)(null),o=(0,r.useRef)();return r.createElement(bq,{needClip:t,clipPathId:n,props:i,previousPointsRef:a,previousBaselineRef:o})}class _q extends r.PureComponent{render(){var{hide:e,dot:t,points:n,className:i,top:a,left:o,needClip:s,xAxisId:l,yAxisId:c,width:u,height:d,id:h,baseLine:p,zIndex:f}=this.props;if(e)return null;var m=(0,hy.$)("recharts-area",i),g=h,{r:v,strokeWidth:A}=function(e){var t=wI(e);if(null!=t){var{r:n,strokeWidth:r}=t,i=Number(n),a=Number(r);return(Number.isNaN(i)||i<0)&&(i=3),(Number.isNaN(a)||a<0)&&(a=2),{r:i,strokeWidth:a}}return{r:3,strokeWidth:2}}(t),y=EG(t),b=2*v+A,x=s?"url(#clipPath-".concat(y?"":"dots-").concat(g,")"):void 0;return r.createElement(xF,{zIndex:f},r.createElement($B,{className:m},s&&r.createElement("defs",null,r.createElement(GG,{clipPathId:g,xAxisId:l,yAxisId:c}),!y&&r.createElement("clipPath",{id:"clipPath-dots-".concat(g)},r.createElement("rect",{x:o-b/2,y:a-b/2,width:u+b,height:d+b}))),r.createElement(xq,{needClip:s,clipPathId:g,props:this.props})),r.createElement(zG,{points:n,mainColor:dq(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:x}),this.props.isRange&&Array.isArray(p)&&r.createElement(zG,{points:p,mainColor:dq(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:x}))}}var wq={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:pk.area};function Sq(e){var t,n=bB(e,wq),{activeDot:i,animationBegin:a,animationDuration:o,animationEasing:s,connectNulls:l,dot:c,fill:u,fillOpacity:d,hide:h,isAnimationActive:p,legendType:f,stroke:m,xAxisId:g,yAxisId:v}=n,A=sq(n,aq),y=dT(),b=hj(),{needClip:x}=VG(g,v),_=tT(),{points:w,isRange:S,baseLine:T}=null!==(t=cS(t=>YG(t,g,v,_,e.id)))&&void 0!==t?t:{},C=pB();if("horizontal"!==y&&"vertical"!==y||null==C)return null;if("AreaChart"!==b&&"ComposedChart"!==b)return null;var{height:M,width:E,x:P,y:N}=C;return w&&w.length?r.createElement(_q,oq({},A,{activeDot:i,animationBegin:a,animationDuration:o,animationEasing:s,baseLine:T,connectNulls:l,dot:c,fill:u,fillOpacity:d,height:M,hide:h,layout:y,isAnimationActive:"auto"===p?!YD:p,isRange:S,legendType:f,needClip:x,points:w,stroke:m,width:E,left:P,top:N,xAxisId:g,yAxisId:v})):null}var Tq=(e,t,n,r,i)=>{var a=null!==n&&void 0!==n?n:t;if(by(a))return a;var o="horizontal"===e?i:r,s=o.scale.domain();if("number"===o.type){var l=Math.max(s[0],s[1]),c=Math.min(s[0],s[1]);return"dataMin"===a?c:"dataMax"===a||l<0?l:Math.max(Math.min(s[0],s[1]),0)}return"dataMin"===a?s[0]:"dataMax"===a?s[1]:s[0]};function Cq(e){var t=bB(e,wq),n=tT();return r.createElement(eq,{id:t.id,type:"area"},e=>r.createElement(r.Fragment,null,r.createElement(QG,{legendPayload:hq(t)}),r.createElement(pq,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType}),r.createElement(nq,{type:"area",id:e,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:kS(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:n,connectNulls:t.connectNulls}),r.createElement(Sq,oq({},t,{id:e}))))}var Mq=r.memo(Cq,hI);Mq.displayName="Area";var Eq=["axis","item"],Pq=(0,r.forwardRef)((e,t)=>r.createElement(wB,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Eq,tooltipPayloadSearcher:m_,categoricalChartProps:e,ref:t})),Nq=e=>null;Nq.displayName="Cell";var kq="Invariant failed";var Rq=n(9397),Lq=n.n(Rq);function Oq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oq(Object(n),!0).forEach(function(t){Dq(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Dq(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Iq(){return Iq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Iq.apply(null,arguments)}var Bq=(e,t,n,r,i)=>{var a,o=n-r;return a="M ".concat(e,",").concat(t),a+="L ".concat(e+n,",").concat(t),a+="L ".concat(e+n-o/2,",").concat(t+i),a+="L ".concat(e+n-o/2-r,",").concat(t+i),a+="L ".concat(e,",").concat(t," Z")},Fq={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},zq=e=>{var t=bB(e,Fq),{x:n,y:i,upperWidth:a,lowerWidth:o,height:s,className:l}=t,{animationEasing:c,animationDuration:u,animationBegin:d,isUpdateAnimationActive:h}=t,p=(0,r.useRef)(null),[f,m]=(0,r.useState)(-1),g=(0,r.useRef)(a),v=(0,r.useRef)(o),A=(0,r.useRef)(s),y=(0,r.useRef)(n),b=(0,r.useRef)(i),x=TV(e,"trapezoid-");if((0,r.useEffect)(()=>{if(p.current&&p.current.getTotalLength)try{var e=p.current.getTotalLength();e&&m(e)}catch(t){}},[]),n!==+n||i!==+i||a!==+a||o!==+o||s!==+s||0===a&&0===o||0===s)return null;var _=(0,hy.$)("recharts-trapezoid",l);if(!h)return r.createElement("g",null,r.createElement("path",Iq({},SI(t),{className:_,d:Bq(n,i,a,o,s)})));var w=g.current,S=v.current,T=A.current,C=y.current,M=b.current,E="0px ".concat(-1===f?1:f,"px"),P="".concat(f,"px 0px"),N=tV(["strokeDasharray"],u,c);return r.createElement(SV,{animationId:x,key:x,canBegin:f>0,duration:u,easing:c,isActive:h,begin:d},e=>{var l=Cy(w,a,e),c=Cy(S,o,e),u=Cy(T,s,e),d=Cy(C,n,e),h=Cy(M,i,e);p.current&&(g.current=l,v.current=c,A.current=u,y.current=d,b.current=h);var f=e>0?{transition:N,strokeDasharray:P}:{strokeDasharray:E};return r.createElement("path",Iq({},SI(t),{className:_,d:Bq(d,h,l,c,u),ref:p,style:jq(jq({},f),t.style)}))})};Math.abs,Math.atan2;const Uq=Math.cos,Vq=(Math.max,Math.min,Math.sin),Gq=Math.sqrt,qq=Math.PI,Wq=2*qq;var Hq={draw(e,t){const n=Gq(t/qq);e.moveTo(n,0),e.arc(0,0,n,0,Wq)}},$q={draw(e,t){const n=Gq(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}};const Kq=Gq(1/3),Xq=2*Kq;var Yq={draw(e,t){const n=Gq(t/Xq),r=n*Kq;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}},Qq={draw(e,t){const n=Gq(t),r=-n/2;e.rect(r,r,n,n)}};const Zq=Vq(qq/10)/Vq(7*qq/10),Jq=Vq(Wq/10)*Zq,eW=-Uq(Wq/10)*Zq;var tW={draw(e,t){const n=Gq(.8908130915292852*t),r=Jq*n,i=eW*n;e.moveTo(0,-n),e.lineTo(r,i);for(let a=1;a<5;++a){const t=Wq*a/5,o=Uq(t),s=Vq(t);e.lineTo(s*n,-o*n),e.lineTo(o*r-s*i,s*r+o*i)}e.closePath()}};const nW=Gq(3);var rW={draw(e,t){const n=-Gq(t/(3*nW));e.moveTo(0,2*n),e.lineTo(-nW*n,-n),e.lineTo(nW*n,-n),e.closePath()}};const iW=-.5,aW=Gq(3)/2,oW=1/Gq(12),sW=3*(oW/2+1);var lW={draw(e,t){const n=Gq(t/sW),r=n/2,i=n*oW,a=r,o=n*oW+n,s=-a,l=o;e.moveTo(r,i),e.lineTo(a,o),e.lineTo(s,l),e.lineTo(iW*r-aW*i,aW*r+iW*i),e.lineTo(iW*a-aW*o,aW*a+iW*o),e.lineTo(iW*s-aW*l,aW*s+iW*l),e.lineTo(iW*r+aW*i,iW*i-aW*r),e.lineTo(iW*a+aW*o,iW*o-aW*a),e.lineTo(iW*s+aW*l,iW*l-aW*s),e.closePath()}};Gq(3);Gq(3);var cW=["type","size","sizeType"];function uW(){return uW=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},uW.apply(null,arguments)}function dW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function hW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dW(Object(n),!0).forEach(function(t){pW(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function pW(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fW={symbolCircle:Hq,symbolCross:$q,symbolDiamond:Yq,symbolSquare:Qq,symbolStar:tW,symbolTriangle:rW,symbolWye:lW},mW=Math.PI/180,gW=e=>{var{type:t="circle",size:n=64,sizeType:i="area"}=e,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,cW),o=hW(hW({},a),{},{type:t,size:n,sizeType:i}),s="circle";"string"===typeof t&&(s=t);var{className:l,cx:c,cy:u}=o,d=SI(o);return by(c)&&by(u)&&by(n)?r.createElement("path",uW({},d,{className:(0,hy.$)("recharts-symbols",l),transform:"translate(".concat(c,", ").concat(u,")"),d:(()=>{var e=(e=>{var t="symbol".concat(Py(e));return fW[t]||Hq})(s),t=function(e,t){let n=null,r=NU(i);function i(){let i;if(n||(n=i=r()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return e="function"===typeof e?e:gS(e||Hq),t="function"===typeof t?t:gS(void 0===t?64:+t),i.type=function(t){return arguments.length?(e="function"===typeof t?t:gS(t),i):e},i.size=function(e){return arguments.length?(t="function"===typeof e?e:gS(+e),i):t},i.context=function(e){return arguments.length?(n=null==e?null:e,i):n},i}().type(e).size(((e,t,n)=>{if("area"===t)return e;switch(n){case"cross":return 5*e*e/9;case"diamond":return.5*e*e/Math.sqrt(3);case"square":return e*e;case"star":var r=18*mW;return 1.25*e*e*(Math.tan(r)-Math.tan(2*r)*Math.tan(r)**2);case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}})(n,i,s)),r=t();if(null!==r)return r})()})):null};gW.registerSymbol=(e,t)=>{fW["symbol".concat(Py(e))]=t};var vW=["option","shapeType","propTransformer","activeClassName"];function AW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function yW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AW(Object(n),!0).forEach(function(t){bW(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function bW(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xW(e,t){return yW(yW({},t),e)}function _W(e){var{shapeType:t,elementProps:n}=e;switch(t){case"rectangle":return r.createElement(jV,n);case"trapezoid":return r.createElement(zq,n);case"sector":return r.createElement(UV,n);case"symbols":if(function(e){return"symbols"===e}(t))return r.createElement(gW,n);break;case"curve":return r.createElement(WU,n);default:return null}}function wW(e){var t,{option:n,shapeType:i,propTransformer:a=xW,activeClassName:o="recharts-active-shape"}=e,s=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,vW);if((0,r.isValidElement)(n))t=(0,r.cloneElement)(n,yW(yW({},s),function(e){return(0,r.isValidElement)(e)?e.props:e}(n)));else if("function"===typeof n)t=n(s,s.index);else if(Lq()(n)&&"boolean"!==typeof n){var l=a(n,s);t=r.createElement(_W,{shapeType:i,elementProps:l})}else{var c=s;t=r.createElement(_W,{shapeType:i,elementProps:c})}return s.isActive?r.createElement($B,{className:o},t):t}var SW=["x","y"];function TW(){return TW=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TW.apply(null,arguments)}function CW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function MW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CW(Object(n),!0).forEach(function(t){EW(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function EW(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function PW(e,t){var{x:n,y:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,SW),a="".concat(n),o=parseInt(a,10),s="".concat(r),l=parseInt(s,10),c="".concat(t.height||i.height),u=parseInt(c,10),d="".concat(t.width||i.width),h=parseInt(d,10);return MW(MW(MW(MW(MW({},t),i),o?{x:o}:{}),l?{y:l}:{}),{},{height:u,width:h,name:t.name,radius:t.radius})}function NW(e){return r.createElement(wW,TW({shapeType:"rectangle",propTransformer:PW,activeClassName:"recharts-active-bar"},e))}var kW=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(n,r)=>{if(by(e))return e;var i=by(n)||Ey(n);return i?e(n,r):(i||function(e){if(!e)throw new Error(kq)}(!1,"minPointSize callback function received a value with type of ".concat(typeof n,". Currently only numbers or null/undefined are supported.")),t)}},RW=(e,t,n)=>{var r=aS();return(i,a)=>o=>{null===e||void 0===e||e(i,a,o),r(Mw({activeIndex:String(a),activeDataKey:t,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:n}))}},LW=e=>{var t=aS();return(n,r)=>i=>{null===e||void 0===e||e(n,r,i),t(Ew())}},OW=(e,t,n)=>{var r=aS();return(i,a)=>o=>{null===e||void 0===e||e(i,a,o),r(Nw({activeIndex:String(a),activeDataKey:t,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:n}))}},jW=["children"];var DW={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},IW=(0,r.createContext)(DW);function BW(e){var{children:t}=e,n=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,jW);return r.createElement(IW.Provider,{value:n},t)}function FW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function zW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?FW(Object(n),!0).forEach(function(t){UW(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function UW(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var VW=eS([hR,(e,t,n,r,i)=>i],(e,t)=>e.filter(e=>"bar"===e.type).find(e=>e.id===t)),GW=eS([VW],e=>null===e||void 0===e?void 0:e.maxBarSize),qW=(e,t,n)=>{var r=null!==n&&void 0!==n?n:e;if(!Ey(r))return Sy(r,t,0)},WW=eS([uT,hR,(e,t)=>t,(e,t,n)=>n,(e,t,n,r)=>r],(e,t,n,r,i)=>t.filter(t=>"horizontal"===e?t.xAxisId===n:t.yAxisId===r).filter(e=>e.isPanorama===i).filter(e=>!1===e.hide).filter(e=>"bar"===e.type)),HW=eS([WW,e=>e.rootProps.barSize,(e,t,n)=>"horizontal"===uT(e)?BL(e,"xAxis",t):BL(e,"yAxis",n)],(e,t,n)=>{var r=e.filter(Wk),i=e.filter(e=>null==e.stackId),a=r.reduce((e,t)=>(e[t.stackId]||(e[t.stackId]=[]),e[t.stackId].push(t),e),{}),o=Object.entries(a).map(e=>{var[r,i]=e,a=i.map(e=>e.dataKey);return{stackId:r,dataKeys:a,barSize:qW(t,n,i[0].barSize)}}),s=i.map(e=>({stackId:void 0,dataKeys:[e.dataKey].filter(e=>null!=e),barSize:qW(t,n,e.barSize)}));return[...o,...s]}),$W=(e,t,n,r)=>{var i,a;return"horizontal"===uT(e)?(i=HL(e,"xAxis",t,r),a=WL(e,"xAxis",t,r)):(i=HL(e,"yAxis",n,r),a=WL(e,"yAxis",n,r)),IS(i,a)};var KW=eS([HW,XN,e=>e.rootProps.barGap,YN,(e,t,n,r,i)=>{var a,o,s=VW(e,t,n,r,i);if(null!=s){var l,c,u=uT(e),d=XN(e),{maxBarSize:h}=s,p=Ey(h)?d:h;return"horizontal"===u?(l=HL(e,"xAxis",t,r),c=WL(e,"xAxis",t,r)):(l=HL(e,"yAxis",n,r),c=WL(e,"yAxis",n,r)),null!==(a=null!==(o=IS(l,c,!0))&&void 0!==o?o:p)&&void 0!==a?a:0}},$W,GW],(e,t,n,r,i,a,o)=>{var s=Ey(o)?t:o,l=function(e,t,n,r,i){var a=r.length;if(!(a<1)){var o,s=Sy(e,n,0,!0),l=[];if(Fy(r[0].barSize)){var c=!1,u=n/a,d=r.reduce((e,t)=>e+(t.barSize||0),0);(d+=(a-1)*s)>=n&&(d-=(a-1)*s,s=0),d>=n&&u>0&&(c=!0,d=a*(u*=.9));var h={offset:((n-d)/2|0)-s,size:0};o=r.reduce((e,t)=>{var n,r=[...e,{stackId:t.stackId,dataKeys:t.dataKeys,position:{offset:h.offset+h.size+s,size:c?u:null!==(n=t.barSize)&&void 0!==n?n:0}}];return h=r[r.length-1].position,r},l)}else{var p=Sy(t,n,0,!0);n-2*p-(a-1)*s<=0&&(s=0);var f=(n-2*p-(a-1)*s)/a;f>1&&(f>>=0);var m=Fy(i)?Math.min(f,i):f;o=r.reduce((e,t,n)=>[...e,{stackId:t.stackId,dataKeys:t.dataKeys,position:{offset:p+(f+s)*n+(f-m)/2,size:m}}],l)}return o}}(n,r,i!==a?i:a,e,s);return i!==a&&null!=l&&(l=l.map(e=>zW(zW({},e),{},{position:zW(zW({},e.position),{},{offset:e.position.offset-i/2})}))),l}),XW=eS([KW,VW],(e,t)=>{if(null!=e&&null!=t){var n=e.find(e=>e.stackId===t.stackId&&null!=t.dataKey&&e.dataKeys.includes(t.dataKey));if(null!=n)return n.position}}),YW=eS([(e,t,n,r)=>"horizontal"===uT(e)?LR(e,"yAxis",n,r):LR(e,"xAxis",t,r),VW],(e,t)=>{var n=Gk(t);if(e&&null!=n&&null!=t){var{stackId:r}=t;if(null!=r){var i=e[r];if(i){var{stackedData:a}=i;if(a)return a.find(e=>e.key===n)}}}}),QW=eS([QS,JS,(e,t,n,r)=>HL(e,"xAxis",t,r),(e,t,n,r)=>HL(e,"yAxis",n,r),(e,t,n,r)=>WL(e,"xAxis",t,r),(e,t,n,r)=>WL(e,"yAxis",n,r),XW,uT,EN,$W,YW,VW,(e,t,n,r,i,a)=>a],(e,t,n,r,i,a,o,s,l,c,u,d,h)=>{var{chartData:p,dataStartIndex:f,dataEndIndex:m}=l;if(null!=d&&null!=o&&null!=t&&("horizontal"===s||"vertical"===s)&&null!=n&&null!=r&&null!=i&&null!=a&&null!=c){var g,{data:v}=d;if(null!=(g=null!=v&&v.length>0?v:null===p||void 0===p?void 0:p.slice(f,m+1)))return function(e){var{layout:t,barSettings:{dataKey:n,minPointSize:r},pos:i,bandSize:a,xAxis:o,yAxis:s,xAxisTicks:l,yAxisTicks:c,stackedData:u,displayedData:d,offset:h,cells:p,parentViewBox:f,dataStartIndex:m}=e,g="horizontal"===t?s:o,v=u?g.scale.domain():null,A=(e=>{var{numericAxis:t}=e,n=t.scale.domain();if("number"===t.type){var r=Math.min(n[0],n[1]),i=Math.max(n[0],n[1]);return r<=0&&i>=0?0:i<0?i:r}return n[0]})({numericAxis:g}),y=g.scale(A);return d.map((e,d)=>{var g,b,x,_,w,S;u?g=((e,t)=>{if(!t||2!==t.length||!by(t[0])||!by(t[1]))return e;var n=Math.min(t[0],t[1]),r=Math.max(t[0],t[1]),i=[e[0],e[1]];return(!by(e[0])||e[0]<n)&&(i[0]=n),(!by(e[1])||e[1]>r)&&(i[1]=r),i[0]>r&&(i[0]=r),i[1]<n&&(i[1]=n),i})(u[d+m],v):(g=SS(e,n),Array.isArray(g)||(g=[A,g]));var T=kW(r,gH)(g[1],d);if("horizontal"===t){var C,[M,E]=[s.scale(g[0]),s.scale(g[1])];b=LS({axis:o,ticks:l,bandSize:a,offset:i.offset,entry:e,index:d}),x=null!==(C=null!==E&&void 0!==E?E:M)&&void 0!==C?C:void 0,_=i.size;var P=M-E;if(w=Ay(P)?0:P,S={x:b,y:h.top,width:_,height:h.height},Math.abs(T)>0&&Math.abs(w)<Math.abs(T)){var N=vy(w||T)*(Math.abs(T)-Math.abs(w));x-=N,w+=N}}else{var[k,R]=[o.scale(g[0]),o.scale(g[1])];if(b=k,x=LS({axis:s,ticks:c,bandSize:a,offset:i.offset,entry:e,index:d}),_=R-k,w=i.size,S={x:h.left,y:x,width:h.width,height:w},Math.abs(T)>0&&Math.abs(_)<Math.abs(T))_+=vy(_||T)*(Math.abs(T)-Math.abs(_))}return null==b||null==x||null==_||null==w?null:iH(iH({},e),{},{stackedBarStart:y,x:b,y:x,width:_,height:w,value:u?g:g[1],payload:e,background:S,tooltipPosition:{x:b+_/2,y:x+w/2},parentViewBox:f},p&&p[d]&&p[d].props)}).filter(Boolean)}({layout:s,barSettings:d,pos:o,parentViewBox:t,bandSize:c,xAxis:n,yAxis:r,xAxisTicks:i,yAxisTicks:a,stackedData:u,displayedData:g,offset:e,cells:h,dataStartIndex:f})}});var ZW=["onMouseEnter","onMouseLeave","onClick"],JW=["value","background","tooltipPosition"],eH=["id"],tH=["onMouseEnter","onClick","onMouseLeave"];function nH(){return nH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nH.apply(null,arguments)}function rH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rH(Object(n),!0).forEach(function(t){aH(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function aH(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oH(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var sH=e=>{var{dataKey:t,name:n,fill:r,legendType:i,hide:a}=e;return[{inactive:a,dataKey:t,type:i,color:r,value:FS(n,t),payload:e}]},lH=r.memo(e=>{var{dataKey:t,stroke:n,strokeWidth:i,fill:a,name:o,hide:s,unit:l,tooltipType:c}=e,u={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:n,strokeWidth:i,fill:a,dataKey:t,nameKey:void 0,name:FS(o,t),hide:s,type:c,color:a,unit:l}};return r.createElement(UG,{tooltipEntrySettings:u})});function cH(e){var t=cS(ZO),{data:n,dataKey:i,background:a,allOtherBarProps:o}=e,{onMouseEnter:s,onMouseLeave:l,onClick:c}=o,u=oH(o,ZW),d=RW(s,i),h=LW(l),p=OW(c,i);if(!a||null==n)return null;var f,m,g=wI(a);return r.createElement(xF,{zIndex:(f=a,m=pk.barBackground,f&&"object"===typeof f&&"zIndex"in f&&"number"===typeof f.zIndex&&Fy(f.zIndex)?f.zIndex:m)},n.map((e,n)=>{var{value:o,background:s,tooltipPosition:l}=e,c=oH(e,JW);if(!s)return null;var f=d(e,n),m=h(e,n),v=p(e,n),A=iH(iH(iH(iH(iH({option:a,isActive:String(n)===t},c),{},{fill:"#eee"},s),g),UF(u,e,n)),{},{onMouseEnter:f,onMouseLeave:m,onClick:v,dataKey:i,index:n,className:"recharts-bar-background-rectangle"});return r.createElement(NW,nH({key:"background-bar-".concat(n)},A))}))}function uH(e){var{showLabels:t,children:n,rects:i}=e,a=null===i||void 0===i?void 0:i.map(e=>{var t={x:e.x,y:e.y,width:e.width,lowerWidth:e.width,upperWidth:e.width,height:e.height};return iH(iH({},t),{},{value:e.value,payload:e.payload,parentViewBox:e.parentViewBox,viewBox:t,fill:e.fill})});return r.createElement(mG,{value:t?a:void 0},n)}function dH(e){var{shape:t,activeBar:n,baseProps:i,entry:a,index:o,dataKey:s}=e,l=cS(ZO),c=cS(ej),u=n&&String(o)===l&&(null==c||s===c),d=u?n:t;return u?r.createElement(xF,{zIndex:pk.activeBar},r.createElement(NW,nH({},i,{name:String(i.name)},a,{isActive:u,option:d,index:o,dataKey:s}))):r.createElement(NW,nH({},i,{name:String(i.name)},a,{isActive:u,option:d,index:o,dataKey:s}))}function hH(e){var{shape:t,baseProps:n,entry:i,index:a,dataKey:o}=e;return r.createElement(NW,nH({},n,{name:String(n.name)},i,{isActive:!1,option:t,index:a,dataKey:o}))}function pH(e){var t,{data:n,props:i}=e,a=null!==(t=_I(i))&&void 0!==t?t:{},{id:o}=a,s=oH(a,eH),{shape:l,dataKey:c,activeBar:u}=i,{onMouseEnter:d,onClick:h,onMouseLeave:p}=i,f=oH(i,tH),m=RW(d,c),g=LW(p),v=OW(h,c);return n?r.createElement(r.Fragment,null,n.map((e,t)=>r.createElement($B,nH({key:"rectangle-".concat(null===e||void 0===e?void 0:e.x,"-").concat(null===e||void 0===e?void 0:e.y,"-").concat(null===e||void 0===e?void 0:e.value,"-").concat(t),className:"recharts-bar-rectangle"},UF(f,e,t),{onMouseEnter:m(e,t),onMouseLeave:g(e,t),onClick:v(e,t)}),u?r.createElement(dH,{shape:l,activeBar:u,baseProps:s,entry:e,index:t,dataKey:c}):r.createElement(hH,{shape:l,baseProps:s,entry:e,index:t,dataKey:c})))):null}function fH(e){var{props:t,previousRectanglesRef:n}=e,{data:i,layout:a,isAnimationActive:o,animationBegin:s,animationDuration:l,animationEasing:c,onAnimationEnd:u,onAnimationStart:d}=t,h=n.current,p=TV(t,"recharts-bar-"),[f,m]=(0,r.useState)(!1),g=!f,v=(0,r.useCallback)(()=>{"function"===typeof u&&u(),m(!1)},[u]),A=(0,r.useCallback)(()=>{"function"===typeof d&&d(),m(!0)},[d]);return r.createElement(uH,{showLabels:g,rects:i},r.createElement(SV,{animationId:p,begin:s,duration:l,isActive:o,easing:c,onAnimationEnd:v,onAnimationStart:A,key:p},e=>{var o=1===e?i:null===i||void 0===i?void 0:i.map((t,n)=>{var r=h&&h[n];if(r)return iH(iH({},t),{},{x:Cy(r.x,t.x,e),y:Cy(r.y,t.y,e),width:Cy(r.width,t.width,e),height:Cy(r.height,t.height,e)});if("horizontal"===a){var i=Cy(0,t.height,e),o=Cy(t.stackedBarStart,t.y,e);return iH(iH({},t),{},{y:o,height:i})}var s=Cy(0,t.width,e),l=Cy(t.stackedBarStart,t.x,e);return iH(iH({},t),{},{width:s,x:l})});return e>0&&(n.current=null!==o&&void 0!==o?o:null),null==o?null:r.createElement($B,null,r.createElement(pH,{props:t,data:o}))}),r.createElement(yG,{label:t.label}),t.children)}function mH(e){var t=(0,r.useRef)(null);return r.createElement(fH,{previousRectanglesRef:t,props:e})}var gH=0,vH=(e,t)=>{var n=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:n,errorVal:SS(e,t)}};class AH extends r.PureComponent{render(){var{hide:e,data:t,dataKey:n,className:i,xAxisId:a,yAxisId:o,needClip:s,background:l,id:c}=this.props;if(e||null==t)return null;var u=(0,hy.$)("recharts-bar",i),d=c;return r.createElement($B,{className:u,id:c},s&&r.createElement("defs",null,r.createElement(GG,{clipPathId:d,xAxisId:a,yAxisId:o})),r.createElement($B,{className:"recharts-bar-rectangles",clipPath:s?"url(#clipPath-".concat(d,")"):void 0},r.createElement(cH,{data:t,dataKey:n,background:l,allOtherBarProps:this.props}),r.createElement(mH,this.props)))}}var yH={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:gH,xAxisId:0,yAxisId:0,zIndex:pk.bar};function bH(e){var t,{xAxisId:n,yAxisId:i,hide:a,legendType:o,minPointSize:s,activeBar:l,animationBegin:c,animationDuration:u,animationEasing:d,isAnimationActive:h}=e,{needClip:p}=VG(n,i),f=dT(),m=tT(),g=MG(e.children,Nq),v=cS(t=>QW(t,n,i,m,e.id,g));if("vertical"!==f&&"horizontal"!==f)return null;var A=null===v||void 0===v?void 0:v[0];return t=null==A||null==A.height||null==A.width?0:"vertical"===f?A.height/2:A.width/2,r.createElement(BW,{xAxisId:n,yAxisId:i,data:v,dataPointFormatter:vH,errorBarOffset:t},r.createElement(AH,nH({},e,{layout:f,needClip:p,data:v,xAxisId:n,yAxisId:i,hide:a,legendType:o,minPointSize:s,activeBar:l,animationBegin:c,animationDuration:u,animationEasing:d,isAnimationActive:h})))}function xH(e){var t=bB(e,yH),n=tT();return r.createElement(eq,{id:t.id,type:"bar"},e=>r.createElement(r.Fragment,null,r.createElement(QG,{legendPayload:sH(t)}),r.createElement(lH,{dataKey:t.dataKey,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType}),r.createElement(nq,{type:"bar",id:e,data:void 0,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,stackId:kS(t.stackId),hide:t.hide,barSize:t.barSize,minPointSize:t.minPointSize,maxBarSize:t.maxBarSize,isPanorama:n}),r.createElement(xF,{zIndex:t.zIndex},r.createElement(bH,nH({},t,{id:e})))))}var _H=r.memo(xH,hI);function wH(e){var t=aS();return(0,r.useEffect)(()=>{t(RD(e))},[t,e]),null}_H.displayName="Bar";var SH=["layout"];function TH(){return TH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TH.apply(null,arguments)}var CH={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},MH=(0,r.forwardRef)(function(e,t){var n,i=bB(e.categoricalChartProps,CH),{layout:a}=i,o=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(i,SH),{chartName:s,defaultTooltipEventType:l,validateTooltipEventTypes:c,tooltipPayloadSearcher:u}=e,d={chartName:s,defaultTooltipEventType:l,validateTooltipEventTypes:c,tooltipPayloadSearcher:u,eventEmitter:void 0};return r.createElement(lI,{preloadedState:{options:d},reduxStoreName:null!==(n=i.id)&&void 0!==n?n:s},r.createElement(cI,{chartData:i.data}),r.createElement(fI,{layout:a,margin:i.margin}),r.createElement(mI,{baseValue:void 0,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),r.createElement(wH,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),r.createElement(vB,TH({},o,{ref:t})))});function EH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function PH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EH(Object(n),!0).forEach(function(t){NH(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function NH(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kH=["item"],RH=PH(PH({},CH),{},{layout:"centric",startAngle:0,endAngle:360}),LH=(0,r.forwardRef)((e,t)=>{var n=bB(e,RH);return r.createElement(MH,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:kH,tooltipPayloadSearcher:m_,categoricalChartProps:n,ref:t})}),OH=e=>e.graphicalItems.polarItems,jH=eS([Uk,Vk],dR),DH=eS([OH,lR,jH],fR),IH=eS([DH],yR),BH=eS([IH,MN],xR),FH=eS([BH,lR,DH],wR),zH=(eS([BH,lR,DH],(e,t,n)=>n.length>0?e.flatMap(e=>n.flatMap(n=>{var r;return{value:SS(e,null!==(r=t.dataKey)&&void 0!==r?r:n.dataKey),errorDomain:[]}})).filter(Boolean):null!=(null===t||void 0===t?void 0:t.dataKey)?e.map(e=>({value:SS(e,t.dataKey),errorDomain:[]})):e.map(e=>({value:e,errorDomain:[]}))),()=>{}),UH=eS([BH,lR,DH,zR,Uk],VR),VH=eS([lR,IR,BR,zH,UH,zH,uT,Uk],aL),GH=eS([lR,uT,BH,FH,QN,Uk,VH],lL),qH=eS([GH,lR,dL],pL);eS([lR,GH,qH,Uk],mL);function WH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function HH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WH(Object(n),!0).forEach(function(t){$H(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $H(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var KH=eS([OH,(e,t)=>t],(e,t)=>e.filter(e=>"pie"===e.type).find(e=>e.id===t)),XH=[],YH=(e,t,n)=>0===(null===n||void 0===n?void 0:n.length)?XH:n,QH=eS([MN,KH,YH],(e,t,n)=>{var r,{chartData:i}=e;if(null!=t&&((r=null!=(null===t||void 0===t?void 0:t.data)&&t.data.length>0?t.data:i)&&r.length||null==n||(r=n.map(e=>HH(HH({},t.presentationProps),e.props))),null!=r))return r}),ZH=eS([QH,KH,YH],(e,t,n)=>{if(null!=e&&null!=t)return e.map((e,r)=>{var i,a,o=SS(e,t.nameKey,t.name);return a=null!==n&&void 0!==n&&null!==(i=n[r])&&void 0!==i&&null!==(i=i.props)&&void 0!==i&&i.fill?n[r].props.fill:"object"===typeof e&&null!=e&&"fill"in e?e.fill:t.fill,{value:FS(o,t.dataKey),color:a,payload:e,type:t.legendType}})}),JH=eS([QH,KH,YH,QS],(e,t,n,r)=>{if(null!=t&&null!=e)return function(e){var t,n,r,{pieSettings:i,displayedData:a,cells:o,offset:s}=e,{cornerRadius:l,startAngle:c,endAngle:u,dataKey:d,nameKey:h,tooltipType:p}=i,f=Math.abs(i.minAngle),m=p$(c,u),g=Math.abs(m),v=a.length<=1?0:null!==(t=i.paddingAngle)&&void 0!==t?t:0,A=a.filter(e=>0!==SS(e,d,0)).length,y=g-A*f-(g>=360?A:A-1)*v,b=a.reduce((e,t)=>{var n=SS(t,d,0);return e+(by(n)?n:0)},0);b>0&&(n=a.map((e,t)=>{var n,a=SS(e,d,0),u=SS(e,h,t),g=h$(i,s,e),A=(by(a)?a:0)/b,x=a$(a$({},e),o&&o[t]&&o[t].props),_=(n=t?r.endAngle+vy(m)*v*(0!==a?1:0):c)+vy(m)*((0!==a?f:0)+A*y),w=(n+_)/2,S=(g.innerRadius+g.outerRadius)/2,T=[{name:u,value:a,payload:x,dataKey:d,type:p}],C=lk(g.cx,g.cy,S,w);return r=a$(a$(a$(a$({},i.presentationProps),{},{percent:A,cornerRadius:"string"===typeof l?parseFloat(l):l,name:u,tooltipPayload:T,midAngle:w,middleRadius:S,tooltipPosition:C},x),g),{},{value:a,dataKey:d,startAngle:n,endAngle:_,payload:x,paddingAngle:vy(m)*v})}));return n}({offset:r,pieSettings:t,displayedData:e,cells:n})}),e$=["key"],t$=["onMouseEnter","onClick","onMouseLeave"],n$=["id"],r$=["id"];function i$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i$(Object(n),!0).forEach(function(t){o$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o$(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s$(){return s$=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s$.apply(null,arguments)}function l$(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function c$(e){var t=(0,r.useMemo)(()=>MG(e.children,Nq),[e.children]),n=cS(n=>ZH(n,e.id,t));return null==n?null:r.createElement(ZG,{legendPayload:n})}var u$=r.memo(e=>{var{dataKey:t,nameKey:n,sectors:i,stroke:a,strokeWidth:o,fill:s,name:l,hide:c,tooltipType:u}=e,d={dataDefinedOnItem:i.map(e=>e.tooltipPayload),positions:i.map(e=>e.tooltipPosition),settings:{stroke:a,strokeWidth:o,fill:s,dataKey:t,nameKey:n,name:FS(l,t),hide:c,type:u,color:s,unit:""}};return r.createElement(UG,{tooltipEntrySettings:d})}),d$=(e,t)=>e>t?"start":e<t?"end":"middle",h$=(e,t,n)=>{var{top:r,left:i,width:a,height:o}=t,s=ck(a,o),l=i+Sy(e.cx,a,a/2),c=r+Sy(e.cy,o,o/2),u=Sy(e.innerRadius,s,0),d=((e,t,n)=>Sy("function"===typeof t?t(e):t,n,.8*n))(n,e.outerRadius,s);return{cx:l,cy:c,innerRadius:u,outerRadius:d,maxRadius:e.maxRadius||Math.sqrt(a*a+o*o)/2}},p$=(e,t)=>vy(t-e)*Math.min(Math.abs(t-e),360);function f$(e){var{sectors:t,props:n,showLabels:i}=e,{label:a,labelLine:o,dataKey:s}=n;if(!i||!a||!t)return null;var l=_I(n),c=wI(a),u=wI(o),d="object"===typeof a&&"offsetRadius"in a&&"number"===typeof a.offsetRadius&&a.offsetRadius||20,h=t.map((e,t)=>{var n=(e.startAngle+e.endAngle)/2,i=lk(e.cx,e.cy,e.outerRadius+d,n),h=a$(a$(a$(a$({},l),e),{},{stroke:"none"},c),{},{index:t,textAnchor:d$(i.x,e.cx)},i),p=a$(a$(a$(a$({},l),e),{},{fill:"none",stroke:e.fill},u),{},{index:t,points:[lk(e.cx,e.cy,e.outerRadius,n),i],key:"line"});return r.createElement(xF,{zIndex:pk.label,key:"label-".concat(e.startAngle,"-").concat(e.endAngle,"-").concat(e.midAngle,"-").concat(t)},r.createElement($B,null,o&&((e,t)=>{if(r.isValidElement(e))return r.cloneElement(e,t);if("function"===typeof e)return e(t);var n=(0,hy.$)("recharts-pie-label-line","boolean"!==typeof e?e.className:""),{key:i}=t,a=l$(t,e$);return r.createElement(WU,s$({},a,{type:"linear",className:n}))})(o,p),((e,t,n)=>{if(r.isValidElement(e))return r.cloneElement(e,t);var i=n;if("function"===typeof e&&(i=e(t),r.isValidElement(i)))return i;var a=(0,hy.$)("recharts-pie-label-text",function(e){return e&&"object"===typeof e&&"className"in e&&"string"===typeof e.className?e.className:""}(e));return r.createElement(bF,s$({},t,{alignmentBaseline:"middle",className:a}),i)})(a,h,SS(e,s))))});return r.createElement($B,{className:"recharts-pie-labels"},h)}function m$(e){var{sectors:t,props:n,showLabels:i}=e,{label:a}=n;return"object"===typeof a&&null!=a&&"position"in a?r.createElement(yG,{label:a}):r.createElement(f$,{sectors:t,props:n,showLabels:i})}function g$(e){var{sectors:t,activeShape:n,inactiveShape:i,allOtherPieProps:a,shape:o,id:s}=e,l=cS(ZO),c=cS(ej),u=cS(tj),{onMouseEnter:d,onClick:h,onMouseLeave:p}=a,f=l$(a,t$),m=RW(d,a.dataKey,s),g=LW(p),v=OW(h,a.dataKey,s);return null==t||0===t.length?null:r.createElement(r.Fragment,null,t.map((e,d)=>{if(0===(null===e||void 0===e?void 0:e.startAngle)&&0===(null===e||void 0===e?void 0:e.endAngle)&&1!==t.length)return null;var h=null==u||u===s,p=String(d)===l&&(null==c||a.dataKey===c)&&h,A=n&&p?n:l?i:null,y=a$(a$({},e),{},{stroke:e.stroke,tabIndex:-1,[HS]:d,[$S]:a.dataKey});return r.createElement($B,s$({key:"sector-".concat(null===e||void 0===e?void 0:e.startAngle,"-").concat(null===e||void 0===e?void 0:e.endAngle,"-").concat(e.midAngle,"-").concat(d),tabIndex:-1,className:"recharts-pie-sector"},UF(f,e,d),{onMouseEnter:m(e,d),onMouseLeave:g(e,d),onClick:v(e,d)}),r.createElement(wW,s$({option:null!==o&&void 0!==o?o:A,index:d,shapeType:"sector",isActive:p},y)))}))}function v$(e){var{showLabels:t,sectors:n,children:i}=e,a=(0,r.useMemo)(()=>t&&n?n.map(e=>({value:e.value,payload:e.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:e.cx,cy:e.cy,innerRadius:e.innerRadius,outerRadius:e.outerRadius,startAngle:e.startAngle,endAngle:e.endAngle,clockWise:!1},fill:e.fill})):[],[n,t]);return r.createElement(vG,{value:t?a:void 0},i)}function A$(e){var{props:t,previousSectorsRef:n,id:i}=e,{sectors:a,isAnimationActive:o,animationBegin:s,animationDuration:l,animationEasing:c,activeShape:u,inactiveShape:d,onAnimationStart:h,onAnimationEnd:p}=t,f=TV(t,"recharts-pie-"),m=n.current,[g,v]=(0,r.useState)(!1),A=(0,r.useCallback)(()=>{"function"===typeof p&&p(),v(!1)},[p]),y=(0,r.useCallback)(()=>{"function"===typeof h&&h(),v(!0)},[h]);return r.createElement(v$,{showLabels:!g,sectors:a},r.createElement(SV,{animationId:f,begin:s,duration:l,isActive:o,easing:c,onAnimationStart:y,onAnimationEnd:A,key:f},e=>{var o=[],s=a&&a[0],l=null===s||void 0===s?void 0:s.startAngle;return null===a||void 0===a||a.forEach((t,n)=>{var r=m&&m[n],i=n>0?gy()(t,"paddingAngle",0):0;if(r){var a=Cy(r.endAngle-r.startAngle,t.endAngle-t.startAngle,e),s=a$(a$({},t),{},{startAngle:l+i,endAngle:l+a+i});o.push(s),l=s.endAngle}else{var{endAngle:c,startAngle:u}=t,d=Cy(0,c-u,e),h=a$(a$({},t),{},{startAngle:l+i,endAngle:l+d+i});o.push(h),l=h.endAngle}}),n.current=o,r.createElement($B,null,r.createElement(g$,{sectors:o,activeShape:u,inactiveShape:d,allOtherPieProps:t,shape:t.shape,id:i}))}),r.createElement(m$,{showLabels:!g,sectors:a,props:t}),t.children)}var y$={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:"auto",label:!1,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:pk.area};function b$(e){var{id:t}=e,n=l$(e,n$),{hide:i,className:a,rootTabIndex:o}=e,s=(0,r.useMemo)(()=>MG(e.children,Nq),[e.children]),l=cS(e=>JH(e,t,s)),c=(0,r.useRef)(null),u=(0,hy.$)("recharts-pie",a);return i||null==l?(c.current=null,r.createElement($B,{tabIndex:o,className:u})):r.createElement(xF,{zIndex:e.zIndex},r.createElement(u$,{dataKey:e.dataKey,nameKey:e.nameKey,sectors:l,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,tooltipType:e.tooltipType}),r.createElement($B,{tabIndex:o,className:u},r.createElement(A$,{props:a$(a$({},n),{},{sectors:l}),previousSectorsRef:c,id:t})))}function x$(e){var t=bB(e,y$),{id:n}=t,i=l$(t,r$),a=_I(i);return r.createElement(eq,{id:n,type:"pie"},e=>r.createElement(r.Fragment,null,r.createElement(rq,{type:"pie",id:e,data:i.data,dataKey:i.dataKey,hide:i.hide,angleAxisId:0,radiusAxisId:0,name:i.name,nameKey:i.nameKey,tooltipType:i.tooltipType,legendType:i.legendType,fill:i.fill,cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,paddingAngle:i.paddingAngle,minAngle:i.minAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius,cornerRadius:i.cornerRadius,presentationProps:a,maxRadius:t.maxRadius}),r.createElement(c$,s$({},i,{id:e})),r.createElement(b$,s$({},i,{id:e}))))}function _$(){return _$=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_$.apply(null,arguments)}function w$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S$(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}x$.displayName="Pie";var T$=32,C$={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function M$(e){var t,{data:n,iconType:i,inactiveColor:a}=e,o=16,s=T$/6,l=T$/3,c=n.inactive?a:n.color,u=null!==i&&void 0!==i?i:n.type;if("none"===u)return null;if("plainline"===u)return r.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:null===(t=n.payload)||void 0===t?void 0:t.strokeDasharray,x1:0,y1:o,x2:T$,y2:o,className:"recharts-legend-icon"});if("line"===u)return r.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,"\n            A").concat(s,",").concat(s,",0,1,1,").concat(2*l,",").concat(o,"\n            H").concat(T$,"M").concat(2*l,",").concat(o,"\n            A").concat(s,",").concat(s,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if("rect"===u)return r.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(4,"h").concat(T$,"v").concat(24,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(r.isValidElement(n.legendIcon)){var d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w$(Object(n),!0).forEach(function(t){S$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n);return delete d.legendIcon,r.cloneElement(n.legendIcon,d)}return r.createElement(gW,{fill:c,cx:o,cy:o,size:T$,sizeType:"diameter",type:u})}function E$(e){var{payload:t,iconSize:n,layout:i,formatter:a,inactiveColor:o,iconType:s}=e,l={x:0,y:0,width:T$,height:T$},c={display:"horizontal"===i?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((t,i)=>{var d=t.formatter||a,h=(0,hy.$)({"recharts-legend-item":!0,["legend-item-".concat(i)]:!0,inactive:t.inactive});if("none"===t.type)return null;var p=t.inactive?o:t.color,f=d?d(t.value,t,i):t.value;return r.createElement("li",_$({className:h,style:c,key:"legend-item-".concat(i)},UF(e,t,i)),r.createElement(EI,{width:n,height:n,viewBox:l,style:u,"aria-label":"".concat(f," legend icon")},r.createElement(M$,{data:t,iconType:s,inactiveColor:o})),r.createElement("span",{className:"recharts-legend-item-text",style:{color:p}},f))})}var P$=e=>{var t=bB(e,C$),{payload:n,layout:i,align:a}=t;if(!n||!n.length)return null;var o={padding:0,margin:0,textAlign:"horizontal"===i?a:"left"};return r.createElement("ul",{className:"recharts-default-legend",style:o},r.createElement(E$,_$({},t,{payload:n})))};var N$=["contextPayload"];function k$(){return k$=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k$.apply(null,arguments)}function R$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R$(Object(n),!0).forEach(function(t){O$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function O$(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j$(e){return e.value}function D$(e){var{contextPayload:t}=e,n=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,N$),i=rU(t,e.payloadUniqBy,j$),a=L$(L$({},n),{},{payload:i});return r.isValidElement(e.content)?r.cloneElement(e.content,a):"function"===typeof e.content?r.createElement(e.content,a):r.createElement(P$,a)}function I$(e){var t=aS();return(0,r.useEffect)(()=>{t(gD(e))},[t,e]),null}function B$(e){var t=aS();return(0,r.useEffect)(()=>(t(mD(e)),()=>{t(mD({width:0,height:0}))}),[t,e]),null}var F$={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function z$(e){var t=bB(e,F$),n=cS(pS),i=(0,r.useContext)(JI),a=cS(e=>e.layout.margin),{width:o,height:s,wrapperStyle:l,portal:c}=t,[u,d]=iU([n]),h=lT(),p=cT();if(null==h||null==p)return null;var f=h-((null===a||void 0===a?void 0:a.left)||0)-((null===a||void 0===a?void 0:a.right)||0),m=function(e,t,n,r){return"vertical"===e&&by(t)?{height:t}:"horizontal"===e?{width:n||r}:null}(t.layout,s,o,f),g=c?l:L$(L$({position:"absolute",width:(null===m||void 0===m?void 0:m.width)||o||"auto",height:(null===m||void 0===m?void 0:m.height)||s||"auto"},function(e,t,n,r,i,a){var o,s,{layout:l,align:c,verticalAlign:u}=t;return e&&(void 0!==e.left&&null!==e.left||void 0!==e.right&&null!==e.right)||(o="center"===c&&"vertical"===l?{left:((r||0)-a.width)/2}:"right"===c?{right:n&&n.right||0}:{left:n&&n.left||0}),e&&(void 0!==e.top&&null!==e.top||void 0!==e.bottom&&null!==e.bottom)||(s="middle"===u?{top:((i||0)-a.height)/2}:"bottom"===u?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),L$(L$({},o),s)}(l,t,a,h,p,u)),l),v=null!==c&&void 0!==c?c:i;if(null==v||null==n)return null;var A=r.createElement("div",{className:"recharts-legend-wrapper",style:g,ref:d},r.createElement(I$,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!c&&r.createElement(B$,{width:u.width,height:u.height}),r.createElement(D$,k$({},t,m,{margin:a,chartWidth:h,chartHeight:p,contextPayload:n})));return(0,Ca.createPortal)(A,v)}function U$({words:e=[],width:t=600,height:n=300,minSize:i=12,maxSize:a=48,palette:o=["#334155"]}){const s=(0,r.useMemo)(()=>{const r=[],o=Math.max(...e.map(e=>e.weight||1),1),s=t/2,l=n/2,c=(e,t)=>e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y,u=[],d=[...e].sort((e,t)=>(t.weight||1)-(e.weight||1));return d.forEach((e,d)=>{const h=Math.max(1,e.weight||1),p=i+h/o*(a-i),{w:f,h:m}=((e,t)=>({w:e.length*(.6*t),h:1.2*t}))(e.text,p);let g=0,v=0,A=null;for(let r=0;r<2e3;r++){const e=r%3*(d%2===0?1:-1),i=s+(v+e)*Math.cos(g)-f/2,a=l+(v+e)*Math.sin(g)-m/2,o={x:i,y:a,w:f,h:m};if(i>=0&&a>=0&&i+f<=t&&a+m<=n&&u.every(e=>!c(o,e))){A=o;break}g+=.35,v+=2}A&&(u.push(A),r.push({...e,size:p,x:A.x,y:A.y}))}),r},[e,t,n,i,a]);return(0,gt.jsx)("div",{style:{position:"relative",width:t,height:n},children:s.map((e,t)=>(0,gt.jsx)("span",{title:`${e.text}: ${e.weight}`,style:{position:"absolute",left:Math.round(e.x),top:Math.round(e.y),fontSize:`${Math.round(e.size)}px`,fontWeight:700,lineHeight:1,color:o[t%o.length],whiteSpace:"nowrap",userSelect:"none",transform:`rotate(${t%5===0?-5:t%4===0?5:0}deg)`},children:e.text},t))})}z$.displayName="Legend";const V$=$n("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),G$=$n("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),q$=e=>{const t=Number(e);return isNaN(t)?"0":Number.isInteger(t)?t.toString():t.toFixed(2)};function W$({title:e,value:t,sub:n,trend:i,icon:a,color:o="default",prefix:s="",suffix:l=""}){const c=function(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{const e=()=>{const e=document.documentElement.classList.contains("dark"),n=window.matchMedia("(prefers-color-scheme: dark)").matches;t(e||n)};e();const n=new MutationObserver(e);n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]});const r=window.matchMedia("(prefers-color-scheme: dark)");return r.addEventListener("change",e),()=>{n.disconnect(),r.removeEventListener("change",e)}},[]),e}(),u=(0,r.useRef)(null),d=((e,t)=>{const n={default:{light:{gradient:"linear-gradient(135deg, rgba(243, 244, 246, 0.8) 0%, rgba(229, 231, 235, 0.9) 100%)",iconBg:"rgba(107, 114, 128, 0.15)",iconColor:"#6b7280"},dark:{gradient:"linear-gradient(135deg, rgba(63, 63, 70, 0.4) 0%, rgba(39, 39, 42, 0.5) 100%)",iconBg:"rgba(113, 113, 122, 0.3)",iconColor:"#a1a1aa"}},primary:{light:{gradient:"linear-gradient(135deg, rgba(219, 234, 254, 0.7) 0%, rgba(191, 219, 254, 0.8) 100%)",iconBg:"rgba(59, 130, 246, 0.15)",iconColor:"#2563eb"},dark:{gradient:"linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(37, 99, 235, 0.2) 100%)",iconBg:"rgba(59, 130, 246, 0.25)",iconColor:"#60a5fa"}},success:{light:{gradient:"linear-gradient(135deg, rgba(209, 250, 229, 0.7) 0%, rgba(167, 243, 208, 0.8) 100%)",iconBg:"rgba(16, 185, 129, 0.15)",iconColor:"#059669"},dark:{gradient:"linear-gradient(135deg, rgba(16, 185, 129, 0.12) 0%, rgba(5, 150, 105, 0.2) 100%)",iconBg:"rgba(16, 185, 129, 0.25)",iconColor:"#34d399"}},warning:{light:{gradient:"linear-gradient(135deg, rgba(254, 243, 199, 0.7) 0%, rgba(253, 230, 138, 0.8) 100%)",iconBg:"rgba(245, 158, 11, 0.15)",iconColor:"#d97706"},dark:{gradient:"linear-gradient(135deg, rgba(245, 158, 11, 0.12) 0%, rgba(217, 119, 6, 0.2) 100%)",iconBg:"rgba(245, 158, 11, 0.25)",iconColor:"#fbbf24"}},danger:{light:{gradient:"linear-gradient(135deg, rgba(254, 226, 226, 0.7) 0%, rgba(254, 202, 202, 0.8) 100%)",iconBg:"rgba(239, 68, 68, 0.15)",iconColor:"#dc2626"},dark:{gradient:"linear-gradient(135deg, rgba(239, 68, 68, 0.12) 0%, rgba(220, 38, 38, 0.2) 100%)",iconBg:"rgba(239, 68, 68, 0.25)",iconColor:"#f87171"}},secondary:{light:{gradient:"linear-gradient(135deg, rgba(237, 233, 254, 0.7) 0%, rgba(221, 214, 254, 0.8) 100%)",iconBg:"rgba(139, 92, 246, 0.15)",iconColor:"#7c3aed"},dark:{gradient:"linear-gradient(135deg, rgba(139, 92, 246, 0.12) 0%, rgba(124, 58, 237, 0.2) 100%)",iconBg:"rgba(139, 92, 246, 0.25)",iconColor:"#a78bfa"}},info:{light:{gradient:"linear-gradient(135deg, rgba(224, 242, 254, 0.7) 0%, rgba(186, 230, 253, 0.8) 100%)",iconBg:"rgba(14, 165, 233, 0.15)",iconColor:"#0ea5e9"},dark:{gradient:"linear-gradient(135deg, rgba(14, 165, 233, 0.12) 0%, rgba(2, 132, 199, 0.2) 100%)",iconBg:"rgba(14, 165, 233, 0.25)",iconColor:"#38bdf8"}},rose:{light:{gradient:"linear-gradient(135deg, rgba(255, 228, 230, 0.7) 0%, rgba(253, 164, 175, 0.8) 100%)",iconBg:"rgba(244, 63, 94, 0.15)",iconColor:"#f43f5e"},dark:{gradient:"linear-gradient(135deg, rgba(244, 63, 94, 0.12) 0%, rgba(225, 29, 72, 0.2) 100%)",iconBg:"rgba(244, 63, 94, 0.25)",iconColor:"#fb7185"}},indigo:{light:{gradient:"linear-gradient(135deg, rgba(224, 231, 255, 0.7) 0%, rgba(199, 210, 254, 0.8) 100%)",iconBg:"rgba(99, 102, 241, 0.15)",iconColor:"#6366f1"},dark:{gradient:"linear-gradient(135deg, rgba(99, 102, 241, 0.12) 0%, rgba(79, 70, 229, 0.2) 100%)",iconBg:"rgba(99, 102, 241, 0.25)",iconColor:"#818cf8"}},teal:{light:{gradient:"linear-gradient(135deg, rgba(204, 251, 241, 0.7) 0%, rgba(153, 246, 228, 0.8) 100%)",iconBg:"rgba(20, 184, 166, 0.15)",iconColor:"#14b8a6"},dark:{gradient:"linear-gradient(135deg, rgba(20, 184, 166, 0.12) 0%, rgba(13, 148, 136, 0.2) 100%)",iconBg:"rgba(20, 184, 166, 0.25)",iconColor:"#2dd4bf"}}},r=n[e]||n.default;return t?r.dark:r.light})(o,c),h=i>0?"#10b981":i<0?"#ef4444":"#a1a1aa",p=i>0?V$:G$;return(0,r.useEffect)(()=>{u.current&&u.current.style.setProperty("background",d.gradient,"important")},[d.gradient]),(0,gt.jsx)(ju.div,{whileHover:{y:-2},transition:{duration:.2},className:"h-full",children:(0,gt.jsx)(Nm,{ref:u,className:"overflow-hidden border border-zinc-200/50 dark:border-zinc-700/50 hover:shadow-lg transition-shadow duration-300 h-full",children:(0,gt.jsxs)(Rm,{className:"p-5 gap-2 flex flex-col justify-between h-full",children:[(0,gt.jsxs)("div",{className:"flex items-start justify-between",children:[(0,gt.jsx)("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 uppercase tracking-wider font-semibold",children:e}),a&&(0,gt.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:d.iconBg},children:(0,gt.jsx)(a,{className:"w-4 h-4",style:{color:d.iconColor}})})]}),(0,gt.jsxs)("div",{className:"flex items-baseline gap-1",children:[s&&(0,gt.jsx)("span",{className:"text-xl text-zinc-600 dark:text-zinc-300",children:s}),(0,gt.jsx)("span",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100 tracking-tight",children:"number"===typeof t?q$(t):t}),l&&(0,gt.jsx)("span",{className:"text-lg text-zinc-600 dark:text-zinc-300",children:l})]}),(0,gt.jsxs)("div",{className:"flex items-center justify-between mt-auto",children:[n?(0,gt.jsx)("p",{className:"text-xs text-zinc-400 dark:text-zinc-500",children:n}):(0,gt.jsx)("span",{className:"text-xs text-transparent select-none",children:"\xa0"}),void 0!==i&&0!==i&&(0,gt.jsxs)("div",{className:"flex items-center gap-1 text-xs font-semibold",style:{color:h},children:[(0,gt.jsx)(p,{className:"w-3 h-3"}),(0,gt.jsxs)("span",{children:[q$(Math.abs(i)),"%"]})]})]})]})})})}var H$=(0,Ln.Rf)((e,t)=>{var n;const{as:r,className:i,children:a,...o}=e,s=r||"div",l=(0,Wa.zD)(t),{slots:c,classNames:u}=Cm(),d=(0,Dn.cn)(null==u?void 0:u.header,i);return(0,gt.jsx)(s,{ref:l,className:null==(n=c.header)?void 0:n.call(c,{class:d}),...o,children:a})});H$.displayName="HeroUI.CardHeader";var $$=H$;function K$({title:e,subtitle:t,children:n,height:i=320,isLoading:a=!1,action:o,className:s=""}){const l=function(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{const e=()=>{t(document.documentElement.classList.contains("dark"))};e();const n=new MutationObserver(e);return n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>n.disconnect()},[]),e}(),c=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(c.current){const e=l?"rgba(39, 39, 42, 0.5)":"#ffffff";c.current.style.setProperty("background-color",e,"important")}},[l]),(0,gt.jsxs)(Nm,{ref:c,className:`overflow-hidden border border-zinc-200/50 dark:border-zinc-700/50 min-w-0 ${s}`,children:[(0,gt.jsxs)($$,{className:"flex justify-between items-start pb-0",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h3",{className:"text-base font-semibold text-zinc-900 dark:text-zinc-100",children:e}),t&&(0,gt.jsx)("p",{className:"text-xs text-zinc-400 dark:text-zinc-500 mt-0.5",children:t})]}),o&&(0,gt.jsx)("div",{children:o})]}),(0,gt.jsx)(Ja,{className:"my-3"}),(0,gt.jsx)(Rm,{className:"pt-0 min-w-0",children:a?(0,gt.jsx)(zn,{className:"w-full rounded-lg",style:{height:i}}):(0,gt.jsx)("div",{style:{height:i,width:"100%",minWidth:0},children:n})})]})}const X$=$n("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Y$=$n("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);function Q$({mode:e="stats",onModeChange:t}){const n=function(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{const e=()=>{t(document.documentElement.classList.contains("dark"))};e();const n=new MutationObserver(e);return n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>n.disconnect()},[]),e}(),i={display:"flex",gap:"4px",padding:"4px",backgroundColor:n?"rgba(63, 63, 70, 0.5)":"#f4f4f5",borderRadius:"12px"},a=t=>({display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",borderRadius:"8px",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500,transition:"all 0.2s",backgroundColor:e===t?"#3b82f6":"transparent",color:e===t?"#ffffff":n?"#a1a1aa":"#52525b"});return(0,gt.jsxs)("div",{style:i,children:[(0,gt.jsxs)("button",{style:a("stats"),onClick:()=>t("stats"),children:[(0,gt.jsx)(X$,{style:{width:16,height:16}}),(0,gt.jsx)("span",{children:"Overview"})]}),(0,gt.jsxs)("button",{style:a("spending"),onClick:()=>t("spending"),children:[(0,gt.jsx)(Y$,{style:{width:16,height:16}}),(0,gt.jsx)("span",{children:"Spending"})]})]})}const Z$=$n("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),J$=e=>{const t=Number(e);return isNaN(t)?"0":Number.isInteger(t)?t.toString():t.toFixed(2)},eK=vn("stats");function tK({mode:e="stats"}){var t,n,i,a,o,s,l,c,u,d,h,p,f,m;const{data:g}=Rn({queryKey:["stats-summary"],queryFn:()=>fetch(`${bn.tE}/api/stats/summary`).then(e=>e.json()),...eK}),{data:v}=Rn({queryKey:["stats-gear"],queryFn:()=>fetch(`${bn.tE}/api/stats/gear`).then(e=>e.json()),...eK}),{data:A}=Rn({queryKey:["stats-activity"],queryFn:()=>fetch(`${bn.tE}/api/stats/activity`).then(e=>e.json()),...eK}),{data:y}=Rn({queryKey:["stats-costs"],queryFn:()=>fetch(`${bn.tE}/api/stats/costs`).then(e=>e.json()),enabled:"spending"===e,...eK}),{data:b}=Rn({queryKey:["stats-locations"],queryFn:()=>fetch(`${bn.tE}/api/stats/locations`).then(e=>e.json()).catch(()=>[]),...eK}),{data:x}=Rn({queryKey:["stats-themes"],queryFn:()=>fetch(`${bn.tE}/api/stats/themes`).then(e=>e.json()),...eK}),{data:_}=Rn({queryKey:["stats-inventory"],queryFn:()=>fetch(`${bn.tE}/api/stats/inventory`).then(e=>e.json()),...eK}),w=Array.isArray(b)?b:[],S="spending"===e,T=((null===v||void 0===v?void 0:v.films)||[]).map(e=>({name:e.name,value:e.count})),C=((null===v||void 0===v?void 0:v.cameras)||[]).map(e=>({name:e.name,value:e.count})),M=(null===v||void 0===v?void 0:v.lenses)||[],E=M.reduce((e,t)=>e+t.count,0),P=M.map(e=>({name:e.name,percentage:E>0?Number((e.count/E*100).toFixed(2)):0})).sort((e,t)=>t.percentage-e.percentage).slice(0,6),N=["#6366f1","#10b981","#f59e0b","#ec4899","#8b5cf6","#14b8a6","#f97316","#06b6d4","#a855f7","#84cc16","#ef4444","#3b82f6"],k=(x||[]).slice(0,8).map(e=>({name:e.name,value:e.photo_count})),R=(w.slice(0,30)||[]).map(e=>({text:e.city_name,weight:e.photo_count})),L=null!==y&&void 0!==y&&y.summary?[{name:"Purchase",value:Number(y.summary.total_purchase||0)},{name:"Development",value:Number(y.summary.total_develop||0)}]:[],O=r.useMemo(()=>{const e=Array.isArray(null===y||void 0===y?void 0:y.monthly)?y.monthly:[];if(!e.length)return[];const t=e.map(e=>{const t=(e.month||"").slice(0,7),n=new Date(`${t}-01T00:00:00Z`);return!t||Number.isNaN(n.getTime())?null:{month:t,date:n,purchase:Number(e.purchase||0),develop:Number(e.develop||0)}}).filter(Boolean).sort((e,t)=>e.date-t.date);if(!t.length)return[];const n=t[0].date,r=t[t.length-1].date,i=new Map(t.map(e=>[e.month,e])),a=[],o=new Date(n);for(;o<=r;){const e=o.toISOString().slice(0,7),t=i.get(e);a.push({month:e,purchase:t?t.purchase:0,develop:t?t.develop:0}),o.setUTCMonth(o.getUTCMonth()+1)}return a},[null===y||void 0===y?void 0:y.monthly]),j=O.filter((e,t)=>t%2===0).map(e=>e.month),D=se();return(0,gt.jsxs)("div",{className:"w-full min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6 lg:p-8 space-y-8 animate-in fade-in duration-500 pb-20",children:[(0,gt.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 border-b border-zinc-200 dark:border-zinc-700 pb-6",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100 tracking-tight",children:S?"Spending Analysis":"Statistics Dashboard"}),(0,gt.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:S?"Track your film photography expenses and investment":"Comprehensive overview of your photography journey"})]}),(0,gt.jsx)(Q$,{mode:S?"spending":"stats",onModeChange:e=>D("spending"===e?"/spending":"/stats")})]}),S?(0,gt.jsxs)("div",{className:"space-y-8 w-full min-w-0",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:"16px",width:"100%"},children:[(0,gt.jsx)(W$,{title:"Total Spending",value:((null===y||void 0===y||null===(c=y.summary)||void 0===c?void 0:c.total_purchase)||0)+((null===y||void 0===y||null===(u=y.summary)||void 0===u?void 0:u.total_develop)||0),prefix:"\xa5",sub:"Purchase + Development",icon:Y$,color:"rose"}),(0,gt.jsx)(W$,{title:"Avg Cost/Roll",value:null!==y&&void 0!==y&&null!==(d=y.summary)&&void 0!==d&&d.roll_count?(((null===y||void 0===y||null===(h=y.summary)||void 0===h?void 0:h.total_purchase)||0)+((null===y||void 0===y||null===(p=y.summary)||void 0===p?void 0:p.total_develop)||0))/y.summary.roll_count:0,prefix:"\xa5",sub:"Per roll investment",icon:V$,color:"indigo"}),(0,gt.jsx)(W$,{title:"Total Purchase",value:(null===y||void 0===y||null===(f=y.summary)||void 0===f?void 0:f.total_purchase)||0,prefix:"\xa5",sub:"Film stock",icon:rp,color:"warning"}),(0,gt.jsx)(W$,{title:"Total Development",value:(null===y||void 0===y||null===(m=y.summary)||void 0===m?void 0:m.total_develop)||0,prefix:"\xa5",sub:"Lab processing",icon:If,color:"info"})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:"1.5rem",width:"100%"},children:[(0,gt.jsx)(K$,{title:"Cost Breakdown",subtitle:"Purchase vs Development",height:340,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(LH,{children:[(0,gt.jsxs)(x$,{data:L,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:4,label:({percent:e})=>`${(100*e).toFixed(0)}%`,children:[(0,gt.jsx)(Nq,{fill:"#10b981"}),(0,gt.jsx)(Nq,{fill:"#f59e0b"})]}),(0,gt.jsx)(oG,{formatter:e=>`\xa5${J$(e)}`,contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"}}),(0,gt.jsx)(z$,{verticalAlign:"bottom",height:36})]})})}),(0,gt.jsx)(K$,{title:"Monthly Spending Trend",subtitle:"Stacked area chart",height:340,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(TB,{data:O,margin:{top:10,right:10,left:0,bottom:0},children:[(0,gt.jsxs)("defs",{children:[(0,gt.jsxs)("linearGradient",{id:"colorPurchase",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,gt.jsx)("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),(0,gt.jsx)("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]}),(0,gt.jsxs)("linearGradient",{id:"colorDevelop",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,gt.jsx)("stop",{offset:"5%",stopColor:"#f59e0b",stopOpacity:.3}),(0,gt.jsx)("stop",{offset:"95%",stopColor:"#f59e0b",stopOpacity:0})]})]}),(0,gt.jsx)(vz,{strokeDasharray:"3 3",vertical:!1,stroke:"var(--heroui-divider)"}),(0,gt.jsx)(kz,{dataKey:"month",ticks:j,tick:{fontSize:12,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1}),(0,gt.jsx)(zz,{tickFormatter:e=>J$(e),tick:{fontSize:12,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1}),(0,gt.jsx)(oG,{contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"},formatter:e=>`\xa5${J$(e)}`}),(0,gt.jsx)(Mq,{type:"monotone",dataKey:"purchase",stroke:"#10b981",strokeWidth:2,fill:"url(#colorPurchase)",name:"Purchase"}),(0,gt.jsx)(Mq,{type:"monotone",dataKey:"develop",stroke:"#f59e0b",strokeWidth:2,fill:"url(#colorDevelop)",name:"Development"})]})})})]}),(0,gt.jsx)(K$,{title:"Avg Cost per Roll by Film",subtitle:"Compare film stock value",height:360,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(Pq,{data:((null===y||void 0===y?void 0:y.byFilm)||[]).map(e=>({name:e.name,avgTotal:e.rolls?Number(((e.purchase||0)+(e.develop||0))/e.rolls):0,avgPurchase:e.rolls?Number((e.purchase||0)/e.rolls):0,avgDevelop:e.rolls?Number((e.develop||0)/e.rolls):0})),margin:{top:10,right:10,left:0,bottom:60},children:[(0,gt.jsx)(vz,{strokeDasharray:"3 3",vertical:!1,stroke:"var(--heroui-divider)"}),(0,gt.jsx)(kz,{dataKey:"name",angle:-30,textAnchor:"end",interval:0,height:70,tick:{fontSize:12,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1}),(0,gt.jsx)(zz,{tickFormatter:e=>J$(e),tick:{fontSize:12,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1}),(0,gt.jsx)(oG,{contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"},formatter:e=>`\xa5${J$(e)}`}),(0,gt.jsx)(z$,{verticalAlign:"top"}),(0,gt.jsx)(_H,{dataKey:"avgPurchase",stackId:"avg",fill:"#10b981",radius:[0,0,0,0],name:"Avg Purchase"}),(0,gt.jsx)(_H,{dataKey:"avgDevelop",stackId:"avg",fill:"#f59e0b",radius:[4,4,0,0],name:"Avg Development"})]})})})]}):(0,gt.jsxs)("div",{className:"space-y-8 w-full",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",width:"100%"},children:[(0,gt.jsx)(W$,{title:"Total Rolls",value:(null===g||void 0===g?void 0:g.total_rolls)||0,icon:Ia,color:"info"}),(0,gt.jsx)(W$,{title:"Total Photos",value:(null===g||void 0===g?void 0:g.total_photos)||0,icon:Du,color:"success"}),(0,gt.jsx)(W$,{title:"Total Spending",value:(null===g||void 0===g?void 0:g.total_cost)||0,prefix:"\xa5",sub:"Est. Value",icon:Df,color:"warning"}),(0,gt.jsx)(W$,{title:"Avg Cost/Roll",value:null!==g&&void 0!==g&&g.total_rolls?((null===g||void 0===g?void 0:g.total_cost)||0)/g.total_rolls:0,prefix:"\xa5",sub:"Per roll investment",icon:V$,color:"indigo"})]}),(0,gt.jsx)(K$,{title:"Shooting Activity",subtitle:"Rolls shot over time",height:280,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(TB,{data:A||[],margin:{top:10,right:10,left:0,bottom:0},children:[(0,gt.jsx)("defs",{children:(0,gt.jsxs)("linearGradient",{id:"colorActivity",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,gt.jsx)("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.3}),(0,gt.jsx)("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:0})]})}),(0,gt.jsx)(vz,{strokeDasharray:"3 3",vertical:!1,stroke:"var(--heroui-divider)"}),(0,gt.jsx)(kz,{dataKey:"month",tick:{fontSize:12,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1}),(0,gt.jsx)(zz,{tick:{fontSize:12,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1,allowDecimals:!1}),(0,gt.jsx)(oG,{contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)",color:"var(--heroui-foreground)"}}),(0,gt.jsx)(Mq,{type:"monotone",dataKey:"count",stroke:"#6366f1",fillOpacity:1,fill:"url(#colorActivity)",strokeWidth:2})]})})}),(0,gt.jsxs)("div",{className:"space-y-4",children:[(0,gt.jsxs)("h3",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 px-1 flex items-center gap-2",children:[(0,gt.jsx)(rp,{className:"w-5 h-5 text-primary"})," Inventory Status"]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:"16px",width:"100%"},children:[(0,gt.jsx)(W$,{title:"In Stock",value:(null===_||void 0===_||null===(t=_.value)||void 0===t?void 0:t.total_count)||0,sub:"Rolls ready to shoot",icon:rp,color:"teal"}),(0,gt.jsx)(W$,{title:"Inventory Value",value:(null===_||void 0===_||null===(n=_.value)||void 0===n?void 0:n.total_value)||0,prefix:"\xa5",sub:"Total asset value",icon:Y$,color:"info"}),(0,gt.jsx)(W$,{title:"Expiring Soon",value:(null===_||void 0===_||null===(i=_.expiring)||void 0===i?void 0:i.length)||0,sub:"Within 180 days",trend:(null===_||void 0===_||null===(a=_.expiring)||void 0===a?void 0:a.length)>0?-10:0,icon:Z$,color:"danger"}),(0,gt.jsx)(W$,{title:"Top Channel",value:(null===_||void 0===_||null===(o=_.channels)||void 0===o||null===(s=o[0])||void 0===s?void 0:s.purchase_channel)||"-",sub:null!==_&&void 0!==_&&null!==(l=_.channels)&&void 0!==l&&l[0]?`${J$(_.channels[0].count)} rolls`:"",icon:If,color:"secondary"})]})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:"1.5rem",width:"100%"},children:[(0,gt.jsx)(K$,{title:"Top Lenses",subtitle:"Most used",height:280,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(Pq,{data:P,layout:"vertical",margin:{left:10,right:30,top:10,bottom:10},children:[(0,gt.jsx)(vz,{strokeDasharray:"3 3",horizontal:!1,stroke:"var(--heroui-divider)"}),(0,gt.jsx)(kz,{type:"number",domain:[0,100],hide:!0}),(0,gt.jsx)(zz,{dataKey:"name",type:"category",width:140,tick:{fontSize:11,fill:"var(--heroui-foreground)"},tickLine:!1,axisLine:!1}),(0,gt.jsx)(oG,{cursor:{fill:"var(--heroui-content2)"},contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"},formatter:e=>`${e}%`}),(0,gt.jsx)(_H,{dataKey:"percentage",fill:"#8b5cf6",radius:[0,4,4,0],barSize:20})]})})}),(0,gt.jsx)(K$,{title:"Camera Usage",subtitle:"By photo count",height:280,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(LH,{children:[(0,gt.jsx)(x$,{data:C.slice(0,6),dataKey:"value",nameKey:"name",cx:"35%",cy:"50%",innerRadius:45,outerRadius:75,paddingAngle:3,children:C.slice(0,6).map((e,t)=>(0,gt.jsx)(Nq,{fill:N[t%N.length]},`cell-c-${t}`))}),(0,gt.jsx)(oG,{contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"}}),(0,gt.jsx)(z$,{layout:"vertical",align:"right",verticalAlign:"middle",iconType:"circle",wrapperStyle:{fontSize:12,paddingLeft:10}})]})})}),(0,gt.jsx)(K$,{title:"Film Type",subtitle:"By photo count",height:280,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(LH,{children:[(0,gt.jsx)(x$,{data:T.slice(0,6),dataKey:"value",nameKey:"name",cx:"35%",cy:"50%",innerRadius:45,outerRadius:75,paddingAngle:3,children:T.slice(0,6).map((e,t)=>(0,gt.jsx)(Nq,{fill:N[t%N.length]},`cell-f-${t}`))}),(0,gt.jsx)(oG,{contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"}}),(0,gt.jsx)(z$,{layout:"vertical",align:"right",verticalAlign:"middle",iconType:"circle",wrapperStyle:{fontSize:12,paddingLeft:10}})]})})}),(0,gt.jsx)(K$,{title:"Popular Themes",subtitle:"Classification",height:280,children:(0,gt.jsx)(Xy,{width:"100%",height:"100%",children:(0,gt.jsxs)(LH,{children:[(0,gt.jsx)(x$,{data:k,dataKey:"value",nameKey:"name",cx:"35%",cy:"50%",innerRadius:45,outerRadius:75,paddingAngle:3,children:k.map((e,t)=>(0,gt.jsx)(Nq,{fill:N[t%N.length]},`cell-t-${t}`))}),(0,gt.jsx)(oG,{contentStyle:{background:"var(--heroui-content1)",borderColor:"var(--heroui-divider)"}}),(0,gt.jsx)(z$,{layout:"vertical",align:"right",verticalAlign:"middle",iconType:"circle",wrapperStyle:{fontSize:12,paddingLeft:10}})]})})})]}),(0,gt.jsx)(K$,{title:"Top Locations",subtitle:"Based on photo count",height:280,children:(0,gt.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,gt.jsx)(U$,{words:R,width:800,height:240,minSize:14,maxSize:48,palette:N})})})]})]})}const nK={fadeIn:{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}},fadeInUp:{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,ease:[.4,0,.2,1]}},fadeInDown:{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3,ease:[.4,0,.2,1]}},slideInLeft:{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3,ease:[.4,0,.2,1]}},slideInRight:{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3,ease:[.4,0,.2,1]}},scaleIn:{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,ease:[.4,0,.2,1]}},popIn:{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:500,damping:30}}};function rK({children:e,animation:t="fadeInUp",delay:n=0,as:r="div",className:i="",...a}){const o=nK[t]||nK.fadeInUp,s=ju[r]||ju.div;return(0,gt.jsx)(s,{initial:o.initial,animate:o.animate,exit:o.exit,transition:{...o.transition,delay:n},className:i,...a,children:e})}function iK({imageUrl:e,photo:t,alt:n="",onPress:i,topLeftAction:a,topRightAction:o,title:s,subtitle:l,onSubtitleClick:c,aspectRatio:u="1/1"}){const[d,h]=(0,r.useState)(e||null),[p,f]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{t?h(function(e){let t=null;return e.positive_thumb_rel_path?t=`/uploads/${e.positive_thumb_rel_path}`:e.negative_thumb_rel_path?t=`/uploads/${e.negative_thumb_rel_path}`:e.thumb_rel_path?t=`/uploads/${e.thumb_rel_path}`:e.positive_rel_path?t=`/uploads/${e.positive_rel_path}`:e.full_rel_path?t=`/uploads/${e.full_rel_path}`:e.filename&&(t=e.filename),t?(0,bn.FH)(t):null}(t)):e&&h(e)},[t,e]),(0,gt.jsx)("div",{onClick:i,className:"group cursor-pointer overflow-hidden rounded-lg transition-all duration-200 hover:shadow-lg hover:scale-[1.02] bg-white dark:bg-zinc-800",children:(0,gt.jsxs)("div",{className:"relative w-full",style:{paddingBottom:"1/1"===u?"100%":"75%"},children:[(0,gt.jsx)("div",{className:"absolute inset-0",children:d?(0,gt.jsx)("img",{src:d,alt:n,onLoad:()=>f(!0),style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center",opacity:p?1:0,transition:"opacity 0.3s ease, transform 0.5s ease"},className:"group-hover:scale-105"}):(0,gt.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 text-zinc-400 dark:text-zinc-500",children:(0,gt.jsx)(Du,{className:"w-8 h-8"})})}),a&&(0,gt.jsx)("div",{className:"absolute top-2 left-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:a}),o&&(0,gt.jsx)("div",{className:"absolute top-2 right-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:o}),(s||l)&&(0,gt.jsxs)("div",{className:"absolute inset-x-0 bottom-0 p-3 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[s&&(0,gt.jsx)("div",{className:"text-white text-xs font-semibold truncate mb-1",children:s}),l&&(0,gt.jsx)("div",{className:"flex items-center gap-2 text-[10px] text-white/80",children:c?(0,gt.jsx)("span",{className:"hover:text-white underline cursor-pointer truncate",onClick:e=>{e.stopPropagation(),c()},children:l}):(0,gt.jsx)("span",{className:"truncate",children:l})})]})]})})}function aK({icon:e,onClick:t,variant:n="default",className:r=""}){const i="danger"===n?"hover:bg-danger/80":"hover:bg-black/60";return(0,gt.jsx)("button",{type:"button",className:`inline-flex items-center justify-center w-8 h-8 rounded-full bg-black/40 backdrop-blur-md text-white transition-colors ${i} ${r}`,onClick:e=>{e.stopPropagation(),null===t||void 0===t||t()},children:e})}function oK(){const[e,t]=(0,r.useState)(null),n=At(),i=se(),{data:a=[],isLoading:o}=Rn({queryKey:["favorites"],queryFn:async()=>{const e=await(0,bn.qZ)();return Array.isArray(e)?e:[]},...vn("photos")}),s=ka({mutationFn:({photoId:e,data:t})=>(0,bn.oN)(e,t),onSuccess:()=>n.invalidateQueries(["favorites"])});return o||0!==a.length?(0,gt.jsxs)("div",{className:"flex flex-col min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6 md:p-8",children:[(0,gt.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Favorites"}),(0,gt.jsxs)("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:[a.length," photos"]})]})}),(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map((e,n)=>(0,gt.jsx)(rK,{delay:.02*n,children:(0,gt.jsx)(sK,{photo:e,onSelect:()=>t(n),onUnlike:()=>async function(e){try{await s.mutateAsync({photoId:e,data:{rating:0}})}catch(t){console.error(t)}}(e.id),onGoToRoll:()=>i(`/rolls/${e.roll_id}`)})},e.id))}),null!==e&&(0,gt.jsx)(Ra.default,{images:a,index:e,onClose:()=>t(null)})]}):(0,gt.jsxs)("div",{className:"flex flex-col min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6 md:p-8",children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold mb-8 tracking-tight",children:"Favorites"}),(0,gt.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[(0,gt.jsx)("div",{className:"w-24 h-24 rounded-full bg-zinc-100/50 dark:bg-zinc-800/50 flex items-center justify-center mb-6",children:(0,gt.jsx)(Im,{className:"w-12 h-12 text-zinc-300 dark:text-zinc-600"})}),(0,gt.jsx)("h3",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-2",children:"No Favorites Yet"}),(0,gt.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 max-w-md",children:"Photos you mark as favorites will appear here. Click the heart icon on any photo to add it to your collection."}),(0,gt.jsx)(La.T,{color:"primary",variant:"flat",className:"mt-6",onPress:()=>i("/"),children:"Browse Photos"})]})]})}function sK({photo:e,onSelect:t,onUnlike:n,onGoToRoll:r}){const i=[e.roll_title||"Untitled Roll",e.film_name||"Unknown Film"].filter(Boolean).join(" \u2022 ");return(0,gt.jsx)(iK,{photo:e,alt:e.filename,onPress:t,topRightAction:(0,gt.jsx)(aK,{icon:(0,gt.jsx)(Im,{className:"w-4 h-4 fill-danger text-danger"}),onClick:n}),title:e.caption,subtitle:i,onSubtitleClick:r})}const lK=$n("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function cK(){const e=se(),t=le(),n=At(),[i,a]=(0,r.useState)(null),{data:o=[]}=Rn({queryKey:["tags"],queryFn:async()=>{const e=await(0,bn.Q2)();return(Array.isArray(e)?e:[]).filter(e=>e.photos_count>0)},...vn("tags")}),s=t.tagId?o.find(e=>String(e.id)===String(t.tagId)):null,{data:l=[],isLoading:c}=Rn({queryKey:["tagPhotos",t.tagId],queryFn:()=>(0,bn.KE)(t.tagId),enabled:!!t.tagId,...vn("photos")}),u=ka({mutationFn:({photoId:e,data:t})=>(0,bn.oN)(e,t),onSuccess:()=>{n.invalidateQueries(["tagPhotos",t.tagId]),n.invalidateQueries(["tags"])}});return s?(0,gt.jsxs)("div",{className:"flex flex-col min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6 md:p-8",children:["}",(0,gt.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"flat",onPress:()=>e("/themes"),children:(0,gt.jsx)(lK,{className:"w-5 h-5"})}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:s.name}),(0,gt.jsxs)("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:[l.length," photos"]})]})]}),c?(0,gt.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,gt.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):0===l.length?(0,gt.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[(0,gt.jsx)("div",{className:"w-24 h-24 rounded-full bg-zinc-100/50 dark:bg-zinc-800/50 flex items-center justify-center mb-6",children:(0,gt.jsx)(Du,{className:"w-12 h-12 text-zinc-300 dark:text-zinc-600"})}),(0,gt.jsx)("h3",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-2",children:"No Photos"}),(0,gt.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400",children:"No photos in this theme yet."})]}):(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:l.map((e,t)=>(0,gt.jsx)(rK,{delay:.02*t,children:(0,gt.jsx)(dK,{photo:e,index:t,onOpenViewer:e=>a(e),onToggleFavorite:async(e,t)=>{try{await u.mutateAsync({photoId:e.id,data:{rating:t?0:1}})}catch(n){console.error(n)}},onRemoveFromTheme:async e=>{if(!window.confirm(`Remove this photo from theme "${s.name}"?`))return;const t=(e.tags||[]).filter(e=>e.id!==s.id).map(e=>e.name);try{await u.mutateAsync({photoId:e.id,data:{tags:t}}),window.dispatchEvent(new Event("refresh-tags"))}catch(n){console.error(n),alert("Failed to remove from theme")}}})},e.id))}),null!==i&&(0,gt.jsx)(Ra.default,{images:l,index:i,onClose:()=>a(null)})]}):(0,gt.jsxs)("div",{className:"flex flex-col min-h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 p-6 md:p-8",children:[(0,gt.jsxs)("div",{className:"mb-8",children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Themes"}),(0,gt.jsxs)("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:[o.length," themes with photos"]})]}),(0,gt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:0===o.length?(0,gt.jsxs)("div",{className:"col-span-full flex flex-col items-center justify-center text-center py-20",children:[(0,gt.jsx)("div",{className:"w-24 h-24 rounded-full bg-zinc-100/50 dark:bg-zinc-800/50 flex items-center justify-center mb-6",children:(0,gt.jsx)(zd,{className:"w-12 h-12 text-zinc-300 dark:text-zinc-600"})}),(0,gt.jsx)("h3",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-2",children:"No Themes Yet"}),(0,gt.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 max-w-md",children:"Add tags to your photos to organize them into themes. Tags will appear here once you create them."})]}):o.map((t,n)=>(0,gt.jsx)(rK,{delay:.03*n,children:(0,gt.jsx)(uK,{tag:t,onSelect:()=>e(`/themes/${t.id}`)})},t.id))})]})}function uK({tag:e,onSelect:t}){const n=e.cover_thumb||e.cover_full,i=n?(0,bn.FH)(n.startsWith("/uploads/")?n:`/uploads/${n}`):null,[a,o]=(0,r.useState)(!1);return(0,gt.jsx)("div",{onClick:t,className:"group cursor-pointer overflow-hidden rounded-lg transition-all duration-300 hover:shadow-xl hover:scale-[1.02] bg-white dark:bg-zinc-800",children:(0,gt.jsxs)("div",{className:"relative w-full",style:{paddingBottom:"100%"},children:[(0,gt.jsx)("div",{className:"absolute inset-0",children:i?(0,gt.jsx)("img",{src:i,alt:e.name,onLoad:()=>o(!0),style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center",opacity:a?1:0,transition:"opacity 0.3s ease, transform 0.5s ease"},className:"group-hover:scale-110"}):(0,gt.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-secondary/20",children:(0,gt.jsx)(zd,{className:"w-12 h-12 text-zinc-300 dark:text-zinc-600"})})}),(0,gt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-80 group-hover:opacity-100 transition-opacity"}),(0,gt.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-4 z-10",children:[(0,gt.jsx)("h3",{className:"text-white text-lg font-bold truncate drop-shadow-lg",children:e.name}),(0,gt.jsxs)("p",{className:"text-white/80 text-xs mt-1",children:[e.photos_count," photos"]})]})]})})}function dK({photo:e,index:t,onOpenViewer:n,onToggleFavorite:i,onRemoveFromTheme:a}){const o=se(),[s,l]=(0,r.useState)(1===(0|e.rating)),c=[e.roll_title,e.film_name||"Unknown Film"].filter(Boolean).join(" \u2022 ");return(0,gt.jsx)(iK,{photo:e,alt:e.caption||"",onPress:()=>n(t),topLeftAction:(0,gt.jsx)(aK,{icon:(0,gt.jsx)(gm,{className:"w-4 h-4"}),onClick:()=>a(e),variant:"danger"}),topRightAction:(0,gt.jsx)(aK,{icon:(0,gt.jsx)(Im,{className:"w-4 h-4 "+(s?"fill-danger text-danger":"")}),onClick:async()=>{const t=s;l(!t);try{await i(e,t)}catch(n){l(t)}}}),title:e.caption,subtitle:c,onSubtitleClick:e.roll_id?()=>o(`/rolls/${e.roll_id}`):void 0})}const hK=$n("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),pK=$n("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),fK=$n("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),mK=[{key:"general",label:"General",icon:hK},{key:"server",label:"Server",icon:pK},{key:"storage",label:"Storage",icon:fK}];function gK({activeTab:e="general",onTabChange:t,showServerTab:n=!1}){const r=mK.filter(e=>!("server"===e.key&&!n));return(0,gt.jsx)(lg,{"aria-label":"Settings sections",selectedKey:e,onSelectionChange:t,color:"primary",variant:"underlined",classNames:{base:"w-full border-b border-zinc-200 dark:border-zinc-700",tabList:"gap-6 w-full relative rounded-none p-0",cursor:"w-full bg-primary",tab:"max-w-fit px-0 h-12",tabContent:"group-data-[selected=true]:text-primary font-medium"},children:r.map(e=>{const t=e.icon;return(0,gt.jsx)(cg,{title:(0,gt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,gt.jsx)(t,{className:"w-4 h-4"}),(0,gt.jsx)("span",{children:e.label})]})},e.key)})})}function vK(e,t,n){let{isDisabled:r=!1,isReadOnly:i=!1,value:a,name:o,form:s,children:l,"aria-label":c,"aria-labelledby":u,validationState:d="valid",isInvalid:h,onPressStart:p,onPressEnd:f,onPressChange:m,onPress:g,onPressUp:v,onClick:A}=e;let{pressProps:y,isPressed:b}=(0,lo.d)({onPressStart:p,onPressEnd:f,onPressChange:m,onPress:g,onPressUp:v,onClick:A,isDisabled:r}),{pressProps:x,isPressed:_}=(0,lo.d)({onPressStart:p,onPressEnd:f,onPressChange:m,onPressUp:v,onClick:A,onPress(e){var r;null===g||void 0===g||g(e),t.toggle(),null===(r=n.current)||void 0===r||r.focus()},isDisabled:r||i}),{focusableProps:w}=(0,Mf.Wc)(e,n),S=(0,go.v)(y,w),T=(0,Io.$)(e,{labelable:!0});return Cf(n,t.defaultSelected,t.setSelected),{labelProps:(0,go.v)(x,{onClick:e=>e.preventDefault()}),inputProps:(0,go.v)(T,{"aria-invalid":h||"invalid"===d||void 0,"aria-errormessage":e["aria-errormessage"],"aria-controls":e["aria-controls"],"aria-readonly":i||void 0,onChange:e=>{e.stopPropagation(),t.setSelected(e.target.checked)},disabled:r,...null==a?{}:{value:a},name:o,form:s,type:"checkbox",...S}),isSelected:t.isSelected,isPressed:b||_,isDisabled:r,isReadOnly:i,isInvalid:h||"invalid"===d}}function AK(e,t,n){let{labelProps:r,inputProps:i,isSelected:a,isPressed:o,isDisabled:s,isReadOnly:l}=vK(e,t,n);return{labelProps:r,inputProps:{...i,role:"switch",checked:a},isSelected:a,isPressed:o,isDisabled:s,isReadOnly:l}}function yK(e={}){var t,n;const i=(0,Bn.o)(),[a,o]=(0,Ln.rE)(e,qa.L$.variantKeys),{ref:s,as:l,name:c,value:u="",isReadOnly:d=!1,autoFocus:h=!1,startContent:p,endContent:f,defaultSelected:m,isSelected:g,children:v,thumbIcon:A,className:y,classNames:b,onChange:x,onValueChange:_,...w}=a,S=l||"label",T=(0,r.useRef)(null),C=(0,r.useRef)(null),M=null!=(n=null!=(t=e.disableAnimation)?t:null==i?void 0:i.disableAnimation)&&n,E=(0,r.useId)(),P=(0,r.useMemo)(()=>{const t=w["aria-label"]||"string"===typeof v?v:void 0;return{name:c,value:u,children:v,autoFocus:h,defaultSelected:m,isSelected:g,isDisabled:!!e.isDisabled,isReadOnly:d,"aria-label":t,"aria-labelledby":w["aria-labelledby"]||E,onChange:_}},[u,c,E,v,h,d,g,m,e.isDisabled,w["aria-label"],w["aria-labelledby"],_]),N=function(e={}){let{isReadOnly:t}=e,[n,i]=(0,Os.P)(e.isSelected,e.defaultSelected||!1,e.onChange),[a]=(0,r.useState)(n);var o;return{isSelected:n,defaultSelected:null!==(o=e.defaultSelected)&&void 0!==o?o:a,setSelected:function(e){t||i(e)},toggle:function(){t||i(!n)}}}(P);(0,_p.U)(()=>{if(!C.current)return;const e=!!C.current.checked;N.setSelected(e)},[C.current]);const{inputProps:k,isPressed:R,isReadOnly:L}=AK(P,N,C),{focusProps:O,isFocused:j,isFocusVisible:D}=(0,Oo.o)({autoFocus:k.autoFocus}),{hoverProps:I,isHovered:B}=(0,qo.M)({isDisabled:k.disabled}),F=!(P.isDisabled||L)&&R,z=k.checked,U=k.disabled,V=(0,r.useMemo)(()=>(0,qa.L$)({...o,disableAnimation:M}),[(0,In.t6)(o),M]),G=(0,Dn.cn)(null==b?void 0:b.base,y),q=(0,r.useCallback)((e={})=>({...e,"aria-hidden":!0,className:V.wrapper({class:(0,Dn.cn)(null==b?void 0:b.wrapper,null==e?void 0:e.className)})}),[V,null==b?void 0:b.wrapper]),W=(0,r.useCallback)((e={})=>({...e,className:V.thumb({class:(0,Dn.cn)(null==b?void 0:b.thumb,null==e?void 0:e.className)})}),[V,null==b?void 0:b.thumb]),H=(0,r.useCallback)((e={})=>({...e,id:E,className:V.label({class:(0,Dn.cn)(null==b?void 0:b.label,null==e?void 0:e.className)})}),[V,null==b?void 0:b.label,U,z]),$=(0,r.useCallback)((e={includeStateProps:!1})=>(0,In.v6)({width:"1em",height:"1em",className:V.thumbIcon({class:(0,Dn.cn)(null==b?void 0:b.thumbIcon)})},e.includeStateProps?{isSelected:z}:{}),[V,null==b?void 0:b.thumbIcon,z]),K=(0,r.useCallback)((e={})=>({width:"1em",height:"1em",...e,className:V.startContent({class:(0,Dn.cn)(null==b?void 0:b.startContent,null==e?void 0:e.className)})}),[V,null==b?void 0:b.startContent,z]),X=(0,r.useCallback)((e={})=>({width:"1em",height:"1em",...e,className:V.endContent({class:(0,Dn.cn)(null==b?void 0:b.endContent,null==e?void 0:e.className)})}),[V,null==b?void 0:b.endContent,z]);return{Component:S,slots:V,classNames:b,domRef:T,children:v,thumbIcon:A,startContent:p,endContent:f,isHovered:B,isSelected:z,isPressed:F,isFocused:j,isFocusVisible:D,isDisabled:U,getBaseProps:e=>({...(0,In.v6)(I,w,e),ref:T,className:V.base({class:(0,Dn.cn)(G,null==e?void 0:e.className)}),"data-disabled":(0,In.sE)(U),"data-selected":(0,In.sE)(z),"data-readonly":(0,In.sE)(L),"data-focus":(0,In.sE)(j),"data-focus-visible":(0,In.sE)(D),"data-hover":(0,In.sE)(B),"data-pressed":(0,In.sE)(F)}),getWrapperProps:q,getInputProps:(e={})=>({...(0,In.v6)(k,O,e),ref:_o(C,s),id:k.id,className:V.hiddenInput({class:null==b?void 0:b.hiddenInput}),onChange:(0,In.cy)(x,k.onChange)}),getLabelProps:H,getThumbProps:W,getThumbIconProps:$,getStartContentProps:K,getEndContentProps:X}}var bK=(0,Ln.Rf)((e,t)=>{const{Component:n,children:i,startContent:a,endContent:o,thumbIcon:s,getBaseProps:l,getInputProps:c,getWrapperProps:u,getThumbProps:d,getThumbIconProps:h,getLabelProps:p,getStartContentProps:f,getEndContentProps:m}=yK({...e,ref:t}),g="function"===typeof s?s(h({includeStateProps:!0})):s&&(0,r.cloneElement)(s,h()),v=a&&(0,r.cloneElement)(a,f()),A=o&&(0,r.cloneElement)(o,m());return(0,gt.jsxs)(n,{...l(),children:[(0,gt.jsx)("input",{...c()}),(0,gt.jsxs)("span",{...u(),children:[a&&v,(0,gt.jsx)("span",{...d(),children:s&&g}),o&&A]}),i&&(0,gt.jsx)("span",{...p(),children:i})]})});bK.displayName="HeroUI.Switch";var xK=bK;const _K=$n("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),wK=$n("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),SK=$n("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),TK=$n("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),CK=$n("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);function MK({config:e,serverInfo:t,actualPaths:n,isElectron:i,isRemoteServer:a,onChooseDataRoot:o,onChooseUploadsRoot:s,onToggleWriteThrough:l}){var c,u;const[d,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),m=({title:e,icon:t,children:n,variant:r="default",className:i=""})=>(0,gt.jsx)(Nm,{className:`${{default:"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700",primary:"bg-primary/5 border-primary/20",warning:"bg-warning/5 border-warning/20"}[r]} ${i}`,shadow:"sm",children:(0,gt.jsxs)(Rm,{className:"p-6",children:[(0,gt.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-3",children:[t&&(0,gt.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg bg-primary/10",children:(0,gt.jsx)(t,{className:"w-4 h-4 text-primary"})}),e]}),n]})});return(0,gt.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto animate-in fade-in duration-500",children:[i&&(0,gt.jsxs)(m,{title:"Mobile & Watch Connection",icon:_K,variant:"primary",children:[(0,gt.jsx)("p",{className:"text-default-500 mb-4 text-sm",children:"Use the following information to connect your Mobile or Watch app to this PC."}),(0,gt.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,gt.jsx)(Nm,{shadow:"none",className:"bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 min-w-[120px]",children:(0,gt.jsxs)(Rm,{className:"p-3",children:[(0,gt.jsx)("div",{className:"text-xs text-default-500 uppercase tracking-wider mb-1",children:"Port"}),(0,gt.jsx)("div",{className:"text-xl font-bold font-mono",children:(null===(c=window.__electron)||void 0===c?void 0:c.SERVER_PORT)||4e3})]})}),(0,gt.jsx)(Nm,{shadow:"none",className:"bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 flex-1 min-w-[200px]",children:(0,gt.jsxs)(Rm,{className:"p-3",children:[(0,gt.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-1",children:"API Address"}),(0,gt.jsx)("code",{className:"text-sm font-mono text-zinc-900 dark:text-zinc-100 break-all",children:(null===(u=window.__electron)||void 0===u?void 0:u.API_BASE)||"http://127.0.0.1:4000"})]})})]}),(0,gt.jsxs)("div",{className:"mt-4 flex gap-2 text-sm text-primary/80 bg-zinc-50/50 dark:bg-zinc-900/50 p-3 rounded-lg border border-primary/10",children:[(0,gt.jsx)(wK,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,gt.jsx)("p",{children:"On your mobile device, enter this computer's IP address. The app will automatically discover the service port."})]})]}),!i&&(0,gt.jsx)(Nm,{shadow:"sm",className:"bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700",children:(0,gt.jsx)(Rm,{className:"p-4 text-center text-sm text-zinc-500 dark:text-zinc-400",children:"Storage path settings are managed by the host environment (Docker/Server)."})}),a&&(0,gt.jsxs)(m,{title:"Remote Storage",icon:SK,children:[(0,gt.jsx)("div",{className:"mb-4 text-sm text-default-500",children:"Connected to remote server. Storage paths are managed by the server configuration."}),n&&(0,gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,gt.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-800 p-3 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsx)("div",{className:"text-xs text-default-500 mb-1",children:"Database Location"}),(0,gt.jsx)("code",{className:"text-xs font-mono break-all",children:n.databasePath})]}),(0,gt.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-800 p-3 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsx)("div",{className:"text-xs text-default-500 mb-1",children:"Photos Location"}),(0,gt.jsx)("code",{className:"text-xs font-mono break-all",children:n.uploadsDir})]})]}),t&&(0,gt.jsxs)("div",{className:"mt-4 flex gap-6 text-sm text-default-600 border-t border-zinc-200 dark:border-zinc-700 pt-4",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("span",{className:"text-default-400 mr-2",children:"Mode:"}),(0,gt.jsx)("span",{className:"font-medium",children:t.serverMode||"unknown"})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("span",{className:"text-default-400 mr-2",children:"Version:"}),(0,gt.jsx)("span",{className:"font-medium",children:t.version||"unknown"})]})]}),(0,gt.jsxs)("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-sm text-yellow-600 dark:text-yellow-400 flex gap-2",children:[(0,gt.jsx)(Z$,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,gt.jsxs)("p",{children:["To change storage paths, please edit the ",(0,gt.jsx)("code",{children:"docker-compose.yml"})," volume configuration on your NAS/Server."]})]})]}),!a&&(0,gt.jsxs)(m,{title:"Data Storage Location",icon:fK,children:[(0,gt.jsxs)("p",{className:"text-default-500 text-sm mb-4",children:["Choose where the database (film.db) and uploaded photos are stored. Moving this to a ",(0,gt.jsx)("strong",{children:"OneDrive"})," or ",(0,gt.jsx)("strong",{children:"Dropbox"})," folder enables syncing across devices."]}),(0,gt.jsx)(Nm,{shadow:"none",className:"bg-zinc-100/50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700",children:(0,gt.jsxs)(Rm,{className:"p-4 flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[(0,gt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,gt.jsx)("div",{className:"text-xs text-default-500 mb-1",children:"Current Root Path"}),(0,gt.jsx)("code",{className:"text-sm font-mono block truncate",title:e.dataRoot,children:e.dataRoot||"(Default) %APPDATA%/FilmGallery"})]}),(0,gt.jsx)(La.T,{onPress:async()=>{h(!0),await o(),h(!1)},isDisabled:d,isLoading:d,variant:"bordered",size:"sm",children:d?"Moving...":"Change Location..."})]})}),n&&(0,gt.jsxs)("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-default-500",children:[(0,gt.jsxs)("div",{className:"flex gap-2",children:[(0,gt.jsx)("span",{className:"font-medium",children:"DB:"}),(0,gt.jsx)("span",{className:"truncate",title:n.databasePath,children:n.databasePath})]}),(0,gt.jsxs)("div",{className:"flex gap-2",children:[(0,gt.jsx)("span",{className:"font-medium",children:"Files:"}),(0,gt.jsx)("span",{className:"truncate",title:n.uploadsDir,children:n.uploadsDir})]})]})]}),!a&&(0,gt.jsx)(m,{title:"Cloud Sync Optimization",icon:TK,children:(0,gt.jsxs)("div",{className:"flex items-start justify-between gap-4 p-4 bg-zinc-100/50 dark:bg-zinc-800/50 rounded-xl border border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsxs)("div",{className:"flex-1",children:[(0,gt.jsx)("h4",{className:"font-medium text-foreground",children:"Database Write-through"}),(0,gt.jsx)("p",{className:"text-sm text-default-500 mt-1",children:"Enable this if you are syncing your database via OneDrive/Dropbox. It forces safer file operations (TRUNCATE mode) to prevent sync conflicts, though it may be slightly slower."})]}),(0,gt.jsx)(xK,{isSelected:!!e.writeThrough,onValueChange:async e=>{f(!0),await l(e),f(!1)},isDisabled:p,color:"primary",size:"lg",classNames:{wrapper:"group-data-[selected=true]:bg-primary"}})]})}),!a&&(0,gt.jsxs)(m,{title:"Legacy Images Location",icon:CK,className:"opacity-80",children:[(0,gt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,gt.jsx)("div",{children:(0,gt.jsx)("p",{className:"text-sm text-default-500",children:"Override only the uploads folder. Not recommended if you are using the Data Storage Location setting above."})}),(0,gt.jsx)(La.T,{onPress:async()=>{h(!0),await s(),h(!1)},isDisabled:d,variant:"bordered",size:"sm",children:"Change Path"})]}),(0,gt.jsx)("div",{className:"mt-2",children:(0,gt.jsx)("code",{className:"text-xs bg-zinc-100 dark:bg-zinc-800 px-2 py-1 rounded text-default-500",children:e.uploadsRoot||"(Default)"})})]})]})}const EK=$n("laptop",[["path",{d:"M18 5a2 2 0 0 1 2 2v8.526a2 2 0 0 0 .212.897l1.068 2.127a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45l1.068-2.127A2 2 0 0 0 4 15.526V7a2 2 0 0 1 2-2z",key:"1pdavp"}],["path",{d:"M20.054 15.987H3.946",key:"14rxg9"}]]),PK=$n("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),NK=$n("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),kK=$n("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),RK=$n("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),LK=$n("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function OK(){var e,t,n,i,a;const o=!!window.__electron,[s,l]=(0,r.useState)("local"),[c,u]=(0,r.useState)(""),[d,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[m,g]=(0,r.useState)(!1),v=(null===(e=window.__electron)||void 0===e?void 0:e.API_BASE)||bn.tE,A=(null===(t=window.__electron)||void 0===t?void 0:t.SERVER_PORT)||4e3;(0,r.useEffect)(()=>{(async(e,t)=>{if(null!==(e=window.__electron)&&void 0!==e&&e.getServerMode){const e=await window.__electron.getServerMode();e&&(l(e.mode||"local"),"local"!==e.mode&&e.apiBase&&u(e.apiBase))}else if(null!==(t=window.__electron)&&void 0!==t&&t.getConfig){const e=await window.__electron.getConfig();e.serverMode?(l(e.serverMode),e.apiBase&&u(e.apiBase)):e.apiBase&&e.apiBase!==`http://127.0.0.1:${A}`&&(l(e.useLocalCompute?"hybrid":"remote"),u(e.apiBase))}try{const e=await fetch(`${v}/api/discover`);if(e.ok){const t=await e.json();f(t)}}catch(or){console.warn("Failed to fetch server info:",or)}})()},[v,A]);const y=(0,r.useCallback)(async e=>{if(e){h("testing");try{const t=e.replace(/\/+$/,""),n=await fetch(`${t}/api/discover`,{timeout:5e3,mode:"cors"});if(n.ok){const e=await n.json();if("FilmGallery"===e.app||"filmgallery"===e.name)return f(e),h("success"),!0}return h("error"),!1}catch(or){return console.error("Connection test failed:",or),h("error"),!1}}},[]),b=({mode:e,icon:t,title:n,description:r})=>(0,gt.jsx)(Nm,{isPressable:!0,onPress:()=>l(e),className:`\n        cursor-pointer relative h-full transition-all duration-200\n        ${s===e?"border-2 border-primary bg-primary/5":"border-2 border-transparent hover:border-default-300"}\n      `,children:(0,gt.jsxs)(Rm,{className:"flex flex-col items-center text-center gap-3 p-5",children:[(0,gt.jsx)("div",{className:"p-3 rounded-lg "+(s===e?"bg-primary text-primary-foreground":"bg-zinc-100 dark:bg-zinc-800 text-default-500"),children:(0,gt.jsx)(t,{className:"w-6 h-6"})}),(0,gt.jsxs)("div",{className:"flex-1",children:[(0,gt.jsx)("h3",{className:"font-semibold "+(s===e?"text-primary":"text-foreground"),children:n}),(0,gt.jsx)("p",{className:"text-sm text-default-500 mt-2 leading-relaxed",children:r})]}),s===e&&(0,gt.jsx)("div",{className:"absolute top-3 right-3 text-primary",children:(0,gt.jsx)(Lf,{className:"w-5 h-5"})})]})});return(0,gt.jsxs)("div",{className:"space-y-8 w-full max-w-6xl mx-auto pb-12 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,gt.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,gt.jsx)("div",{className:"p-2 bg-primary/10 rounded-lg",children:(0,gt.jsx)(pK,{className:"w-6 h-6 text-primary"})}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h2",{className:"text-xl font-bold",children:"Server Connection"}),(0,gt.jsx)("p",{className:"text-default-500 text-sm",children:"Configure where your data is stored and processed"})]})]}),(0,gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full auto-rows-fr",children:[(0,gt.jsx)(b,{mode:"local",icon:EK,title:"Local Server",description:"Data stored on this computer. FilmLab uses local GPU for processing."}),(0,gt.jsx)(b,{mode:"remote",icon:PK,title:"Remote Server",description:"Connect to NAS or remote server. All processing happens remotely."}),(0,gt.jsx)(b,{mode:"hybrid",icon:NK,title:"Hybrid Mode",description:"Data on NAS, but uses this computer's GPU for faster processing. (Recommended)"})]}),"local"!==s&&(0,gt.jsx)(Nm,{className:"animate-in fade-in zoom-in-95 w-full",children:(0,gt.jsxs)(Rm,{className:"p-6 space-y-4",children:[(0,gt.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Remote Server URL"}),(0,gt.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full",children:[(0,gt.jsx)(Nf,{value:c,onValueChange:u,placeholder:"http://192.168.1.100:4000",startContent:(0,gt.jsx)(PK,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-default-100 dark:bg-default-50/10 border-default-300 dark:border-default-200",input:"text-foreground placeholder:text-default-400"}}),(0,gt.jsx)(La.T,{onPress:()=>y(c),isDisabled:!c||"testing"===d,isLoading:"testing"===d,variant:"bordered",className:"min-w-[140px]",children:"testing"===d?"Testing...":"Test Connection"})]}),"success"===d&&(0,gt.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-600 bg-green-500/10 p-3 rounded-lg border border-green-500/20",children:[(0,gt.jsx)(Lf,{className:"w-4 h-4"}),(0,gt.jsx)("span",{children:"Connection successful!"}),p&&(0,gt.jsxs)("span",{className:"text-xs opacity-80",children:["v",p.version," (",p.mode||"standalone",")"]})]}),"error"===d&&(0,gt.jsxs)("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-500/10 p-3 rounded-lg border border-red-500/20",children:[(0,gt.jsx)(kK,{className:"w-4 h-4"}),(0,gt.jsx)("span",{children:"Connection failed. Please check the URL and network."})]}),"hybrid"===s&&(0,gt.jsxs)("div",{className:"flex gap-3 p-4 bg-orange-500/5 border border-orange-500/20 rounded-lg text-sm text-orange-700 dark:text-orange-400",children:[(0,gt.jsx)(wK,{className:"w-5 h-5 flex-shrink-0"}),(0,gt.jsxs)("ul",{className:"list-disc list-inside space-y-1 opacity-90",children:[(0,gt.jsx)("li",{children:"Photos are stored on your NAS/Server"}),(0,gt.jsx)("li",{children:"Image processing uses your Local GPU"}),(0,gt.jsx)("li",{children:"Requires NAS and PC to be on the same network"})]})]})]})}),(0,gt.jsx)(Nm,{className:"w-full",children:(0,gt.jsxs)(Rm,{className:"p-6",children:[(0,gt.jsxs)("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:["Current Status",p?(0,gt.jsx)(el,{color:"success",variant:"flat",size:"sm",children:"Connected"}):(0,gt.jsx)(el,{variant:"flat",size:"sm",children:"Unknown"})]}),(0,gt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 text-sm w-full",children:[(0,gt.jsxs)("div",{className:"space-y-1",children:[(0,gt.jsx)("span",{className:"text-default-500 block text-xs uppercase tracking-wider",children:"API Endpoint"}),(0,gt.jsx)("code",{className:"bg-zinc-100 dark:bg-zinc-800 px-2 py-1 rounded border border-zinc-200 dark:border-zinc-700 text-xs font-mono break-all block w-full",children:v})]}),p&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsxs)("div",{className:"space-y-1",children:[(0,gt.jsx)("span",{className:"text-default-500 block text-xs uppercase tracking-wider",children:"Version"}),(0,gt.jsx)("span",{className:"font-medium",children:p.version})]}),(0,gt.jsxs)("div",{className:"space-y-1 col-span-full",children:[(0,gt.jsx)("span",{className:"text-default-500 block text-xs uppercase tracking-wider",children:"Capabilities"}),(0,gt.jsxs)("div",{className:"flex gap-2 mt-1",children:[(null===(n=p.capabilities)||void 0===n?void 0:n.database)&&(0,gt.jsx)(el,{color:"primary",variant:"flat",size:"sm",children:"Database"}),(null===(i=p.capabilities)||void 0===i?void 0:i.files)&&(0,gt.jsx)(el,{color:"warning",variant:"flat",size:"sm",children:"File Storage"}),(null===(a=p.capabilities)||void 0===a?void 0:a.compute)&&(0,gt.jsx)(el,{color:"secondary",variant:"flat",size:"sm",children:"GPU Compute"})]})]})]})]})]})}),(0,gt.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end gap-4 pt-4 border-t border-zinc-200 dark:border-zinc-700 w-full",children:["local"!==s&&(0,gt.jsx)(La.T,{onPress:async()=>{if(l("local"),u(""),f(null),o){var e;null!==(e=window.__electron)&&void 0!==e&&e.setServerMode&&await window.__electron.setServerMode("local",{useLocalCompute:!0});const t=`http://127.0.0.1:${A}`;try{const e=await fetch(`${t}/api/discover`);if(e.ok){const t=await e.json();f(t)}}catch(or){console.warn("Local server not responding:",or)}}},variant:"bordered",startContent:(0,gt.jsx)(RK,{className:"w-4 h-4"}),children:"Reset to Local"}),(0,gt.jsx)(La.T,{onPress:async()=>{if(o){g(!0);try{if("local"===s){var e,t;const n=await(null===(e=window.__electron)||void 0===e||null===(t=e.setServerMode)||void 0===t?void 0:t.call(e,"local",{useLocalCompute:!0}));null!==n&&void 0!==n&&n.ok?alert("\u5df2\u5207\u6362\u5230\u672c\u5730\u670d\u52a1\u5668\u3002\u9700\u8981\u91cd\u542f\u5e94\u7528\u4ee5\u751f\u6548\u3002"):alert("\u4fdd\u5b58\u5931\u8d25")}else{var n,r,i,a;if(!c)return alert("\u8bf7\u8f93\u5165\u8fdc\u7a0b\u670d\u52a1\u5668\u5730\u5740"),void g(!1);if(!await y(c))return alert("\u65e0\u6cd5\u8fde\u63a5\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\uff0c\u8bf7\u68c0\u67e5\u5730\u5740"),void g(!1);const e=c.replace(/\/+$/,""),t=await(null===(n=window.__electron)||void 0===n||null===(r=n.setServerMode)||void 0===r?void 0:r.call(n,s,{remoteUrl:e,useLocalCompute:"hybrid"===s}));await(null===(i=window.__electron)||void 0===i||null===(a=i.setApiBase)||void 0===a?void 0:a.call(i,e)),null!==t&&void 0!==t&&t.ok?alert("\u670d\u52a1\u5668\u8bbe\u7f6e\u5df2\u4fdd\u5b58\u3002\u9700\u8981\u91cd\u542f\u5e94\u7528\u4ee5\u751f\u6548\u3002"):alert("\u4fdd\u5b58\u5931\u8d25")}}catch(or){alert("\u4fdd\u5b58\u51fa\u9519: "+((null===or||void 0===or?void 0:or.message)||or))}finally{g(!1)}}},isDisabled:m||"local"!==s&&!c,isLoading:m,color:"primary",startContent:!m&&(0,gt.jsx)(LK,{className:"w-4 h-4"}),className:"shadow-lg shadow-primary/20",children:m?"Saving...":"Save Settings"})]}),(0,gt.jsx)("p",{className:"text-center text-xs text-default-500 mt-4",children:"Note: Application restart is required after changing server settings."})]})}function jK(){const[e,t]=(0,r.useState)({}),[n,i]=(0,r.useState)(null),[a,o]=(0,r.useState)(null),[s,l]=(0,r.useState)("general"),c=!!window.__electron,u=(()=>{try{const e=new URL((0,bn.Gi)()).hostname.toLowerCase();return"localhost"!==e&&"127.0.0.1"!==e}catch{return!1}})();return(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{var n,r;const a=(0,bn.Gi)(),s=await((null===(n=window.__electron)||void 0===n||null===(r=n.getConfig)||void 0===r?void 0:r.call(n))||{});e&&t(s||{});try{const t=await fetch(`${a}/api/health`);if(t.ok){const n=await t.json();e&&n.storage&&i(n.storage)}}catch{}try{const t=await fetch(`${a}/api/discover`);if(t.ok){const n=await t.json();e&&o(n)}}catch{}}catch(or){console.warn("Failed to load settings:",or)}})(),()=>{e=!1}},[]),(0,gt.jsx)("div",{className:"flex flex-col h-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 animate-in fade-in duration-300",children:(0,gt.jsxs)("div",{className:"p-6 md:p-8 max-w-7xl mx-auto w-full",children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold mb-8 tracking-tight",children:"Settings"}),(0,gt.jsx)("div",{className:"mb-8",children:(0,gt.jsx)(gK,{activeTab:s,onTabChange:l,showServerTab:!0})}),(0,gt.jsxs)("div",{className:"min-h-[400px]",children:["general"===s&&(0,gt.jsx)(MK,{config:e,serverInfo:a,actualPaths:n,isElectron:c,isRemoteServer:u,onChooseDataRoot:async function(){try{var e,n,r,a;if(!c)return;const o=await(null===(e=window.__electron)||void 0===e||null===(n=e.pickDataRoot)||void 0===n?void 0:n.call(e));if(!o)return;const s=await(null===(r=window.__electron)||void 0===r||null===(a=r.setDataRoot)||void 0===a?void 0:a.call(r,o));s&&s.ok?(t(s.config||{}),setTimeout(async()=>{try{const e=(0,bn.Gi)(),t=await fetch(`${e}/api/health`);if(t.ok){const e=await t.json();e.storage&&i(e.storage)}}catch{}},1e3),alert("Data location updated. The server has been restarted.")):alert("Failed to save data root.")}catch(or){alert("Error: "+((null===or||void 0===or?void 0:or.message)||or))}},onChooseUploadsRoot:async function(){try{var e,n,r,i;if(!c)return;const a=await(null===(e=window.__electron)||void 0===e||null===(n=e.pickUploadsRoot)||void 0===n?void 0:n.call(e));if(!a)return;const o=await(null===(r=window.__electron)||void 0===r||null===(i=r.setUploadsRoot)||void 0===i?void 0:i.call(r,a));o&&o.ok?t(o.config||{}):alert("Failed to save uploads root.")}catch(or){alert("Error: "+((null===or||void 0===or?void 0:or.message)||or))}},onToggleWriteThrough:async function(e){var n;if(null!==(n=window.__electron)&&void 0!==n&&n.setWriteThrough)try{const n=await window.__electron.setWriteThrough(e);n&&n.ok?t(n.config||{}):alert("Failed to update write-through mode.")}catch(or){alert("Error: "+((null===or||void 0===or?void 0:or.message)||or))}}}),"server"===s&&(0,gt.jsx)(OK,{}),"storage"===s&&(0,gt.jsx)("div",{className:"p-12 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-100 dark:bg-zinc-800/30 rounded-xl border border-zinc-200 dark:border-zinc-700 border-dashed",children:(0,gt.jsx)("p",{children:"Storage analysis coming soon..."})})]})]})})}var DK=n.p+"static/media/logo.b0365761f999088a0e69c5a3ddcf1fae.svg";function IK(){return(0,gt.jsxs)("div",{className:"title-bar",children:[(0,gt.jsxs)("div",{className:"title-bar-title",children:[(0,gt.jsx)("img",{src:DK,alt:"",className:"title-bar-icon"}),"Film Gallery"]}),(0,gt.jsxs)("div",{className:"window-controls",children:[(0,gt.jsx)("button",{className:"control-btn minimize-btn",onClick:()=>{window.__electron&&window.__electron.minimize()},title:"Minimize",children:(0,gt.jsx)("svg",{width:"10",height:"1",viewBox:"0 0 10 1",children:(0,gt.jsx)("path",{d:"M0 0h10v1H0z",fill:"currentColor"})})}),(0,gt.jsx)("button",{className:"control-btn maximize-btn",onClick:()=>{window.__electron&&window.__electron.maximize()},title:"Maximize",children:(0,gt.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:(0,gt.jsx)("path",{d:"M1 1h8v8H1z",fill:"none",stroke:"currentColor",strokeWidth:"1"})})}),(0,gt.jsx)("button",{className:"control-btn close-btn",onClick:()=>{window.__electron&&window.__electron.close()},title:"Close",children:(0,gt.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:(0,gt.jsx)("path",{d:"M1 1l8 8m0-8l-8 8",stroke:"currentColor",strokeWidth:"1.2"})})})]})]})}var BK=()=>{const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(!1),[a,o]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s();const e=setInterval(s,3e5);return()=>clearInterval(e)},[]);const s=async()=>{try{const e=(0,bn.Gi)(),n=await fetch(`${e}/api/conflicts`),r=await n.json();r.hasConflicts&&r.conflicts.length>0?(t(r),o(!1)):t(null)}catch(e){console.error("Failed to check conflicts:",e)}};if(!e||a)return null;const l=e.conflicts.reduce((e,t)=>{var n;const r=(null===(n=t.analysis)||void 0===n?void 0:n.reduce((e,t)=>e+(t.toImport||0)+(t.toUpdate||0),0))||0;return e+r},0);return(0,gt.jsxs)("div",{className:"conflict-banner",children:[(0,gt.jsxs)("div",{className:"conflict-banner-content",children:[(0,gt.jsx)("div",{className:"conflict-icon",children:"\u26a0\ufe0f"}),(0,gt.jsxs)("div",{className:"conflict-info",children:[(0,gt.jsx)("div",{className:"conflict-title",children:"\u68c0\u6d4b\u5230\u6570\u636e\u5e93\u51b2\u7a81\u526f\u672c"}),(0,gt.jsxs)("div",{className:"conflict-details",children:["\u53d1\u73b0 ",e.conflicts.length," \u4e2aOneDrive\u540c\u6b65\u51b2\u7a81\u6587\u4ef6",l>0&&` (\u5305\u542b ${l} \u6761\u65b0\u8bb0\u5f55)`]})]}),(0,gt.jsxs)("div",{className:"conflict-actions",children:[(0,gt.jsx)("button",{className:"conflict-btn conflict-btn-resolve",onClick:async()=>{i(!0);try{const e=(0,bn.Gi)(),n=await fetch(`${e}/api/conflicts/resolve`,{method:"POST"}),r=await n.json();r.ok?(alert(`\u5df2\u6210\u529f\u5408\u5e76 ${r.conflictsProcessed} \u4e2a\u51b2\u7a81\u526f\u672c`),t(null),o(!0)):alert("\u5408\u5e76\u5931\u8d25: "+(r.error||"\u672a\u77e5\u9519\u8bef"))}catch(e){alert("\u5408\u5e76\u8bf7\u6c42\u5931\u8d25: "+e.message)}finally{i(!1)}},disabled:n,children:n?"\u5408\u5e76\u4e2d...":"\u81ea\u52a8\u5408\u5e76"}),(0,gt.jsx)("button",{className:"conflict-btn conflict-btn-dismiss",onClick:()=>{o(!0)},children:"\u6682\u65f6\u5ffd\u7565"})]})]}),(0,gt.jsx)("div",{className:"conflict-details-list",children:e.conflicts.map((e,t)=>(0,gt.jsxs)("div",{className:"conflict-item",children:[(0,gt.jsx)("span",{className:"conflict-filename",children:e.filename}),(0,gt.jsx)("span",{className:"conflict-time",children:new Date(e.mtime).toLocaleString()}),e.analysis&&e.analysis.map((e,t)=>e.needsMerge&&(0,gt.jsxs)("span",{className:"conflict-table-info",children:[e.table,": ",e.toImport||0," \u65b0\u589e, ",e.toUpdate||0," \u66f4\u65b0"]},t))]},t))})]})};const FK=$n("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),zK=$n("scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);const UK=["SLR","Rangefinder","P&S","TLR","Medium Format","Large Format","Instant","Half Frame","Other"],VK=["M42","Pentax K","Nikon F","Canon FD","Canon EF","Minolta MD","Minolta A","Leica M","Leica R","Leica L","Contax/Yashica","Olympus OM","Sony A","Sony E","Micro Four Thirds","Fuji X","Hasselblad V","Mamiya 645","Mamiya RB/RZ","Pentax 645","Pentax 67","Fixed"],GK=["135","120","220","110","127","Large Format 4x5","Large Format 8x10","Instant","APS","Half Frame"],qK=["Flatbed","Film Scanner","Drum Scanner","DSLR Scan Rig","Virtual Drum","Lab Scanner","Other"],WK=[{value:"645",label:"6x4.5 (645)"},{value:"6x6",label:"6x6"},{value:"6x7",label:"6x7"},{value:"6x8",label:"6x8"},{value:"6x9",label:"6x9"},{value:"6x12",label:"6x12"},{value:"6x17",label:"6x17"}],HK=["Hasselblad V","Mamiya RB67","Mamiya RZ67","Mamiya 645","Pentax 645","Pentax 67","Bronica ETR","Bronica SQ","Bronica GS-1","Rollei SL66","Graflex","Universal"],$K=[{value:"none",label:"None"},{value:"match-needle",label:"Match-Needle"},{value:"center-weighted",label:"Center-Weighted"},{value:"matrix",label:"Matrix"},{value:"spot",label:"Spot"},{value:"evaluative",label:"Evaluative"}],KK=[{value:"manual",label:"Manual"},{value:"auto",label:"Auto"},{value:"hybrid",label:"Hybrid"}],XK=[{value:"mint",label:"Mint"},{value:"excellent",label:"Excellent"},{value:"good",label:"Good"},{value:"fair",label:"Fair"},{value:"poor",label:"Poor"},{value:"for_parts",label:"For Parts"}],YK=[{value:"owned",label:"Owned"},{value:"sold",label:"Sold"},{value:"wishlist",label:"Wishlist"},{value:"borrowed",label:"Borrowed"},{value:"lab",label:"Lab"}],QK=["CCD","CMOS","PMT"],ZK=[8,12,14,16,24,48],JK=[{value:"color-negative",label:"Color Negative"},{value:"color-reversal",label:"Color Reversal (Slide)"},{value:"bw-negative",label:"B&W Negative"},{value:"bw-reversal",label:"B&W Reversal"},{value:"instant",label:"Instant"},{value:"cine",label:"Cinema (ECN-2)"},{value:"other",label:"Other"}],eX=[{value:"C-41",label:"C-41"},{value:"E-6",label:"E-6"},{value:"B&W",label:"B&W"},{value:"ECN-2",label:"ECN-2"},{value:"Cross",label:"Cross Process"},{value:"Other",label:"Other"}],tX={cameras:{singular:"Camera",icon:Ia},lenses:{singular:"Lens",icon:Ba},flashes:{singular:"Flash",icon:NK},"film-backs":{singular:"Film Back",icon:FK},scanners:{singular:"Scanner",icon:zK},films:{singular:"Film",icon:Da}};function nX({icon:e,children:t}){return(0,gt.jsxs)("div",{className:"flex items-center gap-2.5 mt-4 mb-2",children:[(0,gt.jsx)("div",{className:"w-6 h-6 rounded-md bg-primary/10 flex items-center justify-center",children:(0,gt.jsx)(e,{size:13,className:"text-primary"})}),(0,gt.jsx)("span",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:t}),(0,gt.jsx)("div",{className:"flex-1 h-px bg-divider/50 ml-1"})]})}function rX({children:e,isSelected:t,onValueChange:n}){return(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[(0,gt.jsx)("input",{type:"checkbox",checked:t,onChange:e=>null===n||void 0===n?void 0:n(e.target.checked),style:{width:"14px",height:"14px",accentColor:"var(--heroui-primary)",cursor:"pointer",flexShrink:0}}),(0,gt.jsx)("span",{style:{fontSize:"13px",color:"var(--heroui-default-700)",whiteSpace:"nowrap",userSelect:"none",cursor:"pointer"},onClick:()=>null===n||void 0===n?void 0:n(!t),children:e})]})}const iX={base:"bg-transparent",mainWrapper:"bg-transparent",inputWrapper:"h-10 min-h-10 bg-white/80 dark:bg-zinc-800/60 shadow-none border border-zinc-200/50 dark:border-zinc-700/50",innerWrapper:"bg-transparent",input:"text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-400 dark:placeholder:text-zinc-500"},aX={base:"bg-transparent",mainWrapper:"bg-transparent",inputWrapper:"h-10 min-h-10 bg-white/80 dark:bg-zinc-800/60 shadow-none border border-zinc-200/50 dark:border-zinc-700/50",innerWrapper:"bg-transparent",input:"text-zinc-900 dark:text-zinc-100 dark:[color-scheme:dark]"},oX={base:"bg-transparent",trigger:"h-10 min-h-10 bg-white/80 dark:bg-zinc-800/60 shadow-none border border-zinc-200/50 dark:border-zinc-700/50",value:"text-sm truncate pr-6 text-zinc-900 dark:text-zinc-100",selectorIcon:"right-2 text-zinc-500 dark:text-zinc-400",listbox:"bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",popoverContent:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100"},sX={classNames:{content:"min-w-[180px] bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-lg text-zinc-900 dark:text-zinc-100"}};function lX({label:e,children:t,span:n=1}){const r=n>1?{gridColumn:`span ${n}`}:{};return(0,gt.jsxs)("div",{style:r,children:[(0,gt.jsx)("label",{style:{display:"block",fontSize:"11px",fontWeight:500,color:"var(--heroui-default-600)",marginBottom:"6px"},children:e}),t]})}function cX({isOpen:e,onClose:t,type:n="cameras",initialData:i={},isNew:a=!1,onSave:o}){var s,l,c,u,d,h,p,f,m,g,v,A,y,b,x,_,w,S,T,C,M,E,P,N,k,R;const[L,O]=(0,r.useState)({}),[j,D]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&O(i||{})},[e,i]);const I=tX[n]||tX.cameras,B=I.icon,F=(e,t)=>{O(n=>({...n,[e]:t}))},z=async e=>{e&&"function"===typeof e.preventDefault&&e.preventDefault(),D(!0);try{await(null===o||void 0===o?void 0:o(L)),null===t||void 0===t||t()}catch(n){console.error("Save failed:",n),alert("Failed to save")}finally{D(!1)}};return(0,gt.jsx)(Od,{isOpen:e,onClose:t,size:"3xl",title:a?`Add New ${I.singular}`:`Edit ${I.singular}`,subtitle:"Fill in the details below",icon:(0,gt.jsx)(B,{className:"w-5 h-5"}),scrollBehavior:"inside",footer:(0,gt.jsxs)("div",{className:"flex gap-3 justify-end w-full",children:[(0,gt.jsx)(La.T,{variant:"flat",onPress:t,startContent:(0,gt.jsx)(ug,{className:"w-4 h-4"}),children:"Cancel"}),(0,gt.jsx)(La.T,{color:"primary",onPress:z,isLoading:j,startContent:!j&&(0,gt.jsx)(LK,{className:"w-4 h-4"}),children:a?"Create":"Save Changes"})]}),children:(0,gt.jsxs)("form",{onSubmit:z,className:"space-y-3",children:[(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,gt.jsx)(wK,{size:14,className:"text-primary"}),(0,gt.jsx)("span",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:"Basic Information"})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px"},children:[(0,gt.jsx)(lX,{label:"Name *",children:(0,gt.jsx)(Nf,{placeholder:"Display name",value:L.name||"",onValueChange:e=>F("name",e),isRequired:!0,variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"films"===n?"Manufacturer":"Brand",children:(0,gt.jsx)(Nf,{placeholder:"films"===n?"e.g. Kodak":"e.g. Nikon",value:L.brand||"",onValueChange:e=>F("brand",e),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Model",children:(0,gt.jsx)(Nf,{placeholder:"Model number",value:L.model||"",onValueChange:e=>F("model",e),variant:"bordered",size:"sm",classNames:iX})})]})]}),"cameras"===n&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(nX,{icon:Ia,children:"Camera Specifications"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Type",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.type?[L.type]:[],onSelectionChange:e=>F("type",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:UK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Film Format",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.format?[L.format]:[],onSelectionChange:e=>F("format",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:GK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Lens Mount",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.mount?[L.mount]:[],onSelectionChange:e=>F("mount",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:VK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Meter Type",children:(0,gt.jsx)(Sf,{placeholder:"None",selectedKeys:L.meter_type?[L.meter_type]:[],onSelectionChange:e=>F("meter_type",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:$K.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Shutter Max",children:(0,gt.jsx)(Nf,{placeholder:"e.g. 1/500",value:L.shutter_speed_max||"",onValueChange:e=>F("shutter_speed_max",e),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Shutter Min",children:(0,gt.jsx)(Nf,{placeholder:"e.g. 1s",value:L.shutter_speed_min||"",onValueChange:e=>F("shutter_speed_min",e),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Weight (g)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"grams",value:(null===(s=L.weight_g)||void 0===s?void 0:s.toString())||"",onValueChange:e=>F("weight_g",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Battery",children:(0,gt.jsx)(Nf,{placeholder:"e.g. LR44",value:L.battery_type||"",onValueChange:e=>F("battery_type",e),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Prod. Start Year",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 1985",value:(null===(l=L.production_year_start)||void 0===l?void 0:l.toString())||"",onValueChange:e=>F("production_year_start",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Prod. End Year",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 1995",value:(null===(c=L.production_year_end)||void 0===c?void 0:c.toString())||"",onValueChange:e=>F("production_year_end",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"32px",paddingTop:"12px",marginTop:"12px",borderTop:"1px solid var(--heroui-divider)"},children:[(0,gt.jsx)(rX,{isSelected:1===L.has_built_in_flash,onValueChange:e=>F("has_built_in_flash",e?1:0),children:"Built-in Flash"}),(0,gt.jsx)(rX,{isSelected:1===L.has_fixed_lens,onValueChange:e=>F("has_fixed_lens",e?1:0),children:"Fixed Lens"})]}),1===L.has_fixed_lens&&(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid var(--heroui-divider)"},children:[(0,gt.jsx)(lX,{label:"Focal Length (mm)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"35",value:(null===(u=L.fixed_lens_focal_length)||void 0===u?void 0:u.toString())||"",onValueChange:e=>F("fixed_lens_focal_length",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Max Aperture",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"2.8",step:"0.1",value:(null===(d=L.fixed_lens_max_aperture)||void 0===d?void 0:d.toString())||"",onValueChange:e=>F("fixed_lens_max_aperture",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})})]})]})]}),"lenses"===n&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(nX,{icon:Ba,children:"Lens Specifications"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Min Focal (mm)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"Wide/Prime",value:(null===(h=L.focal_length_min)||void 0===h?void 0:h.toString())||"",onValueChange:e=>F("focal_length_min",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Max Focal (mm)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"Tele (zoom)",value:(null===(p=L.focal_length_max)||void 0===p?void 0:p.toString())||"",onValueChange:e=>F("focal_length_max",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Mount",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.mount?[L.mount]:[],onSelectionChange:e=>F("mount",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:VK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Focus Type",children:(0,gt.jsx)(Sf,{selectedKeys:L.focus_type?[L.focus_type]:["manual"],onSelectionChange:e=>F("focus_type",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:KK.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Max Aperture",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 1.4",step:"0.1",value:(null===(f=L.max_aperture)||void 0===f?void 0:f.toString())||"",onValueChange:e=>F("max_aperture",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Max Aperture (Tele)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 5.6",step:"0.1",value:(null===(m=L.max_aperture_tele)||void 0===m?void 0:m.toString())||"",onValueChange:e=>F("max_aperture_tele",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Min Aperture",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 22",step:"0.1",value:(null===(g=L.min_aperture)||void 0===g?void 0:g.toString())||"",onValueChange:e=>F("min_aperture",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Filter Size (mm)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"52",value:(null===(v=L.filter_size)||void 0===v?void 0:v.toString())||"",onValueChange:e=>F("filter_size",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Aperture Blades",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 8",value:(null===(A=L.blade_count)||void 0===A?void 0:A.toString())||"",onValueChange:e=>F("blade_count",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Elements",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"\u955c\u7247\u6570",value:(null===(y=L.elements)||void 0===y?void 0:y.toString())||"",onValueChange:e=>F("elements",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Groups",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"\u955c\u7ec4\u6570",value:(null===(b=L.groups)||void 0===b?void 0:b.toString())||"",onValueChange:e=>F("groups",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Weight (g)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"grams",value:(null===(x=L.weight_g)||void 0===x?void 0:x.toString())||"",onValueChange:e=>F("weight_g",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Min Focus (m)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"0.45",step:"0.01",value:(null===(_=L.min_focus_distance)||void 0===_?void 0:_.toString())||"",onValueChange:e=>F("min_focus_distance",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Magnification",children:(0,gt.jsx)(Nf,{placeholder:"e.g. 1:1, 1:2",value:L.magnification_ratio||"",onValueChange:e=>F("magnification_ratio",e),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Prod. Start Year",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 1985",value:(null===(w=L.production_year_start)||void 0===w?void 0:w.toString())||"",onValueChange:e=>F("production_year_start",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Prod. End Year",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 1995",value:(null===(S=L.production_year_end)||void 0===S?void 0:S.toString())||"",onValueChange:e=>F("production_year_end",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"32px",paddingTop:"12px",marginTop:"12px",borderTop:"1px solid var(--heroui-divider)"},children:[(0,gt.jsx)(rX,{isSelected:1===L.is_macro,onValueChange:e=>F("is_macro",e?1:0),children:"Macro Lens"}),(0,gt.jsx)(rX,{isSelected:1===L.image_stabilization,onValueChange:e=>F("image_stabilization",e?1:0),children:"Image Stabilization"})]})]})]}),"flashes"===n&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(nX,{icon:NK,children:"Flash Specifications"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Guide Number",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 36",value:(null===(T=L.guide_number)||void 0===T?void 0:T.toString())||"",onValueChange:e=>F("guide_number",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Power Source",children:(0,gt.jsx)(Nf,{placeholder:"e.g. 4xAA",value:L.power_source||"",onValueChange:e=>F("power_source",e),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Recycle Time (s)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 3.5",step:"0.1",value:(null===(C=L.recycle_time)||void 0===C?void 0:C.toString())||"",onValueChange:e=>F("recycle_time",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"32px",paddingTop:"12px",marginTop:"12px",borderTop:"1px solid var(--heroui-divider)"},children:[(0,gt.jsx)(rX,{isSelected:1===L.ttl_compatible,onValueChange:e=>F("ttl_compatible",e?1:0),children:"TTL Compatible"}),(0,gt.jsx)(rX,{isSelected:1===L.has_auto_mode,onValueChange:e=>F("has_auto_mode",e?1:0),children:"Auto Mode"}),(0,gt.jsx)(rX,{isSelected:1===L.swivel_head,onValueChange:e=>F("swivel_head",e?1:0),children:"Swivel Head"}),(0,gt.jsx)(rX,{isSelected:1===L.bounce_head,onValueChange:e=>F("bounce_head",e?1:0),children:"Bounce Head"})]})]})]}),"film-backs"===n&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(nX,{icon:FK,children:"Film Back Specifications"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Format",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.format?[L.format]:[],onSelectionChange:e=>F("format",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:["120","220","4x5","Instant","Other"].map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Sub-Format",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.sub_format?[L.sub_format]:[],onSelectionChange:e=>F("sub_format",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:WK.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})}),(0,gt.jsx)(lX,{label:"Mount Type",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.mount_type?[L.mount_type]:[],onSelectionChange:e=>F("mount_type",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:HK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Magazine Type",children:(0,gt.jsx)(Nf,{placeholder:"e.g. A12, A24",value:L.magazine_type||"",onValueChange:e=>F("magazine_type",e),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Frames/Roll",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 12",value:(null===(M=L.frames_per_roll)||void 0===M?void 0:M.toString())||"",onValueChange:e=>F("frames_per_roll",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Frame Width (mm)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"56",step:"0.1",value:(null===(E=L.frame_width_mm)||void 0===E?void 0:E.toString())||"",onValueChange:e=>F("frame_width_mm",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Frame Height (mm)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"56",step:"0.1",value:(null===(P=L.frame_height_mm)||void 0===P?void 0:P.toString())||"",onValueChange:e=>F("frame_height_mm",e?parseFloat(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Compatible Cameras",children:(0,gt.jsx)(Nf,{placeholder:"e.g. 500C, 500CM",value:L.compatible_cameras||"",onValueChange:e=>F("compatible_cameras",e),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"32px",paddingTop:"12px",marginTop:"12px",borderTop:"1px solid var(--heroui-divider)"},children:[(0,gt.jsx)(rX,{isSelected:1===L.is_motorized,onValueChange:e=>F("is_motorized",e?1:0),children:"Motorized"}),(0,gt.jsx)(rX,{isSelected:0!==L.has_dark_slide,onValueChange:e=>F("has_dark_slide",e?1:0),children:"Has Dark Slide"})]})]})]}),"scanners"===n&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(nX,{icon:zK,children:"Scanner Specifications"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Type",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.type?[L.type]:[],onSelectionChange:e=>F("type",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:qK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Max Resolution (DPI)",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 4800",value:(null===(N=L.max_resolution)||void 0===N?void 0:N.toString())||"",onValueChange:e=>F("max_resolution",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Sensor Type",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.sensor_type?[L.sensor_type]:[],onSelectionChange:e=>F("sensor_type",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:QK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Bit Depth",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.bit_depth?[L.bit_depth.toString()]:[],onSelectionChange:e=>F("bit_depth",parseInt(Array.from(e)[0])),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:ZK.map(e=>(0,gt.jsxs)(Tf,{children:[e,"-bit"]},e.toString()))})})]}),(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Supported Formats",children:(0,gt.jsx)(Nf,{placeholder:"e.g. 35mm, 120, 4x5",value:L.supported_formats||"",onValueChange:e=>F("supported_formats",e),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Default Software",children:(0,gt.jsx)(Nf,{placeholder:"e.g. SilverFast, VueScan",value:L.default_software||"",onValueChange:e=>F("default_software",e),variant:"bordered",size:"sm",classNames:iX})})]}),(0,gt.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"32px",paddingTop:"12px",marginTop:"12px",borderTop:"1px solid var(--heroui-divider)"},children:(0,gt.jsx)(rX,{isSelected:1===L.has_infrared_cleaning,onValueChange:e=>F("has_infrared_cleaning",e?1:0),children:"Infrared Dust Removal (ICE/iSRD)"})})]})]}),"films"===n&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(nX,{icon:Da,children:"Film Specifications"}),(0,gt.jsx)(jd,{className:"p-4",children:(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px"},children:[(0,gt.jsx)(lX,{label:"ISO Speed",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"e.g. 400",value:(null===(k=L.iso)||void 0===k?void 0:k.toString())||"",onValueChange:e=>F("iso",e?parseInt(e):null),variant:"bordered",size:"sm",classNames:iX})}),(0,gt.jsx)(lX,{label:"Format",children:(0,gt.jsx)(Sf,{selectedKeys:L.format?[L.format]:["135"],onSelectionChange:e=>F("format",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:GK.map(e=>(0,gt.jsx)(Tf,{children:e},e))})}),(0,gt.jsx)(lX,{label:"Category",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.category?[L.category]:[],onSelectionChange:e=>F("category",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:JK.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})}),(0,gt.jsx)(lX,{label:"Process",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.process?[L.process]:[],onSelectionChange:e=>F("process",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:eX.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})})]})})]}),(0,gt.jsx)(nX,{icon:rp,children:"Ownership Details"}),(0,gt.jsxs)(jd,{className:"p-4",children:[(0,gt.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[(0,gt.jsx)(lX,{label:"Status",children:(0,gt.jsx)(Sf,{selectedKeys:L.status?[L.status]:["owned"],onSelectionChange:e=>F("status",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:YK.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})}),(0,gt.jsx)(lX,{label:"Condition",children:(0,gt.jsx)(Sf,{placeholder:"Select",selectedKeys:L.condition?[L.condition]:[],onSelectionChange:e=>F("condition",Array.from(e)[0]),variant:"bordered",size:"sm",classNames:oX,popoverProps:sX,children:XK.map(e=>(0,gt.jsx)(Tf,{children:e.label},e.value))})}),(0,gt.jsx)(lX,{label:"Purchase Date",children:(0,gt.jsx)(Nf,{type:"date",value:L.purchase_date||"",onValueChange:e=>F("purchase_date",e),variant:"bordered",size:"sm",classNames:aX})}),(0,gt.jsx)(lX,{label:"Purchase Price",children:(0,gt.jsx)(Nf,{type:"number",placeholder:"",step:"0.01",value:(null===(R=L.purchase_price)||void 0===R?void 0:R.toString())||"",onValueChange:e=>F("purchase_price",e?parseFloat(e):null),variant:"bordered",size:"sm",startContent:(0,gt.jsx)("span",{className:"text-zinc-400 dark:text-zinc-500 mr-1",children:"\xa5"}),classNames:iX})})]}),"films"!==n&&(0,gt.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"12px"},children:(0,gt.jsx)(lX,{label:"Serial Number",span:2,children:(0,gt.jsx)(Nf,{placeholder:"S/N",value:L.serial_number||"",onValueChange:e=>F("serial_number",e),variant:"bordered",size:"sm",classNames:iX})})}),(0,gt.jsxs)("div",{style:{marginTop:"12px",paddingBottom:"2px"},children:[(0,gt.jsx)("label",{style:{display:"block",fontSize:"11px",fontWeight:500,color:"var(--heroui-default-600)",marginBottom:"6px"},children:"Notes"}),(0,gt.jsx)("textarea",{placeholder:"Additional notes...",value:L.notes||"",onChange:e=>F("notes",e.target.value),rows:2,style:{width:"100%",padding:"8px 12px",fontSize:"14px",color:"var(--heroui-foreground)",backgroundColor:"var(--heroui-content1)",border:"1px solid var(--heroui-divider)",borderRadius:"8px",resize:"vertical",outline:"none",fontFamily:"inherit"}})]})]})]})})}const uX=[{key:"cameras",label:"Cameras",icon:Ia},{key:"lenses",label:"Lenses",icon:Ba},{key:"flashes",label:"Flashes",icon:NK},{key:"film-backs",label:"Film Backs",icon:FK},{key:"scanners",label:"Scanners",icon:zK},{key:"films",label:"Films",icon:Da}];function dX(){var e;const t=se(),[n,i]=(0,r.useState)("cameras"),[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[m,g]=(0,r.useState)(null),[v,A]=(0,r.useState)(""),[y,b]=(0,r.useState)([]),[x,_]=(0,r.useState)(!1),w=(0,r.useCallback)(async(e=!1)=>{l(!0);try{let t;switch(n){case"cameras":t=await(0,bn.RS)({},e);break;case"lenses":t=await(0,bn.Tu)({},e);break;case"flashes":t=await(0,bn.Lu)({},e);break;case"film-backs":t=await(0,bn.fO)({},e);break;case"scanners":t=await(0,bn.Qp)({},e);break;case"films":t=await(0,bn.ip)(e);break;default:t=[]}o(Array.isArray(t)?t:[])}catch(t){console.error(`Failed to load ${n}:`,t),o([])}finally{l(!1)}},[n]);(0,r.useEffect)(()=>{w(),u(null),h(null),A("")},[w]);const S=(0,r.useMemo)(()=>{if(!v.trim())return a;const e=v.toLowerCase();return a.filter(t=>{const n=(t.name||"").toLowerCase(),r=(t.brand||t.manufacturer||"").toLowerCase();return n.includes(e)||r.includes(e)})},[a,v]),T=a.find(e=>e.id===c);(0,r.useEffect)(()=>{if(!T||!T.id)return b([]),void _(!1);const e={cameras:"camera",lenses:"lens",flashes:"flash","film-backs":"film-back",scanners:"scanner",films:"film"}[n];if(!e)return void b([]);let t=!1;return _(!0),(0,bn.AZ)(e,T.id,12).then(e=>{if(t)return;const n=Array.isArray(e)?e:[];b(n)}).catch(e=>{t||(console.error("Failed to fetch related rolls:",e),b([]))}).finally(()=>{t||_(!1)}),()=>{t=!0}},[null===T||void 0===T?void 0:T.id,n]);return(0,gt.jsxs)("div",{className:"w-full h-full flex flex-col bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 animate-in fade-in duration-500 overflow-hidden",children:[(0,gt.jsxs)("div",{className:"flex-1 flex flex-col p-6 lg:p-8 min-h-0 w-full overflow-hidden",children:[(0,gt.jsxs)("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 border-b border-zinc-200 dark:border-zinc-700 pb-6 mb-6 flex-shrink-0",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Equipment Library"}),(0,gt.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:"Manage your cameras, lenses, flashes, and film formats"})]}),(0,gt.jsxs)(La.T,{color:"primary",onPress:()=>f(!0),startContent:(0,gt.jsx)(Ud,{className:"w-5 h-5"}),children:["Add ",(null===(e=uX.find(e=>e.key===n))||void 0===e?void 0:e.label.slice(0,-1))||"Item"]})]}),(0,gt.jsx)("div",{className:"flex p-1 bg-zinc-100 dark:bg-zinc-800 rounded-xl mb-6 flex-shrink-0",children:uX.map(e=>{const t=e.icon,r=n===e.key;return(0,gt.jsxs)("button",{onClick:()=>i(e.key),className:`\n                  flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap\n                  ${r?"bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 shadow-sm":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-50 dark:hover:bg-zinc-700/50"}\n                `,children:[(0,gt.jsx)(t,{className:"w-4 h-4"}),(0,gt.jsx)("span",{className:"hidden sm:inline",children:e.label})]},e.key)})}),(0,gt.jsxs)("div",{className:"flex gap-6 flex-1 min-h-0",children:[(0,gt.jsxs)("div",{className:"w-80 flex-shrink-0 bg-zinc-50 dark:bg-zinc-800 rounded-xl shadow-none flex flex-col overflow-hidden",style:{maxHeight:"calc(100vh - 260px)"},children:[(0,gt.jsx)("div",{className:"p-3 border-b border-zinc-200/50 dark:border-zinc-700/50 flex-shrink-0",children:(0,gt.jsx)(wv,{placeholder:`Search ${n}...`,value:v,onChange:A})}),(0,gt.jsx)("div",{className:"flex-1 p-2 space-y-1 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(255,255,255,0.2) transparent"},children:s?(0,gt.jsx)("div",{className:"py-12 flex justify-center",children:(0,gt.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):0===S.length?(0,gt.jsxs)("div",{className:"py-20 text-center text-zinc-400 dark:text-zinc-500",children:[(0,gt.jsx)(rp,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),(0,gt.jsx)("p",{children:v?"No matches found":"No items found"})]}):S.map(e=>(0,gt.jsxs)("div",{onClick:()=>{u(e.id),h(null)},className:`\n                      group p-3 rounded-lg cursor-pointer transition-all flex gap-3 border\n                      ${c===e.id?"bg-primary/10 border-primary/30 shadow-sm":"bg-transparent border-transparent hover:bg-zinc-100 dark:hover:bg-zinc-800"}\n                    `,children:[(0,gt.jsx)("div",{className:"w-16 h-16 rounded-lg bg-zinc-100 dark:bg-zinc-800 overflow-hidden flex-shrink-0 flex items-center justify-center relative",children:e.image_path||e.thumbPath?(0,gt.jsx)("img",{src:(0,bn.FH)(e.image_path||e.thumbPath),alt:e.name,className:"w-full h-full object-cover"}):(e=>{const t=null===(e=uX.find(e=>e.key===n))||void 0===e?void 0:e.icon;return t?(0,gt.jsx)(t,{className:"w-6 h-6 text-zinc-300 dark:text-zinc-600"}):null})()}),(0,gt.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[(0,gt.jsx)("h4",{className:"font-semibold text-sm truncate "+(c===e.id?"text-primary":"text-zinc-900 dark:text-zinc-100"),children:e.name||"Unnamed"}),(0,gt.jsx)("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate mt-0.5",children:e.brand||e.manufacturer||"Unknown Brand"}),(0,gt.jsx)("div",{className:"flex items-center gap-2 mt-2",children:e.status&&(0,gt.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded border uppercase tracking-wider font-semibold "+("owned"===e.status?"bg-green-500/10 text-green-600 border-green-500/20 dark:text-green-400":"wishlist"===e.status?"bg-amber-500/10 text-amber-600 border-amber-500/20 dark:text-amber-400":"bg-zinc-500/10 text-zinc-600 border-zinc-500/20 dark:text-zinc-400"),children:e.status})})]})]},e.id))}),(0,gt.jsx)("div",{className:"p-2 border-t border-zinc-200/50 dark:border-zinc-700/50 text-xs text-zinc-400 dark:text-zinc-500 text-center flex-shrink-0",children:v?`${S.length} of ${a.length}`:`${a.length} items`})]}),(0,gt.jsx)("div",{className:"flex-1 bg-zinc-50 dark:bg-zinc-800 rounded-xl shadow-none flex flex-col overflow-hidden",style:{maxHeight:"calc(100vh - 260px)"},children:T?(0,gt.jsxs)("div",{className:"p-6 lg:p-8 overflow-y-auto flex-1 animate-in fade-in slide-in-from-right-4 duration-300",children:[(0,gt.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8 mb-8",children:[(0,gt.jsxs)("div",{className:"w-32 h-32 rounded-2xl bg-zinc-100 dark:bg-zinc-800 overflow-hidden flex items-center justify-center shadow-lg relative group",children:[T.image_path||T.thumbPath?(0,gt.jsx)("img",{src:(0,bn.FH)(T.image_path||T.thumbPath),alt:T.name,className:"w-full h-full object-cover"}):(e=>{const t=null===(e=uX.find(e=>e.key===n))||void 0===e?void 0:e.icon;return t?(0,gt.jsx)(t,{className:"w-12 h-12 text-zinc-300 dark:text-zinc-600"}):null})(),(0,gt.jsxs)("label",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex flex-col items-center justify-center text-white cursor-pointer transition-opacity",children:[(0,gt.jsx)(Vu,{className:"w-6 h-6 mb-1"}),(0,gt.jsx)("span",{className:"text-xs font-medium",children:"Change"}),(0,gt.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>e.target.files[0]&&(async(e,t)=>{try{switch(n){case"cameras":await(0,bn.O0)(e,t);break;case"lenses":await(0,bn.BQ)(e,t);break;case"flashes":await(0,bn.h7)(e,t);break;case"film-backs":await(0,bn.sy)(e,t);break;case"scanners":await(0,bn.nC)(e,t);break;case"films":await(0,bn.F5)(e,t);break;default:return}await w(!0)}catch(r){console.error("Image upload failed:",r),alert("Image upload failed")}})(T.id,e.target.files[0])})]})]}),(0,gt.jsx)("div",{className:"flex-1 pt-2",children:(0,gt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:T.name}),(0,gt.jsx)("div",{className:"text-xl text-zinc-500 dark:text-zinc-400",children:T.brand||T.manufacturer})]}),(0,gt.jsxs)("div",{className:"flex gap-2",children:[(0,gt.jsx)("button",{onClick:()=>h(T),className:"p-2 text-zinc-500 dark:text-zinc-400 hover:text-primary hover:bg-primary/10 rounded-lg transition-colors",children:(0,gt.jsx)(Oa,{className:"w-5 h-5"})}),(0,gt.jsx)("button",{onClick:()=>g({id:T.id,name:T.name}),className:"p-2 text-zinc-500 dark:text-zinc-400 hover:text-danger hover:bg-danger/10 rounded-lg transition-colors",children:(0,gt.jsx)(gm,{className:"w-5 h-5"})})]})]})})]}),(0,gt.jsx)("div",{className:"mt-6",children:(0,gt.jsx)(pX,{item:T,type:n})}),("cameras"===n||"lenses"===n||"films"===n||"scanners"===n||"flashes"===n||"film-backs"===n)&&(0,gt.jsxs)("div",{className:"mt-8 pt-6 border-t border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,gt.jsxs)("h3",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100",children:["Related Rolls ",!x&&`(${(null===y||void 0===y?void 0:y.length)||0})`]})}),x?(0,gt.jsx)("div",{className:"text-center py-8 text-zinc-400 dark:text-zinc-500",children:(0,gt.jsx)("p",{className:"text-sm",children:"Loading related rolls..."})}):(null===y||void 0===y?void 0:y.length)>0?(0,gt.jsx)("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-1.5",children:y.map(e=>(0,gt.jsxs)("div",{onClick:()=>t(`/rolls/${e.id}`),className:"group cursor-pointer flex flex-col gap-1",children:[(0,gt.jsxs)("div",{className:"aspect-square rounded bg-zinc-100 dark:bg-zinc-800 overflow-hidden relative",children:[e.coverPath||e.cover_photo?(0,gt.jsx)("img",{src:BA((0,bn.FH)(e.coverPath||e.cover_photo),e.updated_at),alt:"",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):(0,gt.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,gt.jsx)(Du,{className:"w-4 h-4 text-zinc-300 dark:text-zinc-600"})}),(0,gt.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"})]}),(0,gt.jsx)("div",{className:"min-w-0 text-center",children:(0,gt.jsx)("div",{className:"text-[12px] font-medium text-zinc-700 dark:text-zinc-300 truncate group-hover:text-primary transition-colors",children:e.title||`Roll #${e.id}`})})]},e.id))}):(0,gt.jsx)("div",{className:"text-center py-8 text-zinc-400 dark:text-zinc-500",children:(0,gt.jsx)("p",{className:"text-sm",children:"No rolls found with this equipment"})})]})]}):(0,gt.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-zinc-400 dark:text-zinc-500 p-8",children:[(0,gt.jsx)("div",{className:"w-24 h-24 rounded-full bg-zinc-100/50 dark:bg-zinc-800/50 flex items-center justify-center mb-6",children:(e=>{const t=null===(e=uX.find(e=>e.key===n))||void 0===e?void 0:e.icon;return t?(0,gt.jsx)(t,{className:"w-10 h-10 text-zinc-300 dark:text-zinc-600"}):null})()}),(0,gt.jsx)("h3",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-2",children:"No Item Selected"}),(0,gt.jsx)("p",{className:"max-w-xs text-center",children:'Select an item from the list to view details or click "Add New" to create one.'})]})})]})]}),(0,gt.jsx)(cX,{isOpen:p,onClose:()=>f(!1),type:n,isNew:!0,onSave:async e=>{try{let t;switch(n){case"cameras":t=await(0,bn.Wt)(e);break;case"lenses":t=await(0,bn.zX)(e);break;case"flashes":t=await(0,bn.Ns)(e);break;case"film-backs":t=await(0,bn.n3)(e);break;case"scanners":t=await(0,bn.z1)(e);break;case"films":t=await(0,bn.Lw)(e);break;default:return}o(e=>[...e,t]),f(!1),u(t.id)}catch(t){console.error("Create failed:",t),alert("Failed to create item")}}}),(0,gt.jsx)(cX,{isOpen:!!d,onClose:()=>h(null),type:n,initialData:d||{},isNew:!1,onSave:async e=>{null!==d&&void 0!==d&&d.id&&await(async(e,t)=>{try{let r;switch(n){case"cameras":r=await(0,bn.$M)(e,t);break;case"lenses":r=await(0,bn.qm)(e,t);break;case"flashes":r=await(0,bn.wY)(e,t);break;case"film-backs":r=await(0,bn.Tf)(e,t);break;case"scanners":r=await(0,bn._3)(e,t);break;case"films":r=await(0,bn.uV)({id:e,...t});break;default:return}if(r&&r.id){const e=r.id;o(t=>t.map(t=>t.id===e?r:t))}h(null)}catch(r){console.error("Update failed:",r),alert("Failed to update item")}})(d.id,e)}}),m&&(0,gt.jsx)(ir.A,{isOpen:!0,title:"Delete Item",message:`Are you sure you want to delete "${m.name}"?`,type:"confirm",onConfirm:()=>(async e=>{try{switch(n){case"cameras":await(0,bn.jJ)(e);break;case"lenses":await(0,bn.Sz)(e);break;case"flashes":await(0,bn.Yv)(e);break;case"film-backs":await(0,bn.Dy)(e);break;case"scanners":await(0,bn.kz)(e);break;case"films":await(0,bn.iE)(e);break;default:return}o(t=>t.filter(t=>t.id!==e)),c===e&&u(null),g(null)}catch(t){console.error("Delete failed:",t),alert("Failed to delete item")}})(m.id),onCancel:()=>g(null)})]})}function hX({label:e,value:t,capitalize:n}){return t?(0,gt.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,gt.jsx)("span",{className:"text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide",children:e}),(0,gt.jsx)("span",{className:"text-sm text-zinc-900 dark:text-zinc-100 font-medium "+(n?"capitalize":""),children:t})]}):null}function pX({item:e,type:t}){const n=()=>e.production_year_start||e.production_year_end?e.production_year_start&&e.production_year_end?`${e.production_year_start} - ${e.production_year_end}`:e.production_year_start?`${e.production_year_start} -`:`- ${e.production_year_end}`:null,{specs:r,ownership:i}=(()=>{const r=[{label:"films"===t?"Manufacturer":"Brand",value:e.brand||e.manufacturer},{label:"Model",value:e.model}],i={cameras:[{label:"Type",value:e.type},{label:"Format",value:e.format},{label:"Lens Mount",value:e.mount},{label:"Meter",value:e.meter_type},{label:"Shutter Range",value:e.shutter_speed_max||e.shutter_speed_min?`${e.shutter_speed_max||""} - ${e.shutter_speed_min||""}`:null},{label:"Weight",value:e.weight_g?`${e.weight_g}g`:null},{label:"Battery",value:e.battery_type},{label:"Production",value:n()},{label:"Built-in Flash",value:e.has_built_in_flash?"Yes"+(e.flash_gn?` (GN ${e.flash_gn})`:""):null},...e.has_fixed_lens?[{label:"Fixed Lens",value:"Yes"},{label:"Focal Length",value:e.fixed_lens_focal_length?`${e.fixed_lens_focal_length}mm`:null},{label:"Max Aperture",value:e.fixed_lens_max_aperture?`f/${e.fixed_lens_max_aperture}`:null}]:[]],lenses:[{label:"Mount",value:e.mount},{label:"Focal Range",value:e.focal_length_min?`${e.focal_length_min}${e.focal_length_max?"-"+e.focal_length_max:""}mm`:null},{label:"Max Aperture",value:e.max_aperture?`f/${e.max_aperture}${e.max_aperture_tele?` - f/${e.max_aperture_tele}`:""}`:null},{label:"Min Aperture",value:e.min_aperture?`f/${e.min_aperture}`:null},{label:"Focus Type",value:e.focus_type,capitalize:!0},{label:"Optical Design",value:e.elements||e.groups?`${e.elements||"?"}\u7247${e.groups||"?"}\u7ec4`:null},{label:"Filter Size",value:e.filter_size?`${e.filter_size}mm`:null},{label:"Aperture Blades",value:e.blade_count},{label:"Min Focus",value:e.min_focus_distance?`${e.min_focus_distance}m`:null},{label:"Magnification",value:e.magnification_ratio},{label:"Weight",value:e.weight_g?`${e.weight_g}g`:null},{label:"Production",value:n()},{label:"Macro",value:e.is_macro?"Yes":null},{label:"Stabilization",value:e.image_stabilization?"Yes":null}],films:[{label:"ISO",value:e.iso},{label:"Format",value:e.format},{label:"Category",value:e.category},{label:"Process",value:e.process}],"film-backs":[{label:"Format",value:e.format},{label:"Frame Size",value:e.sub_format},{label:"Frame Dimensions",value:e.frame_width_mm||e.frame_height_mm?`${e.frame_width_mm||"?"} \xd7 ${e.frame_height_mm||"?"}mm`:null},{label:"Mount",value:e.mount_type},{label:"Magazine Type",value:e.magazine_type},{label:"Frames/Roll",value:e.frames_per_roll},{label:"Compatible Cameras",value:e.compatible_cameras},{label:"Motorized",value:e.is_motorized?"Yes":null},{label:"Dark Slide",value:0!==e.has_dark_slide?"Yes":"No"}],scanners:[{label:"Type",value:e.type},{label:"Max Resolution",value:e.max_resolution?`${e.max_resolution} DPI`:null},{label:"Sensor",value:e.sensor_type},{label:"Bit Depth",value:e.bit_depth?`${e.bit_depth}-bit`:null},{label:"Formats",value:e.supported_formats},{label:"Software",value:e.default_software},{label:"IR Cleaning",value:e.has_infrared_cleaning?"Yes":null}],flashes:[{label:"Guide Number",value:e.guide_number},{label:"Power Source",value:e.power_source},{label:"Recycle Time",value:e.recycle_time?`${e.recycle_time}s`:null},{label:"TTL",value:e.ttl_compatible?"Yes":"No"},{label:"Auto Mode",value:e.has_auto_mode?"Yes":null},{label:"Swivel Head",value:e.swivel_head?"Yes":null},{label:"Bounce Head",value:e.bounce_head?"Yes":null}]},a=[{label:"Status",value:e.status,capitalize:!0},{label:"Condition",value:e.condition},{label:"Serial Number",value:e.serial_number},{label:"Acquired",value:e.purchase_date},{label:"Price",value:e.purchase_price?`\xa5${e.purchase_price}`:null}];return{specs:[...r,...i[t]||[]].filter(e=>null!==e.value&&void 0!==e.value&&""!==e.value),ownership:a.filter(e=>null!==e.value&&void 0!==e.value&&""!==e.value)}})();return(0,gt.jsxs)("div",{className:"space-y-8",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsxs)("h4",{className:"text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[(0,gt.jsx)("span",{className:"w-1 h-4 bg-primary/60 rounded-full"}),"Specifications"]}),(0,gt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-8 gap-y-5",children:r.map((e,t)=>(0,gt.jsx)(hX,{...e},t))})]}),i.length>0&&(0,gt.jsxs)("div",{className:"pt-6 border-t border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsxs)("h4",{className:"text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[(0,gt.jsx)("span",{className:"w-1 h-4 bg-primary/60 rounded-full"}),"Ownership"]}),(0,gt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-x-8 gap-y-5",children:i.map((e,t)=>(0,gt.jsx)(hX,{...e},t))})]}),e.notes&&(0,gt.jsxs)("div",{className:"pt-6 border-t border-zinc-200 dark:border-zinc-700",children:[(0,gt.jsxs)("h4",{className:"text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[(0,gt.jsx)("span",{className:"w-1 h-4 bg-primary/60 rounded-full"}),"Notes"]}),(0,gt.jsx)("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap leading-relaxed bg-zinc-50/50 dark:bg-zinc-800/50 p-4 rounded-xl border border-zinc-200 dark:border-zinc-700",children:e.notes})]})]})}const fX=$n("file-type",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M11 18h2",key:"12mj7e"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"M9 13v-.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v.5",key:"qbrxap"}]]);function mX(e){if(!e)return"";return new Date(e).toLocaleDateString()}function gX(e){const t=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),n=t%360,r=2*t%360;return`linear-gradient(135deg, hsl(${n}, 40%, 20%) 0%, hsl(${(n+r)/2}, 50%, 40%) 50%, hsl(${r}, 40%, 60%) 100%)`}function vX(){const[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)(!0),[a,o]=(0,r.useState)(!1),s=(0,r.useRef)(null),l=async()=>{i(!0);try{const e=await(0,bn.Po)(),n=Array.isArray(e)?e:e.luts||[];t(n)}catch(e){console.error("Failed to load LUTs:",e)}finally{i(!1)}};(0,r.useEffect)(()=>{l()},[]);return(0,gt.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500",children:[(0,gt.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"LUT Library"}),(0,gt.jsx)("p",{className:"text-default-500 text-sm mt-1",children:"Manage 3D LUT files (.cube, .3dl, .csp) for film simulation."})]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("input",{type:"file",ref:s,onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;o(!0);let n=0,r=0;for(const a of Array.from(t)){const e=a.name.toLowerCase().split(".").pop();if(["cube","3dl","csp","lut"].includes(e))try{await(0,bn.Xd)(a),n++}catch(i){console.error("Upload error:",a.name,i),r++}else r++}r>0&&alert(`Upload complete: ${n} success, ${r} failed`),await l(),o(!1),s.current&&(s.current.value="")},accept:".cube,.3dl,.csp,.lut",multiple:!0,className:"hidden"}),(0,gt.jsx)(La.T,{onPress:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.click()},isDisabled:a,isLoading:a,color:"primary",startContent:!a&&(0,gt.jsx)(Vu,{className:"w-4 h-4"}),children:"Upload LUTs"})]})]}),n?(0,gt.jsx)("div",{className:"flex justify-center py-20",children:(0,gt.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):0===e.length?(0,gt.jsx)(Nm,{className:"bg-white dark:bg-zinc-800",children:(0,gt.jsxs)(Rm,{className:"text-center py-24",children:[(0,gt.jsx)("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,gt.jsx)(fX,{className:"w-8 h-8 text-default-400"})}),(0,gt.jsx)("h3",{className:"text-lg font-medium",children:"No LUTs found"}),(0,gt.jsx)("p",{className:"text-default-500 mt-2 max-w-sm mx-auto",children:"Upload .cube, .3dl, or .csp files to add film simulation presets."})]})}):(0,gt.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:e.map(e=>{return(0,gt.jsxs)("div",{className:"group relative overflow-hidden rounded-xl cursor-pointer",style:{paddingBottom:"100%"},children:[(0,gt.jsx)("div",{className:"absolute inset-0",style:{background:gX(e.name)}}),(0,gt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),(0,gt.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:(0,gt.jsx)(La.T,{isIconOnly:!0,size:"sm",onPress:()=>(async e=>{const n=e.startsWith("FilmGallery_")?`"${e}" is a built-in LUT. Are you sure you want to delete it?`:`Are you sure you want to delete "${e}"?`;if(window.confirm(n))try{!1!==await(0,bn.RT)(e)?t(t=>t.filter(t=>t.name!==e)):alert("Delete failed")}catch(r){console.error("Delete error:",r),l()}})(e.name),className:"bg-black/50 text-white hover:bg-red-500 backdrop-blur-sm",title:"Delete LUT",children:(0,gt.jsx)(gm,{className:"w-3.5 h-3.5"})})}),e.name.startsWith("FilmGallery_")&&(0,gt.jsx)(el,{size:"sm",variant:"flat",className:"absolute top-2 left-2 bg-black/40 backdrop-blur-md text-white border border-white/10 z-10",children:"BUILT-IN"}),(0,gt.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-3 z-10",children:[(0,gt.jsx)("h4",{className:"font-medium text-sm text-white truncate mb-1",title:e.name,children:e.name}),(0,gt.jsxs)("div",{className:"flex items-center gap-2 text-xs text-white/70",children:[(0,gt.jsx)("span",{className:"uppercase font-semibold tracking-wider",children:e.type||e.name.split(".").pop()}),(0,gt.jsx)("span",{children:"\xb7"}),(0,gt.jsx)("span",{children:(n=e.size,void 0===n||null===n?"":n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":(n/1048576).toFixed(1)+" MB")})]}),e.modifiedAt&&(0,gt.jsxs)("span",{className:"text-[10px] text-white/50 block mt-1",children:["Updated ",mX(e.modifiedAt)]})]})]},e.name);var n})})]})}function AX(e,t){return Object.freeze({...e,...t})}const yX=(0,r.createContext)(null),bX=yX.Provider;function xX(){const e=(0,r.useContext)(yX);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function _X(){return xX().map}var wX=n(228),SX=n.n(wX);function TX(){return TX=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TX.apply(this,arguments)}function CX({bounds:e,boundsOptions:t,center:n,children:i,className:a,id:o,placeholder:s,style:l,whenReady:c,zoom:u,...d},h){const[p]=(0,r.useState)({className:a,id:o,style:l}),[f,m]=(0,r.useState)(null);(0,r.useImperativeHandle)(h,()=>f?.map??null,[f]);const g=(0,r.useCallback)(r=>{if(null!==r&&null===f){const i=new wX.Map(r,d);null!=n&&null!=u?i.setView(n,u):null!=e&&i.fitBounds(e,t),null!=c&&i.whenReady(c),m(function(e){return Object.freeze({__version:1,map:e})}(i))}},[]);(0,r.useEffect)(()=>()=>{f?.map.remove()},[f]);const v=f?r.createElement(bX,{value:f},i):s??null;return r.createElement("div",TX({},p,{ref:g}),v)}const MX=(0,r.forwardRef)(CX);function EX(e){function t(t,n){const{instance:i,context:a}=e(t).current;return(0,r.useImperativeHandle)(n,()=>i),null==t.children?null:r.createElement(bX,{value:a},t.children)}return(0,r.forwardRef)(t)}function PX(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function NX(e,t){return null==t?function(t,n){const i=(0,r.useRef)();return i.current||(i.current=e(t,n)),i}:function(n,i){const a=(0,r.useRef)();a.current||(a.current=e(n,i));const o=(0,r.useRef)(n),{instance:s}=a.current;return(0,r.useEffect)(function(){o.current!==n&&(t(s,n,o.current),o.current=n)},[s,n,i]),a}}function kX(e,t){const n=(0,r.useRef)();(0,r.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function RX(e,t){const n=e.pane??t.pane;return n?{...e,pane:n}:e}function LX(e,t){(0,r.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function OX(e){return function(t){const n=xX(),i=e(RX(t,n),n);return function(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}(n.map,t.attribution),kX(i.current,t.eventHandlers),LX(i.current,n),i}}function jX(e){return function(t){const n=xX(),i=e(RX(t,n),n);return kX(i.current,t.eventHandlers),LX(i.current,n),function(e,t){const n=(0,r.useRef)();(0,r.useEffect)(function(){if(t.pathOptions!==n.current){const r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(i.current,t),i}}const DX=(IX=function({url:e,...t},n){return PX(new wX.TileLayer(e,RX(t,n)),n)},BX=function(e,t,n){!function(e,t,n){const{opacity:r,zIndex:i}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=i&&i!==n.zIndex&&e.setZIndex(i)}(e,t,n);const{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)},function(e){function t(t,n){const{instance:i}=e(t).current;return(0,r.useImperativeHandle)(n,()=>i),null}return(0,r.forwardRef)(t)}(OX(NX(IX,BX))));var IX,BX;n(4260);function FX(e){let t={},n={};const{children:r,...i}=e;return Object.entries(i).forEach(([e,r])=>{e.startsWith("on")?n={...n,[e]:r}:t={...t,[e]:r}}),{clusterProps:t,clusterEvents:n}}var zX=function(e,t){return EX(jX(NX(e,t)))}(function(e,t){const{clusterProps:n,clusterEvents:r}=FX(e),i=new wX.MarkerClusterGroup(n);return Object.entries(r).forEach(([e,t])=>{const n=`cluster${e.substring(2).toLowerCase()}`;i.on(n,t)}),PX(i,AX(t,{layerContainer:i}))},(e,t,n)=>{const{clusterProps:r,clusterEvents:i}=FX(t),{clusterProps:a,clusterEvents:o}=FX(n);Object.keys(r).forEach(t=>{r[t]!==a[t]&&(e.options[t]=r[t])}),Object.entries(o).forEach(([t,n])=>{const r=`cluster${t.substring(2).toLowerCase()}`;e.off(r,n)}),Object.entries(i).forEach(([t,n])=>{const r=`cluster${t.substring(2).toLowerCase()}`;e.on(r,n)})}),UX=zX;const VX=function(e,t){return EX(OX(NX(e,t)))}(function({position:e,...t},n){const r=new wX.Marker(e,t);return PX(r,AX(n,{overlayContainer:r}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),GX=(e,t)=>{const n=(e=>{const t=bn.tE,n=e.positive_thumb_rel_path||e.thumb_rel_path||e.negative_thumb_rel_path;if(n)return`${t}/uploads/${n}`;const r=e.full_rel_path||e.positive_rel_path||e.negative_rel_path;return r?`${t}/uploads/${r}`:null})(e),r=t?56:48,i=t?"#f59e0b":"#ffffff",a=t?3:2,o=n?`<div class="photo-marker ${t?"selected":""}" style="\n        width: ${r}px;\n        height: ${r}px;\n        border: ${a}px solid ${i};\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        transition: all 0.15s ease-out;\n        background-image: url('${n}');\n        background-size: cover;\n        background-position: center center;\n        background-repeat: no-repeat;\n      "></div>`:`<div class="photo-marker photo-marker-placeholder ${t?"selected":""}" style="\n        width: ${r}px;\n        height: ${r}px;\n        border: ${a}px solid ${i};\n        transition: all 0.15s ease-out;\n      ">\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n          <circle cx="8.5" cy="8.5" r="1.5"/>\n          <polyline points="21,15 16,10 5,21"/>\n        </svg>\n      </div>`;return SX().divIcon({html:o,className:"photo-marker-container",iconSize:[r,r],iconAnchor:[r/2,r/2],popupAnchor:[0,-r/2]})};function qX({photo:e,onClick:t,isSelected:n}){const i=(0,r.useMemo)(()=>GX(e,n),[e,n]),a=[e.latitude,e.longitude];return(0,gt.jsx)(VX,{position:a,icon:i,photo:e,eventHandlers:{click:n=>{if(t){const r=n.containerPoint;t(e,{x:r.x,y:r.y})}}}})}function WX({photo:e,position:t,onClose:n}){var r,i;if(!e)return null;const a=(e=>{const t=bn.tE,n=e.positive_thumb_rel_path||e.thumb_rel_path||e.positive_rel_path||e.full_rel_path||e.negative_rel_path;return n?`${t}/uploads/${n}`:null})(e),o=(e=>{if(!e)return null;try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return e}})(e.date_taken||e.taken_at),s=[e.detail_location,e.city,e.country].filter(Boolean).join(", ");return(0,gt.jsxs)("div",{className:"map-photo-preview",style:{left:Math.min((null===t||void 0===t?void 0:t.x)||100,window.innerWidth-280),top:Math.min((null===t||void 0===t?void 0:t.y)||100,window.innerHeight-320)},children:[(0,gt.jsx)("button",{className:"map-preview-close",onClick:n,"aria-label":"Close preview",children:(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,gt.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),(0,gt.jsx)("div",{className:"map-preview-image",children:a?(0,gt.jsx)("img",{src:a,alt:"",loading:"eager"}):(0,gt.jsx)("div",{className:"map-preview-placeholder",children:(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,gt.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,gt.jsx)("polyline",{points:"21,15 16,10 5,21"})]})})}),(0,gt.jsxs)("div",{className:"map-preview-meta",children:[o&&(0,gt.jsxs)("div",{className:"map-preview-date",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,gt.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,gt.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,gt.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),(0,gt.jsx)("span",{children:o})]}),s&&(0,gt.jsxs)("div",{className:"map-preview-location",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,gt.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),(0,gt.jsx)("span",{children:s})]}),(e.camera||e.lens)&&(0,gt.jsxs)("div",{className:"map-preview-gear",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),(0,gt.jsx)("circle",{cx:"12",cy:"13",r:"4"})]}),(0,gt.jsx)("span",{children:[e.camera,e.lens].filter(Boolean).join(" \u2022 ")})]}),(0,gt.jsxs)("div",{className:"map-preview-coords",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,gt.jsx)("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),(0,gt.jsx)("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),(0,gt.jsxs)("span",{children:[null===(r=e.latitude)||void 0===r?void 0:r.toFixed(4),", ",null===(i=e.longitude)||void 0===i?void 0:i.toFixed(4)]})]})]}),e.roll_id&&(0,gt.jsxs)(lt,{to:`/rolls/${e.roll_id}`,className:"map-preview-link",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),(0,gt.jsx)("polyline",{points:"15 3 21 3 21 9"}),(0,gt.jsx)("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]}),"View in Roll"]})]})}function HX(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||XX(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function KX(e){return function(e){if(Array.isArray(e))return YX(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||XX(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XX(e,t){if(e){if("string"===typeof e)return YX(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?YX(e,t):void 0}}function YX(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function QX(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ZX(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||eY(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function JX(e){return function(e){if(Array.isArray(e))return QX(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||eY(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eY(e,t){if(e){if("string"==typeof e)return QX(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?QX(e,t):void 0}}function tY(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.useEffect,n=(0,r.useRef)(),i=(0,r.useRef)(!1),a=(0,r.useRef)(!1),o=ZX((0,r.useState)(0),2);o[0];var s=o[1];i.current&&(a.current=!0),t(function(){return i.current||(n.current=e(),i.current=!0),s(function(e){return e+1}),function(){a.current&&n.current&&n.current()}},[])}const nY="182",rY=0,iY=1,aY=2,oY=0,sY=1,lY=2,cY=3,uY=1,dY=3,hY=0,pY=1,fY=2,mY=100,gY=101,vY=102,AY=200,yY=201,bY=202,xY=203,_Y=204,wY=205,SY=206,TY=207,CY=208,MY=209,EY=210,PY=211,NY=212,kY=213,RY=214,LY=0,OY=1,jY=2,DY=3,IY=4,BY=5,FY=6,zY=7,UY=0,VY=1,GY=2,qY=1,WY=2,HY=3,$Y=4,KY=5,XY=6,YY=7,QY=300,ZY=301,JY=302,eQ=303,tQ=304,nQ=306,rQ=1e3,iQ=1001,aQ=1002,oQ=1003,sQ=1004,lQ=1005,cQ=1006,uQ=1007,dQ=1008,hQ=1009,pQ=1010,fQ=1011,mQ=1012,gQ=1013,vQ=1014,AQ=1015,yQ=1016,bQ=1017,xQ=1018,_Q=1020,wQ=35902,SQ=35899,TQ=1021,CQ=1022,MQ=1023,EQ=1026,PQ=1027,NQ=1028,kQ=1029,RQ=1030,LQ=1031,OQ=1033,jQ=33776,DQ=33777,IQ=33778,BQ=33779,FQ=35840,zQ=35841,UQ=35842,VQ=35843,GQ=36196,qQ=37492,WQ=37496,HQ=37488,$Q=37489,KQ=37490,XQ=37491,YQ=37808,QQ=37809,ZQ=37810,JQ=37811,eZ=37812,tZ=37813,nZ=37814,rZ=37815,iZ=37816,aZ=37817,oZ=37818,sZ=37819,lZ=37820,cZ=37821,uZ=36492,dZ=36494,hZ=36495,pZ=36283,fZ=36284,mZ=36285,gZ=36286,vZ=2300,AZ=2301,yZ=2302,bZ=2400,xZ=2401,_Z=2402,wZ=0,SZ=1,TZ=2,CZ="",MZ="srgb",EZ="srgb-linear",PZ="linear",NZ="srgb",kZ=7680,RZ=512,LZ=513,OZ=514,jZ=515,DZ=516,IZ=517,BZ=518,FZ=519,zZ=35044,UZ=35048,VZ="300 es",GZ=2e3,qZ=2001,WZ="compute",HZ="render";function $Z(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function KZ(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function XZ(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function YZ(){const e=XZ("canvas");return e.style.display="block",e}const QZ={};let ZZ=null;function JZ(...e){const t="THREE."+e.shift();ZZ?ZZ("log",t,...e):console.log(t,...e)}function eJ(...e){const t="THREE."+e.shift();ZZ?ZZ("warn",t,...e):console.warn(t,...e)}function tJ(...e){const t="THREE."+e.shift();ZZ?ZZ("error",t,...e):console.error(t,...e)}function nJ(...e){const t=e.join(" ");t in QZ||(QZ[t]=!0,eJ(...e))}class rJ{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const r=n[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);e.target=null}}}const iJ=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let aJ=1234567;const oJ=Math.PI/180,sJ=180/Math.PI;function lJ(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(iJ[255&e]+iJ[e>>8&255]+iJ[e>>16&255]+iJ[e>>24&255]+"-"+iJ[255&t]+iJ[t>>8&255]+"-"+iJ[t>>16&15|64]+iJ[t>>24&255]+"-"+iJ[63&n|128]+iJ[n>>8&255]+"-"+iJ[n>>16&255]+iJ[n>>24&255]+iJ[255&r]+iJ[r>>8&255]+iJ[r>>16&255]+iJ[r>>24&255]).toLowerCase()}function cJ(e,t,n){return Math.max(t,Math.min(n,e))}function uJ(e,t){return(e%t+t)%t}function dJ(e,t,n){return(1-n)*e+n*t}function hJ(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function pJ(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const fJ={DEG2RAD:oJ,RAD2DEG:sJ,generateUUID:lJ,clamp:cJ,euclideanModulo:uJ,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:dJ,damp:function(e,t,n,r){return dJ(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(uJ(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(aJ=e);let t=aJ+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*oJ},radToDeg:function(e){return e*sJ},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),c=a((t+r)/2),u=o((t+r)/2),d=a((t-r)/2),h=o((t-r)/2),p=a((r-t)/2),f=o((r-t)/2);switch(i){case"XYX":e.set(s*u,l*d,l*h,s*c);break;case"YZY":e.set(l*h,s*u,l*d,s*c);break;case"ZXZ":e.set(l*d,l*h,s*u,s*c);break;case"XZX":e.set(s*u,l*f,l*p,s*c);break;case"YXY":e.set(l*p,s*u,l*f,s*c);break;case"ZYZ":e.set(l*f,l*p,s*u,s*c);break;default:eJ("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:pJ,denormalize:hJ};class mJ{constructor(e=0,t=0){mJ.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=cJ(this.x,e.x,t.x),this.y=cJ(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=cJ(this.x,e,t),this.y=cJ(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(cJ(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(cJ(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class gJ{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],d=i[a+0],h=i[a+1],p=i[a+2],f=i[a+3];if(o<=0)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(o>=1)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(u!==f||s!==d||l!==h||c!==p){let e=s*d+l*h+c*p+u*f;e<0&&(d=-d,h=-h,p=-p,f=-f,e=-e);let t=1-o;if(e<.9995){const n=Math.acos(e),r=Math.sin(n);t=Math.sin(t*n)/r,s=s*t+d*(o=Math.sin(o*n)/r),l=l*t+h*o,c=c*t+p*o,u=u*t+f*o}else{s=s*t+d*o,l=l*t+h*o,c=c*t+p*o,u=u*t+f*o;const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const o=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[a],d=i[a+1],h=i[a+2],p=i[a+3];return e[t]=o*p+c*u+s*h-l*d,e[t+1]=s*p+c*d+l*u-o*h,e[t+2]=l*p+c*h+o*d-s*u,e[t+3]=c*p-o*u-s*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),d=s(n/2),h=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:eJ("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+o+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(cJ(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+r*l-i*s,this._y=r*c+a*s+i*o-n*l,this._z=i*c+a*l+n*s-r*o,this._w=a*c-n*o-r*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,r=e._y,i=e._z,a=e._w,o=this.dot(e);o<0&&(n=-n,r=-r,i=-i,a=-a,o=-o);let s=1-t;if(o<.9995){const e=Math.acos(o),l=Math.sin(e);s=Math.sin(s*e)/l,t=Math.sin(t*e)/l,this._x=this._x*s+n*t,this._y=this._y*s+r*t,this._z=this._z*s+i*t,this._w=this._w*s+a*t,this._onChangeCallback()}else this._x=this._x*s+n*t,this._y=this._y*s+r*t,this._z=this._z*s+i*t,this._w=this._w*s+a*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class vJ{constructor(e=0,t=0,n=0){vJ.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yJ.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yJ.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=2*(a*r-o*n),c=2*(o*t-i*r),u=2*(i*n-a*t);return this.x=t+s*l+a*u-o*c,this.y=n+s*c+o*l-i*u,this.z=r+s*u+i*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=cJ(this.x,e.x,t.x),this.y=cJ(this.y,e.y,t.y),this.z=cJ(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=cJ(this.x,e,t),this.y=cJ(this.y,e,t),this.z=cJ(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(cJ(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return AJ.copy(this).projectOnVector(e),this.sub(AJ)}reflect(e){return this.sub(AJ.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(cJ(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const AJ=new vJ,yJ=new gJ;class bJ{constructor(e,t,n,r,i,a,o,s,l){bJ.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,l)}set(e,t,n,r,i,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],A=r[4],y=r[7],b=r[2],x=r[5],_=r[8];return i[0]=a*f+o*v+s*b,i[3]=a*m+o*A+s*x,i[6]=a*g+o*y+s*_,i[1]=l*f+c*v+u*b,i[4]=l*m+c*A+u*x,i[7]=l*g+c*y+u*_,i[2]=d*f+h*v+p*b,i[5]=d*m+h*A+p*x,i[8]=d*g+h*y+p*_,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,d=o*s-c*i,h=l*i-a*s,p=t*u+n*d+r*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(o*n-r*a)*f,e[3]=d*f,e[4]=(c*t-r*s)*f,e[5]=(r*i-o*t)*f,e[6]=h*f,e[7]=(n*s-l*t)*f,e[8]=(a*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){const s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(xJ.makeScale(e,t)),this}rotate(e){return this.premultiply(xJ.makeRotation(-e)),this}translate(e,t){return this.premultiply(xJ.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const xJ=new bJ,_J=(new bJ).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),wJ=(new bJ).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function SJ(){const e={enabled:!0,workingColorSpace:EZ,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===NZ&&(e.r=CJ(e.r),e.g=CJ(e.g),e.b=CJ(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===NZ&&(e.r=MJ(e.r),e.g=MJ(e.g),e.b=MJ(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===CZ?PZ:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return nJ("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return nJ("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[EZ]:{primaries:t,whitePoint:r,transfer:PZ,toXYZ:_J,fromXYZ:wJ,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:MZ},outputColorSpaceConfig:{drawingBufferColorSpace:MZ}},[MZ]:{primaries:t,whitePoint:r,transfer:NZ,toXYZ:_J,fromXYZ:wJ,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:MZ}}}),e}const TJ=SJ();function CJ(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function MJ(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let EJ;class PJ{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===EJ&&(EJ=XZ("canvas")),EJ.width=e.width,EJ.height=e.height;const t=EJ.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=EJ}return n.toDataURL(t)}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=XZ("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*CJ(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*CJ(t[e]/255)):t[e]=CJ(t[e]);return{data:t,width:e.width,height:e.height}}return eJ("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let NJ=0;class kJ{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:NJ++}),this.uuid=lJ(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return"undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):"undefined"!==typeof VideoFrame&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(RJ(r[t].image)):e.push(RJ(r[t]))}else e=RJ(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function RJ(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?PJ.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(eJ("Texture: Unable to serialize Texture."),{})}let LJ=0;const OJ=new vJ;class jJ extends rJ{constructor(e=jJ.DEFAULT_IMAGE,t=jJ.DEFAULT_MAPPING,n=1001,r=1001,i=1006,a=1008,o=1023,s=hQ,l=jJ.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:LJ++}),this.uuid=lJ(),this.name="",this.source=new kJ(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new mJ(0,0),this.repeat=new mJ(1,1),this.center=new mJ(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bJ,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(OJ).x}get height(){return this.source.getSize(OJ).y}get depth(){return this.source.getSize(OJ).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n){eJ(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n:eJ(`Texture.setValues(): property '${t}' does not exist.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==QY)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case rQ:e.x=e.x-Math.floor(e.x);break;case iQ:e.x=e.x<0?0:1;break;case aQ:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case rQ:e.y=e.y-Math.floor(e.y);break;case iQ:e.y=e.y<0?0:1;break;case aQ:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}jJ.DEFAULT_IMAGE=null,jJ.DEFAULT_MAPPING=QY,jJ.DEFAULT_ANISOTROPY=1;class DJ{constructor(e=0,t=0,n=0,r=1){DJ.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],d=s[1],h=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-d)<a&&Math.abs(u-f)<a&&Math.abs(p-m)<a){if(Math.abs(c+d)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+h+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(h+1)/2,v=(g+1)/2,A=(c+d)/4,y=(u+f)/4,b=(p+m)/4;return e>s&&e>v?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=A/n,i=y/n):s>v?s<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=A/r,i=b/r):v<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=y/i,r=b/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(d-c)/v,this.w=Math.acos((l+h+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=cJ(this.x,e.x,t.x),this.y=cJ(this.y,e.y,t.y),this.z=cJ(this.z,e.z,t.z),this.w=cJ(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=cJ(this.x,e,t),this.y=cJ(this.y,e,t),this.z=cJ(this.z,e,t),this.w=cJ(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(cJ(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class IJ extends rJ{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:cQ,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new DJ(0,0,e,t),this.scissorTest=!1,this.viewport=new DJ(0,0,e,t);const r={width:e,height:t,depth:n.depth},i=new jJ(r);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=i.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:cQ,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(t)}}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,!0!==this.textures[r].isData3DTexture&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new kJ(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class BJ extends IJ{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class FJ extends jJ{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=oQ,this.minFilter=oQ,this.wrapR=iQ,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class zJ extends jJ{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=oQ,this.minFilter=oQ,this.wrapR=iQ,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class UJ{constructor(e=new vJ(1/0,1/0,1/0),t=new vJ(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(GJ.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(GJ.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=GJ.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,GJ):GJ.fromBufferAttribute(r,t),GJ.applyMatrix4(e.matrixWorld),this.expandByPoint(GJ);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),qJ.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),qJ.copy(n.boundingBox)),qJ.applyMatrix4(e.matrixWorld),this.union(qJ)}const r=e.children;for(let i=0,a=r.length;i<a;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,GJ),GJ.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(QJ),ZJ.subVectors(this.max,QJ),WJ.subVectors(e.a,QJ),HJ.subVectors(e.b,QJ),$J.subVectors(e.c,QJ),KJ.subVectors(HJ,WJ),XJ.subVectors($J,HJ),YJ.subVectors(WJ,$J);let t=[0,-KJ.z,KJ.y,0,-XJ.z,XJ.y,0,-YJ.z,YJ.y,KJ.z,0,-KJ.x,XJ.z,0,-XJ.x,YJ.z,0,-YJ.x,-KJ.y,KJ.x,0,-XJ.y,XJ.x,0,-YJ.y,YJ.x,0];return!!t0(t,WJ,HJ,$J,ZJ)&&(t=[1,0,0,0,1,0,0,0,1],!!t0(t,WJ,HJ,$J,ZJ)&&(JJ.crossVectors(KJ,XJ),t=[JJ.x,JJ.y,JJ.z],t0(t,WJ,HJ,$J,ZJ)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,GJ).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(GJ).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(VJ[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),VJ[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),VJ[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),VJ[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),VJ[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),VJ[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),VJ[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),VJ[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(VJ)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const VJ=[new vJ,new vJ,new vJ,new vJ,new vJ,new vJ,new vJ,new vJ],GJ=new vJ,qJ=new UJ,WJ=new vJ,HJ=new vJ,$J=new vJ,KJ=new vJ,XJ=new vJ,YJ=new vJ,QJ=new vJ,ZJ=new vJ,JJ=new vJ,e0=new vJ;function t0(e,t,n,r,i){for(let a=0,o=e.length-3;a<=o;a+=3){e0.fromArray(e,a);const o=i.x*Math.abs(e0.x)+i.y*Math.abs(e0.y)+i.z*Math.abs(e0.z),s=t.dot(e0),l=n.dot(e0),c=r.dot(e0);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const n0=new UJ,r0=new vJ,i0=new vJ;class a0{constructor(e=new vJ,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):n0.setFromPoints(e).getCenter(n);let r=0;for(let i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;r0.subVectors(e,this.center);const t=r0.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(r0,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(i0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(r0.copy(e.center).add(i0)),this.expandByPoint(r0.copy(e.center).sub(i0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const o0=new vJ,s0=new vJ,l0=new vJ,c0=new vJ,u0=new vJ,d0=new vJ,h0=new vJ;class p0{constructor(e=new vJ,t=new vJ(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,o0)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=o0.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(o0.copy(this.origin).addScaledVector(this.direction,t),o0.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){s0.copy(e).add(t).multiplyScalar(.5),l0.copy(t).sub(e).normalize(),c0.copy(this.origin).sub(s0);const i=.5*e.distanceTo(t),a=-this.direction.dot(l0),o=c0.dot(this.direction),s=-c0.dot(l0),l=c0.lengthSq(),c=Math.abs(1-a*a);let u,d,h,p;if(c>0)if(u=a*s-o,d=a*o-s,p=i*c,u>=0)if(d>=-p)if(d<=p){const e=1/c;u*=e,d*=e,h=u*(u+a*d+2*o)+d*(a*u+d+2*s)+l}else d=i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d=-i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d<=-p?(u=Math.max(0,-(-a*i+o)),d=u>0?-i:Math.min(Math.max(-i,-s),i),h=-u*u+d*(d+2*s)+l):d<=p?(u=0,d=Math.min(Math.max(-i,-s),i),h=d*(d+2*s)+l):(u=Math.max(0,-(a*i+o)),d=u>0?i:Math.min(Math.max(-i,-s),i),h=-u*u+d*(d+2*s)+l);else d=a>0?-i:i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(s0).addScaledVector(l0,d),h}intersectSphere(e,t){o0.subVectors(e.center,this.origin);const n=o0.dot(this.direction),r=o0.dot(o0)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),c>=0?(i=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(i=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(o=(e.min.z-d.z)*u,s=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,s=(e.min.z-d.z)*u),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,o0)}intersectTriangle(e,t,n,r,i){u0.subVectors(t,e),d0.subVectors(n,e),h0.crossVectors(u0,d0);let a,o=this.direction.dot(h0);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}c0.subVectors(this.origin,e);const s=a*this.direction.dot(d0.crossVectors(c0,d0));if(s<0)return null;const l=a*this.direction.dot(u0.cross(c0));if(l<0)return null;if(s+l>o)return null;const c=-a*c0.dot(h0);return c<0?null:this.at(c/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class f0{constructor(e,t,n,r,i,a,o,s,l,c,u,d,h,p,f,m){f0.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,l,c,u,d,h,p,f,m)}set(e,t,n,r,i,a,o,s,l,c,u,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new f0).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return 0===this.determinant()?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(0===e.determinant())return this.identity();const t=this.elements,n=e.elements,r=1/m0.setFromMatrixColumn(e,0).length(),i=1/m0.setFromMatrixColumn(e,1).length(),a=1/m0.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-o*s,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e+i*o,t[4]=r*o-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e-i*o,t[4]=-a*u,t[8]=r+n*o,t[1]=n+r*o,t[5]=a*c,t[9]=i-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=s*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=o*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(v0,e,A0)}lookAt(e,t,n){const r=this.elements;return x0.subVectors(e,t),0===x0.lengthSq()&&(x0.z=1),x0.normalize(),y0.crossVectors(n,x0),0===y0.lengthSq()&&(1===Math.abs(n.z)?x0.x+=1e-4:x0.z+=1e-4,x0.normalize(),y0.crossVectors(n,x0)),y0.normalize(),b0.crossVectors(x0,y0),r[0]=y0.x,r[4]=b0.x,r[8]=x0.x,r[1]=y0.y,r[5]=b0.y,r[9]=x0.y,r[2]=y0.z,r[6]=b0.z,r[10]=x0.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],A=n[7],y=n[11],b=n[15],x=r[0],_=r[4],w=r[8],S=r[12],T=r[1],C=r[5],M=r[9],E=r[13],P=r[2],N=r[6],k=r[10],R=r[14],L=r[3],O=r[7],j=r[11],D=r[15];return i[0]=a*x+o*T+s*P+l*L,i[4]=a*_+o*C+s*N+l*O,i[8]=a*w+o*M+s*k+l*j,i[12]=a*S+o*E+s*R+l*D,i[1]=c*x+u*T+d*P+h*L,i[5]=c*_+u*C+d*N+h*O,i[9]=c*w+u*M+d*k+h*j,i[13]=c*S+u*E+d*R+h*D,i[2]=p*x+f*T+m*P+g*L,i[6]=p*_+f*C+m*N+g*O,i[10]=p*w+f*M+m*k+g*j,i[14]=p*S+f*E+m*R+g*D,i[3]=v*x+A*T+y*P+b*L,i[7]=v*_+A*C+y*N+b*O,i[11]=v*w+A*M+y*k+b*j,i[15]=v*S+A*E+y*R+b*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14],p=e[3],f=e[7],m=e[11],g=e[15],v=s*h-l*d,A=o*h-l*u,y=o*d-s*u,b=a*h-l*c,x=a*d-s*c,_=a*u-o*c;return t*(f*v-m*A+g*y)-n*(p*v-m*b+g*x)+r*(p*A-f*b+g*_)-i*(p*y-f*x+m*_)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*d*l+f*s*h-o*m*h-u*s*g+o*d*g,A=p*d*l-c*m*l-p*s*h+a*m*h+c*s*g-a*d*g,y=c*f*l-p*u*l+p*o*h-a*f*h-c*o*g+a*u*g,b=p*u*s-c*f*s-p*o*d+a*f*d+c*o*m-a*u*m,x=t*v+n*A+r*y+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/x;return e[0]=v*_,e[1]=(f*d*i-u*m*i-f*r*h+n*m*h+u*r*g-n*d*g)*_,e[2]=(o*m*i-f*s*i+f*r*l-n*m*l-o*r*g+n*s*g)*_,e[3]=(u*s*i-o*d*i-u*r*l+n*d*l+o*r*h-n*s*h)*_,e[4]=A*_,e[5]=(c*m*i-p*d*i+p*r*h-t*m*h-c*r*g+t*d*g)*_,e[6]=(p*s*i-a*m*i-p*r*l+t*m*l+a*r*g-t*s*g)*_,e[7]=(a*d*i-c*s*i+c*r*l-t*d*l-a*r*h+t*s*h)*_,e[8]=y*_,e[9]=(p*u*i-c*f*i-p*n*h+t*f*h+c*n*g-t*u*g)*_,e[10]=(a*f*i-p*o*i+p*n*l-t*f*l-a*n*g+t*o*g)*_,e[11]=(c*o*i-a*u*i-c*n*l+t*u*l+a*n*h-t*o*h)*_,e[12]=b*_,e[13]=(c*f*r-p*u*r+p*n*d-t*f*d-c*n*m+t*u*m)*_,e[14]=(p*o*r-a*f*r-p*n*s+t*f*s+a*n*m-t*o*m)*_,e[15]=(a*u*r-c*o*r+c*n*s-t*u*s-a*n*d+t*o*d)*_,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+n,c*s-r*a,0,l*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,d=i*l,h=i*c,p=i*u,f=a*c,m=a*u,g=o*u,v=s*l,A=s*c,y=s*u,b=n.x,x=n.y,_=n.z;return r[0]=(1-(f+g))*b,r[1]=(h+y)*b,r[2]=(p-A)*b,r[3]=0,r[4]=(h-y)*x,r[5]=(1-(d+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(p+A)*_,r[9]=(m-v)*_,r[10]=(1-(d+f))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;if(e.x=r[12],e.y=r[13],e.z=r[14],0===this.determinant())return n.set(1,1,1),t.identity(),this;let i=m0.set(r[0],r[1],r[2]).length();const a=m0.set(r[4],r[5],r[6]).length(),o=m0.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),g0.copy(this);const s=1/i,l=1/a,c=1/o;return g0.elements[0]*=s,g0.elements[1]*=s,g0.elements[2]*=s,g0.elements[4]*=l,g0.elements[5]*=l,g0.elements[6]*=l,g0.elements[8]*=c,g0.elements[9]*=c,g0.elements[10]*=c,t.setFromRotationMatrix(g0),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a,o=2e3,s=!1){const l=this.elements,c=2*i/(t-e),u=2*i/(n-r),d=(t+e)/(t-e),h=(n+r)/(n-r);let p,f;if(s)p=i/(a-i),f=a*i/(a-i);else if(o===GZ)p=-(a+i)/(a-i),f=-2*a*i/(a-i);else{if(o!==qZ)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-a/(a-i),f=-a*i/(a-i)}return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,i,a,o=2e3,s=!1){const l=this.elements,c=2/(t-e),u=2/(n-r),d=-(t+e)/(t-e),h=-(n+r)/(n-r);let p,f;if(s)p=1/(a-i),f=a/(a-i);else if(o===GZ)p=-2/(a-i),f=-(a+i)/(a-i);else{if(o!==qZ)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=-1/(a-i),f=-i/(a-i)}return l[0]=c,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=u,l[9]=0,l[13]=h,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const m0=new vJ,g0=new f0,v0=new vJ(0,0,0),A0=new vJ(1,1,1),y0=new vJ,b0=new vJ,x0=new vJ,_0=new f0,w0=new gJ;class S0{constructor(e=0,t=0,n=0,r=S0.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],l=r[5],c=r[9],u=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(cJ(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-cJ(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(cJ(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-cJ(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(cJ(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-cJ(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,h),this._y=0);break;default:eJ("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return _0.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_0,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return w0.setFromEuler(this),this.setFromQuaternion(w0,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}S0.DEFAULT_ORDER="XYZ";class T0{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let C0=0;const M0=new vJ,E0=new gJ,P0=new f0,N0=new vJ,k0=new vJ,R0=new vJ,L0=new gJ,O0=new vJ(1,0,0),j0=new vJ(0,1,0),D0=new vJ(0,0,1),I0={type:"added"},B0={type:"removed"},F0={type:"childadded",child:null},z0={type:"childremoved",child:null};class U0 extends rJ{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:C0++}),this.uuid=lJ(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=U0.DEFAULT_UP.clone();const e=new vJ,t=new S0,n=new gJ,r=new vJ(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new f0},normalMatrix:{value:new bJ}}),this.matrix=new f0,this.matrixWorld=new f0,this.matrixAutoUpdate=U0.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=U0.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new T0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return E0.setFromAxisAngle(e,t),this.quaternion.multiply(E0),this}rotateOnWorldAxis(e,t){return E0.setFromAxisAngle(e,t),this.quaternion.premultiply(E0),this}rotateX(e){return this.rotateOnAxis(O0,e)}rotateY(e){return this.rotateOnAxis(j0,e)}rotateZ(e){return this.rotateOnAxis(D0,e)}translateOnAxis(e,t){return M0.copy(e).applyQuaternion(this.quaternion),this.position.add(M0.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(O0,e)}translateY(e){return this.translateOnAxis(j0,e)}translateZ(e){return this.translateOnAxis(D0,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(P0.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?N0.copy(e):N0.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),k0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?P0.lookAt(k0,N0,this.up):P0.lookAt(N0,k0,this.up),this.quaternion.setFromRotationMatrix(P0),r&&(P0.extractRotation(r.matrixWorld),E0.setFromRotationMatrix(P0),this.quaternion.premultiply(E0.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(tJ("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(I0),F0.child=e,this.dispatchEvent(F0),F0.child=null):tJ("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(B0),z0.child=e,this.dispatchEvent(z0),z0.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),P0.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),P0.multiply(e.parent.matrixWorld)),e.applyMatrix4(P0),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(I0),F0.child=e,this.dispatchEvent(F0),F0.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(k0,e,R0),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(k0,L0,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(e=>({...e})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(r.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}U0.DEFAULT_UP=new vJ(0,1,0),U0.DEFAULT_MATRIX_AUTO_UPDATE=!0,U0.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const V0=new vJ,G0=new vJ,q0=new vJ,W0=new vJ,H0=new vJ,$0=new vJ,K0=new vJ,X0=new vJ,Y0=new vJ,Q0=new vJ,Z0=new DJ,J0=new DJ,e1=new DJ;class t1{constructor(e=new vJ,t=new vJ,n=new vJ){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),V0.subVectors(e,t),r.cross(V0);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){V0.subVectors(r,t),G0.subVectors(n,t),q0.subVectors(e,t);const a=V0.dot(V0),o=V0.dot(G0),s=V0.dot(q0),l=G0.dot(G0),c=G0.dot(q0),u=a*l-o*o;if(0===u)return i.set(0,0,0),null;const d=1/u,h=(l*s-o*c)*d,p=(a*c-o*s)*d;return i.set(1-h-p,p,h)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,W0)&&(W0.x>=0&&W0.y>=0&&W0.x+W0.y<=1)}static getInterpolation(e,t,n,r,i,a,o,s){return null===this.getBarycoord(e,t,n,r,W0)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(i,W0.x),s.addScaledVector(a,W0.y),s.addScaledVector(o,W0.z),s)}static getInterpolatedAttribute(e,t,n,r,i,a){return Z0.setScalar(0),J0.setScalar(0),e1.setScalar(0),Z0.fromBufferAttribute(e,t),J0.fromBufferAttribute(e,n),e1.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(Z0,i.x),a.addScaledVector(J0,i.y),a.addScaledVector(e1,i.z),a}static isFrontFacing(e,t,n,r){return V0.subVectors(n,t),G0.subVectors(e,t),V0.cross(G0).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return V0.subVectors(this.c,this.b),G0.subVectors(this.a,this.b),.5*V0.cross(G0).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t1.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return t1.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return t1.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return t1.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t1.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,o;H0.subVectors(r,n),$0.subVectors(i,n),X0.subVectors(e,n);const s=H0.dot(X0),l=$0.dot(X0);if(s<=0&&l<=0)return t.copy(n);Y0.subVectors(e,r);const c=H0.dot(Y0),u=$0.dot(Y0);if(c>=0&&u<=c)return t.copy(r);const d=s*u-c*l;if(d<=0&&s>=0&&c<=0)return a=s/(s-c),t.copy(n).addScaledVector(H0,a);Q0.subVectors(e,i);const h=H0.dot(Q0),p=$0.dot(Q0);if(p>=0&&h<=p)return t.copy(i);const f=h*l-s*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector($0,o);const m=c*p-h*u;if(m<=0&&u-c>=0&&h-p>=0)return K0.subVectors(i,r),o=(u-c)/(u-c+(h-p)),t.copy(r).addScaledVector(K0,o);const g=1/(m+f+d);return a=f*g,o=d*g,t.copy(n).addScaledVector(H0,a).addScaledVector($0,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const n1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},r1={h:0,s:0,l:0},i1={h:0,s:0,l:0};function a1(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class o1{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=MZ){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,TJ.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=TJ.workingColorSpace){return this.r=e,this.g=t,this.b=n,TJ.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=TJ.workingColorSpace){if(e=uJ(e,1),t=cJ(t,0,1),n=cJ(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=a1(i,r,e+1/3),this.g=a1(i,r,e),this.b=a1(i,r,e-1/3)}return TJ.colorSpaceToWorking(this,r),this}setStyle(e,t=MZ){function n(t){void 0!==t&&parseFloat(t)<1&&eJ("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:eJ("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);eJ("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=MZ){const n=n1[e.toLowerCase()];return void 0!==n?this.setHex(n,t):eJ("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=CJ(e.r),this.g=CJ(e.g),this.b=CJ(e.b),this}copyLinearToSRGB(e){return this.r=MJ(e.r),this.g=MJ(e.g),this.b=MJ(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=MZ){return TJ.workingToColorSpace(s1.copy(this),e),65536*Math.round(cJ(255*s1.r,0,255))+256*Math.round(cJ(255*s1.g,0,255))+Math.round(cJ(255*s1.b,0,255))}getHexString(e=MZ){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=TJ.workingColorSpace){TJ.workingToColorSpace(s1.copy(this),t);const n=s1.r,r=s1.g,i=s1.b,a=Math.max(n,r,i),o=Math.min(n,r,i);let s,l;const c=(o+a)/2;if(o===a)s=0,l=0;else{const e=a-o;switch(l=c<=.5?e/(a+o):e/(2-a-o),a){case n:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-n)/e+2;break;case i:s=(n-r)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e,t=TJ.workingColorSpace){return TJ.workingToColorSpace(s1.copy(this),t),e.r=s1.r,e.g=s1.g,e.b=s1.b,e}getStyle(e=MZ){TJ.workingToColorSpace(s1.copy(this),e);const t=s1.r,n=s1.g,r=s1.b;return e!==MZ?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(r1),this.setHSL(r1.h+e,r1.s+t,r1.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(r1),e.getHSL(i1);const n=dJ(r1.h,i1.h,t),r=dJ(r1.s,i1.s,t),i=dJ(r1.l,i1.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const s1=new o1;o1.NAMES=n1;let l1=0;class c1 extends rJ{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:l1++}),this.uuid=lJ(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=_Y,this.blendDst=wY,this.blendEquation=mY,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new o1(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kZ,this.stencilZFail=kZ,this.stencilZPass=kZ,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){eJ(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:eJ(`Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==_Y&&(n.blendSrc=this.blendSrc),this.blendDst!==wY&&(n.blendDst=this.blendDst),this.blendEquation!==mY&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==kZ&&(n.stencilFail=this.stencilFail),this.stencilZFail!==kZ&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==kZ&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!1===this.allowOverride&&(n.allowOverride=!1),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class u1 extends c1{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new o1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new S0,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const d1=h1();function h1(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(r[l]=0,r[256|l]=32768,i[l]=24,i[256|l]=24):e<-14?(r[l]=1024>>-e-14,r[256|l]=1024>>-e-14|32768,i[l]=-e-1,i[256|l]=-e-1):e<=15?(r[l]=e+15<<10,r[256|l]=e+15<<10|32768,i[l]=13,i[256|l]=13):e<128?(r[l]=31744,r[256|l]=64512,i[l]=24,i[256|l]=24):(r[l]=31744,r[256|l]=64512,i[l]=13,i[256|l]=13)}const a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,a[l]=e|t}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(s[l]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:o,offsetTable:s}}function p1(e){Math.abs(e)>65504&&eJ("DataUtils.toHalfFloat(): Value out of range."),e=cJ(e,-65504,65504),d1.floatView[0]=e;const t=d1.uint32View[0],n=t>>23&511;return d1.baseTable[n]+((8388607&t)>>d1.shiftTable[n])}function f1(e){const t=e>>10;return d1.uint32View[0]=d1.mantissaTable[d1.offsetTable[t]+(1023&e)]+d1.exponentTable[t],d1.floatView[0]}const m1=new vJ,g1=new mJ;let v1=0;class A1{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:v1++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=zZ,this.updateRanges=[],this.gpuType=AQ,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)g1.fromBufferAttribute(this,t),g1.applyMatrix3(e),this.setXY(t,g1.x,g1.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)m1.fromBufferAttribute(this,t),m1.applyMatrix3(e),this.setXYZ(t,m1.x,m1.y,m1.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)m1.fromBufferAttribute(this,t),m1.applyMatrix4(e),this.setXYZ(t,m1.x,m1.y,m1.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)m1.fromBufferAttribute(this,t),m1.applyNormalMatrix(e),this.setXYZ(t,m1.x,m1.y,m1.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)m1.fromBufferAttribute(this,t),m1.transformDirection(e),this.setXYZ(t,m1.x,m1.y,m1.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=hJ(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=pJ(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=hJ(t,this.array)),t}setX(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=hJ(t,this.array)),t}setY(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=hJ(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=hJ(t,this.array)),t}setW(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array),r=pJ(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array),r=pJ(r,this.array),i=pJ(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==zZ&&(e.usage=this.usage),e}}class y1 extends A1{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class b1 extends A1{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class x1 extends A1{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=f1(this.array[e*this.itemSize]);return this.normalized&&(t=hJ(t,this.array)),t}setX(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize]=p1(t),this}getY(e){let t=f1(this.array[e*this.itemSize+1]);return this.normalized&&(t=hJ(t,this.array)),t}setY(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize+1]=p1(t),this}getZ(e){let t=f1(this.array[e*this.itemSize+2]);return this.normalized&&(t=hJ(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize+2]=p1(t),this}getW(e){let t=f1(this.array[e*this.itemSize+3]);return this.normalized&&(t=hJ(t,this.array)),t}setW(e,t){return this.normalized&&(t=pJ(t,this.array)),this.array[e*this.itemSize+3]=p1(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array)),this.array[e+0]=p1(t),this.array[e+1]=p1(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array),r=pJ(r,this.array)),this.array[e+0]=p1(t),this.array[e+1]=p1(n),this.array[e+2]=p1(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array),r=pJ(r,this.array),i=pJ(i,this.array)),this.array[e+0]=p1(t),this.array[e+1]=p1(n),this.array[e+2]=p1(r),this.array[e+3]=p1(i),this}}class _1 extends A1{constructor(e,t,n){super(new Float32Array(e),t,n)}}let w1=0;const S1=new f0,T1=new U0,C1=new vJ,M1=new UJ,E1=new UJ,P1=new vJ;class N1 extends rJ{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:w1++}),this.uuid=lJ(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($Z(e)?b1:y1)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new bJ).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return S1.makeRotationFromQuaternion(e),this.applyMatrix4(S1),this}rotateX(e){return S1.makeRotationX(e),this.applyMatrix4(S1),this}rotateY(e){return S1.makeRotationY(e),this.applyMatrix4(S1),this}rotateZ(e){return S1.makeRotationZ(e),this.applyMatrix4(S1),this}translate(e,t,n){return S1.makeTranslation(e,t,n),this.applyMatrix4(S1),this}scale(e,t,n){return S1.makeScale(e,t,n),this.applyMatrix4(S1),this}lookAt(e){return T1.lookAt(e),T1.updateMatrix(),this.applyMatrix4(T1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(C1).negate(),this.translate(C1.x,C1.y,C1.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new _1(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length>t.count&&eJ("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new UJ);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return tJ("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new vJ(-1/0,-1/0,-1/0),new vJ(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];M1.setFromBufferAttribute(e),this.morphTargetsRelative?(P1.addVectors(this.boundingBox.min,M1.min),this.boundingBox.expandByPoint(P1),P1.addVectors(this.boundingBox.max,M1.max),this.boundingBox.expandByPoint(P1)):(this.boundingBox.expandByPoint(M1.min),this.boundingBox.expandByPoint(M1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&tJ('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new a0);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return tJ("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new vJ,1/0);if(e){const n=this.boundingSphere.center;if(M1.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const n=t[e];E1.setFromBufferAttribute(n),this.morphTargetsRelative?(P1.addVectors(M1.min,E1.min),M1.expandByPoint(P1),P1.addVectors(M1.max,E1.max),M1.expandByPoint(P1)):(M1.expandByPoint(E1.min),M1.expandByPoint(E1.max))}M1.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)P1.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(P1));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)P1.fromBufferAttribute(a,t),o&&(C1.fromBufferAttribute(e,t),P1.add(C1)),r=Math.max(r,n.distanceToSquared(P1))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&tJ('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void tJ("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new A1(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let w=0;w<n.count;w++)o[w]=new vJ,s[w]=new vJ;const l=new vJ,c=new vJ,u=new vJ,d=new mJ,h=new mJ,p=new mJ,f=new vJ,m=new vJ;function g(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),d.fromBufferAttribute(i,e),h.fromBufferAttribute(i,t),p.fromBufferAttribute(i,r),c.sub(l),u.sub(l),h.sub(d),p.sub(d);const a=1/(h.x*p.y-p.x*h.y);isFinite(a)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-h.y).multiplyScalar(a),m.copy(u).multiplyScalar(h.x).addScaledVector(c,-p.x).multiplyScalar(a),o[e].add(f),o[t].add(f),o[r].add(f),s[e].add(m),s[t].add(m),s[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let w=0,S=v.length;w<S;++w){const t=v[w],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)g(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const A=new vJ,y=new vJ,b=new vJ,x=new vJ;function _(e){b.fromBufferAttribute(r,e),x.copy(b);const t=o[e];A.copy(t),A.sub(b.multiplyScalar(b.dot(t))).normalize(),y.crossVectors(x,t);const n=y.dot(s[e])<0?-1:1;a.setXYZW(e,A.x,A.y,A.z,n)}for(let w=0,S=v.length;w<S;++w){const t=v[w],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)_(e.getX(r+0)),_(e.getX(r+1)),_(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new A1(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new vJ,i=new vJ,a=new vJ,o=new vJ,s=new vJ,l=new vJ,c=new vJ,u=new vJ;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,h),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),s.add(c),l.add(c),n.setXYZ(h,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)P1.fromBufferAttribute(e,t),P1.normalize(),e.setXYZ(t,P1.x,P1.y,P1.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let o=0,s=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*r;for(let e=0;e<r;e++)a[s++]=n[o++]}return new A1(a,r,i)}if(null===this.index)return eJ("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new N1,n=this.index.array,r=this.attributes;for(const o in r){const i=e(r[o],n);t.setAttribute(o,i)}const i=this.morphAttributes;for(const o in i){const r=[],a=i[o];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let i=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];n.push(i.toJSON(e.data))}n.length>0&&(r[s]=n,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere=o.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const r=e.attributes;for(const l in r){const e=r[l];this.setAttribute(l,e.clone(t))}const i=e.morphAttributes;for(const l in i){const e=[],n=i[l];for(let r=0,i=n.length;r<i;r++)e.push(n[r].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const k1=new f0,R1=new p0,L1=new a0,O1=new vJ,j1=new vJ,D1=new vJ,I1=new vJ,B1=new vJ,F1=new vJ,z1=new vJ,U1=new vJ;class V1 extends U0{constructor(e=new N1,t=new u1){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(i&&o){F1.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],s=i[n];0!==r&&(B1.fromBufferAttribute(s,e),a?F1.addScaledVector(B1,r):F1.addScaledVector(B1.sub(t),r))}t.add(F1)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),L1.copy(n.boundingSphere),L1.applyMatrix4(i),R1.copy(e.ray).recast(e.near),!1===L1.containsPoint(R1.origin)){if(null===R1.intersectSphere(L1,O1))return;if(R1.origin.distanceToSquared(O1)>(e.far-e.near)**2)return}k1.copy(i).invert(),R1.copy(e.ray).applyMatrix4(k1),null!==n.boundingBox&&!1===R1.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,R1)}}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,o=i.index,s=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,d=i.groups,h=i.drawRange;if(null!==o)if(Array.isArray(a))for(let p=0,f=d.length;p<f;p++){const i=d[p],s=a[i.materialIndex];for(let a=Math.max(i.start,h.start),d=Math.min(o.count,Math.min(i.start+i.count,h.start+h.count));a<d;a+=3){r=G1(this,s,e,n,l,c,u,o.getX(a),o.getX(a+1),o.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,h.start),s=Math.min(o.count,h.start+h.count);i<s;i+=3){r=G1(this,a,e,n,l,c,u,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==s)if(Array.isArray(a))for(let p=0,f=d.length;p<f;p++){const i=d[p],o=a[i.materialIndex];for(let a=Math.max(i.start,h.start),d=Math.min(s.count,Math.min(i.start+i.count,h.start+h.count));a<d;a+=3){r=G1(this,o,e,n,l,c,u,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,h.start),o=Math.min(s.count,h.start+h.count);i<o;i+=3){r=G1(this,a,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}}function G1(e,t,n,r,i,a,o,s,l,c){e.getVertexPosition(s,j1),e.getVertexPosition(l,D1),e.getVertexPosition(c,I1);const u=function(e,t,n,r,i,a,o,s){let l;if(l=1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,0===t.side,s),null===l)return null;U1.copy(s),U1.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(U1);return c<n.near||c>n.far?null:{distance:c,point:U1.clone(),object:e}}(e,t,n,r,j1,D1,I1,z1);if(u){const e=new vJ;t1.getBarycoord(z1,j1,D1,I1,e),i&&(u.uv=t1.getInterpolatedAttribute(i,s,l,c,e,new mJ)),a&&(u.uv1=t1.getInterpolatedAttribute(a,s,l,c,e,new mJ)),o&&(u.normal=t1.getInterpolatedAttribute(o,s,l,c,e,new vJ),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const t={a:s,b:l,c:c,normal:new vJ,materialIndex:0};t1.getNormal(j1,D1,I1,t.normal),u.face=t,u.barycoord=e}return u}class q1 extends N1{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const o=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const s=[],l=[],c=[],u=[];let d=0,h=0;function p(e,t,n,r,i,a,p,f,m,g,v){const A=a/m,y=p/g,b=a/2,x=p/2,_=f/2,w=m+1,S=g+1;let T=0,C=0;const M=new vJ;for(let o=0;o<S;o++){const a=o*y-x;for(let s=0;s<w;s++){const d=s*A-b;M[e]=d*r,M[t]=a*i,M[n]=_,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let o=0;o<g;o++)for(let e=0;e<m;e++){const t=d+e+w*o,n=d+e+w*(o+1),r=d+(e+1)+w*(o+1),i=d+(e+1)+w*o;s.push(t,n,i),s.push(n,r,i),C+=6}o.addGroup(h,C,v),h+=C,d+=T}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new _1(l,3)),this.setAttribute("normal",new _1(c,3)),this.setAttribute("uv",new _1(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new q1(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function W1(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(eJ("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function H1(e){const t={};for(let n=0;n<e.length;n++){const r=W1(e[n]);for(const e in r)t[e]=r[e]}return t}function $1(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:TJ.workingColorSpace}const K1={clone:W1,merge:H1};class X1 extends c1{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=W1(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Y1 extends U0{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new f0,this.projectionMatrix=new f0,this.projectionMatrixInverse=new f0,this.coordinateSystem=GZ,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Q1=new vJ,Z1=new mJ,J1=new mJ;class e2 extends Y1{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*sJ*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*oJ*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*sJ*Math.atan(Math.tan(.5*oJ*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Q1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Q1.x,Q1.y).multiplyScalar(-e/Q1.z),Q1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Q1.x,Q1.y).multiplyScalar(-e/Q1.z)}getViewSize(e,t){return this.getViewBounds(e,Z1,J1),t.subVectors(J1,Z1)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*oJ*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const t2=-90;class n2 extends U0{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new e2(t2,1,e,t);r.layers=this.layers,this.add(r);const i=new e2(t2,1,e,t);i.layers=this.layers,this.add(i);const a=new e2(t2,1,e,t);a.layers=this.layers,this.add(a);const o=new e2(t2,1,e,t);o.layers=this.layers,this.add(o);const s=new e2(t2,1,e,t);s.layers=this.layers,this.add(s);const l=new e2(t2,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,o,s]=t;for(const l of t)this.remove(l);if(e===GZ)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==qZ)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,o,s,l,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,o),e.setRenderTarget(n,3,r),e.render(t,s),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,d,h),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class r2 extends jJ{constructor(e=[],t=301,n,r,i,a,o,s,l,c){super(e,t,n,r,i,a,o,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class i2 extends BJ{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new r2(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new q1(5,5,5),i=new X1({name:"CubemapFromEquirect",uniforms:W1(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const a=new V1(r,i),o=t.minFilter;t.minFilter===dQ&&(t.minFilter=cQ);return new n2(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}class a2 extends U0{constructor(){super(),this.isGroup=!0,this.type="Group"}}const o2={type:"move"};class s2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new a2,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new a2,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new vJ,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new vJ),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new a2,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new vJ,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new vJ),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),r=this._getHandJoint(l,a);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(o2)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new a2;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class l2 extends U0{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new S0,this.environmentIntensity=1,this.environmentRotation=new S0,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class c2{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=zZ,this.updateRanges=[],this.version=0,this.uuid=lJ()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=lJ()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=lJ()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const u2=new vJ;class d2{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)u2.fromBufferAttribute(this,t),u2.applyMatrix4(e),this.setXYZ(t,u2.x,u2.y,u2.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)u2.fromBufferAttribute(this,t),u2.applyNormalMatrix(e),this.setXYZ(t,u2.x,u2.y,u2.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)u2.fromBufferAttribute(this,t),u2.transformDirection(e),this.setXYZ(t,u2.x,u2.y,u2.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=hJ(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=pJ(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=pJ(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=pJ(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=pJ(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=pJ(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=hJ(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=hJ(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=hJ(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=hJ(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array),r=pJ(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=pJ(t,this.array),n=pJ(n,this.array),r=pJ(r,this.array),i=pJ(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){JZ("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new A1(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new d2(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){JZ("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class h2 extends c1{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new o1(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class p2 extends jJ{constructor(e=null,t=1,n=1,r,i,a,o,s,l=1003,c=1003,u,d){super(null,a,o,s,l,c,r,i,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class f2 extends A1{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const m2=new vJ,g2=new vJ,v2=new bJ;class A2{constructor(e=new vJ(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=m2.subVectors(n,t).cross(g2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(m2),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||v2.getNormalMatrix(e),r=this.coplanarPoint(m2).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const y2=new a0,b2=new mJ(.5,.5),x2=new vJ;class _2{constructor(e=new A2,t=new A2,n=new A2,r=new A2,i=new A2,a=new A2){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3,n=!1){const r=this.planes,i=e.elements,a=i[0],o=i[1],s=i[2],l=i[3],c=i[4],u=i[5],d=i[6],h=i[7],p=i[8],f=i[9],m=i[10],g=i[11],v=i[12],A=i[13],y=i[14],b=i[15];if(r[0].setComponents(l-a,h-c,g-p,b-v).normalize(),r[1].setComponents(l+a,h+c,g+p,b+v).normalize(),r[2].setComponents(l+o,h+u,g+f,b+A).normalize(),r[3].setComponents(l-o,h-u,g-f,b-A).normalize(),n)r[4].setComponents(s,d,m,y).normalize(),r[5].setComponents(l-s,h-d,g-m,b-y).normalize();else if(r[4].setComponents(l-s,h-d,g-m,b-y).normalize(),t===GZ)r[5].setComponents(l+s,h+d,g+m,b+y).normalize();else{if(t!==qZ)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(s,d,m,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),y2.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),y2.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(y2)}intersectsSprite(e){y2.center.set(0,0,0);const t=b2.distanceTo(e.center);return y2.radius=.7071067811865476+t,y2.applyMatrix4(e.matrixWorld),this.intersectsSphere(y2)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(x2.x=r.normal.x>0?e.max.x:e.min.x,x2.y=r.normal.y>0?e.max.y:e.min.y,x2.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(x2)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const w2=new f0,S2=new _2;class T2{constructor(){this.coordinateSystem=GZ}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(w2.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),S2.setFromProjectionMatrix(w2,r.coordinateSystem,r.reversedDepth),S2.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(w2.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),S2.setFromProjectionMatrix(w2,r.coordinateSystem,r.reversedDepth),S2.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(w2.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),S2.setFromProjectionMatrix(w2,r.coordinateSystem,r.reversedDepth),S2.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(w2.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),S2.setFromProjectionMatrix(w2,r.coordinateSystem,r.reversedDepth),S2.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(w2.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),S2.setFromProjectionMatrix(w2,r.coordinateSystem,r.reversedDepth),S2.containsPoint(e))return!0}return!1}clone(){return new T2}}class C2 extends c1{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new o1(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const M2=new vJ,E2=new vJ,P2=new f0,N2=new p0,k2=new a0,R2=new vJ,L2=new vJ;class O2 extends U0{constructor(e=new N1,t=new C2){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)M2.fromBufferAttribute(t,e-1),E2.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=M2.distanceTo(E2);e.setAttribute("lineDistance",new _1(n,1))}else eJ("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),k2.copy(n.boundingSphere),k2.applyMatrix4(r),k2.radius+=i,!1===e.ray.intersectsSphere(k2))return;P2.copy(r).invert(),N2.copy(e.ray).applyMatrix4(P2);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){const n=c.getX(i),r=c.getX(i+1),a=j2(this,e,N2,s,n,r,i);a&&t.push(a)}if(this.isLineLoop){const i=c.getX(r-1),a=c.getX(n),o=j2(this,e,N2,s,i,a,r-1);o&&t.push(o)}}else{const n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){const n=j2(this,e,N2,s,i,i+1,i);n&&t.push(n)}if(this.isLineLoop){const i=j2(this,e,N2,s,r-1,n,r-1);i&&t.push(i)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function j2(e,t,n,r,i,a,o){const s=e.geometry.attributes.position;M2.fromBufferAttribute(s,i),E2.fromBufferAttribute(s,a);if(n.distanceSqToSegment(M2,E2,R2,L2)>r)return;R2.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(R2);return l<t.near||l>t.far?void 0:{distance:l,point:L2.clone().applyMatrix4(e.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:e}}const D2=new vJ,I2=new vJ;class B2 extends O2{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)D2.fromBufferAttribute(t,e),I2.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+D2.distanceTo(I2);e.setAttribute("lineDistance",new _1(n,1))}else eJ("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class F2 extends c1{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new o1(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const z2=new f0,U2=new p0,V2=new a0,G2=new vJ;class q2 extends U0{constructor(e=new N1,t=new F2){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),V2.copy(n.boundingSphere),V2.applyMatrix4(r),V2.radius+=i,!1===e.ray.intersectsSphere(V2))return;z2.copy(r).invert(),U2.copy(e.ray).applyMatrix4(z2);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);n<i;n++){const i=l.getX(n);G2.fromBufferAttribute(c,i),W2(G2,i,s,r,e,t,this)}}else{for(let n=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);n<i;n++)G2.fromBufferAttribute(c,n),W2(G2,n,s,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function W2(e,t,n,r,i,a,o){const s=U2.distanceSqToPoint(e);if(s<n){const n=new vJ;U2.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class H2 extends jJ{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=oQ,this.minFilter=oQ,this.generateMipmaps=!1,this.needsUpdate=!0}}class $2 extends jJ{constructor(e,t,n=1014,r,i,a,o=1003,s=1003,l,c=1026,u=1){if(c!==EQ&&c!==PQ)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:u},r,i,a,o,s,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new kJ(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class K2 extends $2{constructor(e,t=1014,n=301,r,i,a=1003,o=1003,s,l=1026){const c={width:e,height:e,depth:1},u=[c,c,c,c,c,c];super(e,e,t,n,r,i,a,o,s,l),this.image=u,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class X2 extends jJ{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Y2 extends N1{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],a=[],o=[],s=[],l=new vJ,c=new mJ;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const i=n+u/t*r;l.x=e*Math.cos(i),l.y=e*Math.sin(i),a.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(a[d]/e+1)/2,c.y=(a[d+1]/e+1)/2,s.push(c.x,c.y)}for(let u=1;u<=t;u++)i.push(u,u+1,0);this.setIndex(i),this.setAttribute("position",new _1(a,3)),this.setAttribute("normal",new _1(o,3)),this.setAttribute("uv",new _1(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Y2(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Q2 extends N1{constructor(e=1,t=1,n=1,r=32,i=1,a=!1,o=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],d=[],h=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,a=new mJ,f=new vJ;let v=0;const A=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*y,0),d.push(0,y,0),h.push(.5,.5),p++;const b=p;for(let e=0;e<=r;e++){const t=e/r*s+o,n=Math.cos(t),i=Math.sin(t);f.x=A*i,f.y=m*y,f.z=A*n,u.push(f.x,f.y,f.z),d.push(0,y,0),a.x=.5*n+.5,a.y=.5*i*y+.5,h.push(a.x,a.y),p++}for(let e=0;e<r;e++){const t=i+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const a=new vJ,v=new vJ;let A=0;const y=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,A=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+o,l=Math.sin(i),f=Math.cos(i);v.x=A*l,v.y=-g*n+m,v.z=A*f,u.push(v.x,v.y,v.z),a.set(l,y,f).normalize(),d.push(a.x,a.y,a.z),h.push(t,1-g),c.push(p++)}f.push(c)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const a=f[r][n],o=f[r+1][n],s=f[r+1][n+1],l=f[r][n+1];(e>0||0!==r)&&(c.push(a,o,l),A+=3),(t>0||r!==i-1)&&(c.push(o,s,l),A+=3)}l.addGroup(g,A,0),g+=A}(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new _1(u,3)),this.setAttribute("normal",new _1(d,3)),this.setAttribute("uv",new _1(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Q2(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Z2{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){eJ("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const i=n.length;let a;a=t||e*n[i-1];let o,s=0,l=i-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),o=n[r]-a,o<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===a)return r/(i-1);const c=n[r];return(r+(a-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new mJ:new vJ);return s.copy(o).sub(a).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new vJ,r=[],i=[],a=[],o=new vJ,s=new f0;for(let h=0;h<=e;h++){const t=h/e;r[h]=this.getTangentAt(t,new vJ)}i[0]=new vJ,a[0]=new vJ;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),d=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),d<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(let h=1;h<=e;h++){if(i[h]=i[h-1].clone(),a[h]=a[h-1].clone(),o.crossVectors(r[h-1],r[h]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(cJ(r[h-1].dot(r[h]),-1,1));i[h].applyMatrix4(s.makeRotationAxis(o,e))}a[h].crossVectors(r[h],i[h])}if(!0===t){let t=Math.acos(cJ(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class J2 extends Z2{constructor(e=0,t=0,n=1,r=1,i=0,a=2*Math.PI,o=!1,s=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t=new mJ){const n=t,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);const o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=l-this.aY;s=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function e3(){let e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){let l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,c=(n-t)/o-(r-t)/(o+s)+(r-n)/s;l*=o,c*=o,i(t,n,l,c)},calc:function(i){const a=i*i;return e+t*i+n*a+r*(a*i)}}}const t3=new vJ,n3=new e3,r3=new e3,i3=new e3;function a3(e,t,n,r,i){const a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function o3(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function s3(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class l3 extends Z2{constructor(e=new mJ,t=new mJ,n=new mJ,r=new mJ){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new mJ){const n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(s3(e,r.x,i.x,a.x,o.x),s3(e,r.y,i.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class c3 extends Z2{constructor(e=new vJ,t=new vJ,n=new vJ,r=new vJ){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new vJ){const n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(s3(e,r.x,i.x,a.x,o.x),s3(e,r.y,i.y,a.y,o.y),s3(e,r.z,i.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class u3 extends Z2{constructor(e=new mJ,t=new mJ){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new mJ){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new mJ){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class d3 extends Z2{constructor(e=new mJ,t=new mJ,n=new mJ){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new mJ){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(o3(e,r.x,i.x,a.x),o3(e,r.y,i.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class h3 extends Z2{constructor(e=new vJ,t=new vJ,n=new vJ){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new vJ){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(o3(e,r.x,i.x,a.x),o3(e,r.y,i.y,a.y),o3(e,r.z,i.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class p3 extends Z2{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new mJ){const n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],l=r[a],c=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(a3(o,s.x,l.x,c.x,u.x),a3(o,s.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new mJ).fromArray(n))}return this}}var f3=Object.freeze({__proto__:null,ArcCurve:class extends J2{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Z2{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new vJ){const n=t,r=this.points,i=r.length,a=(i-(this.closed?0:1))*e;let o,s,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(t3.subVectors(r[0],r[1]).add(r[0]),o=t3);const u=r[l%i],d=r[(l+1)%i];if(this.closed||l+2<i?s=r[(l+2)%i]:(t3.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=t3),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(d),e),r=Math.pow(d.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),n3.initNonuniformCatmullRom(o.x,u.x,d.x,s.x,t,n,r),r3.initNonuniformCatmullRom(o.y,u.y,d.y,s.y,t,n,r),i3.initNonuniformCatmullRom(o.z,u.z,d.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(n3.initCatmullRom(o.x,u.x,d.x,s.x,this.tension),r3.initCatmullRom(o.y,u.y,d.y,s.y,this.tension),i3.initCatmullRom(o.z,u.z,d.z,s.z,this.tension));return n.set(n3.calc(c),r3.calc(c),i3.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new vJ).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:l3,CubicBezierCurve3:c3,EllipseCurve:J2,LineCurve:u3,LineCurve3:class extends Z2{constructor(e=new vJ,t=new vJ){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new vJ){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new vJ){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:d3,QuadraticBezierCurve3:h3,SplineCurve:p3});class m3 extends Z2{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new f3[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,a=this.curves[i],o=a.getLength(),s=0===o?0:1-e/o;return a.getPointAt(s,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const a=i[r],o=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o);for(let e=0;e<s.length;e++){const r=s[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new f3[n.type]).fromJSON(n))}return this}}class g3 extends m3{constructor(e){super(),this.type="Path",this.currentPoint=new mJ,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new u3(this.currentPoint.clone(),new mJ(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new d3(this.currentPoint.clone(),new mJ(e,t),new mJ(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){const o=new l3(this.currentPoint.clone(),new mJ(e,t),new mJ(n,r),new mJ(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new p3(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,a,o,s),this}absellipse(e,t,n,r,i,a,o,s){const l=new J2(e,t,n,r,i,a,o,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class v3 extends g3{constructor(e){super(e),this.uuid=lJ(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new g3).fromJSON(n))}return this}}function A3(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let a=y3(e,0,i,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(r&&(a=function(e,t,n,r){const i=[];for(let a=0,o=t.length;a<o;a++){const n=y3(e,t[a]*r,a<o-1?t[a+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(N3(n))}i.sort(C3);for(let a=0;a<i.length;a++)n=M3(i[a],n);return n}(e,t,a,n)),e.length>80*n){s=e[0],l=e[1];let t=s,r=l;for(let a=n;a<i;a+=n){const n=e[a],i=e[a+1];n<s&&(s=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-s,r-l),c=0!==c?32767/c:0}return x3(a,o,n,s,l,c,0),o}function y3(e,t,n,r,i){let a;if(i===function(e,t,n,r){let i=0;for(let a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(let o=t;o<n;o+=r)a=U3(o/r|0,e[o],e[o+1],a);else for(let o=n-r;o>=t;o-=r)a=U3(o/r|0,e[o],e[o+1],a);return a&&j3(a,a.next)&&(V3(a),a=a.next),a}function b3(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!j3(r,r.next)&&0!==O3(r.prev,r,r.next))r=r.next;else{if(V3(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function x3(e,t,n,r,i,a,o){if(!e)return;!o&&a&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=P3(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let a=null;for(t=0;i;){t++;let o=i,s=0;for(let e=0;e<n&&(s++,o=o.nextZ,o);e++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||i.z<=o.z)?(r=i,i=i.nextZ,s--):(r=o,o=o.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=o}a.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,a);let s=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(a?w3(e,r,i,a):_3(e))t.push(l.i,e.i,c.i),V3(e),e=c.next,s=c.next;else if((e=c)===s){o?1===o?x3(e=S3(b3(e),t),t,n,r,i,a,2):2===o&&T3(e,t,n,r,i,a):x3(b3(e),t,n,r,i,a,1);break}}}function _3(e){const t=e.prev,n=e,r=e.next;if(O3(t,n,r)>=0)return!1;const i=t.x,a=n.x,o=r.x,s=t.y,l=n.y,c=r.y,u=Math.min(i,a,o),d=Math.min(s,l,c),h=Math.max(i,a,o),p=Math.max(s,l,c);let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=h&&f.y>=d&&f.y<=p&&R3(i,s,a,l,o,c,f.x,f.y)&&O3(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function w3(e,t,n,r){const i=e.prev,a=e,o=e.next;if(O3(i,a,o)>=0)return!1;const s=i.x,l=a.x,c=o.x,u=i.y,d=a.y,h=o.y,p=Math.min(s,l,c),f=Math.min(u,d,h),m=Math.max(s,l,c),g=Math.max(u,d,h),v=P3(p,f,t,n,r),A=P3(m,g,t,n,r);let y=e.prevZ,b=e.nextZ;for(;y&&y.z>=v&&b&&b.z<=A;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==o&&R3(s,u,l,d,c,h,y.x,y.y)&&O3(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&R3(s,u,l,d,c,h,b.x,b.y)&&O3(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==o&&R3(s,u,l,d,c,h,y.x,y.y)&&O3(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=A;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&R3(s,u,l,d,c,h,b.x,b.y)&&O3(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function S3(e,t){let n=e;do{const r=n.prev,i=n.next.next;!j3(r,i)&&D3(r,n,n.next,i)&&F3(r,i)&&F3(i,r)&&(t.push(r.i,n.i,i.i),V3(n),V3(n.next),n=e=i),n=n.next}while(n!==e);return b3(n)}function T3(e,t,n,r,i,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&L3(o,e)){let s=z3(o,e);return o=b3(o,o.next),s=b3(s,s.next),x3(o,t,n,r,i,a,0),void x3(s,t,n,r,i,a,0)}e=e.next}o=o.next}while(o!==e)}function C3(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return n}function M3(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let a,o=-1/0;if(j3(e,n))return n;do{if(j3(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>o&&(o=e,a=n.x<n.next.x?n:n.next,e===r))return a}n=n.next}while(n!==t);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(r>=n.x&&n.x>=l&&r!==n.x&&k3(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);F3(n,e)&&(t<u||t===u&&(n.x>a.x||n.x===a.x&&E3(a,n)))&&(a=n,u=t)}n=n.next}while(n!==s);return a}(e,t);if(!n)return t;const r=z3(n,e);return b3(r,r.next),b3(n,n.next)}function E3(e,t){return O3(e.prev,e,t.prev)<0&&O3(t.next,e,e.next)<0}function P3(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function N3(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function k3(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function R3(e,t,n,r,i,a,o,s){return!(e===o&&t===s)&&k3(e,t,n,r,i,a,o,s)}function L3(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&D3(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(F3(e,t)&&F3(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(O3(e.prev,e,t.prev)||O3(e,t.prev,t))||j3(e,t)&&O3(e.prev,e,e.next)>0&&O3(t.prev,t,t.next)>0)}function O3(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function j3(e,t){return e.x===t.x&&e.y===t.y}function D3(e,t,n,r){const i=B3(O3(e,t,n)),a=B3(O3(e,t,r)),o=B3(O3(n,r,e)),s=B3(O3(n,r,t));return i!==a&&o!==s||(!(0!==i||!I3(e,n,t))||(!(0!==a||!I3(e,r,t))||(!(0!==o||!I3(n,e,r))||!(0!==s||!I3(n,t,r)))))}function I3(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function B3(e){return e>0?1:e<0?-1:0}function F3(e,t){return O3(e.prev,e,e.next)<0?O3(e,t,e.next)>=0&&O3(e,e.prev,t)>=0:O3(e,t,e.prev)<0||O3(e,e.next,t)<0}function z3(e,t){const n=G3(e.i,e.x,e.y),r=G3(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function U3(e,t,n,r){const i=G3(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function V3(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function G3(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class q3{static triangulate(e,t,n=2){return A3(e,t,n)}}class W3{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return W3.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];H3(e),$3(n,e);let a=e.length;t.forEach(H3);for(let s=0;s<t.length;s++)r.push(a),a+=t[s].length,$3(n,t[s]);const o=q3.triangulate(n,r);for(let s=0;s<o.length;s+=3)i.push(o.slice(s,s+3));return i}}function H3(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function $3(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class K3 extends N1{constructor(e=new v3([new mJ(.5,.5),new mJ(-.5,.5),new mJ(-.5,-.5),new mJ(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let o=0,s=e.length;o<s;o++){a(e[o])}function a(e){const a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:u-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:X3;let g,v,A,y,b,x=!1;if(f){g=f.getSpacedPoints(s),x=!0,c=!1;const e=!!f.isCatmullRomCurve3&&f.closed;v=f.computeFrenetFrames(s,e),A=new vJ,y=new vJ,b=new vJ}c||(p=0,u=0,d=0,h=0);const _=e.extractPoints(o);let w=_.shape;const S=_.holes;if(!W3.isClockWise(w)){w=w.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];W3.isClockWise(t)&&(S[e]=t.reverse())}}function T(e){const t=1e-10*1e-10;let n=e[0];for(let r=1;r<=e.length;r++){const i=r%e.length,a=e[i],o=a.x-n.x,s=a.y-n.y,l=o*o+s*s,c=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(n.x),Math.abs(n.y));l<=t*c*c?(e.splice(i,1),r--):n=a}}T(w),S.forEach(T);const C=S.length,M=w;for(let t=0;t<C;t++){const e=S[t];w=w.concat(e)}function E(e,t,n){return t||tJ("ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const P=w.length;function N(e,t,n){let r,i,a;const o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s,d=o*c-s*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(u),h=Math.sqrt(l*l+c*c),p=t.x-s/d,f=t.y+o/d,m=((n.x-c/h-p)*c-(n.y+l/h-f)*l)/(o*c-s*l);r=p+o*m-e.x,i=f+s*m-e.y;const g=r*r+i*i;if(g<=2)return new mJ(r,i);a=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,i=o,a=Math.sqrt(u)):(r=o,i=s,a=Math.sqrt(u/2))}return new mJ(r/a,i/a)}const k=[];for(let t=0,n=M.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),k[t]=N(M[t],M[r],M[i]);const R=[];let L,O,j=k.concat();for(let t=0,n=C;t<n;t++){const e=S[t];L=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),L[t]=N(e[t],e[r],e[i]);R.push(L),j=j.concat(L)}if(0===p)O=W3.triangulateShape(M,S);else{const e=[],t=[];for(let n=0;n<p;n++){const r=n/p,i=u*Math.cos(r*Math.PI/2),a=d*Math.sin(r*Math.PI/2)+h;for(let t=0,n=M.length;t<n;t++){const n=E(M[t],k[t],a);F(n.x,n.y,-i),0===r&&e.push(n)}for(let e=0,n=C;e<n;e++){const n=S[e];L=R[e];const o=[];for(let e=0,t=n.length;e<t;e++){const t=E(n[e],L[e],a);F(t.x,t.y,-i),0===r&&o.push(t)}0===r&&t.push(o)}}O=W3.triangulateShape(e,t)}const D=O.length,I=d+h;for(let t=0;t<P;t++){const e=c?E(w[t],j[t],I):w[t];x?(y.copy(v.normals[0]).multiplyScalar(e.x),A.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(y).add(A),F(b.x,b.y,b.z)):F(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<P;e++){const n=c?E(w[e],j[e],I):w[e];x?(y.copy(v.normals[t]).multiplyScalar(n.x),A.copy(v.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(y).add(A),F(b.x,b.y,b.z)):F(n.x,n.y,l/s*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=d*Math.sin(e*Math.PI/2)+h;for(let t=0,i=M.length;t<i;t++){const e=E(M[t],k[t],r);F(e.x,e.y,l+n)}for(let t=0,i=S.length;t<i;t++){const e=S[t];L=R[t];for(let t=0,i=e.length;t<i;t++){const i=E(e[t],L[t],r);x?F(i.x,i.y+g[s-1].y,g[s-1].x+n):F(i.x,i.y,l+n)}}}function B(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=s+2*p;e<n;e++){const n=P*e,a=P*(e+1);U(t+r+n,t+i+n,t+i+a,t+r+a)}}}function F(e,t,n){a.push(e),a.push(t),a.push(n)}function z(e,t,i){V(e),V(t),V(i);const a=r.length/3,o=m.generateTopUV(n,r,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[2])}function U(e,t,i,a){V(e),V(t),V(a),V(t),V(i),V(a);const o=r.length/3,s=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);G(s[0]),G(s[1]),G(s[3]),G(s[1]),G(s[2]),G(s[3])}function V(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function G(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=P*e;for(let n=0;n<D;n++){const e=O[n];z(e[2]+t,e[1]+t,e[0]+t)}e=s+2*p,t=P*e;for(let n=0;n<D;n++){const e=O[n];z(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<D;e++){const t=O[e];z(t[2],t[1],t[0])}for(let e=0;e<D;e++){const t=O[e];z(t[0]+P*s,t[1]+P*s,t[2]+P*s)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;B(M,t),t+=M.length;for(let n=0,r=S.length;n<r;n++){const e=S[n];B(e,t),t+=e.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new _1(r,3)),this.setAttribute("uv",new _1(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let r=0,i=e.length;r<i;r++){const t=e[r];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,a=e.shapes.length;i<a;i++){const r=t[e.shapes[i]];n.push(r)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new f3[r.type]).fromJSON(r)),new K3(n,e.options)}}const X3={generateTopUV:function(e,t,n,r,i){const a=t[3*n],o=t[3*n+1],s=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new mJ(a,o),new mJ(s,l),new mJ(c,u)]},generateSideWallUV:function(e,t,n,r,i,a){const o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],d=t[3*r+2],h=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new mJ(o,1-l),new mJ(c,1-d),new mJ(h,1-f),new mJ(m,1-v)]:[new mJ(s,1-l),new mJ(u,1-d),new mJ(p,1-f),new mJ(g,1-v)]}};class Y3 extends N1{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),l=o+1,c=s+1,u=e/o,d=t/s,h=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*d-a;for(let t=0;t<l;t++){const n=t*u-i;p.push(n,-e,0),f.push(0,0,1),m.push(t/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+l*g,n=e+l*(g+1),r=e+1+l*(g+1),i=e+1+l*g;h.push(t,n,i),h.push(n,r,i)}this.setIndex(h),this.setAttribute("position",new _1(p,3)),this.setAttribute("normal",new _1(f,3)),this.setAttribute("uv",new _1(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Y3(e.width,e.height,e.widthSegments,e.heightSegments)}}class Q3 extends N1{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new vJ,d=new vJ,h=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const h=[],v=g/n;let A=0;0===g&&0===a?A=.5/t:g===n&&s===Math.PI&&(A=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(r+s*i)*Math.sin(a+v*o),u.y=e*Math.cos(a+v*o),u.z=e*Math.sin(r+s*i)*Math.sin(a+v*o),p.push(u.x,u.y,u.z),d.copy(u).normalize(),f.push(d.x,d.y,d.z),m.push(s+A,1-v),h.push(l++)}c.push(h)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],r=c[g][e],i=c[g+1][e],o=c[g+1][e+1];(0!==g||a>0)&&h.push(t,r,o),(g!==n-1||s<Math.PI)&&h.push(r,i,o)}this.setIndex(h),this.setAttribute("position",new _1(p,3)),this.setAttribute("normal",new _1(f,3)),this.setAttribute("uv",new _1(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Q3(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Z3 extends N1{constructor(e=new h3(new vJ(-1,-1,0),new vJ(-1,1,0),new vJ(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new vJ,s=new vJ,l=new mJ;let c=new vJ;const u=[],d=[],h=[],p=[];function f(i){c=e.getPointAt(i/t,c);const l=a.normals[i],h=a.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);s.x=a*l.x+i*h.x,s.y=a*l.y+i*h.y,s.z=a*l.z+i*h.z,s.normalize(),d.push(s.x,s.y,s.z),o.x=c.x+n*s.x,o.y=c.y+n*s.y,o.z=c.z+n*s.z,u.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,h.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,o=(r+1)*(e-1)+t;p.push(n,i,o),p.push(i,a,o)}}()}(),this.setIndex(p),this.setAttribute("position",new _1(u,3)),this.setAttribute("normal",new _1(d,3)),this.setAttribute("uv",new _1(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Z3((new f3[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class J3 extends N1{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new vJ,i=new vJ;if(null!==e.index){const a=e.attributes.position,o=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){const l=s[e],c=l.start;for(let e=c,s=c+l.count;e<s;e+=3)for(let l=0;l<3;l++){const s=o.getX(e+l),c=o.getX(e+(l+1)%3);r.fromBufferAttribute(a,s),i.fromBufferAttribute(a,c),!0===e4(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const a=e.attributes.position;for(let e=0,o=a.count/3;e<o;e++)for(let s=0;s<3;s++){const o=3*e+s,l=3*e+(s+1)%3;r.fromBufferAttribute(a,o),i.fromBufferAttribute(a,l),!0===e4(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new _1(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function e4(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}class t4 extends c1{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new o1(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class n4 extends X1{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class r4 extends c1{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new o1(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new o1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mJ(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new S0,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class i4 extends r4{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mJ(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return cJ(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new o1(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new o1(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new o1(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class a4 extends c1{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new o1(16777215),this.specular=new o1(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new o1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mJ(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new S0,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class o4 extends c1{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new o1(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new o1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mJ(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class s4 extends c1{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mJ(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class l4 extends c1{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new o1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new o1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mJ(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new S0,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class c4 extends c1{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class u4 extends c1{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class d4 extends c1{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new o1(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mJ(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class h4 extends C2{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function p4(e,t){return e&&e.constructor!==t?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}class f4{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(!(e>=i)){const o=t[1];e<o&&(n=2,i=o);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0;break n}break e}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let a=0;a!==r;++a)t[a]=n[i+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class m4 extends f4{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:bZ,endingEnd:bZ}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case xZ:i=e,o=2*t-n;break;case _Z:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case xZ:a=e,s=2*n-t;break;case _Z:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,A=(-1-h)*m+(1.5+h)*f+.5*p,y=h*m-h*f;for(let b=0;b!==o;++b)i[b]=g*a[c+b]+v*a[l+b]+A*a[s+b]+y*a[u+b];return i}}class g4 extends f4{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(r-t),u=1-c;for(let d=0;d!==o;++d)i[d]=a[l+d]*u+a[s+d]*c;return i}}class v4 extends f4{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class A4{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=p4(t,this.TimeBufferType),this.values=p4(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:p4(e.times,Array),values:p4(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new v4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new g4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new m4(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case vZ:t=this.InterpolantFactoryMethodDiscrete;break;case AZ:t=this.InterpolantFactoryMethodLinear;break;case yZ:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return eJ("KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return vZ;case this.InterpolantFactoryMethodLinear:return AZ;case this.InterpolantFactoryMethodSmooth:return yZ}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(tJ("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(tJ("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==i;o++){const t=n[o];if("number"===typeof t&&isNaN(t)){tJ("KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==a&&a>t){tJ("KeyframeTrack: Out of order keys.",this,o,t,a),e=!1;break}a=t}if(void 0!==r&&KZ(r))for(let o=0,s=r.length;o!==s;++o){const t=r[o];if(isNaN(t)){tJ("KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===yZ,i=e.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)i=!0;else{const e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[a+o]){i=!0;break}}}if(i){if(o!==a){e[a]=e[o];const r=o*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,o=0;o!==n;++o)t[r+o]=t[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}A4.prototype.ValueTypeName="",A4.prototype.TimeBufferType=Float32Array,A4.prototype.ValueBufferType=Float32Array,A4.prototype.DefaultInterpolation=AZ;class y4 extends A4{constructor(e,t,n){super(e,t,n)}}y4.prototype.ValueTypeName="bool",y4.prototype.ValueBufferType=Array,y4.prototype.DefaultInterpolation=vZ,y4.prototype.InterpolantFactoryMethodLinear=void 0,y4.prototype.InterpolantFactoryMethodSmooth=void 0;class b4 extends A4{constructor(e,t,n,r){super(e,t,n,r)}}b4.prototype.ValueTypeName="color";class x4 extends A4{constructor(e,t,n,r){super(e,t,n,r)}}x4.prototype.ValueTypeName="number";class _4 extends f4{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let l=e*o;for(let c=l+o;l!==c;l+=4)gJ.slerpFlat(i,0,a,l-o,a,l,s);return i}}class w4 extends A4{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new _4(this.times,this.values,this.getValueSize(),e)}}w4.prototype.ValueTypeName="quaternion",w4.prototype.InterpolantFactoryMethodSmooth=void 0;class S4 extends A4{constructor(e,t,n){super(e,t,n)}}S4.prototype.ValueTypeName="string",S4.prototype.ValueBufferType=Array,S4.prototype.DefaultInterpolation=vZ,S4.prototype.InterpolantFactoryMethodLinear=void 0,S4.prototype.InterpolantFactoryMethodSmooth=void 0;class T4 extends A4{constructor(e,t,n,r){super(e,t,n,r)}}T4.prototype.ValueTypeName="vector";const C4={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class M4{constructor(e,t,n){const r=this;let i,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const E4=new M4;class P4{constructor(e){this.manager=void 0!==e?e:E4,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}P4.DEFAULT_MATERIAL_NAME="__DEFAULT";Error;const N4=new WeakMap;class k4 extends P4{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=C4.get(`image:${e}`);if(void 0!==a){if(!0===a.complete)i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0);else{let e=N4.get(a);void 0===e&&(e=[],N4.set(a,e)),e.push({onLoad:t,onError:r})}return a}const o=XZ("img");function s(){c(),t&&t(this);const n=N4.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}N4.delete(this),i.manager.itemEnd(e)}function l(t){c(),r&&r(t),C4.remove(`image:${e}`);const n=N4.get(this)||[];for(let e=0;e<n.length;e++){const r=n[e];r.onError&&r.onError(t)}N4.delete(this),i.manager.itemError(e),i.manager.itemEnd(e)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),C4.add(`image:${e}`,o),i.manager.itemStart(e),o.src=e,o}}class R4 extends P4{constructor(e){super(e)}load(e,t,n,r){const i=new jJ,a=new k4(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}class L4 extends U0{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new o1(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class O4 extends L4{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(U0.DEFAULT_UP),this.updateMatrix(),this.groundColor=new o1(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const j4=new f0,D4=new vJ,I4=new vJ;class B4{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mJ(512,512),this.mapType=hQ,this.map=null,this.mapPass=null,this.matrix=new f0,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new _2,this._frameExtents=new mJ(1,1),this._viewportCount=1,this._viewports=[new DJ(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;D4.setFromMatrixPosition(e.matrixWorld),t.position.copy(D4),I4.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(I4),t.updateMatrixWorld(),j4.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(j4,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(j4)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class F4 extends B4{constructor(){super(new e2(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*sJ*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class z4 extends L4{constructor(e,t,n=0,r=Math.PI/3,i=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(U0.DEFAULT_UP),this.updateMatrix(),this.target=new U0,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new F4}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class U4 extends B4{constructor(){super(new e2(90,1,.5,500)),this.isPointLightShadow=!0}}class V4 extends L4{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new U4}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class G4 extends Y1{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class q4 extends B4{constructor(){super(new G4(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class W4 extends L4{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(U0.DEFAULT_UP),this.updateMatrix(),this.target=new U0,this.shadow=new q4}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class H4 extends L4{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class $4 extends L4{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class K4{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new vJ)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class X4 extends L4{constructor(e=new K4,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Y4 extends N1{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}new WeakMap;class Q4 extends e2{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Z4{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const J4="\\[\\]\\.:\\/",e5=new RegExp("["+J4+"]","g"),t5="[^"+J4+"]",n5="[^"+J4.replace("\\.","")+"]",r5=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",t5)+/(WCOD+)?/.source.replace("WCOD",n5)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t5)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t5)+"$"),i5=["material","materials","bones","map"];class a5{constructor(e,t,n){this.path=t,this.parsedPath=n||a5.parseTrackName(t),this.node=a5.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new a5.Composite(e,t,n):new a5(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(e5,"")}static parseTrackName(e){const t=r5.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==i5.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=a5.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void eJ("PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void tJ("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void tJ("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void tJ("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void tJ("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void tJ("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void tJ("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void tJ("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){return void tJ("PropertyBinding: Trying to update property for track: "+t.nodeName+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?o=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void tJ("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void tJ("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}a5.Composite=class{constructor(e,t,n){const r=n||a5.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},a5.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},a5.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},a5.prototype.GetterByBindingType=[a5.prototype._getValue_direct,a5.prototype._getValue_array,a5.prototype._getValue_arrayElement,a5.prototype._getValue_toArray],a5.prototype.SetterByBindingTypeAndVersioning=[[a5.prototype._setValue_direct,a5.prototype._setValue_direct_setNeedsUpdate,a5.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[a5.prototype._setValue_array,a5.prototype._setValue_array_setNeedsUpdate,a5.prototype._setValue_array_setMatrixWorldNeedsUpdate],[a5.prototype._setValue_arrayElement,a5.prototype._setValue_arrayElement_setNeedsUpdate,a5.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[a5.prototype._setValue_fromArray,a5.prototype._setValue_fromArray_setNeedsUpdate,a5.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);class o5 extends c2{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const s5=new f0;function l5(e,t){return e.distance-t.distance}function c5(e,t,n,r){let i=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(i=!1)}if(!0===i&&!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)c5(r[e],t,n,!0)}}class u5{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=cJ(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(cJ(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class d5{constructor(e,t,n,r){d5.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}}const h5=new vJ,p5=new vJ,f5=new vJ,m5=new vJ,g5=new vJ,v5=new vJ,A5=new vJ;class y5{constructor(){this.type="ShapePath",this.color=new o1,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new g3,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let i=n-1,a=0;a<n;i=a++){let n=t[i],o=t[a],s=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],s=-s,o=t[i],l=-l),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return r}const n=W3.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,a,o;const s=[];if(1===r.length)return a=r[0],o=new v3,o.curves=a.curves,s.push(o),s;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let d,h,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=r.length;m<g;m++)a=r[m],d=a.getPoints(),i=n(d),i=e?!i:i,i?(!l&&u[f]&&f++,u[f]={s:new v3,p:d},u[f].s.curves=a.curves,l&&f++,p[f]=[]):p[f].push({h:a,p:d[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new v3;i.curves=r.curves,t.push(i)}return t}(r);if(u.length>1){let e=!1,n=0;for(let t=0,r=u.length;t<r;t++)c[t]=[];for(let r=0,i=u.length;r<i;r++){const i=p[r];for(let a=0;a<i.length;a++){const o=i[a];let s=!0;for(let i=0;i<u.length;i++)t(o.p,u[i].p)&&(r!==i&&n++,s?(s=!1,c[i].push(o)):e=!0);s&&c[r].push(o)}}n>0&&!1===e&&(p=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,s.push(o),h=p[m];for(let e=0,t=h.length;e<t;e++)o.holes.push(h[e].h)}return s}}class b5 extends rJ{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):eJ("Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function x5(e,t,n,r){const i=function(e){switch(e){case hQ:case pQ:return{byteLength:1,components:1};case mQ:case fQ:case yQ:return{byteLength:2,components:1};case bQ:case xQ:return{byteLength:2,components:4};case vQ:case gQ:case AQ:return{byteLength:4,components:1};case wQ:case SQ:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(r);switch(n){case TQ:return e*t;case NQ:case kQ:return e*t/i.components*i.byteLength;case RQ:case LQ:return e*t*2/i.components*i.byteLength;case CQ:return e*t*3/i.components*i.byteLength;case MQ:case OQ:return e*t*4/i.components*i.byteLength;case jQ:case DQ:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case IQ:case BQ:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case zQ:case VQ:return Math.max(e,16)*Math.max(t,8)/4;case FQ:case UQ:return Math.max(e,8)*Math.max(t,8)/2;case GQ:case qQ:case HQ:case $Q:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case WQ:case KQ:case XQ:case YQ:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case QQ:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case ZQ:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case JQ:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case eZ:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case tZ:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case nZ:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case rZ:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case iZ:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case aZ:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case oZ:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case sZ:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case lZ:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case cZ:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case uZ:case dZ:case hZ:return Math.ceil(e/4)*Math.ceil(t/4)*16;case pZ:case fZ:return Math.ceil(e/4)*Math.ceil(t/4)*8;case mZ:case gZ:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:nY}})),"undefined"!==typeof window&&(window.__THREE__?eJ("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=nY);const _5=new vJ,w5=new f0,S5=new f0,T5=new vJ,C5=new vJ;function M5(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function E5(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=t.get(n);if(void 0===i)t.set(n,function(t,n){const r=t.array,i=t.usage,a=r.byteLength,o=e.createBuffer();let s;if(e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback(),r instanceof Float32Array)s=e.FLOAT;else if("undefined"!==typeof Float16Array&&r instanceof Float16Array)s=e.HALF_FLOAT;else if(r instanceof Uint16Array)s=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)s=e.SHORT;else if(r instanceof Uint32Array)s=e.UNSIGNED_INT;else if(r instanceof Int32Array)s=e.INT;else if(r instanceof Int8Array)s=e.BYTE;else if(r instanceof Uint8Array)s=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=e.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:a}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const i=n.array,a=n.updateRanges;if(e.bindBuffer(r,t),0===a.length)e.bufferSubData(r,0,i);else{a.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<a.length;e++){const n=a[t],r=a[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,a[t]=r)}a.length=t+1;for(let n=0,o=a.length;n<o;n++){const t=a[n];e.bufferSubData(r,t.start*i.BYTES_PER_ELEMENT,i,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}const P5={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.metalness = metalnessFactor;\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;\n\tmaterial.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = vec3( 0.04 );\n\tmaterial.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"uniform sampler2D dfgLUT;\nstruct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tvec3 diffuseContribution;\n\tvec3 specularColor;\n\tvec3 specularColorBlended;\n\tfloat roughness;\n\tfloat metalness;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t\tvec3 iridescenceFresnelDielectric;\n\t\tvec3 iridescenceFresnelMetallic;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn v;\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColorBlended;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat rInv = 1.0 / ( roughness + 0.1 );\n\tfloat a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;\n\tfloat b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;\n\tfloat DG = exp( a * dotNV + b );\n\treturn saturate( DG );\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nvec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;\n\tvec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;\n\tvec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;\n\tvec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;\n\tfloat Ess_V = dfgV.x + dfgV.y;\n\tfloat Ess_L = dfgL.x + dfgL.y;\n\tfloat Ems_V = 1.0 - Ess_V;\n\tfloat Ems_L = 1.0 - Ess_L;\n\tvec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;\n\tvec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );\n\tfloat compensationFactor = Ems_V * Ems_L;\n\tvec3 multiScatter = Fms * compensationFactor;\n\treturn singleScatter + multiScatter;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n \n \t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n \n \t\tfloat sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n \t\tfloat sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );\n \n \t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );\n \n \t\tirradiance *= sheenEnergyComp;\n \n \t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );\n\t#ifdef USE_SHEEN\n\t\tfloat sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;\n\t\tdiffuse *= sheenEnergyComp;\n\t#endif\n\treflectedLight.indirectDiffuse += diffuse;\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;\n \t#endif\n\tvec3 singleScatteringDielectric = vec3( 0.0 );\n\tvec3 multiScatteringDielectric = vec3( 0.0 );\n\tvec3 singleScatteringMetallic = vec3( 0.0 );\n\tvec3 multiScatteringMetallic = vec3( 0.0 );\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );\n\t#endif\n\tvec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );\n\tvec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );\n\tvec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;\n\tvec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tvec3 indirectSpecular = radiance * singleScattering;\n\tindirectSpecular += multiScattering * cosineWeightedIrradiance;\n\tvec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;\n\t\tindirectSpecular *= sheenEnergyComp;\n\t\tindirectDiffuse *= sheenEnergyComp;\n\t#endif\n\treflectedLight.indirectSpecular += indirectSpecular;\n\treflectedLight.indirectDiffuse += indirectDiffuse;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );\n\t\tmaterial.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\t#else\n\t\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\t#else\n\t\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\t#elif defined( SHADOWMAP_TYPE_BASIC )\n\t\t\tuniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\tfloat interleavedGradientNoise( vec2 position ) {\n\t\t\treturn fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );\n\t\t}\n\t\tvec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {\n\t\t\tconst float goldenAngle = 2.399963229728653;\n\t\t\tfloat r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );\n\t\t\tfloat theta = float( sampleIndex ) * goldenAngle + phi;\n\t\t\treturn vec2( cos( theta ), sin( theta ) ) * r;\n\t\t}\n\t#endif\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\tfloat getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\t\tfloat radius = shadowRadius * texelSize.x;\n\t\t\t\tfloat phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )\n\t\t\t\t) * 0.2;\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tvec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;\n\t\t\t\tfloat mean = distribution.x;\n\t\t\t\tfloat variance = distribution.y * distribution.y;\n\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\tfloat hard_shadow = step( mean, shadowCoord.z );\n\t\t\t\t#else\n\t\t\t\t\tfloat hard_shadow = step( shadowCoord.z, mean );\n\t\t\t\t#endif\n\t\t\t\tif ( hard_shadow == 1.0 ) {\n\t\t\t\t\tshadow = 1.0;\n\t\t\t\t} else {\n\t\t\t\t\tvariance = max( variance, 0.0000001 );\n\t\t\t\t\tfloat d = shadowCoord.z - mean;\n\t\t\t\t\tfloat p_max = variance / ( variance + d * d );\n\t\t\t\t\tp_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );\n\t\t\t\t\tshadow = max( hard_shadow, p_max );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#else\n\t\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tfloat depth = texture2D( shadowMap, shadowCoord.xy ).r;\n\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\tshadow = step( depth, shadowCoord.z );\n\t\t\t\t#else\n\t\t\t\t\tshadow = step( shadowCoord.z, depth );\n\t\t\t\t#endif\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\tfloat getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tvec3 absVec = abs( lightToPosition );\n\t\tfloat viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );\n\t\tif ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );\n\t\t\tdp += shadowBias;\n\t\t\tfloat texelSize = shadowRadius / shadowMapSize.x;\n\t\t\tvec3 absDir = abs( bd3D );\n\t\t\tvec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );\n\t\t\ttangent = normalize( cross( bd3D, tangent ) );\n\t\t\tvec3 bitangent = cross( bd3D, tangent );\n\t\t\tfloat phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;\n\t\t\tshadow = (\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )\n\t\t\t) * 0.2;\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\t#elif defined( SHADOWMAP_TYPE_BASIC )\n\tfloat getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tvec3 absVec = abs( lightToPosition );\n\t\tfloat viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );\n\t\tif ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );\n\t\t\tdp += shadowBias;\n\t\t\tfloat depth = textureCube( shadowMap, bd3D ).r;\n\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\tshadow = step( depth, dp );\n\t\t\t#else\n\t\t\t\tshadow = step( dp, depth );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\t#endif\n\t#endif\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distance_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distance_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n \n\t\toutgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;\n \n \t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},N5={common:{diffuse:{value:new o1(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new bJ},alphaMap:{value:null},alphaMapTransform:{value:new bJ},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new bJ}},envmap:{envMap:{value:null},envMapRotation:{value:new bJ},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new bJ}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new bJ}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new bJ},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new bJ},normalScale:{value:new mJ(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new bJ},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new bJ}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new bJ}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new bJ}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new o1(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new o1(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new bJ},alphaTest:{value:0},uvTransform:{value:new bJ}},sprite:{diffuse:{value:new o1(16777215)},opacity:{value:1},center:{value:new mJ(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new bJ},alphaMap:{value:null},alphaMapTransform:{value:new bJ},alphaTest:{value:0}}},k5={basic:{uniforms:H1([N5.common,N5.specularmap,N5.envmap,N5.aomap,N5.lightmap,N5.fog]),vertexShader:P5.meshbasic_vert,fragmentShader:P5.meshbasic_frag},lambert:{uniforms:H1([N5.common,N5.specularmap,N5.envmap,N5.aomap,N5.lightmap,N5.emissivemap,N5.bumpmap,N5.normalmap,N5.displacementmap,N5.fog,N5.lights,{emissive:{value:new o1(0)}}]),vertexShader:P5.meshlambert_vert,fragmentShader:P5.meshlambert_frag},phong:{uniforms:H1([N5.common,N5.specularmap,N5.envmap,N5.aomap,N5.lightmap,N5.emissivemap,N5.bumpmap,N5.normalmap,N5.displacementmap,N5.fog,N5.lights,{emissive:{value:new o1(0)},specular:{value:new o1(1118481)},shininess:{value:30}}]),vertexShader:P5.meshphong_vert,fragmentShader:P5.meshphong_frag},standard:{uniforms:H1([N5.common,N5.envmap,N5.aomap,N5.lightmap,N5.emissivemap,N5.bumpmap,N5.normalmap,N5.displacementmap,N5.roughnessmap,N5.metalnessmap,N5.fog,N5.lights,{emissive:{value:new o1(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:P5.meshphysical_vert,fragmentShader:P5.meshphysical_frag},toon:{uniforms:H1([N5.common,N5.aomap,N5.lightmap,N5.emissivemap,N5.bumpmap,N5.normalmap,N5.displacementmap,N5.gradientmap,N5.fog,N5.lights,{emissive:{value:new o1(0)}}]),vertexShader:P5.meshtoon_vert,fragmentShader:P5.meshtoon_frag},matcap:{uniforms:H1([N5.common,N5.bumpmap,N5.normalmap,N5.displacementmap,N5.fog,{matcap:{value:null}}]),vertexShader:P5.meshmatcap_vert,fragmentShader:P5.meshmatcap_frag},points:{uniforms:H1([N5.points,N5.fog]),vertexShader:P5.points_vert,fragmentShader:P5.points_frag},dashed:{uniforms:H1([N5.common,N5.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:P5.linedashed_vert,fragmentShader:P5.linedashed_frag},depth:{uniforms:H1([N5.common,N5.displacementmap]),vertexShader:P5.depth_vert,fragmentShader:P5.depth_frag},normal:{uniforms:H1([N5.common,N5.bumpmap,N5.normalmap,N5.displacementmap,{opacity:{value:1}}]),vertexShader:P5.meshnormal_vert,fragmentShader:P5.meshnormal_frag},sprite:{uniforms:H1([N5.sprite,N5.fog]),vertexShader:P5.sprite_vert,fragmentShader:P5.sprite_frag},background:{uniforms:{uvTransform:{value:new bJ},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:P5.background_vert,fragmentShader:P5.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new bJ}},vertexShader:P5.backgroundCube_vert,fragmentShader:P5.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:P5.cube_vert,fragmentShader:P5.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:P5.equirect_vert,fragmentShader:P5.equirect_frag},distance:{uniforms:H1([N5.common,N5.displacementmap,{referencePosition:{value:new vJ},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:P5.distance_vert,fragmentShader:P5.distance_frag},shadow:{uniforms:H1([N5.lights,N5.fog,{color:{value:new o1(0)},opacity:{value:1}}]),vertexShader:P5.shadow_vert,fragmentShader:P5.shadow_frag}};k5.physical={uniforms:H1([k5.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new bJ},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new bJ},clearcoatNormalScale:{value:new mJ(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new bJ},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new bJ},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new bJ},sheen:{value:0},sheenColor:{value:new o1(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new bJ},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new bJ},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new bJ},transmissionSamplerSize:{value:new mJ},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new bJ},attenuationDistance:{value:0},attenuationColor:{value:new o1(0)},specularColor:{value:new o1(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new bJ},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new bJ},anisotropyVector:{value:new mJ},anisotropyMap:{value:null},anisotropyMapTransform:{value:new bJ}}]),vertexShader:P5.meshphysical_vert,fragmentShader:P5.meshphysical_frag};const R5={r:0,b:0,g:0},L5=new S0,O5=new f0;function j5(e,t,n,r,i,a,o){const s=new o1(0);let l,c,u=!0===a?0:1,d=null,h=0,p=null;function f(e){let r=!0===e.isScene?e.background:null;if(r&&r.isTexture){r=(e.backgroundBlurriness>0?n:t).get(r)}return r}function m(t,n){t.getRGB(R5,$1(e)),r.buffers.color.setClear(R5.r,R5.g,R5.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),u=t,m(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(s,u)},render:function(t){let n=!1;const i=f(t);null===i?m(s,u):i&&i.isColor&&(m(i,1),n=!0);const a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=f(n);r&&(r.isCubeTexture||r.mapping===nQ)?(void 0===c&&(c=new V1(new q1(1,1,1),new X1({name:"BackgroundCubeMaterial",uniforms:W1(k5.backgroundCube.uniforms),vertexShader:k5.backgroundCube.vertexShader,fragmentShader:k5.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),L5.copy(n.backgroundRotation),L5.x*=-1,L5.y*=-1,L5.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(L5.y*=-1,L5.z*=-1),c.material.uniforms.envMap.value=r,c.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(O5.makeRotationFromEuler(L5)),c.material.toneMapped=TJ.getTransfer(r.colorSpace)!==NZ,d===r&&h===r.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=r,h=r.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new V1(new Y3(2,2),new X1({name:"BackgroundMaterial",uniforms:W1(k5.background.uniforms),vertexShader:k5.background.vertexShader,fragmentShader:k5.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=TJ.getTransfer(r.colorSpace)!==NZ,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),d===r&&h===r.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=r,h=r.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function D5(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=c(null);let a=i,o=!1;function s(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],r=[],i=[];for(let a=0;a<n;a++)t[a]=0,r[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=a.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){h(e,0)}function h(t,n){const r=a.newAttributes,i=a.enabledAttributes,o=a.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),o[t]!==n&&(e.vertexAttribDivisor(t,n),o[t]=n)}function p(){const t=a.newAttributes,n=a.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function f(t,n,r,i,a,o,s){!0===s?e.vertexAttribIPointer(t,n,r,a,o):e.vertexAttribPointer(t,n,r,i,a,o)}function m(){g(),o=!0,a!==i&&(a=i,s(a.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let v=!1;const A=function(t,n,i){const a=!0===i.wireframe;let o=r[t.id];void 0===o&&(o={},r[t.id]=o);let s=o[n.id];void 0===s&&(s={},o[n.id]=s);let l=s[a];void 0===l&&(l=c(e.createVertexArray()),s[a]=l);return l}(m,l,i);a!==A&&(a=A,s(a.object)),v=function(e,t,n,r){const i=a.attributes,o=t.attributes;let s=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){const t=i[a];let n=o[a];if(void 0===n&&("instanceMatrix"===a&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;s++}}return a.attributesNum!==s||a.index!==r}(n,m,l,g),v&&function(e,t,n,r){const i={},o=t.attributes;let s=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){let t=o[a];void 0===t&&("instanceMatrix"===a&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),i[a]=n,s++}}a.attributes=i,a.attributesNum=s,a.index=r}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,i,a){u();const o=a.attributes,s=i.getAttributes(),l=r.defaultAttributeValues;for(const c in s){const r=s[c];if(r.location>=0){let i=o[c];if(void 0===i&&("instanceMatrix"===c&&n.instanceMatrix&&(i=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(i=n.instanceColor)),void 0!==i){const o=i.normalized,s=i.itemSize,l=t.get(i);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||i.gpuType===gQ;if(i.isInterleavedBufferAttribute){const t=i.data,l=t.stride,g=i.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)h(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)d(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)f(r.location+e,s/r.locationSize,u,o,l*p,(g+s/r.locationSize*e)*p,m)}else{if(i.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)h(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)d(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)f(r.location+e,s/r.locationSize,u,o,s*p,s/r.locationSize*e*p,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}p()}(n,i,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)l(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:d,disableUnusedAttributes:p}}function I5(e,t,n){let r;function i(t,i,a){0!==a&&(e.drawArraysInstanced(r,t,i,a),n.update(i,r,a))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,a);let o=0;for(let t=0;t<a;t++)o+=i[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,a,o,s){if(0===o)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)i(e[t],a[t],s[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,a,0,s,0,o);let t=0;for(let e=0;e<o;e++)t+=a[e]*s[e];n.update(t,r,1)}}}function B5(e,t,n,r){let i;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const s=a(o);s!==o&&(eJ("WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:a,textureFormatReadable:function(t){return t===MQ||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===yQ&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==hQ&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==AQ&&!i)},precision:o,logarithmicDepthBuffer:!0===n.logarithmicDepthBuffer,reversedDepthBuffer:!0===n.reversedDepthBuffer&&t.has("EXT_clip_control"),maxTextures:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),maxSamples:e.getParameter(e.MAX_SAMPLES),samples:e.getParameter(e.SAMPLES)}}function F5(e){const t=this;let n=null,r=0,i=!1,a=!1;const o=new A2,s=new bJ,l={value:null,needsUpdate:!1};function c(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=r;n!==a;++n,l+=4)o.copy(e[n]).applyMatrix4(i,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,s,u){const d=o.clippingPlanes,h=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(!i||null===d||0===d.length||a&&!p)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=a?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=c(d,s,t,u);for(let r=0;r!==t;++r)i[r]=n[r];f.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function z5(e){let t=new WeakMap;function n(e,t){return t===eQ?e.mapping=ZY:t===tQ&&(e.mapping=JY),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(a===eQ||a===tQ){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const a=i.image;if(a&&a.height>0){const o=new i2(a.height);return o.fromEquirectangularTexture(e,i),t.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}const U5=[.125,.215,.35,.446,.526,.582],V5=20,G5=new G4,q5=new o1;let W5=null,H5=0,$5=0,K5=!1;const X5=new vJ;class Y5{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,r=100,i={}){const{size:a=256,position:o=X5}=i;W5=this._renderer.getRenderTarget(),H5=this._renderer.getActiveCubeFace(),$5=this._renderer.getActiveMipmapLevel(),K5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s,o),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=e6(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=J5(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(W5,H5,$5),this._renderer.xr.enabled=K5,e.scissorTest=!1,Z5(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ZY||e.mapping===JY?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),W5=this._renderer.getRenderTarget(),H5=this._renderer.getActiveCubeFace(),$5=this._renderer.getActiveMipmapLevel(),K5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:cQ,minFilter:cQ,generateMipmaps:!1,type:yQ,format:MQ,colorSpace:EZ,depthBuffer:!1},r=Q5(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Q5(e,t,n);const{_lodMax:r}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+U5.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);t.push(a);let s=1/a;o>e-4?s=U5[o-e+4-1]:0===o&&(s=0),n.push(s);const l=1/(a-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*h),A=new Float32Array(m*p*h),y=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,f*p*e),A.set(d,m*p*e);const i=[e,e,e,e,e,e];y.set(i,g*p*e)}const b=new N1;b.setAttribute("position",new A1(v,f)),b.setAttribute("uv",new A1(A,m)),b.setAttribute("faceIndex",new A1(y,g)),r.push(new V1(b,null)),i>4&&i--}return{lodMeshes:r,sizeLods:t,sigmas:n}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(V5),i=new vJ(0,1,0),a=new X1({name:"SphericalGaussianBlur",defines:{n:V5,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:t6(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return a}(r,e,t),this._ggxMaterial=function(e,t,n){const r=new X1({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:256,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:t6(),fragmentShader:'\n\n\t\t\tprecision highp float;\n\t\t\tprecision highp int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform float roughness;\n\t\t\tuniform float mipInt;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\t#define PI 3.14159265359\n\n\t\t\t// Van der Corput radical inverse\n\t\t\tfloat radicalInverse_VdC(uint bits) {\n\t\t\t\tbits = (bits << 16u) | (bits >> 16u);\n\t\t\t\tbits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n\t\t\t\tbits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n\t\t\t\tbits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n\t\t\t\tbits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n\t\t\t\treturn float(bits) * 2.3283064365386963e-10; // / 0x100000000\n\t\t\t}\n\n\t\t\t// Hammersley sequence\n\t\t\tvec2 hammersley(uint i, uint N) {\n\t\t\t\treturn vec2(float(i) / float(N), radicalInverse_VdC(i));\n\t\t\t}\n\n\t\t\t// GGX VNDF importance sampling (Eric Heitz 2018)\n\t\t\t// "Sampling the GGX Distribution of Visible Normals"\n\t\t\t// https://jcgt.org/published/0007/04/01/\n\t\t\tvec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {\n\t\t\t\tfloat alpha = roughness * roughness;\n\n\t\t\t\t// Section 3.2: Transform view direction to hemisphere configuration\n\t\t\t\tvec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));\n\n\t\t\t\t// Section 4.1: Orthonormal basis\n\t\t\t\tfloat lensq = Vh.x * Vh.x + Vh.y * Vh.y;\n\t\t\t\tvec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);\n\t\t\t\tvec3 T2 = cross(Vh, T1);\n\n\t\t\t\t// Section 4.2: Parameterization of projected area\n\t\t\t\tfloat r = sqrt(Xi.x);\n\t\t\t\tfloat phi = 2.0 * PI * Xi.y;\n\t\t\t\tfloat t1 = r * cos(phi);\n\t\t\t\tfloat t2 = r * sin(phi);\n\t\t\t\tfloat s = 0.5 * (1.0 + Vh.z);\n\t\t\t\tt2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;\n\n\t\t\t\t// Section 4.3: Reprojection onto hemisphere\n\t\t\t\tvec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;\n\n\t\t\t\t// Section 3.4: Transform back to ellipsoid configuration\n\t\t\t\treturn normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\tvec3 N = normalize(vOutputDirection);\n\t\t\t\tvec3 V = N; // Assume view direction equals normal for pre-filtering\n\n\t\t\t\tvec3 prefilteredColor = vec3(0.0);\n\t\t\t\tfloat totalWeight = 0.0;\n\n\t\t\t\t// For very low roughness, just sample the environment directly\n\t\t\t\tif (roughness < 0.001) {\n\t\t\t\t\tgl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Tangent space basis for VNDF sampling\n\t\t\t\tvec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n\t\t\t\tvec3 tangent = normalize(cross(up, N));\n\t\t\t\tvec3 bitangent = cross(N, tangent);\n\n\t\t\t\tfor(uint i = 0u; i < uint(GGX_SAMPLES); i++) {\n\t\t\t\t\tvec2 Xi = hammersley(i, uint(GGX_SAMPLES));\n\n\t\t\t\t\t// For PMREM, V = N, so in tangent space V is always (0, 0, 1)\n\t\t\t\t\tvec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);\n\n\t\t\t\t\t// Transform H back to world space\n\t\t\t\t\tvec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);\n\t\t\t\t\tvec3 L = normalize(2.0 * dot(V, H) * H - V);\n\n\t\t\t\t\tfloat NdotL = max(dot(N, L), 0.0);\n\n\t\t\t\t\tif(NdotL > 0.0) {\n\t\t\t\t\t\t// Sample environment at fixed mip level\n\t\t\t\t\t\t// VNDF importance sampling handles the distribution filtering\n\t\t\t\t\t\tvec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);\n\n\t\t\t\t\t\t// Weight by NdotL for the split-sum approximation\n\t\t\t\t\t\t// VNDF PDF naturally accounts for the visible microfacet distribution\n\t\t\t\t\t\tprefilteredColor += sampleColor * NdotL;\n\t\t\t\t\t\ttotalWeight += NdotL;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (totalWeight > 0.0) {\n\t\t\t\t\tprefilteredColor = prefilteredColor / totalWeight;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = vec4(prefilteredColor, 1.0);\n\t\t\t}\n\t\t',blending:0,depthTest:!1,depthWrite:!1});return r}(r,e,t)}return r}_compileMaterial(e){const t=new V1(new N1,e);this._renderer.compile(t,G5)}_sceneToCubeUV(e,t,n,r,i){const a=new e2(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(q5),l.toneMapping=0,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(r),l.clearDepth(),l.setRenderTarget(null)),null===this._backgroundBox&&(this._backgroundBox=new V1(new q1,new u1({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1})));const d=this._backgroundBox,h=d.material;let p=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,p=!0):(h.color.copy(q5),p=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(a.up.set(0,o[m],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+s[m],i.y,i.z)):1===t?(a.up.set(0,0,o[m]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+s[m],i.z)):(a.up.set(0,o[m],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+s[m]));const n=this._cubeSize;Z5(r,t*n,m>2?n:0,n,n),l.setRenderTarget(r),p&&l.render(d,a),l.render(e,a)}l.toneMapping=u,l.autoClear=c,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ZY||e.mapping===JY;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=e6()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=J5());const i=r?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=i;i.uniforms.envMap.value=e;const o=this._cubeSize;Z5(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,G5)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let i=1;i<r;i++)this._applyGGXFilter(e,i-1,i);t.autoClear=n}_applyGGXFilter(e,t,n){const r=this._renderer,i=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const s=a.uniforms,l=n/(this._lodMeshes.length-1),c=t/(this._lodMeshes.length-1),u=Math.sqrt(l*l-c*c)*(0+1.25*l),{_lodMax:d}=this,h=this._sizeLods[n],p=3*h*(n>d-4?n-d+4:0),f=4*(this._cubeSize-h);s.envMap.value=e.texture,s.roughness.value=u,s.mipInt.value=d-t,Z5(i,p,f,3*h,2*h),r.setRenderTarget(i),r.render(o,G5),s.envMap.value=i.texture,s.roughness.value=0,s.mipInt.value=d-n,Z5(e,p,f,3*h,2*h),r.setRenderTarget(e),r.render(o,G5)}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&tJ("blur direction must be either latitudinal or longitudinal!");const c=this._lodMeshes[r];c.material=l;const u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,p=i/h,f=isFinite(i)?1+Math.floor(3*p):V5;f>V5&&eJ(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let y=0;y<V5;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=h,u.mipInt.value=v-n;const A=this._sizeLods[r];Z5(t,3*A*(r>v-4?r-v+4:0),4*(this._cubeSize-A),3*A,2*A),s.setRenderTarget(t),s.render(c,G5)}}function Q5(e,t,n){const r=new BJ(e,t,n);return r.texture.mapping=nQ,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Z5(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function J5(){return new X1({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:t6(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function e6(){return new X1({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:t6(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function t6(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function n6(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,o=a===eQ||a===tQ,s=a===ZY||a===JY;if(o||s){let a=t.get(i);const l=void 0!==a?a.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new Y5(e)),a=o?n.fromEquirectangular(i,a):n.fromCubemap(i,a),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),a.texture;if(void 0!==a)return a.texture;{const l=i.image;return o&&l&&l.height>0||s&&l&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)?(null===n&&(n=new Y5(e)),a=o?n.fromEquirectangular(i):n.fromCubemap(i),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),i.addEventListener("dispose",r),a.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function r6(e){const t={};function n(n){if(void 0!==t[n])return t[n];const r=e.getExtension(n);return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&nJ("WebGLRenderer: "+e+" extension not supported."),t}}}function i6(e,t,n,r){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete i[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const s=new($Z(n)?b1:y1)(n,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const i in r)t.update(r[i],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function a6(e,t,n){let r,i,a;function o(t,o,s){0!==s&&(e.drawElementsInstanced(r,o,i,t*a,s),n.update(o,r,s))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,a=e.bytesPerElement},this.render=function(t,o){e.drawElements(r,o,i,t*a),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(e,a,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,a,0,i,e,0,o);let s=0;for(let t=0;t<o;t++)s+=a[t];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,s,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)o(e[t]/a,s[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(r,s,0,i,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=s[e]*c[e];n.update(t,r,1)}}}function o6(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:tJ("WebGLInfo: Unknown draw mode:",r)}}}}function s6(e,t,n){const r=new WeakMap,i=new DJ;return{update:function(a,o,s){const l=a.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,u=void 0!==c?c.length:0;let d=r.get(o);if(void 0===d||d.count!==u){void 0!==d&&d.texture.dispose();const h=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],v=o.morphAttributes.color||[];let A=0;!0===h&&(A=1),!0===p&&(A=2),!0===f&&(A=3);let y=o.attributes.position.count*A,b=1;y>t.maxTextureSize&&(b=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);const x=new Float32Array(y*b*4*u),_=new FJ(x,y,b,u);_.type=AQ,_.needsUpdate=!0;const w=4*A;for(let T=0;T<u;T++){const C=m[T],M=g[T],E=v[T],P=y*b*4*T;for(let N=0;N<C.count;N++){const k=N*w;!0===h&&(i.fromBufferAttribute(C,N),x[P+k+0]=i.x,x[P+k+1]=i.y,x[P+k+2]=i.z,x[P+k+3]=0),!0===p&&(i.fromBufferAttribute(M,N),x[P+k+4]=i.x,x[P+k+5]=i.y,x[P+k+6]=i.z,x[P+k+7]=0),!0===f&&(i.fromBufferAttribute(E,N),x[P+k+8]=i.x,x[P+k+9]=i.y,x[P+k+10]=i.z,x[P+k+11]=4===E.itemSize?i.w:1)}}function S(){_.dispose(),r.delete(o),o.removeEventListener("dispose",S)}d={count:u,texture:_,size:new mJ(y,b)},r.set(o,d),o.addEventListener("dispose",S)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)s.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let R=0;for(let O=0;O<l.length;O++)R+=l[O];const L=o.morphTargetsRelative?1:1-R;s.getUniforms().setValue(e,"morphTargetBaseInfluence",L),s.getUniforms().setValue(e,"morphTargetInfluences",l)}s.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),s.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function l6(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const s=r.render.frame,l=o.geometry,c=t.get(o,l);if(i.get(c)!==s&&(t.update(c),i.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),i.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),i.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;i.get(e)!==s&&(e.update(),i.set(e,s))}return c},dispose:function(){i=new WeakMap}}}const c6={[qY]:"LINEAR_TONE_MAPPING",[WY]:"REINHARD_TONE_MAPPING",[HY]:"CINEON_TONE_MAPPING",[$Y]:"ACES_FILMIC_TONE_MAPPING",[XY]:"AGX_TONE_MAPPING",[YY]:"NEUTRAL_TONE_MAPPING",[KY]:"CUSTOM_TONE_MAPPING"};function u6(e,t,n,r,i){const a=new BJ(t,n,{type:e,depthBuffer:r,stencilBuffer:i}),o=new BJ(t,n,{type:yQ,depthBuffer:!1,stencilBuffer:!1}),s=new N1;s.setAttribute("position",new _1([-1,3,0,-1,-1,0,3,-1,0],3)),s.setAttribute("uv",new _1([0,2,0,0,2,0],2));const l=new n4({uniforms:{tDiffuse:{value:null}},vertexShader:"\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 modelViewMatrix;\n\t\t\tuniform mat4 projectionMatrix;\n\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main() {\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}",fragmentShader:"\n\t\t\tprecision highp float;\n\n\t\t\tuniform sampler2D tDiffuse;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\t#include <tonemapping_pars_fragment>\n\t\t\t#include <colorspace_pars_fragment>\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t\t#ifdef LINEAR_TONE_MAPPING\n\t\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( AGX_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( CUSTOM_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef SRGB_TRANSFER\n\t\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\t\t\t\t#endif\n\t\t\t}",depthTest:!1,depthWrite:!1}),c=new V1(s,l),u=new G4(-1,1,1,-1,0,1);let d,h=null,p=null,f=!1,m=null,g=[],v=!1;this.setSize=function(e,t){a.setSize(e,t),o.setSize(e,t);for(let n=0;n<g.length;n++){const r=g[n];r.setSize&&r.setSize(e,t)}},this.setEffects=function(e){g=e,v=g.length>0&&!0===g[0].isRenderPass;const t=a.width,n=a.height;for(let r=0;r<g.length;r++){const e=g[r];e.setSize&&e.setSize(t,n)}},this.begin=function(e,t){if(f)return!1;if(0===e.toneMapping&&0===g.length)return!1;if(m=t,null!==t){const e=t.width,n=t.height;a.width===e&&a.height===n||this.setSize(e,n)}return!1===v&&e.setRenderTarget(a),d=e.toneMapping,e.toneMapping=0,!0},this.hasRenderPass=function(){return v},this.end=function(e,t){e.toneMapping=d,f=!0;let n=a,r=o;for(let i=0;i<g.length;i++){const a=g[i];if(!1!==a.enabled&&(a.render(e,r,n,t),!1!==a.needsSwap)){const e=n;n=r,r=e}}if(h!==e.outputColorSpace||p!==e.toneMapping){h=e.outputColorSpace,p=e.toneMapping,l.defines={},TJ.getTransfer(h)===NZ&&(l.defines.SRGB_TRANSFER="");const t=c6[p];t&&(l.defines[t]=""),l.needsUpdate=!0}l.uniforms.tDiffuse.value=n.texture,e.setRenderTarget(m),e.render(c,u),m=null,f=!1},this.isCompositing=function(){return f},this.dispose=function(){a.dispose(),o.dispose(),s.dispose(),l.dispose()}}const d6=new jJ,h6=new $2(1,1),p6=new FJ,f6=new zJ,m6=new r2,g6=[],v6=[],A6=new Float32Array(16),y6=new Float32Array(9),b6=new Float32Array(4);function x6(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=g6[i];if(void 0===a&&(a=new Float32Array(i),g6[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function _6(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function w6(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function S6(e,t){let n=v6[t];void 0===n&&(n=new Int32Array(t),v6[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function T6(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function C6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(_6(n,t))return;e.uniform2fv(this.addr,t),w6(n,t)}}function M6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(_6(n,t))return;e.uniform3fv(this.addr,t),w6(n,t)}}function E6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(_6(n,t))return;e.uniform4fv(this.addr,t),w6(n,t)}}function P6(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(_6(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),w6(n,t)}else{if(_6(n,r))return;b6.set(r),e.uniformMatrix2fv(this.addr,!1,b6),w6(n,r)}}function N6(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(_6(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),w6(n,t)}else{if(_6(n,r))return;y6.set(r),e.uniformMatrix3fv(this.addr,!1,y6),w6(n,r)}}function k6(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(_6(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),w6(n,t)}else{if(_6(n,r))return;A6.set(r),e.uniformMatrix4fv(this.addr,!1,A6),w6(n,r)}}function R6(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function L6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(_6(n,t))return;e.uniform2iv(this.addr,t),w6(n,t)}}function O6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(_6(n,t))return;e.uniform3iv(this.addr,t),w6(n,t)}}function j6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(_6(n,t))return;e.uniform4iv(this.addr,t),w6(n,t)}}function D6(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function I6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(_6(n,t))return;e.uniform2uiv(this.addr,t),w6(n,t)}}function B6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(_6(n,t))return;e.uniform3uiv(this.addr,t),w6(n,t)}}function F6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(_6(n,t))return;e.uniform4uiv(this.addr,t),w6(n,t)}}function z6(e,t,n){const r=this.cache,i=n.allocateTextureUnit();let a;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),this.type===e.SAMPLER_2D_SHADOW?(h6.compareFunction=n.isReversedDepthBuffer()?BZ:jZ,a=h6):a=d6,n.setTexture2D(t||a,i)}function U6(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||f6,i)}function V6(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||m6,i)}function G6(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||p6,i)}function q6(e,t){e.uniform1fv(this.addr,t)}function W6(e,t){const n=x6(t,this.size,2);e.uniform2fv(this.addr,n)}function H6(e,t){const n=x6(t,this.size,3);e.uniform3fv(this.addr,n)}function $6(e,t){const n=x6(t,this.size,4);e.uniform4fv(this.addr,n)}function K6(e,t){const n=x6(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function X6(e,t){const n=x6(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Y6(e,t){const n=x6(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Q6(e,t){e.uniform1iv(this.addr,t)}function Z6(e,t){e.uniform2iv(this.addr,t)}function J6(e,t){e.uniform3iv(this.addr,t)}function e8(e,t){e.uniform4iv(this.addr,t)}function t8(e,t){e.uniform1uiv(this.addr,t)}function n8(e,t){e.uniform2uiv(this.addr,t)}function r8(e,t){e.uniform3uiv(this.addr,t)}function i8(e,t){e.uniform4uiv(this.addr,t)}function a8(e,t,n){const r=this.cache,i=t.length,a=S6(n,i);let o;_6(r,a)||(e.uniform1iv(this.addr,a),w6(r,a)),o=this.type===e.SAMPLER_2D_SHADOW?h6:d6;for(let s=0;s!==i;++s)n.setTexture2D(t[s]||o,a[s])}function o8(e,t,n){const r=this.cache,i=t.length,a=S6(n,i);_6(r,a)||(e.uniform1iv(this.addr,a),w6(r,a));for(let o=0;o!==i;++o)n.setTexture3D(t[o]||f6,a[o])}function s8(e,t,n){const r=this.cache,i=t.length,a=S6(n,i);_6(r,a)||(e.uniform1iv(this.addr,a),w6(r,a));for(let o=0;o!==i;++o)n.setTextureCube(t[o]||m6,a[o])}function l8(e,t,n){const r=this.cache,i=t.length,a=S6(n,i);_6(r,a)||(e.uniform1iv(this.addr,a),w6(r,a));for(let o=0;o!==i;++o)n.setTexture2DArray(t[o]||p6,a[o])}class c8{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return T6;case 35664:return C6;case 35665:return M6;case 35666:return E6;case 35674:return P6;case 35675:return N6;case 35676:return k6;case 5124:case 35670:return R6;case 35667:case 35671:return L6;case 35668:case 35672:return O6;case 35669:case 35673:return j6;case 5125:return D6;case 36294:return I6;case 36295:return B6;case 36296:return F6;case 35678:case 36198:case 36298:case 36306:case 35682:return z6;case 35679:case 36299:case 36307:return U6;case 35680:case 36300:case 36308:case 36293:return V6;case 36289:case 36303:case 36311:case 36292:return G6}}(t.type)}}class u8{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return q6;case 35664:return W6;case 35665:return H6;case 35666:return $6;case 35674:return K6;case 35675:return X6;case 35676:return Y6;case 5124:case 35670:return Q6;case 35667:case 35671:return Z6;case 35668:case 35672:return J6;case 35669:case 35673:return e8;case 5125:return t8;case 36294:return n8;case 36295:return r8;case 36296:return i8;case 35678:case 36198:case 36298:case 36306:case 35682:return a8;case 35679:case 36299:case 36307:return o8;case 35680:case 36300:case 36308:case 36293:return s8;case 36289:case 36303:case 36311:case 36292:return l8}}(t.type)}}class d8{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const h8=/(\w+)(\])?(\[|\.)?/g;function p8(e,t){e.seq.push(t),e.map[t.id]=t}function f8(e,t,n){const r=e.name,i=r.length;for(h8.lastIndex=0;;){const a=h8.exec(r),o=h8.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===i){p8(n,void 0===c?new c8(s,e,t):new u8(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new d8(s),p8(n,e)),n=e}}}class m8{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<n;++a){const n=e.getActiveUniform(t,a);f8(n,e.getUniformLocation(t,n.name),this)}const r=[],i=[];for(const a of this.seq)a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_2D_ARRAY_SHADOW?r.push(a):i.push(a);r.length>0&&(this.seq=r.concat(i))}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function g8(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let v8=0;const A8=new bJ;function y8(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=(e.getShaderInfoLog(t)||"").trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push(`${e===t?">":" "} ${e}: ${n[o]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function b8(e,t){const n=function(e){TJ._getMatrix(A8,TJ.workingColorSpace,e);const t=`mat3( ${A8.elements.map(e=>e.toFixed(4))} )`;switch(TJ.getTransfer(e)){case PZ:return[t,"LinearTransferOETF"];case NZ:return[t,"sRGBTransferOETF"];default:return eJ("WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}const x8={[qY]:"Linear",[WY]:"Reinhard",[HY]:"Cineon",[$Y]:"ACESFilmic",[XY]:"AgX",[YY]:"Neutral",[KY]:"Custom"};function _8(e,t){const n=x8[t];return void 0===n?(eJ("WebGLProgram: Unsupported toneMapping:",t),"vec3 "+e+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const w8=new vJ;function S8(){TJ.getLuminanceCoefficients(w8);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${w8.x.toFixed(4)}, ${w8.y.toFixed(4)}, ${w8.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function T8(e){return""!==e}function C8(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function M8(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const E8=/^[ \t]*#include +<([\w\d./]+)>/gm;function P8(e){return e.replace(E8,k8)}const N8=new Map;function k8(e,t){let n=P5[t];if(void 0===n){const e=N8.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=P5[e],eJ('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return P8(n)}const R8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function L8(e){return e.replace(R8,O8)}function O8(e,t,n,r){let i="";for(let a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function j8(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}const D8={[uY]:"SHADOWMAP_TYPE_PCF",[dY]:"SHADOWMAP_TYPE_VSM"};const I8={[ZY]:"ENVMAP_TYPE_CUBE",[JY]:"ENVMAP_TYPE_CUBE",[nQ]:"ENVMAP_TYPE_CUBE_UV"};const B8={[JY]:"ENVMAP_MODE_REFRACTION"};const F8={[UY]:"ENVMAP_BLENDING_MULTIPLY",[VY]:"ENVMAP_BLENDING_MIX",[GY]:"ENVMAP_BLENDING_ADD"};function z8(e,t,n,r){const i=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(e){return D8[e.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}(n),c=function(e){return!1===e.envMap?"ENVMAP_TYPE_CUBE":I8[e.envMapMode]||"ENVMAP_TYPE_CUBE"}(n),u=function(e){return!1===e.envMap?"ENVMAP_MODE_REFLECTION":B8[e.envMapMode]||"ENVMAP_MODE_REFLECTION"}(n),d=function(e){return!1===e.envMap?"ENVMAP_BLENDING_NONE":F8[e.combine]||"ENVMAP_BLENDING_NONE"}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(T8).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),m=i.createProgram();let g,v,A=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(T8).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(T8).join("\n"),v.length>0&&(v+="\n")):(g=[j8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(T8).join("\n"),v=[j8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?P5.tonemapping_pars_fragment:"",0!==n.toneMapping?_8("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",P5.colorspace_pars_fragment,b8("linearToOutputTexel",n.outputColorSpace),S8(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(T8).join("\n")),o=P8(o),o=C8(o,n),o=M8(o,n),s=P8(s),s=C8(s,n),s=M8(s,n),o=L8(o),s=L8(s),!0!==n.isRawShaderMaterial&&(A="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===VZ?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===VZ?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=A+g+o,b=A+v+s,x=g8(i,i.VERTEX_SHADER,y),_=g8(i,i.FRAGMENT_SHADER,b);function w(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m)||"",r=i.getShaderInfoLog(x)||"",a=i.getShaderInfoLog(_)||"",o=n.trim(),s=r.trim(),l=a.trim();let c=!0,u=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(c=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(i,m,x,_);else{const e=y8(i,x,"vertex"),n=y8(i,_,"fragment");tJ("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+o+"\n"+e+"\n"+n)}else""!==o?eJ("WebGLProgram: Program Info Log:",o):""!==s&&""!==l||(u=!1);u&&(t.diagnostics={runnable:c,programLog:o,vertexShader:{log:s,prefix:g},fragmentShader:{log:l,prefix:v}})}i.deleteShader(x),i.deleteShader(_),S=new m8(i,m),T=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(i,m)}let S,T;i.attachShader(m,x),i.attachShader(m,_),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===S&&w(this),S},this.getAttributes=function(){return void 0===T&&w(this),T};let C=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===C&&(C=i.getProgramParameter(m,37297)),C},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=v8++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=_,this}let U8=0;class V8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new G8(e),t.set(e,n)),n}}class G8{constructor(e){this.id=U8++,this.code=e,this.usedTimes=0}}function q8(e,t,n,r,i,a,o){const s=new T0,l=new V8,c=new Set,u=[],d=new Map,h=i.logarithmicDepthBuffer;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,s,u,d,g){const v=d.fog,A=g.geometry,y=a.isMeshStandardMaterial?d.environment:null,b=(a.isMeshStandardMaterial?n:t).get(a.envMap||y),x=b&&b.mapping===nQ?b.image.height:null,_=f[a.type];null!==a.precision&&(p=i.getMaxPrecision(a.precision),p!==a.precision&&eJ("WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));const w=A.morphAttributes.position||A.morphAttributes.normal||A.morphAttributes.color,S=void 0!==w?w.length:0;let T,C,M,E,P=0;if(void 0!==A.morphAttributes.position&&(P=1),void 0!==A.morphAttributes.normal&&(P=2),void 0!==A.morphAttributes.color&&(P=3),_){const e=k5[_];T=e.vertexShader,C=e.fragmentShader}else T=a.vertexShader,C=a.fragmentShader,l.update(a),M=l.getVertexShaderID(a),E=l.getFragmentShaderID(a);const N=e.getRenderTarget(),k=e.state.buffers.depth.getReversed(),R=!0===g.isInstancedMesh,L=!0===g.isBatchedMesh,O=!!a.map,j=!!a.matcap,D=!!b,I=!!a.aoMap,B=!!a.lightMap,F=!!a.bumpMap,z=!!a.normalMap,U=!!a.displacementMap,V=!!a.emissiveMap,G=!!a.metalnessMap,q=!!a.roughnessMap,W=a.anisotropy>0,H=a.clearcoat>0,$=a.dispersion>0,K=a.iridescence>0,X=a.sheen>0,Y=a.transmission>0,Q=W&&!!a.anisotropyMap,Z=H&&!!a.clearcoatMap,J=H&&!!a.clearcoatNormalMap,ee=H&&!!a.clearcoatRoughnessMap,te=K&&!!a.iridescenceMap,ne=K&&!!a.iridescenceThicknessMap,re=X&&!!a.sheenColorMap,ie=X&&!!a.sheenRoughnessMap,ae=!!a.specularMap,oe=!!a.specularColorMap,se=!!a.specularIntensityMap,le=Y&&!!a.transmissionMap,ce=Y&&!!a.thicknessMap,ue=!!a.gradientMap,de=!!a.alphaMap,he=a.alphaTest>0,pe=!!a.alphaHash,fe=!!a.extensions;let me=0;a.toneMapped&&(null!==N&&!0!==N.isXRRenderTarget||(me=e.toneMapping));const ge={shaderID:_,shaderType:a.type,shaderName:a.name,vertexShader:T,fragmentShader:C,defines:a.defines,customVertexShaderID:M,customFragmentShaderID:E,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:L,batchingColor:L&&null!==g._colorsTexture,instancing:R,instancingColor:R&&null!==g.instanceColor,instancingMorph:R&&null!==g.morphTexture,outputColorSpace:null===N?e.outputColorSpace:!0===N.isXRRenderTarget?N.texture.colorSpace:EZ,alphaToCoverage:!!a.alphaToCoverage,map:O,matcap:j,envMap:D,envMapMode:D&&b.mapping,envMapCubeUVHeight:x,aoMap:I,lightMap:B,bumpMap:F,normalMap:z,displacementMap:U,emissiveMap:V,normalMapObjectSpace:z&&1===a.normalMapType,normalMapTangentSpace:z&&0===a.normalMapType,metalnessMap:G,roughnessMap:q,anisotropy:W,anisotropyMap:Q,clearcoat:H,clearcoatMap:Z,clearcoatNormalMap:J,clearcoatRoughnessMap:ee,dispersion:$,iridescence:K,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:X,sheenColorMap:re,sheenRoughnessMap:ie,specularMap:ae,specularColorMap:oe,specularIntensityMap:se,transmission:Y,transmissionMap:le,thicknessMap:ce,gradientMap:ue,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:de,alphaTest:he,alphaHash:pe,combine:a.combine,mapUv:O&&m(a.map.channel),aoMapUv:I&&m(a.aoMap.channel),lightMapUv:B&&m(a.lightMap.channel),bumpMapUv:F&&m(a.bumpMap.channel),normalMapUv:z&&m(a.normalMap.channel),displacementMapUv:U&&m(a.displacementMap.channel),emissiveMapUv:V&&m(a.emissiveMap.channel),metalnessMapUv:G&&m(a.metalnessMap.channel),roughnessMapUv:q&&m(a.roughnessMap.channel),anisotropyMapUv:Q&&m(a.anisotropyMap.channel),clearcoatMapUv:Z&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:J&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(a.sheenRoughnessMap.channel),specularMapUv:ae&&m(a.specularMap.channel),specularColorMapUv:oe&&m(a.specularColorMap.channel),specularIntensityMapUv:se&&m(a.specularIntensityMap.channel),transmissionMapUv:le&&m(a.transmissionMap.channel),thicknessMapUv:ce&&m(a.thicknessMap.channel),alphaMapUv:de&&m(a.alphaMap.channel),vertexTangents:!!A.attributes.tangent&&(z||W),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!A.attributes.color&&4===A.attributes.color.itemSize,pointsUvs:!0===g.isPoints&&!!A.attributes.uv&&(O||de),fog:!!v,useFog:!0===a.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===a.flatShading&&!1===a.wireframe,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reversedDepthBuffer:k,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==A.morphAttributes.position,morphNormals:void 0!==A.morphAttributes.normal,morphColors:void 0!==A.morphAttributes.color,morphTargetsCount:S,morphTextureStride:P,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:O&&!0===a.map.isVideoTexture&&TJ.getTransfer(a.map.colorSpace)===NZ,decodeVideoTextureEmissive:V&&!0===a.emissiveMap.isVideoTexture&&TJ.getTransfer(a.emissiveMap.colorSpace)===NZ,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:fe&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(fe&&!0===a.extensions.multiDraw||L)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ge.vertexUv1s=c.has(1),ge.vertexUv2s=c.has(2),ge.vertexUv3s=c.has(3),c.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.instancing&&s.enable(0);t.instancingColor&&s.enable(1);t.instancingMorph&&s.enable(2);t.matcap&&s.enable(3);t.envMap&&s.enable(4);t.normalMapObjectSpace&&s.enable(5);t.normalMapTangentSpace&&s.enable(6);t.clearcoat&&s.enable(7);t.iridescence&&s.enable(8);t.alphaTest&&s.enable(9);t.vertexColors&&s.enable(10);t.vertexAlphas&&s.enable(11);t.vertexUv1s&&s.enable(12);t.vertexUv2s&&s.enable(13);t.vertexUv3s&&s.enable(14);t.vertexTangents&&s.enable(15);t.anisotropy&&s.enable(16);t.alphaHash&&s.enable(17);t.batching&&s.enable(18);t.dispersion&&s.enable(19);t.batchingColor&&s.enable(20);t.gradientMap&&s.enable(21);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.reversedDepthBuffer&&s.enable(4);t.skinning&&s.enable(5);t.morphTargets&&s.enable(6);t.morphNormals&&s.enable(7);t.morphColors&&s.enable(8);t.premultipliedAlpha&&s.enable(9);t.shadowMapEnabled&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);t.decodeVideoTexture&&s.enable(19);t.decodeVideoTextureEmissive&&s.enable(20);t.alphaToCoverage&&s.enable(21);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=k5[t];n=K1.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r=d.get(n);return void 0!==r?++r.usedTimes:(r=new z8(e,n,t,a),u.push(r),d.set(n,r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),d.delete(e.cacheKey),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function W8(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function H8(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function $8(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function K8(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,o,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?r.push(u):!0===o.transparent?i.push(u):n.push(u)},unshift:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?r.unshift(u):!0===o.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||H8),r.length>1&&r.sort(t||$8),i.length>1&&i.sort(t||$8)}}}function X8(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new K8,e.set(t,[i])):n>=r.length?(i=new K8,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function Y8(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new vJ,color:new o1};break;case"SpotLight":n={position:new vJ,direction:new vJ,color:new o1,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new vJ,color:new o1,distance:0,decay:0};break;case"HemisphereLight":n={direction:new vJ,skyColor:new o1,groundColor:new o1};break;case"RectAreaLight":n={color:new o1,position:new vJ,halfWidth:new vJ,halfHeight:new vJ}}return e[t.id]=n,n}}}let Q8=0;function Z8(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function J8(e){const t=new Y8,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mJ};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mJ,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let s=0;s<9;s++)r.probe.push(new vJ);const i=new vJ,a=new f0,o=new f0;return{setup:function(i){let a=0,o=0,s=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0;i.sort(Z8);for(let e=0,b=i.length;e<b;e++){const y=i[e],b=y.color,x=y.intensity,_=y.distance;let w=null;if(y.shadow&&y.shadow.map&&(w=y.shadow.map.texture.format===RQ?y.shadow.map.texture:y.shadow.map.depthTexture||y.shadow.map.texture),y.isAmbientLight)a+=b.r*x,o+=b.g*x,s+=b.b*x;else if(y.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(y.sh.coefficients[e],x);A++}else if(y.isDirectionalLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=w,r.directionalShadowMatrix[l]=y.shadow.matrix,p++}r.directional[l]=e,l++}else if(y.isSpotLight){const e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(b).multiplyScalar(x),e.distance=_,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,r.spot[u]=e;const i=y.shadow;if(y.map&&(r.spotLightMap[g]=y.map,g++,i.updateMatrices(y),y.castShadow&&v++),r.spotLightMatrix[u]=i.matrix,y.castShadow){const e=n.get(y);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=w,m++}u++}else if(y.isRectAreaLight){const e=t.get(y);e.color.copy(b).multiplyScalar(x),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),r.rectArea[d]=e,d++}else if(y.isPointLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[c]=t,r.pointShadowMap[c]=w,r.pointShadowMatrix[c]=y.shadow.matrix,f++}r.point[c]=e,c++}else if(y.isHemisphereLight){const e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(x),e.groundColor.copy(y.groundColor).multiplyScalar(x),r.hemi[h]=e,h++}}d>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=N5.LTC_FLOAT_1,r.rectAreaLTC2=N5.LTC_FLOAT_2):(r.rectAreaLTC1=N5.LTC_HALF_1,r.rectAreaLTC2=N5.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=s;const y=r.hash;y.directionalLength===l&&y.pointLength===c&&y.spotLength===u&&y.rectAreaLength===d&&y.hemiLength===h&&y.numDirectionalShadows===p&&y.numPointShadows===f&&y.numSpotShadows===m&&y.numSpotMaps===g&&y.numLightProbes===A||(r.directional.length=l,r.spot.length=u,r.rectArea.length=d,r.point.length=c,r.hemi.length=h,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=A,y.directionalLength=l,y.pointLength=c,y.spotLength=u,y.rectAreaLength=d,y.hemiLength=h,y.numDirectionalShadows=p,y.numPointShadows=f,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=A,r.version=Q8++)},setupView:function(e,t){let n=0,s=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let h=0,p=e.length;h<p;h++){const t=e[h];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),o.identity(),a.copy(t.matrixWorld),a.premultiply(d),o.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(t.isPointLight){const e=r.point[s];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),s++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),u++}}},state:r}}function e7(e){const t=new J8(e),n=[],r=[];const i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function t7(e){let t=new WeakMap;return{get:function(n,r=0){const i=t.get(n);let a;return void 0===i?(a=new e7(e),t.set(n,[a])):r>=i.length?(a=new e7(e),i.push(a)):a=i[r],a},dispose:function(){t=new WeakMap}}}const n7=[new vJ(1,0,0),new vJ(-1,0,0),new vJ(0,1,0),new vJ(0,-1,0),new vJ(0,0,1),new vJ(0,0,-1)],r7=[new vJ(0,-1,0),new vJ(0,-1,0),new vJ(0,0,1),new vJ(0,0,-1),new vJ(0,-1,0),new vJ(0,-1,0)],i7=new f0,a7=new vJ,o7=new vJ;function s7(e,t,n){let r=new _2;const i=new mJ,a=new mJ,o=new DJ,s=new c4,l=new u4,c={},u=n.maxTextureSize,d={[hY]:1,[pY]:0,[fY]:2},h=new X1({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mJ},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );\n\tgl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new N1;f.setAttribute("position",new A1(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new V1(f,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function A(n,r){const a=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new BJ(i.x,i.y,{format:RQ,type:yQ})),h.uniforms.shadow_pass.value=n.map.depthTexture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,h,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,p,m,null)}function y(t,n,r,i){let a=null;const o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===r.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=a.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",x)),a=i}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=r}return a}function b(n,i,a,o,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],d=l[u.materialIndex];if(d&&d.visible){const t=y(n,d,o,s);n.onBeforeShadow(e,n,i,a,r,t,u),e.renderBufferDirect(a,null,r,t,n,u),n.onAfterShadow(e,n,i,a,r,t,u)}}}else if(l.visible){const t=y(n,l,o,s);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],i,a,o,s)}function x(e){e.target.removeEventListener("dispose",x);for(const t in c){const n=c[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;2===t.type&&(eJ("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),t.type=1);const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),!0===h.buffers.depth.getReversed()?h.buffers.color.setClear(0,0,0,0):h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=v!==this.type;p&&n.traverse(function(e){e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.needsUpdate=!0):e.material.needsUpdate=!0)});for(let f=0,m=t.length;f<m;f++){const l=t[f],c=l.shadow;if(void 0===c){eJ("WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);const d=c.getFrameExtents();if(i.multiply(d),a.copy(c.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/d.x),i.x=a.x*d.x,c.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/d.y),i.y=a.y*d.y,c.mapSize.y=a.y)),null===c.map||!0===p){if(null!==c.map&&(null!==c.map.depthTexture&&(c.map.depthTexture.dispose(),c.map.depthTexture=null),c.map.dispose()),3===this.type){if(l.isPointLight){eJ("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}c.map=new BJ(i.x,i.y,{format:RQ,type:yQ,minFilter:cQ,magFilter:cQ,generateMipmaps:!1}),c.map.texture.name=l.name+".shadowMap",c.map.depthTexture=new $2(i.x,i.y,AQ),c.map.depthTexture.name=l.name+".shadowMapDepth",c.map.depthTexture.format=EQ,c.map.depthTexture.compareFunction=null,c.map.depthTexture.minFilter=oQ,c.map.depthTexture.magFilter=oQ}else{l.isPointLight?(c.map=new i2(i.x),c.map.depthTexture=new K2(i.x,vQ)):(c.map=new BJ(i.x,i.y),c.map.depthTexture=new $2(i.x,i.y,vQ)),c.map.depthTexture.name=l.name+".shadowMap",c.map.depthTexture.format=EQ;const t=e.state.buffers.depth.getReversed();1===this.type?(c.map.depthTexture.compareFunction=t?BZ:jZ,c.map.depthTexture.minFilter=cQ,c.map.depthTexture.magFilter=cQ):(c.map.depthTexture.compareFunction=null,c.map.depthTexture.minFilter=oQ,c.map.depthTexture.magFilter=oQ)}c.camera.updateProjectionMatrix()}const m=c.map.isWebGLCubeRenderTarget?6:1;for(let t=0;t<m;t++){if(c.map.isWebGLCubeRenderTarget)e.setRenderTarget(c.map,t),e.clear();else{0===t&&(e.setRenderTarget(c.map),e.clear());const n=c.getViewport(t);o.set(a.x*n.x,a.y*n.y,a.x*n.z,a.y*n.w),h.viewport(o)}if(l.isPointLight){const e=c.camera,n=c.matrix,r=l.distance||e.far;r!==e.far&&(e.far=r,e.updateProjectionMatrix()),a7.setFromMatrixPosition(l.matrixWorld),e.position.copy(a7),o7.copy(e.position),o7.add(n7[t]),e.up.copy(r7[t]),e.lookAt(o7),e.updateMatrixWorld(),n.makeTranslation(-a7.x,-a7.y,-a7.z),i7.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),c._frustum.setFromProjectionMatrix(i7,e.coordinateSystem,e.reversedDepth)}else c.updateMatrices(l);r=c.getFrustum(),b(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&A(c,s),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}const l7={[LY]:1,[jY]:6,[IY]:7,[DY]:5,[OY]:0,[FY]:2,[zY]:4,[BY]:3};function c7(e,t){const n=new function(){let t=!1;const n=new DJ;let r=null;const i=new DJ(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,a=null,o=null;return{setReversed:function(e){if(r!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),r=e;const i=o;o=null,this.setClear(i)}},getReversed:function(){return r},setTest:function(t){t?z(e.DEPTH_TEST):U(e.DEPTH_TEST)},setMask:function(t){i===t||n||(e.depthMask(t),i=t)},setFunc:function(t){if(r&&(t=l7[t]),a!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}a=t}},setLocked:function(e){n=e},setClear:function(t){o!==t&&(r&&(t=1-t),e.clearDepth(t),o=t)},reset:function(){n=!1,i=null,a=null,o=null,r=!1}}},i=new function(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):U(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}},a=new WeakMap,o=new WeakMap;let s={},l={},c=new WeakMap,u=[],d=null,h=!1,p=null,f=null,m=null,g=null,v=null,A=null,y=null,b=new o1(0,0,0),x=0,_=!1,w=null,S=null,T=null,C=null,M=null;const E=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let P=!1,N=0;const k=e.getParameter(e.VERSION);-1!==k.indexOf("WebGL")?(N=parseFloat(/^WebGL (\d)/.exec(k)[1]),P=N>=1):-1!==k.indexOf("OpenGL ES")&&(N=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),P=N>=2);let R=null,L={};const O=e.getParameter(e.SCISSOR_BOX),j=e.getParameter(e.VIEWPORT),D=(new DJ).fromArray(O),I=(new DJ).fromArray(j);function B(t,n,r,i){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<r;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const F={};function z(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function U(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}F[e.TEXTURE_2D]=B(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=B(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[e.TEXTURE_2D_ARRAY]=B(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),F[e.TEXTURE_3D]=B(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),z(e.DEPTH_TEST),r.setFunc(3),W(!1),H(1),z(e.CULL_FACE),q(0);const V={[mY]:e.FUNC_ADD,[gY]:e.FUNC_SUBTRACT,[vY]:e.FUNC_REVERSE_SUBTRACT};V[103]=e.MIN,V[104]=e.MAX;const G={[AY]:e.ZERO,[yY]:e.ONE,[bY]:e.SRC_COLOR,[_Y]:e.SRC_ALPHA,[EY]:e.SRC_ALPHA_SATURATE,[CY]:e.DST_COLOR,[SY]:e.DST_ALPHA,[xY]:e.ONE_MINUS_SRC_COLOR,[wY]:e.ONE_MINUS_SRC_ALPHA,[MY]:e.ONE_MINUS_DST_COLOR,[TY]:e.ONE_MINUS_DST_ALPHA,[PY]:e.CONSTANT_COLOR,[NY]:e.ONE_MINUS_CONSTANT_COLOR,[kY]:e.CONSTANT_ALPHA,[RY]:e.ONE_MINUS_CONSTANT_ALPHA};function q(t,n,r,i,a,o,s,l,c,u){if(0!==t){if(!1===h&&(z(e.BLEND),h=!0),5===t)a=a||n,o=o||r,s=s||i,n===f&&a===v||(e.blendEquationSeparate(V[n],V[a]),f=n,v=a),r===m&&i===g&&o===A&&s===y||(e.blendFuncSeparate(G[r],G[i],G[o],G[s]),m=r,g=i,A=o,y=s),!1!==l.equals(b)&&c===x||(e.blendColor(l.r,l.g,l.b,c),b.copy(l),x=c),p=t,_=!1;else if(t!==p||u!==_){if(f===mY&&v===mY||(e.blendEquation(e.FUNC_ADD),f=mY,v=mY),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:tJ("WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case 3:tJ("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:tJ("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:tJ("WebGLState: Invalid blending: ",t)}m=null,g=null,A=null,y=null,b.set(0,0,0),x=0,p=t,_=u}}else!0===h&&(U(e.BLEND),h=!1)}function W(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function H(t){0!==t?(z(e.CULL_FACE),t!==S&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):U(e.CULL_FACE),S=t}function $(t,n,r){t?(z(e.POLYGON_OFFSET_FILL),C===n&&M===r||(e.polygonOffset(n,r),C=n,M=r)):U(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:z,disable:U,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=u,i=!1;if(t){r=c.get(n),void 0===r&&(r=[],c.set(n,r));const a=t.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=a.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=a.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:q,setMaterial:function(t,a){2===t.side?U(e.CULL_FACE):z(e.CULL_FACE);let o=1===t.side;a&&(o=!o),W(o),1===t.blending&&!1===t.transparent?q(0):q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const s=t.stencilWrite;i.setTest(s),s&&(i.setMask(t.stencilWriteMask),i.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),i.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),$(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):U(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:H,setLineWidth:function(t){t!==T&&(P&&e.lineWidth(t),T=t)},setPolygonOffset:$,setScissorTest:function(t){t?z(e.SCISSOR_TEST):U(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+E-1),R!==t&&(e.activeTexture(t),R=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===R?e.TEXTURE0+E-1:R);let i=L[r];void 0===i&&(i={type:void 0,texture:void 0},L[r]=i),i.type===t&&i.texture===n||(R!==r&&(e.activeTexture(r),R=r),e.bindTexture(t,n||F[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=L[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(or){tJ("WebGLState:",or)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(or){tJ("WebGLState:",or)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(or){tJ("WebGLState:",or)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(or){tJ("WebGLState:",or)}},updateUBOMapping:function(t,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=o.get(n).get(t);a.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),a.set(n,r))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(or){tJ("WebGLState:",or)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(or){tJ("WebGLState:",or)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(or){tJ("WebGLState:",or)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(or){tJ("WebGLState:",or)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(or){tJ("WebGLState:",or)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(or){tJ("WebGLState:",or)}},scissor:function(t){!1===D.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),D.copy(t))},viewport:function(t){!1===I.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),I.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},R=null,L={},l={},c=new WeakMap,u=[],d=null,h=!1,p=null,f=null,m=null,g=null,v=null,A=null,y=null,b=new o1(0,0,0),x=0,_=!1,w=null,S=null,T=null,C=null,M=null,D.set(0,0,e.canvas.width,e.canvas.height),I.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),i.reset()}}}function u7(e,t,n,r,i,a,o){const s=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new mJ,u=new WeakMap;let d;const h=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(q){}function f(e,t){return p?new OffscreenCanvas(e,t):XZ("canvas")}function m(e,t,n){let r=1;const i=G(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*i.width),a=Math.floor(r*i.height);void 0===d&&(d=f(n,a));const o=t?f(n,a):d;o.width=n,o.height=a;return o.getContext("2d").drawImage(e,0,0,n,a),eJ("WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+a+")."),o}return"data"in e&&eJ("WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function A(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function y(n,r,i,a,o=!1){if(null!==n){if(void 0!==e[n])return e[n];eJ("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;if(r===e.RED&&(i===e.FLOAT&&(s=e.R32F),i===e.HALF_FLOAT&&(s=e.R16F),i===e.UNSIGNED_BYTE&&(s=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.R8UI),i===e.UNSIGNED_SHORT&&(s=e.R16UI),i===e.UNSIGNED_INT&&(s=e.R32UI),i===e.BYTE&&(s=e.R8I),i===e.SHORT&&(s=e.R16I),i===e.INT&&(s=e.R32I)),r===e.RG&&(i===e.FLOAT&&(s=e.RG32F),i===e.HALF_FLOAT&&(s=e.RG16F),i===e.UNSIGNED_BYTE&&(s=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RG8UI),i===e.UNSIGNED_SHORT&&(s=e.RG16UI),i===e.UNSIGNED_INT&&(s=e.RG32UI),i===e.BYTE&&(s=e.RG8I),i===e.SHORT&&(s=e.RG16I),i===e.INT&&(s=e.RG32I)),r===e.RGB_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RGB8UI),i===e.UNSIGNED_SHORT&&(s=e.RGB16UI),i===e.UNSIGNED_INT&&(s=e.RGB32UI),i===e.BYTE&&(s=e.RGB8I),i===e.SHORT&&(s=e.RGB16I),i===e.INT&&(s=e.RGB32I)),r===e.RGBA_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RGBA8UI),i===e.UNSIGNED_SHORT&&(s=e.RGBA16UI),i===e.UNSIGNED_INT&&(s=e.RGBA32UI),i===e.BYTE&&(s=e.RGBA8I),i===e.SHORT&&(s=e.RGBA16I),i===e.INT&&(s=e.RGBA32I)),r===e.RGB&&(i===e.UNSIGNED_INT_5_9_9_9_REV&&(s=e.RGB9_E5),i===e.UNSIGNED_INT_10F_11F_11F_REV&&(s=e.R11F_G11F_B10F)),r===e.RGBA){const t=o?PZ:TJ.getTransfer(a);i===e.FLOAT&&(s=e.RGBA32F),i===e.HALF_FLOAT&&(s=e.RGBA16F),i===e.UNSIGNED_BYTE&&(s=t===NZ?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)}return s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function b(t,n){let r;return t?null===n||n===vQ||n===_Q?r=e.DEPTH24_STENCIL8:n===AQ?r=e.DEPTH32F_STENCIL8:n===mQ&&(r=e.DEPTH24_STENCIL8,eJ("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===vQ||n===_Q?r=e.DEPTH_COMPONENT24:n===AQ?r=e.DEPTH_COMPONENT32F:n===mQ&&(r=e.DEPTH_COMPONENT16),r}function x(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==oQ&&e.minFilter!==cQ?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function _(e){const t=e.target;t.removeEventListener("dispose",_),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=h.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&S(e),0===Object.keys(i).length&&h.delete(n)}r.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=r.get(t);t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let a=0,s=i.length;a<s;a++){const t=r.get(i[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(i[a])}r.remove(t)}(n)}function S(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete h.get(i)[n.__cacheKey],o.memory.textures--}let T=0;function C(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)eJ("WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void L(a,t,i);eJ("WebGLRenderer: Texture marked for update but image is incomplete")}}else t.isExternalTexture&&(a.__webglTexture=t.sourceTexture?t.sourceTexture:null);n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const M={[rQ]:e.REPEAT,[iQ]:e.CLAMP_TO_EDGE,[aQ]:e.MIRRORED_REPEAT},E={[oQ]:e.NEAREST,[sQ]:e.NEAREST_MIPMAP_NEAREST,[lQ]:e.NEAREST_MIPMAP_LINEAR,[cQ]:e.LINEAR,[uQ]:e.LINEAR_MIPMAP_NEAREST,[dQ]:e.LINEAR_MIPMAP_LINEAR},P={[RZ]:e.NEVER,[FZ]:e.ALWAYS,[LZ]:e.LESS,[jZ]:e.LEQUAL,[OZ]:e.EQUAL,[BZ]:e.GEQUAL,[DZ]:e.GREATER,[IZ]:e.NOTEQUAL};function N(n,a){if(a.type!==AQ||!1!==t.has("OES_texture_float_linear")||a.magFilter!==cQ&&a.magFilter!==uQ&&a.magFilter!==lQ&&a.magFilter!==dQ&&a.minFilter!==cQ&&a.minFilter!==uQ&&a.minFilter!==lQ&&a.minFilter!==dQ||eJ("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,M[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,M[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,M[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,E[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,E[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,P[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===oQ)return;if(a.minFilter!==lQ&&a.minFilter!==dQ)return;if(a.type===AQ&&!1===t.has("OES_texture_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){const o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function k(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_));const i=n.source;let a=h.get(i);void 0===a&&(a={},h.set(i,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&S(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function R(e,t,n){return Math.floor(Math.floor(e/n)/t)}function L(t,o,s){let l=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=e.TEXTURE_3D);const c=k(t,o),u=o.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+s);const d=r.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+s);const t=TJ.getPrimaries(TJ.workingColorSpace),r=o.colorSpace===CZ?null:TJ.getPrimaries(o.colorSpace),h=o.colorSpace===CZ||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);let p=m(o.image,!1,i.maxTextureSize);p=V(o,p);const f=a.convert(o.format,o.colorSpace),A=a.convert(o.type);let _,w=y(o.internalFormat,f,A,o.colorSpace,o.isVideoTexture);N(l,o);const S=o.mipmaps,T=!0!==o.isVideoTexture,C=void 0===d.__version||!0===c,M=u.dataReady,E=x(o,p);if(o.isDepthTexture)w=b(o.format===PQ,o.type),C&&(T?n.texStorage2D(e.TEXTURE_2D,1,w,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,w,p.width,p.height,0,f,A,null));else if(o.isDataTexture)if(S.length>0){T&&C&&n.texStorage2D(e.TEXTURE_2D,E,w,S[0].width,S[0].height);for(let t=0,r=S.length;t<r;t++)_=S[t],T?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,_.width,_.height,f,A,_.data):n.texImage2D(e.TEXTURE_2D,t,w,_.width,_.height,0,f,A,_.data);o.generateMipmaps=!1}else T?(C&&n.texStorage2D(e.TEXTURE_2D,E,w,p.width,p.height),M&&function(t,r,i,a){const o=t.updateRanges;if(0===o.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,i,a,r.data);else{o.sort((e,t)=>e.start-t.start);let s=0;for(let e=1;e<o.length;e++){const t=o[s],n=o[e],i=t.start+t.count,a=R(n.start,r.width,4),l=R(t.start,r.width,4);n.start<=i+1&&a===l&&R(n.start+n.count-1,r.width,4)===a?t.count=Math.max(t.count,n.start+n.count-t.start):(++s,o[s]=n)}o.length=s+1;const l=e.getParameter(e.UNPACK_ROW_LENGTH),c=e.getParameter(e.UNPACK_SKIP_PIXELS),u=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width);for(let t=0,d=o.length;t<d;t++){const s=o[t],l=Math.floor(s.start/4),c=Math.ceil(s.count/4),u=l%r.width,d=Math.floor(l/r.width),h=c,p=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,u),e.pixelStorei(e.UNPACK_SKIP_ROWS,d),n.texSubImage2D(e.TEXTURE_2D,0,u,d,h,p,i,a,r.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,u)}}(o,p,f,A)):n.texImage2D(e.TEXTURE_2D,0,w,p.width,p.height,0,f,A,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){T&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,E,w,S[0].width,S[0].height,p.depth);for(let t=0,r=S.length;t<r;t++)if(_=S[t],o.format!==MQ)if(null!==f)if(T){if(M)if(o.layerUpdates.size>0){const r=x5(_.width,_.height,o.format,o.type);for(const i of o.layerUpdates){const a=_.data.subarray(i*r/_.data.BYTES_PER_ELEMENT,(i+1)*r/_.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,_.width,_.height,1,f,a)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,_.width,_.height,p.depth,f,_.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,w,_.width,_.height,p.depth,0,_.data,0,0);else eJ("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?M&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,_.width,_.height,p.depth,f,A,_.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,w,_.width,_.height,p.depth,0,f,A,_.data)}else{T&&C&&n.texStorage2D(e.TEXTURE_2D,E,w,S[0].width,S[0].height);for(let t=0,r=S.length;t<r;t++)_=S[t],o.format!==MQ?null!==f?T?M&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,_.width,_.height,f,_.data):n.compressedTexImage2D(e.TEXTURE_2D,t,w,_.width,_.height,0,_.data):eJ("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,_.width,_.height,f,A,_.data):n.texImage2D(e.TEXTURE_2D,t,w,_.width,_.height,0,f,A,_.data)}else if(o.isDataArrayTexture)if(T){if(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,E,w,p.width,p.height,p.depth),M)if(o.layerUpdates.size>0){const t=x5(p.width,p.height,o.format,o.type);for(const r of o.layerUpdates){const i=p.data.subarray(r*t/p.data.BYTES_PER_ELEMENT,(r+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,A,i)}o.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,A,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,w,p.width,p.height,p.depth,0,f,A,p.data);else if(o.isData3DTexture)T?(C&&n.texStorage3D(e.TEXTURE_3D,E,w,p.width,p.height,p.depth),M&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,A,p.data)):n.texImage3D(e.TEXTURE_3D,0,w,p.width,p.height,p.depth,0,f,A,p.data);else if(o.isFramebufferTexture){if(C)if(T)n.texStorage2D(e.TEXTURE_2D,E,w,p.width,p.height);else{let t=p.width,r=p.height;for(let i=0;i<E;i++)n.texImage2D(e.TEXTURE_2D,i,w,t,r,0,f,A,null),t>>=1,r>>=1}}else if(S.length>0){if(T&&C){const t=G(S[0]);n.texStorage2D(e.TEXTURE_2D,E,w,t.width,t.height)}for(let t=0,r=S.length;t<r;t++)_=S[t],T?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,A,_):n.texImage2D(e.TEXTURE_2D,t,w,f,A,_);o.generateMipmaps=!1}else if(T){if(C){const t=G(p);n.texStorage2D(e.TEXTURE_2D,E,w,t.width,t.height)}M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,A,p)}else n.texImage2D(e.TEXTURE_2D,0,w,f,A,p);g(o)&&v(l),d.__version=u.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function O(t,i,o,l,c,u){const d=a.convert(o.format,o.colorSpace),h=a.convert(o.type),p=y(o.internalFormat,d,h,o.colorSpace),f=r.get(i),m=r.get(o);if(m.__renderTarget=i,!f.__hasExternalTextures){const t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,r,i.depth,0,d,h,null):n.texImage2D(c,u,p,t,r,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),U(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,m.__webglTexture,0,z(i)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function j(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const i=n.depthTexture,a=i&&i.isDepthTexture?i.type:null,o=b(n.stencilBuffer,a),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;U(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,z(n),o,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,z(n),o,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,o,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const o=t[i],l=a.convert(o.format,o.colorSpace),c=a.convert(o.type),u=y(o.internalFormat,l,c,o.colorSpace);U(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,z(n),u,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,z(n),u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t,i,o){const l=!0===i.isWebGLCubeRenderTarget;if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const c=r.get(i.depthTexture);if(c.__renderTarget=i,c.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),l){if(void 0===c.__webglInit&&(c.__webglInit=!0,i.depthTexture.addEventListener("dispose",_)),void 0===c.__webglTexture){c.__webglTexture=e.createTexture(),n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),N(e.TEXTURE_CUBE_MAP,i.depthTexture);const t=a.convert(i.depthTexture.format),r=a.convert(i.depthTexture.type);let o;i.depthTexture.format===EQ?o=e.DEPTH_COMPONENT24:i.depthTexture.format===PQ&&(o=e.DEPTH24_STENCIL8);for(let n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,o,i.width,i.height,0,t,r,null)}}else C(i.depthTexture,0);const u=c.__webglTexture,d=z(i),h=l?e.TEXTURE_CUBE_MAP_POSITIVE_X+o:e.TEXTURE_2D,p=i.depthTexture.format===PQ?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(i.depthTexture.format===EQ)U(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,p,h,u,0,d):e.framebufferTexture2D(e.FRAMEBUFFER,p,h,u,0);else{if(i.depthTexture.format!==PQ)throw new Error("Unknown depthTexture format");U(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,p,h,u,0,d):e.framebufferTexture2D(e.FRAMEBUFFER,p,h,u,0)}}function I(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),e){const t=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),i.__depthDisposeCallback=t}i.__boundDepthTexture=e}if(t.depthTexture&&!i.__autoAllocateDepthBuffer)if(a)for(let e=0;e<6;e++)D(i.__webglFramebuffer[e],t,e);else{const e=t.texture.mipmaps;e&&e.length>0?D(i.__webglFramebuffer[0],t,0):D(i.__webglFramebuffer,t,0)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=e.createRenderbuffer(),j(i.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=i.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,a)}}else{const r=t.texture.mipmaps;if(r&&r.length>0?n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=e.createRenderbuffer(),j(i.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const B=[],F=[];function z(e){return Math.min(i.maxSamples,e.samples)}function U(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(e,t){const n=e.colorSpace,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==EZ&&n!==CZ&&(TJ.getTransfer(n)===NZ?r===MQ&&i===hQ||eJ("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):tJ("WebGLTextures: Unsupported texture color space:",n)),t}function G(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=T;return e>=i.maxTextures&&eJ("WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=C,this.setTexture2DArray=function(t,i){const a=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version?L(a,t,i):(t.isExternalTexture&&(a.__webglTexture=t.sourceTexture?t.sourceTexture:null),n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i))},this.setTexture3D=function(t,i){const a=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version?L(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,o){const s=r.get(t);!0!==t.isCubeDepthTexture&&t.version>0&&s.__version!==t.version?function(t,o,s){if(6!==o.image.length)return;const l=k(t,o),c=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);const u=r.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+s);const t=TJ.getPrimaries(TJ.workingColorSpace),r=o.colorSpace===CZ?null:TJ.getPrimaries(o.colorSpace),d=o.colorSpace===CZ||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const h=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=h||p?p?o.image[e].image:o.image[e]:m(o.image[e],!0,i.maxCubemapSize),f[e]=V(o,f[e]);const A=f[0],b=a.convert(o.format,o.colorSpace),_=a.convert(o.type),w=y(o.internalFormat,b,_,o.colorSpace),S=!0!==o.isVideoTexture,T=void 0===u.__version||!0===l,C=c.dataReady;let M,E=x(o,A);if(N(e.TEXTURE_CUBE_MAP,o),h){S&&T&&n.texStorage2D(e.TEXTURE_CUBE_MAP,E,w,A.width,A.height);for(let t=0;t<6;t++){M=f[t].mipmaps;for(let r=0;r<M.length;r++){const i=M[r];o.format!==MQ?null!==b?S?C&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,b,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,w,i.width,i.height,0,i.data):eJ("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):S?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,b,_,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,w,i.width,i.height,0,b,_,i.data)}}}else{if(M=o.mipmaps,S&&T){M.length>0&&E++;const t=G(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,E,w,t.width,t.height)}for(let t=0;t<6;t++)if(p){S?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,b,_,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,w,f[t].width,f[t].height,0,b,_,f[t].data);for(let r=0;r<M.length;r++){const i=M[r].image[t].image;S?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,b,_,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,w,i.width,i.height,0,b,_,i.data)}}else{S?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,b,_,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,w,b,_,f[t]);for(let r=0;r<M.length;r++){const i=M[r];S?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,b,_,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,w,b,_,i.image[t])}}}g(o)&&v(e.TEXTURE_CUBE_MAP),u.__version=c.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(s,t,o):n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&O(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&I(t)},this.setupRenderTarget=function(t){const i=t.texture,s=r.get(t),l=r.get(i);t.addEventListener("dispose",w);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,d=c.length>1;if(d||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,o.memory.textures++),u){s.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)s.__webglFramebuffer[t][n]=e.createFramebuffer()}else s.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)s.__webglFramebuffer[t]=e.createFramebuffer()}else s.__webglFramebuffer=e.createFramebuffer();if(d)for(let t=0,n=c.length;t<n;t++){const n=r.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}if(t.samples>0&&!1===U(t)){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const r=c[n];s.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const i=a.convert(r.format,r.colorSpace),o=a.convert(r.type),l=y(r.internalFormat,i,o,r.colorSpace,!0===t.isXRRenderTarget),u=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,s.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),j(s.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),N(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)O(s.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else O(s.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let i=0,a=c.length;i<a;i++){const a=c[i],o=r.get(a);let l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(l,o.__webglTexture),N(l,a),O(s.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,l,0),g(a)&&v(l)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),N(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)O(s.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else O(s.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&v(r),n.unbindTexture()}t.depthBuffer&&I(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let i=0,a=t.length;i<a;i++){const a=t[i];if(g(a)){const t=A(e),i=r.get(a).__webglTexture;n.bindTexture(t,i),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===U(t)){const i=t.textures,a=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),d=i.length>1;if(d)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const h=t.texture.mipmaps;h&&h.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),!0===l&&(B.length=0,F.length=0,B.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(B.push(c),F.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,F)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,B))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=I,this.setupFrameBufferTexture=O,this.useMultisampledRTT=U,this.isReversedDepthBuffer=function(){return n.buffers.depth.getReversed()}}function d7(e,t){return{convert:function(n,r=""){let i;const a=TJ.getTransfer(r);if(n===hQ)return e.UNSIGNED_BYTE;if(n===bQ)return e.UNSIGNED_SHORT_4_4_4_4;if(n===xQ)return e.UNSIGNED_SHORT_5_5_5_1;if(n===wQ)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===SQ)return e.UNSIGNED_INT_10F_11F_11F_REV;if(n===pQ)return e.BYTE;if(n===fQ)return e.SHORT;if(n===mQ)return e.UNSIGNED_SHORT;if(n===gQ)return e.INT;if(n===vQ)return e.UNSIGNED_INT;if(n===AQ)return e.FLOAT;if(n===yQ)return e.HALF_FLOAT;if(n===TQ)return e.ALPHA;if(n===CQ)return e.RGB;if(n===MQ)return e.RGBA;if(n===EQ)return e.DEPTH_COMPONENT;if(n===PQ)return e.DEPTH_STENCIL;if(n===NQ)return e.RED;if(n===kQ)return e.RED_INTEGER;if(n===RQ)return e.RG;if(n===LQ)return e.RG_INTEGER;if(n===OQ)return e.RGBA_INTEGER;if(n===jQ||n===DQ||n===IQ||n===BQ)if(a===NZ){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===jQ)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===DQ)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===IQ)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===BQ)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===jQ)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===DQ)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===IQ)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===BQ)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===FQ||n===zQ||n===UQ||n===VQ){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===FQ)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===zQ)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===UQ)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===VQ)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===GQ||n===qQ||n===WQ||n===HQ||n===$Q||n===KQ||n===XQ){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===GQ||n===qQ)return a===NZ?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===WQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(n===HQ)return i.COMPRESSED_R11_EAC;if(n===$Q)return i.COMPRESSED_SIGNED_R11_EAC;if(n===KQ)return i.COMPRESSED_RG11_EAC;if(n===XQ)return i.COMPRESSED_SIGNED_RG11_EAC}if(n===YQ||n===QQ||n===ZQ||n===JQ||n===eZ||n===tZ||n===nZ||n===rZ||n===iZ||n===aZ||n===oZ||n===sZ||n===lZ||n===cZ){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===YQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===QQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ZQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===JQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===eZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===tZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===nZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===rZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===iZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===aZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===oZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===sZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===lZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===cZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===uZ||n===dZ||n===hZ){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===uZ)return a===NZ?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===dZ)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===hZ)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===pZ||n===fZ||n===mZ||n===gZ){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===pZ)return i.COMPRESSED_RED_RGTC1_EXT;if(n===fZ)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===mZ)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===gZ)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===_Q?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class h7{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const n=new X2(e.texture);e.depthNear===t.depthNear&&e.depthFar===t.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new X1({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new V1(new Y3(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class p7 extends rJ{constructor(e,t){super();const n=this;let r=null,i=1,a=null,o="local-floor",s=1,l=null,c=null,u=null,d=null,h=null,p=null;const f="undefined"!==typeof XRWebGLBinding,m=new h7,g={},v=t.getContextAttributes();let A=null,y=null;const b=[],x=[],_=new mJ;let w=null;const S=new e2;S.viewport=new DJ;const T=new e2;T.viewport=new DJ;const C=[S,T],M=new Q4;let E=null,P=null;function N(e){const t=x.indexOf(e.inputSource);if(-1===t)return;const n=b[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function k(){r.removeEventListener("select",N),r.removeEventListener("selectstart",N),r.removeEventListener("selectend",N),r.removeEventListener("squeeze",N),r.removeEventListener("squeezestart",N),r.removeEventListener("squeezeend",N),r.removeEventListener("end",k),r.removeEventListener("inputsourceschange",R);for(let e=0;e<b.length;e++){const t=x[e];null!==t&&(x[e]=null,b[e].disconnect(t))}E=null,P=null,m.reset();for(const e in g)delete g[e];e.setRenderTarget(A),h=null,d=null,u=null,r=null,y=null,I.stop(),n.isPresenting=!1,e.setPixelRatio(w),e.setSize(_.width,_.height,!1),n.dispatchEvent({type:"sessionend"})}function R(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=x.indexOf(n);r>=0&&(x[r]=null,b[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=x.indexOf(n);if(-1===r){for(let e=0;e<b.length;e++){if(e>=x.length){x.push(n),r=e;break}if(null===x[e]){x[e]=n,r=e;break}}if(-1===r)break}const i=b[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=b[e];return void 0===t&&(t=new s2,b[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=b[e];return void 0===t&&(t=new s2,b[e]=t),t.getGripSpace()},this.getHand=function(e){let t=b[e];return void 0===t&&(t=new s2,b[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&eJ("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&eJ("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return null===u&&f&&(u=new XRWebGLBinding(r,t)),u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){A=e.getRenderTarget(),r.addEventListener("select",N),r.addEventListener("selectstart",N),r.addEventListener("selectend",N),r.addEventListener("squeeze",N),r.addEventListener("squeezestart",N),r.addEventListener("squeezeend",N),r.addEventListener("end",k),r.addEventListener("inputsourceschange",R),!0!==v.xrCompatible&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(_);if(f&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,a=null,o=null;v.depth&&(o=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=v.stencil?PQ:EQ,a=v.stencil?_Q:vQ);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:i};u=this.getBinding(),d=u.createProjectionLayer(s),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),y=new BJ(d.textureWidth,d.textureHeight,{format:MQ,type:hQ,depthTexture:new $2(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}else{const n={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),y=new BJ(h.framebufferWidth,h.framebufferHeight,{format:MQ,type:hQ,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}y.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await r.requestReferenceSpace(o),I.setContext(r),I.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const L=new vJ,O=new vJ;function j(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==m.texture&&(m.depthNear>0&&(t=m.depthNear),m.depthFar>0&&(n=m.depthFar)),M.near=T.near=S.near=t,M.far=T.far=S.far=n,E===M.near&&P===M.far||(r.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,P=M.far),M.layers.mask=6|e.layers.mask,S.layers.mask=3&M.layers.mask,T.layers.mask=5&M.layers.mask;const i=e.parent,a=M.cameras;j(M,i);for(let r=0;r<a.length;r++)j(a[r],i);2===a.length?function(e,t,n){L.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);const r=L.distanceTo(O),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(a[8]+1)/a[0],h=o*u,p=o*d,f=r/(-u+d),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=o+f,n=s+f,i=h-m,a=p+(r-m),u=l*s/n*t,d=c*s/n*t;e.projectionMatrix.makePerspective(i,a,u,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(M,S,T):M.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*sJ*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,M,i)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==d||null!==h)return s},this.setFoveation=function(e){s=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(M)},this.getCameraTexture=function(e){return g[e]};let D=null;const I=new M5;I.setAnimationLoop(function(t,i){if(c=i.getViewerPose(l||a),p=i,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(y,h.framebuffer),e.setRenderTarget(y));let i=!1;t.length!==M.cameras.length&&(M.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let a=null;if(null!==h)a=h.getViewport(r);else{const t=u.getViewSubImage(d,r);a=t.viewport,0===n&&(e.setRenderTargetTextures(y,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(y))}let o=C[n];void 0===o&&(o=new e2,o.layers.enable(n),o.viewport=new DJ,C[n]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===n&&(M.matrix.copy(o.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===i&&M.cameras.push(o)}const a=r.enabledFeatures;if(a&&a.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&f){u=n.getBinding();const e=u.getDepthInformation(t[0]);e&&e.isValid&&e.texture&&m.init(e,r.renderState)}if(a&&a.includes("camera-access")&&f){e.state.unbindTexture(),u=n.getBinding();for(let e=0;e<t.length;e++){const n=t[e].camera;if(n){let e=g[n];e||(e=new X2,g[n]=e);const t=u.getCameraImage(n);e.sourceTexture=t}}}}for(let e=0;e<b.length;e++){const t=x[e],n=b[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}D&&D(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null}),this.setAnimationLoop=function(e){D=e},this.dispose=function(){}}}const f7=new S0,m7=new f0;function g7(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const i=t.get(r),a=i.envMap,o=i.envMapRotation;a&&(e.envMap.value=a,f7.copy(o),f7.x*=-1,f7.y*=-1,f7.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(f7.y*=-1,f7.z*=-1),e.envMapRotation.value.setFromMatrix4(m7.makeRotationFromEuler(f7)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,$1(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,o,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,s)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function v7(e,t,n,r){let i={},a={},o=[];const s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){const i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"===typeof i||"boolean"===typeof i?i:i.clone(),!0;{const e=r[a];if("number"===typeof i||"boolean"===typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?eJ("WebGLRenderer: Texture samplers can not be part of an uniforms group."):eJ("WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,d){let h=i[n.id];void 0===h&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let a=0,o=t.length;a<o;a++){const e=Array.isArray(t[a])?t[a]:[t[a]];for(let t=0,i=e.length;t<i;t++){const i=e[t],a=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=a.length;e<t;e++){const t=c(a[e]),o=n%r,s=o%t.boundary,l=o+s;n+=s,0!==l&&r-l<t.storage&&(n+=r-l),i.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,n+=t.storage}}}const i=n%r;i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return tJ("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=h,n.addEventListener("dispose",u));const p=d.program;r.updateUBOMapping(n,p);const f=t.render.frame;a[n.id]!==f&&(!function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,o=r.length;i<o;i++){const t=Array.isArray(r[i])?r[i]:[r[i]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===l(r,i,n,a)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let a=0;a<n.length;a++){const o=n[a],s=c(o);"number"===typeof o||"boolean"===typeof o?(r.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+i,r.__data)):o.isMatrix3?(r.__data[0]=o.elements[0],r.__data[1]=o.elements[1],r.__data[2]=o.elements[2],r.__data[3]=0,r.__data[4]=o.elements[3],r.__data[5]=o.elements[4],r.__data[6]=o.elements[5],r.__data[7]=0,r.__data[8]=o.elements[6],r.__data[9]=o.elements[7],r.__data[10]=o.elements[8],r.__data[11]=0):(o.toArray(r.__data,i),i+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}const A7=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let y7=null;var b7=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},x7="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,_7="object"==typeof self&&self&&self.Object===Object&&self,w7=x7||_7||Function("return this")(),S7=function(){return w7.Date.now()},T7=/\s/;var C7=function(e){for(var t=e.length;t--&&T7.test(e.charAt(t)););return t},M7=/^\s+/;var E7=function(e){return e?e.slice(0,C7(e)+1).replace(M7,""):e},P7=w7.Symbol,N7=Object.prototype,k7=N7.hasOwnProperty,R7=N7.toString,L7=P7?P7.toStringTag:void 0;var O7=function(e){var t=k7.call(e,L7),n=e[L7];try{e[L7]=void 0;var r=!0}catch(or){}var i=R7.call(e);return r&&(t?e[L7]=n:delete e[L7]),i},j7=Object.prototype.toString;var D7=function(e){return j7.call(e)},I7=P7?P7.toStringTag:void 0;var B7=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":I7&&I7 in Object(e)?O7(e):D7(e)};var F7=function(e){return null!=e&&"object"==typeof e};var z7=function(e){return"symbol"==typeof e||F7(e)&&"[object Symbol]"==B7(e)},U7=/^[-+]0x[0-9a-f]+$/i,V7=/^0b[01]+$/i,G7=/^0o[0-7]+$/i,q7=parseInt;var W7=function(e){if("number"==typeof e)return e;if(z7(e))return NaN;if(b7(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=b7(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=E7(e);var n=V7.test(e);return n||G7.test(e)?q7(e.slice(2),n?2:8):U7.test(e)?NaN:+e},H7=Math.max,$7=Math.min;var K7=function(e,t,n){var r,i,a,o,s,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=i;return r=i=void 0,c=t,o=e.apply(a,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=a}function m(){var e=S7();if(f(e))return g(e);s=setTimeout(m,function(e){var n=t-(e-l);return d?$7(n,a-(e-c)):n}(e))}function g(e){return s=void 0,h&&r?p(e):(r=i=void 0,o)}function v(){var e=S7(),n=f(e);if(r=arguments,i=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(m,t),u?p(e):o}(l);if(d)return clearTimeout(s),s=setTimeout(m,t),p(l)}return void 0===s&&(s=setTimeout(m,t)),o}return t=W7(t)||0,b7(n)&&(u=!!n.leading,a=(d="maxWait"in n)?H7(W7(n.maxWait)||0,t):a,h="trailing"in n?!!n.trailing:h),v.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=l=i=s=void 0},v.flush=function(){return void 0===s?o:g(S7())},v};function X7(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Y7(e,t,n){return Object.defineProperty(e,"prototype",{writable:!1}),e}function Q7(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return X7(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X7(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Z7=Y7(function e(t,n){var r=n.default,i=void 0===r?null:r,a=n.triggerUpdate,o=void 0===a||a,s=n.onChange,l=void 0===s?function(e,t){}:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.defaultVal=i,this.triggerUpdate=o,this.onChange=l});function J7(e){var t=e.stateInit,n=void 0===t?function(){return{}}:t,r=e.props,i=void 0===r?{}:r,a=e.methods,o=void 0===a?{}:a,s=e.aliases,l=void 0===s?{}:s,c=e.init,u=void 0===c?function(){}:c,d=e.update,h=void 0===d?function(){}:d,p=Object.keys(i).map(function(e){return new Z7(e,i[e])});return function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var a=!!(this instanceof e?this.constructor:void 0),s=a?r.shift():void 0,c=r[0],d=void 0===c?{}:c,f=Object.assign({},n instanceof Function?n(d):n,{initialised:!1}),m={};function g(e){return v(e,d),A(),g}var v=function(e,t){u.call(g,e,f,t),f.initialised=!0},A=K7(function(){f.initialised&&(h.call(g,f,m),m={})},1);return p.forEach(function(e){g[e.name]=function(e){var t=e.name,n=e.triggerUpdate,r=void 0!==n&&n,i=e.onChange,a=void 0===i?function(e,t){}:i,o=e.defaultVal,s=void 0===o?null:o;return function(e){var n=f[t];if(!arguments.length)return n;var i=void 0===e?s:e;return f[t]=i,a.call(g,i,f,n),!m.hasOwnProperty(t)&&(m[t]=n),r&&A(),g}}(e)}),Object.keys(o).forEach(function(e){g[e]=function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=o[e]).call.apply(t,[g,f].concat(r))}}),Object.entries(l).forEach(function(e){var t=Q7(e,2),n=t[0],r=t[1];return g[n]=g[r]}),g.resetProps=function(){return p.forEach(function(e){g[e.name](e.defaultVal)}),g},g.resetProps(),f._rerender=A,a&&s&&g(s),g}}var e9=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-e9.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*e9.Bounce.In(2*e):.5*e9.Bounce.Out(2*e-1)+.5}}),generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}}),t9=function(){return performance.now()},n9=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];null===(e=a._group)||void 0===e||e.remove(a),a._group=this,this._tweens[a.getId()]=a,this._tweensAddedDuringUpdate[a.getId()]=a}},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var i=r[n];i._group=void 0,delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]}},e.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},e.prototype.update=function(e,t){void 0===e&&(e=t9()),void 0===t&&(t=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],a=!t;i&&!1===i.update(e,a)&&!t&&this.remove(i)}n=Object.keys(this._tweensAddedDuringUpdate)}},e}(),r9={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=r9.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=r9.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=r9.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=r9.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var r=t;r>1;r--)n*=r;return e[t]=n,n}}(),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),o=.5*(r-t),s=i*i;return(2*t-2*n+a+o)*(i*s)+(-3*t+3*n-2*a-o)*s+a*i+t}}},i9=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),a9=new n9,o9=function(){function e(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=e9.Linear.None,this._interpolationFunction=r9.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=i9.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,"object"===typeof t?(this._group=t,t.add(this)):!0===t&&(this._group=a9,a9.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,t){if(void 0===t&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,t){if(void 0===e&&(e=t9()),void 0===t&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,t,n,r,i){for(var a in n){var o=e[a],s=Array.isArray(o),l=s?"array":typeof o,c=!s&&Array.isArray(n[a]);if("undefined"!==l&&"function"!==l){if(c){if(0===(g=n[a]).length)continue;for(var u=[o],d=0,h=g.length;d<h;d+=1){var p=this._handleRelativeValue(o,g[d]);if(isNaN(p)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}u.push(p)}c&&(n[a]=u)}if("object"!==l&&!s||!o||c)("undefined"===typeof t[a]||i)&&(t[a]=o),s||(t[a]*=1),r[a]=c?n[a].slice().reverse():t[a]||0;else{t[a]=s?[]:{};var f=o;for(var m in f)t[a][m]=f[m];r[a]=s?[]:{};var g=n[a];if(!this._isDynamic){var v={};for(var m in g)v[m]=g[m];n[a]=g=v}this._setupProperties(f,t[a],g,r[a],i)}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(e){return void 0===e&&(e=t9()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e),this},e.prototype.resume=function(e){return void 0===e&&(e=t9()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var e;return null===(e=this._group)||void 0===e||e.remove(this),this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=e9.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=r9.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(t,n){var r,i,a=this;if(void 0===t&&(t=t9()),void 0===n&&(n=e.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=t-this._startTime,s=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),l=this._duration+this._repeat*s,c=function(){if(0===a._duration)return 1;if(o>l)return 1;var e=Math.trunc(o/s),t=o-e*s,n=Math.min(t/a._duration,1);return 0===n&&o===a._duration?1:n}(),u=this._easingFunction(c);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,u),this._onUpdateCallback&&this._onUpdateCallback(this._object,c),0===this._duration||o>=this._duration){if(this._repeat>0){var d=Math.min(Math.trunc((o-this._duration)/s)+1,this._repeat);for(i in isFinite(this._repeat)&&(this._repeat-=d),this._valuesStartRepeat)this._yoyo||"string"!==typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=s*d,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var h=0,p=this._chainedTweens.length;h<p;h++)this._chainedTweens[h].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,r){for(var i in n)if(void 0!==t[i]){var a=t[i]||0,o=n[i],s=Array.isArray(e[i]),l=Array.isArray(o);!s&&l?e[i]=this._interpolationFunction(o,r):"object"===typeof o&&o?this._updateProperties(e[i],a,o,r):"number"===typeof(o=this._handleRelativeValue(a,o))&&(e[i]=a+(o-a)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!==typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];this._valuesStartRepeat[e]="string"===typeof n?this._valuesStartRepeat[e]+parseFloat(n):this._valuesEnd[e],this._valuesEnd[e]=t},e.autoStartOnUpdate=!1,e}(),s9=(i9.nextId,a9);s9.getAll.bind(s9),s9.removeAll.bind(s9),s9.add.bind(s9),s9.remove.bind(s9),s9.update.bind(s9);function l9(e,t,n,r,i){if(isNaN(t)||isNaN(n)||isNaN(r))return e;var a,o,s,l,c,u,d,h,p,f,m,g,v=e._root,A={data:i},y=e._x0,b=e._y0,x=e._z0,_=e._x1,w=e._y1,S=e._z1;if(!v)return e._root=A,e;for(;v.length;)if((h=t>=(o=(y+_)/2))?y=o:_=o,(p=n>=(s=(b+w)/2))?b=s:w=s,(f=r>=(l=(x+S)/2))?x=l:S=l,a=v,!(v=v[m=f<<2|p<<1|h]))return a[m]=A,e;if(c=+e._x.call(null,v.data),u=+e._y.call(null,v.data),d=+e._z.call(null,v.data),t===c&&n===u&&r===d)return A.next=v,a?a[m]=A:e._root=A,e;do{a=a?a[m]=new Array(8):e._root=new Array(8),(h=t>=(o=(y+_)/2))?y=o:_=o,(p=n>=(s=(b+w)/2))?b=s:w=s,(f=r>=(l=(x+S)/2))?x=l:S=l}while((m=f<<2|p<<1|h)===(g=(d>=l)<<2|(u>=s)<<1|c>=o));return a[g]=v,a[m]=A,e}function c9(e,t,n,r,i,a,o){this.node=e,this.x0=t,this.y0=n,this.z0=r,this.x1=i,this.y1=a,this.z1=o}const u9=(e,t,n,r,i,a)=>Math.sqrt((e-r)**2+(t-i)**2+(n-a)**2);function d9(e){return e[0]}function h9(e){return e[1]}function p9(e){return e[2]}function f9(e,t,n,r){var i=new m9(null==t?d9:t,null==n?h9:n,null==r?p9:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function m9(e,t,n,r,i,a,o,s,l){this._x=e,this._y=t,this._z=n,this._x0=r,this._y0=i,this._z0=a,this._x1=o,this._y1=s,this._z1=l,this._root=void 0}function g9(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var v9=f9.prototype=m9.prototype;v9.copy=function(){var e,t,n=new m9(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=g9(r),n;for(e=[{source:r,target:n._root=new Array(8)}];r=e.pop();)for(var i=0;i<8;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(8)}):r.target[i]=g9(t));return n},v9.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e),r=+this._z.call(null,e);return l9(this.cover(t,n,r),t,n,r,e)},v9.addAll=function(e){Array.isArray(e)||(e=Array.from(e));const t=e.length,n=new Float64Array(t),r=new Float64Array(t),i=new Float64Array(t);let a=1/0,o=1/0,s=1/0,l=-1/0,c=-1/0,u=-1/0;for(let d,h,p,f,m=0;m<t;++m)isNaN(h=+this._x.call(null,d=e[m]))||isNaN(p=+this._y.call(null,d))||isNaN(f=+this._z.call(null,d))||(n[m]=h,r[m]=p,i[m]=f,h<a&&(a=h),h>l&&(l=h),p<o&&(o=p),p>c&&(c=p),f<s&&(s=f),f>u&&(u=f));if(a>l||o>c||s>u)return this;this.cover(a,o,s).cover(l,c,u);for(let d=0;d<t;++d)l9(this,n[d],r[d],i[d],e[d]);return this},v9.cover=function(e,t,n){if(isNaN(e=+e)||isNaN(t=+t)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,a=this._z0,o=this._x1,s=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(e))+1,s=(i=Math.floor(t))+1,l=(a=Math.floor(n))+1;else{for(var c,u,d=o-r||1,h=this._root;r>e||e>=o||i>t||t>=s||a>n||n>=l;)switch(u=(n<a)<<2|(t<i)<<1|e<r,(c=new Array(8))[u]=h,h=c,d*=2,u){case 0:o=r+d,s=i+d,l=a+d;break;case 1:r=o-d,s=i+d,l=a+d;break;case 2:o=r+d,i=s-d,l=a+d;break;case 3:r=o-d,i=s-d,l=a+d;break;case 4:o=r+d,s=i+d,a=l-d;break;case 5:r=o-d,s=i+d,a=l-d;break;case 6:o=r+d,i=s-d,a=l-d;break;case 7:r=o-d,i=s-d,a=l-d}this._root&&this._root.length&&(this._root=h)}return this._x0=r,this._y0=i,this._z0=a,this._x1=o,this._y1=s,this._z1=l,this},v9.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},v9.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},v9.find=function(e,t,n,r){var i,a,o,s,l,c,u,d,h,p=this._x0,f=this._y0,m=this._z0,g=this._x1,v=this._y1,A=this._z1,y=[],b=this._root;for(b&&y.push(new c9(b,p,f,m,g,v,A)),null==r?r=1/0:(p=e-r,f=t-r,m=n-r,g=e+r,v=t+r,A=n+r,r*=r);d=y.pop();)if(!(!(b=d.node)||(a=d.x0)>g||(o=d.y0)>v||(s=d.z0)>A||(l=d.x1)<p||(c=d.y1)<f||(u=d.z1)<m))if(b.length){var x=(a+l)/2,_=(o+c)/2,w=(s+u)/2;y.push(new c9(b[7],x,_,w,l,c,u),new c9(b[6],a,_,w,x,c,u),new c9(b[5],x,o,w,l,_,u),new c9(b[4],a,o,w,x,_,u),new c9(b[3],x,_,s,l,c,w),new c9(b[2],a,_,s,x,c,w),new c9(b[1],x,o,s,l,_,w),new c9(b[0],a,o,s,x,_,w)),(h=(n>=w)<<2|(t>=_)<<1|e>=x)&&(d=y[y.length-1],y[y.length-1]=y[y.length-1-h],y[y.length-1-h]=d)}else{var S=e-+this._x.call(null,b.data),T=t-+this._y.call(null,b.data),C=n-+this._z.call(null,b.data),M=S*S+T*T+C*C;if(M<r){var E=Math.sqrt(r=M);p=e-E,f=t-E,m=n-E,g=e+E,v=t+E,A=n+E,i=b.data}}return i},v9.findAllWithinRadius=function(e,t,n,r){const i=[],a=e-r,o=t-r,s=n-r,l=e+r,c=t+r,u=n+r;return this.visit((d,h,p,f,m,g,v)=>{if(!d.length)do{const a=d.data;u9(e,t,n,this._x(a),this._y(a),this._z(a))<=r&&i.push(a)}while(d=d.next);return h>l||p>c||f>u||m<a||g<o||v<s}),i},v9.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e))||isNaN(s=+this._z.call(null,e)))return this;var t,n,r,i,a,o,s,l,c,u,d,h,p,f,m,g=this._root,v=this._x0,A=this._y0,y=this._z0,b=this._x1,x=this._y1,_=this._z1;if(!g)return this;if(g.length)for(;;){if((d=a>=(l=(v+b)/2))?v=l:b=l,(h=o>=(c=(A+x)/2))?A=c:x=c,(p=s>=(u=(y+_)/2))?y=u:_=u,t=g,!(g=g[f=p<<2|h<<1|d]))return this;if(!g.length)break;(t[f+1&7]||t[f+2&7]||t[f+3&7]||t[f+4&7]||t[f+5&7]||t[f+6&7]||t[f+7&7])&&(n=t,m=f)}for(;g.data!==e;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(g=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&g===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},v9.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},v9.root=function(){return this._root},v9.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},v9.visit=function(e){var t,n,r,i,a,o,s,l,c=[],u=this._root;for(u&&c.push(new c9(u,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=c.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,a=t.z0,o=t.x1,s=t.y1,l=t.z1)&&u.length){var d=(r+o)/2,h=(i+s)/2,p=(a+l)/2;(n=u[7])&&c.push(new c9(n,d,h,p,o,s,l)),(n=u[6])&&c.push(new c9(n,r,h,p,d,s,l)),(n=u[5])&&c.push(new c9(n,d,i,p,o,h,l)),(n=u[4])&&c.push(new c9(n,r,i,p,d,h,l)),(n=u[3])&&c.push(new c9(n,d,h,a,o,s,p)),(n=u[2])&&c.push(new c9(n,r,h,a,d,s,p)),(n=u[1])&&c.push(new c9(n,d,i,a,o,h,p)),(n=u[0])&&c.push(new c9(n,r,i,a,d,h,p))}return this},v9.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new c9(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.z0,c=t.x1,u=t.y1,d=t.z1,h=(o+c)/2,p=(s+u)/2,f=(l+d)/2;(a=i[0])&&n.push(new c9(a,o,s,l,h,p,f)),(a=i[1])&&n.push(new c9(a,h,s,l,c,p,f)),(a=i[2])&&n.push(new c9(a,o,p,l,h,u,f)),(a=i[3])&&n.push(new c9(a,h,p,l,c,u,f)),(a=i[4])&&n.push(new c9(a,o,s,f,h,p,d)),(a=i[5])&&n.push(new c9(a,h,s,f,c,p,d)),(a=i[6])&&n.push(new c9(a,o,p,f,h,u,d)),(a=i[7])&&n.push(new c9(a,h,p,f,c,u,d))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.z0,t.x1,t.y1,t.z1);return this},v9.x=function(e){return arguments.length?(this._x=e,this):this._x},v9.y=function(e){return arguments.length?(this._y=e,this):this._y},v9.z=function(e){return arguments.length?(this._z=e,this):this._z};var A9=1e-6,y9=1e-12,b9=Math.PI,x9=b9/2,_9=b9/4,w9=2*b9,S9=180/b9,T9=b9/180,C9=Math.abs,M9=Math.atan,E9=Math.atan2,P9=Math.cos,N9=Math.ceil,k9=Math.exp,R9=(Math.floor,Math.hypot),L9=Math.log,O9=(Math.pow,Math.sin),j9=Math.sign||function(e){return e>0?1:e<0?-1:0},D9=Math.sqrt,I9=Math.tan;function B9(e){return e>1?x9:e<-1?-x9:Math.asin(e)}function F9(e){return(e=O9(e/2))*e}function z9(e,t){return[e,L9(I9((x9+t)/2))]}function U9(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function V9(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function G9(e,t,n){return t=Y9(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Q9()?Reflect.construct(t,[],Y9(e).constructor):t.apply(e,n))}function q9(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function W9(e,t){return e.get(V9(e,t))}function H9(e,t,n){q9(e,t),t.set(e,n)}function $9(e,t,n){return e.set(V9(e,t),n),n}function K9(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,tee(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function X9(e,t,n){return(t=tee(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y9(e){return Y9=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y9(e)}function Q9(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Q9=function(){return!!e})()}function Z9(e,t){return Z9=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z9(e,t)}function J9(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||nee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eee(e){return function(e){if(Array.isArray(e))return U9(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||nee(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tee(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function nee(e,t){if(e){if("string"==typeof e)return U9(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U9(e,t):void 0}}z9.invert=function(e,t){return[e,2*M9(k9(t))-x9]};var ree=function(e){e instanceof Array?e.forEach(ree):(e.map&&e.map.dispose(),e.dispose())},iee=function(e){e.geometry&&e.geometry.dispose(),e.material&&ree(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(iee)},aee=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),iee(t)}};function oee(e,t,n){var r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return{x:n*Math.sin(r)*Math.cos(i),y:n*Math.cos(r),z:n*Math.sin(r)*Math.sin(i)}}function see(e){return e*Math.PI/180}var lee=function(e){return 1-(z9(0,(.5-e)*Math.PI)[1]/Math.PI+1)/2},cee=function(e){return Math.max(0,Math.min(1,lee(e)))},uee=function(e){return.5-z9.invert(0,(2*(1-e)-1)*Math.PI)[1]/Math.PI},dee=function(e,t,n,r){var i=Math.pow(2,e),a=Math.max(0,Math.min(i-1,Math.floor((n+180)*i/360))),o=(90-r)/180;return t&&(o=Math.max(0,Math.min(1,lee(o)))),[a,Math.floor(o*i)]},hee=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=[],s=Math.pow(2,e),l=360/s,c=180/s,u=void 0===i?s-1:i,d=void 0===a?s-1:a,h=n,p=Math.min(s-1,u);h<=p;h++)for(var f=r,m=Math.min(s-1,d);f<=m;f++){var g=f,v=c;if(t)g=0===f?f:uee(f/s)*s,v=180*((f+1===s?f+1:uee((f+1)/s)*s)-g)/s;var A=(h+.5)*l-180,y=90-(180*g/s+v/2),b=v;o.push({x:h,y:f,lng:A,lat:y,latLen:b})}return o},pee=new WeakMap,fee=new WeakMap,mee=new WeakMap,gee=new WeakMap,vee=new WeakMap,Aee=new WeakMap,yee=new WeakMap,bee=new WeakMap,xee=new WeakSet,_ee=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.tileUrl,a=r.minLevel,o=void 0===a?0:a,s=r.maxLevel,l=void 0===s?17:s,c=r.mercatorProjection,u=void 0===c||c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){q9(e,t),t.add(e)}(n=G9(this,t),xee),H9(n,pee,void 0),H9(n,fee,void 0),H9(n,mee,void 0),H9(n,gee,void 0),H9(n,vee,{}),H9(n,Aee,void 0),H9(n,yee,void 0),H9(n,bee,void 0),X9(n,"minLevel",void 0),X9(n,"maxLevel",void 0),X9(n,"thresholds",eee(new Array(30)).map(function(e,t){return 8/Math.pow(2,t)})),X9(n,"curvatureResolution",5),X9(n,"tileMargin",0),X9(n,"clearTiles",function(){Object.values(W9(vee,n)).forEach(function(e){e.forEach(function(e){e.obj&&(n.remove(e.obj),aee(e.obj),delete e.obj)})}),$9(vee,n,{})}),$9(pee,n,e),n.tileUrl=i,$9(fee,n,u),n.minLevel=o,n.maxLevel=l,n.level=0,n.add($9(bee,n,new V1(new Q3(.99*W9(pee,n),180,90),new u1({color:0})))),W9(bee,n).visible=!1,W9(bee,n).material.polygonOffset=!0,W9(bee,n).material.polygonOffsetUnits=3,W9(bee,n).material.polygonOffsetFactor=1,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z9(e,t)}(t,e),K9(t,[{key:"tileUrl",get:function(){return W9(mee,this)},set:function(e){$9(mee,this,e),this.updatePov(W9(yee,this))}},{key:"level",get:function(){return W9(gee,this)},set:function(e){var t,n=this;W9(vee,this)[e]||V9(xee,this,wee).call(this,e);var r=W9(gee,this);if($9(gee,this,e),e!==r&&void 0!==r){if(W9(bee,this).visible=e>0,W9(vee,this)[e].forEach(function(e){return e.obj&&(e.obj.material.depthWrite=!0)}),r<e&&(null===(t=W9(vee,this)[r])||void 0===t||t.forEach(function(e){return e.obj&&(e.obj.material.depthWrite=!1)})),r>e)for(var i=e+1;i<=r;i++)W9(vee,this)[i]&&W9(vee,this)[i].forEach(function(e){e.obj&&(n.remove(e.obj),aee(e.obj),delete e.obj)});V9(xee,this,See).call(this)}}},{key:"updatePov",value:function(e){var t,n=this;if(e&&e instanceof Y1&&($9(yee,this,e),$9(Aee,this,function(r){if(!r.hullPnts){var i=360/Math.pow(2,n.level),a=r.lng,o=r.lat,s=r.latLen,l=a-i/2,c=a+i/2,u=o-s/2,d=o+s/2;r.hullPnts=[[o,a],[u,l],[d,l],[u,c],[d,c]].map(function(e){var t=J9(e,2);return oee(t[0],t[1],W9(pee,n))}).map(function(e){var t=e.x,n=e.y,r=e.z;return new vJ(t,n,r)})}return t||(t=new _2,e.updateMatrix(),e.updateMatrixWorld(),t.setFromProjectionMatrix((new f0).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))),r.hullPnts.some(function(e){return t.containsPoint(e.clone().applyMatrix4(n.matrixWorld))})}),this.tileUrl)){var r=(e.position.clone().distanceTo(this.getWorldPosition(new vJ))-W9(pee,this))/W9(pee,this),i=this.thresholds.findIndex(function(e){return e&&e<=r});this.level=Math.min(this.maxLevel,Math.max(this.minLevel,i<0?this.thresholds.length:i)),V9(xee,this,See).call(this)}}}])}(a2);function wee(e){var t=this;if(e>7)W9(vee,this)[e]=[];else{var n=W9(vee,this)[e]=hee(e,W9(fee,this));n.forEach(function(e){return e.centroid=oee(e.lat,e.lng,W9(pee,t))}),n.octree=f9().x(function(e){return e.centroid.x}).y(function(e){return e.centroid.y}).z(function(e){return e.centroid.z}).addAll(n)}}function See(){var e=this;if(this.tileUrl&&void 0!==this.level&&W9(vee,this).hasOwnProperty(this.level)&&(W9(Aee,this)||!(this.level>6))){var t=W9(vee,this)[this.level];if(W9(yee,this)){var n=this.worldToLocal(W9(yee,this).position.clone());if(t.octree){var r,i=this.worldToLocal(W9(yee,this).position.clone()),a=3*(i.length()-W9(pee,this));t=(r=t.octree).findAllWithinRadius.apply(r,eee(i).concat([a]))}else{var o=function(e){var t=e.x,n=e.y,r=e.z,i=Math.sqrt(t*t+n*n+r*r),a=Math.acos(n/i),o=Math.atan2(r,t);return{lat:90-180*a/Math.PI,lng:90-180*o/Math.PI-(o<-Math.PI/2?360:0),r:i}}(n),s=90*(o.r/W9(pee,this)-1),l=s/Math.cos(see(o.lat)),c=[o.lng-l,o.lng+l],u=[o.lat+s,o.lat-s],d=J9(dee(this.level,W9(fee,this),c[0],u[0]),2),h=d[0],p=d[1],f=J9(dee(this.level,W9(fee,this),c[1],u[1]),2),m=f[0],g=f[1];!t.record&&(t.record={});var v=t.record;if(v.hasOwnProperty("".concat(Math.round((h+m)/2),"_").concat(Math.round((p+g)/2)))){for(var A=[],y=h;y<=m;y++)for(var b=p;b<=g;b++){var x="".concat(y,"_").concat(b);v.hasOwnProperty(x)||(v[x]=hee(this.level,W9(fee,this),y,b,y,b)[0],t.push(v[x])),A.push(v[x])}t=A}else t=hee(this.level,W9(fee,this),h,p,m,g).map(function(e){var n="".concat(e.x,"_").concat(e.y);return v.hasOwnProperty(n)?v[n]:(v[n]=e,t.push(e),e)})}}t.filter(function(e){return!e.obj}).filter(W9(Aee,this)||function(){return!0}).forEach(function(t){var n=t.x,r=t.y,i=t.lng,a=t.lat,o=t.latLen,s=360/Math.pow(2,e.level);if(!t.obj){var l=s*(1-e.tileMargin),c=o*(1-e.tileMargin),u=see(i),d=see(-a),h=new V1(new Q3(W9(pee,e),Math.ceil(l/e.curvatureResolution),Math.ceil(c/e.curvatureResolution),see(90-l/2)+u,see(l),see(90-c/2)+d,see(c)),new l4);if(W9(fee,e)){var p=J9([a+o/2,a-o/2].map(function(e){return.5-e/180}),2),f=p[0],m=p[1];!function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=fM().domain([1,0]).range([t,n]).clamp(!0),i=fM().domain([cee(t),cee(n)]).range([1,0]).clamp(!0),a=function(e){return i(cee(r(e)))},o=e.array,s=0,l=o.length;s<l;s+=2)o[s+1]=a(o[s+1]);e.needsUpdate=!0}(h.geometry.attributes.uv,f,m)}t.obj=h}t.loading||(t.loading=!0,(new R4).load(e.tileUrl(n,r,e.level),function(n){var r=t.obj;r&&(n.colorSpace=MZ,r.material.map=n,r.material.color=null,r.material.needsUpdate=!0,e.add(r)),t.loading=!1}))})}}function Tee(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let a=Cee(e,0,i,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(r&&(a=function(e,t,n,r){const i=[];for(let a=0,o=t.length;a<o;a++){const n=Cee(e,t[a]*r,a<o-1?t[a+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(Iee(n))}i.sort(Lee);for(let a=0;a<i.length;a++)n=Oee(i[a],n);return n}(e,t,a,n)),e.length>80*n){s=e[0],l=e[1];let t=s,r=l;for(let a=n;a<i;a+=n){const n=e[a],i=e[a+1];n<s&&(s=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-s,r-l),c=0!==c?32767/c:0}return Eee(a,o,n,s,l,c,0),o}function Cee(e,t,n,r,i){let a;if(i===Qee(e,t,n,r)>0)for(let o=t;o<n;o+=r)a=Kee(o/r|0,e[o],e[o+1],a);else for(let o=n-r;o>=t;o-=r)a=Kee(o/r|0,e[o],e[o+1],a);return a&&Vee(a,a.next)&&(Xee(a),a=a.next),a}function Mee(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Vee(r,r.next)&&0!==Uee(r.prev,r,r.next))r=r.next;else{if(Xee(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Eee(e,t,n,r,i,a,o){if(!e)return;!o&&a&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Dee(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let a=null;for(t=0;i;){t++;let o=i,s=0;for(let e=0;e<n&&(s++,o=o.nextZ,o);e++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||i.z<=o.z)?(r=i,i=i.nextZ,s--):(r=o,o=o.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=o}a.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,a);let s=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(a?Nee(e,r,i,a):Pee(e))t.push(l.i,e.i,c.i),Xee(e),e=c.next,s=c.next;else if((e=c)===s){o?1===o?Eee(e=kee(Mee(e),t),t,n,r,i,a,2):2===o&&Ree(e,t,n,r,i,a):Eee(Mee(e),t,n,r,i,a,1);break}}}function Pee(e){const t=e.prev,n=e,r=e.next;if(Uee(t,n,r)>=0)return!1;const i=t.x,a=n.x,o=r.x,s=t.y,l=n.y,c=r.y,u=Math.min(i,a,o),d=Math.min(s,l,c),h=Math.max(i,a,o),p=Math.max(s,l,c);let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=h&&f.y>=d&&f.y<=p&&Fee(i,s,a,l,o,c,f.x,f.y)&&Uee(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Nee(e,t,n,r){const i=e.prev,a=e,o=e.next;if(Uee(i,a,o)>=0)return!1;const s=i.x,l=a.x,c=o.x,u=i.y,d=a.y,h=o.y,p=Math.min(s,l,c),f=Math.min(u,d,h),m=Math.max(s,l,c),g=Math.max(u,d,h),v=Dee(p,f,t,n,r),A=Dee(m,g,t,n,r);let y=e.prevZ,b=e.nextZ;for(;y&&y.z>=v&&b&&b.z<=A;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==o&&Fee(s,u,l,d,c,h,y.x,y.y)&&Uee(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&Fee(s,u,l,d,c,h,b.x,b.y)&&Uee(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==o&&Fee(s,u,l,d,c,h,y.x,y.y)&&Uee(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=A;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&Fee(s,u,l,d,c,h,b.x,b.y)&&Uee(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function kee(e,t){let n=e;do{const r=n.prev,i=n.next.next;!Vee(r,i)&&Gee(r,n,n.next,i)&&Hee(r,i)&&Hee(i,r)&&(t.push(r.i,n.i,i.i),Xee(n),Xee(n.next),n=e=i),n=n.next}while(n!==e);return Mee(n)}function Ree(e,t,n,r,i,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&zee(o,e)){let s=$ee(o,e);return o=Mee(o,o.next),s=Mee(s,s.next),Eee(o,t,n,r,i,a,0),void Eee(s,t,n,r,i,a,0)}e=e.next}o=o.next}while(o!==e)}function Lee(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return n}function Oee(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let a,o=-1/0;if(Vee(e,n))return n;do{if(Vee(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>o&&(o=e,a=n.x<n.next.x?n:n.next,e===r))return a}n=n.next}while(n!==t);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(r>=n.x&&n.x>=l&&r!==n.x&&Bee(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);Hee(n,e)&&(t<u||t===u&&(n.x>a.x||n.x===a.x&&jee(a,n)))&&(a=n,u=t)}n=n.next}while(n!==s);return a}(e,t);if(!n)return t;const r=$ee(n,e);return Mee(r,r.next),Mee(n,n.next)}function jee(e,t){return Uee(e.prev,e,t.prev)<0&&Uee(t.next,e,e.next)<0}function Dee(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Iee(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Bee(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function Fee(e,t,n,r,i,a,o,s){return!(e===o&&t===s)&&Bee(e,t,n,r,i,a,o,s)}function zee(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Gee(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Hee(e,t)&&Hee(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Uee(e.prev,e,t.prev)||Uee(e,t.prev,t))||Vee(e,t)&&Uee(e.prev,e,e.next)>0&&Uee(t.prev,t,t.next)>0)}function Uee(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Vee(e,t){return e.x===t.x&&e.y===t.y}function Gee(e,t,n,r){const i=Wee(Uee(e,t,n)),a=Wee(Uee(e,t,r)),o=Wee(Uee(n,r,e)),s=Wee(Uee(n,r,t));return i!==a&&o!==s||(!(0!==i||!qee(e,n,t))||(!(0!==a||!qee(e,r,t))||(!(0!==o||!qee(n,e,r))||!(0!==s||!qee(n,t,r)))))}function qee(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Wee(e){return e>0?1:e<0?-1:0}function Hee(e,t){return Uee(e.prev,e,e.next)<0?Uee(e,t,e.next)>=0&&Uee(e,e.prev,t)>=0:Uee(e,t,e.prev)<0||Uee(e,e.next,t)<0}function $ee(e,t){const n=Yee(e.i,e.x,e.y),r=Yee(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Kee(e,t,n,r){const i=Yee(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Xee(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yee(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Qee(e,t,n,r){let i=0;for(let a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function Zee(e){const t=[],n=[],r=e[0][0].length;let i=0,a=0;for(const o of e){for(const e of o)for(let n=0;n<r;n++)t.push(e[n]);a&&(i+=a,n.push(i)),a=o.length}return{vertices:t,holes:n,dimensions:r}}class Jee{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}function ete(){}function tte(e,t){e&&ste.hasOwnProperty(e.type)&&ste[e.type](e,t)}var nte,rte,ite,ate,ote={Feature:function(e,t){tte(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)tte(n[r].geometry,t)}},ste={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){lte(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)lte(n[r],t,0)},Polygon:function(e,t){cte(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)cte(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)tte(n[r],t)}};function lte(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function cte(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)lte(e[n],t,1);t.polygonEnd()}function ute(e,t){e&&ote.hasOwnProperty(e.type)?ote[e.type](e,t):tte(e,t)}var dte={sphere:ete,point:ete,lineStart:function(){dte.point=pte,dte.lineEnd=hte},lineEnd:ete,polygonStart:ete,polygonEnd:ete};function hte(){dte.point=dte.lineEnd=ete}function pte(e,t){rte=e*=T9,ite=O9(t*=T9),ate=P9(t),dte.point=fte}function fte(e,t){e*=T9;var n=O9(t*=T9),r=P9(t),i=C9(e-rte),a=P9(i),o=r*O9(i),s=ate*n-ite*r*a,l=ite*n+ate*r*a;nte.add(E9(D9(o*o+s*s),l)),rte=e,ite=n,ate=r}var mte=[null,null],gte={type:"LineString",coordinates:mte};function vte(e,t){return mte[0]=e,mte[1]=t,function(e){return nte=new Jee,ute(e,dte),+nte}(gte)}function Ate(e,t){var n=e[0]*T9,r=e[1]*T9,i=t[0]*T9,a=t[1]*T9,o=P9(r),s=O9(r),l=P9(a),c=O9(a),u=o*P9(n),d=o*O9(n),h=l*P9(i),p=l*O9(i),f=2*B9(D9(F9(a-r)+o*l*F9(i-n))),m=O9(f),g=f?function(e){var t=O9(e*=f)/m,n=O9(f-e)/m,r=n*u+t*h,i=n*d+t*p,a=n*s+t*c;return[E9(i,r)*S9,E9(a,D9(r*r+i*i))*S9]}:function(){return[n*S9,r*S9]};return g.distance=f,g}function yte(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function bte(e,t,n){return t=xte(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_te()?Reflect.construct(t,[],xte(e).constructor):t.apply(e,n))}function xte(e){return xte=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xte(e)}function _te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_te=function(){return!!e})()}function wte(e,t){return wte=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wte(e,t)}function Ste(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||Cte(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tte(e){return function(e){if(Array.isArray(e))return yte(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Cte(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cte(e,t){if(e){if("string"==typeof e)return yte(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yte(e,t):void 0}}var Mte=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=[],n=null;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(r){if(n){var i=180*vte(r,n)/Math.PI;if(i>e)for(var a=Ate(n,r),o=n.length>2||r.length>2?jC(n[2]||0,r[2]||0):null,s=o?function(e){return[].concat(Tte(a(e)),[o(e)])}:a,l=1/Math.ceil(i/e),c=l;c<1;)t.push(s(c)),c+=l}t.push(n=r)}),t},Ete="undefined"!==typeof window&&window.THREE?window.THREE:{BufferGeometry:N1,Float32BufferAttribute:_1},Pte=(new Ete.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Nte=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=bte(this,t)).type="GeoJsonGeometry",n.parameters={geoJson:e,radius:r,resolution:i};var a=({Point:c,MultiPoint:function(e,t){var n={vertices:[],indices:[]};return e.map(function(e){return c(e,t)}).forEach(function(e){var t=Ste(e,1)[0];kte(n,t)}),[n]},LineString:u,MultiLineString:function(e,t){var n={vertices:[],indices:[]};return e.map(function(e){return u(e,t)}).forEach(function(e){var t=Ste(e,1)[0];kte(n,t)}),[n]},Polygon:d,MultiPolygon:function(e,t){var n={vertices:[],indices:[]},r={vertices:[],indices:[]};e.map(function(e){return d(e,t)}).forEach(function(e){var t=Ste(e,2),i=t[0],a=t[1];kte(n,i),a&&kte(r,a)});var i=[n];return r.vertices.length&&i.push(r),i}}[e.type]||function(){return[]})(e.coordinates,r),o=[],s=[],l=0;function c(e,t){return[{vertices:Lte(e[1],e[0],t+(e[2]||0)),indices:[]}]}function u(e,t){for(var n=Zee([Mte(e,i).map(function(e){var n=Ste(e,3),r=n[0],i=n[1],a=n[2];return Lte(i,r,t+(void 0===a?0:a))})]).vertices,r=Math.round(n.length/3),a=[],o=1;o<r;o++)a.push(o-1,o);return[{vertices:n,indices:a}]}function d(e,t){for(var n=Zee(e.map(function(e){return Mte(e,i).map(function(e){var n=Ste(e,3),r=n[0],i=n[1],a=n[2];return Lte(i,r,t+(void 0===a?0:a))})})),r=n.vertices,a=n.holes,o=a[0]||1/0,s=r.slice(0,3*o),l=r.slice(3*o),c=new Set(a),u=Math.round(r.length/3),d=[],h=[],p=1;p<u;p++)c.has(p)||(p<o?d.push(p-1,p):h.push(p-1-o,p-o));var f=[{indices:d,vertices:s}];return a.length&&f.push({indices:h,vertices:l}),f}return a.forEach(function(e){var t=o.length;kte({indices:o,vertices:s},e),n.addGroup(t,o.length-t,l++)}),o.length&&n.setIndex(o),s.length&&n[Pte]("position",new Ete.Float32BufferAttribute(s,3)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wte(e,t)}(t,e),function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(t)}(Ete.BufferGeometry);function kte(e,t){var n=Math.round(e.vertices.length/3);Rte(e.vertices,t.vertices),Rte(e.indices,t.indices.map(function(e){return e+n}))}function Rte(e,t){var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Cte(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.push(i)}}catch(a){r.e(a)}finally{r.f()}}function Lte(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return[n*Math.sin(r)*Math.cos(i),n*Math.cos(r),n*Math.sin(r)*Math.sin(i)]}function Ote(e,t,n){var r=mT(e,t-A9,n).concat(t);return function(e){return r.map(function(t){return[e,t]})}}function jte(e,t,n){var r=mT(e,t-A9,n).concat(t);return function(e){return r.map(function(t){return[t,e]})}}function Dte(){return function(){var e,t,n,r,i,a,o,s,l,c,u,d,h=10,p=h,f=90,m=360,g=2.5;function v(){return{type:"MultiLineString",coordinates:A()}}function A(){return mT(N9(r/f)*f,n,f).map(u).concat(mT(N9(s/m)*m,o,m).map(d)).concat(mT(N9(t/h)*h,e,h).filter(function(e){return C9(e%f)>A9}).map(l)).concat(mT(N9(a/p)*p,i,p).filter(function(e){return C9(e%m)>A9}).map(c))}return v.lines=function(){return A().map(function(e){return{type:"LineString",coordinates:e}})},v.outline=function(){return{type:"Polygon",coordinates:[u(r).concat(d(o).slice(1),u(n).reverse().slice(1),d(s).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.extentMajor(e).extentMinor(e):v.extentMinor()},v.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),v.precision(g)):[[r,s],[n,o]]},v.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),v.precision(g)):[[t,a],[e,i]]},v.step=function(e){return arguments.length?v.stepMajor(e).stepMinor(e):v.stepMinor()},v.stepMajor=function(e){return arguments.length?(f=+e[0],m=+e[1],v):[f,m]},v.stepMinor=function(e){return arguments.length?(h=+e[0],p=+e[1],v):[h,p]},v.precision=function(h){return arguments.length?(g=+h,l=Ote(a,i,90),c=jte(t,e,g),u=Ote(s,o,90),d=jte(r,n,g),v):g},v.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()()}function Ite(e,t,n=!0){if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(e){if(e.normalized||e.isInterleavedBufferAttribute){const t=new Float32Array(e.count*e.itemSize);for(let n=0,r=0;n<e.count;n++)t[r++]=e.getX(n),t[r++]=e.getY(n),e.itemSize>2&&(t[r++]=e.getZ(n));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}const i=e.index?e.toNonIndexed():e,a=t.generateTangents(r(i.attributes.position),r(i.attributes.normal),r(i.attributes.uv));if(n)for(let o=3;o<a.length;o+=4)a[o]*=-1;return i.setAttribute("tangent",new A1(a,4)),e!==i&&e.copy(i),e}function Bte(e,t=!1){const n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,l=new N1;let c=0;for(let u=0;u<e.length;++u){const d=e[u];let h=0;if(n!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in d.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(d.attributes[e]),h++}if(h!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(s!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in d.morphAttributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[e]&&(o[e]=[]),o[e].push(d.morphAttributes[e])}if(t){let e;if(n)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}l.addGroup(c,e,u),c+=e}}if(n){let t=0;const n=[];for(let r=0;r<e.length;++r){const i=e[r].index;for(let e=0;e<i.count;++e)n.push(i.getX(e)+t);t+=e[r].attributes.position.count}l.setIndex(n)}for(const u in a){const e=Fte(a[u]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,e)}for(const u in o){const e=o[u][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let t=0;t<e;++t){const e=[];for(let r=0;r<o[u].length;++r)e.push(o[u][r][t]);const n=Fte(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(n)}}return l}function Fte(e){let t,n,r,i=-1,a=0;for(let c=0;c<e.length;++c){const o=e[c];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===i&&(i=o.gpuType),i!==o.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;a+=o.count*n}const o=new t(a),s=new A1(o,n,r);let l=0;for(let c=0;c<e.length;++c){const t=e[c];if(t.isInterleavedBufferAttribute){const e=l/n;for(let r=0,i=t.count;r<i;r++)for(let a=0;a<n;a++){const n=t.getComponent(r,a);s.setComponent(r+e,a,n)}}else o.set(t.array,l);l+=t.count*n}return void 0!==i&&(s.gpuType=i),s}function zte(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?Vte(e):e.isInstancedBufferAttribute?(new f2).copy(e):(new A1).copy(e)}function Ute(e){let t,n=0,r=0;for(let c=0,u=e.length;c<u;++c){const i=e[c];if(void 0===t&&(t=i.array.constructor),t!==i.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=i.array.length,r+=i.itemSize}const i=new c2(new t(n),r);let a=0;const o=[],s=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let c=0,u=e.length;c<u;c++){const t=e[c],n=t.itemSize,r=t.count,u=new d2(i,n,a,t.normalized);o.push(u),a+=n;for(let e=0;e<r;e++)for(let r=0;r<n;r++)u[l[r]](e,t[s[r]](e))}return o}function Vte(e){const t=e.data.array.constructor,n=e.count,r=e.itemSize,i=e.normalized,a=new t(n*r);let o;o=e.isInstancedInterleavedBufferAttribute?new f2(a,r,i,e.meshPerAttribute):new A1(a,r,i);for(let s=0;s<n;s++)o.setX(s,e.getX(s)),r>=2&&o.setY(s,e.getY(s)),r>=3&&o.setZ(s,e.getZ(s)),r>=4&&o.setW(s,e.getW(s));return o}function Gte(e){const t=e.attributes,n=e.morphTargets,r=new Map;for(const i in t){const e=t[i];e.isInterleavedBufferAttribute&&(r.has(e)||r.set(e,Vte(e)),t[i]=r.get(e))}for(const i in n){const e=n[i];e.isInterleavedBufferAttribute&&(r.has(e)||r.set(e,Vte(e)),n[i]=r.get(e))}}function qte(e){let t=0;for(const r in e.attributes){const n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function Wte(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},r=e.getIndex(),i=e.getAttribute("position"),a=r?r.count:i.count;let o=0;const s=Object.keys(e.attributes),l={},c={},u=[],d=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"];for(let A=0,y=s.length;A<y;A++){const t=s[A],n=e.attributes[t];l[t]=new n.constructor(new n.array.constructor(n.count*n.itemSize),n.itemSize,n.normalized);const r=e.morphAttributes[t];r&&(c[t]||(c[t]=[]),r.forEach((e,n)=>{const r=new e.array.constructor(e.count*e.itemSize);c[t][n]=new e.constructor(r,e.itemSize,e.normalized)}))}const p=.5*t,f=Math.log10(1/t),m=Math.pow(10,f),g=p*m;for(let A=0;A<a;A++){const t=r?r.getX(A):A;let i="";for(let n=0,r=s.length;n<r;n++){const r=s[n],a=e.getAttribute(r),o=a.itemSize;for(let e=0;e<o;e++)i+=~~(a[d[e]](t)*m+g)+","}if(i in n)u.push(n[i]);else{for(let n=0,r=s.length;n<r;n++){const r=s[n],i=e.getAttribute(r),a=e.morphAttributes[r],u=i.itemSize,p=l[r],f=c[r];for(let e=0;e<u;e++){const n=d[e],r=h[e];if(p[r](o,i[n](t)),a)for(let e=0,i=a.length;e<i;e++)f[e][r](o,a[e][n](t))}}n[i]=o,u.push(o),o++}}const v=e.clone();for(const A in e.attributes){const e=l[A];if(v.setAttribute(A,new e.constructor(e.array.slice(0,o*e.itemSize),e.itemSize,e.normalized)),A in c)for(let t=0;t<c[A].length;t++){const e=c[A][t];v.morphAttributes[A][t]=new e.constructor(e.array.slice(0,o*e.itemSize),e.itemSize,e.normalized)}}return v.setIndex(u),v}function Hte(e,t){if(t===wZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===TZ||t===SZ){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(t===TZ)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2===0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(i),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function $te(e){const t=new vJ,n=new vJ,r=new vJ,i=new vJ,a=new vJ,o=new vJ,s=new vJ,l=new vJ,c=new vJ;function u(e,u,d,h,p,f,m,g){t.fromBufferAttribute(u,p),n.fromBufferAttribute(u,f),r.fromBufferAttribute(u,m);const v=e.morphTargetInfluences;if(d&&v){s.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let e=0,u=d.length;e<u;e++){const u=v[e],g=d[e];0!==u&&(i.fromBufferAttribute(g,p),a.fromBufferAttribute(g,f),o.fromBufferAttribute(g,m),h?(s.addScaledVector(i,u),l.addScaledVector(a,u),c.addScaledVector(o,u)):(s.addScaledVector(i.sub(t),u),l.addScaledVector(a.sub(n),u),c.addScaledVector(o.sub(r),u)))}t.add(s),n.add(l),r.add(c)}e.isSkinnedMesh&&(e.applyBoneTransform(p,t),e.applyBoneTransform(f,n),e.applyBoneTransform(m,r)),g[3*p+0]=t.x,g[3*p+1]=t.y,g[3*p+2]=t.z,g[3*f+0]=n.x,g[3*f+1]=n.y,g[3*f+2]=n.z,g[3*m+0]=r.x,g[3*m+1]=r.y,g[3*m+2]=r.z}const d=e.geometry,h=e.material;let p,f,m;const g=d.index,v=d.attributes.position,A=d.morphAttributes.position,y=d.morphTargetsRelative,b=d.attributes.normal,x=d.morphAttributes.position,_=d.groups,w=d.drawRange;let S,T,C,M,E,P,N;const k=new Float32Array(v.count*v.itemSize),R=new Float32Array(b.count*b.itemSize);if(null!==g)if(Array.isArray(h))for(S=0,C=_.length;S<C;S++)for(E=_[S],P=Math.max(E.start,w.start),N=Math.min(E.start+E.count,w.start+w.count),T=P,M=N;T<M;T+=3)p=g.getX(T),f=g.getX(T+1),m=g.getX(T+2),u(e,v,A,y,p,f,m,k),u(e,b,x,y,p,f,m,R);else for(P=Math.max(0,w.start),N=Math.min(g.count,w.start+w.count),S=P,C=N;S<C;S+=3)p=g.getX(S),f=g.getX(S+1),m=g.getX(S+2),u(e,v,A,y,p,f,m,k),u(e,b,x,y,p,f,m,R);else if(Array.isArray(h))for(S=0,C=_.length;S<C;S++)for(E=_[S],P=Math.max(E.start,w.start),N=Math.min(E.start+E.count,w.start+w.count),T=P,M=N;T<M;T+=3)p=T,f=T+1,m=T+2,u(e,v,A,y,p,f,m,k),u(e,b,x,y,p,f,m,R);else for(P=Math.max(0,w.start),N=Math.min(v.count,w.start+w.count),S=P,C=N;S<C;S+=3)p=S,f=S+1,m=S+2,u(e,v,A,y,p,f,m,k),u(e,b,x,y,p,f,m,R);return{positionAttribute:v,normalAttribute:b,morphedPositionAttribute:new _1(k,3),morphedNormalAttribute:new _1(R,3)}}function Kte(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start),null===e.getIndex()){const t=e.getAttribute("position"),n=[];for(let e=0;e<t.count;e+=3)n.push(e,e+1,e+2);e.setIndex(n)}const n=e.getIndex(),r=[];for(let o=0;o<t.length;o++){const e=t[o],i=e.start,a=i+e.count;for(let t=i;t<a;t++)r.push(n.getX(t))}e.dispose(),e.setIndex(r);let i=0;for(let o=0;o<t.length;o++){const e=t[o];e.start=i,i+=e.count}let a=t[0];e.groups=[a];for(let o=1;o<t.length;o++){const n=t[o];a.materialIndex===n.materialIndex?a.count+=n.count:(a=n,e.groups.push(a))}return e}function Xte(e,t=Math.PI/3){const n=Math.cos(t),r=100*(1+1e-10),i=[new vJ,new vJ,new vJ],a=new vJ,o=new vJ,s=new vJ,l=new vJ;function c(e){return`${~~(e.x*r)},${~~(e.y*r)},${~~(e.z*r)}`}const u=e.index?e.toNonIndexed():e,d=u.attributes.position,h={};for(let m=0,g=d.count/3;m<g;m++){const e=3*m,t=i[0].fromBufferAttribute(d,e+0),n=i[1].fromBufferAttribute(d,e+1),r=i[2].fromBufferAttribute(d,e+2);a.subVectors(r,n),o.subVectors(t,n);const s=(new vJ).crossVectors(a,o).normalize();for(let a=0;a<3;a++){const e=c(i[a]);e in h||(h[e]=[]),h[e].push(s)}}const p=new Float32Array(3*d.count),f=new A1(p,3,!1);for(let m=0,g=d.count/3;m<g;m++){const e=3*m,t=i[0].fromBufferAttribute(d,e+0),r=i[1].fromBufferAttribute(d,e+1),u=i[2].fromBufferAttribute(d,e+2);a.subVectors(u,r),o.subVectors(t,r),s.crossVectors(a,o).normalize();for(let a=0;a<3;a++){const t=h[c(i[a])];l.set(0,0,0);for(let e=0,r=t.length;e<r;e++){const r=t[e];s.dot(r)>n&&l.add(r)}l.normalize(),f.setXYZ(e+a,l.x,l.y,l.z)}}return u.setAttribute("normal",f),u}var Yte=function(e){return"function"===typeof e?e:"string"===typeof e?function(t){return t[e]}:function(t){return e}};function Qte(e){return Qte="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qte(e)}var Zte=/^\s+/,Jte=/\s+$/;function ene(e,t){if(t=t||{},(e=e||"")instanceof ene)return e;if(!(this instanceof ene))return new ene(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,r=null,i=null,a=null,o=!1,s=!1;"string"==typeof e&&(e=function(e){e=e.replace(Zte,"").replace(Jte,"").toLowerCase();var t,n=!1;if(vne[e])e=vne[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=Mne.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=Mne.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=Mne.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=Mne.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=Mne.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=Mne.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=Mne.hex8.exec(e))return{r:_ne(t[1]),g:_ne(t[2]),b:_ne(t[3]),a:Cne(t[4]),format:n?"name":"hex8"};if(t=Mne.hex6.exec(e))return{r:_ne(t[1]),g:_ne(t[2]),b:_ne(t[3]),format:n?"name":"hex"};if(t=Mne.hex4.exec(e))return{r:_ne(t[1]+""+t[1]),g:_ne(t[2]+""+t[2]),b:_ne(t[3]+""+t[3]),a:Cne(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=Mne.hex3.exec(e))return{r:_ne(t[1]+""+t[1]),g:_ne(t[2]+""+t[2]),b:_ne(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==Qte(e)&&(Ene(e.r)&&Ene(e.g)&&Ene(e.b)?(t=function(e,t,n){return{r:255*bne(e,255),g:255*bne(t,255),b:255*bne(n,255)}}(e.r,e.g,e.b),o=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):Ene(e.h)&&Ene(e.s)&&Ene(e.v)?(r=Sne(e.s),i=Sne(e.v),t=function(e,t,n){e=6*bne(e,360),t=bne(t,100),n=bne(n,100);var r=Math.floor(e),i=e-r,a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t),l=r%6,c=[n,o,a,a,s,n][l],u=[s,n,n,o,a,a][l],d=[a,a,s,n,n,o][l];return{r:255*c,g:255*u,b:255*d}}(e.h,r,i),o=!0,s="hsv"):Ene(e.h)&&Ene(e.s)&&Ene(e.l)&&(r=Sne(e.s),a=Sne(e.l),t=function(e,t,n){var r,i,a;function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=bne(e,360),t=bne(t,100),n=bne(n,100),0===t)r=i=a=n;else{var s=n<.5?n*(1+t):n+t-n*t,l=2*n-s;r=o(l,s,e+1/3),i=o(l,s,e),a=o(l,s,e-1/3)}return{r:255*r,g:255*i,b:255*a}}(e.h,r,a),o=!0,s="hsl"),e.hasOwnProperty("a")&&(n=e.a));return n=yne(n),{ok:o,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function tne(e,t,n){e=bne(e,255),t=bne(t,255),n=bne(n,255);var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),s=(a+o)/2;if(a==o)r=i=0;else{var l=a-o;switch(i=s>.5?l/(2-a-o):l/(a+o),a){case e:r=(t-n)/l+(t<n?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return{h:r,s:i,l:s}}function nne(e,t,n){e=bne(e,255),t=bne(t,255),n=bne(n,255);var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),s=a,l=a-o;if(i=0===a?0:l/a,a==o)r=0;else{switch(a){case e:r=(t-n)/l+(t<n?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return{h:r,s:i,v:s}}function rne(e,t,n,r){var i=[wne(Math.round(e).toString(16)),wne(Math.round(t).toString(16)),wne(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function ine(e,t,n,r){return[wne(Tne(r)),wne(Math.round(e).toString(16)),wne(Math.round(t).toString(16)),wne(Math.round(n).toString(16))].join("")}function ane(e,t){t=0===t?0:t||10;var n=ene(e).toHsl();return n.s-=t/100,n.s=xne(n.s),ene(n)}function one(e,t){t=0===t?0:t||10;var n=ene(e).toHsl();return n.s+=t/100,n.s=xne(n.s),ene(n)}function sne(e){return ene(e).desaturate(100)}function lne(e,t){t=0===t?0:t||10;var n=ene(e).toHsl();return n.l+=t/100,n.l=xne(n.l),ene(n)}function cne(e,t){t=0===t?0:t||10;var n=ene(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),ene(n)}function une(e,t){t=0===t?0:t||10;var n=ene(e).toHsl();return n.l-=t/100,n.l=xne(n.l),ene(n)}function dne(e,t){var n=ene(e).toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,ene(n)}function hne(e){var t=ene(e).toHsl();return t.h=(t.h+180)%360,ene(t)}function pne(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=ene(e).toHsl(),r=[ene(e)],i=360/t,a=1;a<t;a++)r.push(ene({h:(n.h+a*i)%360,s:n.s,l:n.l}));return r}function fne(e){var t=ene(e).toHsl(),n=t.h;return[ene(e),ene({h:(n+72)%360,s:t.s,l:t.l}),ene({h:(n+216)%360,s:t.s,l:t.l})]}function mne(e,t,n){t=t||6,n=n||30;var r=ene(e).toHsl(),i=360/n,a=[ene(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,a.push(ene(r));return a}function gne(e,t){t=t||6;for(var n=ene(e).toHsv(),r=n.h,i=n.s,a=n.v,o=[],s=1/t;t--;)o.push(ene({h:r,s:i,v:a})),a=(a+s)%1;return o}ene.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,r=this.toRgb();return e=r.r/255,t=r.g/255,n=r.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=yne(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=nne(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=nne(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=tne(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=tne(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return rne(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,r,i){var a=[wne(Math.round(e).toString(16)),wne(Math.round(t).toString(16)),wne(Math.round(n).toString(16)),wne(Tne(r))];if(i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1))return a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0);return a.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*bne(this._r,255))+"%",g:Math.round(100*bne(this._g,255))+"%",b:Math.round(100*bne(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*bne(this._r,255))+"%, "+Math.round(100*bne(this._g,255))+"%, "+Math.round(100*bne(this._b,255))+"%)":"rgba("+Math.round(100*bne(this._r,255))+"%, "+Math.round(100*bne(this._g,255))+"%, "+Math.round(100*bne(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(Ane[rne(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+ine(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=ene(e);n="#"+ine(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0;return t||!r||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return ene(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(lne,arguments)},brighten:function(){return this._applyModification(cne,arguments)},darken:function(){return this._applyModification(une,arguments)},desaturate:function(){return this._applyModification(ane,arguments)},saturate:function(){return this._applyModification(one,arguments)},greyscale:function(){return this._applyModification(sne,arguments)},spin:function(){return this._applyModification(dne,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(mne,arguments)},complement:function(){return this._applyCombination(hne,arguments)},monochromatic:function(){return this._applyCombination(gne,arguments)},splitcomplement:function(){return this._applyCombination(fne,arguments)},triad:function(){return this._applyCombination(pne,[3])},tetrad:function(){return this._applyCombination(pne,[4])}},ene.fromRatio=function(e,t){if("object"==Qte(e)){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]="a"===r?e[r]:Sne(e[r]));e=n}return ene(e,t)},ene.equals=function(e,t){return!(!e||!t)&&ene(e).toRgbString()==ene(t).toRgbString()},ene.random=function(){return ene.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},ene.mix=function(e,t,n){n=0===n?0:n||50;var r=ene(e).toRgb(),i=ene(t).toRgb(),a=n/100;return ene({r:(i.r-r.r)*a+r.r,g:(i.g-r.g)*a+r.g,b:(i.b-r.b)*a+r.b,a:(i.a-r.a)*a+r.a})},ene.readability=function(e,t){var n=ene(e),r=ene(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},ene.isReadable=function(e,t,n){var r,i,a=ene.readability(e,t);switch(i=!1,r=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n),r.level+r.size){case"AAsmall":case"AAAlarge":i=a>=4.5;break;case"AAlarge":i=a>=3;break;case"AAAsmall":i=a>=7}return i},ene.mostReadable=function(e,t,n){var r,i,a,o,s=null,l=0;i=(n=n||{}).includeFallbackColors,a=n.level,o=n.size;for(var c=0;c<t.length;c++)(r=ene.readability(e,t[c]))>l&&(l=r,s=ene(t[c]));return ene.isReadable(e,s,{level:a,size:o})||!i?s:(n.includeFallbackColors=!1,ene.mostReadable(e,["#fff","#000"],n))};var vne=ene.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Ane=ene.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(vne);function yne(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bne(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"===typeof e&&-1!=e.indexOf("%")}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function xne(e){return Math.min(1,Math.max(0,e))}function _ne(e){return parseInt(e,16)}function wne(e){return 1==e.length?"0"+e:""+e}function Sne(e){return e<=1&&(e=100*e+"%"),e}function Tne(e){return Math.round(255*parseFloat(e)).toString(16)}function Cne(e){return _ne(e)/255}var Mne=function(){var e="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+t),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Ene(e){return!!Mne.CSS_UNIT.exec(e)}function Pne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Nne(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function kne(e,t){return e.get(Nne(e,t))}function Rne(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function Lne(e,t,n){return e.set(Nne(e,t),n),n}function One(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ine(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function jne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||Bne(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dne(e){return function(e){if(Array.isArray(e))return Pne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Bne(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ine(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function Bne(e,t){if(e){if("string"==typeof e)return Pne(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pne(e,t):void 0}}var Fne=new WeakMap,zne=new WeakMap,Une=new WeakMap,Vne=new WeakMap,Gne=new WeakMap,qne=new WeakMap,Wne=function(){return One(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Rne(this,Fne,new Map),Rne(this,zne,new Map),Rne(this,Une,function(e){return e}),Rne(this,Vne,function(){return{}}),Rne(this,Gne,function(){}),Rne(this,qne,function(){})},[{key:"getObj",value:function(e){return kne(Fne,this).get(kne(Une,this).call(this,e))}},{key:"getData",value:function(e){return kne(zne,this).get(e)}},{key:"entries",value:function(){return Dne(kne(zne,this).entries()).map(function(e){var t=jne(e,2),n=t[0];return[t[1],n]})}},{key:"id",value:function(e){return Lne(Une,this,Yte(e)),this}},{key:"onCreateObj",value:function(e){return Lne(Vne,this,e),this}},{key:"onUpdateObj",value:function(e){return Lne(Gne,this,e),this}},{key:"onRemoveObj",value:function(e){return Lne(qne,this,e),this}},{key:"digest",value:function(e){var t=this;e.filter(function(e){return!kne(Fne,t).has(kne(Une,t).call(t,e))}).forEach(function(e){var n=kne(Vne,t).call(t,e);kne(Fne,t).set(kne(Une,t).call(t,e),n),kne(zne,t).set(n,e)});var n=new Map(e.map(function(e){return[kne(Une,t).call(t,e),e]}));return kne(Fne,this).forEach(function(e,r){n.has(r)?kne(Gne,t).call(t,e,n.get(r)):(kne(qne,t).call(t,e,r),kne(Fne,t).delete(r),kne(zne,t).delete(e))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}(),Hne=n(724);function $ne(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function Kne(e,t){let n,r;if(void 0===t)for(const i of e)null!=i&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(void 0===n?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}return[n,r]}const Xne=134217729;function Yne(e,t,n,r,i){let a,o,s,l,c=t[0],u=r[0],d=0,h=0;u>c===u>-c?(a=c,c=t[++d]):(a=u,u=r[++h]);let p=0;if(d<e&&h<n)for(u>c===u>-c?(o=c+a,s=a-(o-c),c=t[++d]):(o=u+a,s=a-(o-u),u=r[++h]),a=o,0!==s&&(i[p++]=s);d<e&&h<n;)u>c===u>-c?(o=a+c,l=o-a,s=a-(o-l)+(c-l),c=t[++d]):(o=a+u,l=o-a,s=a-(o-l)+(u-l),u=r[++h]),a=o,0!==s&&(i[p++]=s);for(;d<e;)o=a+c,l=o-a,s=a-(o-l)+(c-l),c=t[++d],a=o,0!==s&&(i[p++]=s);for(;h<n;)o=a+u,l=o-a,s=a-(o-l)+(u-l),u=r[++h],a=o,0!==s&&(i[p++]=s);return 0===a&&0!==p||(i[p++]=a),p}function Qne(e){return new Float64Array(e)}const Zne=Qne(4),Jne=Qne(8),ere=Qne(12),tre=Qne(16),nre=Qne(4);function rre(e,t,n,r,i,a){const o=(t-a)*(n-i),s=(e-i)*(r-a),l=o-s,c=Math.abs(o+s);return Math.abs(l)>=33306690738754716e-32*c?l:-function(e,t,n,r,i,a,o){let s,l,c,u,d,h,p,f,m,g,v,A,y,b,x,_,w,S;const T=e-i,C=n-i,M=t-a,E=r-a;b=T*E,h=Xne*T,p=h-(h-T),f=T-p,h=Xne*E,m=h-(h-E),g=E-m,x=f*g-(b-p*m-f*m-p*g),_=M*C,h=Xne*M,p=h-(h-M),f=M-p,h=Xne*C,m=h-(h-C),g=C-m,w=f*g-(_-p*m-f*m-p*g),v=x-w,d=x-v,Zne[0]=x-(v+d)+(d-w),A=b+v,d=A-b,y=b-(A-d)+(v-d),v=y-_,d=y-v,Zne[1]=y-(v+d)+(d-_),S=A+v,d=S-A,Zne[2]=A-(S-d)+(v-d),Zne[3]=S;let P=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,Zne),N=22204460492503146e-32*o;if(P>=N||-P>=N)return P;if(d=e-T,s=e-(T+d)+(d-i),d=n-C,c=n-(C+d)+(d-i),d=t-M,l=t-(M+d)+(d-a),d=r-E,u=r-(E+d)+(d-a),0===s&&0===l&&0===c&&0===u)return P;if(N=11093356479670487e-47*o+33306690738754706e-32*Math.abs(P),P+=T*u+E*s-(M*c+C*l),P>=N||-P>=N)return P;b=s*E,h=Xne*s,p=h-(h-s),f=s-p,h=Xne*E,m=h-(h-E),g=E-m,x=f*g-(b-p*m-f*m-p*g),_=l*C,h=Xne*l,p=h-(h-l),f=l-p,h=Xne*C,m=h-(h-C),g=C-m,w=f*g-(_-p*m-f*m-p*g),v=x-w,d=x-v,nre[0]=x-(v+d)+(d-w),A=b+v,d=A-b,y=b-(A-d)+(v-d),v=y-_,d=y-v,nre[1]=y-(v+d)+(d-_),S=A+v,d=S-A,nre[2]=A-(S-d)+(v-d),nre[3]=S;const k=Yne(4,Zne,4,nre,Jne);b=T*u,h=Xne*T,p=h-(h-T),f=T-p,h=Xne*u,m=h-(h-u),g=u-m,x=f*g-(b-p*m-f*m-p*g),_=M*c,h=Xne*M,p=h-(h-M),f=M-p,h=Xne*c,m=h-(h-c),g=c-m,w=f*g-(_-p*m-f*m-p*g),v=x-w,d=x-v,nre[0]=x-(v+d)+(d-w),A=b+v,d=A-b,y=b-(A-d)+(v-d),v=y-_,d=y-v,nre[1]=y-(v+d)+(d-_),S=A+v,d=S-A,nre[2]=A-(S-d)+(v-d),nre[3]=S;const R=Yne(k,Jne,4,nre,ere);b=s*u,h=Xne*s,p=h-(h-s),f=s-p,h=Xne*u,m=h-(h-u),g=u-m,x=f*g-(b-p*m-f*m-p*g),_=l*c,h=Xne*l,p=h-(h-l),f=l-p,h=Xne*c,m=h-(h-c),g=c-m,w=f*g-(_-p*m-f*m-p*g),v=x-w,d=x-v,nre[0]=x-(v+d)+(d-w),A=b+v,d=A-b,y=b-(A-d)+(v-d),v=y-_,d=y-v,nre[1]=y-(v+d)+(d-_),S=A+v,d=S-A,nre[2]=A-(S-d)+(v-d),nre[3]=S;const L=Yne(R,ere,4,nre,tre);return tre[L-1]}(e,t,n,r,i,a,c)}Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(8),Qne(8),Qne(8),Qne(4),Qne(8),Qne(8),Qne(8),Qne(12);Qne(192),Qne(192);Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(8),Qne(8),Qne(8),Qne(8),Qne(8),Qne(8),Qne(8),Qne(8),Qne(8),Qne(4),Qne(4),Qne(4),Qne(8),Qne(16),Qne(16),Qne(16),Qne(32),Qne(32),Qne(48),Qne(64);Qne(1152),Qne(1152);Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(4),Qne(24),Qne(24),Qne(24),Qne(24),Qne(24),Qne(24),Qne(24),Qne(24),Qne(24),Qne(24),Qne(1152),Qne(1152),Qne(1152),Qne(1152),Qne(1152),Qne(2304),Qne(2304),Qne(3456),Qne(5760),Qne(8),Qne(8),Qne(8),Qne(16),Qne(24),Qne(48),Qne(48),Qne(96),Qne(192),Qne(384),Qne(384),Qne(384),Qne(768);Qne(96),Qne(96),Qne(96),Qne(1152);const ire=Math.pow(2,-52),are=new Uint32Array(512);class ore{static from(e,t=hre,n=pre){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new ore(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!==typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,c=-1/0;for(let S=0;S<a;S++){const t=e[2*S],n=e[2*S+1];t<o&&(o=t),n<s&&(s=n),t>l&&(l=t),n>c&&(c=n),this._ids[S]=S}const u=(o+l)/2,d=(s+c)/2;let h,p,f;for(let S=0,T=1/0;S<a;S++){const t=sre(u,d,e[2*S],e[2*S+1]);t<T&&(h=S,T=t)}const m=e[2*h],g=e[2*h+1];for(let S=0,T=1/0;S<a;S++){if(S===h)continue;const t=sre(m,g,e[2*S],e[2*S+1]);t<T&&t>0&&(p=S,T=t)}let v=e[2*p],A=e[2*p+1],y=1/0;for(let S=0;S<a;S++){if(S===h||S===p)continue;const t=cre(m,g,v,A,e[2*S],e[2*S+1]);t<y&&(f=S,y=t)}let b=e[2*f],x=e[2*f+1];if(y===1/0){for(let r=0;r<a;r++)this._dists[r]=e[2*r]-e[0]||e[2*r+1]-e[1];ure(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e],a=this._dists[i];a>r&&(t[n++]=i,r=a)}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(rre(m,g,v,A,b,x)<0){const e=p,t=v,n=A;p=f,v=b,A=x,f=e,b=t,x=n}const _=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,c=a-t,u=o*o+s*s,d=l*l+c*c,h=.5/(o*c-s*l),p=e+(c*u-s*d)*h,f=t+(o*d-l*u)*h;return{x:p,y:f}}(m,g,v,A,b,x);this._cx=_.x,this._cy=_.y;for(let S=0;S<a;S++)this._dists[S]=sre(e[2*S],e[2*S+1],_.x,_.y);ure(this._ids,this._dists,0,a-1),this._hullStart=h;let w=3;n[h]=t[f]=p,n[p]=t[h]=f,n[f]=t[p]=h,r[h]=0,r[p]=1,r[f]=2,i.fill(-1),i[this._hashKey(m,g)]=h,i[this._hashKey(v,A)]=p,i[this._hashKey(b,x)]=f,this.trianglesLen=0,this._addTriangle(h,p,f,-1,-1,-1);for(let S,T,C=0;C<this._ids.length;C++){const a=this._ids[C],o=e[2*a],s=e[2*a+1];if(C>0&&Math.abs(o-S)<=ire&&Math.abs(s-T)<=ire)continue;if(S=o,T=s,a===h||a===p||a===f)continue;let l=0;for(let e=0,t=this._hashKey(o,s);e<this._hashSize&&(l=i[(t+e)%this._hashSize],-1===l||l===n[l]);e++);l=t[l];let c,u=l;for(;c=n[u],rre(o,s,e[2*u],e[2*u+1],e[2*c],e[2*c+1])>=0;)if(u=c,u===l){u=-1;break}if(-1===u)continue;let d=this._addTriangle(u,a,n[u],-1,-1,r[u]);r[a]=this._legalize(d+2),r[u]=d,w++;let m=n[u];for(;c=n[m],rre(o,s,e[2*m],e[2*m+1],e[2*c],e[2*c+1])<0;)d=this._addTriangle(m,a,c,r[a],-1,r[m]),r[a]=this._legalize(d+2),n[m]=m,w--,m=c;if(u===l)for(;c=t[u],rre(o,s,e[2*c],e[2*c+1],e[2*u],e[2*u+1])<0;)d=this._addTriangle(c,a,u,-1,r[u],r[c]),this._legalize(d+2),r[c]=d,n[u]=u,w--,u=c;this._hullStart=t[a]=u,n[u]=t[m]=a,n[a]=m,i[this._hashKey(o,s)]=a,i[this._hashKey(e[2*u],e[2*u+1])]=u}this.hull=new Uint32Array(w);for(let S=0,T=this._hullStart;S<w;S++)this.hull[S]=T,T=n[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=are[--i];continue}const l=o-o%3,c=s+(e+1)%3,u=l+(o+2)%3,d=t[a],h=t[e],p=t[c],f=t[u];if(lre(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1],r[2*f],r[2*f+1])){t[e]=f,t[o]=d;const r=n[u];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,u);const s=l+(o+1)%3;i<are.length&&(are[i++]=s)}else{if(0===i)break;e=are[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function sre(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function lre(e,t,n,r,i,a,o,s){const l=e-o,c=t-s,u=n-o,d=r-s,h=i-o,p=a-s,f=u*u+d*d,m=h*h+p*p;return l*(d*m-f*p)-c*(u*m-f*h)+(l*l+c*c)*(u*p-d*h)<0}function cre(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,c=a-t,u=o*o+s*s,d=l*l+c*c,h=.5/(o*c-s*l),p=(c*u-s*d)*h,f=(o*d-l*u)*h;return p*p+f*f}function ure(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;dre(e,n+r>>1,i),t[e[n]]>t[e[r]]&&dre(e,n,r),t[e[i]]>t[e[r]]&&dre(e,i,r),t[e[n]]>t[e[i]]&&dre(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;dre(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(ure(e,t,i,r),ure(e,t,n,a-1)):(ure(e,t,n,a-1),ure(e,t,i,r))}}function dre(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function hre(e){return e[0]}function pre(e){return e[1]}function fre(e,t){var n,r,i,a,o,s,l,c,u,d=0,h=e[0],p=e[1],f=t.length;for(n=0;n<f;n++){r=0;var m=t[n],g=m.length-1;if((c=m[0])[0]!==m[g][0]&&c[1]!==m[g][1])throw new Error("First and last coordinates in a ring must be the same");for(a=c[0]-h,o=c[1]-p;r<g;r++){if(s=(u=m[r+1])[0]-h,l=u[1]-p,0===o&&0===l){if(s<=0&&a>=0||a<=0&&s>=0)return 0}else if(l>=0&&o<=0||l<=0&&o>=0){if(0===(i=rre(a,s,o,l,0,0)))return 0;(i>0&&l>0&&o<=0||i<0&&l<=0&&o>0)&&d++}c=u,o=l,a=s}}return d%2!==0}var mre,gre,vre,Are,yre,bre,xre,_re,wre,Sre,Tre,Cre,Mre,Ere,Pre,Nre,kre=function(e,t,n={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const r=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}(e),i="Feature"===(a=t).type?a.geometry:a;var a;const o=i.type,s=t.bbox;let l=i.coordinates;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,s))return!1;"Polygon"===o&&(l=[l]);let c=!1;for(var u=0;u<l.length;++u){const e=fre(r,l[u]);if(0===e)return!n.ignoreBoundary;e&&(c=!0)}return c},Rre=new Jee,Lre=new Jee,Ore={point:ete,lineStart:ete,lineEnd:ete,polygonStart:function(){Rre=new Jee,Ore.lineStart=jre,Ore.lineEnd=Dre},polygonEnd:function(){var e=+Rre;Lre.add(e<0?w9+e:e),this.lineStart=this.lineEnd=this.point=ete},sphere:function(){Lre.add(w9)}};function jre(){Ore.point=Ire}function Dre(){Bre(mre,gre)}function Ire(e,t){Ore.point=Bre,mre=e,gre=t,vre=e*=T9,Are=P9(t=(t*=T9)/2+_9),yre=O9(t)}function Bre(e,t){var n=(e*=T9)-vre,r=n>=0?1:-1,i=r*n,a=P9(t=(t*=T9)/2+_9),o=O9(t),s=yre*o,l=Are*a+s*P9(i),c=s*r*O9(i);Rre.add(E9(c,l)),vre=e,Are=a,yre=o}function Fre(e){return[E9(e[1],e[0]),B9(e[2])]}function zre(e){var t=e[0],n=e[1],r=P9(n);return[r*P9(t),r*O9(t),O9(n)]}function Ure(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Vre(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Gre(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function qre(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Wre(e){var t=D9(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Hre={point:$re,lineStart:Xre,lineEnd:Yre,polygonStart:function(){Hre.point=Qre,Hre.lineStart=Zre,Hre.lineEnd=Jre,Ere=new Jee,Ore.polygonStart()},polygonEnd:function(){Ore.polygonEnd(),Hre.point=$re,Hre.lineStart=Xre,Hre.lineEnd=Yre,Rre<0?(bre=-(_re=180),xre=-(wre=90)):Ere>A9?wre=90:Ere<-1e-6&&(xre=-90),Nre[0]=bre,Nre[1]=_re},sphere:function(){bre=-(_re=180),xre=-(wre=90)}};function $re(e,t){Pre.push(Nre=[bre=e,_re=e]),t<xre&&(xre=t),t>wre&&(wre=t)}function Kre(e,t){var n=zre([e*T9,t*T9]);if(Mre){var r=Vre(Mre,n),i=Vre([r[1],-r[0],0],r);Wre(i),i=Fre(i);var a,o=e-Sre,s=o>0?1:-1,l=i[0]*S9*s,c=C9(o)>180;c^(s*Sre<l&&l<s*e)?(a=i[1]*S9)>wre&&(wre=a):c^(s*Sre<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*S9)<xre&&(xre=a):(t<xre&&(xre=t),t>wre&&(wre=t)),c?e<Sre?eie(bre,e)>eie(bre,_re)&&(_re=e):eie(e,_re)>eie(bre,_re)&&(bre=e):_re>=bre?(e<bre&&(bre=e),e>_re&&(_re=e)):e>Sre?eie(bre,e)>eie(bre,_re)&&(_re=e):eie(e,_re)>eie(bre,_re)&&(bre=e)}else Pre.push(Nre=[bre=e,_re=e]);t<xre&&(xre=t),t>wre&&(wre=t),Mre=n,Sre=e}function Xre(){Hre.point=Kre}function Yre(){Nre[0]=bre,Nre[1]=_re,Hre.point=$re,Mre=null}function Qre(e,t){if(Mre){var n=e-Sre;Ere.add(C9(n)>180?n+(n>0?360:-360):n)}else Tre=e,Cre=t;Ore.point(e,t),Kre(e,t)}function Zre(){Ore.lineStart()}function Jre(){Qre(Tre,Cre),Ore.lineEnd(),C9(Ere)>A9&&(bre=-(_re=180)),Nre[0]=bre,Nre[1]=_re,Mre=null}function eie(e,t){return(t-=e)<0?t+360:t}function tie(e,t){return e[0]-t[0]}function nie(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function rie(e){var t,n,r,i,a,o,s;if(wre=_re=-(bre=xre=1/0),Pre=[],ute(e,Hre),n=Pre.length){for(Pre.sort(tie),t=1,a=[r=Pre[0]];t<n;++t)nie(r,(i=Pre[t])[0])||nie(r,i[1])?(eie(r[0],i[1])>eie(r[0],r[1])&&(r[1]=i[1]),eie(i[0],r[1])>eie(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=eie(r[1],i[0]))>o&&(o=s,bre=i[0],_re=r[1])}return Pre=Nre=null,bre===1/0||xre===1/0?[[NaN,NaN],[NaN,NaN]]:[[bre,xre],[_re,wre]]}function iie(e){return C9(e[0])<=b9?e[0]:j9(e[0])*((C9(e[0])+b9)%w9-b9)}function aie(e,t){var n=iie(t),r=t[1],i=O9(r),a=[O9(n),-P9(n),0],o=0,s=0,l=new Jee;1===i?r=x9+A9:-1===i&&(r=-x9-A9);for(var c=0,u=e.length;c<u;++c)if(h=(d=e[c]).length)for(var d,h,p=d[h-1],f=iie(p),m=p[1]/2+_9,g=O9(m),v=P9(m),A=0;A<h;++A,f=b,g=_,v=w,p=y){var y=d[A],b=iie(y),x=y[1]/2+_9,_=O9(x),w=P9(x),S=b-f,T=S>=0?1:-1,C=T*S,M=C>b9,E=g*_;if(l.add(E9(E*T*O9(C),v*w+E*P9(C))),o+=M?S+T*w9:S,M^f>=n^b>=n){var P=Vre(zre(p),zre(y));Wre(P);var N=Vre(a,P);Wre(N);var k=(M^S>=0?-1:1)*B9(N[2]);(r>k||r===k&&(P[0]||P[1]))&&(s+=M^S>=0?1:-1)}}return(o<-1e-6||o<A9&&l<-1e-12)^1&s}var oie,sie,lie,cie,uie,die,hie,pie,fie,mie,gie,vie,Aie,yie,bie,xie,_ie={Feature:function(e,t){return Sie(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)if(Sie(n[r].geometry,t))return!0;return!1}},wie={Sphere:function(){return!0},Point:function(e,t){return Tie(e.coordinates,t)},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)if(Tie(n[r],t))return!0;return!1},LineString:function(e,t){return Cie(e.coordinates,t)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)if(Cie(n[r],t))return!0;return!1},Polygon:function(e,t){return Mie(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)if(Mie(n[r],t))return!0;return!1},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)if(Sie(n[r],t))return!0;return!1}};function Sie(e,t){return!(!e||!wie.hasOwnProperty(e.type))&&wie[e.type](e,t)}function Tie(e,t){return 0===vte(e,t)}function Cie(e,t){for(var n,r,i,a=0,o=e.length;a<o;a++){if(0===(r=vte(e[a],t)))return!0;if(a>0&&(i=vte(e[a],e[a-1]))>0&&n<=i&&r<=i&&(n+r-i)*(1-Math.pow((n-r)/i,2))<y9*i)return!0;n=r}return!1}function Mie(e,t){return!!aie(e.map(Eie),Pie(t))}function Eie(e){return(e=e.map(Pie)).pop(),e}function Pie(e){return[e[0]*T9,e[1]*T9]}var Nie={sphere:ete,point:kie,lineStart:Lie,lineEnd:Die,polygonStart:function(){Nie.lineStart=Iie,Nie.lineEnd=Bie},polygonEnd:function(){Nie.lineStart=Lie,Nie.lineEnd=Die}};function kie(e,t){e*=T9;var n=P9(t*=T9);Rie(n*P9(e),n*O9(e),O9(t))}function Rie(e,t,n){++oie,lie+=(e-lie)/oie,cie+=(t-cie)/oie,uie+=(n-uie)/oie}function Lie(){Nie.point=Oie}function Oie(e,t){e*=T9;var n=P9(t*=T9);yie=n*P9(e),bie=n*O9(e),xie=O9(t),Nie.point=jie,Rie(yie,bie,xie)}function jie(e,t){e*=T9;var n=P9(t*=T9),r=n*P9(e),i=n*O9(e),a=O9(t),o=E9(D9((o=bie*a-xie*i)*o+(o=xie*r-yie*a)*o+(o=yie*i-bie*r)*o),yie*r+bie*i+xie*a);sie+=o,die+=o*(yie+(yie=r)),hie+=o*(bie+(bie=i)),pie+=o*(xie+(xie=a)),Rie(yie,bie,xie)}function Die(){Nie.point=kie}function Iie(){Nie.point=Fie}function Bie(){zie(vie,Aie),Nie.point=kie}function Fie(e,t){vie=e,Aie=t,e*=T9,t*=T9,Nie.point=zie;var n=P9(t);yie=n*P9(e),bie=n*O9(e),xie=O9(t),Rie(yie,bie,xie)}function zie(e,t){e*=T9;var n=P9(t*=T9),r=n*P9(e),i=n*O9(e),a=O9(t),o=bie*a-xie*i,s=xie*r-yie*a,l=yie*i-bie*r,c=R9(o,s,l),u=B9(c),d=c&&-u/c;fie.add(d*o),mie.add(d*s),gie.add(d*l),sie+=u,die+=u*(yie+(yie=r)),hie+=u*(bie+(bie=i)),pie+=u*(xie+(xie=a)),Rie(yie,bie,xie)}function Uie(e){oie=sie=lie=cie=uie=die=hie=pie=0,fie=new Jee,mie=new Jee,gie=new Jee,ute(e,Nie);var t=+fie,n=+mie,r=+gie,i=R9(t,n,r);return i<y9&&(t=die,n=hie,r=pie,sie<A9&&(t=lie,n=cie,r=uie),(i=R9(t,n,r))<y9)?[NaN,NaN]:[E9(n,t)*S9,B9(r/i)*S9]}const Vie=1e-6;class Gie{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>Vie||Math.abs(this._y1-i)>Vie)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class qie{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Wie{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t))||!((i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this;let i,a;const o=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let f,m,g=0,v=0,A=n.length;g<A;g+=3,v+=2){const r=2*n[g],s=2*n[g+1],l=2*n[g+2],c=e[r],u=e[r+1],d=e[s],h=e[s+1],p=e[l],A=e[l+1],y=d-c,b=h-u,x=p-c,_=A-u,w=2*(y*_-b*x);if(Math.abs(w)<1e-9){if(void 0===i){i=a=0;for(const n of t)i+=e[2*n],a+=e[2*n+1];i/=t.length,a/=t.length}const n=1e9*Math.sign((i-c)*_-(a-u)*x);f=(c+p)/2-n*_,m=(u+A)/2+n*x}else{const e=1/w,t=y*y+b*b,n=x*x+_*_;f=c+(_*t-b*n)*e,m=u+(y*n-x*t)*e}o[v]=f,o[v+1]=m}let s,l,c,u=t[t.length-1],d=4*u,h=e[2*u],p=e[2*u+1];r.fill(0);for(let f=0;f<t.length;++f)u=t[f],s=d,l=h,c=p,d=4*u,h=e[2*u],p=e[2*u+1],r[s+2]=r[d]=c-p,r[s+3]=r[d+1]=h-l}render(e){const t=null==e?e=new Gie:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let c=0,u=n.length;c<u;++c){const t=n[c];if(t<c)continue;const r=2*Math.floor(c/3),i=2*Math.floor(t/3),o=a[r],s=a[r+1],l=a[i],u=a[i+1];this._renderSegment(o,s,l,u,e)}let s,l=i[i.length-1];for(let c=0;c<i.length;++c){s=l,l=i[c];const t=2*Math.floor(r[l]/3),n=a[t],u=a[t+1],d=4*s,h=this._project(n,u,o[d+2],o[d+3]);h&&this._renderSegment(n,u,h[0],h[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new Gie:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new Gie:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let a=2;a<i;a+=2)r[a]===r[a-2]&&r[a+1]===r[a-1]||t.lineTo(r[a],r[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new qie;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)===t&&(n=+n)===n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]===e[a]&&t[r+1]===e[a+1]&&t[(r+2)%i]===e[(a+o-2)%o]&&t[(r+3)%i]===e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3===2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return this._simplify(n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t))}_clipFinite(e,t){const n=t.length;let r,i,a,o,s=null,l=t[n-2],c=t[n-1],u=this._regioncode(l,c),d=0;for(let h=0;h<n;h+=2)if(r=l,i=c,l=t[h],c=t[h+1],a=u,u=this._regioncode(l,c),0===a&&0===u)o=d,d=0,s?s.push(l,c):s=[l,c];else{let t,n,h,p,f;if(0===a){if(null===(t=this._clipSegment(r,i,l,c,a,u)))continue;[n,h,p,f]=t}else{if(null===(t=this._clipSegment(l,c,r,i,u,a)))continue;[p,f,n,h]=t,o=d,d=this._edgecode(n,h),o&&d&&this._edge(e,o,d,s,s.length),s?s.push(n,h):s=[n,h]}o=d,d=this._edgecode(p,f),o&&d&&this._edge(e,o,d,s,s.length),s?s.push(p,f):s=[p,f]}if(s)o=d,d=this._edgecode(s[0],s[1]),o&&d&&this._edge(e,o,d,s,s.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(e,t,n,r,i,a){const o=i<a;for(o&&([e,t,n,r,i,a]=[n,r,e,t,a,i]);;){if(0===i&&0===a)return o?[n,r,e,t]:[e,t,n,r];if(i&a)return null;let s,l,c=i||a;8&c?(s=e+(n-e)*(this.ymax-t)/(r-t),l=this.ymax):4&c?(s=e+(n-e)*(this.ymin-t)/(r-t),l=this.ymin):2&c?(l=t+(r-t)*(this.xmax-e)/(n-e),s=this.xmax):(l=t+(r-t)*(this.xmin-e)/(n-e),s=this.xmin),i?(e=s,t=l,i=this._regioncode(e,t)):(n=s,r=l,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let l,c=0,u=s.length,d=this._edgecode(s[u-2],s[u-1]);c<u;c+=2)l=d,d=this._edgecode(s[c],s[c+1]),l&&d&&(c=this._edge(e,l,d,s,c),u=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const n=(t+2)%e.length,r=(t+4)%e.length;(e[t]===e[n]&&e[n]===e[r]||e[t+1]===e[n+1]&&e[n+1]===e[r+1])&&(e.splice(n,2),t-=2)}e.length||(e=null)}return e}}const Hie=2*Math.PI,$ie=Math.pow;function Kie(e){return e[0]}function Xie(e){return e[1]}function Yie(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Qie{static from(e,t=Kie,n=Xie,r){return new Qie("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new ore(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const e=2*t[r],i=2*t[r+1],a=2*t[r+2];if((n[a]-n[e])*(n[i+1]-n[e+1])-(n[i]-n[e])*(n[a+1]-n[e+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let a=0,o=t.length/2;a<o;++a){const e=Yie(t[2*a],t[2*a+1],i);t[2*a]=e[0],t[2*a+1]=e[1]}this._delaunator=new ore(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const e=i[s%3===2?s-2:s+1];-1!==n[s]&&-1!==a[e]||(a[e]=s)}for(let s=0,l=r.length;s<l;++s)o[r[s]]=s;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],a[r[0]]=1,2===r.length&&(a[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(e){return new Wie(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,c=-1;do{if(yield c=a[l],l=l%3===2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==c&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!==e||(t=+t)!==t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let c=e,u=$ie(t-l[2*e],2)+$ie(n-l[2*e+1],2);const d=r[e];let h=d;do{let r=s[h];const d=$ie(t-l[2*r],2)+$ie(n-l[2*r+1],2);if(d<u&&(u=d,c=r),h=h%3===2?h-2:h+1,s[h]!==e)break;if(h=o[h],-1===h){if(h=i[(a[e]+1)%i.length],h!==r&&$ie(t-l[2*h],2)+$ie(n-l[2*h+1],2)<u)return h;break}}while(h!==d);return c}render(e){const t=null==e?e=new Gie:void 0,{points:n,halfedges:r,triangles:i}=this;for(let a=0,o=r.length;a<o;++a){const t=r[a];if(t<a)continue;const o=2*i[a],s=2*i[t];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){void 0!==t||e&&"function"===typeof e.moveTo||(t=e,e=null),t=void 0==t?2:+t;const n=null==e?e=new Gie:void 0,{points:r}=this;for(let i=0,a=r.length;i<a;i+=2){const n=r[i],a=r[i+1];e.moveTo(n+t,a),e.arc(n,a,t,0,Hie)}return n&&n.value()}renderHull(e){const t=null==e?e=new Gie:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let o=1;o<a;++o){const t=2*n[o];e.lineTo(r[t],r[t+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new qie;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new Gie:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new qie;return this.renderTriangle(e,t),t.value()}}function Zie(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function Jie(e,t){return C9(e)>b9&&(e-=Math.round(e/w9)*w9),[e,t]}function eae(e,t,n){return(e%=w9)?t||n?Zie(nae(e),rae(t,n)):nae(e):t||n?rae(t,n):Jie}function tae(e){return function(t,n){return C9(t+=e)>b9&&(t-=Math.round(t/w9)*w9),[t,n]}}function nae(e){var t=tae(e);return t.invert=tae(-e),t}function rae(e,t){var n=P9(e),r=O9(e),i=P9(t),a=O9(t);function o(e,t){var o=P9(t),s=P9(e)*o,l=O9(e)*o,c=O9(t),u=c*n+s*r;return[E9(l*i-u*a,s*n-c*r),B9(u*i+l*a)]}return o.invert=function(e,t){var o=P9(t),s=P9(e)*o,l=O9(e)*o,c=O9(t),u=c*i-l*a;return[E9(l*i+c*a,s*n+u*r),B9(u*n-s*r)]},o}function iae(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:ete,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function aae(e,t){return C9(e[0]-t[0])<A9&&C9(e[1]-t[1])<A9}function oae(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function sae(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(aae(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new oae(r,e,null,!0)),l.push(n.o=new oae(r,null,n,!1)),s.push(n=new oae(o,e,null,!1)),l.push(n.o=new oae(o,null,n,!0))}}),s.length){for(l.sort(t),lae(s),lae(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var c,u,d=s[0];;){for(var h=d,p=!0;h.v;)if((h=h.n)===d)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(a=0,o=c.length;a<o;++a)i.point((u=c[a])[0],u[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(p)for(c=h.p.z,a=c.length-1;a>=0;--a)i.point((u=c[a])[0],u[1]);else r(h.x,h.p.x,-1,i);h=h.p}c=(h=h.o).z,p=!p}while(!h.v);i.lineEnd()}}}function lae(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function cae(e,t,n,r){return function(i){var a,o,s,l=t(i),c=iae(),u=t(c),d=!1,h={point:p,lineStart:m,lineEnd:g,polygonStart:function(){h.point=v,h.lineStart=A,h.lineEnd=y,o=[],a=[]},polygonEnd:function(){h.point=p,h.lineStart=m,h.lineEnd=g,o=$ne(o);var e=aie(a,r);o.length?(d||(i.polygonStart(),d=!0),sae(o,dae,e,n,i)):e&&(d||(i.polygonStart(),d=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),d&&(i.polygonEnd(),d=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(t,n){e(t,n)&&i.point(t,n)}function f(e,t){l.point(e,t)}function m(){h.point=f,l.lineStart()}function g(){h.point=p,l.lineEnd()}function v(e,t){s.push([e,t]),u.point(e,t)}function A(){u.lineStart(),s=[]}function y(){v(s[0][0],s[0][1]),u.lineEnd();var e,t,n,r,l=u.clean(),h=c.result(),p=h.length;if(s.pop(),a.push(s),s=null,p)if(1&l){if((t=(n=h[0]).length-1)>0){for(d||(i.polygonStart(),d=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else p>1&&2&l&&h.push(h.pop().concat(h.shift())),o.push(h.filter(uae))}return h}}function uae(e){return e.length>1}function dae(e,t){return((e=e.x)[0]<0?e[1]-x9-A9:x9-e[1])-((t=t.x)[0]<0?t[1]-x9-A9:x9-t[1])}Jie.invert=Jie;var hae=cae(function(){return!0},function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?b9:-b9,l=C9(a-n);C9(l-b9)<A9?(e.point(n,r=(r+o)/2>0?x9:-x9),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=b9&&(C9(n-i)<A9&&(n-=i*A9),C9(a-s)<A9&&(a-=s*A9),r=function(e,t,n,r){var i,a,o=O9(e-n);return C9(o)>A9?M9((O9(t)*(a=P9(r))*O9(n)-O9(r)*(i=P9(t))*O9(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}},function(e,t,n,r){var i;if(null==e)i=n*x9,r.point(-b9,i),r.point(0,i),r.point(b9,i),r.point(b9,0),r.point(b9,-i),r.point(0,-i),r.point(-b9,-i),r.point(-b9,0),r.point(-b9,i);else if(C9(e[0]-t[0])>A9){var a=e[0]<t[0]?b9:-b9;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])},[-b9,-x9]);function pae(e,t,n,r,i,a){if(n){var o=P9(t),s=O9(t),l=r*n;null==i?(i=t+r*w9,a=t-l/2):(i=fae(o,i),a=fae(o,a),(r>0?i<a:i>a)&&(i+=r*w9));for(var c,u=i;r>0?u>a:u<a;u-=l)c=Fre([o,-s*P9(u),-s*O9(u)]),e.point(c[0],c[1])}}function fae(e,t){(t=zre(t))[0]-=e,Wre(t);var n=function(e){return e>1?0:e<-1?b9:Math.acos(e)}(-t[1]);return((-t[2]<0?-n:n)+w9-A9)%w9}var mae=1e9,gae=-mae;function vae(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,c){var u=0,d=0;if(null==i||(u=o(i,s))!==(d=o(a,s))||l(i,a)<0^s>0)do{c.point(0===u||3===u?e:n,u>1?r:t)}while((u=(u+s+4)%4)!==d);else c.point(a[0],a[1])}function o(r,i){return C9(r[0]-e)<A9?i>0?0:3:C9(r[0]-n)<A9?i>0?2:1:C9(r[1]-t)<A9?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,c,u,d,h,p,f,m,g,v,A,y=o,b=iae(),x={point:_,lineStart:function(){x.point=w,c&&c.push(u=[]);v=!0,g=!1,f=m=NaN},lineEnd:function(){l&&(w(d,h),p&&g&&b.rejoin(),l.push(b.result()));x.point=_,g&&y.lineEnd()},polygonStart:function(){y=b,l=[],c=[],A=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=c.length;n<i;++n)for(var a,o,s=c[n],l=1,u=s.length,d=s[0],h=d[0],p=d[1];l<u;++l)a=h,o=p,h=(d=s[l])[0],p=d[1],o<=r?p>r&&(h-a)*(r-o)>(p-o)*(e-a)&&++t:p<=r&&(h-a)*(r-o)<(p-o)*(e-a)&&--t;return t}(),n=A&&t,i=(l=$ne(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&sae(l,s,t,a,o),o.polygonEnd());y=o,l=c=u=null}};function _(e,t){i(e,t)&&y.point(e,t)}function w(a,o){var s=i(a,o);if(c&&u.push([a,o]),v)d=a,h=o,p=s,v=!1,s&&(y.lineStart(),y.point(a,o));else if(s&&g)y.point(a,o);else{var l=[f=Math.max(gae,Math.min(mae,f)),m=Math.max(gae,Math.min(mae,m))],b=[a=Math.max(gae,Math.min(mae,a)),o=Math.max(gae,Math.min(mae,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],c=0,u=1,d=t[0]-s,h=t[1]-l;if(o=n-s,d||!(o>0)){if(o/=d,d<0){if(o<c)return;o<u&&(u=o)}else if(d>0){if(o>u)return;o>c&&(c=o)}if(o=i-s,d||!(o<0)){if(o/=d,d<0){if(o>u)return;o>c&&(c=o)}else if(d>0){if(o<c)return;o<u&&(u=o)}if(o=r-l,h||!(o>0)){if(o/=h,h<0){if(o<c)return;o<u&&(u=o)}else if(h>0){if(o>u)return;o>c&&(c=o)}if(o=a-l,h||!(o<0)){if(o/=h,h<0){if(o>u)return;o>c&&(c=o)}else if(h>0){if(o<c)return;o<u&&(u=o)}return c>0&&(e[0]=s+c*d,e[1]=l+c*h),u<1&&(t[0]=s+u*d,t[1]=l+u*h),!0}}}}}(l,b,e,t,n,r)?s&&(y.lineStart(),y.point(a,o),A=!1):(g||(y.lineStart(),y.point(l[0],l[1])),y.point(b[0],b[1]),s||y.lineEnd(),A=!1)}f=a,m=o,g=s}return x}}var Aae=e=>e;function yae(e){return function(t){var n=new bae;for(var r in e)n[r]=e[r];return n.stream=t,n}}function bae(){}bae.prototype={constructor:bae,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var xae=1/0,_ae=xae,wae=-xae,Sae=wae,Tae={point:function(e,t){e<xae&&(xae=e);e>wae&&(wae=e);t<_ae&&(_ae=t);t>Sae&&(Sae=t)},lineStart:ete,lineEnd:ete,polygonStart:ete,polygonEnd:ete,result:function(){var e=[[xae,_ae],[wae,Sae]];return wae=Sae=-(_ae=xae=1/0),e}};var Cae=Tae;function Mae(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),ute(n,e.stream(Cae)),t(Cae.result()),null!=r&&e.clipExtent(r),e}function Eae(e,t,n){return Mae(e,function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var Pae=P9(30*T9);function Nae(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,c,u,d,h,p,f,m,g){var v=c-r,A=u-i,y=v*v+A*A;if(y>4*t&&m--){var b=o+h,x=s+p,_=l+f,w=D9(b*b+x*x+_*_),S=B9(_/=w),T=C9(C9(_)-1)<A9||C9(a-d)<A9?(a+d)/2:E9(x,b),C=e(T,S),M=C[0],E=C[1],P=M-r,N=E-i,k=A*P-v*N;(k*k/y>t||C9((v*P+A*N)/y-.5)>.3||o*h+s*p+l*f<Pae)&&(n(r,i,a,o,s,l,M,E,T,b/=w,x/=w,_,m,g),g.point(M,E),n(M,E,T,b,x,_,c,u,d,h,p,f,m,g))}}return function(t){var r,i,a,o,s,l,c,u,d,h,p,f,m={point:g,lineStart:v,lineEnd:y,polygonStart:function(){t.polygonStart(),m.lineStart=b},polygonEnd:function(){t.polygonEnd(),m.lineStart=v}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function v(){u=NaN,m.point=A,t.lineStart()}function A(r,i){var a=zre([r,i]),o=e(r,i);n(u,d,c,h,p,f,u=o[0],d=o[1],c=r,h=a[0],p=a[1],f=a[2],16,t),t.point(u,d)}function y(){m.point=g,t.lineEnd()}function b(){v(),m.point=x,m.lineEnd=_}function x(e,t){A(r=e,t),i=u,a=d,o=h,s=p,l=f,m.point=A}function _(){n(u,d,c,h,p,f,i,a,r,o,s,l,16,t),m.lineEnd=y,y()}return m}}(e,t):function(e){return yae({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var kae=yae({point:function(e,t){this.stream.point(e*T9,t*T9)}});function Rae(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=P9(a),s=O9(a),l=o*e,c=s*e,u=o/e,d=s/e,h=(s*n-o*t)/e,p=(s*t+o*n)/e;function f(e,a){return[l*(e*=r)-c*(a*=i)+t,n-c*e-l*a]}return f.invert=function(e,t){return[r*(u*e-d*t+h),i*(p-d*e-u*t)]},f}function Lae(e){return function(e){var t,n,r,i,a,o,s,l,c,u,d=150,h=480,p=250,f=0,m=0,g=0,v=0,A=0,y=0,b=1,x=1,_=null,w=hae,S=null,T=Aae,C=.5;function M(e){return l(e[0]*T9,e[1]*T9)}function E(e){return(e=l.invert(e[0],e[1]))&&[e[0]*S9,e[1]*S9]}function P(){var e=Rae(d,0,0,b,x,y).apply(null,t(f,m)),r=Rae(d,h-e[0],p-e[1],b,x,y);return n=eae(g,v,A),s=Zie(t,r),l=Zie(n,s),o=Nae(s,C),N()}function N(){return c=u=null,M}return M.stream=function(e){return c&&u===e?c:c=kae(function(e){return yae({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(w(o(T(u=e)))))},M.preclip=function(e){return arguments.length?(w=e,_=void 0,N()):w},M.postclip=function(e){return arguments.length?(T=e,S=r=i=a=null,N()):T},M.clipAngle=function(e){return arguments.length?(w=+e?function(e){var t=P9(e),n=2*T9,r=t>0,i=C9(t)>A9;function a(e,n){return P9(e)*P9(n)>t}function o(e,n,r){var i=[1,0,0],a=Vre(zre(e),zre(n)),o=Ure(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var c=t*o/l,u=-t*s/l,d=Vre(i,a),h=qre(i,c);Gre(h,qre(a,u));var p=d,f=Ure(h,p),m=Ure(p,p),g=f*f-m*(Ure(h,h)-1);if(!(g<0)){var v=D9(g),A=qre(p,(-f-v)/m);if(Gre(A,h),A=Fre(A),!r)return A;var y,b=e[0],x=n[0],_=e[1],w=n[1];x<b&&(y=b,b=x,x=y);var S=x-b,T=C9(S-b9)<A9;if(!T&&w<_&&(y=_,_=w,w=y),T||S<A9?T?_+w>0^A[1]<(C9(A[0]-b)<A9?_:w):_<=A[1]&&A[1]<=w:S>b9^(b<=A[0]&&A[0]<=x)){var C=qre(p,(-f+v)/m);return Gre(C,h),[A,Fre(C)]}}}function s(t,n){var i=r?e:b9-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return cae(a,function(e){var t,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(d,h){var p,f=[d,h],m=a(d,h),g=r?m?0:s(d,h):m?s(d+(d<0?b9:-b9),h):0;if(!t&&(c=l=m)&&e.lineStart(),m!==l&&(!(p=o(t,f))||aae(t,p)||aae(f,p))&&(f[2]=1),m!==l)u=0,m?(e.lineStart(),p=o(f,t),e.point(p[0],p[1])):(p=o(t,f),e.point(p[0],p[1],2),e.lineEnd()),t=p;else if(i&&t&&r^m){var v;g&n||!(v=o(f,t,!0))||(u=0,r?(e.lineStart(),e.point(v[0][0],v[0][1]),e.point(v[1][0],v[1][1]),e.lineEnd()):(e.point(v[1][0],v[1][1]),e.lineEnd(),e.lineStart(),e.point(v[0][0],v[0][1],3)))}!m||t&&aae(t,f)||e.point(f[0],f[1]),t=f,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return u|(c&&l)<<1}}},function(t,r,i,a){pae(a,e,n,i,t,r)},r?[0,-e]:[-b9,e-b9])}(_=e*T9):(_=null,hae),N()):_*S9},M.clipExtent=function(e){return arguments.length?(T=null==e?(S=r=i=a=null,Aae):vae(S=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),N()):null==S?null:[[S,r],[i,a]]},M.scale=function(e){return arguments.length?(d=+e,P()):d},M.translate=function(e){return arguments.length?(h=+e[0],p=+e[1],P()):[h,p]},M.center=function(e){return arguments.length?(f=e[0]%360*T9,m=e[1]%360*T9,P()):[f*S9,m*S9]},M.rotate=function(e){return arguments.length?(g=e[0]%360*T9,v=e[1]%360*T9,A=e.length>2?e[2]%360*T9:0,P()):[g*S9,v*S9,A*S9]},M.angle=function(e){return arguments.length?(y=e%360*T9,P()):y*S9},M.reflectX=function(e){return arguments.length?(b=e?-1:1,P()):b<0},M.reflectY=function(e){return arguments.length?(x=e?-1:1,P()):x<0},M.precision=function(e){return arguments.length?(o=Nae(s,C=e*e),N()):D9(C)},M.fitExtent=function(e,t){return Eae(M,e,t)},M.fitSize=function(e,t){return function(e,t,n){return Eae(e,[[0,0],t],n)}(M,e,t)},M.fitWidth=function(e,t){return function(e,t,n){return Mae(e,function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])},n)}(M,e,t)},M.fitHeight=function(e,t){return function(e,t,n){return Mae(e,function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])},n)}(M,e,t)},function(){return t=e.apply(this,arguments),M.invert=t.invert&&E,P()}}(function(){return e})()}function Oae(e,t){var n=P9(t),r=1+P9(e)*n;return[n*O9(e)/r,O9(t)/r]}Oae.invert=function(e){return function(t,n){var r=D9(t*t+n*n),i=e(r),a=O9(i),o=P9(i);return[E9(t*a,r*o),B9(r&&n*a/r)]}}(function(e){return 2*M9(e)});const jae=Math.PI,Dae=jae/2,Iae=180/jae,Bae=jae/180,Fae=(Math.abs,Math.atan,Math.atan2),zae=Math.cos,Uae=(Math.ceil,Math.exp,Math.floor,Math.log,Math.max),Vae=Math.min,Gae=(Math.pow,Math.sin),qae=Math.sign||function(e){return e>0?1:e<0?-1:0},Wae=Math.sqrt;Math.tan;function Hae(e){return e>1?Dae:e<-1?-Dae:Math.asin(e)}function $ae(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Kae(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Xae(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Yae(e){var t=Wae(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Qae(e){return[Fae(e[1],e[0])*Iae,Hae(Uae(-1,Vae(1,e[2])))*Iae]}function Zae(e){const t=e[0]*Bae,n=e[1]*Bae,r=zae(n);return[r*zae(t),r*Gae(t),Gae(n)]}function Jae(e){return e=e.map(e=>Zae(e)),$ae(e[0],Kae(e[2],e[1]))}function eoe(e){const t=function(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=function(e){function t(t){return(t=e(t[0]*T9,t[1]*T9))[0]*=S9,t[1]*=S9,t}return e=eae(e[0]*T9,e[1]*T9,e.length>2?e[2]*T9:0),t.invert=function(t){return(t=e.invert(t[0]*T9,t[1]*T9))[0]*=S9,t[1]*=S9,t},t}(e[t]),r=Lae(Oae).scale(250).clipAngle(142).translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(r);const i=[];let a=1;for(let h=0,p=e.length;h<p;h++){let t=e[h][0]**2+e[h][1]**2;!isFinite(t)||t>1e32?i.push(h):t>a&&(a=t)}const o=1e6*Wae(a);i.forEach(t=>e[t]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const s=Qie.from(e);s.projection=r;const{triangles:l,halfedges:c,inedges:u}=s,d=[];for(let h=0,p=c.length;h<p;h++)if(c[h]<0){const e=h%3==2?h-2:h+1,n=h%3==0?h+2:h-1,r=c[e],i=c[n];c[r]=i,c[i]=r,c[e]=c[n]=-1,l[h]=l[e]=l[n]=t,u[l[r]]=r%3==0?r+2:r-1,u[l[i]]=i%3==0?i+2:i-1,d.push(Math.min(h,e,n)),h+=2-h%3}else l[h]>e.length-3-1&&(l[h]=t);return s}(e),n=function(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let r=0,i=t.length/3;r<i;r++){const e=t[3*r],i=t[3*r+1],a=t[3*r+2];e!==i&&i!==a&&n.push([e,a,i])}return n}(t),r=function(e,t){const n=new Set;return 2===t.length?[[0,1]]:(e.forEach(e=>{if(e[0]!==e[1]&&!(Jae(e.map(e=>t[e]))<0))for(let t,r=0;r<3;r++)t=(r+1)%3,n.add(Kne([e[r],e[t]]).join("-"))}),Array.from(n,e=>e.split("-").map(Number)))}(n,e),i=function(e,t){const n=[];e.forEach(e=>{for(let t=0;t<3;t++){const r=e[t],i=e[(t+1)%3];n[r]=n[r]||[],n[r].push(i)}}),0===e.length&&(2===t?(n[0]=[1],n[1]=[0]):1===t&&(n[0]=[]));return n}(n,e.length),a=function(e,t){function n(e,t){let n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}return function(r,i,a){void 0===a&&(a=0);let o,s,l=a;const c=Zae([r,i]);do{o=a,a=null,s=n(c,Zae(t[o])),e[o].forEach(e=>{let r=n(c,Zae(t[e]));if(r<s)return s=r,a=e,void(l=e)})}while(null!==a);return l}}(i,e),o=function(e,t){return e.map(e=>{const n=e.map(e=>t[e]).map(Zae);return Qae(Yae(Xae(Xae(Kae(n[1],n[0]),Kae(n[2],n[1])),Kae(n[0],n[2]))))})}(n,e),{polygons:s,centers:l}=function(e,t,n){const r=[],i=e.slice();if(0===t.length){if(n.length<2)return{polygons:r,centers:i};if(2===n.length){const e=Zae(n[0]),t=Zae(n[1]),a=Yae(Xae(e,t)),s=Yae(Kae(e,t)),l=Kae(a,s),c=[a,Kae(a,l),Kae(Kae(a,l),l),Kae(Kae(Kae(a,l),l),l)].map(Qae).map(o);return r.push(c),r.push(c.slice().reverse()),{polygons:r,centers:i}}}t.forEach((e,t)=>{for(let n=0;n<3;n++){const i=e[n],a=e[(n+1)%3],o=e[(n+2)%3];r[i]=r[i]||[],r[i].push([a,o,t,[i,a,o]])}});const a=r.map(e=>{const t=[e[0][2]];let r=e[0][1];for(let n=1;n<e.length;n++)for(let i=0;i<e.length;i++)if(e[i][0]==r){r=e[i][1],t.push(e[i][2]);break}if(t.length>2)return t;if(2==t.length){const r=toe(n[e[0][3][0]],n[e[0][3][1]],i[t[0]]),a=toe(n[e[0][3][2]],n[e[0][3][0]],i[t[0]]),s=o(r),l=o(a);return[t[0],l,t[1],s]}});function o(e){let n=-1;return i.slice(t.length,1/0).forEach((r,i)=>{r[0]===e[0]&&r[1]===e[1]&&(n=i+t.length)}),n<0&&(n=i.length,i.push(e)),n}return{polygons:a,centers:i}}(o,n,e),c=function(e){const t=[];return e.forEach(e=>{if(!e)return;let n=e[e.length-1];for(let r of e)r>n&&t.push([n,r]),n=r}),t}(s),u=function(e,t){const n=new Set,r=[];e.map(e=>{if(!(Jae(e.map(e=>t[e>t.length?0:e]))>1e-12))for(let t=0;t<3;t++){let r=[e[t],e[(t+1)%3]],i=`${r[0]}-${r[1]}`;n.has(i)?n.delete(i):n.add(`${r[1]}-${r[0]}`)}});const i=new Map;let a;if(n.forEach(e=>{e=e.split("-").map(Number),i.set(e[0],e[1]),a=e[0]}),void 0===a)return r;let o=a;do{r.push(o);let e=i.get(o);i.set(o,-1),o=e}while(o>-1&&o!==a);return r}(n,e),d=function(e,t){return function(n){const r=new Map,i=new Map;return e.forEach((e,t)=>{const a=e.join("-");r.set(a,n[t]),i.set(a,!0)}),t.forEach(e=>{let t=0,n=-1;for(let i=0;i<3;i++){let a=Kne([e[i],e[(i+1)%3]]).join("-");r.get(a)>t&&(t=r.get(a),n=a)}i.set(n,!1)}),e.map(e=>i.get(e.join("-")))}}(r,n);return{delaunay:t,edges:r,triangles:n,centers:l,neighbors:i,polygons:s,mesh:c,hull:u,urquhart:d,find:a}}function toe(e,t,n){e=Zae(e),t=Zae(t),n=Zae(n);const r=qae($ae(Kae(t,e),n));return Qae(Yae(Xae(e,t)).map(e=>r*e))}function noe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function roe(e,t,n){return t=ioe(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,aoe()?Reflect.construct(t,[],ioe(e).constructor):t.apply(e,n))}function ioe(e){return ioe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ioe(e)}function aoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(aoe=function(){return!!e})()}function ooe(e,t){return ooe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ooe(e,t)}function soe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||coe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function loe(e){return function(e){if(Array.isArray(e))return noe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||coe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function coe(e,t){if(e){if("string"==typeof e)return noe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?noe(e,t):void 0}}function uoe(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).resolution,n=void 0===t?1/0:t,r=function(e,t){return e.map(function(e){var n,r=[];return e.forEach(function(e){if(n){var i=180*vte(e,n)/Math.PI;if(i>t)for(var a=Ate(n,e),o=1/Math.ceil(i/t),s=o;s<1;)r.push(a(s)),s+=o}r.push(n=e)}),r})}(e,n),i=$ne(r),a=function(e,t){var n={type:"Polygon",coordinates:e},r=rie(n),i=soe(r,2),a=soe(i[0],2),o=a[0],s=a[1],l=soe(i[1],2),c=l[0],u=l[1];if(Math.min(Math.abs(c-o),Math.abs(u-s))<t)return[];var d=o>c||u>=89||s<=-89;return function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minLng,r=t.maxLng,i=t.minLat,a=t.maxLat,o=Math.round(Math.pow(360/e,2)/Math.PI),s=(1+Math.sqrt(5))/2,l=function(e){return e/s*360%360-180},c=function(e){return Math.acos(2*e/o-1)/Math.PI*180-90},u=function(e){return o*(Math.cos((e+90)*Math.PI/180)+1)/2},d=[void 0!==a?Math.ceil(u(a)):0,void 0!==i?Math.floor(u(i)):o-1],h=void 0===n&&void 0===r?function(){return!0}:void 0===n?function(e){return e<=r}:void 0===r?function(e){return e>=n}:r>=n?function(e){return e>=n&&e<=r}:function(e){return e>=n||e<=r},p=[],f=d[0];f<=d[1];f++){var m=l(f);h(m)&&p.push([m,c(f)])}return p}(t,{minLng:o,maxLng:c,minLat:s,maxLat:u}).filter(function(e){return doe(e,n,d)})}(e,n),o=[].concat(loe(i),loe(a)),s={type:"Polygon",coordinates:e},l=soe(rie(s),2),c=soe(l[0],2),u=c[0],d=c[1],h=soe(l[1],2),p=h[0],f=h[1],m=u>p||f>=89||d<=-89,g=[];if(m){var v=function(e){const t=function(e){if(t.delaunay=null,t._data=e,"object"===typeof t._data&&"FeatureCollection"===t._data.type&&(t._data=t._data.features),"object"===typeof t._data){const e=t._data.map(e=>[t._vx(e),t._vy(e),e]).filter(e=>isFinite(e[0]+e[1]));t.points=e.map(e=>[e[0],e[1]]),t.valid=e.map(e=>e[2]),t.delaunay=eoe(t.points)}return t};return t._vx=function(e){return"object"==typeof e&&"type"in e?Uie(e)[0]:0 in e?e[0]:void 0},t._vy=function(e){return"object"==typeof e&&"type"in e?Uie(e)[1]:1 in e?e[1]:void 0},t.x=function(e){return e?(t._vx=e,t):t._vx},t.y=function(e){return e?(t._vy=e,t):t._vy},t.polygons=function(e){if(void 0!==e&&t(e),!t.delaunay)return!1;const n={type:"FeatureCollection",features:[]};return 0===t.valid.length||(t.delaunay.polygons.forEach((e,r)=>n.features.push({type:"Feature",geometry:e?{type:"Polygon",coordinates:[[...e,e[0]].map(e=>t.delaunay.centers[e])]}:null,properties:{site:t.valid[r],sitecoordinates:t.points[r],neighbours:t.delaunay.neighbors[r]}})),1===t.valid.length&&n.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),n},t.triangles=function(e){return void 0!==e&&t(e),!!t.delaunay&&{type:"FeatureCollection",features:t.delaunay.triangles.map((e,n)=>(e=e.map(e=>t.points[e]),e.center=t.delaunay.centers[n],e)).filter(e=>Jae(e)>0).map(e=>({type:"Feature",properties:{circumcenter:e.center},geometry:{type:"Polygon",coordinates:[[...e,e[0]]]}}))}},t.links=function(e){if(void 0!==e&&t(e),!t.delaunay)return!1;const n=t.delaunay.edges.map(e=>vte(t.points[e[0]],t.points[e[1]])),r=t.delaunay.urquhart(n);return{type:"FeatureCollection",features:t.delaunay.edges.map((e,i)=>({type:"Feature",properties:{source:t.valid[e[0]],target:t.valid[e[1]],length:n[i],urquhart:!!r[i]},geometry:{type:"LineString",coordinates:[t.points[e[0]],t.points[e[1]]]}}))}},t.mesh=function(e){return void 0!==e&&t(e),!!t.delaunay&&{type:"MultiLineString",coordinates:t.delaunay.edges.map(e=>[t.points[e[0]],t.points[e[1]]])}},t.cellMesh=function(e){if(void 0!==e&&t(e),!t.delaunay)return!1;const{centers:n,polygons:r}=t.delaunay,i=[];for(const t of r)if(t)for(let e=t.length,r=t[e-1],a=t[0],o=0;o<e;r=a,a=t[++o])a>r&&i.push([n[r],n[a]]);return{type:"MultiLineString",coordinates:i}},t._found=void 0,t.find=function(e,n,r){if(t._found=t.delaunay.find(e,n,t._found),!r||vte([e,n],t.points[t._found])<r)return t._found},t.hull=function(e){void 0!==e&&t(e);const n=t.delaunay.hull,r=t.points;return 0===n.length?null:{type:"Polygon",coordinates:[[...n.map(e=>r[e]),r[n[0]]]]}},e?t(e):t}(o).triangles(),A=new Map(o.map(function(e,t){var n=soe(e,2),r=n[0],i=n[1];return["".concat(r,"-").concat(i),t]}));v.features.forEach(function(e){var t,n=e.geometry.coordinates[0].slice(0,3).reverse(),r=[];if(n.forEach(function(e){var t=soe(e,2),n=t[0],i=t[1],a="".concat(n,"-").concat(i);A.has(a)&&r.push(A.get(a))}),3===r.length){if(r.some(function(e){return e<i.length}))if(!doe(e.properties.circumcenter,s,m))return;(t=g).push.apply(t,r)}})}else if(a.length)for(var y=ore.from(o),b=function(e){var t,n=[2,1,0].map(function(t){return y.triangles[e+t]}),r=n.map(function(e){return o[e]});if(n.some(function(e){return e<i.length})){var a=[0,1].map(function(e){return function(e,t){let n=0,r=0;if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n}(r,function(t){return t[e]})});if(!doe(a,s,m))return 1}(t=g).push.apply(t,loe(n))},x=0,_=y.triangles.length;x<_;x+=3)b(x);else{var w=Zee(r),S=w.vertices,T=w.holes;g=Tee(S,void 0===T?[]:T,2)}var C=fM(Kne(o,function(e){return e[0]}),[0,1]),M=fM(Kne(o,function(e){return e[1]}),[0,1]),E=o.map(function(e){var t=soe(e,2),n=t[0],r=t[1];return[C(n),M(r)]});return{contour:r,triangles:{points:o,indices:g,uvs:E}}}function doe(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?function(e,t){return(e&&_ie.hasOwnProperty(e.type)?_ie[e.type]:Sie)(e,t)}(t,e):kre(e,t)}var hoe=window.THREE?window.THREE:{BufferGeometry:N1,Float32BufferAttribute:_1},poe=(new hoe.BufferGeometry).setAttribute?"setAttribute":"addAttribute",foe=function(e){function t(e,n,r,i,a,o,s){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(l=roe(this,t)).type="ConicPolygonGeometry",l.parameters={polygonGeoJson:e,bottomHeight:n,topHeight:r,closedBottom:i,closedTop:a,includeSides:o,curvatureResolution:s},n=n||0,r=r||1,i=void 0===i||i,a=void 0===a||a,o=void 0===o||o;var c=uoe(e,{resolution:s=s||5}),u=c.contour,d=c.triangles,h=$ne(d.uvs),p=[],f=[],m=[],g=0,v=function(e){var t=Math.round(p.length/3),n=m.length;p=p.concat(e.vertices),f=f.concat(e.uvs),m=m.concat(t?e.indices.map(function(e){return e+t}):e.indices),l.addGroup(n,m.length-n,g++)};function A(e,t){var n="function"===typeof t?t:function(){return t},r=e.map(function(e){return e.map(function(e){var t=soe(e,2),r=t[0],i=t[1];return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return[n*Math.sin(r)*Math.cos(i),n*Math.cos(r),n*Math.sin(r)*Math.sin(i)]}(i,r,n(r,i))})});return Zee(r)}function y(e){return{indices:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?d.indices:d.indices.slice().reverse(),vertices:A([d.points],e).vertices,uvs:h}}return o&&v(function(){for(var e=A(u,n),t=e.vertices,i=e.holes,a=A(u,r).vertices,o=$ne([a,t]),s=Math.round(a.length/3),l=new Set(i),c=0,d=[],h=0;h<s;h++){var p=h+1;if(p===s)p=c;else if(l.has(p)){var f=p;p=c,c=f}d.push(h,h+s,p+s),d.push(p+s,p,h)}for(var m=[],g=1;g>=0;g--)for(var v=0;v<s;v+=1)m.push(v/(s-1),g);return{indices:d,vertices:o,uvs:m}}()),i&&v(y(n,!1)),a&&v(y(r,!0)),l.setIndex(m),l[poe]("position",new hoe.Float32BufferAttribute(p,3)),l[poe]("uv",new hoe.Float32BufferAttribute(f,2)),l.computeVertexNormals(),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ooe(e,t)}(t,e),function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(t)}(hoe.BufferGeometry);function moe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function goe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||yoe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function voe(e){return function(e){if(Array.isArray(e))return moe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||yoe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Aoe(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function yoe(e,t){if(e){if("string"==typeof e)return moe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?moe(e,t):void 0}}var boe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(t instanceof Array?t.length?t:[void 0]:[t]).map(function(e){return{keyAccessor:e,isProp:!(e instanceof Function)}}),a=e.reduce(function(e,t){var r=e,a=t;return i.forEach(function(e,t){var o,s=e.keyAccessor;if(e.isProp){var l=a,c=l[s],u=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(l,[s].map(Aoe));o=c,a=u}else o=s(a,t);t+1<i.length?(r.hasOwnProperty(o)||(r[o]={}),r=r[o]):n?(r.hasOwnProperty(o)||(r[o]=[]),r[o].push(a)):r[o]=a}),e},{});n instanceof Function&&function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r===i.length?Object.keys(t).forEach(function(e){return t[e]=n(t[e])}):Object.values(t).forEach(function(t){return e(t,r+1)})}(a);var o=a;return r&&(o=[],function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.length===i.length?o.push({keys:n,vals:t}):Object.entries(t).forEach(function(t){var r=goe(t,2),i=r[0],a=r[1];return e(a,[].concat(voe(n),[i]))})}(a),t instanceof Array&&0===t.length&&1===o.length&&(o[0].keys=[])),o},xoe=function(e){var t,n="undefined"!==typeof(e=e||{})?e:{},r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);var i,a=[],o="";"undefined"!==typeof document&&document.currentScript&&(o=document.currentScript.src),o=0!==o.indexOf("blob:")?o.substr(0,o.lastIndexOf("/")+1):"",i=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200==r.status||0==r.status&&r.response)t(r.response);else{var i=Y(e);i?t(i.buffer):n()}},r.onerror=n,r.send(null)};var s=n.print||console.log.bind(console),l=n.printErr||console.warn.bind(console);for(t in r)r.hasOwnProperty(t)&&(n[t]=r[t]);r=null,n.arguments&&(a=n.arguments);var c=0;var u=!1;function d(e){var t,r=n["_"+e];return t="Cannot call unknown function "+e+", make sure it is exported",r||ce("Assertion failed: "+t),r}function h(e,t,n,r,i){var a={string:function(e){var t=0;if(null!==e&&void 0!==e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(e,v,t,n)})(e,t=te(n),n)}return t},array:function(e){var t=te(e.length);return function(e,t){g.set(e,t)}(e,t),t}};var o=d(e),s=[],l=0;if(r)for(var c=0;c<r.length;c++){var u=a[n[c]];u?(0===l&&(l=re()),s[c]=u(r[c])):s[c]=r[c]}var h=o.apply(null,s);return h=function(e){return"string"===t?f(e):"boolean"===t?Boolean(e):e}(h),0!==l&&ne(l),h}var p="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function f(e,t){return e?function(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&p)return p.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|l:(7&o)<<18|s<<12|l<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var c=o-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(v,e,t):""}var m,g,v,A,y,b,x;"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");function _(e,t){return e%t>0&&(e+=t-e%t),e}function w(e){m=e,n.HEAP8=g=new Int8Array(e),n.HEAP16=A=new Int16Array(e),n.HEAP32=y=new Int32Array(e),n.HEAPU8=v=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=b=new Float32Array(e),n.HEAPF64=x=new Float64Array(e)}var S=n.TOTAL_MEMORY||33554432;function T(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"===typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}S=(m=n.buffer?n.buffer:new ArrayBuffer(S)).byteLength,w(m),y[7156]=5271536;var C=[],M=[],E=[],P=[];function N(e){C.unshift(e)}function k(e){P.unshift(e)}var R=Math.abs,L=Math.ceil,O=Math.floor,j=Math.min,D=0,I=null,B=null;n.preloadedImages={},n.preloadedAudios={};var F,z,U=null,V="data:application/octet-stream;base64,";function G(e){return String.prototype.startsWith?e.startsWith(V):0===e.indexOf(V)}U="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAdmVydGV4Um90YXRpb25zAGNlbGxUb1ZlcnRleABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";function q(e){return e}function W(e){return e.replace(/\b__Z[\w\d_]+/g,function(e){return e===e?e:e+" ["+e+"]"})}function H(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(or){e=or}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function $(){return g.length}function K(e){try{var t=new ArrayBuffer(e);if(t.byteLength!=e)return;return new Int8Array(t).set(g),ee(t),w(t),1}catch(or){}}var X="function"===typeof atob?atob:function(e){var t,n,r,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,n=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,r=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(n)),64!==o&&(l+=String.fromCharCode(r))}while(c<e.length);return l};function Y(e){if(G(e))return function(e){try{for(var t=X(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}catch(Zr){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(V.length))}var Q,Z={a:ce,b:function(e){c=e},c:function(){return c},d:function(e,t,n,r){ce("Assertion failed: "+f(e)+", at: "+[t?f(t):"unknown filename",n,r?f(r):"unknown function"])},e:function(e){return n.___errno_location&&(y[n.___errno_location()>>2]=e),e},f:$,g:function(e,t,n){v.set(v.subarray(t,t+n),e)},h:function(e){var t=$(),n=16777216,r=2130706432;if(e>r)return!1;for(var i=Math.max(t,16777216);i<e;)i=i<=536870912?_(2*i,n):Math.min(_((3*i+2147483648)/4,n),r);return!!K(i)},i:function(e){ce("OOM")},j:q,k:W,l:K,m:H,n:function(){var e=H();return n.extraStackTrace&&(e+="\n"+n.extraStackTrace()),W(e)},o:28640,p:28624},J=function(e,t,n){var r=new e.Int8Array(n),i=new e.Int32Array(n),a=(new e.Uint8Array(n),new e.Float32Array(n),new e.Float64Array(n)),o=0|t.o,s=0|t.p,l=e.Math.floor,c=e.Math.abs,u=e.Math.sqrt,d=e.Math.pow,h=e.Math.cos,p=e.Math.sin,f=e.Math.tan,m=e.Math.acos,g=e.Math.asin,v=e.Math.atan,A=e.Math.atan2,y=e.Math.ceil,b=e.Math.imul,x=e.Math.min,_=e.Math.max,w=e.Math.clz32,S=t.b,T=t.c,C=t.d,M=t.e,E=t.f,P=t.g,N=t.h,k=t.i,R=28656;function L(e,t,n,r){return 0|O(e|=0,t|=0,n|=0,r|=0,0)}function O(e,t,n,r,a){var o,s=0,l=0,c=0,u=0;if(o=R,R=R+16|0,l=o,!(0|j(e|=0,t|=0,n|=0,r|=0,a|=0)))return R=o,0|(r=0);do{if((0|n)>=0){if((0|n)>13780509){if(0|(s=0|mt(15,l)))break;l=0|i[(c=l)>>2],c=0|i[c+4>>2]}else u=0|sn(0|n,0|(s=((0|n)<0)<<31>>31),3,0),c=0|T(),s=0|tn(0|n,0|s,1,0),s=0|tn(0|(s=0|sn(0|u,0|c,0|s,0|T())),0|T(),1,0),c=0|T(),i[l>>2]=s,i[l+4>>2]=c,l=s;if(An(0|r,0,l<<3),0|a){An(0|a,0,l<<2),s=0|D(e,t,n,r,a,l,c,0);break}(s=0|en(l,4))?(u=0|D(e,t,n,r,s,l,c,0),Jt(s),s=u):s=13}else s=2}while(0);return R=o,0|(u=s)}function j(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o,s,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0;if(s=R,R=R+16|0,g=s+8|0,i[(m=o=s)>>2]=e,i[m+4>>2]=t,(0|n)<0)return R=s,0|(g=2);if(i[(l=r)>>2]=e,i[l+4>>2]=t,(l=0!=(0|a))&&(i[a>>2]=0),0|He(e,t))return R=s,0|(g=9);i[g>>2]=0;e:do{if((0|n)>=1)if(l)for(p=1,h=0,f=0,m=1,l=e;;){if(!(h|f)){if(0|(l=0|I(l,t,4,g,o)))break e;if(0|He(l=0|i[(t=o)>>2],t=0|i[t+4>>2])){l=9;break e}}if(0|(l=0|I(l,t,0|i[26800+(f<<2)>>2],g,o)))break e;if(l=0|i[(t=o)>>2],t=0|i[t+4>>2],i[(e=r+(p<<3)|0)>>2]=l,i[e+4>>2]=t,i[a+(p<<2)>>2]=m,c=(0|(e=h+1|0))==(0|m),d=6==(0|(u=f+1|0)),0|He(l,t)){l=9;break e}if((0|(m=m+(d&c&1)|0))>(0|n)){l=0;break}p=p+1|0,h=c?0:e,f=c?d?0:u:f}else for(p=1,h=0,f=0,m=1,l=e;;){if(!(h|f)){if(0|(l=0|I(l,t,4,g,o)))break e;if(0|He(l=0|i[(t=o)>>2],t=0|i[t+4>>2])){l=9;break e}}if(0|(l=0|I(l,t,0|i[26800+(f<<2)>>2],g,o)))break e;if(l=0|i[(t=o)>>2],t=0|i[t+4>>2],i[(e=r+(p<<3)|0)>>2]=l,i[e+4>>2]=t,c=(0|(e=h+1|0))==(0|m),d=6==(0|(u=f+1|0)),0|He(l,t)){l=9;break e}if((0|(m=m+(d&c&1)|0))>(0|n)){l=0;break}p=p+1|0,h=c?0:e,f=c?d?0:u:f}else l=0}while(0);return R=s,0|(g=l)}function D(e,t,n,r,a,o,s,l){n|=0,r|=0,a|=0,l|=0;var c,u,d,h=0,p=0,f=0,m=0,g=0,v=0,A=0;if(d=R,R=R+16|0,c=d+8|0,u=d,h=0|cn(0|(e|=0),0|(t|=0),0|(o|=0),0|(s|=0)),f=0|T(),!(0==(0|(A=0|i[(v=m=r+(h<<3)|0)>>2]))&0==(0|(v=0|i[v+4>>2]))|(p=(0|A)==(0|e)&(0|v)==(0|t))))do{h=0|ln(0|(h=0|tn(0|h,0|f,1,0)),0|T(),0|o,0|s),f=0|T(),p=(0|(v=0|i[(A=m=r+(h<<3)|0)>>2]))==(0|e)&(0|(A=0|i[A+4>>2]))==(0|t)}while(!(0==(0|v)&0==(0|A)|p));if(h=a+(h<<2)|0,p&&(0|i[h>>2])<=(0|l))return R=d,0|(A=0);if(i[(A=m)>>2]=e,i[A+4>>2]=t,i[h>>2]=l,(0|l)>=(0|n))return R=d,0|(A=0);switch(p=l+1|0,i[c>>2]=0,0|(h=0|I(e,t,2,c,u))){case 9:g=9;break;case 0:(h=0|D(0|i[(h=u)>>2],0|i[h+4>>2],n,r,a,o,s,p))||(g=9)}e:do{if(9==(0|g)){switch(i[c>>2]=0,0|(h=0|I(e,t,3,c,u))){case 9:break;case 0:if(0|(h=0|D(0|i[(h=u)>>2],0|i[h+4>>2],n,r,a,o,s,p)))break e;break;default:break e}switch(i[c>>2]=0,0|(h=0|I(e,t,1,c,u))){case 9:break;case 0:if(0|(h=0|D(0|i[(h=u)>>2],0|i[h+4>>2],n,r,a,o,s,p)))break e;break;default:break e}switch(i[c>>2]=0,0|(h=0|I(e,t,5,c,u))){case 9:break;case 0:if(0|(h=0|D(0|i[(h=u)>>2],0|i[h+4>>2],n,r,a,o,s,p)))break e;break;default:break e}switch(i[c>>2]=0,0|(h=0|I(e,t,4,c,u))){case 9:break;case 0:if(0|(h=0|D(0|i[(h=u)>>2],0|i[h+4>>2],n,r,a,o,s,p)))break e;break;default:break e}switch(i[c>>2]=0,0|(h=0|I(e,t,6,c,u))){case 9:break;case 0:if(0|(h=0|D(0|i[(h=u)>>2],0|i[h+4>>2],n,r,a,o,s,p)))break e;break;default:break e}return R=d,0|(A=0)}}while(0);return R=d,0|(A=h)}function I(e,t,n,r,a){e|=0,t|=0,a|=0;var o,s,l=0,c=0,u=0,d=0,h=0,p=0,f=0;if((n|=0)>>>0>6)return 0|(a=1);if(h=(0|i[(r|=0)>>2])%6|0,i[r>>2]=h,(0|h)>0){l=0;do{n=0|xe(n),l=l+1|0}while((0|l)<(0|i[r>>2]))}if(h=0|dn(0|e,0|t,45),T(),(s=127&h)>>>0>121)return 0|(a=5);o=0|Xe(e,t),l=0|dn(0|e,0|t,52),T(),l&=15;e:do{if(l){for(;;){if(u=0|dn(0|e,0|t,0|(c=3*(15-l|0)|0)),T(),7==(0|(u&=7))){t=5;break}if(f=0==(0|et(l)),l=l+-1|0,p=0|hn(7,0,0|c),t&=~T(),e=0|hn(0|i[(f?432:16)+(28*u|0)+(n<<2)>>2],0,0|c)|e&~p,t|=c=0|T(),!(n=0|i[(f?640:224)+(28*u|0)+(n<<2)>>2])){n=0;break e}if(!l){d=8;break e}}return 0|t}d=8}while(0);8==(0|d)&&(e|=0|hn(0|(f=0|i[848+(28*s|0)+(n<<2)>>2]),0,45),t=T()|-1040385&t,n=0|i[4272+(28*s|0)+(n<<2)>>2],127==(127&f)&&(f=0|hn(0|i[848+(28*s|0)+20>>2],0,45),t=T()|-1040385&t,n=0|i[4272+(28*s|0)+20>>2],e=0|Qe(f|e,t),t=0|T(),i[r>>2]=1+(0|i[r>>2]))),u=0|dn(0|e,0|t,45),T(),u&=127;e:do{if(0|V(u)){t:do{if(1==(0|Xe(e,t))){if((0|s)!=(0|u)){if(0|H(u,0|i[7696+(28*s|0)>>2])){e=0|Je(e,t),c=1,t=0|T();break}C(27795,26864,533,26872)}switch(0|o){case 3:e=0|Qe(e,t),t=0|T(),i[r>>2]=1+(0|i[r>>2]),c=0;break t;case 5:e=0|Je(e,t),t=0|T(),i[r>>2]=5+(0|i[r>>2]),c=0;break t;case 0:return 0|(f=9);default:return 0|(f=1)}}else c=0}while(0);if((0|n)>0){l=0;do{e=0|Ye(e,t),t=0|T(),l=l+1|0}while((0|l)!=(0|n))}if((0|s)!=(0|u)){if(!(0|G(u))){if(0!=(0|c)|5!=(0|Xe(e,t)))break;i[r>>2]=1+(0|i[r>>2]);break}switch(127&h){case 8:case 118:break e}3!=(0|Xe(e,t))&&(i[r>>2]=1+(0|i[r>>2]))}}else if((0|n)>0){l=0;do{e=0|Qe(e,t),t=0|T(),l=l+1|0}while((0|l)!=(0|n))}}while(0);return i[r>>2]=((0|i[r>>2])+n|0)%6|0,i[(f=a)>>2]=e,i[f+4>>2]=t,0|(f=0)}function B(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a,o,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0;if(o=R,R=R+16|0,m=o+8|0,i[(f=a=o)>>2]=e,i[f+4>>2]=t,(0|n)<0)return R=o,0|(m=2);if(!n)return i[(m=r)>>2]=e,i[m+4>>2]=t,R=o,0|(m=0);i[m>>2]=0;e:do{if(0|He(e,t))e=9;else{s=0,f=e;do{if(0|(e=0|I(f,t,4,m,a)))break e;if(s=s+1|0,0|He(f=0|i[(t=a)>>2],t=0|i[t+4>>2])){e=9;break e}}while((0|s)<(0|n));i[(p=r)>>2]=f,i[p+4>>2]=t,p=n+-1|0,h=0,e=1;do{if(s=26800+(h<<2)|0,5==(0|h))for(c=0|i[s>>2],l=0,s=e;;){if(0|(e=0|I(0|i[(e=a)>>2],0|i[e+4>>2],c,m,a)))break e;if((0|l)!=(0|p)){if(u=0|i[(d=a)>>2],d=0|i[d+4>>2],i[(e=r+(s<<3)|0)>>2]=u,i[e+4>>2]=d,0|He(u,d)){e=9;break e}e=s+1|0}else e=s;if((0|(l=l+1|0))>=(0|n))break;s=e}else for(c=a,d=0|i[s>>2],u=0,s=e,l=0|i[c>>2],c=0|i[c+4>>2];;){if(0|(e=0|I(l,c,d,m,a)))break e;if(l=0|i[(c=a)>>2],c=0|i[c+4>>2],i[(e=r+(s<<3)|0)>>2]=l,i[e+4>>2]=c,e=s+1|0,0|He(l,c)){e=9;break e}if((0|(u=u+1|0))>=(0|n))break;s=e}h=h+1|0}while(h>>>0<6);e=(0|f)==(0|i[(e=a)>>2])&&(0|t)==(0|i[e+4>>2])?0:9}}while(0);return R=o,0|(m=e)}function F(e,t,n,r){e|=0,t|=0,r|=0;var a,o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0;if(a=R,R=R+16|0,l=a,!(n|=0))return i[r>>2]=e,i[r+4>>2]=t,R=a,0|(r=0);do{if((0|n)>=0){if((0|n)>13780509){if(0|(o=0|mt(15,l)))break;o=0|i[(s=l)>>2],s=0|i[s+4>>2]}else h=0|sn(0|n,0|(o=((0|n)<0)<<31>>31),3,0),s=0|T(),o=0|tn(0|n,0|o,1,0),o=0|tn(0|(o=0|sn(0|h,0|s,0|o,0|T())),0|T(),1,0),s=0|T(),i[(h=l)>>2]=o,i[h+4>>2]=s;if(d=0|en(o,8)){if(!(h=0|en(o,4))){Jt(d),o=13;break}if(0|(o=0|D(e,t,n,d,h,o,s,0))){Jt(d),Jt(h);break}if(t=0|i[l>>2],(0|(l=0|i[l+4>>2]))>0|0==(0|l)&t>>>0>0){o=0,c=0,u=0;do{0==(0|(s=0|i[(e=d+(c<<3)|0)>>2]))&0==(0|(e=0|i[e+4>>2]))||(0|i[h+(c<<2)>>2])!=(0|n)||(i[(p=r+(o<<3)|0)>>2]=s,i[p+4>>2]=e,o=o+1|0),c=0|tn(0|c,0|u,1,0),u=0|T()}while((0|u)<(0|l)|(0|u)==(0|l)&c>>>0<t>>>0)}Jt(d),Jt(h),o=0}else o=13}else o=2}while(0);return R=a,0|(p=o)}function z(e,t,n,r){n|=0,r|=0;var a,o,s,l=0,c=0;for(s=R,R=R+16|0,a=s,o=s+8|0,l=(l=0==(0|He(e|=0,t|=0)))?1:2;;){if(i[o>>2]=0,0==(0|I(e,t,l,o,a))&((0|i[(c=a)>>2])==(0|n)?(0|i[c+4>>2])==(0|r):0)){e=4;break}if((l=l+1|0)>>>0>=7){l=7,e=4;break}}return 4==(0|e)?(R=s,0|l):0}function U(e,t,n,r,o,s,l){t|=0,n|=0,r|=0,o|=0,s|=0,l|=0;var c,u,d,h,p,f,m,g,v,A,y=0,b=0,x=0,_=0,w=0,S=0,C=0,M=0,E=0,P=0,N=0,k=0,L=0,O=0,j=0,D=0,I=0,B=0,F=0;if(A=R,R=R+64|0,m=A+48|0,g=A+32|0,v=A+24|0,c=A+8|0,u=A,(0|(b=0|i[(e|=0)>>2]))<=0)return R=A,0|(j=0);for(d=e+4|0,h=m+8|0,p=g+8|0,f=c+8|0,y=0,L=0;;){k=(x=0|i[d>>2])+(L<<4)|0,i[m>>2]=i[k>>2],i[m+4>>2]=i[k+4>>2],i[m+8>>2]=i[k+8>>2],i[m+12>>2]=i[k+12>>2],(0|L)==(b+-1|0)?(i[g>>2]=i[x>>2],i[g+4>>2]=i[x+4>>2],i[g+8>>2]=i[x+8>>2],i[g+12>>2]=i[x+12>>2]):(k=x+(L+1<<4)|0,i[g>>2]=i[k>>2],i[g+4>>2]=i[k+4>>2],i[g+8>>2]=i[k+8>>2],i[g+12>>2]=i[k+12>>2]),b=0|re(m,g,r,v);e:do{if(b)x=0,y=b;else if(x=0|i[(b=v)>>2],(0|(b=0|i[b+4>>2]))>0|0==(0|b)&x>>>0>0){N=0,k=0;t:for(;;){if(I=1/(+(x>>>0)+4294967296*+(0|b)),F=+a[m>>3],B=+((b=0|nn(0|x,0|b,0|N,0|k))>>>0)+4294967296*+(0|T()),D=+(N>>>0)+4294967296*+(0|k),a[c>>3]=I*(F*B)+I*(+a[g>>3]*D),a[f>>3]=I*(+a[h>>3]*B)+I*(+a[p>>3]*D),0|(b=0|tt(c,r,u))){y=b;break}S=0|cn(0|(E=0|i[(P=u)>>2]),0|(P=0|i[P+4>>2]),0|t,0|n),_=0|T(),x=0|i[(w=b=l+(S<<3)|0)>>2],w=0|i[w+4>>2];n:do{if(0==(0|x)&0==(0|w))O=b,j=16;else for(C=0,M=0;;){if((0|C)>(0|n)|(0|C)==(0|n)&M>>>0>t>>>0){y=1;break t}if((0|x)==(0|E)&(0|w)==(0|P))break n;if(S=0|ln(0|(b=0|tn(0|S,0|_,1,0)),0|T(),0|t,0|n),_=0|T(),M=0|tn(0|M,0|C,1,0),C=0|T(),0==(0|(x=0|i[(w=b=l+(S<<3)|0)>>2]))&0==(0|(w=0|i[w+4>>2]))){O=b,j=16;break}}}while(0);if(16!=(0|j)||(j=0,0==(0|E)&0==(0|P))||(i[(M=O)>>2]=E,i[M+4>>2]=P,M=s+(i[o>>2]<<3)|0,i[M>>2]=E,i[M+4>>2]=P,M=0|tn(0|i[(M=o)>>2],0|i[M+4>>2],1,0),E=0|T(),i[(P=o)>>2]=M,i[P+4>>2]=E),N=0|tn(0|N,0|k,1,0),k=0|T(),x=0|i[(b=v)>>2],!((0|(b=0|i[b+4>>2]))>(0|k)|(0|b)==(0|k)&x>>>0>N>>>0)){x=1;break e}}x=0}else x=1}while(0);if(L=L+1|0,!x){j=21;break}if((0|L)>=(0|(b=0|i[e>>2]))){y=0,j=21;break}}return 21==(0|j)?(R=A,0|y):0}function V(e){return(e|=0)>>>0>121?0|(e=0):0|(e=0|i[7696+(28*e|0)+16>>2])}function G(e){return 4==(0|(e|=0))|117==(0|e)|0}function q(e){return 0|i[11120+(216*(0|i[(e|=0)>>2])|0)+(72*(0|i[e+4>>2])|0)+(24*(0|i[e+8>>2])|0)+(i[e+12>>2]<<3)>>2]}function W(e){return 0|i[11120+(216*(0|i[(e|=0)>>2])|0)+(72*(0|i[e+4>>2])|0)+(24*(0|i[e+8>>2])|0)+(i[e+12>>2]<<3)+4>>2]}function H(e,t){return t|=0,(0|i[7696+(28*(e|=0)|0)+20>>2])==(0|t)?0|(t=1):0|(t=(0|i[7696+(28*e|0)+24>>2])==(0|t))}function $(e,t){return 0|i[848+(28*(e|=0)|0)+((t|=0)<<2)>>2]}function K(e,t){return t|=0,(0|i[848+(28*(e|=0)|0)>>2])==(0|t)?0|(t=0):(0|i[848+(28*e|0)+4>>2])==(0|t)?0|(t=1):(0|i[848+(28*e|0)+8>>2])==(0|t)?0|(t=2):(0|i[848+(28*e|0)+12>>2])==(0|t)?0|(t=3):(0|i[848+(28*e|0)+16>>2])==(0|t)?0|(t=4):(0|i[848+(28*e|0)+20>>2])==(0|t)?0|(t=5):0|((0|i[848+(28*e|0)+24>>2])==(0|t)?6:7)}function X(e){var t,n,r;return t=(r=+a[(e|=0)+16>>3])-(n=+a[e+24>>3]),+(r<n?t+6.283185307179586:t)}function Y(e){return+a[(e|=0)+16>>3]<+a[e+24>>3]|0}function Q(e){return+(+a[(e|=0)>>3]-+a[e+8>>3])}function Z(e,t){e|=0;var n,r,i=0;return(i=+a[(t|=0)>>3])>=+a[e+8>>3]&&i<=+a[e>>3]?(n=+a[e+16>>3],i=+a[e+24>>3],t=(r=+a[t+8>>3])>=i,e=r<=n&1,n<i?t&&(e=1):t||(e=0),0|(t=0!=(0|e))):0|(t=0)}function J(e,t){t|=0;var n,r,i,o,s,l=0,c=0,u=0,d=0;return+a[(e|=0)>>3]<+a[t+8>>3]||+a[e+8>>3]>+a[t>>3]?0|(l=0):(i=(c=+a[e+16>>3])<(d=+a[(n=e+24|0)>>3]),u=(s=+a[(l=t+16|0)>>3])<(o=+a[(r=t+24|0)>>3]),t=d-s<o-c,e=i?u|t?1:2:0,t=u?i?1:t?2:1:0,(c=+ht(c,e))<+ht(+a[r>>3],t)||(d=+ht(+a[n>>3],e))>+ht(+a[l>>3],t)?0|(u=0):0|(u=1))}function ee(e,t){t|=0;var n,r,i,o,s,l=0,c=0,u=0,d=0;return+a[(e|=0)>>3]<+a[t>>3]||+a[e+8>>3]>+a[t+8>>3]?0|(l=0):(i=(o=+a[(l=e+16|0)>>3])<(c=+a[e+24>>3]),u=(d=+a[(n=t+16|0)>>3])<(s=+a[(r=t+24|0)>>3]),t=c-d<s-o,e=i?u|t?1:2:0,t=u?i?1:t?2:1:0,(c=+ht(c,e))<=+ht(+a[r>>3],t)?0|(u=(d=+ht(+a[l>>3],e))>=+ht(+a[n>>3],t)):0|(u=0))}function te(e,t){e|=0,t|=0;var n,r,o,s,l,c=0;o=R,R=R+176|0,i[(r=o)>>2]=4,c=+a[t>>3],a[r+8>>3]=c,s=+a[t+16>>3],a[r+16>>3]=s,a[r+24>>3]=c,c=+a[t+24>>3],a[r+32>>3]=c,l=+a[t+8>>3],a[r+40>>3]=l,a[r+48>>3]=c,a[r+56>>3]=l,a[r+64>>3]=s,n=(t=r+72|0)+96|0;do{i[t>>2]=0,t=t+4|0}while((0|t)<(0|n));vn(0|e,0|r,168),R=o}function ne(e,t,n){e|=0,t|=0,n|=0;var r,s,u,d,h,p,f,m=0,g=0,v=0,A=0,b=0,_=0,w=0;p=R,R=R+288|0,h=p+264|0,A=p+96|0,g=(m=v=p)+96|0;do{i[m>>2]=0,m=m+4|0}while((0|m)<(0|g));return 0|(t=0|ot(t,v))?(R=p,0|(_=t)):(it(v=0|i[(g=v)>>2],g=0|i[g+4>>2],h),at(v,g,A),d=+pt(h,A+8|0),a[h>>3]=+a[e>>3],a[(g=h+8|0)>>3]=+a[e+16>>3],a[A>>3]=+a[e+8>>3],a[(v=A+8|0)>>3]=+a[e+24>>3],s=+pt(h,A),w=+a[g>>3]-+a[v>>3],u=+c(+w),f=+a[h>>3]-+a[A>>3],r=+c(+f),0==w|0==f||(w=+fn(+u,+r),w=+y(+s*s/+mn(+w/+mn(+u,+r),3)/(d*(2.59807621135*d)*.8)),a[o>>3]=w,b=~~w>>>0,_=+c(w)>=1?w>0?~~+x(+l(w/4294967296),4294967295)>>>0:~~+y((w-+(~~w>>>0))/4294967296)>>>0:0,2146435072==(2146435072&i[o+4>>2]))?t=1:(A=0==(0|b)&0==(0|_),i[(t=n)>>2]=A?1:b,i[t+4>>2]=A?0:_,t=0),R=p,0|(_=t))}function re(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var s,u,d,h,p=0,f=0,m=0;h=R,R=R+288|0,u=h+264|0,d=h+96|0,s=(p=f=h)+96|0;do{i[p>>2]=0,p=p+4|0}while((0|p)<(0|s));return 0|(n=0|ot(n,f))?(R=h,0|(r=n)):(it(p=0|i[(n=f)>>2],n=0|i[n+4>>2],u),at(p,n,d),m=+pt(u,d+8|0),m=+y(+ +pt(e,t)/(2*m)),a[o>>3]=m,n=~~m>>>0,p=+c(m)>=1?m>0?~~+x(+l(m/4294967296),4294967295)>>>0:~~+y((m-+(~~m>>>0))/4294967296)>>>0:0,2146435072==(2146435072&i[o+4>>2])?(R=h,0|(r=1)):(f=0==(0|n)&0==(0|p),i[r>>2]=f?1:n,i[r+4>>2]=f?0:p,R=h,0|(r=0)))}function ie(e,t,n,r){t|=0,n|=0,r|=0,i[(e|=0)>>2]=t,i[e+4>>2]=n,i[e+8>>2]=r}function ae(e,t){e|=0;var n,r,o,s,l=0,u=0,d=0,h=0,p=0,f=0,m=0;i[(s=(t|=0)+8|0)>>2]=0,r=+a[e>>3],h=+c(+r),o=+a[e+8>>3],h+=.5*(p=1.1547005383792515*+c(+o)),h-=+(0|(l=~~h)),p-=+(0|(e=~~p));do{if(h<.5){if(h<.3333333333333333){if(i[t>>2]=l,p<.5*(h+1)){i[t+4>>2]=e;break}e=e+1|0,i[t+4>>2]=e;break}if(e=(1&!(p<(m=1-h)))+e|0,i[t+4>>2]=e,m<=p&p<2*h){l=l+1|0,i[t>>2]=l;break}i[t>>2]=l;break}if(!(h<.6666666666666666)){if(l=l+1|0,i[t>>2]=l,p<.5*h){i[t+4>>2]=e;break}e=e+1|0,i[t+4>>2]=e;break}if(p<1-h){if(i[t+4>>2]=e,2*h-1<p){i[t>>2]=l;break}}else e=e+1|0,i[t+4>>2]=e;l=l+1|0,i[t>>2]=l}while(0);do{if(r<0){if(1&e){l=~~(+(0|l)-(2*(+((f=0|nn(0|l,((0|l)<0)<<31>>31,0|(f=(e+1|0)/2|0),((0|f)<0)<<31>>31))>>>0)+4294967296*+(0|T()))+1)),i[t>>2]=l;break}l=~~(+(0|l)-2*(+((f=0|nn(0|l,((0|l)<0)<<31>>31,0|(f=(0|e)/2|0),((0|f)<0)<<31>>31))>>>0)+4294967296*+(0|T()))),i[t>>2]=l;break}}while(0);f=t+4|0,o<0&&(l=l-((1|e<<1)/2|0)|0,i[t>>2]=l,e=0-e|0,i[f>>2]=e),u=e-l|0,(0|l)<0?(d=0-l|0,i[f>>2]=u,i[s>>2]=d,i[t>>2]=0,e=u,l=0):d=0,(0|e)<0&&(l=l-e|0,i[t>>2]=l,d=d-e|0,i[s>>2]=d,i[f>>2]=0,e=0),n=l-d|0,u=e-d|0,(0|d)<0&&(i[t>>2]=n,i[f>>2]=u,i[s>>2]=0,e=u,l=n,d=0),(0|(u=(0|d)<(0|(u=(0|e)<(0|l)?e:l))?d:u))<=0||(i[t>>2]=l-u,i[f>>2]=e-u,i[s>>2]=d-u)}function oe(e){var t,n=0,r=0,a=0,o=0,s=0;n=0|i[(e|=0)>>2],r=0|i[(t=e+4|0)>>2],(0|n)<0&&(r=r-n|0,i[t>>2]=r,i[(s=e+8|0)>>2]=(0|i[s>>2])-n,i[e>>2]=0,n=0),(0|r)<0?(n=n-r|0,i[e>>2]=n,o=(0|i[(s=e+8|0)>>2])-r|0,i[s>>2]=o,i[t>>2]=0,r=0):(s=o=e+8|0,o=0|i[o>>2]),(0|o)<0&&(n=n-o|0,i[e>>2]=n,r=r-o|0,i[t>>2]=r,i[s>>2]=0,o=0),(0|(a=(0|o)<(0|(a=(0|r)<(0|n)?r:n))?o:a))<=0||(i[e>>2]=n-a,i[t>>2]=r-a,i[s>>2]=o-a)}function se(e,t){t|=0;var n,r;r=0|i[(e|=0)+8>>2],n=+((0|i[e+4>>2])-r|0),a[t>>3]=+((0|i[e>>2])-r|0)-.5*n,a[t+8>>3]=.8660254037844386*n}function le(e,t,n){e|=0,t|=0,i[(n|=0)>>2]=(0|i[t>>2])+(0|i[e>>2]),i[n+4>>2]=(0|i[t+4>>2])+(0|i[e+4>>2]),i[n+8>>2]=(0|i[t+8>>2])+(0|i[e+8>>2])}function ce(e,t,n){e|=0,t|=0,i[(n|=0)>>2]=(0|i[e>>2])-(0|i[t>>2]),i[n+4>>2]=(0|i[e+4>>2])-(0|i[t+4>>2]),i[n+8>>2]=(0|i[e+8>>2])-(0|i[t+8>>2])}function ue(e,t){t|=0;var n,r=0;r=0|b(0|i[(e|=0)>>2],t),i[e>>2]=r,n=0|b(0|i[(r=e+4|0)>>2],t),i[r>>2]=n,t=0|b(0|i[(e=e+8|0)>>2],t),i[e>>2]=t}function de(e){var t,n,r=0,a=0,o=0,s=0,l=0;l=(0|(n=0|i[(e|=0)>>2]))<0,e=(e=(a=(0|(s=((t=(0|(o=(0|i[e+4>>2])-(l?n:0)|0))<0)?0-o|0:0)+((0|i[e+8>>2])-(l?n:0))|0))<0)?0:s)-((o=(0|(a=(0|e)<(0|(a=(0|(r=(t?0:o)-(a?s:0)|0))<(0|(s=(l?0:n)-(t?o:0)-(a?s:0)|0))?r:s))?e:a))>0)?a:0)|0,r=r-(o?a:0)|0;e:do{switch(s-(o?a:0)|0){case 0:switch(0|r){case 0:return 0|(l=0==(0|e)?0:1==(0|e)?1:7);case 1:return 0|(l=0==(0|e)?2:1==(0|e)?3:7);default:break e}case 1:switch(0|r){case 0:return 0|(l=0==(0|e)?4:1==(0|e)?5:7);case 1:if(e)break e;return 0|(e=6);default:break e}}}while(0);return 0|(l=7)}function he(e){var t,n,r=0,a=0,o=0,s=0,l=0,c=0,u=0;if(c=0|i[(n=(e|=0)+8|0)>>2],(t=(0|i[e>>2])-c|0)>>>0>715827881|(c=(0|i[(u=e+4|0)>>2])-c|0)>>>0>715827881){if(s=2147483647-t|0,l=-2147483648-t|0,(o=(0|t)>0)?(0|s)<(0|t):(0|l)>(0|t))return 0|(u=1);if(a=t<<1,o?(2147483647-a|0)<(0|t):(-2147483648-a|0)>(0|t))return 0|(u=1);if((0|c)>0?(2147483647-c|0)<(0|c):(-2147483648-c|0)>(0|c))return 0|(u=1);if(r=3*t|0,a=c<<1,(o?(0|s)<(0|a):(0|l)>(0|a))||((0|t)>-1?(-2147483648|r)>=(0|c):(-2147483648^r)<(0|c)))return 0|(u=1)}else a=c<<1,r=3*t|0;return o=0|Qt(.14285714285714285*+(r-c|0)),i[e>>2]=o,s=0|Qt(.14285714285714285*+(a+t|0)),i[u>>2]=s,i[n>>2]=0,r=(a=(0|s)<(0|o))?o:s,(0|(a=a?s:o))<0&&((-2147483648==(0|a)||((0|r)>0?(2147483647-r|0)<(0|a):(-2147483648-r|0)>(0|a)))&&C(27795,26892,354,26903),((0|r)>-1?(-2147483648|r)>=(0|a):(-2147483648^r)<(0|a))&&C(27795,26892,354,26903)),r=s-o|0,(0|o)<0?(a=0-o|0,i[u>>2]=r,i[n>>2]=a,i[e>>2]=0,o=0):(r=s,a=0),(0|r)<0&&(o=o-r|0,i[e>>2]=o,a=a-r|0,i[n>>2]=a,i[u>>2]=0,r=0),l=o-a|0,s=r-a|0,(0|a)<0?(i[e>>2]=l,i[u>>2]=s,i[n>>2]=0,r=s,s=l,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|r)<(0|s)?r:s))?a:o))<=0||(i[e>>2]=s-o,i[u>>2]=r-o,i[n>>2]=a-o),0|(u=0)}function pe(e){var t,n=0,r=0,a=0,o=0,s=0,l=0,c=0;if(o=0|i[(t=(e|=0)+8|0)>>2],(s=(0|i[e>>2])-o|0)>>>0>715827881|(o=(0|i[(l=e+4|0)>>2])-o|0)>>>0>715827881){if((r=(0|s)>0)?(2147483647-s|0)<(0|s):(-2147483648-s|0)>(0|s))return 0|(l=1);if(n=s<<1,(a=(0|o)>0)?(2147483647-o|0)<(0|o):(-2147483648-o|0)>(0|o))return 0|(l=1);if(c=o<<1,a?(2147483647-c|0)<(0|o):(-2147483648-c|0)>(0|o))return 0|(c=1);if(r?(2147483647-n|0)<(0|o):(-2147483648-n|0)>(0|o))return 0|(c=1);if(r=3*o|0,(0|o)>-1?(-2147483648|r)>=(0|s):(-2147483648^r)<(0|s))return 0|(c=1)}else r=3*o|0,n=s<<1;return a=0|Qt(.14285714285714285*+(n+o|0)),i[e>>2]=a,o=0|Qt(.14285714285714285*+(r-s|0)),i[l>>2]=o,i[t>>2]=0,n=(r=(0|o)<(0|a))?a:o,(0|(r=r?o:a))<0&&((-2147483648==(0|r)||((0|n)>0?(2147483647-n|0)<(0|r):(-2147483648-n|0)>(0|r)))&&C(27795,26892,402,26917),((0|n)>-1?(-2147483648|n)>=(0|r):(-2147483648^n)<(0|r))&&C(27795,26892,402,26917)),n=o-a|0,(0|a)<0?(r=0-a|0,i[l>>2]=n,i[t>>2]=r,i[e>>2]=0,a=0):(n=o,r=0),(0|n)<0&&(a=a-n|0,i[e>>2]=a,r=r-n|0,i[t>>2]=r,i[l>>2]=0,n=0),s=a-r|0,o=n-r|0,(0|r)<0?(i[e>>2]=s,i[l>>2]=o,i[t>>2]=0,n=o,o=s,r=0):o=a,(0|(a=(0|r)<(0|(a=(0|n)<(0|o)?n:o))?r:a))<=0||(i[e>>2]=o-a,i[l>>2]=n-a,i[t>>2]=r-a),0|(c=0)}function fe(e){var t,n,r=0,a=0,o=0,s=0,l=0;a=0|i[(t=(e|=0)+8|0)>>2],o=0|Qt(.14285714285714285*+((3*(r=(0|i[e>>2])-a|0)|0)-(a=(0|i[(n=e+4|0)>>2])-a|0)|0)),i[e>>2]=o,r=0|Qt(.14285714285714285*+((a<<1)+r|0)),i[n>>2]=r,i[t>>2]=0,a=r-o|0,(0|o)<0?(l=0-o|0,i[n>>2]=a,i[t>>2]=l,i[e>>2]=0,r=a,o=0,a=l):a=0,(0|r)<0&&(o=o-r|0,i[e>>2]=o,a=a-r|0,i[t>>2]=a,i[n>>2]=0,r=0),l=o-a|0,s=r-a|0,(0|a)<0?(i[e>>2]=l,i[n>>2]=s,i[t>>2]=0,r=s,s=l,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|r)<(0|s)?r:s))?a:o))<=0||(i[e>>2]=s-o,i[n>>2]=r-o,i[t>>2]=a-o)}function me(e){var t,n,r=0,a=0,o=0,s=0,l=0;a=0|i[(t=(e|=0)+8|0)>>2],o=0|Qt(.14285714285714285*+(((r=(0|i[e>>2])-a|0)<<1)+(a=(0|i[(n=e+4|0)>>2])-a|0)|0)),i[e>>2]=o,r=0|Qt(.14285714285714285*+((3*a|0)-r|0)),i[n>>2]=r,i[t>>2]=0,a=r-o|0,(0|o)<0?(l=0-o|0,i[n>>2]=a,i[t>>2]=l,i[e>>2]=0,r=a,o=0,a=l):a=0,(0|r)<0&&(o=o-r|0,i[e>>2]=o,a=a-r|0,i[t>>2]=a,i[n>>2]=0,r=0),l=o-a|0,s=r-a|0,(0|a)<0?(i[e>>2]=l,i[n>>2]=s,i[t>>2]=0,r=s,s=l,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|r)<(0|s)?r:s))?a:o))<=0||(i[e>>2]=s-o,i[n>>2]=r-o,i[t>>2]=a-o)}function ge(e){var t,n,r,a=0,o=0,s=0,l=0;a=0|i[(e|=0)>>2],o=0|i[(n=e+4|0)>>2],s=0|i[(r=e+8|0)>>2],l=o+(3*a|0)|0,i[e>>2]=l,o=s+(3*o|0)|0,i[n>>2]=o,a=(3*s|0)+a|0,i[r>>2]=a,s=o-l|0,(0|l)<0?(a=a-l|0,i[n>>2]=s,i[r>>2]=a,i[e>>2]=0,o=s,s=0):s=l,(0|o)<0&&(s=s-o|0,i[e>>2]=s,a=a-o|0,i[r>>2]=a,i[n>>2]=0,o=0),t=s-a|0,l=o-a|0,(0|a)<0?(i[e>>2]=t,i[n>>2]=l,i[r>>2]=0,s=t,a=0):l=o,(0|(o=(0|a)<(0|(o=(0|l)<(0|s)?l:s))?a:o))<=0||(i[e>>2]=s-o,i[n>>2]=l-o,i[r>>2]=a-o)}function ve(e){var t,n,r,a=0,o=0,s=0,l=0;l=0|i[(e|=0)>>2],s=(3*(a=0|i[(n=e+4|0)>>2])|0)+l|0,l=(o=0|i[(r=e+8|0)>>2])+(3*l|0)|0,i[e>>2]=l,i[n>>2]=s,a=(3*o|0)+a|0,i[r>>2]=a,o=s-l|0,(0|l)<0?(a=a-l|0,i[n>>2]=o,i[r>>2]=a,i[e>>2]=0,l=0):o=s,(0|o)<0&&(l=l-o|0,i[e>>2]=l,a=a-o|0,i[r>>2]=a,i[n>>2]=0,o=0),t=l-a|0,s=o-a|0,(0|a)<0?(i[e>>2]=t,i[n>>2]=s,i[r>>2]=0,l=t,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|s)<(0|l)?s:l))?a:o))<=0||(i[e>>2]=l-o,i[n>>2]=s-o,i[r>>2]=a-o)}function Ae(e,t){e|=0;var n,r,a,o=0,s=0,l=0;((t|=0)+-1|0)>>>0>=6||(l=(0|i[15440+(12*t|0)>>2])+(0|i[e>>2])|0,i[e>>2]=l,a=e+4|0,s=(0|i[15440+(12*t|0)+4>>2])+(0|i[a>>2])|0,i[a>>2]=s,r=e+8|0,t=(0|i[15440+(12*t|0)+8>>2])+(0|i[r>>2])|0,i[r>>2]=t,o=s-l|0,(0|l)<0?(t=t-l|0,i[a>>2]=o,i[r>>2]=t,i[e>>2]=0,s=0):(o=s,s=l),(0|o)<0&&(s=s-o|0,i[e>>2]=s,t=t-o|0,i[r>>2]=t,i[a>>2]=0,o=0),n=s-t|0,l=o-t|0,(0|t)<0?(i[e>>2]=n,i[a>>2]=l,i[r>>2]=0,s=n,t=0):l=o,(0|(o=(0|t)<(0|(o=(0|l)<(0|s)?l:s))?t:o))<=0||(i[e>>2]=s-o,i[a>>2]=l-o,i[r>>2]=t-o))}function ye(e){var t,n,r,a=0,o=0,s=0,l=0;l=0|i[(e|=0)>>2],s=(a=0|i[(n=e+4|0)>>2])+l|0,l=(o=0|i[(r=e+8|0)>>2])+l|0,i[e>>2]=l,i[n>>2]=s,a=o+a|0,i[r>>2]=a,o=s-l|0,(0|l)<0?(a=a-l|0,i[n>>2]=o,i[r>>2]=a,i[e>>2]=0,s=0):(o=s,s=l),(0|o)<0&&(s=s-o|0,i[e>>2]=s,a=a-o|0,i[r>>2]=a,i[n>>2]=0,o=0),t=s-a|0,l=o-a|0,(0|a)<0?(i[e>>2]=t,i[n>>2]=l,i[r>>2]=0,s=t,a=0):l=o,(0|(o=(0|a)<(0|(o=(0|l)<(0|s)?l:s))?a:o))<=0||(i[e>>2]=s-o,i[n>>2]=l-o,i[r>>2]=a-o)}function be(e){var t,n,r,a=0,o=0,s=0,l=0;a=0|i[(e|=0)>>2],s=0|i[(n=e+4|0)>>2],o=0|i[(r=e+8|0)>>2],l=s+a|0,i[e>>2]=l,s=o+s|0,i[n>>2]=s,a=o+a|0,i[r>>2]=a,o=s-l|0,(0|l)<0?(a=a-l|0,i[n>>2]=o,i[r>>2]=a,i[e>>2]=0,s=0):(o=s,s=l),(0|o)<0&&(s=s-o|0,i[e>>2]=s,a=a-o|0,i[r>>2]=a,i[n>>2]=0,o=0),t=s-a|0,l=o-a|0,(0|a)<0?(i[e>>2]=t,i[n>>2]=l,i[r>>2]=0,s=t,a=0):l=o,(0|(o=(0|a)<(0|(o=(0|l)<(0|s)?l:s))?a:o))<=0||(i[e>>2]=s-o,i[n>>2]=l-o,i[r>>2]=a-o)}function xe(e){switch(0|(e|=0)){case 1:e=5;break;case 5:e=4;break;case 4:e=6;break;case 6:e=2;break;case 2:e=3;break;case 3:e=1}return 0|e}function _e(e){switch(0|(e|=0)){case 1:e=3;break;case 3:e=2;break;case 2:e=6;break;case 6:e=4;break;case 4:e=5;break;case 5:e=1}return 0|e}function we(e){var t,n,r,a=0,o=0,s=0,l=0;a=0|i[(e|=0)>>2],o=0|i[(n=e+4|0)>>2],s=0|i[(r=e+8|0)>>2],l=o+(a<<1)|0,i[e>>2]=l,o=s+(o<<1)|0,i[n>>2]=o,a=(s<<1)+a|0,i[r>>2]=a,s=o-l|0,(0|l)<0?(a=a-l|0,i[n>>2]=s,i[r>>2]=a,i[e>>2]=0,o=s,s=0):s=l,(0|o)<0&&(s=s-o|0,i[e>>2]=s,a=a-o|0,i[r>>2]=a,i[n>>2]=0,o=0),t=s-a|0,l=o-a|0,(0|a)<0?(i[e>>2]=t,i[n>>2]=l,i[r>>2]=0,s=t,a=0):l=o,(0|(o=(0|a)<(0|(o=(0|l)<(0|s)?l:s))?a:o))<=0||(i[e>>2]=s-o,i[n>>2]=l-o,i[r>>2]=a-o)}function Se(e){var t,n,r,a=0,o=0,s=0,l=0;l=0|i[(e|=0)>>2],s=((a=0|i[(n=e+4|0)>>2])<<1)+l|0,l=(o=0|i[(r=e+8|0)>>2])+(l<<1)|0,i[e>>2]=l,i[n>>2]=s,a=(o<<1)+a|0,i[r>>2]=a,o=s-l|0,(0|l)<0?(a=a-l|0,i[n>>2]=o,i[r>>2]=a,i[e>>2]=0,l=0):o=s,(0|o)<0&&(l=l-o|0,i[e>>2]=l,a=a-o|0,i[r>>2]=a,i[n>>2]=0,o=0),t=l-a|0,s=o-a|0,(0|a)<0?(i[e>>2]=t,i[n>>2]=s,i[r>>2]=0,l=t,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|s)<(0|l)?s:l))?a:o))<=0||(i[e>>2]=l-o,i[n>>2]=s-o,i[r>>2]=a-o)}function Te(e,t){t|=0;var n,r,a,o=0,s=0,l=0;return a=(0|(r=(0|i[(e|=0)>>2])-(0|i[t>>2])|0))<0,n=(0|(s=(0|i[e+4>>2])-(0|i[t+4>>2])-(a?r:0)|0))<0,t=(t=(e=(0|(l=(a?0-r|0:0)+(0|i[e+8>>2])-(0|i[t+8>>2])+(n?0-s|0:0)|0))<0)?0:l)-((s=(0|(e=(0|t)<(0|(e=(0|(o=(n?0:s)-(e?l:0)|0))<(0|(l=(a?0:r)-(n?s:0)-(e?l:0)|0))?o:l))?t:e))>0)?e:0)|0,o=o-(s?e:0)|0,0|((0|(e=(0|(e=l-(s?e:0)|0))>-1?e:0-e|0))>(0|(t=(0|(o=(0|o)>-1?o:0-o|0))>(0|(t=(0|t)>-1?t:0-t|0))?o:t))?e:t)}function Ce(e,t){t|=0;var n;n=0|i[(e|=0)+8>>2],i[t>>2]=(0|i[e>>2])-n,i[t+4>>2]=(0|i[e+4>>2])-n}function Me(e,t){t|=0;var n,r,a,o=0,s=0,l=0;if(s=0|i[(e|=0)>>2],i[t>>2]=s,l=0|i[e+4>>2],i[(r=t+4|0)>>2]=l,i[(a=t+8|0)>>2]=0,e=(o=(0|l)<(0|s))?s:l,(0|(o=o?l:s))<0){if(-2147483648==(0|o)||((0|e)>0?(2147483647-e|0)<(0|o):(-2147483648-e|0)>(0|o)))return 0|(t=1);if((0|e)>-1?(-2147483648|e)>=(0|o):(-2147483648^e)<(0|o))return 0|(t=1)}return e=l-s|0,(0|s)<0?(o=0-s|0,i[r>>2]=e,i[a>>2]=o,i[t>>2]=0,s=0):(e=l,o=0),(0|e)<0&&(s=s-e|0,i[t>>2]=s,o=o-e|0,i[a>>2]=o,i[r>>2]=0,e=0),n=s-o|0,l=e-o|0,(0|o)<0?(i[t>>2]=n,i[r>>2]=l,i[a>>2]=0,e=l,l=n,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|e)<(0|l)?e:l))?o:s))<=0||(i[t>>2]=l-s,i[r>>2]=e-s,i[a>>2]=o-s),0|(t=0)}function Ee(e){var t,n,r,a;n=(a=0|i[(t=(e|=0)+8|0)>>2])-(0|i[e>>2])|0,i[e>>2]=n,e=(0|i[(r=e+4|0)>>2])-a|0,i[r>>2]=e,i[t>>2]=0-(e+n)}function Pe(e){var t,n,r=0,a=0,o=0,s=0,l=0;r=0-(a=0|i[(e|=0)>>2])|0,i[e>>2]=r,i[(t=e+8|0)>>2]=0,s=(o=0|i[(n=e+4|0)>>2])+a|0,(0|a)>0?(i[n>>2]=s,i[t>>2]=a,i[e>>2]=0,r=0,o=s):a=0,(0|o)<0?(l=r-o|0,i[e>>2]=l,a=a-o|0,i[t>>2]=a,i[n>>2]=0,s=l-a|0,r=0-a|0,(0|a)<0?(i[e>>2]=s,i[n>>2]=r,i[t>>2]=0,o=r,a=0):(o=0,s=l)):s=r,(0|(r=(0|a)<(0|(r=(0|o)<(0|s)?o:s))?a:r))<=0||(i[e>>2]=s-r,i[n>>2]=o-r,i[t>>2]=a-r)}function Ne(e,t){var n=0;switch(n=0|dn(0|(e|=0),0|(t|=0),56),T(),7&n){case 0:case 7:return 0|(n=0)}return n=-2130706433&t|134217728,!0&268435456==(2013265920&t)?!0&16777216==(117440512&t)&0!=(0|He(e,n))?0|(n=0):0|(n=0|Ve(e,n)):0|(n=0)}function ke(e,t,n){n|=0;var r,a,o=0,s=0;return a=R,R=R+16|0,r=a,s=-2130706433&(t|=0)|134217728,!0&268435456==(2013265920&t)?(o=0|dn(0|(e|=0),0|t,56),T(),o=0|function(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0;if(o=R,R=R+16|0,a=o,r=0|He(e,t),(n+-1|0)>>>0>5)return R=o,0|(a=-1);if(r=0!=(0|r),1==(0|n)&r)return R=o,0|(a=-1);do{if(!(0|Ut(e,t,a))){if(r){r=(5+(0|i[26352+(n<<2)>>2])-(0|i[a>>2])|0)%5|0;break}r=(6+(0|i[26384+(n<<2)>>2])-(0|i[a>>2])|0)%6|0;break}r=-1}while(0);return a=r,R=o,0|a}(e,s,7&o),-1==(0|o)?(i[n>>2]=0,R=a,0|(s=6)):(0|rt(e,s,r)&&C(27795,26932,282,26947),t=0|dn(0|e,0|t,52),T(),t&=15,0|He(e,s)?je(r,t,o,2,n):Fe(r,t,o,2,n),R=a,0|(s=0))):(R=a,0|(s=6))}function Re(e,t,n,r){t|=0,r|=0;var o,s=0,l=0,c=0,u=0;if(o=R,R=R+16|0,function(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0;s=R,R=R+32|0,o=s,function(e,t){e|=0,t|=0;var n=0,r=0,i=0;n=+a[e>>3],r=+h(+n),n=+p(+n),a[t+16>>3]=n,n=+a[e+8>>3],i=r*+h(+n),a[t>>3]=i,n=r*+p(+n),a[t+8>>3]=n}(e,o),i[t>>2]=0,a[n>>3]=5,r=+zt(16400,o),r<+a[n>>3]&&(i[t>>2]=0,a[n>>3]=r);r=+zt(16424,o),r<+a[n>>3]&&(i[t>>2]=1,a[n>>3]=r);r=+zt(16448,o),r<+a[n>>3]&&(i[t>>2]=2,a[n>>3]=r);r=+zt(16472,o),r<+a[n>>3]&&(i[t>>2]=3,a[n>>3]=r);r=+zt(16496,o),r<+a[n>>3]&&(i[t>>2]=4,a[n>>3]=r);r=+zt(16520,o),r<+a[n>>3]&&(i[t>>2]=5,a[n>>3]=r);r=+zt(16544,o),r<+a[n>>3]&&(i[t>>2]=6,a[n>>3]=r);r=+zt(16568,o),r<+a[n>>3]&&(i[t>>2]=7,a[n>>3]=r);r=+zt(16592,o),r<+a[n>>3]&&(i[t>>2]=8,a[n>>3]=r);r=+zt(16616,o),r<+a[n>>3]&&(i[t>>2]=9,a[n>>3]=r);r=+zt(16640,o),r<+a[n>>3]&&(i[t>>2]=10,a[n>>3]=r);r=+zt(16664,o),r<+a[n>>3]&&(i[t>>2]=11,a[n>>3]=r);r=+zt(16688,o),r<+a[n>>3]&&(i[t>>2]=12,a[n>>3]=r);r=+zt(16712,o),r<+a[n>>3]&&(i[t>>2]=13,a[n>>3]=r);r=+zt(16736,o),r<+a[n>>3]&&(i[t>>2]=14,a[n>>3]=r);r=+zt(16760,o),r<+a[n>>3]&&(i[t>>2]=15,a[n>>3]=r);r=+zt(16784,o),r<+a[n>>3]&&(i[t>>2]=16,a[n>>3]=r);r=+zt(16808,o),r<+a[n>>3]&&(i[t>>2]=17,a[n>>3]=r);r=+zt(16832,o),r<+a[n>>3]&&(i[t>>2]=18,a[n>>3]=r);if(r=+zt(16856,o),!(r<+a[n>>3]))return void(R=s);i[t>>2]=19,a[n>>3]=r,R=s}(e|=0,n|=0,u=o),(l=+m(+(1-.5*+a[u>>3])))<1e-16)return i[r>>2]=0,i[r+4>>2]=0,i[r+8>>2]=0,i[r+12>>2]=0,void(R=o);if(u=0|i[n>>2],s=+ut((s=+a[15920+(24*u|0)>>3])-+ut(+function(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0,s=0;return o=+a[t>>3],r=+h(+o),i=+a[t+8>>3]-+a[e+8>>3],s=r*+p(+i),n=+a[e>>3],+ +A(+s,+(+p(+o)*+h(+n)-+h(+i)*(r*+p(+n))))}(15600+(u<<4)|0,e))),c=0|et(t)?+ut(s+-.3334731722518321):s,s=2.618033988749896*+f(+l),(0|t)>0){e=0;do{s*=2.6457513110645907,e=e+1|0}while((0|e)!=(0|t))}l=+h(+c)*s,a[r>>3]=l,c=+p(+c)*s,a[r+8>>3]=c,R=o}function Le(e,t,n,r,o){t|=0,n|=0,r|=0,o|=0;var s,l=0,d=0;if(l=+function(e){e|=0;var t=0,n=0;return n=+a[e>>3],t=+a[e+8>>3],+ +u(+(n*n+t*t))}(e|=0),l<1e-16)return t=15600+(t<<4)|0,i[o>>2]=i[t>>2],i[o+4>>2]=i[t+4>>2],i[o+8>>2]=i[t+8>>2],void(i[o+12>>2]=i[t+12>>2]);if(d=+A(+ +a[e+8>>3],+ +a[e>>3]),(0|n)>0){e=0;do{l*=.37796447300922725,e=e+1|0}while((0|e)!=(0|n))}s=.3333333333333333*l,r?(n=0==(0|et(n)),l=+v(.381966011250105*(n?s:.37796447300922725*s))):(l=+v(.381966011250105*l),0|et(n)&&(d=+ut(d+.3334731722518321))),function(e,t,n,r){e|=0,t=+t,n=+n,r|=0;var o=0,s=0,l=0,u=0;if(n<1e-16)return i[r>>2]=i[e>>2],i[r+4>>2]=i[e+4>>2],i[r+8>>2]=i[e+8>>2],void(i[r+12>>2]=i[e+12>>2]);s=t<0?t+6.283185307179586:t,s=t>=6.283185307179586?s+-6.283185307179586:s;do{if(!(s<1e-16)){if(o=+c(+(s+-3.141592653589793))<1e-16,t=+a[e>>3],o){t-=n,a[r>>3]=t,o=r;break}if(l=+h(+n),n=+p(+n),t=l*+p(+t)+ +h(+s)*(n*+h(+t)),t=+g(+((t=t>1?1:t)<-1?-1:t)),a[r>>3]=t,+c(+(t+-1.5707963267948966))<1e-16)return a[r>>3]=1.5707963267948966,void(a[r+8>>3]=0);if(+c(+(t+1.5707963267948966))<1e-16)return a[r>>3]=-1.5707963267948966,void(a[r+8>>3]=0);if(u=1/+h(+t),s=n*+p(+s)*u,n=+a[e>>3],t=u*((l-+p(+t)*+p(+n))/+h(+n)),l=s>1?1:s,t=t>1?1:t,(t=+a[e+8>>3]+ +A(+(l<-1?-1:l),+(t<-1?-1:t)))>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);return void(a[r+8>>3]=t)}t=+a[e>>3]+n,a[r>>3]=t,o=r}while(0);if(+c(+(t+-1.5707963267948966))<1e-16)return a[o>>3]=1.5707963267948966,void(a[r+8>>3]=0);if(+c(+(t+1.5707963267948966))<1e-16)return a[o>>3]=-1.5707963267948966,void(a[r+8>>3]=0);if(t=+a[e+8>>3],t>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);a[r+8>>3]=t}(15600+(t<<4)|0,+ut(+a[15920+(24*t|0)>>3]-d),l,o)}function Oe(e,t,n){t|=0,n|=0;var r,a;r=R,R=R+16|0,se((e|=0)+4|0,a=r),Le(a,0|i[e>>2],t,0,n),R=r}function je(e,t,n,r,o){e|=0,t|=0,n|=0,r|=0,o|=0;var s,l,c,u,d,h,p,f,m,g,v,A,y,b,x,_,w,S,T,M,E,P,N=0,k=0,L=0,O=0,j=0,D=0;if(P=R,R=R+272|0,O=P+240|0,T=P,M=P+224|0,E=P+208|0,v=P+176|0,A=P+160|0,y=P+192|0,b=P+144|0,x=P+128|0,_=P+112|0,w=P+96|0,S=P+80|0,i[(N=P+256|0)>>2]=t,i[O>>2]=i[e>>2],i[O+4>>2]=i[e+4>>2],i[O+8>>2]=i[e+8>>2],i[O+12>>2]=i[e+12>>2],De(O,N,T),i[o>>2]=0,(0|(O=r+n+(5==(0|r)&1)|0))<=(0|n))R=P;else{l=M+4|0,c=v+4|0,u=n+5|0,d=16880+((s=0|i[N>>2])<<2)|0,h=16960+(s<<2)|0,p=x+8|0,f=_+8|0,m=w+8|0,g=E+4|0,L=n;e:for(;;){k=T+((0|L)%5<<4)|0,i[E>>2]=i[k>>2],i[E+4>>2]=i[k+4>>2],i[E+8>>2]=i[k+8>>2],i[E+12>>2]=i[k+12>>2];do{}while(2==(0|Ie(E,s,0,1)));if((0|L)>(0|n)&0!=(0|et(t))){if(i[v>>2]=i[E>>2],i[v+4>>2]=i[E+4>>2],i[v+8>>2]=i[E+8>>2],i[v+12>>2]=i[E+12>>2],se(l,A),r=0|i[v>>2],N=0|i[17040+(80*r|0)+(i[M>>2]<<2)>>2],i[v>>2]=i[18640+(80*r|0)+(20*N|0)>>2],(0|(k=0|i[18640+(80*r|0)+(20*N|0)+16>>2]))>0){e=0;do{ye(c),e=e+1|0}while((0|e)<(0|k))}switch(k=18640+(80*r|0)+(20*N|0)+4|0,i[y>>2]=i[k>>2],i[y+4>>2]=i[k+4>>2],i[y+8>>2]=i[k+8>>2],ue(y,3*(0|i[d>>2])|0),le(c,y,c),oe(c),se(c,b),j=+(0|i[h>>2]),a[x>>3]=3*j,a[p>>3]=0,D=-1.5*j,a[_>>3]=D,a[f>>3]=2.598076211353316*j,a[w>>3]=D,a[m>>3]=-2.598076211353316*j,0|i[17040+(80*(0|i[v>>2])|0)+(i[E>>2]<<2)>>2]){case 1:e=_,r=x;break;case 3:e=w,r=_;break;case 2:e=x,r=w;break;default:e=12;break e}Bt(A,b,r,e,S),Le(S,0|i[v>>2],s,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=1+(0|i[o>>2])}if((0|L)<(0|u)&&(se(g,v),Le(v,0|i[E>>2],s,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=1+(0|i[o>>2])),i[M>>2]=i[E>>2],i[M+4>>2]=i[E+4>>2],i[M+8>>2]=i[E+8>>2],i[M+12>>2]=i[E+12>>2],(0|(L=L+1|0))>=(0|O)){e=3;break}}3!=(0|e)?12==(0|e)&&C(26970,27017,572,27027):R=P}}function De(e,t,n){e|=0,t|=0,n|=0;var r,a=0,o=0,s=0,l=0,c=0;r=R,R=R+128|0,o=r,l=20240,c=(s=a=r+64|0)+60|0;do{i[s>>2]=i[l>>2],s=s+4|0,l=l+4|0}while((0|s)<(0|c));l=20304,c=(s=o)+60|0;do{i[s>>2]=i[l>>2],s=s+4|0,l=l+4|0}while((0|s)<(0|c));a=(c=0==(0|et(0|i[t>>2])))?a:o,we(o=e+4|0),Se(o),0|et(0|i[t>>2])&&(ve(o),i[t>>2]=1+(0|i[t>>2])),i[n>>2]=i[e>>2],le(o,a,t=n+4|0),oe(t),i[n+16>>2]=i[e>>2],le(o,a+12|0,t=n+20|0),oe(t),i[n+32>>2]=i[e>>2],le(o,a+24|0,t=n+36|0),oe(t),i[n+48>>2]=i[e>>2],le(o,a+36|0,t=n+52|0),oe(t),i[n+64>>2]=i[e>>2],le(o,a+48|0,n=n+68|0),oe(n),R=r}function Ie(e,t,n,r){n|=0,r|=0;var a,o,s,l,c,u,d=0,h=0,p=0,f=0,m=0;if(u=R,R=R+32|0,c=u+12|0,o=u,m=(e|=0)+4|0,f=0|i[16960+((t|=0)<<2)>>2],f=(l=0!=(0|r))?3*f|0:f,d=0|i[m>>2],a=0|i[(s=e+8|0)>>2],l){if((0|(d=a+d+(r=0|i[(h=e+12|0)>>2])|0))==(0|f))return R=u,0|(m=1);p=h}else d=a+d+(r=0|i[(p=e+12|0)>>2])|0;if((0|d)<=(0|f))return R=u,0|(m=0);do{if((0|r)>0){if(r=0|i[e>>2],(0|a)>0){h=18640+(80*r|0)+60|0,r=e;break}r=18640+(80*r|0)+40|0,n?(ie(c,f,0,0),ce(m,c,o),be(o),le(o,c,m),h=r,r=e):(h=r,r=e)}else h=18640+(80*(0|i[e>>2])|0)+20|0,r=e}while(0);if(i[r>>2]=i[h>>2],(0|i[(d=h+16|0)>>2])>0){r=0;do{ye(m),r=r+1|0}while((0|r)<(0|i[d>>2]))}return e=h+4|0,i[c>>2]=i[e>>2],i[c+4>>2]=i[e+4>>2],i[c+8>>2]=i[e+8>>2],t=0|i[16880+(t<<2)>>2],ue(c,l?3*t|0:t),le(m,c,m),oe(m),r=l&&((0|i[s>>2])+(0|i[m>>2])+(0|i[p>>2])|0)==(0|f)?1:2,R=u,0|(m=r)}function Be(e,t){e|=0,t|=0;var n=0;do{n=0|Ie(e,t,0,1)}while(2==(0|n));return 0|n}function Fe(e,t,n,r,o){e|=0,t|=0,n|=0,r|=0,o|=0;var s,l,c,u,d,h,p,f,m,g,v,A,y,b,x,_,w,S,T=0,M=0,E=0,P=0,N=0;if(S=R,R=R+240|0,b=S+208|0,x=S,_=S+192|0,w=S+176|0,m=S+160|0,g=S+144|0,v=S+128|0,A=S+112|0,y=S+96|0,i[(T=S+224|0)>>2]=t,i[b>>2]=i[e>>2],i[b+4>>2]=i[e+4>>2],i[b+8>>2]=i[e+8>>2],i[b+12>>2]=i[e+12>>2],ze(b,T,x),i[o>>2]=0,(0|(f=r+n+(6==(0|r)&1)|0))<=(0|n))R=S;else{l=n+6|0,c=16960+((s=0|i[T>>2])<<2)|0,u=g+8|0,d=v+8|0,h=A+8|0,p=_+4|0,M=0,E=n,r=-1;e:for(;;){if(e=x+((T=(0|E)%6|0)<<4)|0,i[_>>2]=i[e>>2],i[_+4>>2]=i[e+4>>2],i[_+8>>2]=i[e+8>>2],i[_+12>>2]=i[e+12>>2],e=M,M=0|Ie(_,s,0,1),(0|E)>(0|n)&0!=(0|et(t))&&(1!=(0|e)&&(0|i[_>>2])!=(0|r))){switch(se(x+((T+5|0)%6<<4)+4|0,w),se(x+(T<<4)+4|0,m),P=+(0|i[c>>2]),a[g>>3]=3*P,a[u>>3]=0,N=-1.5*P,a[v>>3]=N,a[d>>3]=2.598076211353316*P,a[A>>3]=N,a[h>>3]=-2.598076211353316*P,T=0|i[b>>2],0|i[17040+(80*T|0)+(((0|r)==(0|T)?i[_>>2]:r)<<2)>>2]){case 1:e=v,r=g;break;case 3:e=A,r=v;break;case 2:e=g,r=A;break;default:e=8;break e}Bt(w,m,r,e,y),0|Ft(w,y)||0|Ft(m,y)||(Le(y,0|i[b>>2],s,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=1+(0|i[o>>2]))}if((0|E)<(0|l)&&(se(p,w),Le(w,0|i[_>>2],s,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=1+(0|i[o>>2])),(0|(E=E+1|0))>=(0|f)){e=3;break}r=0|i[_>>2]}3!=(0|e)?8==(0|e)&&C(27054,27017,737,27099):R=S}}function ze(e,t,n){e|=0,t|=0,n|=0;var r,a=0,o=0,s=0,l=0,c=0;r=R,R=R+160|0,o=r,l=20368,c=(s=a=r+80|0)+72|0;do{i[s>>2]=i[l>>2],s=s+4|0,l=l+4|0}while((0|s)<(0|c));l=20448,c=(s=o)+72|0;do{i[s>>2]=i[l>>2],s=s+4|0,l=l+4|0}while((0|s)<(0|c));a=(c=0==(0|et(0|i[t>>2])))?a:o,we(o=e+4|0),Se(o),0|et(0|i[t>>2])&&(ve(o),i[t>>2]=1+(0|i[t>>2])),i[n>>2]=i[e>>2],le(o,a,t=n+4|0),oe(t),i[n+16>>2]=i[e>>2],le(o,a+12|0,t=n+20|0),oe(t),i[n+32>>2]=i[e>>2],le(o,a+24|0,t=n+36|0),oe(t),i[n+48>>2]=i[e>>2],le(o,a+36|0,t=n+52|0),oe(t),i[n+64>>2]=i[e>>2],le(o,a+48|0,t=n+68|0),oe(t),i[n+80>>2]=i[e>>2],le(o,a+60|0,n=n+84|0),oe(n),R=r}function Ue(e,t){return t=0|dn(0|(e|=0),0|(t|=0),45),T(),127&t}function Ve(e,t){e|=0;var n=0,i=0,a=0,o=0;return!0&134217728==(-16777216&(t|=0))?(i=0|dn(0|e,0|t,52),T(),i&=15,n=0|dn(0|e,0|t,45),T(),(n&=127)>>>0>121?0|(e=0):0==(613566756&(o=0|hn(0|(a=0|dn(0|e,0|t,0|(o=3*(15^i)|0))),0|T(),0|o))&(0|nn(-1227133514,-1171,0|o,0|(a=0|T()))))&0==(4681&a&T())&&15==(0|i)|0==(0|(o=0|dn(0|(0|hn(0|~e,0|~t,0|(o=19+(3*i|0)|0))),0|T(),0|o)))&0==(0|T())?0|r[20528+n|0]?0==(0|e)&0==(0|(t&=8191))?0|(o=1):(o=0|pn(0|e,0|t,0),T(),0!=((63-o|0)%3|0)|0):0|(o=1):0|(o=0)):0|(e=0)}function Ge(e,t,n,r){e|=0,n|=0,r|=0;var a=0,o=0,s=0,l=0;if(a=0|hn(0|(t|=0),0,52),o=0|T(),n=0|hn(0|n,0,45),n=0|o|T()|134225919,(0|t)<1)return o=-1,r=n,i[(t=e)>>2]=o,void(i[(e=e+4|0)>>2]=r);for(o=1,a=-1;l=0|hn(7,0,0|(s=3*(15-o|0)|0)),n&=~T(),a=a&~l|(s=0|hn(0|r,0,0|s)),n=0|n|T(),(0|o)!=(0|t);)o=o+1|0;i[(s=l=e)>>2]=a,i[(l=l+4|0)>>2]=n}function qe(e,t,n,r){n|=0,r|=0;var a=0,o=0;if(o=0|dn(0|(e|=0),0|(t|=0),52),T(),n>>>0>15)return 0|(r=4);if((0|(o&=15))<(0|n))return 0|(r=12);if((0|o)==(0|n))return i[r>>2]=e,i[r+4>>2]=t,0|(r=0);if(a=0|hn(0|n,0,52),a|=e,e=T()|-15728641&t,(0|o)>(0|n))do{t=0|hn(7,0,3*(14-n|0)|0),n=n+1|0,a|=t,e=0|T()|e}while((0|n)<(0|o));return i[r>>2]=a,i[r+4>>2]=e,0|(r=0)}function We(e,t,n,r){n|=0,r|=0;var a=0,o=0,s=0;if(o=0|dn(0|(e|=0),0|(t|=0),52),T(),!((0|n)<16&(0|(o&=15))<=(0|n)))return 0|(r=4);a=n-o|0,n=0|dn(0|e,0|t,45),T();e:do{if(0|V(127&n)){t:do{if(0|o){for(n=1;0==((s=0|hn(7,0,3*(15-n|0)|0))&e|0)&0==((0|T())&t);){if(!(n>>>0<o>>>0))break t;n=n+1|0}n=0|Tt(7,0,a,((0|a)<0)<<31>>31),a=0|T();break e}}while(0);n=0|tn(0|(n=0|sn(0|(n=0|Tt(7,0,a,((0|a)<0)<<31>>31)),0|T(),5,0)),0|T(),-5,-1),n=0|tn(0|(n=0|on(0|n,0|T(),6,0)),0|T(),1,0),a=0|T()}else n=0|Tt(7,0,a,((0|a)<0)<<31>>31),a=0|T()}while(0);return i[(s=r)>>2]=n,i[s+4>>2]=a,0|(s=0)}function He(e,t){var n=0,r=0,i=0;if(i=0|dn(0|(e|=0),0|(t|=0),45),T(),!(0|V(127&i)))return 0|(i=0);i=0|dn(0|e,0|t,52),T(),i&=15;e:do{if(i)for(r=1;;){if(n=0|dn(0|e,0|t,3*(15-r|0)|0),T(),0|(n&=7))break e;if(!(r>>>0<i>>>0)){n=0;break}r=r+1|0}else n=0}while(0);return 0|(i=0==(0|n)&1)}function $e(e,t,n,r){return e|=0,t|=0,(0|(r|=0))<(0|(n|=0))?(r=e,S(0|(n=t)),0|r):(n=0|hn(-1,-1,3+(3*(r-n|0)|0)|0),r=0|hn(0|~n,0|~T(),3*(15-r|0)|0),n=~T()&t,r=~r&e,S(0|n),0|r)}function Ke(e,t,n,r){n|=0,r|=0;var a=0;return a=0|dn(0|(e|=0),0|(t|=0),52),T(),(0|n)<16&(0|(a&=15))<=(0|n)?((0|a)<(0|n)&&(a=0|hn(-1,-1,3+(3*(n+-1-a|0)|0)|0),a=0|hn(0|~a,0|~T(),3*(15-n|0)|0),t=~T()&t,e&=~a),a=0|hn(0|n,0,52),n=-15728641&t|T(),i[r>>2]=e|a,i[r+4>>2]=n,0|(r=0)):0|(r=4)}function Xe(e,t){var n=0,r=0,i=0;if(i=0|dn(0|(e|=0),0|(t|=0),52),T(),!(i&=15))return 0|(i=0);for(r=1;;){if(n=0|dn(0|e,0|t,3*(15-r|0)|0),T(),0|(n&=7)){r=5;break}if(!(r>>>0<i>>>0)){n=0,r=5;break}r=r+1|0}return 5==(0|r)?0|n:0}function Ye(e,t){var n=0,r=0,i=0,a=0,o=0,s=0,l=0;if(l=0|dn(0|(e|=0),0|(t|=0),52),T(),!(l&=15))return l=e,S(0|(s=t)),0|l;for(s=1,n=0;;){r=0|hn(7,0,0|(a=3*(15-s|0)|0)),i=0|T(),o=0|dn(0|e,0|t,0|a),T(),e=(a=0|hn(0|xe(7&o),0,0|a))|e&~r,t=(o=0|T())|t&~i;e:do{if(!n)if(0==(a&r|0)&0==(o&i|0))n=0;else if(r=0|dn(0|e,0|t,52),T(),r&=15){n=1;t:for(;;){switch(o=0|dn(0|e,0|t,3*(15-n|0)|0),T(),7&o){case 1:break t;case 0:break;default:n=1;break e}if(!(n>>>0<r>>>0)){n=1;break e}n=n+1|0}for(n=1;;){if(i=0|dn(0|e,0|t,0|(o=3*(15-n|0)|0)),T(),a=0|hn(7,0,0|o),t&=~T(),e=e&~a|(o=0|hn(0|xe(7&i),0,0|o)),t=0|t|T(),!(n>>>0<r>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(s>>>0<l>>>0))break;s=s+1|0}return S(0|t),0|e}function Qe(e,t){var n=0,r=0,i=0,a=0,o=0;if(r=0|dn(0|(e|=0),0|(t|=0),52),T(),!(r&=15))return r=e,S(0|(n=t)),0|r;for(n=1;o=0|dn(0|e,0|t,0|(a=3*(15-n|0)|0)),T(),i=0|hn(7,0,0|a),t&=~T(),e=(a=0|hn(0|xe(7&o),0,0|a))|e&~i,t=0|T()|t,n>>>0<r>>>0;)n=n+1|0;return S(0|t),0|e}function Ze(e,t){var n=0,r=0,i=0,a=0,o=0,s=0,l=0;if(l=0|dn(0|(e|=0),0|(t|=0),52),T(),!(l&=15))return l=e,S(0|(s=t)),0|l;for(s=1,n=0;;){r=0|hn(7,0,0|(a=3*(15-s|0)|0)),i=0|T(),o=0|dn(0|e,0|t,0|a),T(),e=(a=0|hn(0|_e(7&o),0,0|a))|e&~r,t=(o=0|T())|t&~i;e:do{if(!n)if(0==(a&r|0)&0==(o&i|0))n=0;else if(r=0|dn(0|e,0|t,52),T(),r&=15){n=1;t:for(;;){switch(o=0|dn(0|e,0|t,3*(15-n|0)|0),T(),7&o){case 1:break t;case 0:break;default:n=1;break e}if(!(n>>>0<r>>>0)){n=1;break e}n=n+1|0}for(n=1;;){if(a=0|hn(7,0,0|(i=3*(15-n|0)|0)),o=t&~T(),t=0|dn(0|e,0|t,0|i),T(),e=e&~a|(t=0|hn(0|_e(7&t),0,0|i)),t=0|o|T(),!(n>>>0<r>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(s>>>0<l>>>0))break;s=s+1|0}return S(0|t),0|e}function Je(e,t){var n=0,r=0,i=0,a=0,o=0;if(r=0|dn(0|(e|=0),0|(t|=0),52),T(),!(r&=15))return r=e,S(0|(n=t)),0|r;for(n=1;a=0|hn(7,0,0|(o=3*(15-n|0)|0)),i=t&~T(),t=0|dn(0|e,0|t,0|o),T(),e=(t=0|hn(0|_e(7&t),0,0|o))|e&~a,t=0|T()|i,n>>>0<r>>>0;)n=n+1|0;return S(0|t),0|e}function et(e){return(0|(e|=0))%2|0}function tt(e,t,n){n|=0;var r,a=0;return r=R,R=R+16|0,a=r,(t|=0)>>>0>15?(R=r,0|(a=4)):2146435072==(2146435072&i[(e|=0)+4>>2])||2146435072==(2146435072&i[e+8+4>>2])?(R=r,0|(a=3)):(function(e,t,n){var r,i;r=R,R=R+16|0,Re(e|=0,t|=0,n|=0,i=r),ae(i,n+4|0),R=r}(e,t,a),t=0|function(e,t){e|=0;var n,r=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0;if(n=R,R=R+64|0,c=n+40|0,a=n+24|0,o=n+12|0,s=n,hn(0|(t|=0),0,52),r=134225919|T(),!t)return(0|i[e+4>>2])>2||(0|i[e+8>>2])>2||(0|i[e+12>>2])>2?(c=0,S(0|(l=0)),R=n,0|c):(hn(0|q(e),0,45),l=0|T()|r,c=-1,S(0|l),R=n,0|c);if(i[c>>2]=i[e>>2],i[c+4>>2]=i[e+4>>2],i[c+8>>2]=i[e+8>>2],i[c+12>>2]=i[e+12>>2],l=c+4|0,(0|t)>0)for(e=-1;i[a>>2]=i[l>>2],i[a+4>>2]=i[l+4>>2],i[a+8>>2]=i[l+8>>2],1&t?(fe(l),i[o>>2]=i[l>>2],i[o+4>>2]=i[l+4>>2],i[o+8>>2]=i[l+8>>2],ge(o)):(me(l),i[o>>2]=i[l>>2],i[o+4>>2]=i[l+4>>2],i[o+8>>2]=i[l+8>>2],ve(o)),ce(a,o,s),oe(s),u=0|hn(7,0,0|(d=3*(15-t|0)|0)),r&=~T(),e=(d=0|hn(0|de(s),0,0|d))|e&~u,r=0|T()|r,(0|t)>1;)t=t+-1|0;else e=-1;e:do{if((0|i[l>>2])<=2&&(0|i[c+8>>2])<=2&&(0|i[c+12>>2])<=2){if(t=0|hn(0|(a=0|q(c)),0,45),t|=e,e=T()|-1040385&r,s=0|W(c),!(0|V(a))){if((0|s)<=0)break;for(o=0;;){if(a=0|dn(0|t,0|e,52),T(),a&=15)for(r=1;c=0|dn(0|t,0|e,0|(d=3*(15-r|0)|0)),T(),u=0|hn(7,0,0|d),e&=~T(),t=t&~u|(d=0|hn(0|xe(7&c),0,0|d)),e=0|e|T(),r>>>0<a>>>0;)r=r+1|0;if((0|(o=o+1|0))==(0|s))break e}}o=0|dn(0|t,0|e,52),T(),o&=15;t:do{if(o){r=1;n:for(;;){switch(d=0|dn(0|t,0|e,3*(15-r|0)|0),T(),7&d){case 1:break n;case 0:break;default:break t}if(!(r>>>0<o>>>0))break t;r=r+1|0}if(0|H(a,0|i[c>>2]))for(r=1;u=0|hn(7,0,0|(c=3*(15-r|0)|0)),d=e&~T(),e=0|dn(0|t,0|e,0|c),T(),t=t&~u|(e=0|hn(0|_e(7&e),0,0|c)),e=0|d|T(),r>>>0<o>>>0;)r=r+1|0;else for(r=1;c=0|dn(0|t,0|e,0|(d=3*(15-r|0)|0)),T(),u=0|hn(7,0,0|d),e&=~T(),t=t&~u|(d=0|hn(0|xe(7&c),0,0|d)),e=0|e|T(),r>>>0<o>>>0;)r=r+1|0}}while(0);if((0|s)>0){r=0;do{t=0|Ye(t,e),e=0|T(),r=r+1|0}while((0|r)!=(0|s))}}else t=0,e=0}while(0);return d=t,S(0|(u=e)),R=n,0|d}(a,t),a=0|T(),i[n>>2]=t,i[n+4>>2]=a,0==(0|t)&0==(0|a)&&C(27795,27122,1050,27145),R=r,0|(a=0))}function nt(e,t,n){var r,a=0,o=0,s=0;if(r=(n|=0)+4|0,o=0|dn(0|(e|=0),0|(t|=0),52),T(),o&=15,s=0|dn(0|e,0|t,45),T(),a=0==(0|o),0|V(127&s)){if(a)return 0|(s=1);a=1}else{if(a)return 0|(s=0);a=0==(0|i[r>>2])&&0==(0|i[n+8>>2])?0!=(0|i[n+12>>2])&1:1}for(n=1;1&n?ge(r):ve(r),s=0|dn(0|e,0|t,3*(15-n|0)|0),T(),Ae(r,7&s),n>>>0<o>>>0;)n=n+1|0;return 0|a}function rt(e,t,n){n|=0;var r,a,o=0,s=0,l=0,c=0,u=0,d=0;if(a=R,R=R+16|0,r=a,d=0|dn(0|(e|=0),0|(t|=0),45),T(),(d&=127)>>>0>121)return i[n>>2]=0,i[n+4>>2]=0,i[n+8>>2]=0,i[n+12>>2]=0,R=a,0|(d=5);e:do{if(0!=(0|V(d))&&(l=0|dn(0|e,0|t,52),T(),0!=(0|(l&=15)))){o=1;t:for(;;){switch(u=0|dn(0|e,0|t,3*(15-o|0)|0),T(),7&u){case 5:break t;case 0:break;default:o=t;break e}if(!(o>>>0<l>>>0)){o=t;break e}o=o+1|0}for(s=1,o=t;c=0|hn(7,0,0|(t=3*(15-s|0)|0)),u=o&~T(),o=0|dn(0|e,0|o,0|t),T(),e=e&~c|(o=0|hn(0|_e(7&o),0,0|t)),o=0|u|T(),s>>>0<l>>>0;)s=s+1|0}else o=t}while(0);if(u=7696+(28*d|0)|0,i[n>>2]=i[u>>2],i[n+4>>2]=i[u+4>>2],i[n+8>>2]=i[u+8>>2],i[n+12>>2]=i[u+12>>2],!(0|nt(e,o,n)))return R=a,0|(d=0);if(c=n+4|0,i[r>>2]=i[c>>2],i[r+4>>2]=i[c+4>>2],i[r+8>>2]=i[c+8>>2],l=0|dn(0|e,0|o,52),T(),u=15&l,1&l?(ve(c),l=u+1|0):l=u,0|V(d)){e:do{if(u)for(t=1;;){if(s=0|dn(0|e,0|o,3*(15-t|0)|0),T(),0|(s&=7)){o=s;break e}if(!(t>>>0<u>>>0)){o=0;break}t=t+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|Ie(n,l,o,0)){if(0|V(d))do{}while(0!=(0|Ie(n,l,0,0)));(0|l)!=(0|u)&&me(c)}else(0|l)!=(0|u)&&(i[c>>2]=i[r>>2],i[c+4>>2]=i[r+4>>2],i[c+8>>2]=i[r+8>>2]);return R=a,0|(d=0)}function it(e,t,n){n|=0;var r,i,a=0;return i=R,R=R+16|0,0|(a=0|rt(e|=0,t|=0,r=i))?(R=i,0|a):(a=0|dn(0|e,0|t,52),T(),Oe(r,15&a,n),R=i,0|(a=0))}function at(e,t,n){n|=0;var r,i=0,a=0,o=0;if(r=R,R=R+16|0,0|(i=0|rt(e|=0,t|=0,o=r)))return R=r,0|(o=i);i=0|dn(0|e,0|t,45),T(),i=0==(0|V(127&i)),a=0|dn(0|e,0|t,52),T(),a&=15;e:do{if(!i){if(0|a)for(i=1;;){if(!(0==((0|hn(7,0,3*(15-i|0)|0))&e|0)&0==((0|T())&t)))break e;if(!(i>>>0<a>>>0))break;i=i+1|0}return je(o,a,0,5,n),R=r,0|0}}while(0);return Fe(o,a,0,6,n),R=r,0|0}function ot(e,t){t|=0;var n=0,r=0,a=0,o=0,s=0,l=0,c=0;if((e|=0)>>>0>15)return 0|(l=4);if(hn(0|e,0,52),l=134225919|T(),!e){n=0,r=0;do{0|V(r)&&(hn(0|r,0,45),s=0|l|T(),i[(e=t+(n<<3)|0)>>2]=-1,i[e+4>>2]=s,n=n+1|0),r=r+1|0}while(122!=(0|r));return 0|(n=0)}n=0,s=0;do{if(0|V(s)){for(hn(0|s,0,45),r=1,a=-1,o=0|l|T();a&=~(c=0|hn(7,0,3*(15-r|0)|0)),o&=~T(),(0|r)!=(0|e);)r=r+1|0;i[(c=t+(n<<3)|0)>>2]=a,i[c+4>>2]=o,n=n+1|0}s=s+1|0}while(122!=(0|s));return 0|(n=0)}function st(e,t,n,r){e|=0,r|=0;var a=0,o=0,s=0;a=0|dn(0|(t|=0),0|(n|=0),52),T(),0==(0|t)&0==(0|n)|(0|r)>15|(0|(a&=15))>(0|r)?(o=-1,t=-1,n=0,a=0):(t=0|$e(t,n,a+1|0,r),s=-15728641&T(),n=0|hn(0|r,0,52),o=a,t=(t=0==(0|He(n|=t,s=0|s|T())))?-1:r,a=s),i[(s=e)>>2]=n,i[s+4>>2]=a,i[e+8>>2]=o,i[e+12>>2]=t}function lt(e,t,n,r){n|=0,r|=0;var a=0,o=0;return a=0|dn(0|(e|=0),0|(t|=0),52),T(),a&=15,i[(o=r+8|0)>>2]=a,0==(0|e)&0==(0|t)|(0|n)>15|(0|a)>(0|n)?(i[(n=r)>>2]=0,i[n+4>>2]=0,i[o>>2]=-1,void(i[r+12>>2]=-1)):(e=0|$e(e,t,a+1|0,n),o=-15728641&T(),a=0|hn(0|n,0,52),a|=e,o=0|o|T(),i[(e=r)>>2]=a,i[e+4>>2]=o,e=r+12|0,0|He(a,o)?void(i[e>>2]=n):void(i[e>>2]=-1))}function ct(e){var t,n=0,r=0,a=0,o=0,s=0,l=0,c=0,u=0;if(!(0==(0|(n=0|i[(r=e|=0)>>2]))&0==(0|(r=0|i[r+4>>2])))&&(a=0|dn(0|n,0|r,52),T(),n=0|tn(0|(c=0|hn(1,0,3*(15^(a&=15))|0)),0|T(),0|n,0|r),r=0|T(),i[(c=e)>>2]=n,i[c+4>>2]=r,!((0|a)<(0|(l=0|i[(c=e+8|0)>>2]))))){for(t=e+12|0,s=a;;){if((0|s)==(0|l)){a=5;break}if(u=(0|s)==(0|i[t>>2]),a=0|dn(0|n,0|r,0|(o=3*(15-s|0)|0)),T(),u&1==(0|(a&=7))&!0){a=7;break}if(!(7==(0|a)&!0)){a=10;break}if(n=0|tn(0|n,0|r,0|(u=0|hn(1,0,0|o)),0|T()),r=0|T(),i[(u=e)>>2]=n,i[u+4>>2]=r,!((0|s)>(0|l))){a=10;break}s=s+-1|0}if(5==(0|a))return i[(u=e)>>2]=0,i[u+4>>2]=0,i[c>>2]=-1,void(i[t>>2]=-1);if(7==(0|a))return l=0|tn(0|n,0|r,0|(l=0|hn(1,0,0|o)),0|T()),c=0|T(),i[(u=e)>>2]=l,i[u+4>>2]=c,void(i[t>>2]=s+-1)}}function ut(e){var t;return t=(e=+e)<0?e+6.283185307179586:e,+(e>=6.283185307179586?t+-6.283185307179586:t)}function dt(e,t){return t|=0,+c(+(+a[(e|=0)>>3]-+a[t>>3]))<17453292519943298e-27?0|(t=+c(+(+a[e+8>>3]-+a[t+8>>3]))<17453292519943298e-27):0|(t=0)}function ht(e,t){switch(e=+e,0|(t|=0)){case 1:e=e<0?e+6.283185307179586:e;break;case 2:e=e>0?e+-6.283185307179586:e}return+e}function pt(e,t){e|=0;var n,r,i,o=0;return r=+a[(t|=0)>>3],n=+a[e>>3],o=(i=+p(.5*(r-n)))*i+(o=+p(.5*(+a[t+8>>3]-+a[e+8>>3])))*(+h(+r)*+h(+n)*o),2*+A(+ +u(+o),+ +u(+(1-o)))*6371.007180918475}function ft(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(a[t>>3]=+a[20656+(e<<3)>>3],0|(t=0))}function mt(e,t){t|=0;var n=0;return(e|=0)>>>0>15?0|(t=4):(n=0|sn(0|(n=0|Tt(7,0,e,((0|e)<0)<<31>>31)),0|T(),120,0),e=0|T(),i[t>>2]=2|n,i[t+4>>2]=e,0|(t=0))}function gt(e,t,n){e|=0,n|=0;var r,i,o,s,l=0,c=0,d=0,m=0,g=0,y=0;return y=+a[(t|=0)>>3],o=+a[e>>3],g=+p(.5*(y-o)),d=+a[t+8>>3],i=+a[e+8>>3],m=+p(.5*(d-i)),r=+h(+o),s=+h(+y),m=2*+A(+ +u(+(m=g*g+m*(s*r*m))),+ +u(+(1-m))),g=+a[n>>3],y=+p(.5*(g-y)),l=+a[n+8>>3],d=+p(.5*(l-d)),c=+h(+g),d=2*+A(+ +u(+(d=y*y+d*(s*c*d))),+ +u(+(1-d))),g=+p(.5*(o-g)),l=+p(.5*(i-l)),l=2*+A(+ +u(+(l=g*g+l*(r*c*l))),+ +u(+(1-l))),4*+v(+ +u(+ +f(.5*(c=.5*(m+d+l)))*+f(.5*(c-m))*+f(.5*(c-d))*+f(.5*(c-l))))}function vt(e,t,n){n|=0;var r,o,s,l=0,c=0;if(s=R,R=R+192|0,o=s,0|(c=0|it(e|=0,t|=0,r=s+168|0)))return R=s,0|(n=c);if(0|at(e,t,o)&&C(27795,27190,415,27199),(0|(t=0|i[o>>2]))>0){if(l=+gt(o+8|0,o+8+((1!=(0|t)&1)<<4)|0,r)+0,1!=(0|t)){e=1;do{l+=+gt(o+8+((c=e)<<4)|0,o+8+((0|(e=e+1|0))%(0|t)<<4)|0,r)}while((0|e)<(0|t))}}else l=0;return a[n>>3]=l,R=s,0|(n=0)}function At(e){e|=0;var t,n,r=0;return(t=0|en(1,12))||C(27280,27235,49,27293),0|(r=0|i[(n=e+4|0)>>2])?(i[(r=r+8|0)>>2]=t,i[n>>2]=t,0|t):(0|i[e>>2]&&C(27310,27235,61,27333),i[(r=e)>>2]=t,i[n>>2]=t,0|t)}function yt(e,t){e|=0,t|=0;var n,r;return(r=0|Zt(24))||C(27347,27235,78,27361),i[r>>2]=i[t>>2],i[r+4>>2]=i[t+4>>2],i[r+8>>2]=i[t+8>>2],i[r+12>>2]=i[t+12>>2],i[r+16>>2]=0,0|(n=0|i[(t=e+4|0)>>2])?(i[n+16>>2]=r,i[t>>2]=r,0|r):(0|i[e>>2]&&C(27376,27235,82,27361),i[e>>2]=r,i[t>>2]=r,0|r)}function bt(e){var t=0,n=0,r=0,a=0;if(e|=0)for(r=1;;){if(0|(t=0|i[e>>2]))do{if(0|(n=0|i[t>>2]))do{a=n,n=0|i[n+16>>2],Jt(a)}while(0!=(0|n));a=t,t=0|i[t+8>>2],Jt(a)}while(0!=(0|t));if(t=e,e=0|i[e+8>>2],r||Jt(t),!e)break;r=0}}function xt(e){var t,n,r=0,o=0,s=0,l=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0,w=0,S=0,T=0,M=0,E=0,P=0,N=0,k=0,R=0,L=0,O=0,j=0,D=0;if(0|i[(l=(e|=0)+8|0)>>2])return 0|(D=1);if(!(s=0|i[e>>2]))return 0|(D=0);r=s,o=0;do{o=o+1|0,r=0|i[r+8>>2]}while(0!=(0|r));if(o>>>0<2)return 0|(D=0);(n=0|Zt(o<<2))||C(27396,27235,317,27415),(t=0|Zt(o<<5))||C(27437,27235,321,27415),i[e>>2]=0,i[(E=e+4|0)>>2]=0,i[l>>2]=0,o=0,O=0,M=0,g=0;e:for(;;){if(m=0|i[s>>2]){u=0,d=m;do{if(p=+a[d+8>>3],r=d,d=0|i[d+16>>2],h=+a[(l=(f=0==(0|d))?m:d)+8>>3],+c(+(p-h))>3.141592653589793){D=14;break}u+=(h-p)*(+a[r>>3]+ +a[l>>3])}while(!f);if(14==(0|D)){D=0,u=0,r=m;do{T=+a[r+8>>3],R=0|i[(L=r+16|0)>>2],S=+a[(R=0==(0|R)?m:R)+8>>3],u+=(+a[r>>3]+ +a[R>>3])*((S<0?S+6.283185307179586:S)-(T<0?T+6.283185307179586:T)),r=0|i[(0==(0|r)?s:L)>>2]}while(0!=(0|r))}u>0?(i[n+(O<<2)>>2]=s,O=O+1|0,l=M,r=g):D=19}else D=19;if(19==(0|D)){D=0;do{if(!o){if(g){l=E,d=g+8|0,r=s,o=e;break}if(0|i[e>>2]){D=27;break e}l=E,d=e,r=s,o=e;break}if(0|i[(r=o+8|0)>>2]){D=21;break e}if(!(o=0|en(1,12))){D=23;break e}i[r>>2]=o,l=o+4|0,d=o,r=g}while(0);if(i[d>>2]=s,i[l>>2]=s,d=t+(M<<5)|0,f=0|i[s>>2]){for(a[(m=t+(M<<5)+8|0)>>3]=17976931348623157e292,a[(g=t+(M<<5)+24|0)>>3]=17976931348623157e292,a[d>>3]=-17976931348623157e292,a[(v=t+(M<<5)+16|0)>>3]=-17976931348623157e292,_=17976931348623157e292,w=-17976931348623157e292,l=0,A=f,p=17976931348623157e292,b=17976931348623157e292,x=-17976931348623157e292,h=-17976931348623157e292;u=+a[A>>3],T=+a[A+8>>3],A=0|i[A+16>>2],S=+a[((y=0==(0|A))?f:A)+8>>3],u<p&&(a[m>>3]=u,p=u),T<b&&(a[g>>3]=T,b=T),u>x?a[d>>3]=u:u=x,T>h&&(a[v>>3]=T,h=T),_=T>0&T<_?T:_,w=T<0&T>w?T:w,l|=+c(+(T-S))>3.141592653589793,!y;)x=u;l&&(a[v>>3]=w,a[g>>3]=_)}else i[d>>2]=0,i[d+4>>2]=0,i[d+8>>2]=0,i[d+12>>2]=0,i[d+16>>2]=0,i[d+20>>2]=0,i[d+24>>2]=0,i[d+28>>2]=0;l=M+1|0}if(s=0|i[(L=s+8|0)>>2],i[L>>2]=0,!s){D=45;break}M=l,g=r}if(21==(0|D))C(27213,27235,35,27247);else if(23==(0|D))C(27267,27235,37,27247);else if(27==(0|D))C(27310,27235,61,27333);else if(45==(0|D)){e:do{if((0|O)>0){for(L=0==(0|l),k=l<<2,R=0==(0|e),N=0,r=0;;){if(P=0|i[n+(N<<2)>>2],L)D=73;else{if(!(M=0|Zt(k))){D=50;break}if(!(E=0|Zt(k))){D=52;break}t:do{if(R)o=0;else{for(l=0,o=0,d=e;s=t+(l<<5)|0,0|_t(0|i[d>>2],s,0|i[P>>2])?(i[M+(o<<2)>>2]=d,i[E+(o<<2)>>2]=s,y=o+1|0):y=o,d=0|i[d+8>>2];)l=l+1|0,o=y;if((0|y)>0)if(s=0|i[M>>2],1==(0|y))o=s;else for(v=0,A=-1,o=s,g=s;;){for(f=0|i[g>>2],s=0,d=0;m=(0|(l=0|i[i[M+(d<<2)>>2]>>2]))==(0|f)?s:s+(1&_t(l,0|i[E+(d<<2)>>2],0|i[f>>2]))|0,(0|(d=d+1|0))!=(0|y);)s=m;if(o=(l=(0|m)>(0|A))?g:o,(0|(s=v+1|0))==(0|y))break t;v=s,A=l?m:A,g=0|i[M+(s<<2)>>2]}else o=0}}while(0);if(Jt(M),Jt(E),o){if(s=0|i[(l=o+4|0)>>2])o=s+8|0;else if(0|i[o>>2]){D=70;break}i[o>>2]=P,i[l>>2]=P}else D=73}if(73==(0|D)){if(D=0,0|(r=0|i[P>>2]))do{E=r,r=0|i[r+16>>2],Jt(E)}while(0!=(0|r));Jt(P),r=1}if((0|(N=N+1|0))>=(0|O)){j=r;break e}}50==(0|D)?C(27452,27235,249,27471):52==(0|D)?C(27490,27235,252,27471):70==(0|D)&&C(27310,27235,61,27333)}else j=0}while(0);return Jt(n),Jt(t),0|(D=j)}return 0}function _t(e,t,n){e|=0;var r=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0;if(!(0|Z(t|=0,n|=0)))return 0|(e=0);if(t=0|Y(t),r=+a[n>>3],o=t&(o=+a[n+8>>3])<0?o+6.283185307179586:o,!(e=0|i[e>>2]))return 0|(e=0);if(t){t=0,d=o,n=e;e:for(;;){for(;l=+a[n>>3],o=+a[n+8>>3],h=0|i[(n=n+16|0)>>2],s=+a[(h=0==(0|h)?e:h)>>3],c=+a[h+8>>3],l>s?(u=l,l=c):(u=s,s=l,l=o,o=c),(r=r==s|r==u?r+2220446049250313e-31:r)<s|r>u;)if(!(n=0|i[n>>2])){n=22;break e}if(((u=(c=l<0?l+6.283185307179586:l)+(r-s)/(u-s)*((l=o<0?o+6.283185307179586:o)-c))<0?u+6.283185307179586:u)>(d=c==d|l==d?d+-2220446049250313e-31:d)&&(t^=1),!(n=0|i[n>>2])){n=22;break}}if(22==(0|n))return 0|t}else{t=0,d=o,n=e;e:for(;;){for(;l=+a[n>>3],o=+a[n+8>>3],h=0|i[(n=n+16|0)>>2],s=+a[(h=0==(0|h)?e:h)>>3],c=+a[h+8>>3],l>s?(u=l,l=c):(u=s,s=l,l=o,o=c),(r=r==s|r==u?r+2220446049250313e-31:r)<s|r>u;)if(!(n=0|i[n>>2])){n=22;break e}if(l+(r-s)/(u-s)*(o-l)>(d=l==d|o==d?d+-2220446049250313e-31:d)&&(t^=1),!(n=0|i[n>>2])){n=22;break}}if(22==(0|n))return 0|t}return 0}function wt(e,t,n,a,o){n|=0,a|=0,o|=0;var s,l,c,u,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0;if(u=R,R=R+32|0,b=u+16|0,c=u,d=0|dn(0|(e|=0),0|(t|=0),52),T(),d&=15,v=0|dn(0|n,0|a,52),T(),(0|d)!=(15&v))return R=u,0|(b=12);if(m=0|dn(0|e,0|t,45),T(),m&=127,g=0|dn(0|n,0|a,45),T(),m>>>0>121|(g&=127)>>>0>121)return R=u,0|(b=5);if(v=(0|m)!=(0|g)){if(7==(0|(p=0|K(m,g))))return R=u,0|(b=1);7==(0|(f=0|K(g,m)))?C(27514,27538,161,27548):(A=p,h=f)}else A=0,h=0;s=0|V(m),l=0|V(g),i[b>>2]=0,i[b+4>>2]=0,i[b+8>>2]=0,i[b+12>>2]=0;do{if(A){if(p=(0|(g=0|i[4272+(28*m|0)+(A<<2)>>2]))>0,l)if(p){m=0,f=n,p=a;do{f=0|Ze(f,p),p=0|T(),1==(0|(h=0|_e(h)))&&(h=0|_e(1)),m=m+1|0}while((0|m)!=(0|g));g=h,m=f,f=p}else g=h,m=n,f=a;else if(p){m=0,f=n,p=a;do{f=0|Je(f,p),p=0|T(),h=0|_e(h),m=m+1|0}while((0|m)!=(0|g));g=h,m=f,f=p}else g=h,m=n,f=a;if(nt(m,f,b),v||C(27563,27538,191,27548),(p=0!=(0|s))&(h=0!=(0|l))&&C(27590,27538,192,27548),p){if(7==(0|(h=0|Xe(e,t)))){d=5;break}if(0|r[22e3+(7*h|0)+A|0]){d=1;break}m=f=0|i[21168+(28*h|0)+(A<<2)>>2]}else if(h){if(7==(0|(h=0|Xe(m,f)))){d=5;break}if(0|r[22e3+(7*h|0)+g|0]){d=1;break}m=0,f=0|i[21168+(28*g|0)+(h<<2)>>2]}else m=0,f=0;if((m|f|0)<0)d=5;else{if((0|f)>0){p=b+4|0,h=0;do{be(p),h=h+1|0}while((0|h)!=(0|f))}if(i[c>>2]=0,i[c+4>>2]=0,i[c+8>>2]=0,Ae(c,A),0|d)for(;0|et(d)?ge(c):ve(c),(0|d)>1;)d=d+-1|0;if((0|m)>0){d=0;do{be(c),d=d+1|0}while((0|d)!=(0|m))}le(y=b+4|0,c,y),oe(y),y=51}}else if(nt(n,a,b),0!=(0|s)&0!=(0|l))if((0|g)!=(0|m)&&C(27621,27538,261,27548),7==(0|(h=0|Xe(e,t)))|7==(0|(d=0|Xe(n,a))))d=5;else if(0|r[22e3+(7*h|0)+d|0])d=1;else if((0|(h=0|i[21168+(28*h|0)+(d<<2)>>2]))>0){p=b+4|0,d=0;do{be(p),d=d+1|0}while((0|d)!=(0|h));y=51}else y=51;else y=51}while(0);return 51==(0|y)&&(d=b+4|0,i[o>>2]=i[d>>2],i[o+4>>2]=i[d+4>>2],i[o+8>>2]=i[d+8>>2],d=0),R=u,0|(b=d)}function St(e,t,n,r){n|=0,r|=0;var a,o,s,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0;if(s=R,R=R+48|0,a=s+36|0,u=s+24|0,d=s+12|0,h=s,l=0|dn(0|(e|=0),0|(t|=0),52),T(),l&=15,f=0|dn(0|e,0|t,45),T(),(f&=127)>>>0>121)return R=s,0|(r=5);if(o=0|V(f),hn(0|l,0,52),v=134225919|T(),i[(c=r)>>2]=-1,i[c+4>>2]=v,!l)return 7==(0|(l=0|de(n)))||127==(0|(l=0|$(f,l)))?(R=s,0|(v=1)):(m=0|hn(0|l,0,45),g=0|T(),g=-1040385&i[(f=r)+4>>2]|g,i[(v=r)>>2]=i[f>>2]|m,i[v+4>>2]=g,R=s,0|(v=0));for(i[a>>2]=i[n>>2],i[a+4>>2]=i[n+4>>2],i[a+8>>2]=i[n+8>>2],n=l;;){if(c=n,n=n+-1|0,i[u>>2]=i[a>>2],i[u+4>>2]=i[a+4>>2],i[u+8>>2]=i[a+8>>2],0|et(c)){if(0|(l=0|he(a))){n=13;break}i[d>>2]=i[a>>2],i[d+4>>2]=i[a+4>>2],i[d+8>>2]=i[a+8>>2],ge(d)}else{if(0|(l=0|pe(a))){n=13;break}i[d>>2]=i[a>>2],i[d+4>>2]=i[a+4>>2],i[d+8>>2]=i[a+8>>2],ve(d)}if(ce(u,d,h),oe(h),y=0|i[(l=r)>>2],l=0|i[l+4>>2],A=0|hn(7,0,0|(b=3*(15-c|0)|0)),l&=~T(),b=0|hn(0|de(h),0,0|b),l=0|T()|l,i[(v=r)>>2]=b|y&~A,i[v+4>>2]=l,(0|c)<=1){n=14;break}}e:do{if(13!=(0|n)&&14==(0|n))if((0|i[a>>2])<=1&&(0|i[a+4>>2])<=1&&(0|i[a+8>>2])<=1){h=127==(0|(l=0|$(f,n=0|de(a))))?0:0|V(l);t:do{if(n){if(o){if(7==(0|(l=0|Xe(e,t)))){l=5;break e}if((0|(c=0|i[21376+(28*l|0)+(n<<2)>>2]))>0){l=n,n=0;do{l=0|xe(l),n=n+1|0}while((0|n)!=(0|c))}else l=n;if(1==(0|l)){l=9;break e}127==(0|(n=0|$(f,l)))&&C(27648,27538,411,27678),0|V(n)?C(27693,27538,412,27678):(g=n,m=c,p=l)}else g=l,m=0,p=n;if((0|(d=0|i[4272+(28*f|0)+(p<<2)>>2]))<=-1&&C(27724,27538,419,27678),!h){if((0|m)<0){l=5;break e}if(0|m){l=0,n=0|i[(c=r)>>2],c=0|i[c+4>>2];do{n=0|Qe(n,c),c=0|T(),i[(b=r)>>2]=n,i[b+4>>2]=c,l=l+1|0}while((0|l)<(0|m))}if((0|d)<=0){l=g,n=58;break}for(l=0,n=0|i[(c=r)>>2],c=0|i[c+4>>2];;)if(n=0|Qe(n,c),c=0|T(),i[(b=r)>>2]=n,i[b+4>>2]=c,(0|(l=l+1|0))==(0|d)){l=g,n=58;break t}}if(7==(0|(u=0|K(g,f)))&&C(27514,27538,428,27678),n=0|i[(l=r)>>2],l=0|i[l+4>>2],(0|d)>0){c=0;do{n=0|Qe(n,l),l=0|T(),i[(b=r)>>2]=n,i[b+4>>2]=l,c=c+1|0}while((0|c)!=(0|d))}if(7==(0|(l=0|Xe(n,l)))&&C(27795,27538,440,27678),n=0|G(g),(0|(n=0|i[(n?21792:21584)+(28*u|0)+(l<<2)>>2]))<0&&C(27795,27538,454,27678),n){l=0,c=0|i[(u=r)>>2],u=0|i[u+4>>2];do{c=0|Ye(c,u),u=0|T(),i[(b=r)>>2]=c,i[b+4>>2]=u,l=l+1|0}while((0|l)<(0|n));l=g,n=58}else l=g,n=58}else if(0!=(0|o)&0!=(0|h)){if(7==(0|(n=0|Xe(e,t)))|7==(0|(c=0|Xe(0|i[(c=r)>>2],0|i[c+4>>2])))){l=5;break e}if((0|(c=0|i[21376+(28*n|0)+(c<<2)>>2]))<0){l=5;break e}if(c){n=0,u=0|i[(d=r)>>2],d=0|i[d+4>>2];do{u=0|Qe(u,d),d=0|T(),i[(b=r)>>2]=u,i[b+4>>2]=d,n=n+1|0}while((0|n)<(0|c));n=58}else n=59}else n=58}while(0);if(58==(0|n)&&h&&(n=59),59==(0|n)&&1==(0|Xe(0|i[(b=r)>>2],0|i[b+4>>2]))){l=9;break}A=0|i[(b=r)>>2],b=-1040385&i[b+4>>2],y=0|hn(0|l,0,45),b=0|b|T(),i[(l=r)>>2]=A|y,i[l+4>>2]=b,l=0}else l=1}while(0);return R=s,0|(b=l)}function Tt(e,t,n,r){e|=0,t|=0;var i=0,a=0,o=0;if(0==(0|(n|=0))&0==(0|(r|=0)))return a=1,S(0|(i=0)),0|a;a=e,i=t,e=1,t=0;do{e=0|sn(0|((o=0==(1&n)&!0)?1:a),0|(o?0:i),0|e,0|t),t=0|T(),n=0|un(0|n,0|r,1),r=0|T(),a=0|sn(0|a,0|i,0|a,0|i),i=0|T()}while(!(0==(0|n)&0==(0|r)));return S(0|t),0|e}function Ct(e,t,n,r){n|=0,r|=0;var o,s=0,l=0,c=0,u=0,d=0,p=0;o=R,R=R+16|0,l=o,c=0|dn(0|(e|=0),0|(t|=0),52),T(),c&=15;do{if(c){if(!(s=0|it(e,t,l))){d=+a[l>>3],u=1/+h(+d),p=+a[25968+(c<<3)>>3],a[n>>3]=d+p,a[n+8>>3]=d-p,d=+a[l+8>>3],u*=p,a[n+16>>3]=u+d,a[n+24>>3]=d-u;break}return R=o,0|(c=s)}if(s=0|dn(0|e,0|t,45),T(),(s&=127)>>>0>121)return R=o,0|(c=5);l=22064+(s<<5)|0,i[n>>2]=i[l>>2],i[n+4>>2]=i[l+4>>2],i[n+8>>2]=i[l+8>>2],i[n+12>>2]=i[l+12>>2],i[n+16>>2]=i[l+16>>2],i[n+20>>2]=i[l+20>>2],i[n+24>>2]=i[l+24>>2],i[n+28>>2]=i[l+28>>2];break}while(0);return function(e,t){t=+t;var n,r,i,o,s,l,c,u=0,d=0;u=(o=+a[(i=16+(e|=0)|0)>>3])-(r=+a[(n=e+24|0)>>3]),u=o<r?u+6.283185307179586:u,d=+a[e>>3],u=.5*(u*t-u),d+=t=.5*((c=d-(l=+a[(s=e+8|0)>>3]))*t-c),a[e>>3]=d>1.5707963267948966?1.5707963267948966:d,t=l-t,a[s>>3]=t<-1.5707963267948966?-1.5707963267948966:t,t=(t=o+u)>3.141592653589793?t+-6.283185307179586:t,a[i>>3]=t<-3.141592653589793?t+6.283185307179586:t,t=(t=r-u)>3.141592653589793?t+-6.283185307179586:t,a[n>>3]=t<-3.141592653589793?t+6.283185307179586:t}(n,r?1.4:1.1),(0|i[(r=26096+(c<<3)|0)>>2])==(0|e)&&(0|i[r+4>>2])==(0|t)&&(a[n>>3]=1.5707963267948966),(0|i[(c=26224+(c<<3)|0)>>2])==(0|e)&&(0|i[c+4>>2])==(0|t)&&(a[n+8>>3]=-1.5707963267948966),1.5707963267948966!=+a[n>>3]&&-1.5707963267948966!=+a[n+8>>3]?(R=o,0|(c=0)):(a[n+16>>3]=3.141592653589793,a[n+24>>3]=-3.141592653589793,R=o,0|(c=0))}function Mt(e,t,n,a){e|=0,t|=0,n|=0,a|=0;var o,s,l,c=0,u=0,d=0,h=0;l=R,R=R+48|0,o=l+40|0,s=l,Ge(u=l+32|0,0,0,0),d=0|i[u>>2],u=0|i[u+4>>2];do{if(n>>>0<=15){if(0|(c=0|Rt(a))){i[(a=s)>>2]=0,i[a+4>>2]=0,i[s+8>>2]=c,i[s+12>>2]=-1,d=s+29|0,i[(a=s+16|0)>>2]=0,i[a+4>>2]=0,i[a+8>>2]=0,r[a+12|0]=0,r[d|0]=0|r[o|0],r[d+1|0]=0|r[o+1|0],r[d+2|0]=0|r[o+2|0];break}if(c=0|en(1+(0|i[t+8>>2])|0,32)){Lt(t,c),i[(h=s)>>2]=d,i[h+4>>2]=u,i[s+8>>2]=0,i[s+12>>2]=n,i[s+16>>2]=a,i[s+20>>2]=t,i[s+24>>2]=c,r[s+28|0]=0,r[(d=s+29|0)|0]=0|r[o|0],r[d+1|0]=0|r[o+1|0],r[d+2|0]=0|r[o+2|0];break}i[(a=s)>>2]=0,i[a+4>>2]=0,i[s+8>>2]=13,i[s+12>>2]=-1,d=s+29|0,i[(a=s+16|0)>>2]=0,i[a+4>>2]=0,i[a+8>>2]=0,r[a+12|0]=0,r[d|0]=0|r[o|0],r[d+1|0]=0|r[o+1|0],r[d+2|0]=0|r[o+2|0];break}i[(d=s)>>2]=0,i[d+4>>2]=0,i[s+8>>2]=4,i[s+12>>2]=-1,h=s+29|0,i[(d=s+16|0)>>2]=0,i[d+4>>2]=0,i[d+8>>2]=0,r[d+12|0]=0,r[h|0]=0|r[o|0],r[h+1|0]=0|r[o+1|0],r[h+2|0]=0|r[o+2|0]}while(0);Et(s),i[e>>2]=i[s>>2],i[e+4>>2]=i[s+4>>2],i[e+8>>2]=i[s+8>>2],i[e+12>>2]=i[s+12>>2],i[e+16>>2]=i[s+16>>2],i[e+20>>2]=i[s+20>>2],i[e+24>>2]=i[s+24>>2],i[e+28>>2]=i[s+28>>2],R=l}function Et(e){var t,n,a,o,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0;if(o=R,R=R+336|0,t=o+168|0,n=o,0==(0|(l=0|i[(c=e|=0)>>2]))&0==(0|(c=0|i[c+4>>2])))R=o;else{if(0|r[(s=e+28|0)|0]?(l=0|Pt(l,c),c=0|T()):r[s|0]=1,!(0|i[i[(a=e+20|0)>>2]>>2]))return 0|(l=0|i[(s=e+24|0)>>2])&&Jt(l),i[(_=e)>>2]=0,i[_+4>>2]=0,i[e+8>>2]=0,i[a>>2]=0,i[e+12>>2]=-1,i[e+16>>2]=0,i[s>>2]=0,void(R=o);u=15&(s=0|i[(_=e+16|0)>>2]);e:do{if(0==(0|l)&0==(0|c))x=e+24|0;else{y=e+12|0,v=3==(0|u),g=255&s,f=3==(1|u),A=e+24|0,m=(u+-1|0)>>>0<3,h=3==(2|u),p=n+8|0;t:for(;;){if(d=0|dn(0|l,0|c,52),T(),(0|(d&=15))==(0|i[y>>2])){switch(15&g){case 0:case 2:case 3:if(0|(u=0|it(l,c,t))){b=15;break t}if(0|Ot(0|i[a>>2],0|i[A>>2],t)){b=19;break t}}if(f&&(u=0|i[4+(0|i[a>>2])>>2],i[t>>2]=i[u>>2],i[t+4>>2]=i[u+4>>2],i[t+8>>2]=i[u+8>>2],i[t+12>>2]=i[u+12>>2],0|Z(26832,t))){if(0|tt(0|i[4+(0|i[a>>2])>>2],d,n)){b=25;break}if((0|i[(u=n)>>2])==(0|l)&&(0|i[u+4>>2])==(0|c)){b=29;break}}if(m){if(0|(u=0|at(l,c,t))){b=32;break}if(0|Ct(l,c,n,0)){b=36;break}if(h&&0|jt(0|i[a>>2],0|i[A>>2],t,n)){b=42;break}if(f&&0|It(0|i[a>>2],0|i[A>>2],t,n)){b=42;break}}if(v){if(s=0|Ct(l,c,t,1),u=0|i[A>>2],0|s){b=45;break}if(0|J(u,t)){if(te(n,t),0|ee(t,0|i[A>>2])){b=53;break}if(0|Ot(0|i[a>>2],0|i[A>>2],p)){b=53;break}if(0|It(0|i[a>>2],0|i[A>>2],n,t)){b=53;break}}}}do{if((0|d)<(0|i[y>>2])){if(s=0|Ct(l,c,t,1),u=0|i[A>>2],0|s){b=58;break t}if(!(0|J(u,t))){b=73;break}if(0|ee(0|i[A>>2],t)&&(te(n,t),0|jt(0|i[a>>2],0|i[A>>2],n,t))){b=65;break t}if(0|(l=0|Ke(l,c,d+1|0,n))){b=67;break t}l=0|i[(c=n)>>2],c=0|i[c+4>>2]}else b=73}while(0);if(73==(0|b)&&(b=0,l=0|Pt(l,c),c=0|T()),0==(0|l)&0==(0|c)){x=A;break e}}switch(0|b){case 15:0|(s=0|i[A>>2])&&Jt(s),i[(b=e)>>2]=0,i[b+4>>2]=0,i[a>>2]=0,i[y>>2]=-1,i[_>>2]=0,i[A>>2]=0,i[e+8>>2]=u,b=20;break;case 19:i[e>>2]=l,i[e+4>>2]=c,b=20;break;case 25:C(27795,27761,470,27772);break;case 29:case 42:return i[e>>2]=l,i[e+4>>2]=c,void(R=o);case 32:return 0|(s=0|i[A>>2])&&Jt(s),i[(x=e)>>2]=0,i[x+4>>2]=0,i[a>>2]=0,i[y>>2]=-1,i[_>>2]=0,i[A>>2]=0,i[e+8>>2]=u,void(R=o);case 36:C(27795,27761,493,27772);break;case 45:0|u&&Jt(u),i[(b=e)>>2]=0,i[b+4>>2]=0,i[a>>2]=0,i[y>>2]=-1,i[_>>2]=0,i[A>>2]=0,i[e+8>>2]=s,b=55;break;case 53:i[e>>2]=l,i[e+4>>2]=c,b=55;break;case 58:0|u&&Jt(u),i[(b=e)>>2]=0,i[b+4>>2]=0,i[a>>2]=0,i[y>>2]=-1,i[_>>2]=0,i[A>>2]=0,i[e+8>>2]=s,b=71;break;case 65:i[e>>2]=l,i[e+4>>2]=c,b=71;break;case 67:return 0|(s=0|i[A>>2])&&Jt(s),i[(x=e)>>2]=0,i[x+4>>2]=0,i[a>>2]=0,i[y>>2]=-1,i[_>>2]=0,i[A>>2]=0,i[e+8>>2]=l,void(R=o)}if(20==(0|b))return void(R=o);if(55==(0|b))return void(R=o);if(71==(0|b))return void(R=o)}}while(0);0|(s=0|i[x>>2])&&Jt(s),i[(b=e)>>2]=0,i[b+4>>2]=0,i[e+8>>2]=0,i[a>>2]=0,i[e+12>>2]=-1,i[_>>2]=0,i[x>>2]=0,R=o}}function Pt(e,t){var n,r=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0;n=R,R=R+16|0,h=n,a=0|dn(0|(e|=0),0|(t|=0),52),T(),a&=15,r=0|dn(0|e,0|t,45),T();do{if(a){for(;r=0|hn(a+4095|0,0,52),o=T()|-15728641&t,r=r|e|(l=0|hn(7,0,0|(s=3*(15-a|0)|0))),o|=c=0|T(),u=0|dn(0|e,0|t,0|s),T(),a=a+-1|0,!((u&=7)>>>0<6);){if(!a){d=4;break}t=o,e=r}if(4==(0|d)){r=0|dn(0|r,0|o,45),T();break}return h=0|hn(((h=0==(0|u)&0!=(0|He(r,o)))?2:1)+u|0,0,0|s),d=0|T()|t&~c,h|=e&~l,S(0|d),R=n,0|h}}while(0);return(r&=127)>>>0>120?(h=0,S(0|(d=0)),R=n,0|h):(Ge(h,0,r+1|0,0),d=0|i[h+4>>2],h=0|i[h>>2],S(0|d),R=n,0|h)}function Nt(e,t,n){e|=0;var r,o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0;if(!(0|Z(t|=0,n|=0)))return 0|(f=0);if(t=0|Y(t),o=+a[n>>3],s=t&(s=+a[n+8>>3])<0?s+6.283185307179586:s,(0|(f=0|i[e>>2]))<=0)return 0|(f=0);if(r=0|i[e+4>>2],t){t=0,p=s,n=-1,e=0;e:for(;;){for(h=e;c=+a[r+(h<<4)>>3],s=+a[r+(h<<4)+8>>3],l=+a[r+((e=(n+2|0)%(0|f)|0)<<4)>>3],u=+a[r+(e<<4)+8>>3],c>l?(d=c,c=u):(d=l,l=c,c=s,s=u),(o=o==l|o==d?o+2220446049250313e-31:o)<l|o>d;){if((0|(n=h+1|0))>=(0|f)){n=22;break e}e=h,h=n,n=e}if(((d=(u=c<0?c+6.283185307179586:c)+(o-l)/(d-l)*((c=s<0?s+6.283185307179586:s)-u))<0?d+6.283185307179586:d)>(p=u==p|c==p?p+-2220446049250313e-31:p)&&(t^=1),(0|(e=h+1|0))>=(0|f)){n=22;break}n=h}if(22==(0|n))return 0|t}else{t=0,p=s,n=-1,e=0;e:for(;;){for(h=e;c=+a[r+(h<<4)>>3],s=+a[r+(h<<4)+8>>3],l=+a[r+((e=(n+2|0)%(0|f)|0)<<4)>>3],u=+a[r+(e<<4)+8>>3],c>l?(d=c,c=u):(d=l,l=c,c=s,s=u),(o=o==l|o==d?o+2220446049250313e-31:o)<l|o>d;){if((0|(n=h+1|0))>=(0|f)){n=22;break e}e=h,h=n,n=e}if(c+(o-l)/(d-l)*(s-c)>(p=c==p|s==p?p+-2220446049250313e-31:p)&&(t^=1),(0|(e=h+1|0))>=(0|f)){n=22;break}n=h}if(22==(0|n))return 0|t}return 0}function kt(e,t){t|=0;var n,r,o,s,l,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0;if(!(r=0|i[(e|=0)>>2]))return i[t>>2]=0,i[t+4>>2]=0,i[t+8>>2]=0,i[t+12>>2]=0,i[t+16>>2]=0,i[t+20>>2]=0,i[t+24>>2]=0,void(i[t+28>>2]=0);if(a[(o=t+8|0)>>3]=17976931348623157e292,a[(s=t+24|0)>>3]=17976931348623157e292,a[t>>3]=-17976931348623157e292,a[(l=t+16|0)>>3]=-17976931348623157e292,!((0|r)<=0)){for(n=0|i[e+4>>2],v=17976931348623157e292,A=-17976931348623157e292,y=0,e=-1,p=17976931348623157e292,f=17976931348623157e292,g=-17976931348623157e292,d=-17976931348623157e292,b=0;u=+a[n+(b<<4)>>3],m=+a[n+(b<<4)+8>>3],h=+a[n+(((0|(e=e+2|0))==(0|r)?0:e)<<4)+8>>3],u<p&&(a[o>>3]=u,p=u),m<f&&(a[s>>3]=m,f=m),u>g?a[t>>3]=u:u=g,m>d&&(a[l>>3]=m,d=m),v=m>0&m<v?m:v,A=m<0&m>A?m:A,y|=+c(+(m-h))>3.141592653589793,(0|(e=b+1|0))!=(0|r);)x=b,g=u,b=e,e=x;y&&(a[l>>3]=A,a[s>>3]=v)}}function Rt(e){return 0|((e|=0)>>>0<4?0:15)}function Lt(e,t){t|=0;var n,r=0,o=0,s=0,l=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0,w=0,S=0,T=0,C=0;if(A=0|i[(e|=0)>>2]){if(a[(y=t+8|0)>>3]=17976931348623157e292,a[(b=t+24|0)>>3]=17976931348623157e292,a[t>>3]=-17976931348623157e292,a[(x=t+16|0)>>3]=-17976931348623157e292,(0|A)>0){for(s=0|i[e+4>>2],g=17976931348623157e292,v=-17976931348623157e292,o=0,r=-1,h=17976931348623157e292,p=17976931348623157e292,m=-17976931348623157e292,u=-17976931348623157e292,_=0;l=+a[s+(_<<4)>>3],f=+a[s+(_<<4)+8>>3],d=+a[s+(((0|(T=r+2|0))==(0|A)?0:T)<<4)+8>>3],l<h&&(a[y>>3]=l,h=l),f<p&&(a[b>>3]=f,p=f),l>m?a[t>>3]=l:l=m,f>u&&(a[x>>3]=f,u=f),g=f>0&f<g?f:g,v=f<0&f>v?f:v,o|=+c(+(f-d))>3.141592653589793,(0|(r=_+1|0))!=(0|A);)T=_,m=l,_=r,r=T;o&&(a[x>>3]=v,a[b>>3]=g)}}else i[t>>2]=0,i[t+4>>2]=0,i[t+8>>2]=0,i[t+12>>2]=0,i[t+16>>2]=0,i[t+20>>2]=0,i[t+24>>2]=0,i[t+28>>2]=0;if(!((0|(r=0|i[(T=e+8|0)>>2]))<=0)){n=e+12|0,S=0;do{if(s=0|i[n>>2],o=S,b=t+((S=S+1|0)<<5)|0,x=0|i[s+(o<<3)>>2]){if(a[(_=t+(S<<5)+8|0)>>3]=17976931348623157e292,a[(e=t+(S<<5)+24|0)>>3]=17976931348623157e292,a[b>>3]=-17976931348623157e292,a[(w=t+(S<<5)+16|0)>>3]=-17976931348623157e292,(0|x)>0){for(A=0|i[s+(o<<3)+4>>2],g=17976931348623157e292,v=-17976931348623157e292,s=0,o=-1,y=0,h=17976931348623157e292,p=17976931348623157e292,f=-17976931348623157e292,u=-17976931348623157e292;l=+a[A+(y<<4)>>3],m=+a[A+(y<<4)+8>>3],d=+a[A+(((0|(o=o+2|0))==(0|x)?0:o)<<4)+8>>3],l<h&&(a[_>>3]=l,h=l),m<p&&(a[e>>3]=m,p=m),l>f?a[b>>3]=l:l=f,m>u&&(a[w>>3]=m,u=m),g=m>0&m<g?m:g,v=m<0&m>v?m:v,s|=+c(+(m-d))>3.141592653589793,(0|(o=y+1|0))!=(0|x);)C=y,y=o,f=l,o=C;s&&(a[w>>3]=v,a[e>>3]=g)}}else i[b>>2]=0,i[b+4>>2]=0,i[b+8>>2]=0,i[b+12>>2]=0,i[b+16>>2]=0,i[b+20>>2]=0,i[b+24>>2]=0,i[b+28>>2]=0,r=0|i[T>>2]}while((0|S)<(0|r))}}function Ot(e,t,n){var r=0,a=0,o=0;if(!(0|Nt(e|=0,t|=0,n|=0)))return 0|(a=0);if((0|i[(a=e+8|0)>>2])<=0)return 0|(a=1);for(r=e+12|0,e=0;;){if(o=e,e=e+1|0,0|Nt((0|i[r>>2])+(o<<3)|0,t+(e<<5)|0,n)){e=0,r=6;break}if((0|e)>=(0|i[a>>2])){e=1,r=6;break}}return 6==(0|r)?0|e:0}function jt(e,t,n,r){r|=0;var a,o,s=0,l=0,c=0,u=0,d=0;if(o=R,R=R+16|0,a=o,!(0|Nt(e|=0,t|=0,c=(n|=0)+8|0)))return R=o,0|(u=0);u=e+8|0;e:do{if((0|i[u>>2])>0){for(l=e+12|0,s=0;;){if(d=s,s=s+1|0,0|Nt((0|i[l>>2])+(d<<3)|0,t+(s<<5)|0,c)){s=0;break}if((0|s)>=(0|i[u>>2]))break e}return R=o,0|s}}while(0);if(0|Dt(e,t,n,r))return R=o,0|(d=0);i[a>>2]=i[n>>2],i[a+4>>2]=c,s=0|i[u>>2];e:do{if((0|s)>0)for(e=e+12|0,c=0,l=s;;){if(s=0|i[e>>2],(0|i[s+(c<<3)>>2])>0){if(0|Nt(a,r,0|i[s+(c<<3)+4>>2])){s=0;break e}if(s=c+1|0,0|Dt((0|i[e>>2])+(c<<3)|0,t+(s<<5)|0,n,r)){s=0;break e}l=0|i[u>>2]}else s=c+1|0;if(!((0|s)<(0|l))){s=1;break}c=s}else s=1}while(0);return R=o,0|(d=s)}function Dt(e,t,n,r){e|=0,n|=0;var o,s,l,c,u,d,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0,w=0,S=0,T=0,C=0;if(d=R,R=R+176|0,c=d+172|0,h=d+168|0,u=d,!(0|J(t|=0,r|=0)))return R=d,0|(e=0);if(function(e,t,n,r){var o,s,l,c,u;t|=0,n|=0,r|=0,e=(s=+a[16+(e|=0)>>3])<(u=+a[e+24>>3]),o=(c=+a[t+16>>3])<(l=+a[t+24>>3]),t=u-c<l-s,i[n>>2]=e?o|t?1:2:0,i[r>>2]=o?e?1:t?2:1:0}(t,r,c,h),vn(0|u,0|n,168),(0|i[n>>2])>0){t=0;do{_=+ht(+a[(T=u+8+(t<<4)+8|0)>>3],0|i[h>>2]),a[T>>3]=_,t=t+1|0}while((0|t)<(0|i[n>>2]))}s=+a[r>>3],l=+a[r+8>>3],_=+ht(+a[r+16>>3],0|i[h>>2]),o=+ht(+a[r+24>>3],0|i[h>>2]);e:do{if((0|i[e>>2])>0){if(r=e+4|0,(0|(h=0|i[u>>2]))<=0)for(t=0;;)if((0|(t=t+1|0))>=(0|i[e>>2])){t=0;break e}for(n=0;;){if(t=0|i[r>>2],b=+a[t+(n<<4)>>3],x=+ht(+a[t+(n<<4)+8>>3],0|i[c>>2]),t=0|i[r>>2],T=(0|(n=n+1|0))%(0|i[e>>2])|0,p=+a[t+(T<<4)>>3],f=+ht(+a[t+(T<<4)+8>>3],0|i[c>>2]),!(b>=s)|!(p>=s)&&!(b<=l)|!(p<=l)&&!(x<=o)|!(f<=o)&&!(x>=_)|!(f>=_)){y=p-b,v=f-x,t=0;do{if(C=t,T=(0|(t=t+1|0))==(0|h)?0:t,p=+a[u+8+(C<<4)+8>>3],f=+a[u+8+(T<<4)+8>>3]-p,m=+a[u+8+(C<<4)>>3],!(0==(A=y*f-v*(g=+a[u+8+(T<<4)>>3]-m))||(w=x-p,S=b-m,g=(w*g-f*S)/A,g<0|g>1))&&(A=(y*w-v*S)/A)>=0&A<=1){t=1;break e}}while((0|t)<(0|h))}if((0|n)>=(0|i[e>>2])){t=0;break}}}else t=0}while(0);return R=d,0|(C=t)}function It(e,t,n,r){var a=0,o=0,s=0;if(0|Dt(e|=0,t|=0,n|=0,r|=0))return 0|(o=1);if((0|i[(o=e+8|0)>>2])<=0)return 0|(o=0);for(a=e+12|0,e=0;;){if(s=e,e=e+1|0,0|Dt((0|i[a>>2])+(s<<3)|0,t+(e<<5)|0,n,r)){e=1,a=6;break}if((0|e)>=(0|i[o>>2])){e=0,a=6;break}}return 6==(0|a)?0|e:0}function Bt(e,t,n,r,i){t|=0,n|=0,r|=0,i|=0;var o,s,l,c,u,d,h,p=0;c=+a[(e|=0)>>3],l=+a[t>>3]-c,s=+a[e+8>>3],o=+a[t+8>>3]-s,d=+a[n>>3],p=((p=+a[r>>3]-d)*(s-(h=+a[n+8>>3]))-(c-d)*(u=+a[r+8>>3]-h))/(l*u-o*p),a[i>>3]=c+l*p,a[i+8>>3]=s+o*p}function Ft(e,t){return t|=0,+c(+(+a[(e|=0)>>3]-+a[t>>3]))<1.1920928955078125e-7?0|(t=+c(+(+a[e+8>>3]-+a[t+8>>3]))<1.1920928955078125e-7):0|(t=0)}function zt(e,t){t|=0;var n,r,i;return+((i=+a[(e|=0)>>3]-+a[t>>3])*i+(r=+a[e+8>>3]-+a[t+8>>3])*r+(n=+a[e+16>>3]-+a[t+16>>3])*n)}function Ut(e,t,n){n|=0;var r,a,o,s,l=0,c=0,u=0,d=0;if(s=R,R=R+32|0,d=s,0|(l=0|rt(e|=0,t|=0,a=s+16|0)))return R=s,0|(n=l);r=0|Ue(e,t),o=0|Xe(e,t),function(e,t){e=7696+(28*(e|=0)|0)|0,i[(t|=0)>>2]=i[e>>2],i[t+4>>2]=i[e+4>>2],i[t+8>>2]=i[e+8>>2],i[t+12>>2]=i[e+12>>2]}(r,d),l=0|function(e,t){e|=0;var n=0,r=0;if((t|=0)>>>0>20)return-1;do{if((0|i[11120+(216*t|0)>>2])!=(0|e))if((0|i[11120+(216*t|0)+8>>2])!=(0|e))if((0|i[11120+(216*t|0)+16>>2])!=(0|e))if((0|i[11120+(216*t|0)+24>>2])!=(0|e))if((0|i[11120+(216*t|0)+32>>2])!=(0|e))if((0|i[11120+(216*t|0)+40>>2])!=(0|e))if((0|i[11120+(216*t|0)+48>>2])!=(0|e))if((0|i[11120+(216*t|0)+56>>2])!=(0|e))if((0|i[11120+(216*t|0)+64>>2])!=(0|e))if((0|i[11120+(216*t|0)+72>>2])!=(0|e))if((0|i[11120+(216*t|0)+80>>2])!=(0|e))if((0|i[11120+(216*t|0)+88>>2])!=(0|e))if((0|i[11120+(216*t|0)+96>>2])!=(0|e))if((0|i[11120+(216*t|0)+104>>2])!=(0|e))if((0|i[11120+(216*t|0)+112>>2])!=(0|e))if((0|i[11120+(216*t|0)+120>>2])!=(0|e))if((0|i[11120+(216*t|0)+128>>2])!=(0|e)){if((0|i[11120+(216*t|0)+136>>2])!=(0|e)){if((0|i[11120+(216*t|0)+144>>2])==(0|e)){e=0,n=2,r=0;break}if((0|i[11120+(216*t|0)+152>>2])==(0|e)){e=0,n=2,r=1;break}if((0|i[11120+(216*t|0)+160>>2])==(0|e)){e=0,n=2,r=2;break}if((0|i[11120+(216*t|0)+168>>2])==(0|e)){e=1,n=2,r=0;break}if((0|i[11120+(216*t|0)+176>>2])==(0|e)){e=1,n=2,r=1;break}if((0|i[11120+(216*t|0)+184>>2])==(0|e)){e=1,n=2,r=2;break}if((0|i[11120+(216*t|0)+192>>2])==(0|e)){e=2,n=2,r=0;break}if((0|i[11120+(216*t|0)+200>>2])==(0|e)){e=2,n=2,r=1;break}if((0|i[11120+(216*t|0)+208>>2])==(0|e)){e=2,n=2,r=2;break}return-1}e=2,n=1,r=2}else e=2,n=1,r=1;else e=2,n=1,r=0;else e=1,n=1,r=2;else e=1,n=1,r=1;else e=1,n=1,r=0;else e=0,n=1,r=2;else e=0,n=1,r=1;else e=0,n=1,r=0;else e=2,n=0,r=2;else e=2,n=0,r=1;else e=2,n=0,r=0;else e=1,n=0,r=2;else e=1,n=0,r=1;else e=1,n=0,r=0;else e=0,n=0,r=2;else e=0,n=0,r=1;else e=0,n=0,r=0}while(0);return 0|i[11120+(216*t|0)+(72*n|0)+(24*e|0)+(r<<3)+4>>2]}(r,0|i[a>>2]);do{if(0|V(r)){switch(0|r){case 4:c=0;break;case 14:c=1;break;case 24:c=2;break;case 38:c=3;break;case 49:c=4;break;case 58:c=5;break;case 63:c=6;break;case 72:c=7;break;case 83:c=8;break;case 97:c=9;break;case 107:c=10;break;case 117:c=11;break;default:C(27795,27797,75,27806)}if(u=0|i[26416+(24*c|0)+8>>2],t=0|i[26416+(24*c|0)+16>>2],(0|(e=0|i[a>>2]))!=(0|i[d>>2])&&(d=0|G(r))|(0|(e=0|i[a>>2]))==(0|t)&&(l=(l+1|0)%6|0),3==(0|o)&(0|e)==(0|t)){l=(l+5|0)%6|0;break}5==(0|o)&(0|e)==(0|u)&&(l=(l+1|0)%6|0)}}while(0);return i[n>>2]=l,R=s,0|(n=0)}function Vt(e,t,n,r){n|=0,r|=0;var a,o,s,l,c,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0;if(c=R,R=R+32|0,b=c+24|0,l=c+20|0,s=c+8|0,o=c+16|0,a=c,f=(f=0==(0|He(e|=0,t|=0)))?6:5,g=0|dn(0|e,0|t,52),T(),f>>>0<=n>>>0)return R=c,0|(r=2);!(v=0==(0|(g&=15)))&&0==((A=0|hn(7,0,3*(15^g)|0))&e|0)&0==((0|T())&t)?u=n:d=4;e:do{if(4==(0|d)){if((0|((u=0!=(0|He(e,t)))?4:5))<(0|n))return R=c,0|(r=1);if(0|Ut(e,t,b))return R=c,0|(r=1);if(d=(0|i[b>>2])+n|0,7==(0|(A=0|i[(u=u?26704+((0|d)%5<<2)|0:26736+((0|d)%6<<2)|0)>>2])))return R=c,0|(r=1);i[l>>2]=0,u=0|I(e,t,A,l,s);do{if(!u){if(m=0|i[(p=s)>>2],d=(h=(p=0|i[p+4>>2])>>>0<t>>>0|(0|p)==(0|t)&m>>>0<e>>>0)?m:e,h=h?p:t,!v&&0==(m&(v=0|hn(7,0,3*(15^g)|0))|0)&0==(p&(0|T())))u=n;else{if(p=(n+-1+f|0)%(0|f)|0,u=0|He(e,t),(0|p)<0&&C(27795,27797,248,27822),(0|((f=0!=(0|u))?4:5))<(0|p)&&C(27795,27797,248,27822),0|Ut(e,t,b)&&C(27795,27797,248,27822),u=(0|i[b>>2])+p|0,7==(0|(p=0|i[(u=f?26704+((0|u)%5<<2)|0:26736+((0|u)%6<<2)|0)>>2]))&&C(27795,27797,248,27822),i[o>>2]=0,0|(u=0|I(e,t,p,o,a)))break;f=0|i[(m=a)>>2],m=0|i[m+4>>2];do{if(m>>>0<h>>>0|(0|m)==(0|h)&f>>>0<d>>>0){if(d=0|He(f,m)?0|z(f,m,e,t):0|i[26800+(((0|i[o>>2])+(0|i[26768+(p<<2)>>2])|0)%6<<2)>>2],u=0|He(f,m),(d+-1|0)>>>0>5){u=-1,d=f,h=m;break}if(1==(0|d)&(u=0!=(0|u))){u=-1,d=f,h=m;break}do{if(!(0|Ut(f,m,b))){if(u){u=(5+(0|i[26352+(d<<2)>>2])-(0|i[b>>2])|0)%5|0;break}u=(6+(0|i[26384+(d<<2)>>2])-(0|i[b>>2])|0)%6|0;break}u=-1}while(0);d=f,h=m}else u=n}while(0);m=0|i[(p=s)>>2],p=0|i[p+4>>2]}if((0|d)==(0|m)&(0|h)==(0|p)){if(e=(f=0!=(0|He(m,p)))?0|z(m,p,e,t):0|i[26800+(((0|i[l>>2])+(0|i[26768+(A<<2)>>2])|0)%6<<2)>>2],u=0|He(m,p),(e+-1|0)>>>0<=5&&!(1==(0|e)&(y=0!=(0|u))))do{if(!(0|Ut(m,p,b))){if(y){u=(5+(0|i[26352+(e<<2)>>2])-(0|i[b>>2])|0)%5|0;break}u=(6+(0|i[26384+(e<<2)>>2])-(0|i[b>>2])|0)%6|0;break}u=-1}while(0);else u=-1;u=6==(0|(u=u+1|0))|f&5==(0|u)?0:u}t=h,e=d;break e}}while(0);return R=c,0|(r=u)}}while(0);return y=0|hn(0|u,0,56),b=T()|-2130706433&t|536870912,i[r>>2]=y|e,i[r+4>>2]=b,R=c,0|(r=0)}function Gt(e,t){e|=0;var n,r,a=0,o=0;return r=R,R=R+16|0,n=r,!0&536870912==(2013265920&(t|=0))&&0|Ve(e,a=-2130706433&t|134217728)?(o=0|dn(0|e,0|t,56),T(),a=(o=0==(0|Vt(e,a,7&o,n)))&((0|i[(a=n)>>2])==(0|e)?(0|i[a+4>>2])==(0|t):0)&1,R=r,0|a):(R=r,0|(a=0))}function qt(e,t,n){e|=0,n|=0;var r=0;(0|(t|=0))>0?(r=0|en(t,4),i[e>>2]=r,r||C(27835,27858,40,27872)):i[e>>2]=0,i[e+4>>2]=t,i[e+8>>2]=0,i[e+12>>2]=n}function Wt(e){var t,n,r,o=0,s=0,l=0,u=0;t=(e|=0)+4|0,n=e+12|0,r=e+8|0;e:for(;;){for(s=0|i[t>>2],o=0;;){if((0|o)>=(0|s))break e;if(l=0|i[e>>2],u=0|i[l+(o<<2)>>2])break;o=o+1|0}o=l+(~~(+c(+ +d(10,+ +(15-(0|i[n>>2])|0))*(+a[u>>3]+ +a[u+8>>3]))%+(0|s))>>>0<<2)|0,s=0|i[o>>2];t:do{if(0|s){if(l=u+32|0,(0|s)==(0|u))i[o>>2]=i[l>>2];else{if(!(o=0|i[(s=s+32|0)>>2]))break;for(;(0|o)!=(0|u);)if(!(o=0|i[(s=o+32|0)>>2]))break t;i[s>>2]=i[l>>2]}Jt(u),i[r>>2]=(0|i[r>>2])-1}}while(0)}Jt(0|i[e>>2])}function Ht(e){var t,n=0,r=0;for(t=0|i[(e|=0)+4>>2],r=0;;){if((0|r)>=(0|t)){n=0,r=4;break}if(n=0|i[(0|i[e>>2])+(r<<2)>>2]){r=4;break}r=r+1|0}return 4==(0|r)?0|n:0}function $t(e,t){t|=0;var n=0,r=0,o=0,s=0;if(n=~~(+c(+ +d(10,+ +(15-(0|i[(e|=0)+12>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|i[e+4>>2]))>>>0,n=(0|i[e>>2])+(n<<2)|0,!(r=0|i[n>>2]))return 0|(s=1);s=t+32|0;do{if((0|r)!=(0|t)){if(!(n=0|i[r+32>>2]))return 0|(s=1);for(o=n;;){if((0|o)==(0|t)){o=8;break}if(!(n=0|i[o+32>>2])){n=1,o=10;break}r=o,o=n}if(8==(0|o)){i[r+32>>2]=i[s>>2];break}if(10==(0|o))return 0|n}else i[n>>2]=i[s>>2]}while(0);return Jt(t),i[(s=e+8|0)>>2]=(0|i[s>>2])-1,0|(s=0)}function Kt(e,t,n){e|=0,t|=0,n|=0;var r,o=0,s=0,l=0;(r=0|Zt(40))||C(27888,27858,98,27901),i[r>>2]=i[t>>2],i[r+4>>2]=i[t+4>>2],i[r+8>>2]=i[t+8>>2],i[r+12>>2]=i[t+12>>2],i[(s=r+16|0)>>2]=i[n>>2],i[s+4>>2]=i[n+4>>2],i[s+8>>2]=i[n+8>>2],i[s+12>>2]=i[n+12>>2],i[r+32>>2]=0,s=~~(+c(+ +d(10,+ +(15-(0|i[e+12>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|i[e+4>>2]))>>>0,s=(0|i[e>>2])+(s<<2)|0,o=0|i[s>>2];do{if(o){for(;!(0|dt(o,t)&&0|dt(o+16|0,n));)if(s=0|i[o+32>>2],!(0|i[(o=0==(0|s)?o:s)+32>>2])){l=10;break}if(10==(0|l)){i[o+32>>2]=r;break}return Jt(r),0|(l=o)}i[s>>2]=r}while(0);return i[(l=e+8|0)>>2]=1+(0|i[l>>2]),0|(l=r)}function Xt(e,t,n){t|=0,n|=0;var r=0,o=0;if(o=~~(+c(+ +d(10,+ +(15-(0|i[(e|=0)+12>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|i[e+4>>2]))>>>0,!(o=0|i[(0|i[e>>2])+(o<<2)>>2]))return 0|(n=0);if(!n){for(e=o;;){if(0|dt(e,t)){r=10;break}if(!(e=0|i[e+32>>2])){e=0,r=10;break}}if(10==(0|r))return 0|e}for(e=o;;){if(0|dt(e,t)&&0|dt(e+16|0,n)){r=10;break}if(!(e=0|i[e+32>>2])){e=0,r=10;break}}return 10==(0|r)?0|e:0}function Yt(e,t){t|=0;var n=0;if(n=~~(+c(+ +d(10,+ +(15-(0|i[(e|=0)+12>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|i[e+4>>2]))>>>0,!(e=0|i[(0|i[e>>2])+(n<<2)>>2]))return 0|(n=0);for(;;){if(0|dt(e,t)){t=5;break}if(!(e=0|i[e+32>>2])){e=0,t=5;break}}return 5==(0|t)?0|e:0}function Qt(e){return 0|+yn(+(e=+e))}function Zt(e){e|=0;var t,n=0,r=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0;t=R,R=R+16|0,f=t;do{if(e>>>0<245){if(e=(d=e>>>0<11?16:e+11&-8)>>>3,3&(r=(p=0|i[6981])>>>e))return a=0|i[(r=(e=27964+((n=(1&r^1)+e|0)<<1<<2)|0)+8|0)>>2],(0|(s=0|i[(o=a+8|0)>>2]))==(0|e)?i[6981]=p&~(1<<n):(i[s+12>>2]=e,i[r>>2]=s),_=n<<3,i[a+4>>2]=3|_,i[(_=a+_+4|0)>>2]=1|i[_>>2],R=t,0|(_=o);if(d>>>0>(h=0|i[6983])>>>0){if(0|r)return n=((n=r<<e&((n=2<<e)|0-n))&0-n)-1|0,s=0|i[(e=(n=27964+((a=((r=(n>>>=c=n>>>12&16)>>>5&8)|c|(s=(n>>>=r)>>>2&4)|(e=(n>>>=s)>>>1&2)|(a=(n>>>=e)>>>1&1))+(n>>>a)|0)<<1<<2)|0)+8|0)>>2],(0|(r=0|i[(c=s+8|0)>>2]))==(0|n)?(e=p&~(1<<a),i[6981]=e):(i[r+12>>2]=n,i[e>>2]=r,e=p),l=(_=a<<3)-d|0,i[s+4>>2]=3|d,i[(o=s+d|0)+4>>2]=1|l,i[s+_>>2]=l,0|h&&(a=0|i[6986],r=27964+((n=h>>>3)<<1<<2)|0,e&(n=1<<n)?n=0|i[(e=r+8|0)>>2]:(i[6981]=e|n,n=r,e=r+8|0),i[e>>2]=a,i[n+12>>2]=a,i[a+8>>2]=n,i[a+12>>2]=r),i[6983]=l,i[6986]=o,R=t,0|(_=c);if(s=0|i[6982]){for(r=(s&0-s)-1|0,r=u=0|i[28228+(((a=(r>>>=o=r>>>12&16)>>>5&8)|o|(l=(r>>>=a)>>>2&4)|(c=(r>>>=l)>>>1&2)|(u=(r>>>=c)>>>1&1))+(r>>>u)<<2)>>2],c=u,u=(-8&i[u+4>>2])-d|0;(e=0|i[r+16>>2])||(e=0|i[r+20>>2]);)r=e,c=(o=(l=(-8&i[e+4>>2])-d|0)>>>0<u>>>0)?e:c,u=o?l:u;if((l=c+d|0)>>>0>c>>>0){o=0|i[c+24>>2],n=0|i[c+12>>2];do{if((0|n)==(0|c)){if(!(n=0|i[(e=c+20|0)>>2])&&!(n=0|i[(e=c+16|0)>>2])){r=0;break}for(;;)if(r=0|i[(a=n+20|0)>>2])n=r,e=a;else{if(!(r=0|i[(a=n+16|0)>>2]))break;n=r,e=a}i[e>>2]=0,r=n}else r=0|i[c+8>>2],i[r+12>>2]=n,i[n+8>>2]=r,r=n}while(0);do{if(0|o){if(n=0|i[c+28>>2],(0|c)==(0|i[(e=28228+(n<<2)|0)>>2])){if(i[e>>2]=r,!r){i[6982]=s&~(1<<n);break}}else if(i[((0|i[(_=o+16|0)>>2])==(0|c)?_:o+20)>>2]=r,!r)break;i[r+24>>2]=o,0|(n=0|i[c+16>>2])&&(i[r+16>>2]=n,i[n+24>>2]=r),0|(n=0|i[c+20>>2])&&(i[r+20>>2]=n,i[n+24>>2]=r)}}while(0);return u>>>0<16?(_=u+d|0,i[c+4>>2]=3|_,i[(_=c+_+4|0)>>2]=1|i[_>>2]):(i[c+4>>2]=3|d,i[l+4>>2]=1|u,i[l+u>>2]=u,0|h&&(a=0|i[6986],r=27964+((n=h>>>3)<<1<<2)|0,(n=1<<n)&p?n=0|i[(e=r+8|0)>>2]:(i[6981]=n|p,n=r,e=r+8|0),i[e>>2]=a,i[n+12>>2]=a,i[a+8>>2]=n,i[a+12>>2]=r),i[6983]=u,i[6986]=l),R=t,0|(_=c+8|0)}p=d}else p=d}else p=d}else if(e>>>0<=4294967231)if(d=-8&(e=e+11|0),a=0|i[6982]){o=0-d|0,u=(e>>>=8)?d>>>0>16777215?31:d>>>((u=14-((c=((v=e<<(p=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|p|(u=((v<<=c)+245760|0)>>>16&2))+(v<<u>>>15)|0)+7|0)&1|u<<1:0,r=0|i[28228+(u<<2)>>2];e:do{if(r)for(e=0,c=d<<(31==(0|u)?0:25-(u>>>1)|0),s=0;;){if((l=(-8&i[r+4>>2])-d|0)>>>0<o>>>0){if(!l){e=r,o=0,v=65;break e}e=r,o=l}if(s=0==(0|(v=0|i[r+20>>2]))|(0|v)==(0|(r=0|i[r+16+(c>>>31<<2)>>2]))?s:v,!r){r=s,v=61;break}c<<=1}else r=0,e=0,v=61}while(0);if(61==(0|v)){if(0==(0|r)&0==(0|e)){if(!(e=((e=2<<u)|0-e)&a)){p=d;break}p=(e&0-e)-1|0,e=0,r=0|i[28228+(((s=(p>>>=l=p>>>12&16)>>>5&8)|l|(c=(p>>>=s)>>>2&4)|(u=(p>>>=c)>>>1&2)|(r=(p>>>=u)>>>1&1))+(p>>>r)<<2)>>2]}r?v=65:(c=e,l=o)}if(65==(0|v))for(s=r;;){if(o=(r=(p=(-8&i[s+4>>2])-d|0)>>>0<o>>>0)?p:o,e=r?s:e,(r=0|i[s+16>>2])||(r=0|i[s+20>>2]),!r){c=e,l=o;break}s=r}if(0!=(0|c)&&l>>>0<((0|i[6983])-d|0)>>>0&&(h=c+d|0)>>>0>c>>>0){s=0|i[c+24>>2],n=0|i[c+12>>2];do{if((0|n)==(0|c)){if(!(n=0|i[(e=c+20|0)>>2])&&!(n=0|i[(e=c+16|0)>>2])){n=0;break}for(;;)if(r=0|i[(o=n+20|0)>>2])n=r,e=o;else{if(!(r=0|i[(o=n+16|0)>>2]))break;n=r,e=o}i[e>>2]=0}else _=0|i[c+8>>2],i[_+12>>2]=n,i[n+8>>2]=_}while(0);do{if(s){if(e=0|i[c+28>>2],(0|c)==(0|i[(r=28228+(e<<2)|0)>>2])){if(i[r>>2]=n,!n){a&=~(1<<e),i[6982]=a;break}}else if(i[((0|i[(_=s+16|0)>>2])==(0|c)?_:s+20)>>2]=n,!n)break;i[n+24>>2]=s,0|(e=0|i[c+16>>2])&&(i[n+16>>2]=e,i[e+24>>2]=n),(e=0|i[c+20>>2])&&(i[n+20>>2]=e,i[e+24>>2]=n)}}while(0);e:do{if(l>>>0<16)_=l+d|0,i[c+4>>2]=3|_,i[(_=c+_+4|0)>>2]=1|i[_>>2];else{if(i[c+4>>2]=3|d,i[h+4>>2]=1|l,i[h+l>>2]=l,n=l>>>3,l>>>0<256){r=27964+(n<<1<<2)|0,(e=0|i[6981])&(n=1<<n)?n=0|i[(e=r+8|0)>>2]:(i[6981]=e|n,n=r,e=r+8|0),i[e>>2]=h,i[n+12>>2]=h,i[h+8>>2]=n,i[h+12>>2]=r;break}if(n=28228+((r=(n=l>>>8)?l>>>0>16777215?31:l>>>((r=14-((b=((_=n<<(x=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|x|(r=((_<<=b)+245760|0)>>>16&2))+(_<<r>>>15)|0)+7|0)&1|r<<1:0)<<2)|0,i[h+28>>2]=r,i[(e=h+16|0)+4>>2]=0,i[e>>2]=0,!(a&(e=1<<r))){i[6982]=a|e,i[n>>2]=h,i[h+24>>2]=n,i[h+12>>2]=h,i[h+8>>2]=h;break}n=0|i[n>>2];t:do{if((-8&i[n+4>>2])!=(0|l)){for(a=l<<(31==(0|r)?0:25-(r>>>1)|0);e=0|i[(r=n+16+(a>>>31<<2)|0)>>2];){if((-8&i[e+4>>2])==(0|l)){n=e;break t}a<<=1,n=e}i[r>>2]=h,i[h+24>>2]=n,i[h+12>>2]=h,i[h+8>>2]=h;break e}}while(0);_=0|i[(x=n+8|0)>>2],i[_+12>>2]=h,i[x>>2]=h,i[h+8>>2]=_,i[h+12>>2]=n,i[h+24>>2]=0}}while(0);return R=t,0|(_=c+8|0)}p=d}else p=d;else p=-1}while(0);if((r=0|i[6983])>>>0>=p>>>0)return n=r-p|0,e=0|i[6986],n>>>0>15?(_=e+p|0,i[6986]=_,i[6983]=n,i[_+4>>2]=1|n,i[e+r>>2]=n,i[e+4>>2]=3|p):(i[6983]=0,i[6986]=0,i[e+4>>2]=3|r,i[(_=e+r+4|0)>>2]=1|i[_>>2]),R=t,0|(_=e+8|0);if((l=0|i[6984])>>>0>p>>>0)return b=l-p|0,i[6984]=b,x=(_=0|i[6987])+p|0,i[6987]=x,i[x+4>>2]=1|b,i[_+4>>2]=3|p,R=t,0|(_=_+8|0);if(0|i[7099]?e=0|i[7101]:(i[7101]=4096,i[7100]=4096,i[7102]=-1,i[7103]=-1,i[7104]=0,i[7092]=0,i[7099]=-16&f^1431655768,e=4096),c=p+48|0,(d=(s=e+(u=p+47|0)|0)&(o=0-e|0))>>>0<=p>>>0)return R=t,0|(_=0);if(0|(e=0|i[7091])&&(f=(h=0|i[7089])+d|0)>>>0<=h>>>0|f>>>0>e>>>0)return R=t,0|(_=0);e:do{if(4&i[7092])n=0,v=143;else{r=0|i[6987];t:do{if(r){for(a=28372;!((f=0|i[a>>2])>>>0<=r>>>0&&(f+(0|i[a+4>>2])|0)>>>0>r>>>0);){if(!(e=0|i[a+8>>2])){v=128;break t}a=e}if((n=s-l&o)>>>0<2147483647)if((0|(e=0|bn(0|n)))==((0|i[a>>2])+(0|i[a+4>>2])|0)){if(-1!=(0|e)){l=n,s=e,v=145;break e}}else a=e,v=136;else n=0}else v=128}while(0);do{if(128==(0|v))if(-1!=(0|(r=0|bn(0)))&&(n=r,g=(n=(0==((g=(m=0|i[7100])+-1|0)&n|0)?0:(g+n&0-m)-n|0)+d|0)+(m=0|i[7089])|0,n>>>0>p>>>0&n>>>0<2147483647)){if(0|(f=0|i[7091])&&g>>>0<=m>>>0|g>>>0>f>>>0){n=0;break}if((0|(e=0|bn(0|n)))==(0|r)){l=n,s=r,v=145;break e}a=e,v=136}else n=0}while(0);do{if(136==(0|v)){if(r=0-n|0,!(c>>>0>n>>>0&n>>>0<2147483647&-1!=(0|a))){if(-1==(0|a)){n=0;break}l=n,s=a,v=145;break e}if((e=u-n+(e=0|i[7101])&0-e)>>>0>=2147483647){l=n,s=a,v=145;break e}if(-1==(0|bn(0|e))){bn(0|r),n=0;break}l=e+n|0,s=a,v=145;break e}}while(0);i[7092]=4|i[7092],v=143}}while(0);if(143==(0|v)&&d>>>0<2147483647&&!(-1==(0|(b=0|bn(0|d)))|1^(y=(A=(g=0|bn(0))-b|0)>>>0>(p+40|0)>>>0)|b>>>0<g>>>0&-1!=(0|b)&-1!=(0|g)^1)&&(l=y?A:n,s=b,v=145),145==(0|v)){n=(0|i[7089])+l|0,i[7089]=n,n>>>0>(0|i[7090])>>>0&&(i[7090]=n),u=0|i[6987];e:do{if(u){for(n=28372;;){if((0|s)==((e=0|i[n>>2])+(r=0|i[n+4>>2])|0)){v=154;break}if(!(a=0|i[n+8>>2]))break;n=a}if(154==(0|v)&&(x=n+4|0,0==(8&i[n+12>>2]))&&s>>>0>u>>>0&e>>>0<=u>>>0){i[x>>2]=r+l,x=u+(b=0==(7&(b=u+8|0))?0:0-b&7)|0,b=(_=(0|i[6984])+l|0)-b|0,i[6987]=x,i[6984]=b,i[x+4>>2]=1|b,i[u+_+4>>2]=40,i[6988]=i[7103];break}for(s>>>0<(0|i[6985])>>>0&&(i[6985]=s),r=s+l|0,n=28372;;){if((0|i[n>>2])==(0|r)){v=162;break}if(!(e=0|i[n+8>>2]))break;n=e}if(162==(0|v)&&0==(8&i[n+12>>2])){i[n>>2]=s,i[(h=n+4|0)>>2]=(0|i[h>>2])+l,d=(h=s+(0==(7&(h=s+8|0))?0:0-h&7)|0)+p|0,c=(n=r+(0==(7&(n=r+8|0))?0:0-n&7)|0)-h-p|0,i[h+4>>2]=3|p;t:do{if((0|u)==(0|n))_=(0|i[6984])+c|0,i[6984]=_,i[6987]=d,i[d+4>>2]=1|_;else{if((0|i[6986])==(0|n)){_=(0|i[6983])+c|0,i[6983]=_,i[6986]=d,i[d+4>>2]=1|_,i[d+_>>2]=_;break}if(1==(3&(e=0|i[n+4>>2]))){l=-8&e,a=e>>>3;n:do{if(e>>>0<256){if(e=0|i[n+8>>2],(0|(r=0|i[n+12>>2]))==(0|e)){i[6981]=i[6981]&~(1<<a);break}i[e+12>>2]=r,i[r+8>>2]=e;break}s=0|i[n+24>>2],e=0|i[n+12>>2];do{if((0|e)==(0|n)){if(e=0|i[(a=(r=n+16|0)+4|0)>>2])r=a;else if(!(e=0|i[r>>2])){e=0;break}for(;;)if(a=0|i[(o=e+20|0)>>2])e=a,r=o;else{if(!(a=0|i[(o=e+16|0)>>2]))break;e=a,r=o}i[r>>2]=0}else _=0|i[n+8>>2],i[_+12>>2]=e,i[e+8>>2]=_}while(0);if(!s)break;a=28228+((r=0|i[n+28>>2])<<2)|0;do{if((0|i[a>>2])==(0|n)){if(i[a>>2]=e,0|e)break;i[6982]=i[6982]&~(1<<r);break n}if(i[((0|i[(_=s+16|0)>>2])==(0|n)?_:s+20)>>2]=e,!e)break n}while(0);if(i[e+24>>2]=s,0|(a=0|i[(r=n+16|0)>>2])&&(i[e+16>>2]=a,i[a+24>>2]=e),!(r=0|i[r+4>>2]))break;i[e+20>>2]=r,i[r+24>>2]=e}while(0);n=n+l|0,o=l+c|0}else o=c;if(i[(n=n+4|0)>>2]=-2&i[n>>2],i[d+4>>2]=1|o,i[d+o>>2]=o,n=o>>>3,o>>>0<256){r=27964+(n<<1<<2)|0,(e=0|i[6981])&(n=1<<n)?n=0|i[(e=r+8|0)>>2]:(i[6981]=e|n,n=r,e=r+8|0),i[e>>2]=d,i[n+12>>2]=d,i[d+8>>2]=n,i[d+12>>2]=r;break}n=o>>>8;do{if(n){if(o>>>0>16777215){a=31;break}a=o>>>((a=14-((b=((_=n<<(x=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|x|(a=((_<<=b)+245760|0)>>>16&2))+(_<<a>>>15)|0)+7|0)&1|a<<1}else a=0}while(0);if(n=28228+(a<<2)|0,i[d+28>>2]=a,i[(e=d+16|0)+4>>2]=0,i[e>>2]=0,!((e=0|i[6982])&(r=1<<a))){i[6982]=e|r,i[n>>2]=d,i[d+24>>2]=n,i[d+12>>2]=d,i[d+8>>2]=d;break}n=0|i[n>>2];n:do{if((-8&i[n+4>>2])!=(0|o)){for(a=o<<(31==(0|a)?0:25-(a>>>1)|0);e=0|i[(r=n+16+(a>>>31<<2)|0)>>2];){if((-8&i[e+4>>2])==(0|o)){n=e;break n}a<<=1,n=e}i[r>>2]=d,i[d+24>>2]=n,i[d+12>>2]=d,i[d+8>>2]=d;break t}}while(0);_=0|i[(x=n+8|0)>>2],i[_+12>>2]=d,i[x>>2]=d,i[d+8>>2]=_,i[d+12>>2]=n,i[d+24>>2]=0}}while(0);return R=t,0|(_=h+8|0)}for(n=28372;!((e=0|i[n>>2])>>>0<=u>>>0&&(_=e+(0|i[n+4>>2])|0)>>>0>u>>>0);)n=0|i[n+8>>2];n=(e=(e=(o=_+-47|0)+(0==(7&(e=o+8|0))?0:0-e&7)|0)>>>0<(o=u+16|0)>>>0?u:e)+8|0,x=s+(b=0==(7&(b=s+8|0))?0:0-b&7)|0,b=(r=l+-40|0)-b|0,i[6987]=x,i[6984]=b,i[x+4>>2]=1|b,i[s+r+4>>2]=40,i[6988]=i[7103],i[(r=e+4|0)>>2]=27,i[n>>2]=i[7093],i[n+4>>2]=i[7094],i[n+8>>2]=i[7095],i[n+12>>2]=i[7096],i[7093]=s,i[7094]=l,i[7096]=0,i[7095]=n,n=e+24|0;do{x=n,i[(n=n+4|0)>>2]=7}while((x+8|0)>>>0<_>>>0);if((0|e)!=(0|u)){if(s=e-u|0,i[r>>2]=-2&i[r>>2],i[u+4>>2]=1|s,i[e>>2]=s,n=s>>>3,s>>>0<256){r=27964+(n<<1<<2)|0,(e=0|i[6981])&(n=1<<n)?n=0|i[(e=r+8|0)>>2]:(i[6981]=e|n,n=r,e=r+8|0),i[e>>2]=u,i[n+12>>2]=u,i[u+8>>2]=n,i[u+12>>2]=r;break}if(r=28228+((a=(n=s>>>8)?s>>>0>16777215?31:s>>>((a=14-((b=((_=n<<(x=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|x|(a=((_<<=b)+245760|0)>>>16&2))+(_<<a>>>15)|0)+7|0)&1|a<<1:0)<<2)|0,i[u+28>>2]=a,i[u+20>>2]=0,i[o>>2]=0,!((n=0|i[6982])&(e=1<<a))){i[6982]=n|e,i[r>>2]=u,i[u+24>>2]=r,i[u+12>>2]=u,i[u+8>>2]=u;break}n=0|i[r>>2];t:do{if((-8&i[n+4>>2])!=(0|s)){for(a=s<<(31==(0|a)?0:25-(a>>>1)|0);e=0|i[(r=n+16+(a>>>31<<2)|0)>>2];){if((-8&i[e+4>>2])==(0|s)){n=e;break t}a<<=1,n=e}i[r>>2]=u,i[u+24>>2]=n,i[u+12>>2]=u,i[u+8>>2]=u;break e}}while(0);_=0|i[(x=n+8|0)>>2],i[_+12>>2]=u,i[x>>2]=u,i[u+8>>2]=_,i[u+12>>2]=n,i[u+24>>2]=0}}else 0==(0|(_=0|i[6985]))|s>>>0<_>>>0&&(i[6985]=s),i[7093]=s,i[7094]=l,i[7096]=0,i[6990]=i[7099],i[6989]=-1,i[6994]=27964,i[6993]=27964,i[6996]=27972,i[6995]=27972,i[6998]=27980,i[6997]=27980,i[7e3]=27988,i[6999]=27988,i[7002]=27996,i[7001]=27996,i[7004]=28004,i[7003]=28004,i[7006]=28012,i[7005]=28012,i[7008]=28020,i[7007]=28020,i[7010]=28028,i[7009]=28028,i[7012]=28036,i[7011]=28036,i[7014]=28044,i[7013]=28044,i[7016]=28052,i[7015]=28052,i[7018]=28060,i[7017]=28060,i[7020]=28068,i[7019]=28068,i[7022]=28076,i[7021]=28076,i[7024]=28084,i[7023]=28084,i[7026]=28092,i[7025]=28092,i[7028]=28100,i[7027]=28100,i[7030]=28108,i[7029]=28108,i[7032]=28116,i[7031]=28116,i[7034]=28124,i[7033]=28124,i[7036]=28132,i[7035]=28132,i[7038]=28140,i[7037]=28140,i[7040]=28148,i[7039]=28148,i[7042]=28156,i[7041]=28156,i[7044]=28164,i[7043]=28164,i[7046]=28172,i[7045]=28172,i[7048]=28180,i[7047]=28180,i[7050]=28188,i[7049]=28188,i[7052]=28196,i[7051]=28196,i[7054]=28204,i[7053]=28204,i[7056]=28212,i[7055]=28212,x=s+(b=0==(7&(b=s+8|0))?0:0-b&7)|0,b=(_=l+-40|0)-b|0,i[6987]=x,i[6984]=b,i[x+4>>2]=1|b,i[s+_+4>>2]=40,i[6988]=i[7103]}while(0);if((n=0|i[6984])>>>0>p>>>0)return b=n-p|0,i[6984]=b,x=(_=0|i[6987])+p|0,i[6987]=x,i[x+4>>2]=1|b,i[_+4>>2]=3|p,R=t,0|(_=_+8|0)}return i[(_=27920)>>2]=12,R=t,0|(_=0)}function Jt(e){var t=0,n=0,r=0,a=0,o=0,s=0,l=0,c=0;if(e|=0){n=e+-8|0,a=0|i[6985],c=n+(t=-8&(e=0|i[e+-4>>2]))|0;do{if(1&e)l=n,s=n;else{if(r=0|i[n>>2],!(3&e))return;if(o=r+t|0,(s=n+(0-r)|0)>>>0<a>>>0)return;if((0|i[6986])==(0|s)){if(3!=(3&(t=0|i[(e=c+4|0)>>2]))){l=s,t=o;break}return i[6983]=o,i[e>>2]=-2&t,i[s+4>>2]=1|o,void(i[s+o>>2]=o)}if(n=r>>>3,r>>>0<256){if(e=0|i[s+8>>2],(0|(t=0|i[s+12>>2]))==(0|e)){i[6981]=i[6981]&~(1<<n),l=s,t=o;break}i[e+12>>2]=t,i[t+8>>2]=e,l=s,t=o;break}a=0|i[s+24>>2],e=0|i[s+12>>2];do{if((0|e)==(0|s)){if(e=0|i[(n=(t=s+16|0)+4|0)>>2])t=n;else if(!(e=0|i[t>>2])){e=0;break}for(;;)if(n=0|i[(r=e+20|0)>>2])e=n,t=r;else{if(!(n=0|i[(r=e+16|0)>>2]))break;e=n,t=r}i[t>>2]=0}else l=0|i[s+8>>2],i[l+12>>2]=e,i[e+8>>2]=l}while(0);if(a){if(t=0|i[s+28>>2],(0|i[(n=28228+(t<<2)|0)>>2])==(0|s)){if(i[n>>2]=e,!e){i[6982]=i[6982]&~(1<<t),l=s,t=o;break}}else if(i[((0|i[(l=a+16|0)>>2])==(0|s)?l:a+20)>>2]=e,!e){l=s,t=o;break}i[e+24>>2]=a,0|(n=0|i[(t=s+16|0)>>2])&&(i[e+16>>2]=n,i[n+24>>2]=e),(t=0|i[t+4>>2])?(i[e+20>>2]=t,i[t+24>>2]=e,l=s,t=o):(l=s,t=o)}else l=s,t=o}}while(0);if(!(s>>>0>=c>>>0)&&1&(r=0|i[(e=c+4|0)>>2])){if(2&r)i[e>>2]=-2&r,i[l+4>>2]=1|t,i[s+t>>2]=t,a=t;else{if((0|i[6987])==(0|c)){if(c=(0|i[6984])+t|0,i[6984]=c,i[6987]=l,i[l+4>>2]=1|c,(0|l)!=(0|i[6986]))return;return i[6986]=0,void(i[6983]=0)}if((0|i[6986])==(0|c))return c=(0|i[6983])+t|0,i[6983]=c,i[6986]=s,i[l+4>>2]=1|c,void(i[s+c>>2]=c);a=(-8&r)+t|0,n=r>>>3;do{if(r>>>0<256){if(t=0|i[c+8>>2],(0|(e=0|i[c+12>>2]))==(0|t)){i[6981]=i[6981]&~(1<<n);break}i[t+12>>2]=e,i[e+8>>2]=t;break}o=0|i[c+24>>2],e=0|i[c+12>>2];do{if((0|e)==(0|c)){if(e=0|i[(n=(t=c+16|0)+4|0)>>2])t=n;else if(!(e=0|i[t>>2])){n=0;break}for(;;)if(n=0|i[(r=e+20|0)>>2])e=n,t=r;else{if(!(n=0|i[(r=e+16|0)>>2]))break;e=n,t=r}i[t>>2]=0,n=e}else n=0|i[c+8>>2],i[n+12>>2]=e,i[e+8>>2]=n,n=e}while(0);if(0|o){if(e=0|i[c+28>>2],(0|i[(t=28228+(e<<2)|0)>>2])==(0|c)){if(i[t>>2]=n,!n){i[6982]=i[6982]&~(1<<e);break}}else if(i[((0|i[(r=o+16|0)>>2])==(0|c)?r:o+20)>>2]=n,!n)break;i[n+24>>2]=o,0|(t=0|i[(e=c+16|0)>>2])&&(i[n+16>>2]=t,i[t+24>>2]=n),0|(e=0|i[e+4>>2])&&(i[n+20>>2]=e,i[e+24>>2]=n)}}while(0);if(i[l+4>>2]=1|a,i[s+a>>2]=a,(0|l)==(0|i[6986]))return void(i[6983]=a)}if(e=a>>>3,a>>>0<256)return n=27964+(e<<1<<2)|0,(t=0|i[6981])&(e=1<<e)?e=0|i[(t=n+8|0)>>2]:(i[6981]=t|e,e=n,t=n+8|0),i[t>>2]=l,i[e+12>>2]=l,i[l+8>>2]=e,void(i[l+12>>2]=n);e=28228+((r=(e=a>>>8)?a>>>0>16777215?31:a>>>((r=14-((o=((c=e<<(s=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(r=((c<<=o)+245760|0)>>>16&2))+(c<<r>>>15)|0)+7|0)&1|r<<1:0)<<2)|0,i[l+28>>2]=r,i[l+20>>2]=0,i[l+16>>2]=0,t=0|i[6982],n=1<<r;e:do{if(t&n){e=0|i[e>>2];t:do{if((-8&i[e+4>>2])!=(0|a)){for(r=a<<(31==(0|r)?0:25-(r>>>1)|0);t=0|i[(n=e+16+(r>>>31<<2)|0)>>2];){if((-8&i[t+4>>2])==(0|a)){e=t;break t}r<<=1,e=t}i[n>>2]=l,i[l+24>>2]=e,i[l+12>>2]=l,i[l+8>>2]=l;break e}}while(0);c=0|i[(s=e+8|0)>>2],i[c+12>>2]=l,i[s>>2]=l,i[l+8>>2]=c,i[l+12>>2]=e,i[l+24>>2]=0}else i[6982]=t|n,i[e>>2]=l,i[l+24>>2]=e,i[l+12>>2]=l,i[l+8>>2]=l}while(0);if(c=(0|i[6989])-1|0,i[6989]=c,!(0|c)){for(e=28380;e=0|i[e>>2];)e=e+8|0;i[6989]=-1}}}}function en(e,t){t|=0;var n=0;return(e|=0)?(n=0|b(t,e),(t|e)>>>0>65535&&(n=((n>>>0)/(e>>>0)|0)==(0|t)?n:-1)):n=0,(e=0|Zt(n))&&3&i[e+-4>>2]?(An(0|e,0,0|n),0|e):0|e}function tn(e,t,n,r){return 0|(S((t|=0)+(r|=0)+((n=(e|=0)+(n|=0)>>>0)>>>0<e>>>0|0)>>>0|0),n)}function nn(e,t,n,r){return 0|(S(0|(r=(t|=0)-(r|=0)-((n|=0)>>>0>(e|=0)>>>0|0)>>>0)),e-n>>>0)}function rn(e){return 0|((e|=0)?31-(0|w(e^e-1)):32)}function an(e,t,n,r,a){a|=0;var o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0;if(d=e|=0,s=n|=0,l=p=r|=0,!(u=c=t|=0))return o=0!=(0|a),l?o?(i[a>>2]=0|e,i[a+4>>2]=0&t,a=0,0|(S(0|(p=0)),a)):(a=0,0|(S(0|(p=0)),a)):(o&&(i[a>>2]=(d>>>0)%(s>>>0),i[a+4>>2]=0),a=(d>>>0)/(s>>>0)>>>0,0|(S(0|(p=0)),a));o=0==(0|l);do{if(s){if(!o){if((o=(0|w(0|l))-(0|w(0|u))|0)>>>0<=31){s=h=o+1|0,e=d>>>(h>>>0)&(t=o-31>>31)|u<<(l=31-o|0),t&=u>>>(h>>>0),o=0,l=d<<l;break}return a?(i[a>>2]=0|e,i[a+4>>2]=c|0&t,a=0,0|(S(0|(p=0)),a)):(a=0,0|(S(0|(p=0)),a))}if((o=s-1|0)&s|0){s=l=33+(0|w(0|s))-(0|w(0|u))|0,e=(h=32-l|0)-1>>31&u>>>((f=l-32|0)>>>0)|(u<<h|d>>>(l>>>0))&(t=f>>31),t&=u>>>(l>>>0),o=d<<(m=64-l|0)&(c=h>>31),l=(u<<m|d>>>(f>>>0))&c|d<<h&l-33>>31;break}return 0|a&&(i[a>>2]=o&d,i[a+4>>2]=0),1==(0|s)?(m=0|e,0|(S(0|(f=c|0&t)),m)):(f=u>>>((m=0|rn(0|s))>>>0)|0,m=u<<32-m|d>>>(m>>>0),0|(S(0|f),m))}if(o)return 0|a&&(i[a>>2]=(u>>>0)%(s>>>0),i[a+4>>2]=0),m=(u>>>0)/(s>>>0)>>>0,0|(S(0|(f=0)),m);if(!d)return 0|a&&(i[a>>2]=0,i[a+4>>2]=(u>>>0)%(l>>>0)),m=(u>>>0)/(l>>>0)>>>0,0|(S(0|(f=0)),m);if(!((o=l-1|0)&l))return 0|a&&(i[a>>2]=0|e,i[a+4>>2]=o&u|0&t),f=0,m=u>>>((0|rn(0|l))>>>0),0|(S(0|f),m);if((o=(0|w(0|l))-(0|w(0|u))|0)>>>0<=30){s=t=o+1|0,e=u<<(l=31-o|0)|d>>>(t>>>0),t=u>>>(t>>>0),o=0,l=d<<l;break}return a?(i[a>>2]=0|e,i[a+4>>2]=c|0&t,m=0,0|(S(0|(f=0)),m)):(m=0,0|(S(0|(f=0)),m))}while(0);if(s){u=0|tn(0|(h=0|n),0|(d=p|0&r),-1,-1),n=0|T(),c=l,l=0;do{r=c,c=o>>>31|c<<1,o=l|o<<1,nn(0|u,0|n,0|(r=e<<1|r>>>31),0|(p=e>>>31|t<<1)),l=1&(f=(m=0|T())>>31|((0|m)<0?-1:0)<<1),e=0|nn(0|r,0|p,f&h|0,(((0|m)<0?-1:0)>>31|((0|m)<0?-1:0)<<1)&d),t=0|T(),s=s-1|0}while(0!=(0|s));u=c,c=0}else u=l,c=0,l=0;return s=0,0|a&&(i[a>>2]=e,i[a+4>>2]=t),m=o<<1&-2|l,0|(S(0|(f=(0|o)>>>31|(u|s)<<1|c)),m)}function on(e,t,n,r){n|=0;var i,a,o,s,l;return a=(r|=0)>>31|((0|r)<0?-1:0)<<1,i=((0|r)<0?-1:0)>>31|((0|r)<0?-1:0)<<1,o=0|nn((l=(t|=0)>>31|((0|t)<0?-1:0)<<1)^(e|=0)|0,(s=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1)^t|0,0|l,0|s),e=a^l,t=i^s,0|nn((0|an(o,0|T(),0|nn(a^n|0,i^r|0,0|a,0|i),0|T(),0))^e,(0|T())^t,0|e,0|t)}function sn(e,t,n,r){t|=0,r|=0;var i,a;return n=0|function(e,t){var n,r,i,a=0;return e=((n=0|b(a=65535&(t|=0),i=65535&(e|=0)))>>>16)+(0|b(a,r=e>>>16))|0,t=0|b(a=t>>>16,i),0|(S((e>>>16)+(0|b(a,r))+(((65535&e)+t|0)>>>16)|0),e+t<<16|65535&n)}(i=e|=0,a=n|=0),e=0|T(),0|(S((0|b(t,a))+(0|b(r,i))+e|0&e),n)}function ln(e,t,n,r){n|=0;var a,o,s,l,c,u;return a=R,R=R+16|0,l=0|a,u=(r|=0)>>31|((0|r)<0?-1:0)<<1,c=((0|r)<0?-1:0)>>31|((0|r)<0?-1:0)<<1,an(e=0|nn((s=(t|=0)>>31|((0|t)<0?-1:0)<<1)^(e|=0)|0,(o=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1)^t|0,0|s,0|o),t=0|T(),0|nn(u^n|0,c^r|0,0|u,0|c),0|T(),l),r=0|nn(i[l>>2]^s|0,i[l+4>>2]^o|0,0|s,0|o),n=0|T(),R=a,0|(S(0|n),r)}function cn(e,t,n,r){var a,o;return o=R,R=R+16|0,an(e|=0,t|=0,n|=0,r|=0,a=0|o),R=o,0|(S(0|i[a+4>>2]),i[a>>2])}function un(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(S(t>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(S(0|((0|t)<0?-1:0)),t>>n-32)}function dn(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(S(t>>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(S(0),t>>>n-32|0)}function hn(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(S(t<<n|(e&(1<<n)-1<<32-n)>>>32-n),e<<n):(S(e<<n-32),0)}function pn(e,t,n){return e|=0,32==(0|(t=0|w(t|=0)))&&(t=t+(0|w(e))|0),S(0),0|t}function fn(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+_(+e,+t)}function mn(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+x(+e,+t)}function gn(e){return(e=+e)>=0?+l(e+.5):+y(e-.5)}function vn(e,t,n){e|=0,t|=0;var a,o,s=0;if((0|(n|=0))>=8192)return P(0|e,0|t,0|n),0|e;if(o=0|e,a=e+n|0,(3&e)==(3&t)){for(;3&e;){if(!n)return 0|o;r[e|0]=0|r[t|0],e=e+1|0,t=t+1|0,n=n-1|0}for(s=(n=-4&a)-64|0;(0|e)<=(0|s);)i[e>>2]=i[t>>2],i[e+4>>2]=i[t+4>>2],i[e+8>>2]=i[t+8>>2],i[e+12>>2]=i[t+12>>2],i[e+16>>2]=i[t+16>>2],i[e+20>>2]=i[t+20>>2],i[e+24>>2]=i[t+24>>2],i[e+28>>2]=i[t+28>>2],i[e+32>>2]=i[t+32>>2],i[e+36>>2]=i[t+36>>2],i[e+40>>2]=i[t+40>>2],i[e+44>>2]=i[t+44>>2],i[e+48>>2]=i[t+48>>2],i[e+52>>2]=i[t+52>>2],i[e+56>>2]=i[t+56>>2],i[e+60>>2]=i[t+60>>2],e=e+64|0,t=t+64|0;for(;(0|e)<(0|n);)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0}else for(n=a-4|0;(0|e)<(0|n);)r[e|0]=0|r[t|0],r[e+1|0]=0|r[t+1|0],r[e+2|0]=0|r[t+2|0],r[e+3|0]=0|r[t+3|0],e=e+4|0,t=t+4|0;for(;(0|e)<(0|a);)r[e|0]=0|r[t|0],e=e+1|0,t=t+1|0;return 0|o}function An(e,t,n){t|=0;var a,o=0,s=0,l=0;if(a=(e|=0)+(n|=0)|0,t&=255,(0|n)>=67){for(;3&e;)r[e|0]=t,e=e+1|0;for(l=t|t<<8|t<<16|t<<24,s=(o=-4&a)-64|0;(0|e)<=(0|s);)i[e>>2]=l,i[e+4>>2]=l,i[e+8>>2]=l,i[e+12>>2]=l,i[e+16>>2]=l,i[e+20>>2]=l,i[e+24>>2]=l,i[e+28>>2]=l,i[e+32>>2]=l,i[e+36>>2]=l,i[e+40>>2]=l,i[e+44>>2]=l,i[e+48>>2]=l,i[e+52>>2]=l,i[e+56>>2]=l,i[e+60>>2]=l,e=e+64|0;for(;(0|e)<(0|o);)i[e>>2]=l,e=e+4|0}for(;(0|e)<(0|a);)r[e|0]=t,e=e+1|0;return a-n|0}function yn(e){return(e=+e)>=0?+l(e+.5):+y(e-.5)}function bn(e){e|=0;var t,n,r;return r=0|E(),(0|e)>0&(0|(t=(n=0|i[s>>2])+e|0))<(0|n)|(0|t)<0?(k(0|t),M(12),-1):(0|t)>(0|r)&&!(0|N(0|t))?(M(12),-1):(i[s>>2]=t,0|n)}return{___divdi3:on,___muldi3:sn,___remdi3:ln,___uremdi3:cn,_areNeighborCells:function(e,t,n,r,a){a|=0;var o,s,l,c=0,u=0,d=0,h=0;if(l=R,R=R+64|0,s=l,o=l+56|0,!(!0&134217728==(2013265920&(t|=0))&!0&134217728==(2013265920&(r|=0))))return R=l,0|(a=5);if((0|(e|=0))==(0|(n|=0))&(0|t)==(0|r))return i[a>>2]=0,R=l,0|(a=0);if(u=0|dn(0|e,0|t,52),T(),u&=15,h=0|dn(0|n,0|r,52),T(),(0|u)!=(15&h))return R=l,0|(a=12);if(c=u+-1|0,u>>>0>1){qe(e,t,c,s),qe(n,r,c,o),d=0|i[(h=s)>>2],h=0|i[h+4>>2];e:do{if((0|d)==(0|i[o>>2])&&(0|h)==(0|i[o+4>>2])){c=0|dn(0|e,0|t,0|(u=3*(15^u)|0)),T(),c&=7,u=0|dn(0|n,0|r,0|u),T(),u&=7;do{if(0==(0|c)|0==(0|u))i[a>>2]=1,c=0;else if(7==(0|c))c=5;else{if(1==(0|c)|1==(0|u)&&0|He(d,h)){c=5;break}if((0|i[15536+(c<<2)>>2])!=(0|u)&&(0|i[15568+(c<<2)>>2])!=(0|u))break e;i[a>>2]=1,c=0}}while(0);return R=l,0|(a=c)}}while(0)}u=(c=s)+56|0;do{i[c>>2]=0,c=c+4|0}while((0|c)<(0|u));return L(e,t,1,s),c=(0|i[(t=s)>>2])==(0|n)&&(0|i[t+4>>2])==(0|r)||(0|i[(t=s+8|0)>>2])==(0|n)&&(0|i[t+4>>2])==(0|r)||(0|i[(t=s+16|0)>>2])==(0|n)&&(0|i[t+4>>2])==(0|r)||(0|i[(t=s+24|0)>>2])==(0|n)&&(0|i[t+4>>2])==(0|r)||(0|i[(t=s+32|0)>>2])==(0|n)&&(0|i[t+4>>2])==(0|r)||(0|i[(t=s+40|0)>>2])==(0|n)&&(0|i[t+4>>2])==(0|r)?1:1&((0|i[(c=s+48|0)>>2])==(0|n)?(0|i[c+4>>2])==(0|r):0),i[a>>2]=c,R=l,0|(a=0)},_bitshift64Ashr:un,_bitshift64Lshr:dn,_bitshift64Shl:hn,_calloc:en,_cellAreaKm2:function(e,t,n){return 0|(e=0|vt(e|=0,t|=0,n|=0))||(a[n>>3]=6371.007180918475*+a[n>>3]*6371.007180918475),0|e},_cellAreaM2:function(e,t,n){return 0|(e=0|vt(e|=0,t|=0,n|=0))||(a[n>>3]=6371.007180918475*+a[n>>3]*6371.007180918475*1e3*1e3),0|e},_cellAreaRads2:vt,_cellToBoundary:at,_cellToCenterChild:Ke,_cellToChildPos:function(e,t,n,r){n|=0,r|=0;var a,o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0;if(a=R,R=R+16|0,A=a,y=0|dn(0|(e|=0),0|(t|=0),52),T(),y&=15,n>>>0>15)return R=a,0|(y=4);if((0|y)<(0|n))return R=a,0|(y=12);if((0|y)!=(0|n))if(s=0|hn(0|n,0,52),s|=e,c=T()|-15728641&t,(0|y)>(0|n)){u=n;do{v=0|hn(7,0,3*(14-u|0)|0),u=u+1|0,s|=v,c=0|T()|c}while((0|u)<(0|y));v=s}else v=s;else v=e,c=t;g=0|dn(0|v,0|c,45),T();e:do{if(0|V(127&g)){if(u=0|dn(0|v,0|c,52),T(),0|(u&=15))for(s=1;;){if(!(0==((g=0|hn(7,0,3*(15-s|0)|0))&v|0)&0==((0|T())&c))){d=33;break e}if(!(s>>>0<u>>>0))break;s=s+1|0}if(i[(g=r)>>2]=0,i[g+4>>2]=0,(0|y)>(0|n)){for(g=-15728641&t,m=y;;){if(f=m,(m=m+-1|0)>>>0>15|(0|y)<(0|m)){d=19;break}if((0|y)!=(0|m))if(s=0|hn(0|m,0,52),s|=e,u=0|T()|g,(0|y)<(0|f))p=s;else{d=m;do{p=0|hn(7,0,3*(14-d|0)|0),d=d+1|0,s|=p,u=0|T()|u}while((0|d)<(0|y));p=s}else p=e,u=t;if(h=0|dn(0|p,0|u,45),T(),0|V(127&h)){h=0|dn(0|p,0|u,52),T(),h&=15;t:do{if(h)for(d=1;;){if(s=0|dn(0|p,0|u,3*(15-d|0)|0),T(),0|(s&=7))break t;if(!(d>>>0<h>>>0)){s=0;break}d=d+1|0}else s=0}while(0);s=0==(0|s)&1}else s=0;if(u=0|dn(0|e,0|t,3*(15-f|0)|0),T(),7==(0|(u&=7))){o=5,d=42;break}if(1==(0|u)&(s=0!=(0|s))){o=5,d=42;break}if(0|(p=u+((0!=(0|u)&s)<<31>>31)|0)&&(d=0|Tt(7,0,d=y-f|0,((0|d)<0)<<31>>31),h=0|T(),s?(s=0|tn(0|(s=0|sn(0|d,0|h,5,0)),0|T(),-5,-1),s=0|tn(0|(s=0|on(0|s,0|T(),6,0)),0|T(),1,0),u=0|T()):(s=d,u=h),f=0|tn(0|s,0|u,0|(f=0|sn(0|d,0|h,0|(f=p+-1|0),((0|f)<0)<<31>>31)),0|T()),h=0|tn(0|f,0|(p=0|T()),0|i[(h=r)>>2],0|i[h+4>>2]),p=0|T(),i[(f=r)>>2]=h,i[f+4>>2]=p),(0|m)<=(0|n)){d=37;break}}if(19==(0|d))C(27795,27122,1367,27158);else{if(37==(0|d)){o=0|i[(l=r)+4>>2],l=0|i[l>>2];break}if(42==(0|d))return R=a,0|o}}else o=0,l=0}else d=33}while(0);e:do{if(33==(0|d)){if(i[(g=r)>>2]=0,i[g+4>>2]=0,(0|y)>(0|n)){for(s=y;;){if(o=0|dn(0|e,0|t,3*(15-s|0)|0),T(),7==(0|(o&=7))){o=5;break}if(o=0|sn(0|(l=0|Tt(7,0,l=y-s|0,((0|l)<0)<<31>>31)),0|T(),0|o,0),l=0|T(),l=0|tn(0|i[(g=r)>>2],0|i[g+4>>2],0|o,0|l),o=0|T(),i[(g=r)>>2]=l,i[g+4>>2]=o,(0|(s=s+-1|0))<=(0|n))break e}return R=a,0|o}o=0,l=0}}while(0);return 0|We(v,c,y,A)&&C(27795,27122,1327,27173),((0|o)>-1|-1==(0|o)&l>>>0>4294967295)&((0|(A=0|i[(y=A)+4>>2]))>(0|o)|((0|A)==(0|o)?(0|i[y>>2])>>>0>l>>>0:0))?(R=a,0|(y=0)):(C(27795,27122,1407,27158),0)},_cellToChildren:function(e,t,n,r){r|=0;var a,o,s=0,l=0;if(o=R,R=R+16|0,st(a=o,e|=0,t|=0,n|=0),0==(0|(e=0|i[(t=a)>>2]))&0==(0|(t=0|i[t+4>>2])))return R=o,0;s=0,n=0;do{i[(l=r+(s<<3)|0)>>2]=e,i[l+4>>2]=t,s=0|tn(0|s,0|n,1,0),n=0|T(),ct(a),e=0|i[(l=a)>>2],t=0|i[l+4>>2]}while(!(0==(0|e)&0==(0|t)));return R=o,0},_cellToChildrenSize:We,_cellToLatLng:it,_cellToLocalIj:function(e,t,n,r,i,a){var o,s;return e|=0,t|=0,n|=0,r|=0,a|=0,s=R,R=R+16|0,o=s,(i|=0)?e=15:(e=0|wt(e,t,n,r,o))||(Ce(o,a),e=0),R=s,0|e},_cellToParent:qe,_cellToVertex:Vt,_cellToVertexes:function(e,t,n){n|=0;var r,a=0,o=0;return o=0==(0|He(e|=0,t|=0)),r=0==(0|(a=0|Vt(e,t,0,n))),o?r?0|(a=0|Vt(e,t,1,n+8|0))||0|(a=0|Vt(e,t,2,n+16|0))||0|(a=0|Vt(e,t,3,n+24|0))||(a=0|Vt(e,t,4,n+32|0))?0|(o=a):0|Vt(e,t,5,n+40|0):0|(o=a):r?0|(a=0|Vt(e,t,1,n+8|0))||0|(a=0|Vt(e,t,2,n+16|0))||0|(a=0|Vt(e,t,3,n+24|0))||0|(a=0|Vt(e,t,4,n+32|0))?0|(o=a):(i[(o=n+40|0)>>2]=0,i[o+4>>2]=0,0|(o=0)):0|(o=a)},_cellsToDirectedEdge:function(e,t,n,r,a){return a|=0,7==(0|(n=0|z(e|=0,t|=0,n|=0,r|=0)))?0|(a=11):(r=0|hn(0|n,0,56),t=-2130706433&t|T()|268435456,i[a>>2]=e|r,i[a+4>>2]=t,0|(a=0))},_cellsToLinkedMultiPolygon:function(e,t,n){n|=0;var r,a,o,s=0;if(o=R,R=R+32|0,r=o,e=0|function(e,t,n){e|=0,n|=0;var r,a,o=0,s=0,l=0,c=0,u=0,d=0;if(a=R,R=R+176|0,r=a,(0|(t|=0))<1)return qt(n,0,0),R=a,0;for(u=0|dn(0|i[(u=e)>>2],0|i[u+4>>2],52),T(),qt(n,(0|t)>6?t:6,15&u),u=0;!(0|(o=0|at(0|i[(o=e+(u<<3)|0)>>2],0|i[o+4>>2],r)));){if((0|(o=0|i[r>>2]))>0){c=0;do{l=r+8+(c<<4)|0,(s=0|Xt(n,o=r+8+((0|(c=c+1|0))%(0|o)<<4)|0,l))?$t(n,s):Kt(n,l,o),o=0|i[r>>2]}while((0|c)<(0|o))}if((0|(u=u+1|0))>=(0|t)){o=0,d=13;break}}return 13==(0|d)?(R=a,0|o):(Wt(n),R=a,0|(d=o))}(e|=0,t|=0,a=o+16|0),0|e)return R=o,0|(n=e);if(i[n>>2]=0,i[n+4>>2]=0,i[n+8>>2]=0,0|(e=0|Ht(a)))do{t=0|At(n);do{yt(t,e),s=e+16|0,i[r>>2]=i[s>>2],i[r+4>>2]=i[s+4>>2],i[r+8>>2]=i[s+8>>2],i[r+12>>2]=i[s+12>>2],$t(a,e),e=0|Yt(a,r)}while(0!=(0|e));e=0|Ht(a)}while(0!=(0|e));return Wt(a),(e=0|xt(n))?(bt(n),R=o,0|(s=e)):(R=o,0|(s=0))},_childPosToCell:function(e,t,n,r,a,o){e|=0,t|=0,o|=0;var s,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0;if(s=R,R=R+16|0,l=s,(a|=0)>>>0>15)return R=s,0|(o=4);if(c=0|dn(0|(n|=0),0|(r|=0),52),T(),(0|(c&=15))>(0|a))return R=s,0|(o=12);if(0|We(n,r,a,l)&&C(27795,27122,1327,27173),!(((0|t)>-1|-1==(0|t)&e>>>0>4294967295)&((0|(d=0|i[(h=l)+4>>2]))>(0|t)|((0|d)==(0|t)?(0|i[h>>2])>>>0>e>>>0:0))))return R=s,0|(o=2);h=a-c|0,a=0|hn(0|a,0,52),u=T()|-15728641&r,i[(d=o)>>2]=a|n,i[d+4>>2]=u,d=0|dn(0|n,0|r,45),T();e:do{if(0|V(127&d)){if(0|c)for(l=1;;){if(!(0==((d=0|hn(7,0,3*(15-l|0)|0))&n|0)&0==((0|T())&r)))break e;if(!(l>>>0<c>>>0))break;l=l+1|0}if((0|h)<1)return R=s,0|(o=0);for(d=15^c,r=-1,u=1,l=1;;){c=0|Tt(7,0,c=h-u|0,((0|c)<0)<<31>>31),n=0|T();do{if(l){if(l=0|on(0|(l=0|tn(0|(l=0|sn(0|c,0|n,5,0)),0|T(),-5,-1)),0|T(),6,0),(0|t)>(0|(a=0|T()))|(0|t)==(0|a)&e>>>0>l>>>0){t=0|nn(0|(t=0|tn(0|e,0|t,-1,-1)),0|T(),0|l,0|a),l=0|T(),m=0|i[(p=o)>>2],p=0|i[p+4>>2],f=0|hn(7,0,0|(g=3*(d+r|0)|0)),p&=~T(),g=0|hn(0|(a=0|tn(0|(r=0|on(0|t,0|l,0|c,0|n)),0|(e=0|T()),2,0)),0|T(),0|g),p=0|T()|p,i[(a=o)>>2]=g|m&~f,i[a+4>>2]=p,e=0|nn(0|t,0|l,0|(e=0|sn(0|r,0|e,0|c,0|n)),0|T()),l=0,t=0|T();break}f=0|i[(g=o)>>2],g=0|i[g+4>>2],m=0|hn(7,0,3*(d+r|0)|0),g&=~T(),i[(l=o)>>2]=f&~m,i[l+4>>2]=g,l=1;break}a=0|i[(f=o)>>2],f=0|i[f+4>>2],p=0|hn(7,0,0|(r=3*(d+r|0)|0)),f&=~T(),r=0|hn(0|(g=0|on(0|e,0|t,0|c,0|n)),0|(l=0|T()),0|r),f=0|T()|f,i[(m=o)>>2]=r|a&~p,i[m+4>>2]=f,e=0|nn(0|e,0|t,0|(l=0|sn(0|g,0|l,0|c,0|n)),0|T()),l=0,t=0|T()}while(0);if(!((0|h)>(0|u))){t=0;break}r=~u,u=u+1|0}return R=s,0|t}}while(0);if((0|h)<1)return R=s,0|(g=0);for(a=15^c,l=1;;){if(m=0|Tt(7,0,m=h-l|0,((0|m)<0)<<31>>31),g=0|T(),n=0|i[(u=o)>>2],u=0|i[u+4>>2],r=0|hn(7,0,0|(c=3*(a-l|0)|0)),u&=~T(),c=0|hn(0|(p=0|on(0|e,0|t,0|m,0|g)),0|(f=0|T()),0|c),u=0|T()|u,i[(d=o)>>2]=c|n&~r,i[d+4>>2]=u,e=0|nn(0|e,0|t,0|(g=0|sn(0|p,0|f,0|m,0|g)),0|T()),t=0|T(),(0|h)<=(0|l)){t=0;break}l=l+1|0}return R=s,0|t},_compactCells:function(e,t,n,r){t|=0;var a,o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0,w=0,S=0,M=0,E=0,P=0,N=0,k=0,R=0;if(0==(0|(n|=0))&0==(0|(r|=0)))return 0|(R=0);if(s=0|i[(o=e|=0)>>2],!0&0==(15728640&(o=0|i[o+4>>2]))){if(!((0|r)>0|0==(0|r)&n>>>0>0))return 0|(R=0);if(i[(R=t)>>2]=s,i[R+4>>2]=o,1==(0|n)&0==(0|r))return 0|(R=0);o=1,s=0;do{k=0|i[(N=e+(o<<3)|0)+4>>2],i[(R=t+(o<<3)|0)>>2]=i[N>>2],i[R+4>>2]=k,o=0|tn(0|o,0|s,1,0),s=0|T()}while((0|s)<(0|r)|(0|s)==(0|r)&o>>>0<n>>>0);return 0|(o=0)}if(!(k=0|Zt(a=n<<3)))return 0|(R=13);if(vn(0|k,0|e,0|a),!(N=0|en(n,8)))return Jt(k),0|(R=13);e:for(;;){E=0|dn(0|(d=0|i[(o=k)>>2]),0|(o=0|i[o+4>>2]),52),T(),P=(E&=15)+-1|0,M=0!=(0|E),S=(0|r)>0|0==(0|r)&n>>>0>0;t:do{if(M&S){if(b=0|hn(0|P,0,52),x=0|T(),P>>>0>15){if(!(0==(0|d)&0==(0|o))){R=16;break e}for(s=0,e=0;;){if(s=0|tn(0|s,0|e,1,0),!((0|(e=0|T()))<(0|r)|(0|e)==(0|r)&s>>>0<n>>>0))break t;if(!(0==(0|(w=0|i[(l=k+(s<<3)|0)>>2]))&0==(0|(l=0|i[l+4>>2])))){o=l,R=16;break e}}}for(c=d,e=o,s=0,l=0;;){if(!(0==(0|c)&0==(0|e))){if(!(!0&0==(117440512&e))){R=21;break e}if(h=0|dn(0|c,0|e,52),T(),(0|(h&=15))<(0|P)){o=12,R=27;break e}if((0|h)!=(0|P)&&(c|=b,e=-15728641&e|x,h>>>0>=E>>>0)){u=P;do{w=0|hn(7,0,3*(14-u|0)|0),u=u+1|0,c|=w,e=0|T()|e}while(u>>>0<h>>>0)}if(f=0|cn(0|c,0|e,0|n,0|r),m=0|T(),!(0==(0|(p=0|i[(h=u=N+(f<<3)|0)>>2]))&0==(0|(h=0|i[h+4>>2])))){A=0,y=0;do{if((0|A)>(0|r)|(0|A)==(0|r)&y>>>0>n>>>0){R=31;break e}if((0|p)==(0|c)&(-117440513&h)==(0|e)){g=0|dn(0|p,0|h,56),T(),v=(g&=7)+1|0,w=0|dn(0|p,0|h,45),T();n:do{if(0|V(127&w)){if(p=0|dn(0|p,0|h,52),T(),!(p&=15)){h=6;break}for(h=1;;){if(!(0==((w=0|hn(7,0,3*(15-h|0)|0))&c|0)&0==((0|T())&e))){h=7;break n}if(!(h>>>0<p>>>0)){h=6;break}h=h+1|0}}else h=7}while(0);if((g+2|0)>>>0>h>>>0){R=41;break e}w=0|hn(0|v,0,56),e=T()|-117440513&e,i[(_=u)>>2]=0,i[_+4>>2]=0,c|=w}else f=0|ln(0|(f=0|tn(0|f,0|m,1,0)),0|T(),0|n,0|r),m=0|T();y=0|tn(0|y,0|A,1,0),A=0|T(),p=0|i[(h=u=N+(f<<3)|0)>>2],h=0|i[h+4>>2]}while(!(0==(0|p)&0==(0|h)))}i[(w=u)>>2]=c,i[w+4>>2]=e}if(s=0|tn(0|s,0|l,1,0),!((0|(l=0|T()))<(0|r)|(0|l)==(0|r)&s>>>0<n>>>0))break t;c=0|i[(e=k+(s<<3)|0)>>2],e=0|i[e+4>>2]}}}while(0);if(w=0|tn(0|n,0|r,5,0),(_=0|T())>>>0<0|0==(0|_)&w>>>0<11){R=85;break}if(w=0|on(0|n,0|r,6,0),T(),!(w=0|en(w,8))){R=48;break}do{if(S){for(v=0,e=0,g=0,A=0;;){if(0==(0|(s=0|i[(l=h=N+(v<<3)|0)>>2]))&0==(0|(l=0|i[l+4>>2])))_=g;else{p=0|dn(0|s,0|l,56),T(),c=(p&=7)+1|0,f=-117440513&l,_=0|dn(0|s,0|l,45),T();t:do{if(0|V(127&_)){if(m=0|dn(0|s,0|l,52),T(),0|(m&=15))for(u=1;;){if(!(0==(s&(_=0|hn(7,0,3*(15-u|0)|0))|0)&0==(f&(0|T()))))break t;if(!(u>>>0<m>>>0))break;u=u+1|0}s|=l=0|hn(0|c,0,56),l=0|T()|f,i[(c=h)>>2]=s,i[c+4>>2]=l,c=p+2|0}}while(0);7==(0|c)?(i[(_=w+(e<<3)|0)>>2]=s,i[_+4>>2]=-117440513&l,e=0|tn(0|e,0|g,1,0),_=0|T()):_=g}if(v=0|tn(0|v,0|A,1,0),!((0|(A=0|T()))<(0|r)|(0|A)==(0|r)&v>>>0<n>>>0))break;g=_}if(S){if(y=P>>>0>15,b=0|hn(0|P,0,52),x=0|T(),!M){for(s=0,u=0,c=0,l=0;0==(0|d)&0==(0|o)||(i[(P=t+(s<<3)|0)>>2]=d,i[P+4>>2]=o,s=0|tn(0|s,0|u,1,0),u=0|T()),c=0|tn(0|c,0|l,1,0),(0|(l=0|T()))<(0|r)|(0|l)==(0|r)&c>>>0<n>>>0;)d=0|i[(o=k+(c<<3)|0)>>2],o=0|i[o+4>>2];o=_;break}for(s=0,u=0,l=0,c=0;;){do{if(!(0==(0|d)&0==(0|o))){if(m=0|dn(0|d,0|o,52),T(),y|(0|(m&=15))<(0|P)){R=80;break e}if((0|m)!=(0|P)){if(h=d|b,p=-15728641&o|x,m>>>0>=E>>>0){f=P;do{M=0|hn(7,0,3*(14-f|0)|0),f=f+1|0,h|=M,p=0|T()|p}while(f>>>0<m>>>0)}}else h=d,p=o;g=0|cn(0|h,0|p,0|n,0|r),f=0,m=0,A=0|T();do{if((0|f)>(0|r)|(0|f)==(0|r)&m>>>0>n>>>0){R=81;break e}if((-117440513&(v=0|i[(M=N+(g<<3)|0)+4>>2]))==(0|p)&&(0|i[M>>2])==(0|h)){R=65;break}g=0|ln(0|(M=0|tn(0|g,0|A,1,0)),0|T(),0|n,0|r),A=0|T(),m=0|tn(0|m,0|f,1,0),f=0|T(),M=N+(g<<3)|0}while((0|i[M>>2])!=(0|h)||(0|i[M+4>>2])!=(0|p));if(65==(0|R)&&(R=0,!0&100663296==(117440512&v)))break;i[(M=t+(s<<3)|0)>>2]=d,i[M+4>>2]=o,s=0|tn(0|s,0|u,1,0),u=0|T()}}while(0);if(l=0|tn(0|l,0|c,1,0),!((0|(c=0|T()))<(0|r)|(0|c)==(0|r)&l>>>0<n>>>0))break;d=0|i[(o=k+(l<<3)|0)>>2],o=0|i[o+4>>2]}o=_}else s=0,o=_}else s=0,e=0,o=0}while(0);if(An(0|N,0,0|a),vn(0|k,0|w,e<<3),Jt(w),0==(0|e)&0==(0|o)){R=89;break}t=t+(s<<3)|0,r=o,n=e}if(16==(0|R))!0&0==(117440512&o)?(o=4,R=27):R=21;else if(31==(0|R))C(27795,27122,620,27132);else{if(41==(0|R))return Jt(k),Jt(N),0|(R=10);if(48==(0|R))return Jt(k),Jt(N),0|(R=13);80==(0|R)?C(27795,27122,711,27132):81==(0|R)?C(27795,27122,723,27132):85==(0|R)&&(vn(0|t,0|k,n<<3),R=89)}return 21==(0|R)?(Jt(k),Jt(N),0|(R=5)):27==(0|R)?(Jt(k),Jt(N),0|(R=o)):89==(0|R)?(Jt(k),Jt(N),0|(R=0)):0},_constructCell:function(e,t,n,a){n|=0,a|=0;var o=0,s=0,l=0,c=0,u=0,d=0;if((e|=0)>>>0>15)return 0|(a=4);if((t|=0)>>>0>121)return 0|(a=17);l=0|hn(0|e,0,52),o=0|T(),c=0|hn(0|t,0,45),o=0|o|T()|134225919;e:do{if((0|e)>=1){for(c=1,l=0!=(0|r[20528+t|0]),s=-1;;){if((t=0|i[n+(c+-1<<2)>>2])>>>0>6){o=18,t=10;break}if(!(0==(0|t)|1^l)){if(1==(0|t)){o=19,t=10;break}l=0}if(u=0|hn(7,0,0|(d=3*(15-c|0)|0)),o&=~T(),s=(t=0|hn(0|t,((0|t)<0)<<31>>31,0|d))|s&~u,o=0|T()|o,!((0|c)<(0|e)))break e;c=c+1|0}if(10==(0|t))return 0|o}else s=-1}while(0);return i[(d=a)>>2]=s,i[d+4>>2]=o,0|(d=0)},_destroyLinkedMultiPolygon:bt,_directedEdgeToBoundary:ke,_directedEdgeToCells:function(e,t,n){e|=0;var r,a,o,s=0;return r=R,R=R+16|0,s=r,!0&268435456==(2013265920&(t|=0))?(a=-2130706433&t|134217728,i[(o=n|=0)>>2]=e,i[o+4>>2]=a,i[s>>2]=0,t=0|dn(0|e,0|t,56),T(),s=0|I(e,a,7&t,s,n+8|0),R=r,0|s):(R=r,0|(s=6))},_edgeLengthKm:function(e,t,n){n|=0;var r,o=0,s=0,l=0,c=0,d=0,f=0,m=0;if(r=R,R=R+176|0,0|(e=0|ke(e|=0,t|=0,c=r)))return c=e,l=+a[n>>3],l*=6371.007180918475,a[n>>3]=l,R=r,0|c;if(a[n>>3]=0,(0|(e=0|i[c>>2]))<=1)return c=0,l=0,l*=6371.007180918475,a[n>>3]=l,R=r,0|c;t=e+-1|0,e=0,o=+a[c+8>>3],s=+a[c+16>>3],l=0;do{f=o,o=+a[c+8+((e=e+1|0)<<4)>>3],m=+p(.5*(o-f)),d=s,s=+a[c+8+(e<<4)+8>>3],d=m*m+(d=+p(.5*(s-d)))*(+h(+f)*+h(+o)*d),l+=2*+A(+ +u(+d),+ +u(+(1-d)))}while((0|e)!=(0|t));return a[n>>3]=l,c=0,m=l,m*=6371.007180918475,a[n>>3]=m,R=r,0|c},_edgeLengthM:function(e,t,n){n|=0;var r,o=0,s=0,l=0,c=0,d=0,f=0,m=0;if(r=R,R=R+176|0,0|(e=0|ke(e|=0,t|=0,c=r)))return c=e,l=+a[n>>3],l*=6371.007180918475,l*=1e3,a[n>>3]=l,R=r,0|c;if(a[n>>3]=0,(0|(e=0|i[c>>2]))<=1)return c=0,l=0,l*=6371.007180918475,l*=1e3,a[n>>3]=l,R=r,0|c;t=e+-1|0,e=0,o=+a[c+8>>3],s=+a[c+16>>3],l=0;do{f=o,o=+a[c+8+((e=e+1|0)<<4)>>3],m=+p(.5*(o-f)),d=s,s=+a[c+8+(e<<4)+8>>3],d=m*m+(d=+p(.5*(s-d)))*(+h(+f)*+h(+o)*d),l+=2*+A(+ +u(+d),+ +u(+(1-d)))}while((0|e)!=(0|t));return a[n>>3]=l,c=0,m=l,m*=6371.007180918475,m*=1e3,a[n>>3]=m,R=r,0|c},_edgeLengthRads:function(e,t,n){n|=0;var r,o=0,s=0,l=0,c=0,d=0,f=0,m=0;if(r=R,R=R+176|0,0|(e=0|ke(e|=0,t|=0,c=r)))return R=r,0|(c=e);if(a[n>>3]=0,(0|(e=0|i[c>>2]))<=1)return R=r,0|(c=0);t=e+-1|0,e=0,o=+a[c+8>>3],s=+a[c+16>>3],l=0;do{f=o,o=+a[c+8+((e=e+1|0)<<4)>>3],m=+p(.5*(o-f)),d=s,s=+a[c+8+(e<<4)+8>>3],d=m*m+(d=+p(.5*(s-d)))*(+h(+o)*+h(+f)*d),l+=2*+A(+ +u(+d),+ +u(+(1-d)))}while((0|e)<(0|t));return a[n>>3]=l,R=r,0|(c=0)},_emscripten_replace_memory:function(e){return r=new Int8Array(e),new Uint8Array(e),i=new Int32Array(e),new Float32Array(e),a=new Float64Array(e),n=e,!0},_free:Jt,_getBaseCellNumber:Ue,_getDirectedEdgeDestination:function(e,t,n){e|=0,t|=0,n|=0;var r,a,o=0;return r=R,R=R+16|0,i[(o=r)>>2]=0,!0&268435456==(2013265920&t)?(a=0|dn(0|e,0|t,56),T(),o=0|I(e,-2130706433&t|134217728,7&a,o,n),R=r,0|o):(R=r,0|(o=6))},_getDirectedEdgeOrigin:function(e,t,n){return e|=0,n|=0,!0&268435456==(2013265920&(t|=0))?(i[n>>2]=e,i[n+4>>2]=-2130706433&t|134217728,0|(n=0)):0|(n=6)},_getHexagonAreaAvgKm2:ft,_getHexagonAreaAvgM2:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(a[t>>3]=+a[20784+(e<<3)>>3],0|(t=0))},_getHexagonEdgeLengthAvgKm:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(a[t>>3]=+a[20912+(e<<3)>>3],0|(t=0))},_getHexagonEdgeLengthAvgM:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(a[t>>3]=+a[21040+(e<<3)>>3],0|(t=0))},_getIcosahedronFaces:function e(t,n,r){r|=0;var a,o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0;a=R,R=R+128|0,h=a+112|0,l=a+96|0,p=a,s=0|dn(0|(t|=0),0|(n|=0),52),T(),u=15&s,i[h>>2]=u,c=0|dn(0|t,0|n,45),T(),c&=127;e:do{if(0|V(c)){if(0|u)for(o=1;;){if(!(0==((d=0|hn(7,0,3*(15-o|0)|0))&t|0)&0==((0|T())&n))){s=0;break e}if(!(o>>>0<u>>>0))break;o=o+1|0}if(!(1&s))return d=0|hn(u+1|0,0,52),p=T()|-15728641&n,p=0|e((d|t)&~(h=0|hn(7,0,3*(14-u|0)|0)),p&~T(),r),R=a,0|p;s=1}else s=0}while(0);if(!(o=0|rt(t,n,l))){s?(De(l,h,p),d=5):(ze(l,h,p),d=6);e:do{if(0|V(c))if(u)for(o=1;;){if(!(0==((c=0|hn(7,0,3*(15-o|0)|0))&t|0)&0==((0|T())&n))){t=2;break e}if(!(o>>>0<u>>>0)){t=5;break}o=o+1|0}else t=5;else t=2}while(0);An(0|r,-1,t<<2);e:do{if(s)for(l=0;;){if(Be(c=p+(l<<4)|0,0|i[h>>2]),c=0|i[c>>2],-1==(0|(u=0|i[r>>2]))|(0|u)==(0|c))o=r;else{s=0;do{if((s=s+1|0)>>>0>=t>>>0){o=1;break e}u=0|i[(o=r+(s<<2)|0)>>2]}while(!(-1==(0|u)|(0|u)==(0|c)))}if(i[o>>2]=c,(l=l+1|0)>>>0>=d>>>0){o=0;break}}else for(l=0;;){if(Ie(c=p+(l<<4)|0,0|i[h>>2],0,1),c=0|i[c>>2],-1==(0|(u=0|i[r>>2]))|(0|u)==(0|c))o=r;else{s=0;do{if((s=s+1|0)>>>0>=t>>>0){o=1;break e}u=0|i[(o=r+(s<<2)|0)>>2]}while(!(-1==(0|u)|(0|u)==(0|c)))}if(i[o>>2]=c,(l=l+1|0)>>>0>=d>>>0){o=0;break}}}while(0)}return R=a,0|(p=o)},_getIndexDigit:function(e,t,n,r){return r|=0,((n|=0)+-1|0)>>>0>14?0|(r=4):(n=0|dn(0|(e|=0),0|(t|=0),3*(15-n|0)|0),T(),i[r>>2]=7&n,0|(r=0))},_getNumCells:mt,_getPentagons:ot,_getRes0Cells:function(e){e|=0;var t=0,n=0,r=0;t=0;do{hn(0|t,0,45),r=134225919|T(),i[(n=e+(t<<3)|0)>>2]=-1,i[n+4>>2]=r,t=t+1|0}while(122!=(0|t));return 0},_getResolution:function(e,t){return t=0|dn(0|(e|=0),0|(t|=0),52),T(),15&t},_greatCircleDistanceKm:pt,_greatCircleDistanceM:function(e,t){e|=0;var n,r,i,o=0;return r=+a[(t|=0)>>3],n=+a[e>>3],o=(i=+p(.5*(r-n)))*i+(o=+p(.5*(+a[t+8>>3]-+a[e+8>>3])))*(+h(+r)*+h(+n)*o),2*+A(+ +u(+o),+ +u(+(1-o)))*6371.007180918475*1e3},_greatCircleDistanceRads:function(e,t){e|=0;var n,r,i,o=0;return r=+a[(t|=0)>>3],n=+a[e>>3],o=(i=+p(.5*(r-n)))*i+(o=+p(.5*(+a[t+8>>3]-+a[e+8>>3])))*(+h(+r)*+h(+n)*o),2*+A(+ +u(+o),+ +u(+(1-o)))},_gridDisk:L,_gridDiskDistances:O,_gridDistance:function(e,t,n,r,a){n|=0,r|=0,a|=0;var o,s,l=0,c=0;return s=R,R=R+32|0,c=s,0|(o=0|wt(e|=0,t|=0,e,t,l=s+12|0))?(R=s,0|(c=o)):0|(e=0|wt(e,t,n,r,c))?(R=s,0|(c=e)):(l=0|Te(l,c),i[(c=a)>>2]=l,i[c+4>>2]=((0|l)<0)<<31>>31,R=s,0|(c=0))},_gridPathCells:function(e,t,n,r,a){n|=0,r|=0,a|=0;var o,s,l=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0,w=0,S=0,M=0,E=0;if(s=R,R=R+48|0,u=s+12|0,M=s,!(l=0|wt(e|=0,t|=0,e,t,o=s+24|0))&&!(l=0|wt(e,t,n,r,u))){S=((0|(w=0|Te(o,u)))<0)<<31>>31,i[o>>2]=0,i[o+4>>2]=0,i[o+8>>2]=0,i[u>>2]=0,i[u+4>>2]=0,i[u+8>>2]=0,0|wt(e,t,e,t,o)&&C(27795,27538,692,27747),0|wt(e,t,n,r,u)&&C(27795,27538,697,27747),Ee(o),Ee(u),f=0==(0|w)?0:1/+(0|w),n=0|i[o>>2],y=f*+((0|i[u>>2])-n|0),r=0|i[(b=o+4|0)>>2],x=f*+((0|i[u+4>>2])-r|0),l=0|i[(_=o+8|0)>>2],f*=+((0|i[u+8>>2])-l|0),i[M>>2]=n,i[(m=M+4|0)>>2]=r,i[(g=M+8|0)>>2]=l;e:do{if((0|w)<0)l=0;else for(v=0,A=0;;){E=y*(h=+(A>>>0)+4294967296*+(0|v))+ +(0|n),d=x*h+ +(0|r),h=f*h+ +(0|l),n=~~+gn(+E),u=~~+gn(+d),l=~~+gn(+h),E=+c(+(+(0|n)-E)),d=+c(+(+(0|u)-d)),h=+c(+(+(0|l)-h));do{if(!(E>d&E>h)){if(p=0-n|0,d>h){r=p-l|0;break}r=u,l=p-u|0;break}n=0-(u+l)|0,r=u}while(0);if(i[M>>2]=n,i[m>>2]=r,i[g>>2]=l,Pe(M),0|(l=0|St(e,t,M,a+(A<<3)|0)))break e;if(!((0|v)<(0|S)|(0|v)==(0|S)&A>>>0<w>>>0)){l=0;break e}n=0|tn(0|A,0|v,1,0),v=r=0|T(),A=n,n=0|i[o>>2],r=0|i[b>>2],l=0|i[_>>2]}}while(0);return R=s,0|(M=l)}return R=s,0|(M=l)},_gridPathCellsSize:function(e,t,n,r,a){n|=0,r|=0,a|=0;var o,s=0,l=0,c=0;return o=R,R=R+32|0,c=o,(s=0|wt(e|=0,t|=0,e,t,l=o+12|0))||(s=0|wt(e,t,n,r,c))?(R=o,0|(c=s)):(r=0|tn(0|(r=0|Te(l,c)),((0|r)<0)<<31>>31,1,0),l=0|T(),i[(c=a)>>2]=r,i[c+4>>2]=l,R=o,0|(c=0))},_gridRing:function(e,t,n,r){return 0|B(e|=0,t|=0,n|=0,r|=0)?(An(0|r,0,48*n|0),0|(r=0|F(e,t,n,r))):0|(r=0)},_gridRingUnsafe:B,_i64Add:tn,_i64Subtract:nn,_isPentagon:He,_isResClassIII:function(e,t){return t=0|dn(0|(e|=0),0|(t|=0),52),T(),1&t},_isValidCell:Ve,_isValidDirectedEdge:Ne,_isValidIndex:function(e,t){e|=0;var n=0,i=0,a=0,o=0;if(!0&134217728==(-16777216&(t|=0))&&(i=0|dn(0|e,0|t,52),T(),i&=15,n=0|dn(0|e,0|t,45),T(),(n&=127)>>>0<=121)&&0==(613566756&(o=0|hn(0|(a=0|dn(0|e,0|t,0|(o=3*(15^i)|0))),0|T(),0|o))&(0|nn(-1227133514,-1171,0|o,0|(a=0|T()))))&0==(4681&a&T())&&15==(0|i)|0==(0|(o=0|dn(0|(0|hn(0|~e,0|~t,0|(o=19+(3*i|0)|0))),0|T(),0|o)))&0==(0|T())){if(!(0|r[20528+n|0]))return 0|(o=1);if(0==(0|e)&0==(0|(n=8191&t)))return 0|(o=1);if(o=0|pn(0|e,0|n,0),T(),(63-o|0)%3|0)return 0|(o=1)}return 0|Ne(e,t)?0|(o=1):0|(o=0!=(0|Gt(e,t))&1)},_isValidVertex:Gt,_latLngToCell:tt,_llvm_ctlz_i64:pn,_llvm_maxnum_f64:fn,_llvm_minnum_f64:mn,_llvm_round_f64:gn,_localIjToCell:function(e,t,n,r,i){var a,o;return e|=0,t|=0,n|=0,i|=0,o=R,R=R+16|0,a=o,(r|=0)?n=15:(n=0|Me(n,a))||(n=0|St(e,t,a,i)),R=o,0|n},_malloc:Zt,_maxFaceCount:function(e,t,n){n|=0;var r=0,a=0;if(a=0|dn(0|(e|=0),0|(t|=0),45),T(),!(0|V(127&a)))return a=2,i[n>>2]=a,0;if(a=0|dn(0|e,0|t,52),T(),!(a&=15))return a=5,i[n>>2]=a,0;for(r=1;;){if(!(0==((0|hn(7,0,3*(15-r|0)|0))&e|0)&0==((0|T())&t))){r=2,e=6;break}if(!(r>>>0<a>>>0)){r=5,e=6;break}r=r+1|0}return 6==(0|e)?(i[n>>2]=r,0):0},_maxGridDiskSize:function(e,t){t|=0;var n=0,r=0,a=0;return(0|(e|=0))<0?0|(t=2):(0|e)>13780509?0|(t=0|mt(15,t)):(a=0|sn(0|e,0|(n=((0|e)<0)<<31>>31),3,0),r=0|T(),n=0|tn(0|e,0|n,1,0),n=0|tn(0|(n=0|sn(0|a,0|r,0|n,0|T())),0|T(),1,0),e=0|T(),i[t>>2]=n,i[t+4>>2]=e,0|(t=0))},_maxPolygonToCellsSize:function(e,t,n,r){e|=0,t|=0,r|=0;var a,o=0,s=0,l=0,c=0,u=0;if(a=R,R=R+48|0,o=a+16|0,s=a+8|0,l=a,0|(n=0|Rt(n|=0)))return R=a,0|(l=n);if(c=0|i[(u=e)+4>>2],i[(n=s)>>2]=i[u>>2],i[n+4>>2]=c,kt(s,o),!(n=0|ne(o,t,l))){if(t=0|i[s>>2],(0|(s=0|i[e+8>>2]))>0){o=0|i[e+12>>2],n=0;do{t=(0|i[o+(n<<3)>>2])+t|0,n=n+1|0}while((0|n)<(0|s))}o=0|i[(n=l)>>2],(0|(n=0|i[n+4>>2]))<(0|(s=((0|t)<0)<<31>>31))|(0|n)==(0|s)&o>>>0<t>>>0?(i[(n=l)>>2]=t,i[n+4>>2]=s,n=s):t=o,c=0|tn(0|t,0|n,12,0),u=0|T(),i[(n=l)>>2]=c,i[n+4>>2]=u,i[(n=r)>>2]=c,i[n+4>>2]=u,n=0}return R=a,0|(u=n)},_maxPolygonToCellsSizeExperimental:function(e,t,n,o){t|=0,n|=0,o|=0;var s,l,u=0,d=0,p=0,f=0,m=0,g=0,v=0,A=0;if(l=R,R=R+48|0,m=l+32|0,f=l+40|0,s=l,!(0|i[(e|=0)>>2]))return i[(g=o)>>2]=0,i[g+4>>2]=0,R=l,0|(g=0);Ge(m,0,0,0),u=0|i[(p=m)>>2],p=0|i[p+4>>2];do{if(t>>>0>15)i[(g=s)>>2]=0,i[g+4>>2]=0,i[s+8>>2]=4,i[s+12>>2]=-1,n=s+29|0,i[(g=s+16|0)>>2]=0,i[g+4>>2]=0,i[g+8>>2]=0,r[g+12|0]=0,r[n|0]=0|r[f|0],r[n+1|0]=0|r[f+1|0],r[n+2|0]=0|r[f+2|0],n=4,g=9;else{if(0|(n=0|Rt(n))){i[(m=s)>>2]=0,i[m+4>>2]=0,i[s+8>>2]=n,i[s+12>>2]=-1,g=s+29|0,i[(m=s+16|0)>>2]=0,i[m+4>>2]=0,i[m+8>>2]=0,r[m+12|0]=0,r[g|0]=0|r[f|0],r[g+1|0]=0|r[f+1|0],r[g+2|0]=0|r[f+2|0],g=9;break}if(!(n=0|en(1+(0|i[e+8>>2])|0,32))){i[(g=s)>>2]=0,i[g+4>>2]=0,i[s+8>>2]=13,i[s+12>>2]=-1,n=s+29|0,i[(g=s+16|0)>>2]=0,i[g+4>>2]=0,i[g+8>>2]=0,r[g+12|0]=0,r[n|0]=0|r[f|0],r[n+1|0]=0|r[f+1|0],r[n+2|0]=0|r[f+2|0],n=13,g=9;break}Lt(e,n),i[(A=s)>>2]=u,i[A+4>>2]=p,i[(p=s+8|0)>>2]=0,i[s+12>>2]=t,i[s+20>>2]=e,i[s+24>>2]=n,r[s+28|0]=0,r[(u=s+29|0)|0]=0|r[f|0],r[u+1|0]=0|r[f+1|0],r[u+2|0]=0|r[f+2|0],i[s+16>>2]=3,v=+Q(n),v*=+X(n),d=+c(+ +a[n>>3]),d=v/+h(+ +mn(+d,+ +c(+ +a[n+8>>3])))*6371.007180918475*6371.007180918475,n=0|i[(u=s+12|0)>>2];e:do{if((0|n)>0)do{if(ft(n+-1|0,m),!(d/+a[m>>3]>10))break e;n=(A=0|i[u>>2])+-1|0,i[u>>2]=n}while((0|A)>1)}while(0);if(Et(s),i[(u=o)>>2]=0,i[u+4>>2]=0,!(0==(0|(n=0|i[(u=s)>>2]))&0==(0|(u=0|i[u+4>>2]))))do{We(n,u,t,m),f=m,f=0|tn(0|i[(e=o)>>2],0|i[e+4>>2],0|i[f>>2],0|i[f+4>>2]),e=0|T(),i[(A=o)>>2]=f,i[A+4>>2]=e,Et(s),n=0|i[(A=s)>>2],u=0|i[A+4>>2]}while(!(0==(0|n)&0==(0|u)));n=0|i[p>>2]}}while(0);return R=l,0|(A=n)},_memcpy:vn,_memset:An,_originToDirectedEdges:function(e,t,n){n|=0;var r,a=0;return r=0==(0|He(e|=0,t|=0)),t&=-2130706433,i[(a=n)>>2]=r?e:0,i[a+4>>2]=r?285212672|t:0,i[(a=n+8|0)>>2]=e,i[a+4>>2]=301989888|t,i[(a=n+16|0)>>2]=e,i[a+4>>2]=318767104|t,i[(a=n+24|0)>>2]=e,i[a+4>>2]=335544320|t,i[(a=n+32|0)>>2]=e,i[a+4>>2]=352321536|t,i[(n=n+40|0)>>2]=e,i[n+4>>2]=369098752|t,0},_pentagonCount:function(){return 12},_polygonToCells:function(e,t,n,r){e|=0,t|=0,r|=0;var a,o,s,l,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,A=0,y=0,b=0,x=0,_=0,w=0,S=0,C=0,M=0,E=0,P=0,N=0,k=0,L=0,O=0,I=0,B=0,F=0;if(l=R,R=R+112|0,a=l+80|0,p=l+72|0,o=l,s=l+56|0,0|(c=0|Rt(n|=0)))return R=l,0|(F=c);if(!(F=0|Zt(32+(i[(f=e+8|0)>>2]<<5)|0)))return R=l,0|(F=13);if(Lt(e,F),!(c=0|Rt(n))){if(B=0|i[(I=e)+4>>2],i[(c=p)>>2]=i[I>>2],i[c+4>>2]=B,kt(p,a),c=0|ne(a,t,o))I=0,B=0;else{if(c=0|i[p>>2],(0|(u=0|i[f>>2]))>0){d=0|i[e+12>>2],n=0;do{c=(0|i[d+(n<<3)>>2])+c|0,n=n+1|0}while((0|n)!=(0|u));n=c}else n=c;u=0|i[(c=o)>>2],(0|(c=0|i[c+4>>2]))<(0|(d=((0|n)<0)<<31>>31))|(0|c)==(0|d)&u>>>0<n>>>0?(i[(c=o)>>2]=n,i[c+4>>2]=d,c=d):n=u,I=0|tn(0|n,0|c,12,0),B=0|T(),i[(c=o)>>2]=I,i[c+4>>2]=B,c=0}if(!c){if(!(n=0|en(I,8)))return Jt(F),R=l,0|(F=13);if(!(h=0|en(I,8)))return Jt(F),Jt(n),R=l,0|(F=13);i[(L=a)>>2]=0,i[L+4>>2]=0,O=0|i[(L=e)+4>>2],i[(c=p)>>2]=i[L>>2],i[c+4>>2]=O,c=0|U(p,I,B,t,a,n,h);e:do{if(c)Jt(n),Jt(h),Jt(F);else{t:do{if((0|i[f>>2])>0){for(d=e+12|0,u=0;c=0|U((0|i[d>>2])+(u<<3)|0,I,B,t,a,n,h),u=u+1|0,!(0|c);)if((0|u)>=(0|i[f>>2]))break t;Jt(n),Jt(h),Jt(F);break e}}while(0);(0|B)>0|0==(0|B)&I>>>0>0&&An(0|h,0,I<<3),L=0|i[(O=a)+4>>2];t:do{if((0|L)>0|0==(0|L)&(0|i[O>>2])>>>0>0){P=n,N=h,k=n,L=h,O=n,c=n,C=n,M=h,E=h,n=h;n:for(;;){for(x=0,_=0,w=0,S=0,u=0,d=0;;){p=(h=o)+56|0;do{i[h>>2]=0,h=h+4|0}while((0|h)<(0|p));if(0|j(f=0|i[(t=P+(x<<3)|0)>>2],t=0|i[t+4>>2],1,o,0)){p=(h=o)+56|0;do{i[h>>2]=0,h=h+4|0}while((0|h)<(0|p));0|(h=0|en(7,4))&&(D(f,t,1,o,h,7,0,0),Jt(h))}for(b=0;;){A=0|i[(y=o+(b<<3)|0)>>2],y=0|i[y+4>>2];r:do{if(0==(0|A)&0==(0|y))h=u,p=d;else{if(m=0|cn(0|A,0|y,0|I,0|B),f=0|T(),!(0==(0|(p=0|i[(t=h=r+(m<<3)|0)>>2]))&0==(0|(t=0|i[t+4>>2])))){g=0,v=0;do{if((0|g)>(0|B)|(0|g)==(0|B)&v>>>0>I>>>0)break n;if((0|p)==(0|A)&(0|t)==(0|y)){h=u,p=d;break r}m=0|ln(0|(h=0|tn(0|m,0|f,1,0)),0|T(),0|I,0|B),f=0|T(),v=0|tn(0|v,0|g,1,0),g=0|T(),p=0|i[(t=h=r+(m<<3)|0)>>2],t=0|i[t+4>>2]}while(!(0==(0|p)&0==(0|t)))}if(0==(0|A)&0==(0|y)){h=u,p=d;break}it(A,y,s),0|Ot(e,F,s)&&(v=0|tn(0|u,0|d,1,0),d=0|T(),i[(g=h)>>2]=A,i[g+4>>2]=y,i[(u=N+(u<<3)|0)>>2]=A,i[u+4>>2]=y,u=v),h=u,p=d}}while(0);if((b=b+1|0)>>>0>=7)break;u=h,d=p}if(x=0|tn(0|x,0|_,1,0),_=0|T(),w=0|tn(0|w,0|S,1,0),S=0|T(),u=0|i[(d=a)>>2],!((0|S)<(0|(d=0|i[d+4>>2]))|(0|S)==(0|d)&w>>>0<u>>>0))break;u=h,d=p}if((0|d)>0|0==(0|d)&u>>>0>0){u=0,d=0;do{i[(S=P+(u<<3)|0)>>2]=0,i[S+4>>2]=0,u=0|tn(0|u,0|d,1,0),d=0|T(),w=0|i[(S=a)+4>>2]}while((0|d)<(0|w)|((0|d)==(0|w)?u>>>0<(0|i[S>>2])>>>0:0))}if(i[(S=a)>>2]=h,i[S+4>>2]=p,!((0|p)>0|0==(0|p)&h>>>0>0))break t;b=n,x=E,_=O,w=M,S=N,n=C,E=c,M=k,C=b,c=x,O=L,L=_,k=w,N=P,P=S}Jt(k),Jt(L),Jt(F),c=1;break e}c=h}while(0);Jt(F),Jt(n),Jt(c),c=0}}while(0);return R=l,0|(F=c)}}return Jt(F),R=l,0|(F=c)},_polygonToCellsExperimental:function(e,t,n,r,a,o){r|=0,a|=0,o|=0;var s,l,c,u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0;c=R,R=R+160|0,d=c+64|0,f=c+112|0,v=c,Mt(p=c+80|0,e|=0,t|=0,n|=0),st(d,0|i[(h=p)>>2],0|i[h+4>>2],t),s=0|i[(h=d)>>2],h=0|i[h+4>>2],u=0|i[p+8>>2],i[(m=f+4|0)>>2]=i[p>>2],i[m+4>>2]=i[p+4>>2],i[m+8>>2]=i[p+8>>2],i[m+12>>2]=i[p+12>>2],i[m+16>>2]=i[p+16>>2],i[m+20>>2]=i[p+20>>2],i[m+24>>2]=i[p+24>>2],i[m+28>>2]=i[p+28>>2],i[(m=v)>>2]=s,i[m+4>>2]=h,i[(m=v+8|0)>>2]=u,t=f,n=(e=v+12|0)+36|0;do{i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0}while((0|e)<(0|n));if(i[(f=v+48|0)>>2]=i[d>>2],i[f+4>>2]=i[d+4>>2],i[f+8>>2]=i[d+8>>2],i[f+12>>2]=i[d+12>>2],0==(0|s)&0==(0|h))return R=c,0|(v=u);n=v+16|0,l=v+24|0,p=v+28|0,u=0,d=0,t=s,e=h;do{if(!((0|u)<(0|a)|(0|u)==(0|a)&d>>>0<r>>>0)){g=4;break}if(h=d,d=0|tn(0|d,0|u,1,0),u=0|T(),i[(h=o+(h<<3)|0)>>2]=t,i[h+4>>2]=e,ct(f),0==(0|(t=0|i[(e=f)>>2]))&0==(0|(e=0|i[e+4>>2]))){if(Et(n),0==(0|(e=0|i[(t=n)>>2]))&0==(0|(t=0|i[t+4>>2]))){g=10;break}lt(e,t,0|i[p>>2],f),t=0|i[(e=f)>>2],e=0|i[e+4>>2]}i[(h=v)>>2]=t,i[h+4>>2]=e}while(!(0==(0|t)&0==(0|e)));return 4==(0|g)?(0|(t=0|i[(e=v+40|0)>>2])&&Jt(t),i[(g=v+16|0)>>2]=0,i[g+4>>2]=0,i[l>>2]=0,i[v+36>>2]=0,i[p>>2]=-1,i[v+32>>2]=0,i[e>>2]=0,lt(0,0,0,f),i[v>>2]=0,i[v+4>>2]=0,i[m>>2]=0,R=c,0|(v=14)):(10==(0|g)&&(i[v>>2]=0,i[v+4>>2]=0,i[m>>2]=i[l>>2]),v=0|i[m>>2],R=c,0|v)},_readInt64AsDoubleFromPointer:function(e){return+(+((0|i[(e|=0)>>2])>>>0)+4294967296*+(0|i[e+4>>2]))},_res0CellCount:function(){return 122},_round:yn,_sbrk:bn,_sizeOfCellBoundary:function(){return 168},_sizeOfCoordIJ:function(){return 8},_sizeOfGeoLoop:function(){return 8},_sizeOfGeoPolygon:function(){return 16},_sizeOfH3Index:function(){return 8},_sizeOfLatLng:function(){return 16},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompactCells:function(e,t,n,r,a,o,s){e|=0,r|=0,a|=0,o|=0;var l,c=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0;if(l=R,R=R+16|0,g=l,!((0|(n|=0))>0|0==(0|n)&(t|=0)>>>0>0))return R=l,0|(g=0);if((0|(s|=0))>=16)return R=l,0|(g=12);f=0,m=0,p=0,c=0;e:for(;;){if(h=0|dn(0|(u=0|i[(d=e+(f<<3)|0)>>2]),0|(d=0|i[d+4>>2]),52),T(),(15&h)>(0|s)){c=12,u=11;break}if(st(g,u,d,s),0==(0|(d=0|i[(h=g)>>2]))&0==(0|(h=0|i[h+4>>2])))u=p;else{u=p;do{if(!((0|c)<(0|o)|(0|c)==(0|o)&u>>>0<a>>>0)){u=10;break e}i[(p=r+(u<<3)|0)>>2]=d,i[p+4>>2]=h,u=0|tn(0|u,0|c,1,0),c=0|T(),ct(g),d=0|i[(p=g)>>2],h=0|i[p+4>>2]}while(!(0==(0|d)&0==(0|h)))}if(f=0|tn(0|f,0|m,1,0),!((0|(m=0|T()))<(0|n)|(0|m)==(0|n)&f>>>0<t>>>0)){c=0,u=11;break}p=u}return 10==(0|u)?(R=l,0|(g=14)):11==(0|u)?(R=l,0|c):0},_uncompactCellsSize:function(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o,s,l=0,c=0,u=0,d=0,h=0,p=0;s=R,R=R+16|0,o=s;e:do{if((0|n)>0|0==(0|n)&t>>>0>0){for(h=0,c=0,l=0,p=0;;){if(!(0==(0|(u=0|i[(d=e+(h<<3)|0)>>2]))&0==(0|(d=0|i[d+4>>2])))&&(d=0==(0|We(u,d,r,o)),c=0|tn(0|i[(u=o)>>2],0|i[u+4>>2],0|c,0|l),l=0|T(),!d)){l=12;break}if(h=0|tn(0|h,0|p,1,0),!((0|(p=0|T()))<(0|n)|(0|p)==(0|n)&h>>>0<t>>>0))break e}return R=s,0|l}c=0,l=0}while(0);return i[a>>2]=c,i[a+4>>2]=l,R=s,0|(a=0)},_vertexToLatLng:function(e,t,n){n|=0;var r,a,o,s,l=0,c=0;return s=R,R=R+192|0,a=s,o=s+168|0,l=0|dn(0|(e|=0),0|(t|=0),56),T(),l&=7,0|(r=0|rt(e,c=-2130706433&t|134217728,o))?(R=s,0|(c=r)):(t=0|dn(0|e,0|t,52),T(),t&=15,0|He(e,c)?je(o,t,l,1,a):Fe(o,t,l,1,a),c=a+8|0,i[n>>2]=i[c>>2],i[n+4>>2]=i[c+4>>2],i[n+8>>2]=i[c+8>>2],i[n+12>>2]=i[c+12>>2],R=s,0|(c=0))},establishStackSpace:function(e,t){R=e|=0},stackAlloc:function(e){var t;return t=R,R=(R=R+(e|=0)|0)+15&-16,0|t},stackRestore:function(e){R=e|=0},stackSave:function(){return 0|R}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},Z,m),ee=(n.___divdi3=J.___divdi3,n.___muldi3=J.___muldi3,n.___remdi3=J.___remdi3,n.___uremdi3=J.___uremdi3,n._areNeighborCells=J._areNeighborCells,n._bitshift64Ashr=J._bitshift64Ashr,n._bitshift64Lshr=J._bitshift64Lshr,n._bitshift64Shl=J._bitshift64Shl,n._calloc=J._calloc,n._cellAreaKm2=J._cellAreaKm2,n._cellAreaM2=J._cellAreaM2,n._cellAreaRads2=J._cellAreaRads2,n._cellToBoundary=J._cellToBoundary,n._cellToCenterChild=J._cellToCenterChild,n._cellToChildPos=J._cellToChildPos,n._cellToChildren=J._cellToChildren,n._cellToChildrenSize=J._cellToChildrenSize,n._cellToLatLng=J._cellToLatLng,n._cellToLocalIj=J._cellToLocalIj,n._cellToParent=J._cellToParent,n._cellToVertex=J._cellToVertex,n._cellToVertexes=J._cellToVertexes,n._cellsToDirectedEdge=J._cellsToDirectedEdge,n._cellsToLinkedMultiPolygon=J._cellsToLinkedMultiPolygon,n._childPosToCell=J._childPosToCell,n._compactCells=J._compactCells,n._constructCell=J._constructCell,n._destroyLinkedMultiPolygon=J._destroyLinkedMultiPolygon,n._directedEdgeToBoundary=J._directedEdgeToBoundary,n._directedEdgeToCells=J._directedEdgeToCells,n._edgeLengthKm=J._edgeLengthKm,n._edgeLengthM=J._edgeLengthM,n._edgeLengthRads=J._edgeLengthRads,n._emscripten_replace_memory=J._emscripten_replace_memory),te=(n._free=J._free,n._getBaseCellNumber=J._getBaseCellNumber,n._getDirectedEdgeDestination=J._getDirectedEdgeDestination,n._getDirectedEdgeOrigin=J._getDirectedEdgeOrigin,n._getHexagonAreaAvgKm2=J._getHexagonAreaAvgKm2,n._getHexagonAreaAvgM2=J._getHexagonAreaAvgM2,n._getHexagonEdgeLengthAvgKm=J._getHexagonEdgeLengthAvgKm,n._getHexagonEdgeLengthAvgM=J._getHexagonEdgeLengthAvgM,n._getIcosahedronFaces=J._getIcosahedronFaces,n._getIndexDigit=J._getIndexDigit,n._getNumCells=J._getNumCells,n._getPentagons=J._getPentagons,n._getRes0Cells=J._getRes0Cells,n._getResolution=J._getResolution,n._greatCircleDistanceKm=J._greatCircleDistanceKm,n._greatCircleDistanceM=J._greatCircleDistanceM,n._greatCircleDistanceRads=J._greatCircleDistanceRads,n._gridDisk=J._gridDisk,n._gridDiskDistances=J._gridDiskDistances,n._gridDistance=J._gridDistance,n._gridPathCells=J._gridPathCells,n._gridPathCellsSize=J._gridPathCellsSize,n._gridRing=J._gridRing,n._gridRingUnsafe=J._gridRingUnsafe,n._i64Add=J._i64Add,n._i64Subtract=J._i64Subtract,n._isPentagon=J._isPentagon,n._isResClassIII=J._isResClassIII,n._isValidCell=J._isValidCell,n._isValidDirectedEdge=J._isValidDirectedEdge,n._isValidIndex=J._isValidIndex,n._isValidVertex=J._isValidVertex,n._latLngToCell=J._latLngToCell,n._llvm_ctlz_i64=J._llvm_ctlz_i64,n._llvm_maxnum_f64=J._llvm_maxnum_f64,n._llvm_minnum_f64=J._llvm_minnum_f64,n._llvm_round_f64=J._llvm_round_f64,n._localIjToCell=J._localIjToCell,n._malloc=J._malloc,n._maxFaceCount=J._maxFaceCount,n._maxGridDiskSize=J._maxGridDiskSize,n._maxPolygonToCellsSize=J._maxPolygonToCellsSize,n._maxPolygonToCellsSizeExperimental=J._maxPolygonToCellsSizeExperimental,n._memcpy=J._memcpy,n._memset=J._memset,n._originToDirectedEdges=J._originToDirectedEdges,n._pentagonCount=J._pentagonCount,n._polygonToCells=J._polygonToCells,n._polygonToCellsExperimental=J._polygonToCellsExperimental,n._readInt64AsDoubleFromPointer=J._readInt64AsDoubleFromPointer,n._res0CellCount=J._res0CellCount,n._round=J._round,n._sbrk=J._sbrk,n._sizeOfCellBoundary=J._sizeOfCellBoundary,n._sizeOfCoordIJ=J._sizeOfCoordIJ,n._sizeOfGeoLoop=J._sizeOfGeoLoop,n._sizeOfGeoPolygon=J._sizeOfGeoPolygon,n._sizeOfH3Index=J._sizeOfH3Index,n._sizeOfLatLng=J._sizeOfLatLng,n._sizeOfLinkedGeoPolygon=J._sizeOfLinkedGeoPolygon,n._uncompactCells=J._uncompactCells,n._uncompactCellsSize=J._uncompactCellsSize,n._vertexToLatLng=J._vertexToLatLng,n.establishStackSpace=J.establishStackSpace,n.stackAlloc=J.stackAlloc),ne=n.stackRestore=J.stackRestore,re=n.stackSave=J.stackSave;if(n.asm=J,n.cwrap=function(e,t,n,r){var i=(n=n||[]).every(function(e){return"number"===e});return"string"!==t&&i&&!r?d(e):function(){return h(e,t,n,arguments)}},n.setValue=function(e,t,n,r){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":g[e|0]=t;break;case"i16":A[e>>1]=t;break;case"i32":y[e>>2]=t;break;case"i64":z=[t>>>0,(F=t,+R(F)>=1?F>0?(0|j(+O(F/4294967296),4294967295))>>>0:~~+L((F-+(~~F>>>0))/4294967296)>>>0:0)],y[e>>2]=z[0],y[e+4>>2]=z[1];break;case"float":b[e>>2]=t;break;case"double":x[e>>3]=t;break;default:ce("invalid type for setValue: "+n)}},n.getValue=function(e,t,n){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return g[e|0];case"i16":return A[e>>1];case"i32":case"i64":return y[e>>2];case"float":return b[e>>2];case"double":return x[e>>3];default:ce("invalid type for getValue: "+t)}return null},U){G(U)||(U=function(e){return n.locateFile?n.locateFile(e,o):o+e}(U)),D++,n.monitorRunDependencies&&n.monitorRunDependencies(D);var ie=function(e){e.byteLength&&(e=new Uint8Array(e)),v.set(e,8),n.memoryInitializerRequest&&delete n.memoryInitializerRequest.response,function(){if(D--,n.monitorRunDependencies&&n.monitorRunDependencies(D),0==D&&(null!==I&&(clearInterval(I),I=null),B)){var e=B;B=null,e()}}()},ae=function(){i(U,ie,function(){throw"could not load memory initializer "+U})},oe=Y(U);if(oe)ie(oe.buffer);else if(n.memoryInitializerRequest){var se=function(){var e=n.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var r=Y(n.memoryInitializerRequestURL);if(!r)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+U),void ae();t=r.buffer}ie(t)};n.memoryInitializerRequest.response?setTimeout(se,0):n.memoryInitializerRequest.addEventListener("load",se)}else ae()}function le(e){function t(){Q||(Q=!0,u||(T(M),T(E),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)k(n.postRun.shift());T(P)}()))}e=e||a,D>0||(!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)N(n.preRun.shift());T(C)}(),D>0||(n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),t()},1)):t()))}function ce(e){throw n.onAbort&&n.onAbort(e),s(e+=""),l(e),u=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(B=function e(){Q||le(),Q||(B=e)},n.run=le,n.abort=ce,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return le(),e}("object"===typeof xoe?xoe:{}),_oe="number",woe={0:"Success",1:"The operation failed but a more specific error is not available",2:"Argument was outside of acceptable range",3:"Latitude or longitude arguments were outside of acceptable range",4:"Resolution argument was outside of acceptable range",5:"Cell argument was not valid",6:"Directed edge argument was not valid",7:"Undirected edge argument was not valid",8:"Vertex argument was not valid",9:"Pentagon distortion was encountered",10:"Duplicate input",11:"Cell arguments were not neighbors",12:"Cell arguments had incompatible resolutions",13:"Memory allocation failed",14:"Bounds of provided memory were insufficient",15:"Mode or flags argument was not valid",16:"Index argument was not valid",17:"Base cell number was outside of acceptable range",18:"Child indexing digits invalid",19:"Child indexing digits refer to a deleted subsequence"},Soe={1e3:"Unknown unit",1001:"Array length out of bounds",1002:"Got unexpected null value for H3 index"};function Toe(e,t,n){var r=n&&"value"in n,i=new Error((e[t]||"Unknown error")+" (code: "+t+(r?", value: "+n.value:"")+")");return i.code=t,i}function Coe(e,t){return Toe(woe,e,2===arguments.length?{value:t}:{})}function Moe(e,t){return Toe(Soe,e,2===arguments.length?{value:t}:{})}function Eoe(e){if(0!==e)throw Coe(e)}var Poe={};[["sizeOfH3Index",_oe],["sizeOfLatLng",_oe],["sizeOfCellBoundary",_oe],["sizeOfGeoLoop",_oe],["sizeOfGeoPolygon",_oe],["sizeOfLinkedGeoPolygon",_oe],["sizeOfCoordIJ",_oe],["readInt64AsDoubleFromPointer",_oe],["isValidCell",_oe,[_oe,_oe]],["isValidIndex",_oe,[_oe,_oe]],["latLngToCell",_oe,[_oe,_oe,_oe,_oe]],["cellToLatLng",_oe,[_oe,_oe,_oe]],["cellToBoundary",_oe,[_oe,_oe,_oe]],["maxGridDiskSize",_oe,[_oe,_oe]],["gridDisk",_oe,[_oe,_oe,_oe,_oe]],["gridDiskDistances",_oe,[_oe,_oe,_oe,_oe,_oe]],["gridRing",_oe,[_oe,_oe,_oe,_oe]],["gridRingUnsafe",_oe,[_oe,_oe,_oe,_oe]],["maxPolygonToCellsSize",_oe,[_oe,_oe,_oe,_oe]],["polygonToCells",_oe,[_oe,_oe,_oe,_oe]],["maxPolygonToCellsSizeExperimental",_oe,[_oe,_oe,_oe,_oe]],["polygonToCellsExperimental",_oe,[_oe,_oe,_oe,_oe,_oe,_oe]],["cellsToLinkedMultiPolygon",_oe,[_oe,_oe,_oe]],["destroyLinkedMultiPolygon",null,[_oe]],["compactCells",_oe,[_oe,_oe,_oe,_oe]],["uncompactCells",_oe,[_oe,_oe,_oe,_oe,_oe,_oe]],["uncompactCellsSize",_oe,[_oe,_oe,_oe,_oe,_oe]],["isPentagon",_oe,[_oe,_oe]],["isResClassIII",_oe,[_oe,_oe]],["getBaseCellNumber",_oe,[_oe,_oe]],["getResolution",_oe,[_oe,_oe]],["getIndexDigit",_oe,[_oe,_oe,_oe]],["constructCell",_oe,[_oe,_oe,_oe,_oe]],["maxFaceCount",_oe,[_oe,_oe,_oe]],["getIcosahedronFaces",_oe,[_oe,_oe,_oe]],["cellToParent",_oe,[_oe,_oe,_oe,_oe]],["cellToChildren",_oe,[_oe,_oe,_oe,_oe]],["cellToCenterChild",_oe,[_oe,_oe,_oe,_oe]],["cellToChildrenSize",_oe,[_oe,_oe,_oe,_oe]],["cellToChildPos",_oe,[_oe,_oe,_oe,_oe]],["childPosToCell",_oe,[_oe,_oe,_oe,_oe,_oe,_oe]],["areNeighborCells",_oe,[_oe,_oe,_oe,_oe,_oe]],["cellsToDirectedEdge",_oe,[_oe,_oe,_oe,_oe,_oe]],["getDirectedEdgeOrigin",_oe,[_oe,_oe,_oe]],["getDirectedEdgeDestination",_oe,[_oe,_oe,_oe]],["isValidDirectedEdge",_oe,[_oe,_oe]],["directedEdgeToCells",_oe,[_oe,_oe,_oe]],["originToDirectedEdges",_oe,[_oe,_oe,_oe]],["directedEdgeToBoundary",_oe,[_oe,_oe,_oe]],["gridDistance",_oe,[_oe,_oe,_oe,_oe,_oe]],["gridPathCells",_oe,[_oe,_oe,_oe,_oe,_oe]],["gridPathCellsSize",_oe,[_oe,_oe,_oe,_oe,_oe]],["cellToLocalIj",_oe,[_oe,_oe,_oe,_oe,_oe,_oe]],["localIjToCell",_oe,[_oe,_oe,_oe,_oe,_oe]],["getHexagonAreaAvgM2",_oe,[_oe,_oe]],["getHexagonAreaAvgKm2",_oe,[_oe,_oe]],["getHexagonEdgeLengthAvgM",_oe,[_oe,_oe]],["getHexagonEdgeLengthAvgKm",_oe,[_oe,_oe]],["greatCircleDistanceM",_oe,[_oe,_oe]],["greatCircleDistanceKm",_oe,[_oe,_oe]],["greatCircleDistanceRads",_oe,[_oe,_oe]],["cellAreaM2",_oe,[_oe,_oe,_oe]],["cellAreaKm2",_oe,[_oe,_oe,_oe]],["cellAreaRads2",_oe,[_oe,_oe,_oe]],["edgeLengthM",_oe,[_oe,_oe,_oe]],["edgeLengthKm",_oe,[_oe,_oe,_oe]],["edgeLengthRads",_oe,[_oe,_oe,_oe]],["getNumCells",_oe,[_oe,_oe]],["getRes0Cells",_oe,[_oe]],["res0CellCount",_oe],["getPentagons",_oe,[_oe,_oe]],["pentagonCount",_oe],["cellToVertex",_oe,[_oe,_oe,_oe,_oe]],["cellToVertexes",_oe,[_oe,_oe,_oe]],["vertexToLatLng",_oe,[_oe,_oe,_oe]],["isValidVertex",_oe,[_oe,_oe]]].forEach(function(e){Poe[e[0]]=xoe.cwrap.apply(xoe,e)});var Noe=16,koe=Poe.sizeOfH3Index(),Roe=Poe.sizeOfLatLng(),Loe=Poe.sizeOfCellBoundary(),Ooe=Poe.sizeOfGeoPolygon(),joe=Poe.sizeOfGeoLoop();Poe.sizeOfLinkedGeoPolygon(),Poe.sizeOfCoordIJ();function Doe(e){if("number"!==typeof e||e<0||e>15||Math.floor(e)!==e)throw Coe(4,e);return e}function Ioe(e){if(!e)throw Moe(1002);return e}var Boe=Math.pow(2,32)-1;function Foe(e){if(e>Boe)throw Moe(1001,e);return e}var zoe=/[^0-9a-fA-F]/;function Uoe(e){if(Array.isArray(e)&&2===e.length&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if("string"!==typeof e||zoe.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),Noe);return[parseInt(e.substring(e.length-8),Noe),t]}function Voe(e){if(e>=0)return e.toString(Noe);var t=Goe(8,(e&=2147483647).toString(Noe));return t=(parseInt(t[0],Noe)+8).toString(Noe)+t.substring(1)}function Goe(e,t){for(var n=e-t.length,r="",i=0;i<n;i++)r+="0";return r+=t}Math.pow(2,32);function qoe(e,t,n){for(var r=e.length,i=xoe._calloc(r,Roe),a=n?1:0,o=n?0:1,s=0;s<2*r;s+=2)xoe.HEAPF64.set([e[s/2][a],e[s/2][o]].map(ise),i/8+s);return xoe.HEAPU32.set([r,i],t/4),t}function Woe(e,t){var n,r=e.length-1,i=xoe._calloc(Ooe),a=0+joe,o=a+4;if(qoe(e[0],i+0,t),r>0){n=xoe._calloc(r,joe);for(var s=0;s<r;s++)qoe(e[s+1],n+joe*s,t)}return xoe.setValue(i+a,r,"i32"),xoe.setValue(i+o,n,"i32"),i}function Hoe(e){var t=0+joe,n=t+4;xoe._free(xoe.getValue(e+0+4,"i8*"));var r=xoe.getValue(e+t,"i32");if(r>0){for(var i=xoe.getValue(e+n,"i32"),a=0;a<r;a++)xoe._free(xoe.getValue(i+joe*a+4,"i8*"));xoe._free(i)}xoe._free(e)}function $oe(e,t){void 0===t&&(t=0);var n=xoe.getValue(e+koe*t,"i32"),r=xoe.getValue(e+koe*t+4,"i32");return r?function(e,t){return Voe(t)+Goe(8,Voe(e))}(n,r):null}function Koe(e){return Poe.readInt64AsDoubleFromPointer(e)}function Xoe(e,t){for(var n=[],r=0;r<t;r++){var i=$oe(e,r);null!==i&&n.push(i)}return n}function Yoe(e){return 180*xoe.getValue(e,"double")/Math.PI}function Qoe(e){return[Yoe(e),Yoe(e+8)]}function Zoe(e){return[Yoe(e+8),Yoe(e)]}function Joe(e,t,n){for(var r=xoe.getValue(e,"i32"),i=e+8,a=[],o=t?Zoe:Qoe,s=0;s<2*r;s+=2)a.push(o(i+8*s));return n&&a.push(a[0]),a}function ese(e,t,n){var r=xoe._malloc(Roe);xoe.HEAPF64.set([e,t].map(ise),r/8);var i=xoe._malloc(koe);try{return Eoe(Poe.latLngToCell(r,n,i)),Ioe($oe(i))}finally{xoe._free(i),xoe._free(r)}}function tse(e){var t=xoe._malloc(Roe),n=Uoe(e),r=n[0],i=n[1];try{return Eoe(Poe.cellToLatLng(r,i,t)),Qoe(t)}finally{xoe._free(t)}}function nse(e,t){var n=xoe._malloc(Loe),r=Uoe(e),i=r[0],a=r[1];try{return Eoe(Poe.cellToBoundary(i,a,n)),Joe(n,t,t)}finally{xoe._free(n)}}function rse(e,t,n){if(Doe(t),n=Boolean(n),0===e.length||0===e[0].length)return[];var r=Woe("number"===typeof e[0][0]?[e]:e,n),i=xoe._malloc(8);try{Eoe(Poe.maxPolygonToCellsSize(r,t,0,i));var a=Foe(Koe(i)),o=xoe._calloc(a,koe);try{return Eoe(Poe.polygonToCells(r,t,0,o)),Xoe(o,a)}finally{xoe._free(o)}}finally{xoe._free(i),Hoe(r)}}function ise(e){return e*Math.PI/180}const ase=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],ose=new WeakMap;class sse{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=ase,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}needsVelocity(e){const t=e.getMRT();return null!==t&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(void 0===t){const{geometry:n,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),null!==e.bundle&&(t.version=e.bundle.version),t.material.transmission>0){const{width:n,height:r}=e.context;t.bufferWidth=n,t.bufferHeight=r}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];null!==r&&void 0!==r&&("object"===typeof r&&void 0!==r.clone?!0===r.isTexture?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e,t){const{object:n,material:r,geometry:i}=e,a=this.getRenderObjectData(e);if(!0!==a.worldMatrix.equals(n.matrixWorld))return a.worldMatrix.copy(n.matrixWorld),!1;const o=a.material;for(const m in o){const e=o[m],t=r[m];if(void 0!==e.equals){if(!1===e.equals(t))return e.copy(t),!1}else if(!0===t.isTexture){if(e.id!==t.id||e.version!==t.version)return e.id=t.id,e.version=t.version,!1}else if(e!==t)return o[m]=t,!1}if(o.transmission>0){const{width:t,height:n}=e.context;if(a.bufferWidth!==t||a.bufferHeight!==n)return a.bufferWidth=t,a.bufferHeight=n,!1}const s=a.geometry,l=i.attributes,c=s.attributes,u=Object.keys(c),d=Object.keys(l);if(s.id!==i.id)return s.id=i.id,!1;if(u.length!==d.length)return a.geometry.attributes=this.getAttributesData(l),!1;for(const m of u){const e=c[m],t=l[m];if(void 0===t)return delete c[m],!1;if(e.version!==t.version)return e.version=t.version,!1}const h=i.index,p=s.indexVersion,f=h?h.version:null;if(p!==f)return s.indexVersion=f,!1;if(s.drawRange.start!==i.drawRange.start||s.drawRange.count!==i.drawRange.count)return s.drawRange.start=i.drawRange.start,s.drawRange.count=i.drawRange.count,!1;if(a.morphTargetInfluences){let e=!1;for(let t=0;t<a.morphTargetInfluences.length;t++)a.morphTargetInfluences[t]!==n.morphTargetInfluences[t]&&(a.morphTargetInfluences[t]=n.morphTargetInfluences[t],e=!0);if(e)return!1}if(a.lights)for(let m=0;m<t.length;m++)if(a.lights[m].map!==t[m].map)return!1;return a.center&&!1===a.center.equals(n.center)?(a.center.copy(n.center),!0):(null!==e.bundle&&(a.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)!0===n.isSpotLight&&null!==n.map&&t.push({map:n.map.version});return t}getLights(e,t){if(ose.has(e)){const n=ose.get(e);if(n.renderId===t)return n.lightsData}const n=this.getLightsData(e.getLights());return ose.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=!0===e.object.static,i=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;const a=this.getLights(e.lightsNode,n);return!0!==this.equals(e,a)}}function lse(e,t=0){let n=3735928559^t,r=1103547991^t;if(e instanceof Array)for(let i,a=0;a<e.length;a++)i=e[a],n=Math.imul(n^i,2654435761),r=Math.imul(r^i,1597334677);else for(let i,a=0;a<e.length;a++)i=e.charCodeAt(a),n=Math.imul(n^i,2654435761),r=Math.imul(r^i,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}const cse=e=>lse(e),use=e=>lse(e),dse=(...e)=>lse(e),hse=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),pse=new WeakMap;function fse(e){return hse.get(e)}function mse(e){if(/[iu]?vec\d/.test(e))return e.startsWith("ivec")?Int32Array:e.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(e))return Float32Array;if(/float/.test(e))return Float32Array;if(/uint/.test(e))return Uint32Array;if(/int/.test(e))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${e}`)}function gse(e){return/float|int|uint/.test(e)?1:/vec2/.test(e)?2:/vec3/.test(e)?3:/vec4/.test(e)||/mat2/.test(e)?4:/mat3/.test(e)?9:/mat4/.test(e)?16:void tJ("TSL: Unsupported type:",e)}function vse(e){return/float|int|uint/.test(e)?1:/vec2/.test(e)?2:/vec3/.test(e)?3:/vec4/.test(e)||/mat2/.test(e)?4:/mat3/.test(e)?12:/mat4/.test(e)?16:void tJ("TSL: Unsupported type:",e)}function Ase(e){return/float|int|uint/.test(e)?4:/vec2/.test(e)?8:/vec3/.test(e)||/vec4/.test(e)?16:/mat2/.test(e)?8:/mat3/.test(e)||/mat4/.test(e)?16:void tJ("TSL: Unsupported type:",e)}function yse(e){if(void 0===e||null===e)return null;const t=typeof e;return!0===e.isNode?"node":"number"===t?"float":"boolean"===t?"bool":"string"===t?"string":"function"===t?"shader":!0===e.isVector2?"vec2":!0===e.isVector3?"vec3":!0===e.isVector4?"vec4":!0===e.isMatrix2?"mat2":!0===e.isMatrix3?"mat3":!0===e.isMatrix4?"mat4":!0===e.isColor?"color":e instanceof ArrayBuffer?"ArrayBuffer":null}function bse(e,...t){const n=e?e.slice(-4):void 0;return 1===t.length&&("vec2"===n?t=[t[0],t[0]]:"vec3"===n?t=[t[0],t[0],t[0]]:"vec4"===n&&(t=[t[0],t[0],t[0],t[0]])),"color"===e?new o1(...t):"vec2"===n?new mJ(...t):"vec3"===n?new vJ(...t):"vec4"===n?new DJ(...t):"mat2"===n?new d5(...t):"mat3"===n?new bJ(...t):"mat4"===n?new f0(...t):"bool"===e?t[0]||!1:"float"===e||"int"===e||"uint"===e?t[0]||0:"string"===e?t[0]||"":"ArrayBuffer"===e?wse(t[0]):null}function xse(e){let t=pse.get(e);return void 0===t&&(t={},pse.set(e,t)),t}function _se(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return btoa(t)}function wse(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}const Sse={VERTEX:"vertex",FRAGMENT:"fragment"},Tse={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Cse={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},Mse=["fragment","vertex"],Ese=["setup","analyze","generate"],Pse=[...Mse,"compute"],Nse=["x","y","z","w"],kse={analyze:"setup",generate:"analyze"};let Rse=0;class Lse extends rJ{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Tse.NONE,this.updateBeforeType=Tse.NONE,this.updateAfterType=Tse.NONE,this.uuid=fJ.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:Rse++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Tse.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Tse.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Tse.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const r=this[n];if(!0!==n.startsWith("_")&&!e.has(r))if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){const i=r[e];i&&!0===i.isNode&&t.push({property:n,index:e,childNode:i})}else if(r&&!0===r.isNode)t.push({property:n,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(const e in r){if(!0===e.startsWith("_"))continue;const i=r[e];i&&!0===i.isNode&&t.push({property:n,index:e,childNode:i})}}return t}getCacheKey(e=!1,t=null){if(!0===(e=e||this.version!==this._cacheKeyVersion)||null===this._cacheKey){null===t&&(t=new Set);const n=[];for(const{property:r,childNode:i}of this._getChildren(t))n.push(cse(r.slice(0,-4)),i.getCacheKey(e,t));this._cacheKey=dse(use(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(!0===this.parents){const n=e.getDataFromNode(this,"any");n.stages=n.stages||{},n.stages[e.shaderStage]=n.stages[e.shaderStage]||[],n.stages[e.shaderStage].push(t)}if(1===n){const t=e.getNodeProperties(this);for(const n of Object.values(t))n&&!0===n.isNode&&n.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(e,t)}updateBefore(){eJ("Abstract function.")}updateAfter(){eJ("Abstract function.")}update(){eJ("Abstract function.")}before(e){return null===this._beforeNodes&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(null!==this._beforeNodes){const n=this._beforeNodes;this._beforeNodes=null;for(const r of n)r.build(e,t);this._beforeNodes=n}const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const i=kse[e.buildStage];if(i&&!0!==r.buildStages[i]){const t=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(t)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if("setup"===o){this.updateReference(e);const t=e.getNodeProperties(this);if(!0!==t.initialized){t.initialized=!0,t.outputNode=this.setup(e)||t.outputNode||null;for(const n of Object.values(t))if(n&&!0===n.isNode){if(!0===n.parents){const t=e.getNodeProperties(n);t.parents=t.parents||[],t.parents.push(this)}n.build(e)}}a=t.outputNode}else if("analyze"===o)this.analyze(e,t);else if("generate"===o){if(this.generate.length<2){const n=this.getNodeType(e),r=e.getDataFromNode(this);a=r.snippet,void 0===a?void 0===r.generated?(r.generated=!0,a=this.generate(e)||"",r.snippet=a):(eJ("Node: Recursion detected.",this),a="/* Recursion detected. */"):void 0!==r.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,n,t)}else a=this.generate(e,t)||"";""===a&&null!==t&&"void"!==t&&"OutputType"!==t&&(tJ(`TSL: Invalid generated code, expected a "${t}".`),a=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:a}of t)void 0!==i?(void 0===n[r]&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=a.toJSON(e.meta).uuid):n[r]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(void 0!==e.inputNodes){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const i of e.inputNodes[n])r.push(t[i]);this[n]=r}else if("object"===typeof e.inputNodes[n]){const r={};for(const i in e.inputNodes[n]){const a=e.inputNodes[n][i];r[i]=t[a]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=void 0===e||"string"===typeof e;r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(void 0===i&&(i={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},!0!==r&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){const t=a(e.textures),n=a(e.images),r=a(e.nodes);t.length>0&&(i.textures=t),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}}class Ose extends Lse{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e);return`${this.node.build(e)}[ ${this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint")} ]`}}class jse extends Lse{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))null!==n&&e.getTypeLength(t)!==e.getTypeLength(r)||(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),i=n.build(e,r);return e.format(i,r,t)}}class Dse extends Lse{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){const n=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(void 0!==r.propertyName)return e.format(r.propertyName,n,t);if("void"!==n&&"void"!==t&&this.hasDependencies(e)){const i=super.build(e,n),a=e.getVarFromNode(this,null,n),o=e.getPropertyName(a);return e.addLineFlowCode(`${o} = ${i}`,this),r.snippet=i,r.propertyName=o,e.format(r.propertyName,n,t)}}return super.build(e,t)}}class Ise extends Dse{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),i=this.nodes,a=e.getComponentType(n),o=[];let s=0;for(const c of i){if(s>=r){tJ(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let t,i=c.getNodeType(e),l=e.getTypeLength(i);s+l>r&&(tJ(`TSL: Length of '${n}()' data exceeds maximum length of output type.`),l=r-s,i=e.getTypeFromLength(l)),s+=l,t=c.build(e,i);if(e.getComponentType(i)!==a){const n=e.getTypeFromLength(l,a);t=e.format(t,i,n)}o.push(t)}const l=`${e.getType(n)}( ${o.join(", ")} )`;return e.format(l,n,t)}}const Bse=Nse.join("");class Fse extends Lse{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Nse.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let i=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const o=n.build(e,a);i=this.components.length===r&&this.components===Bse.slice(0,this.components.length)?e.format(o,a,t):e.format(`${o}.${this.components}`,this.getNodeType(e),t)}else i=n.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class zse extends Dse{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,i=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),o=e.getTypeFromLength(n.length,a),s=r.build(e,o),l=t.build(e,i),c=e.getTypeLength(i),u=[];for(let d=0;d<c;d++){const e=Nse[d];e===n[0]?(u.push(s),d+=n.length-1):u.push(l+"."+e)}return`${e.getType(i)}( ${u.join(", ")} )`}}class Use extends Dse{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),i=n.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+i,this);const s=e.getTypeLength(r),l=[];let c=0;for(let u=0;u<s;u++){const e=Nse[u];e===t[c]?(l.push("1.0 - "+o+"."+e),c++):l.push(o+"."+e)}return`${e.getType(r)}( ${l.join(", ")} )`}}class Vse extends Lse{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?yse(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=yse(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=_se(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?bse(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){eJ("Abstract function.")}}const Gse=/float|u?int/;class qse extends Vse{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return Gse.test(n)&&Gse.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class Wse extends Lse{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return(!this.structNode.isMemberNode||!1!==this.structNode.hasMember(e))&&"void"!==this.structNode.getMemberType(e,this.property)}getNodeType(e){return!1===this.hasMember(e)?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(!1===this.hasMember(e))return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(!1===this.hasMember(e)){eJ(`TSL: Member "${this.property}" does not exist in struct.`);const t=this.getNodeType(e);return e.generateConst(t)}return this.structNode.build(e)+"."+this.property}}let Hse=null;const $se=new Map;function Kse(e,t){if($se.has(e))eJ(`TSL: Redefinition of method chaining '${e}'.`);else{if("function"!==typeof t)throw new Error(`THREE.TSL: Node element ${e} is not a function`);$se.set(e,t),"assign"!==e&&(Lse.prototype[e]=function(...e){return this.isStackNode?this.addToStack(t(...e)):t(this,...e)},Lse.prototype[e+"Assign"]=function(...e){return this.isStackNode?this.assign(e[0],t(...e)):this.assign(t(this,...e))})}}const Xse=e=>(e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"))(e).split("").sort().join("");Lse.prototype.assign=function(...e){if(!0!==this.isStackNode)return null!==Hse?Hse.assign(this,...e):tJ("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const t=$se.get("assign");return this.addToStack(t(...e))}},Lse.prototype.toVarIntent=function(){return this},Lse.prototype.get=function(e){return new Wse(this,e)};const Yse={};function Qse(e,t,n){Yse[e]=Yse[t]=Yse[n]={get(){this._cache=this._cache||{};let t=this._cache[e];return void 0===t&&(t=new Fse(this,e),this._cache[e]=t),t},set(t){this[e].assign(wle(t))}};const r=e.toUpperCase(),i=t.toUpperCase(),a=n.toUpperCase();Lse.prototype["set"+r]=Lse.prototype["set"+i]=Lse.prototype["set"+a]=function(t){const n=Xse(e);return new zse(this,n,wle(t))},Lse.prototype["flip"+r]=Lse.prototype["flip"+i]=Lse.prototype["flip"+a]=function(){const t=Xse(e);return new Use(this,t)}}const Zse=["x","y","z","w"],Jse=["r","g","b","a"],ele=["s","t","p","q"];for(let n=0;n<4;n++){let e=Zse[n],t=Jse[n],r=ele[n];Qse(e,t,r);for(let i=0;i<4;i++){e=Zse[n]+Zse[i],t=Jse[n]+Jse[i],r=ele[n]+ele[i],Qse(e,t,r);for(let a=0;a<4;a++){e=Zse[n]+Zse[i]+Zse[a],t=Jse[n]+Jse[i]+Jse[a],r=ele[n]+ele[i]+ele[a],Qse(e,t,r);for(let o=0;o<4;o++)e=Zse[n]+Zse[i]+Zse[a]+Zse[o],t=Jse[n]+Jse[i]+Jse[a]+Jse[o],r=ele[n]+ele[i]+ele[a]+ele[o],Qse(e,t,r)}}}for(let n=0;n<32;n++)Yse[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return void 0===e&&(e=new Ose(this,new qse(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(wle(e))}};Object.defineProperties(Lse.prototype,Yse);const tle=new WeakMap,nle=function(e,t=null){for(const n in e)e[n]=wle(e[n],t);return e},rle=function(e,t=null){const n=e.length;for(let r=0;r<n;r++)e[r]=wle(e[r],t);return e},ile=function(e,t=null,n=null,r=null){function i(e){return null!==r?(e=wle(Object.assign(e,r)),!0===r.intent&&(e=e.toVarIntent())):e=wle(e),e}let a,o,s,l=t;function c(t){let n;return n=l?/[a-z]/i.test(l)?l+"()":l:e.type,void 0!==o&&t.length<o?(tJ(`TSL: "${n}" parameter length is less than minimum required.`),t.concat(new Array(o-t.length).fill(0))):void 0!==s&&t.length>s?(tJ(`TSL: "${n}" parameter length exceeds limit.`),t.slice(0,s)):t}return null===t?a=(...t)=>i(new e(...Cle(c(t)))):null!==n?(n=wle(n),a=(...r)=>i(new e(t,...Cle(c(r)),n))):a=(...n)=>i(new e(t,...Cle(c(n)))),a.setParameterLength=(...e)=>(1===e.length?o=s=e[0]:2===e.length&&([o,s]=e),a),a.setName=e=>(l=e,a),a},ale=function(e,...t){return new e(...Cle(t))};class ole extends Lse{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,r=e.getNodeProperties(t),i=e.getClosestSubBuild(t.subBuilds)||"",a=i||"default";if(r[a])return r[a];const o=e.subBuildFn,s=e.fnCall;e.subBuildFn=i,e.fnCall=this;let l=null;if(t.layout){let r=tle.get(e.constructor);void 0===r&&(r=new WeakMap,tle.set(e.constructor,r));let i=r.get(t);void 0===i&&(i=wle(e.buildFunctionNode(t)),r.set(t,i)),e.addInclude(i);const a=n?function(e){let t;Tle(e);t=e[0]&&(e[0].isNode||Object.getPrototypeOf(e[0])!==Object.prototype)?[...e]:e[0];return t}(n):null;l=wle(i.call(a))}else{const r=new Proxy(e,{get:(e,t,n)=>{let r;return r=Symbol.iterator===t?function*(){yield}:Reflect.get(e,t,n),r}}),i=n?function(e){let t=0;return Tle(e),new Proxy(e,{get:(n,r,i)=>{let a;if("length"===r)return a=e.length,a;if(Symbol.iterator===r)a=function*(){for(const t of e)yield wle(t)};else{if(e.length>0)if(Object.getPrototypeOf(e[0])===Object.prototype){const n=e[0];a=void 0===n[r]?n[t++]:Reflect.get(n,r,i)}else e[0]instanceof Lse&&(a=void 0===e[r]?e[t++]:Reflect.get(e,r,i));else a=Reflect.get(n,r,i);a=wle(a)}return a}})}(n):null,a=Array.isArray(n)?n.length>0:null!==n,o=t.jsFunc,s=a||o.length>1?o(i,r):o(r);l=wle(s)}return e.subBuildFn=o,e.fnCall=s,t.once&&(r[a]=l),l}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),i=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e),s=e.fnCall;if(e.fnCall=this,"setup"===r){const t=e.getSubBuildProperty("initialized",this);if(!0!==i[t]&&(i[t]=!0,i[a]=this.getOutputNode(e),i[a].build(e),this.shaderNode.subBuilds))for(const n of e.chaining){const t=e.getDataFromNode(n,"any");t.subBuilds=t.subBuilds||new Set;for(const e of this.shaderNode.subBuilds)t.subBuilds.add(e)}n=i[a]}else"analyze"===r?o.build(e,t):"generate"===r&&(n=o.build(e,t)||"");return e.fnCall=s,n}}class sle extends Lse{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new ole(this,e)}setup(){return this.call()}}const lle=[!1,!0],cle=[0,1,2,3],ule=[-1,-2],dle=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],hle=new Map;for(const n of lle)hle.set(n,new qse(n));const ple=new Map;for(const n of cle)ple.set(n,new qse(n,"uint"));const fle=new Map([...ple].map(e=>new qse(e.value,"int")));for(const n of ule)fle.set(n,new qse(n,"int"));const mle=new Map([...fle].map(e=>new qse(e.value)));for(const n of dle)mle.set(n,new qse(n));for(const n of dle)mle.set(-n,new qse(-n));const gle={bool:hle,uint:ple,ints:fle,float:mle},vle=new Map([...hle,...mle]),Ale=(e,t)=>vle.has(e)?vle.get(e):!0===e.isNode?e:new qse(e,t),yle=function(e,t=null){return(...n)=>{for(const t of n)if(void 0===t)return tJ(`TSL: Invalid parameter for the type "${e}".`),new qse(0,e);if((0===n.length||!["bool","float","int","uint"].includes(e)&&n.every(e=>{const t=typeof e;return"object"!==t&&"function"!==t}))&&(n=[bse(e,...n)]),1===n.length&&null!==t&&t.has(n[0]))return Sle(t.get(n[0]));if(1===n.length){const t=Ale(n[0],e);return t.nodeType===e?Sle(t):Sle(new jse(t,e))}const r=n.map(e=>Ale(e));return Sle(new Ise(r,e))}},ble=e=>"object"===typeof e&&null!==e?e.value:e,xle=e=>void 0!==e&&null!==e?e.nodeType||e.convertTo||("string"===typeof e?e:null):null;function _le(e,t){return new sle(e,t)}const wle=(e,t=null)=>function(e,t=null){const n=yse(e);return"node"===n?e:null===t&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?wle(Ale(e,t)):"shader"===n?e.isFn?e:Rle(e):e}(e,t),Sle=(e,t=null)=>wle(e,t).toVarIntent(),Tle=(e,t=null)=>new nle(e,t),Cle=(e,t=null)=>new rle(e,t),Mle=(e,t=null,n=null,r=null)=>new ile(e,t,n,r),Ele=(e,...t)=>new ale(e,...t),Ple=(e,t=null,n=null,r={})=>new ile(e,t,n,{...r,intent:!0});let Nle=0;class kle extends Lse{constructor(e,t=null){super();let n=null;null!==t&&("object"===typeof t?n=t.return:("string"===typeof t?n=t:tJ("TSL: Invalid layout type."),t=null)),this.shaderNode=new _le(e,n),null!==t&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if("object"!==typeof e.inputs){const n={name:"fn"+Nle++,type:t,inputs:[]};for(const t in e)"return"!==t&&n.inputs.push({name:t,type:e[t]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return"void"===this.shaderNode.nodeType&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return tJ('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function Rle(e,t=null){const n=new kle(e,t);return new Proxy(()=>{},{apply(e,t,r){return n.call(...r)},get(e,t,r){return Reflect.get(n,t,r)},set(e,t,r,i){return Reflect.set(n,t,r,i)}})}const Lle=e=>{Hse=e},Ole=()=>Hse,jle=(...e)=>Hse.If(...e);function Dle(e){return Hse&&Hse.addToStack(e),e}Kse("toStack",Dle);const Ile=new yle("color"),Ble=new yle("float",gle.float),Fle=new yle("int",gle.ints),zle=new yle("uint",gle.uint),Ule=new yle("bool",gle.bool),Vle=new yle("vec2"),Gle=new yle("ivec2"),qle=new yle("uvec2"),Wle=new yle("bvec2"),Hle=new yle("vec3"),$le=new yle("ivec3"),Kle=new yle("uvec3"),Xle=new yle("bvec3"),Yle=new yle("vec4"),Qle=new yle("ivec4"),Zle=new yle("uvec4"),Jle=new yle("bvec4"),ece=new yle("mat2"),tce=new yle("mat3"),nce=new yle("mat4");Kse("toColor",Ile),Kse("toFloat",Ble),Kse("toInt",Fle),Kse("toUint",zle),Kse("toBool",Ule),Kse("toVec2",Vle),Kse("toIVec2",Gle),Kse("toUVec2",qle),Kse("toBVec2",Wle),Kse("toVec3",Hle),Kse("toIVec3",$le),Kse("toUVec3",Kle),Kse("toBVec3",Xle),Kse("toVec4",Yle),Kse("toIVec4",Qle),Kse("toUVec4",Zle),Kse("toBVec4",Jle),Kse("toMat2",ece),Kse("toMat3",tce),Kse("toMat4",nce);const rce=Mle(Ose).setParameterLength(2),ice=(e,t)=>wle(new jse(wle(e),t));Kse("element",rce),Kse("convert",ice);Kse("append",e=>(eJ("TSL: .append() has been renamed to .toStack()."),Dle(e)));class ace extends Lse{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return cse(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const oce=(e,t)=>new ace(e,t),sce=(e,t)=>new ace(e,t,!0),lce=Ele(ace,"vec4","DiffuseColor"),cce=Ele(ace,"vec3","DiffuseContribution"),uce=Ele(ace,"vec3","EmissiveColor"),dce=Ele(ace,"float","Roughness"),hce=Ele(ace,"float","Metalness"),pce=Ele(ace,"float","Clearcoat"),fce=Ele(ace,"float","ClearcoatRoughness"),mce=Ele(ace,"vec3","Sheen"),gce=Ele(ace,"float","SheenRoughness"),vce=Ele(ace,"float","Iridescence"),Ace=Ele(ace,"float","IridescenceIOR"),yce=Ele(ace,"float","IridescenceThickness"),bce=Ele(ace,"float","AlphaT"),xce=Ele(ace,"float","Anisotropy"),_ce=Ele(ace,"vec3","AnisotropyT"),wce=Ele(ace,"vec3","AnisotropyB"),Sce=Ele(ace,"color","SpecularColor"),Tce=Ele(ace,"color","SpecularColorBlended"),Cce=Ele(ace,"float","SpecularF90"),Mce=Ele(ace,"float","Shininess"),Ece=Ele(ace,"vec4","Output"),Pce=Ele(ace,"float","dashSize"),Nce=Ele(ace,"float","gapSize"),kce=Ele(ace,"float","pointWidth"),Rce=Ele(ace,"float","IOR"),Lce=Ele(ace,"float","Transmission"),Oce=Ele(ace,"float","Thickness"),jce=Ele(ace,"float","AttenuationDistance"),Dce=Ele(ace,"color","AttenuationColor"),Ice=Ele(ace,"float","Dispersion");class Bce extends Lse{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Fce=e=>new Bce(e),zce=(e,t=0)=>new Bce(e,!0,t),Uce=zce("frame"),Vce=zce("render"),Gce=Fce("object");class qce extends Vse{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=Gce}setName(e){return this.name=e,this}label(e){return eJ('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(t=>{const n=e(t,this);void 0!==n&&(this.value=n)},t)}getInputType(e){let t=super.getInputType(e);return"bool"===t&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let i=e.getNodeFromHash(r);void 0===i&&(e.setHashNode(this,r),i=this);const a=i.getInputType(e),o=e.getUniformFromNode(i,a,e.shaderStage,this.name||e.context.nodeName),s=e.getPropertyName(o);void 0!==e.context.nodeName&&delete e.context.nodeName;let l=s;if("bool"===n){const t=e.getDataFromNode(this);let r=t.propertyName;if(void 0===r){const i=e.getVarFromNode(this,null,"bool");r=e.getPropertyName(i),t.propertyName=r,l=e.format(s,a,n),e.addLineFlowCode(`${r} = ${l}`,this)}l=r}return e.format(l,n,t)}}const Wce=(e,t)=>{const n=xle(t||e);if(n===e&&(e=bse(n)),e&&!0===e.isNode){let t=e.value;e.traverse(e=>{!0===e.isConstNode&&(t=e.value)}),e=t}return new qce(e,n)};class Hce extends Dse{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return null===this.nodeType?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return null===this.nodeType?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const $ce=(...e)=>{let t;if(1===e.length){const n=e[0];t=new Hce(null,n.length,n)}else{const n=e[0],r=e[1];t=new Hce(n,r)}return wle(t)};Kse("toArray",(e,t)=>$ce(Array(t).fill(e)));class Kce extends Dse{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return Nse.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=t.getScope();e.getDataFromNode(r).assign=!0;const i=e.getNodeProperties(this);i.sourceNode=n,i.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),i=this.needsSplitAssign(e),a=n.build(e),o=n.getNodeType(e),s=r.build(e,o),l=r.getNodeType(e),c=e.getDataFromNode(this);let u;if(!0===c.initialized)"void"!==t&&(u=a);else if(i){const r=e.getVarFromNode(this,null,o),i=e.getPropertyName(r);e.addLineFlowCode(`${i} = ${s}`,this);const l=n.node,c=l.node.context({assign:!0}).build(e);for(let t=0;t<l.components.length;t++){const n=l.components[t];e.addLineFlowCode(`${c}.${n} = ${i}[ ${t} ]`,this)}"void"!==t&&(u=a)}else u=`${a} = ${s}`,"void"!==t&&"void"!==l||(e.addLineFlowCode(u,this),"void"!==t&&(u=a));return c.initialized=!0,e.format(u,o,t)}}const Xce=Mle(Kce).setParameterLength(2);Kse("assign",Xce);class Yce extends Dse{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),i=this.parameters,a=(t,n)=>{const r=n.type;let i;return i="pointer"===r?"&"+t.build(e):t.build(e,r),i};if(Array.isArray(i)){if(i.length>r.length)tJ("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=r.length;else if(i.length<r.length)for(tJ("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<r.length;)i.push(Ble(0));for(let e=0;e<i.length;e++)t.push(a(i[e],r[e]))}else for(const o of r){const e=i[o.name];void 0!==e?t.push(a(e,o)):(tJ(`TSL: Input '${o.name}' not found in 'Fn()'.`),t.push(a(Ble(0),o)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const Qce=(e,...t)=>(t=t.length>1||t[0]&&!0===t[0].isNode?Cle(t):Tle(t[0]),new Yce(wle(e),t));Kse("call",Qce);const Zce={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Jce extends Dse{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let i=new Jce(e,t,n);for(let t=0;t<r.length-1;t++)i=new Jce(e,i,r[t]);t=i,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(Zce[this.op],t)}getNodeType(e,t=null){const n=this.op,r=this.aNode,i=this.bNode,a=r.getNodeType(e),o=i?i.getNodeType(e):null;if("void"===a||"void"===o)return t||"void";if("%"===n)return a;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return e.getIntegerType(a);if("!"===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("=="===n||"!="===n||"<"===n||">"===n||"<="===n||">="===n){const t=Math.max(e.getTypeLength(a),e.getTypeLength(o));return t>1?`bvec${t}`:"bool"}if(e.isMatrix(a)){if("float"===o)return a;if(e.isVector(o))return e.getVectorFromMatrix(a);if(e.isMatrix(o))return a}else if(e.isMatrix(o)){if("float"===a)return o;if(e.isVector(a))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(a)?o:a}generate(e,t){const n=this.op,{aNode:r,bNode:i}=this,a=this.getNodeType(e,t);let o=null,s=null;"void"!==a?(o=r.getNodeType(e),s=i?i.getNodeType(e):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n||"!="===n?e.isVector(o)?s=o:e.isVector(s)?o=s:o!==s&&(o=s="float"):">>"===n||"<<"===n?(o=a,s=e.changeComponentType(s,"uint")):"%"===n?(o=a,s=e.isInteger(o)&&e.isInteger(s)?s:o):e.isMatrix(o)?"float"===s?s="float":e.isVector(s)?s=e.getVectorFromMatrix(o):e.isMatrix(s)||(o=s=a):o=e.isMatrix(s)?"float"===o?"float":e.isVector(o)?e.getVectorFromMatrix(s):s=a:s=a):o=s=a;const l=r.build(e,o),c=i?i.build(e,s):null,u=e.getFunctionOperator(n);if("void"!==t){const r=e.renderer.coordinateSystem===GZ;if("=="===n||"!="===n||"<"===n||">"===n||"<="===n||">="===n)return r&&e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${l}, ${c} )`,a,t):e.format(`( ${l} ${n} ${c} )`,a,t);if("%"===n)return e.isInteger(s)?e.format(`( ${l} % ${c} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${l}, ${c} )`,a,t);if("!"===n||"~"===n)return e.format(`(${n}${l})`,o,t);if(u)return e.format(`${u}( ${l}, ${c} )`,a,t);if(e.isMatrix(o)&&"float"===s)return e.format(`( ${c} ${n} ${l} )`,a,t);if("float"===o&&e.isMatrix(s))return e.format(`${l} ${n} ${c}`,a,t);{let i=`( ${l} ${n} ${c} )`;return!r&&"bool"===a&&e.isVector(o)&&e.isVector(s)&&(i=`all${i}`),e.format(i,a,t)}}if("void"!==o)return u?e.format(`${u}( ${l}, ${c} )`,a,t):e.isMatrix(o)&&"float"===s?e.format(`${c} ${n} ${l}`,a,t):e.format(`${l} ${n} ${c}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const eue=Ple(Jce,"+").setParameterLength(2,1/0).setName("add"),tue=Ple(Jce,"-").setParameterLength(2,1/0).setName("sub"),nue=Ple(Jce,"*").setParameterLength(2,1/0).setName("mul"),rue=Ple(Jce,"/").setParameterLength(2,1/0).setName("div"),iue=Ple(Jce,"%").setParameterLength(2).setName("mod"),aue=Ple(Jce,"==").setParameterLength(2).setName("equal"),oue=Ple(Jce,"!=").setParameterLength(2).setName("notEqual"),sue=Ple(Jce,"<").setParameterLength(2).setName("lessThan"),lue=Ple(Jce,">").setParameterLength(2).setName("greaterThan"),cue=Ple(Jce,"<=").setParameterLength(2).setName("lessThanEqual"),uue=Ple(Jce,">=").setParameterLength(2).setName("greaterThanEqual"),due=Ple(Jce,"&&").setParameterLength(2,1/0).setName("and"),hue=Ple(Jce,"||").setParameterLength(2,1/0).setName("or"),pue=Ple(Jce,"!").setParameterLength(1).setName("not"),fue=Ple(Jce,"^^").setParameterLength(2).setName("xor"),mue=Ple(Jce,"&").setParameterLength(2).setName("bitAnd"),gue=Ple(Jce,"~").setParameterLength(1).setName("bitNot"),vue=Ple(Jce,"|").setParameterLength(2).setName("bitOr"),Aue=Ple(Jce,"^").setParameterLength(2).setName("bitXor"),yue=Ple(Jce,"<<").setParameterLength(2).setName("shiftLeft"),bue=Ple(Jce,">>").setParameterLength(2).setName("shiftRight"),xue=Rle(([e])=>(e.addAssign(1),e)),_ue=Rle(([e])=>(e.subAssign(1),e)),wue=Rle(([e])=>{const t=Fle(e).toConst();return e.addAssign(1),t}),Sue=Rle(([e])=>{const t=Fle(e).toConst();return e.subAssign(1),t});Kse("add",eue),Kse("sub",tue),Kse("mul",nue),Kse("div",rue),Kse("mod",iue),Kse("equal",aue),Kse("notEqual",oue),Kse("lessThan",sue),Kse("greaterThan",lue),Kse("lessThanEqual",cue),Kse("greaterThanEqual",uue),Kse("and",due),Kse("or",hue),Kse("not",pue),Kse("xor",fue),Kse("bitAnd",mue),Kse("bitNot",gue),Kse("bitOr",vue),Kse("bitXor",Aue),Kse("shiftLeft",yue),Kse("shiftRight",bue),Kse("incrementBefore",xue),Kse("decrementBefore",_ue),Kse("increment",wue),Kse("decrement",Sue);const Tue=(e,t)=>(eJ('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),iue(Fle(e),Fle(t)));Kse("modInt",Tue);class Cue extends Dse{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===Cue.MAX||e===Cue.MIN)&&arguments.length>3){let i=new Cue(e,t,n);for(let t=2;t<arguments.length-1;t++)i=new Cue(e,i,arguments[t]);t=i,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(r)?0:e.getTypeLength(r);return i>a&&i>o?t:a>o?n:o>i?r:t}getNodeType(e){const t=this.method;return t===Cue.LENGTH||t===Cue.DISTANCE||t===Cue.DOT?"float":t===Cue.CROSS?"vec3":t===Cue.ALL||t===Cue.ANY?"bool":t===Cue.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let i=null;if(r===Cue.ONE_MINUS)i=tue(1,t);else if(r===Cue.RECIPROCAL)i=rue(1,t);else if(r===Cue.DIFFERENCE)i=Jue(tue(t,n));else if(r===Cue.TRANSFORM_DIRECTION){let r=t,a=n;e.isMatrix(r.getNodeType(e))?a=Yle(Hle(a),0):r=Yle(Hle(r),0);const o=nue(r,a).xyz;i=Wue(o)}return null!==i?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let n=this.method;const r=this.getNodeType(e),i=this.getInputType(e),a=this.aNode,o=this.bNode,s=this.cNode,l=e.renderer.coordinateSystem;if(n===Cue.NEGATE)return e.format("( - "+a.build(e,i)+" )",r,t);{const c=[];return n===Cue.CROSS?c.push(a.build(e,r),o.build(e,r)):l===GZ&&n===Cue.STEP?c.push(a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":i),o.build(e,i)):l!==GZ||n!==Cue.MIN&&n!==Cue.MAX?n===Cue.REFRACT?c.push(a.build(e,i),o.build(e,i),s.build(e,"float")):n===Cue.MIX?c.push(a.build(e,i),o.build(e,i),s.build(e,1===e.getTypeLength(s.getNodeType(e))?"float":i)):(l===qZ&&n===Cue.ATAN&&null!==o&&(n="atan2"),"fragment"===e.shaderStage||n!==Cue.DFDX&&n!==Cue.DFDY||(eJ(`TSL: '${n}' is not supported in the ${e.shaderStage} stage.`),n="/*"+n+"*/"),c.push(a.build(e,i)),null!==o&&c.push(o.build(e,i)),null!==s&&c.push(s.build(e,i))):c.push(a.build(e,i),o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":i)),e.format(`${e.getMethod(n,r)}( ${c.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Cue.ALL="all",Cue.ANY="any",Cue.RADIANS="radians",Cue.DEGREES="degrees",Cue.EXP="exp",Cue.EXP2="exp2",Cue.LOG="log",Cue.LOG2="log2",Cue.SQRT="sqrt",Cue.INVERSE_SQRT="inversesqrt",Cue.FLOOR="floor",Cue.CEIL="ceil",Cue.NORMALIZE="normalize",Cue.FRACT="fract",Cue.SIN="sin",Cue.COS="cos",Cue.TAN="tan",Cue.ASIN="asin",Cue.ACOS="acos",Cue.ATAN="atan",Cue.ABS="abs",Cue.SIGN="sign",Cue.LENGTH="length",Cue.NEGATE="negate",Cue.ONE_MINUS="oneMinus",Cue.DFDX="dFdx",Cue.DFDY="dFdy",Cue.ROUND="round",Cue.RECIPROCAL="reciprocal",Cue.TRUNC="trunc",Cue.FWIDTH="fwidth",Cue.TRANSPOSE="transpose",Cue.DETERMINANT="determinant",Cue.INVERSE="inverse",Cue.EQUALS="equals",Cue.MIN="min",Cue.MAX="max",Cue.STEP="step",Cue.REFLECT="reflect",Cue.DISTANCE="distance",Cue.DIFFERENCE="difference",Cue.DOT="dot",Cue.CROSS="cross",Cue.POW="pow",Cue.TRANSFORM_DIRECTION="transformDirection",Cue.MIX="mix",Cue.CLAMP="clamp",Cue.REFRACT="refract",Cue.SMOOTHSTEP="smoothstep",Cue.FACEFORWARD="faceforward";const Mue=Ble(1e-6),Eue=Ble(1e6),Pue=Ble(Math.PI),Nue=Ble(2*Math.PI),kue=Ble(2*Math.PI),Rue=Ble(.5*Math.PI),Lue=Ple(Cue,Cue.ALL).setParameterLength(1),Oue=Ple(Cue,Cue.ANY).setParameterLength(1),jue=Ple(Cue,Cue.RADIANS).setParameterLength(1),Due=Ple(Cue,Cue.DEGREES).setParameterLength(1),Iue=Ple(Cue,Cue.EXP).setParameterLength(1),Bue=Ple(Cue,Cue.EXP2).setParameterLength(1),Fue=Ple(Cue,Cue.LOG).setParameterLength(1),zue=Ple(Cue,Cue.LOG2).setParameterLength(1),Uue=Ple(Cue,Cue.SQRT).setParameterLength(1),Vue=Ple(Cue,Cue.INVERSE_SQRT).setParameterLength(1),Gue=Ple(Cue,Cue.FLOOR).setParameterLength(1),que=Ple(Cue,Cue.CEIL).setParameterLength(1),Wue=Ple(Cue,Cue.NORMALIZE).setParameterLength(1),Hue=Ple(Cue,Cue.FRACT).setParameterLength(1),$ue=Ple(Cue,Cue.SIN).setParameterLength(1),Kue=Ple(Cue,Cue.COS).setParameterLength(1),Xue=Ple(Cue,Cue.TAN).setParameterLength(1),Yue=Ple(Cue,Cue.ASIN).setParameterLength(1),Que=Ple(Cue,Cue.ACOS).setParameterLength(1),Zue=Ple(Cue,Cue.ATAN).setParameterLength(1,2),Jue=Ple(Cue,Cue.ABS).setParameterLength(1),ede=Ple(Cue,Cue.SIGN).setParameterLength(1),tde=Ple(Cue,Cue.LENGTH).setParameterLength(1),nde=Ple(Cue,Cue.NEGATE).setParameterLength(1),rde=Ple(Cue,Cue.ONE_MINUS).setParameterLength(1),ide=Ple(Cue,Cue.DFDX).setParameterLength(1),ade=Ple(Cue,Cue.DFDY).setParameterLength(1),ode=Ple(Cue,Cue.ROUND).setParameterLength(1),sde=Ple(Cue,Cue.RECIPROCAL).setParameterLength(1),lde=Ple(Cue,Cue.TRUNC).setParameterLength(1),cde=Ple(Cue,Cue.FWIDTH).setParameterLength(1),ude=Ple(Cue,Cue.TRANSPOSE).setParameterLength(1),dde=Ple(Cue,Cue.DETERMINANT).setParameterLength(1),hde=Ple(Cue,Cue.INVERSE).setParameterLength(1),pde=(e,t)=>(eJ('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),aue(e,t)),fde=Ple(Cue,Cue.MIN).setParameterLength(2,1/0),mde=Ple(Cue,Cue.MAX).setParameterLength(2,1/0),gde=Ple(Cue,Cue.STEP).setParameterLength(2),vde=Ple(Cue,Cue.REFLECT).setParameterLength(2),Ade=Ple(Cue,Cue.DISTANCE).setParameterLength(2),yde=Ple(Cue,Cue.DIFFERENCE).setParameterLength(2),bde=Ple(Cue,Cue.DOT).setParameterLength(2),xde=Ple(Cue,Cue.CROSS).setParameterLength(2),_de=Ple(Cue,Cue.POW).setParameterLength(2),wde=e=>nue(e,e),Sde=e=>nue(e,e,e),Tde=e=>nue(e,e,e,e),Cde=Ple(Cue,Cue.TRANSFORM_DIRECTION).setParameterLength(2),Mde=e=>nue(ede(e),_de(Jue(e),1/3)),Ede=e=>bde(e,e),Pde=Ple(Cue,Cue.MIX).setParameterLength(3),Nde=(e,t=0,n=1)=>wle(new Cue(Cue.CLAMP,wle(e),wle(t),wle(n))),kde=e=>Nde(e),Rde=Ple(Cue,Cue.REFRACT).setParameterLength(3),Lde=Ple(Cue,Cue.SMOOTHSTEP).setParameterLength(3),Ode=Ple(Cue,Cue.FACEFORWARD).setParameterLength(3),jde=Rle(([e])=>{const t=bde(e.xy,Vle(12.9898,78.233)),n=iue(t,Pue);return Hue($ue(n).mul(43758.5453))}),Dde=(e,t,n)=>Pde(t,n,e),Ide=(e,t,n)=>Lde(t,n,e),Bde=(e,t)=>gde(t,e),Fde=(e,t)=>(eJ('TSL: "atan2" is overloaded. Use "atan" instead.'),Zue(e,t)),zde=Ode,Ude=Vue;Kse("all",Lue),Kse("any",Oue),Kse("equals",pde),Kse("radians",jue),Kse("degrees",Due),Kse("exp",Iue),Kse("exp2",Bue),Kse("log",Fue),Kse("log2",zue),Kse("sqrt",Uue),Kse("inverseSqrt",Vue),Kse("floor",Gue),Kse("ceil",que),Kse("normalize",Wue),Kse("fract",Hue),Kse("sin",$ue),Kse("cos",Kue),Kse("tan",Xue),Kse("asin",Yue),Kse("acos",Que),Kse("atan",Zue),Kse("abs",Jue),Kse("sign",ede),Kse("length",tde),Kse("lengthSq",Ede),Kse("negate",nde),Kse("oneMinus",rde),Kse("dFdx",ide),Kse("dFdy",ade),Kse("round",ode),Kse("reciprocal",sde),Kse("trunc",lde),Kse("fwidth",cde),Kse("atan2",Fde),Kse("min",fde),Kse("max",mde),Kse("step",Bde),Kse("reflect",vde),Kse("distance",Ade),Kse("dot",bde),Kse("cross",xde),Kse("pow",_de),Kse("pow2",wde),Kse("pow3",Sde),Kse("pow4",Tde),Kse("transformDirection",Cde),Kse("mix",Dde),Kse("clamp",Nde),Kse("refract",Rde),Kse("smoothstep",Ide),Kse("faceForward",Ode),Kse("difference",yde),Kse("saturate",kde),Kse("cbrt",Mde),Kse("transpose",ude),Kse("determinant",dde),Kse("inverse",hde),Kse("rand",jde);class Vde extends Lse{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(void 0===t)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(null!==n){const t=n.getNodeType(e);if(e.getTypeLength(t)>e.getTypeLength(r))return t}return r}setup(e){const t=this.condNode,n=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,i=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=i,null!==r&&(e.getDataFromNode(r).parentNodeBlock=i);const a=e.context.uniformFlow,o=e.getNodeProperties(this);o.condNode=t,o.ifNode=a?n:n.context({nodeBlock:n}),o.elseNode=r?a?r:r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;const{condNode:i,ifNode:a,elseNode:o}=e.getNodeProperties(this),s=e.currentFunctionNode,l="void"!==t,c=l?oce(n).build(e):"";r.nodeProperty=c;const u=i.build(e,"bool");if(e.context.uniformFlow&&null!==o){const r=a.build(e,n),i=o.build(e,n),s=e.getTernary(u,r,i);return e.format(s,n,t)}e.addFlowCode(`\n${e.tab}if ( ${u} ) {\n\n`).addFlowTab();let d=a.build(e,n);if(d&&(l?d=c+" = "+d+";":(d="return "+d+";",null===s&&(eJ("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),d="// "+d))),e.removeFlowTab().addFlowCode(e.tab+"\t"+d+"\n\n"+e.tab+"}"),null!==o){e.addFlowCode(" else {\n\n").addFlowTab();let t=o.build(e,n);t&&(l?t=c+" = "+t+";":(t="return "+t+";",null===s&&(eJ("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),t="// "+t))),e.removeFlowTab().addFlowCode(e.tab+"\t"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(c,n,t)}}const Gde=Mle(Vde).setParameterLength(2,3);Kse("select",Gde);class qde extends Lse{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{!0===t.isContextNode&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(n),r}}const Wde=(e=null,t={})=>{let n=e;return null!==n&&!0===n.isNode||(t=n||t,n=null),new qde(n,t)},Hde=e=>Wde(e,{uniformFlow:!0}),$de=(e,t)=>Wde(e,{nodeName:t});function Kde(e,t,n=null){return Wde(n,{getShadow:({light:n,shadowColorNode:r})=>t===n?r.mul(e):r})}function Xde(e,t=null){return Wde(t,{getAO:(t,{material:n})=>!0===n.transparent?t:null!==t?t.mul(e):e})}function Yde(e,t){return eJ('TSL: "label()" has been deprecated. Use "setName()" instead.'),$de(e,t)}Kse("context",Wde),Kse("label",Yde),Kse("uniformFlow",Hde),Kse("setName",$de),Kse("builtinShadowContext",(e,t,n)=>Kde(t,n,e)),Kse("builtinAOContext",(e,t)=>Xde(t,e));class Qde extends Lse{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return!0!==e.getDataFromNode(this).forceDeclaration&&this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(!1===this._hasStack(t)&&"setup"===t.buildStage&&(t.context.nodeLoop||t.context.nodeBlock)){let e=!1;if(this.node.isShaderCallNodeInternal&&null===this.node.shaderNode.getLayout()&&t.fnCall&&t.fnCall.shaderNode){if(t.getDataFromNode(this.node.shaderNode).hasLoop){t.getDataFromNode(this).forceDeclaration=!0,e=!0}}const n=t.getBaseStack();e?n.addToStackBefore(this):n.addToStack(this)}return this.isIntent(t)&&!0!==this.isAssign(t)?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:i}=e,a=!0===i.backend.isWebGPUBackend;let o=!1,s=!1;r&&(o=e.isDeterministic(t),s=a?r:o);const l=this.getNodeType(e);if("void"==l){!0!==this.isIntent(e)&&tJ('TSL: ".toVar()" can not be used with void type.');return t.build(e)}const c=e.getVectorType(l),u=t.build(e,c),d=e.getVarFromNode(this,n,c,void 0,s),h=e.getPropertyName(d);let p=h;if(s)if(a)p=o?`const ${h}`:`let ${h}`;else{const n=t.getArrayCount(e);p=`const ${e.getVar(d.type,h,n)}`}return e.addLineFlowCode(`${p} = ${u}`,this),h}_hasStack(e){return void 0!==e.getDataFromNode(this).stack}}const Zde=Mle(Qde),Jde=(e,t=null)=>Zde(e,t).toStack(),ehe=(e,t=null)=>Zde(e,t,!0).toStack(),the=e=>Zde(e).setIntent(!0).toStack();Kse("toVar",Jde),Kse("toConst",ehe),Kse("toVarIntent",the);class nhe extends Lse{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(null!==this.nodeType)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}}const rhe=(e,t,n=null)=>wle(new nhe(wle(e),t,n));class ihe extends Lse{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(void 0===n){const r=this.name,i=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,i,a,o),t.node=rhe(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation="fragment"===e.shaderStage),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Sse.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Sse.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),r=this.setupVarying(e);if(void 0===n[t]){const i=this.getNodeType(e),a=e.getPropertyName(r,Sse.VERTEX);e.flowNodeFromShaderStage(Sse.VERTEX,n.node,i,a),n[t]=a}return e.getPropertyName(r)}}const ahe=Mle(ihe).setParameterLength(1,2),ohe=e=>ahe(e);Kse("toVarying",ahe),Kse("toVertexStage",ohe),Kse("varying",(...e)=>(eJ("TSL: .varying() has been renamed to .toVarying()."),ahe(...e))),Kse("vertexStage",(...e)=>(eJ("TSL: .vertexStage() has been renamed to .toVertexStage()."),ahe(...e)));const she=Rle(([e])=>{const t=e.mul(.9478672986).add(.0521327014).pow(2.4),n=e.mul(.0773993808),r=e.lessThanEqual(.04045);return Pde(t,n,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),lhe=Rle(([e])=>{const t=e.pow(.41666).mul(1.055).sub(.055),n=e.mul(12.92),r=e.lessThanEqual(.0031308);return Pde(t,n,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),che="WorkingColorSpace";class uhe extends Dse{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===che?TJ.workingColorSpace:"OutputColorSpace"===t?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let i=t;return!1!==TJ.enabled&&n!==r&&n&&r?(TJ.getTransfer(n)===NZ&&(i=Yle(she(i.rgb),i.a)),TJ.getPrimaries(n)!==TJ.getPrimaries(r)&&(i=Yle(tce(TJ._getMatrix(new bJ,n,r)).mul(i.rgb),i.a)),TJ.getTransfer(r)===NZ&&(i=Yle(lhe(i.rgb),i.a)),i):i}}const dhe=(e,t)=>wle(new uhe(wle(e),che,t)),hhe=(e,t)=>wle(new uhe(wle(e),t,che));Kse("workingToColorSpace",dhe),Kse("colorSpaceToWorking",hhe);let phe=class extends Ose{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class fhe extends Lse{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Tse.OBJECT}setGroup(e){return this.group=e,this}element(e){return new phe(this,wle(e))}setNodeType(e){const t=Wce(null,e);null!==this.group&&t.setGroup(this.group),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class mhe extends fhe{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Vce)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}const ghe=(e,t,n=null)=>new mhe(e,t,n);class vhe extends Dse{static get type(){return"ToneMappingNode"}constructor(e,t=yhe,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return dse(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(0===n)return t;let r=null;const i=e.renderer.library.getToneMappingFunction(n);return null!==i?r=Yle(i(t.rgb,this.exposureNode),t.a):(tJ("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const Ahe=(e,t,n)=>wle(new vhe(e,wle(t),wle(n))),yhe=ghe("toneMappingExposure","float");Kse("toneMapping",(e,t,n)=>Ahe(t,n,e));const bhe=new WeakMap;function xhe(e,t){let n=bhe.get(e);return void 0===n&&(n=new c2(e,t),bhe.set(e,n)),n}class _he extends Vse{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=zZ,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;const t=this.getNodeType(e),n=e.getTypeLength(t),r=this.value,i=this.bufferStride||n,a=this.bufferOffset;let o;o=!0===r.isInterleavedBuffer?r:!0===r.isBufferAttribute?xhe(r.array,i):xhe(r,i);const s=new d2(o,n,a);o.setUsage(this.usage),this.attribute=s,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let i=null;if("vertex"===e.shaderStage||"compute"===e.shaderStage)this.name=r,i=r;else{i=ahe(this).build(e,t)}return i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function whe(e,t=null,n=0,r=0,i=35044,a=!1){return"mat3"===t||null===t&&9===e.itemSize?tce(new _he(e,"vec3",9,0).setUsage(i).setInstanced(a),new _he(e,"vec3",9,3).setUsage(i).setInstanced(a),new _he(e,"vec3",9,6).setUsage(i).setInstanced(a)):"mat4"===t||null===t&&16===e.itemSize?nce(new _he(e,"vec4",16,0).setUsage(i).setInstanced(a),new _he(e,"vec4",16,4).setUsage(i).setInstanced(a),new _he(e,"vec4",16,8).setUsage(i).setInstanced(a),new _he(e,"vec4",16,12).setUsage(i).setInstanced(a)):new _he(e,t,n,r)}const She=(e,t=null,n=0,r=0)=>whe(e,t,n,r),The=(e,t=null,n=0,r=0)=>whe(e,t,n,r,zZ,!0),Che=(e,t=null,n=0,r=0)=>whe(e,t,n,r,UZ,!0);Kse("toAttribute",e=>She(e.value));class Mhe extends Lse{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Tse.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return eJ('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){e.getNodeProperties(this).outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if("compute"===n){const t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t,this)}else{const n=e.getNodeProperties(this).outputComputeNode;if(n)return n.build(e,t)}}}const Ehe=(e,t=[64])=>{(0===t.length||t.length>3)&&tJ("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let n=0;n<t.length;n++){const e=t[n];("number"!==typeof e||e<=0||!Number.isInteger(e))&&tJ(`TSL: compute() workgroupSize element at index [ ${n} ] must be a positive integer`)}for(;t.length<3;)t.push(1);return wle(new Mhe(wle(e),t))},Phe=(e,t,n)=>Ehe(e,n).setCount(t);Kse("compute",Phe),Kse("computeKernel",Ehe);class Nhe extends Lse{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.build(e,...t);return e.setCache(n),i}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const khe=e=>new Nhe(wle(e));function Rhe(e,t=!0){return eJ('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),khe(e).setParent(t)}Kse("cache",Rhe),Kse("isolate",khe);class Lhe extends Lse{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const Ohe=Mle(Lhe).setParameterLength(2);Kse("bypass",Ohe);class jhe extends Lse{static get type(){return"RemapNode"}constructor(e,t,n,r=Ble(0),i=Ble(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:a}=this;let o=e.sub(t).div(n.sub(t));return!0===a&&(o=o.clamp()),o.mul(i.sub(r)).add(r)}}const Dhe=Mle(jhe,null,null,{doClamp:!1}).setParameterLength(3,5),Ihe=Mle(jhe).setParameterLength(3,5);Kse("remap",Dhe),Kse("remapClamp",Ihe);class Bhe extends Lse{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if("void"!==n)return e.format(r,n,t);e.addLineFlowCode(r,this)}}const Fhe=Mle(Bhe).setParameterLength(1,2),zhe=e=>(e?Gde(e,Fhe("discard")):Fhe("discard")).toStack();Kse("discard",zhe);class Uhe extends Dse{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(null!==this._toneMapping?this._toneMapping:e.toneMapping)||0,r=(null!==this.outputColorSpace?this.outputColorSpace:e.outputColorSpace)||CZ;return 0!==n&&(t=t.toneMapping(n)),r!==CZ&&r!==TJ.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const Vhe=(e,t=null,n=null)=>wle(new Uhe(wle(e),t,n));Kse("renderOutput",Vhe);class Ghe extends Dse{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(r.length);let a="";return a+="// #"+r+"#\n",a+=e.flow.code.replace(/^\t/gm,"")+"\n",a+="/* ... */ "+n+" /* ... */\n",a+="// #"+i+"#\n",null!==t?t(e,a):JZ(a),n}}const qhe=(e,t=null)=>wle(new Ghe(wle(e),t)).toStack();Kse("debug",qhe);class Whe{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class Hhe extends Lse{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Tse.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return!0===e.context.inspector&&null!==this.callback&&(t=this.callback(t)),!0!==e.renderer.backend.isWebGPUBackend&&e.renderer.inspector.constructor!==Whe&&nJ('TSL: ".toInspector()" is only available with WebGPU.'),t}}function $he(e,t="",n=null){return(e=wle(e)).before(new Hhe(e,t,n))}Kse("toInspector",$he);class Khe extends Lse{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(null===t){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(!0===e.hasGeometryAttribute(t)){const r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),a=e.getAttribute(t,i);if("vertex"===e.shaderStage)return e.format(a.name,i,n);return ahe(this).build(e,n)}return eJ(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Xhe=(e,t=null)=>new Khe(e,t),Yhe=(e=0)=>Xhe("uv"+(e>0?e:""),"vec2");class Qhe extends Lse{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const Zhe=Mle(Qhe).setParameterLength(1,2);class Jhe extends qce{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Tse.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&void 0!==n.width){const{width:e,height:t}=n;this.value=Math.log2(Math.max(e,t))}}}const epe=Mle(Jhe).setParameterLength(1),tpe=new jJ;class npe extends qce{static get type(){return"TextureNode"}constructor(e=tpe,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Tse.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===vQ?"uvec4":this.value.type===gQ?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Yhe(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=Wce(this.value.matrix)),this._matrixUniform.mul(Hle(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(null===this._flipYUniform&&(this._flipYUniform=Wce(!1)),t=t.toVar(),t=this.sampler?this._flipYUniform.select(t.flipY(),t):this._flipYUniform.select(t.setY(Fle(Zhe(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||!0!==n.isTexture)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const r=Rle(()=>{let t=this.uvNode;return null!==t&&!0!==e.context.forceUVContext||!e.context.getUV||(t=e.context.getUV(this,e)),t||(t=this.getDefaultUV()),!0===this.updateMatrix&&(t=this.getTransformedUV(t)),t=this.setupUV(e,t),this.updateType=null!==this._matrixUniform||null!==this._flipYUniform?Tse.OBJECT:Tse.NONE,t})();let i=this.levelNode;null===i&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,r,i,a,o,s,l){const c=this.value;let u;return u=i?e.generateTextureBias(c,t,n,i,a,l):s?e.generateTextureGrad(c,t,n,s,a,l):o?e.generateTextureCompare(c,t,n,o,a,l):!1===this.sampler?e.generateTextureLoad(c,t,n,r,a,l):r?e.generateTextureLevel(c,t,n,r,a,l):e.generateTexture(c,t,n,a,l),u}generate(e,t){const n=this.value,r=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const a=e.getDataFromNode(this);let o=a.propertyName;if(void 0===o){const{uvNode:t,levelNode:n,biasNode:s,compareNode:l,depthNode:c,gradNode:u,offsetNode:d}=r,h=this.generateUV(e,t),p=n?n.build(e,"float"):null,f=s?s.build(e,"float"):null,m=c?c.build(e,"int"):null,g=l?l.build(e,"float"):null,v=u?[u[0].build(e,"vec2"),u[1].build(e,"vec2")]:null,A=d?this.generateOffset(e,d):null,y=e.getVarFromNode(this);o=e.getPropertyName(y);const b=this.generateSnippet(e,i,h,p,f,m,g,v,A);e.addLineFlowCode(`${o} = ${b}`,this),a.snippet=b,a.propertyName=o}let s=o;const l=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(s=hhe(Fhe(s,l),n.colorSpace).setup(e).build(e,l)),e.format(s,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return eJ("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=wle(e),t.referenceNode=this.getBase(),wle(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=wle(e).mul(epe(t)),t.referenceNode=this.getBase();const n=t.value;return!1===t.generateMipmaps&&(n&&!1===n.generateMipmaps||n.minFilter===oQ||n.magFilter===oQ)&&(eJ("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),wle(t)}level(e){const t=this.clone();return t.levelNode=wle(e),t.referenceNode=this.getBase(),wle(t)}size(e){return Zhe(this,e)}bias(e){const t=this.clone();return t.biasNode=wle(e),t.referenceNode=this.getBase(),wle(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=wle(e),t.referenceNode=this.getBase(),wle(t)}grad(e,t){const n=this.clone();return n.gradNode=[wle(e),wle(t)],n.referenceNode=this.getBase(),wle(n)}depth(e){const t=this.clone();return t.depthNode=wle(e),t.referenceNode=this.getBase(),wle(t)}offset(e){const t=this.clone();return t.offsetNode=wle(e),t.referenceNode=this.getBase(),wle(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;null!==t&&(t.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix();const n=this._flipYUniform;null!==n&&(n.value=e.image instanceof ImageBitmap&&!0===e.flipY||!0===e.isRenderTargetTexture||!0===e.isFramebufferTexture||!0===e.isDepthTexture)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const rpe=Mle(npe).setParameterLength(1,4).setName("texture"),ipe=(e=tpe,t=null,n=null,r=null)=>{let i;return e&&!0===e.isTextureNode?(i=wle(e.clone()),i.referenceNode=e.getBase(),null!==t&&(i.uvNode=wle(t)),null!==n&&(i.levelNode=wle(n)),null!==r&&(i.biasNode=wle(r))):i=rpe(e,t,n,r),i},ape=(...e)=>ipe(...e).setSampler(!1);class ope extends qce{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const spe=(e,t,n)=>new ope(e,t,n);class lpe extends Ose{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class cpe extends ope{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=null===t?yse(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Tse.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return"mat2"===e?t="mat2":!0===/mat/.test(e)?t="mat4":"i"===e.charAt(0)?t="ivec4":"u"===e.charAt(0)&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if("float"===n||"int"===n||"uint"===n)for(let r=0;r<e.length;r++){t[4*r]=e[r]}else if("color"===n)for(let r=0;r<e.length;r++){const n=4*r,i=e[r];t[n]=i.r,t[n+1]=i.g,t[n+2]=i.b||0}else if("mat2"===n)for(let r=0;r<e.length;r++){const n=4*r,i=e[r];t[n]=i.elements[0],t[n+1]=i.elements[1],t[n+2]=i.elements[2],t[n+3]=i.elements[3]}else if("mat3"===n)for(let r=0;r<e.length;r++){const n=16*r,i=e[r];t[n]=i.elements[0],t[n+1]=i.elements[1],t[n+2]=i.elements[2],t[n+4]=i.elements[3],t[n+5]=i.elements[4],t[n+6]=i.elements[5],t[n+8]=i.elements[6],t[n+9]=i.elements[7],t[n+10]=i.elements[8],t[n+15]=1}else if("mat4"===n)for(let r=0;r<e.length;r++){const n=16*r,i=e[r];for(let e=0;e<i.elements.length;e++)t[n+e]=i.elements[e]}else for(let r=0;r<e.length;r++){const n=4*r,i=e[r];t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z||0,t[n+3]=i.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,a=e.getTypeLength(i);return"i"===n.charAt(0)&&(r=Int32Array),"u"===n.charAt(0)&&(r=Uint32Array),this.value=new r(t*a),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return new lpe(this,wle(e))}}const upe=(e,t)=>new cpe(e,t);const dpe=Mle(class extends Lse{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1);let hpe,ppe;class fpe extends Lse{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===fpe.DPR?"float":this.scope===fpe.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Tse.NONE;return this.scope!==fpe.SIZE&&this.scope!==fpe.VIEWPORT&&this.scope!==fpe.DPR||(e=Tse.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===fpe.VIEWPORT?null!==t?ppe.copy(t.viewport):(e.getViewport(ppe),ppe.multiplyScalar(e.getPixelRatio())):this.scope===fpe.DPR?this._output.value=e.getPixelRatio():null!==t?(hpe.width=t.width,hpe.height=t.height):e.getDrawingBufferSize(hpe)}setup(){const e=this.scope;let t=null;return t=e===fpe.SIZE?Wce(hpe||(hpe=new mJ)):e===fpe.VIEWPORT?Wce(ppe||(ppe=new DJ)):e===fpe.DPR?Wce(1):Vle(Ape.div(vpe)),this._output=t,t}generate(e){if(this.scope===fpe.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(vpe).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}fpe.COORDINATE="coordinate",fpe.VIEWPORT="viewport",fpe.SIZE="size",fpe.UV="uv",fpe.DPR="dpr";const mpe=Ele(fpe,fpe.DPR),gpe=Ele(fpe,fpe.UV),vpe=Ele(fpe,fpe.SIZE),Ape=Ele(fpe,fpe.COORDINATE),ype=Ele(fpe,fpe.VIEWPORT),bpe=ype.zw,xpe=Ape.sub(ype.xy),_pe=xpe.div(bpe),wpe=Rle(()=>(eJ('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),vpe),"vec2").once()(),Spe=Wce(0,"uint").setName("u_cameraIndex").setGroup(zce("cameraIndex")).toVarying("v_cameraIndex"),Tpe=Wce("float").setName("cameraNear").setGroup(Vce).onRenderUpdate(({camera:e})=>e.near),Cpe=Wce("float").setName("cameraFar").setGroup(Vce).onRenderUpdate(({camera:e})=>e.far),Mpe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.projectionMatrix);t=upe(n).setGroup(Vce).setName("cameraProjectionMatrices").element(e.isMultiViewCamera?dpe("gl_ViewID_OVR"):Spe).toConst("cameraProjectionMatrix")}else t=Wce("mat4").setName("cameraProjectionMatrix").setGroup(Vce).onRenderUpdate(({camera:e})=>e.projectionMatrix);return t}).once()(),Epe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.projectionMatrixInverse);t=upe(n).setGroup(Vce).setName("cameraProjectionMatricesInverse").element(e.isMultiViewCamera?dpe("gl_ViewID_OVR"):Spe).toConst("cameraProjectionMatrixInverse")}else t=Wce("mat4").setName("cameraProjectionMatrixInverse").setGroup(Vce).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse);return t}).once()(),Ppe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.matrixWorldInverse);t=upe(n).setGroup(Vce).setName("cameraViewMatrices").element(e.isMultiViewCamera?dpe("gl_ViewID_OVR"):Spe).toConst("cameraViewMatrix")}else t=Wce("mat4").setName("cameraViewMatrix").setGroup(Vce).onRenderUpdate(({camera:e})=>e.matrixWorldInverse);return t}).once()(),Npe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.matrixWorld);t=upe(n).setGroup(Vce).setName("cameraWorldMatrices").element(e.isMultiViewCamera?dpe("gl_ViewID_OVR"):Spe).toConst("cameraWorldMatrix")}else t=Wce("mat4").setName("cameraWorldMatrix").setGroup(Vce).onRenderUpdate(({camera:e})=>e.matrixWorld);return t}).once()(),kpe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.normalMatrix);t=upe(n).setGroup(Vce).setName("cameraNormalMatrices").element(e.isMultiViewCamera?dpe("gl_ViewID_OVR"):Spe).toConst("cameraNormalMatrix")}else t=Wce("mat3").setName("cameraNormalMatrix").setGroup(Vce).onRenderUpdate(({camera:e})=>e.normalMatrix);return t}).once()(),Rpe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(let t=0,i=e.cameras.length;t<i;t++)n.push(new vJ);const r=upe(n).setGroup(Vce).setName("cameraPositions").onRenderUpdate(({camera:e},t)=>{const n=e.cameras,r=t.array;for(let i=0,a=n.length;i<a;i++)r[i].setFromMatrixPosition(n[i].matrixWorld)});t=r.element(e.isMultiViewCamera?dpe("gl_ViewID_OVR"):Spe).toConst("cameraPosition")}else t=Wce(new vJ).setName("cameraPosition").setGroup(Vce).onRenderUpdate(({camera:e},t)=>t.value.setFromMatrixPosition(e.matrixWorld));return t}).once()(),Lpe=Rle(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.viewport);t=upe(n,"vec4").setGroup(Vce).setName("cameraViewports").element(Spe).toConst("cameraViewport")}else t=Yle(0,0,vpe.x,vpe.y).toConst("cameraViewport");return t}).once()(),Ope=new a0;class jpe extends Lse{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Tse.OBJECT,this.uniformNode=new qce(null)}getNodeType(){const e=this.scope;return e===jpe.WORLD_MATRIX?"mat4":e===jpe.POSITION||e===jpe.VIEW_POSITION||e===jpe.DIRECTION||e===jpe.SCALE?"vec3":e===jpe.RADIUS?"float":void 0}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===jpe.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===jpe.POSITION)n.value=n.value||new vJ,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===jpe.SCALE)n.value=n.value||new vJ,n.value.setFromMatrixScale(t.matrixWorld);else if(r===jpe.DIRECTION)n.value=n.value||new vJ,t.getWorldDirection(n.value);else if(r===jpe.VIEW_POSITION){const r=e.camera;n.value=n.value||new vJ,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}else if(r===jpe.RADIUS){const r=e.object.geometry;null===r.boundingSphere&&r.computeBoundingSphere(),Ope.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),n.value=Ope.radius}}generate(e){const t=this.scope;return t===jpe.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===jpe.POSITION||t===jpe.VIEW_POSITION||t===jpe.DIRECTION||t===jpe.SCALE?this.uniformNode.nodeType="vec3":t===jpe.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}jpe.WORLD_MATRIX="worldMatrix",jpe.POSITION="position",jpe.SCALE="scale",jpe.VIEW_POSITION="viewPosition",jpe.DIRECTION="direction",jpe.RADIUS="radius";const Dpe=Mle(jpe,jpe.DIRECTION).setParameterLength(1),Ipe=Mle(jpe,jpe.WORLD_MATRIX).setParameterLength(1),Bpe=Mle(jpe,jpe.POSITION).setParameterLength(1),Fpe=Mle(jpe,jpe.SCALE).setParameterLength(1),zpe=Mle(jpe,jpe.VIEW_POSITION).setParameterLength(1),Upe=Mle(jpe,jpe.RADIUS).setParameterLength(1);class Vpe extends jpe{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const Gpe=Ele(Vpe,Vpe.DIRECTION),qpe=Ele(Vpe,Vpe.WORLD_MATRIX),Wpe=Ele(Vpe,Vpe.POSITION),Hpe=Ele(Vpe,Vpe.SCALE),$pe=Ele(Vpe,Vpe.VIEW_POSITION),Kpe=Ele(Vpe,Vpe.RADIUS),Xpe=Wce(new bJ).onObjectUpdate(({object:e},t)=>t.value.getNormalMatrix(e.matrixWorld)),Ype=Wce(new f0).onObjectUpdate(({object:e},t)=>t.value.copy(e.matrixWorld).invert()),Qpe=Rle(e=>e.context.modelViewMatrix||Zpe).once()().toVar("modelViewMatrix"),Zpe=Ppe.mul(qpe),Jpe=Rle(e=>(e.context.isHighPrecisionModelViewMatrix=!0,Wce("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),efe=Rle(e=>{const t=e.context.isHighPrecisionModelViewMatrix;return Wce("mat3").onObjectUpdate(({object:e,camera:n})=>(!0!==t&&e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),tfe=Xhe("position","vec3"),nfe=tfe.toVarying("positionLocal"),rfe=tfe.toVarying("positionPrevious"),ife=Rle(e=>qpe.mul(nfe).xyz.toVarying(e.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),afe=Rle(()=>nfe.transformDirection(qpe).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ofe=Rle(e=>e.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),sfe=Rle(e=>{let t;return t=e.camera.isOrthographicCamera?Hle(0,0,1):ofe.negate().toVarying("v_positionViewDirection").normalize(),t.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class lfe extends Lse{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if("fragment"!==e.shaderStage)return"true";const{material:t}=e;return 1===t.side?"false":e.getFrontFacing()}}const cfe=Ele(lfe),ufe=Ble(cfe).mul(2).sub(1),dfe=Rle(([e],{material:t})=>{const n=t.side;return 1===n?e=e.mul(-1):2===n&&(e=e.mul(ufe)),e}),hfe=Xhe("normal","vec3"),pfe=Rle(e=>!1===e.geometry.hasAttribute("normal")?(eJ('TSL: Vertex attribute "normal" not found on geometry.'),Hle(0,1,0)):hfe,"vec3").once()().toVar("normalLocal"),ffe=ofe.dFdx().cross(ofe.dFdy()).normalize().toVar("normalFlat"),mfe=Rle(e=>{let t;return t=!0===e.material.flatShading?ffe:xfe(pfe).toVarying("v_normalViewGeometry").normalize(),t},"vec3").once()().toVar("normalViewGeometry"),gfe=Rle(e=>{let t=mfe.transformDirection(Ppe);return!0!==e.material.flatShading&&(t=t.toVarying("v_normalWorldGeometry")),t.normalize().toVar("normalWorldGeometry")},"vec3").once()(),vfe=Rle(({subBuildFn:e,material:t,context:n})=>{let r;return"NORMAL"===e||"VERTEX"===e?(r=mfe,!0!==t.flatShading&&(r=dfe(r))):r=n.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Afe=vfe.transformDirection(Ppe).toVar("normalWorld"),yfe=Rle(({subBuildFn:e,context:t})=>{let n;return n="NORMAL"===e||"VERTEX"===e?vfe:t.setupClearcoatNormal().context({getUV:null}),n},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),bfe=Rle(([e,t=qpe])=>{const n=tce(t),r=e.div(Hle(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2])));return n.mul(r).xyz}),xfe=Rle(([e],t)=>{const n=t.context.modelNormalViewMatrix;if(n)return n.transformDirection(e);const r=Xpe.mul(e);return Ppe.transformDirection(r)}),_fe=Rle(()=>(eJ('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),vfe)).once(["NORMAL","VERTEX"])(),wfe=Rle(()=>(eJ('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Afe)).once(["NORMAL","VERTEX"])(),Sfe=Rle(()=>(eJ('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),yfe)).once(["NORMAL","VERTEX"])(),Tfe=new S0,Cfe=new f0,Mfe=Wce(0).onReference(({material:e})=>e).onObjectUpdate(({material:e})=>e.refractionRatio),Efe=Wce(1).onReference(({material:e})=>e).onObjectUpdate(function({material:e,scene:t}){return e.envMap?e.envMapIntensity:t.environmentIntensity}),Pfe=Wce(new f0).onReference(function(e){return e.material}).onObjectUpdate(function({material:e,scene:t}){const n=null!==t.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation;return n?(Tfe.copy(n),Cfe.makeRotationFromEuler(Tfe)):Cfe.identity(),Cfe}),Nfe=sfe.negate().reflect(vfe),kfe=sfe.negate().refract(vfe,Mfe),Rfe=Nfe.transformDirection(Ppe).toVar("reflectVector"),Lfe=kfe.transformDirection(Ppe).toVar("reflectVector"),Ofe=new r2;class jfe extends npe{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return!0===this.value.isDepthTexture?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===ZY?Rfe:e.mapping===JY?Lfe:(tJ('CubeTextureNode: Mapping "%s" not supported.',e.mapping),Hle(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return!0===n.isDepthTexture?e.renderer.coordinateSystem===qZ?Hle(t.x,t.y.negate(),t.z):t:(e.renderer.coordinateSystem!==qZ&&n.isRenderTargetTexture||(t=Hle(t.x.negate(),t.yz)),Pfe.mul(t))}generateUV(e,t){return t.build(e,!0===this.sampler?"vec3":"ivec3")}}const Dfe=Mle(jfe).setParameterLength(1,4).setName("cubeTexture"),Ife=(e=Ofe,t=null,n=null,r=null)=>{let i;return e&&!0===e.isCubeTextureNode?(i=wle(e.clone()),i.referenceNode=e,null!==t&&(i.uvNode=wle(t)),null!==n&&(i.levelNode=wle(n)),null!==r&&(i.biasNode=wle(r))):i=Dfe(e,t,n,r),i};class Bfe extends Ose{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class Ffe extends Lse{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Tse.OBJECT}element(e){return new Bfe(this,wle(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return eJ('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;t=null!==this.count?spe(null,e,this.count):Array.isArray(this.getValueFromReference())?upe(null,e):"texture"===e?ipe(null):"cubeTexture"===e?Ife(null):Wce(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.setName(this.name),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const zfe=(e,t,n)=>new Ffe(e,t,n),Ufe=(e,t,n,r)=>new Ffe(e,t,r,n);class Vfe extends Ffe{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}const Gfe=(e,t,n=null)=>new Vfe(e,t,n),qfe=Yhe(),Wfe=ofe.dFdx(),Hfe=ofe.dFdy(),$fe=qfe.dFdx(),Kfe=qfe.dFdy(),Xfe=vfe,Yfe=Hfe.cross(Xfe),Qfe=Xfe.cross(Wfe),Zfe=Yfe.mul($fe.x).add(Qfe.mul(Kfe.x)),Jfe=Yfe.mul($fe.y).add(Qfe.mul(Kfe.y)),eme=Zfe.dot(Zfe).max(Jfe.dot(Jfe)),tme=eme.equal(0).select(0,eme.inverseSqrt()),nme=Zfe.mul(tme).toVar("tangentViewFrame"),rme=Jfe.mul(tme).toVar("bitangentViewFrame"),ime=Xhe("tangent","vec4"),ame=ime.xyz.toVar("tangentLocal"),ome=Rle(({subBuildFn:e,geometry:t,material:n})=>{let r;return r="VERTEX"===e||t.hasAttribute("tangent")?Qpe.mul(Yle(ame,0)).xyz.toVarying("v_tangentView").normalize():nme,!0!==n.flatShading&&(r=dfe(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),sme=ome.transformDirection(Ppe).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),lme=Rle(([e,t],{subBuildFn:n,material:r})=>{let i=e.mul(ime.w).xyz;return"NORMAL"===n&&!0!==r.flatShading&&(i=i.toVarying(t)),i}).once(["NORMAL"]),cme=lme(hfe.cross(ime),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),ume=lme(pfe.cross(ame),"v_bitangentLocal").normalize().toVar("bitangentLocal"),dme=Rle(({subBuildFn:e,geometry:t,material:n})=>{let r;return r="VERTEX"===e||t.hasAttribute("tangent")?lme(vfe.cross(ome),"v_bitangentView").normalize():rme,!0!==n.flatShading&&(r=dfe(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),hme=lme(Afe.cross(sme),"v_bitangentWorld").normalize().toVar("bitangentWorld"),pme=tce(ome,dme,vfe).toVar("TBNViewMatrix"),fme=sfe.mul(pme),mme=Rle(()=>{let e=wce.cross(sfe);return e=e.cross(wce).normalize(),e=Pde(e,vfe,xce.mul(dce.oneMinus()).oneMinus().pow2().pow2()).normalize(),e}).once()(),gme=e=>wle(e).mul(.5).add(.5),vme=e=>Hle(e,Uue(kde(Ble(1).sub(bde(e,e)))));class Ame extends Dse{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=0,this.unpackNormalMode=""}setup({material:e}){const{normalMapType:t,scaleNode:n,unpackNormalMode:r}=this;let i=this.node.mul(2).sub(1);if(0===t?"rg"===r?i=vme(i.xy):"ga"===r?i=vme(i.yw):""!==r&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${r}`):""!==r&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${r}'`),null!==n){let t=n;!0===e.flatShading&&(t=dfe(t)),i=Hle(i.xy.mul(t),i.z)}let a=null;return 1===t?a=xfe(i):0===t?a=pme.mul(i).normalize():(tJ(`NodeMaterial: Unsupported normal map type: ${t}`),a=vfe),a}}const yme=Mle(Ame).setParameterLength(1,2),bme=Rle(({textureNode:e,bumpScale:t})=>{const n=t=>e.isolate().context({getUV:e=>t(e.uvNode||Yhe()),forceUVContext:!0}),r=Ble(n(e=>e));return Vle(Ble(n(e=>e.add(e.dFdx()))).sub(r),Ble(n(e=>e.add(e.dFdy()))).sub(r)).mul(t)}),xme=Rle(e=>{const{surf_pos:t,surf_norm:n,dHdxy:r}=e,i=t.dFdx().normalize(),a=n,o=t.dFdy().normalize().cross(a),s=a.cross(i),l=i.dot(o).mul(ufe),c=l.sign().mul(r.x.mul(o).add(r.y.mul(s)));return l.abs().mul(n).sub(c).normalize()});class _me extends Dse{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=null!==this.scaleNode?this.scaleNode:1,t=bme({textureNode:this.textureNode,bumpScale:e});return xme({surf_pos:ofe,surf_norm:vfe,dHdxy:t})}}const wme=Mle(_me).setParameterLength(1,2),Sme=new Map;class Tme extends Lse{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=Sme.get(e);return void 0===n&&(n=Gfe(e,t),Sme.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===Tme.COLOR){const e=void 0!==t.color?this.getColor(n):Hle();r=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(n===Tme.OPACITY){const e=this.getFloat(n);r=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(n===Tme.SPECULAR_STRENGTH)r=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture("specular").r:Ble(1);else if(n===Tme.SPECULAR_INTENSITY){const e=this.getFloat(n);r=t.specularIntensityMap&&!0===t.specularIntensityMap.isTexture?e.mul(this.getTexture(n).a):e}else if(n===Tme.SPECULAR_COLOR){const e=this.getColor(n);r=t.specularColorMap&&!0===t.specularColorMap.isTexture?e.mul(this.getTexture(n).rgb):e}else if(n===Tme.ROUGHNESS){const e=this.getFloat(n);r=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(n).g):e}else if(n===Tme.METALNESS){const e=this.getFloat(n);r=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(n).b):e}else if(n===Tme.EMISSIVE){const e=this.getFloat("emissiveIntensity"),i=this.getColor(n).mul(e);r=t.emissiveMap&&!0===t.emissiveMap.isTexture?i.mul(this.getTexture(n)):i}else if(n===Tme.NORMAL)t.normalMap?(r=yme(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType,t.normalMap.format!=RQ&&t.normalMap.format!=mZ&&t.normalMap.format!=KQ||(r.unpackNormalMode="rg")):r=t.bumpMap?wme(this.getTexture("bump").r,this.getFloat("bumpScale")):vfe;else if(n===Tme.CLEARCOAT){const e=this.getFloat(n);r=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===Tme.CLEARCOAT_ROUGHNESS){const e=this.getFloat(n);r=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===Tme.CLEARCOAT_NORMAL)r=t.clearcoatNormalMap?yme(this.getTexture(n),this.getCache(n+"Scale","vec2")):vfe;else if(n===Tme.SHEEN){const e=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(n===Tme.SHEEN_ROUGHNESS){const e=this.getFloat(n);r=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(n).a):e,r=r.clamp(1e-4,1)}else if(n===Tme.ANISOTROPY)if(t.anisotropyMap&&!0===t.anisotropyMap.isTexture){const e=this.getTexture(n);r=ece(cge.x,cge.y,cge.y.negate(),cge.x).mul(e.rg.mul(2).sub(Vle(1)).normalize().mul(e.b))}else r=cge;else if(n===Tme.IRIDESCENCE_THICKNESS){const e=zfe("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const i=zfe("0","float",t.iridescenceThicknessRange);r=e.sub(i).mul(this.getTexture(n).g).add(i)}else r=e}else if(n===Tme.TRANSMISSION){const e=this.getFloat(n);r=t.transmissionMap?e.mul(this.getTexture(n).r):e}else if(n===Tme.THICKNESS){const e=this.getFloat(n);r=t.thicknessMap?e.mul(this.getTexture(n).g):e}else if(n===Tme.IOR)r=this.getFloat(n);else if(n===Tme.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Tme.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===Tme.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):Ble(0);else{const t=this.getNodeType(e);r=this.getCache(n,t)}return r}}Tme.ALPHA_TEST="alphaTest",Tme.COLOR="color",Tme.OPACITY="opacity",Tme.SHININESS="shininess",Tme.SPECULAR="specular",Tme.SPECULAR_STRENGTH="specularStrength",Tme.SPECULAR_INTENSITY="specularIntensity",Tme.SPECULAR_COLOR="specularColor",Tme.REFLECTIVITY="reflectivity",Tme.ROUGHNESS="roughness",Tme.METALNESS="metalness",Tme.NORMAL="normal",Tme.CLEARCOAT="clearcoat",Tme.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Tme.CLEARCOAT_NORMAL="clearcoatNormal",Tme.EMISSIVE="emissive",Tme.ROTATION="rotation",Tme.SHEEN="sheen",Tme.SHEEN_ROUGHNESS="sheenRoughness",Tme.ANISOTROPY="anisotropy",Tme.IRIDESCENCE="iridescence",Tme.IRIDESCENCE_IOR="iridescenceIOR",Tme.IRIDESCENCE_THICKNESS="iridescenceThickness",Tme.IOR="ior",Tme.TRANSMISSION="transmission",Tme.THICKNESS="thickness",Tme.ATTENUATION_DISTANCE="attenuationDistance",Tme.ATTENUATION_COLOR="attenuationColor",Tme.LINE_SCALE="scale",Tme.LINE_DASH_SIZE="dashSize",Tme.LINE_GAP_SIZE="gapSize",Tme.LINE_WIDTH="linewidth",Tme.LINE_DASH_OFFSET="dashOffset",Tme.POINT_SIZE="size",Tme.DISPERSION="dispersion",Tme.LIGHT_MAP="light",Tme.AO="ao";const Cme=Ele(Tme,Tme.ALPHA_TEST),Mme=Ele(Tme,Tme.COLOR),Eme=Ele(Tme,Tme.SHININESS),Pme=Ele(Tme,Tme.EMISSIVE),Nme=Ele(Tme,Tme.OPACITY),kme=Ele(Tme,Tme.SPECULAR),Rme=Ele(Tme,Tme.SPECULAR_INTENSITY),Lme=Ele(Tme,Tme.SPECULAR_COLOR),Ome=Ele(Tme,Tme.SPECULAR_STRENGTH),jme=Ele(Tme,Tme.REFLECTIVITY),Dme=Ele(Tme,Tme.ROUGHNESS),Ime=Ele(Tme,Tme.METALNESS),Bme=Ele(Tme,Tme.NORMAL),Fme=Ele(Tme,Tme.CLEARCOAT),zme=Ele(Tme,Tme.CLEARCOAT_ROUGHNESS),Ume=Ele(Tme,Tme.CLEARCOAT_NORMAL),Vme=Ele(Tme,Tme.ROTATION),Gme=Ele(Tme,Tme.SHEEN),qme=Ele(Tme,Tme.SHEEN_ROUGHNESS),Wme=Ele(Tme,Tme.ANISOTROPY),Hme=Ele(Tme,Tme.IRIDESCENCE),$me=Ele(Tme,Tme.IRIDESCENCE_IOR),Kme=Ele(Tme,Tme.IRIDESCENCE_THICKNESS),Xme=Ele(Tme,Tme.TRANSMISSION),Yme=Ele(Tme,Tme.THICKNESS),Qme=Ele(Tme,Tme.IOR),Zme=Ele(Tme,Tme.ATTENUATION_DISTANCE),Jme=Ele(Tme,Tme.ATTENUATION_COLOR),ege=Ele(Tme,Tme.LINE_SCALE),tge=Ele(Tme,Tme.LINE_DASH_SIZE),nge=Ele(Tme,Tme.LINE_GAP_SIZE),rge=Ele(Tme,Tme.LINE_WIDTH),ige=Ele(Tme,Tme.LINE_DASH_OFFSET),age=Ele(Tme,Tme.POINT_SIZE),oge=Ele(Tme,Tme.DISPERSION),sge=Ele(Tme,Tme.LIGHT_MAP),lge=Ele(Tme,Tme.AO),cge=Wce(new mJ).onReference(function(e){return e.material}).onRenderUpdate(function({material:e}){this.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation))}),uge=Rle(e=>e.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class dge extends Ose{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return!1===e.isAvailable("storageBuffer")&&!0===this.node.isPBO&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const r=e.context.assign;if(n=!1===e.isAvailable("storageBuffer")?!0!==this.node.isPBO||!0===r||!this.node.value.isInstancedBufferAttribute&&"compute"===e.shaderStage?this.node.build(e):e.generatePBO(this):super.generate(e),!0!==r){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}const hge=Mle(dge).setParameterLength(2);class pge extends ope{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let r,i=null;t&&t.isStruct?(r="struct",i=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):null===t&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=fse(e.itemSize),n=e.count):r=t,super(e,r,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=Cse.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,!0!==e.isStorageBufferAttribute&&!0!==e.isStorageInstancedBufferAttribute&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(0===this.bufferCount){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return hge(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Cse.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return null===this._attribute&&(this._attribute=She(this.value),this._varying=ahe(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(null!==this.structTypeNode)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return null!==this.structTypeNode?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(null!==this.structTypeNode&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),r=n.build(e);return e.registerTransform(r,t),r}}const fge=(e,t=null,n=0)=>new pge(e,t,n);class mge extends Lse{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r,i;if(n===mge.VERTEX)r=e.getVertexIndex();else if(n===mge.INSTANCE)r=e.getInstanceIndex();else if(n===mge.DRAW)r=e.getDrawIndex();else if(n===mge.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===mge.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else{if(n!==mge.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+n);r=e.getSubgroupIndex()}if("vertex"===e.shaderStage||"compute"===e.shaderStage)i=r;else{i=ahe(this).build(e,t)}return i}}mge.VERTEX="vertex",mge.INSTANCE="instance",mge.SUBGROUP="subgroup",mge.INVOCATION_LOCAL="invocationLocal",mge.INVOCATION_SUBGROUP="invocationSubgroup",mge.DRAW="draw";const gge=Ele(mge,mge.VERTEX),vge=Ele(mge,mge.INSTANCE),Age=Ele(mge,mge.SUBGROUP),yge=Ele(mge,mge.INVOCATION_SUBGROUP),bge=Ele(mge,mge.INVOCATION_LOCAL),xge=Ele(mge,mge.DRAW);class _ge extends Lse{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Tse.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&!0===e.isStorageInstancedBufferAttribute}get isStorageColor(){const{instanceColor:e}=this;return e&&!0===e.isStorageInstancedBufferAttribute}setup(e){const{instanceMatrix:t,instanceColor:n,isStorageMatrix:r,isStorageColor:i}=this,{count:a}=t;let{instanceMatrixNode:o,instanceColorNode:s}=this;if(null===o){if(r)o=fge(t,"mat4",Math.max(a,1)).element(vge);else if(a<=1e3)o=spe(t.array,"mat4",Math.max(a,1)).element(vge);else{const e=new o5(t.array,16,1);this.buffer=e;const n=t.usage===UZ?Che:The,r=[n(e,"vec4",16,0),n(e,"vec4",16,4),n(e,"vec4",16,8),n(e,"vec4",16,12)];o=nce(...r)}this.instanceMatrixNode=o}if(n&&null===s){if(i)s=fge(n,"vec3",Math.max(n.count,1)).element(vge);else{const e=new f2(n.array,3),t=n.usage===UZ?Che:The;this.bufferColor=e,s=Hle(t(e,"vec3",3,0))}this.instanceColorNode=s}const l=o.mul(nfe).xyz;if(nfe.assign(l),e.hasGeometryAttribute("normal")){const e=bfe(pfe,o);pfe.assign(e)}null!==this.instanceColorNode&&sce("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){null!==this.buffer&&!0!==this.isStorageMatrix&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==UZ&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&null!==this.bufferColor&&!0!==this.isStorageColor&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==UZ&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const wge=Mle(_ge).setParameterLength(2,3);class Sge extends _ge{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const Tge=Mle(Sge).setParameterLength(1);class Cge extends Lse{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=vge:this.batchingIdNode=xge);const t=Rle(([e])=>{const t=Fle(Zhe(ape(this.batchMesh._indirectTexture),0).x).toConst(),n=Fle(e).mod(t).toConst(),r=Fle(e).div(t).toConst();return ape(this.batchMesh._indirectTexture,Gle(n,r)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),n=t(Fle(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=Fle(Zhe(ape(r),0).x).toConst(),a=Ble(n).mul(4).toInt().toConst(),o=a.mod(i).toConst(),s=a.div(i).toConst(),l=nce(ape(r,Gle(o,s)),ape(r,Gle(o.add(1),s)),ape(r,Gle(o.add(2),s)),ape(r,Gle(o.add(3),s))),c=this.batchMesh._colorsTexture;if(null!==c){const e=Rle(([e])=>{const t=Fle(Zhe(ape(c),0).x).toConst(),n=e,r=n.mod(t).toConst(),i=n.div(t).toConst();return ape(c,Gle(r,i)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),t=e(n);sce("vec3","vBatchColor").assign(t)}const u=tce(l);nfe.assign(l.mul(nfe));const d=pfe.div(Hle(u[0].dot(u[0]),u[1].dot(u[1]),u[2].dot(u[2]))),h=u.mul(d).xyz;pfe.assign(h),e.hasGeometryAttribute("tangent")&&ame.mulAssign(u)}}const Mge=Mle(Cge).setParameterLength(1),Ege=new WeakMap;class Pge extends Lse{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Tse.OBJECT,this.skinIndexNode=Xhe("skinIndex","uvec4"),this.skinWeightNode=Xhe("skinWeight","vec4"),this.bindMatrixNode=zfe("bindMatrix","mat4"),this.bindMatrixInverseNode=zfe("bindMatrixInverse","mat4"),this.boneMatricesNode=Ufe("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=nfe,this.toPositionNode=nfe,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,o=e.element(n.x),s=e.element(n.y),l=e.element(n.z),c=e.element(n.w),u=i.mul(t),d=eue(o.mul(r.x).mul(u),s.mul(r.y).mul(u),l.mul(r.z).mul(u),c.mul(r.w).mul(u));return a.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=pfe){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,o=e.element(n.x),s=e.element(n.y),l=e.element(n.z),c=e.element(n.w);let u=eue(r.x.mul(o),r.y.mul(s),r.z.mul(l),r.w.mul(c));return u=a.mul(u).mul(i),u.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return null===this.previousBoneMatricesNode&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=Ufe("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,rfe)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||!0===xse(e.object).useVelocity}setup(e){this.needsPreviousBoneMatrices(e)&&rfe.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const t=this.getSkinnedNormal();pfe.assign(t),e.hasGeometryAttribute("tangent")&&ame.assign(t)}return t}generate(e,t){if("void"!==t)return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Ege.get(t)!==e.frameId&&(Ege.set(t,e.frameId),null!==this.previousBoneMatricesNode&&(null===t.previousBoneMatrices&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const Nge=e=>new Pge(e);class kge extends Lse{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;const n={};for(let o=0,s=this.params.length-1;o<s;o++){const e=this.params[o],t=!0!==e.isNode&&e.name||this.getVarName(o),r=!0!==e.isNode&&e.type||"int";n[t]=Fhe(t,r)}const r=e.addStack(),i=this.params[this.params.length-1](n);t.returnsNode=i.context({nodeLoop:i}),t.stackNode=r;const a=this.params[0];if(!0!==a.isNode&&"function"===typeof a.update){const e=Rle(this.params[0].update)(n);t.updateNode=e.context({nodeLoop:e})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){e.getDataFromNode(e.fnCall.shaderNode).hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let a=0,o=n.length-1;a<o;a++){const r=n[a];let i,o=!1,s=null,l=null,c=null,u=null,d=null,h=null;if(r.isNode?"bool"===r.getNodeType(e)?(o=!0,u="bool",l=r.build(e,u)):(u="int",c=this.getVarName(a),s="0",l=r.build(e,u),d="<"):(u=r.type||"int",c=r.name||this.getVarName(a),s=r.start,l=r.end,d=r.condition,h=r.update,"number"===typeof s?s=e.generateConst(u,s):s&&s.isNode&&(s=s.build(e,u)),"number"===typeof l?l=e.generateConst(u,l):l&&l.isNode&&(l=l.build(e,u)),void 0!==s&&void 0===l?(s+=" - 1",l="0",d=">="):void 0!==l&&void 0===s&&(s="0",d="<"),void 0===d&&(d=Number(s)>Number(l)?">=":"<")),o)i=`while ( ${l} )`;else{const n={start:s,end:l},r=n.start,a=n.end;let o;const p=()=>d.includes("<")?"+=":"-=";if(void 0!==h&&null!==h)switch(typeof h){case"function":o=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":o=c+" "+p()+" "+e.generateConst(u,h);break;case"string":o=c+" "+h;break;default:h.isNode?o=c+" "+p()+" "+h.build(e):(tJ("TSL: 'Loop( { update: ... } )' is not a function, string or number."),o="break /* invalid update */")}else h="int"===u||"uint"===u?d.includes("<")?"++":"--":p()+" 1.",o=c+" "+h;i=`for ( ${e.getVar(u,c)+" = "+r}; ${c+" "+d+" "+a}; ${o} )`}e.addFlowCode((0===a?"\n":"")+e.tab+i+" {\n\n").addFlowTab()}const i=r.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode("\n"+e.tab+i);for(let a=0,o=this.params.length-1;a<o;a++)e.addFlowCode((0===a?"":e.tab)+"}\n\n").removeFlowTab();e.addFlowTab()}}const Rge=(...e)=>new kge(Cle(e,"int")).toStack(),Lge=()=>Fhe("break").toStack(),Oge=new WeakMap,jge=new DJ,Dge=Rle(({bufferMap:e,influence:t,stride:n,width:r,depth:i,offset:a})=>{const o=Fle(gge).mul(n).add(a),s=o.div(r),l=o.sub(s.mul(r));return ape(e,Gle(l,s)).depth(i).xyz.mul(t)});class Ige extends Lse{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Wce(1),this.updateType=Tse.OBJECT}setup(e){const{geometry:t}=e,n=void 0!==t.morphAttributes.position,r=t.hasAttribute("normal")&&void 0!==t.morphAttributes.normal,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=void 0!==i?i.length:0,{texture:o,stride:s,size:l}=function(e){const t=void 0!==e.morphAttributes.position,n=void 0!==e.morphAttributes.normal,r=void 0!==e.morphAttributes.color,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=void 0!==i?i.length:0;let o=Oge.get(e);if(void 0===o||o.count!==a){void 0!==o&&o.texture.dispose();const s=e.morphAttributes.position||[],l=e.morphAttributes.normal||[],c=e.morphAttributes.color||[];let u=0;!0===t&&(u=1),!0===n&&(u=2),!0===r&&(u=3);let d=e.attributes.position.count*u,h=1;const p=4096;d>p&&(h=Math.ceil(d/p),d=p);const f=new Float32Array(d*h*4*a),m=new FJ(f,d,h,a);m.type=AQ,m.needsUpdate=!0;const g=4*u;for(let A=0;A<a;A++){const y=s[A],b=l[A],x=c[A],_=d*h*4*A;for(let w=0;w<y.count;w++){const S=w*g;!0===t&&(jge.fromBufferAttribute(y,w),f[_+S+0]=jge.x,f[_+S+1]=jge.y,f[_+S+2]=jge.z,f[_+S+3]=0),!0===n&&(jge.fromBufferAttribute(b,w),f[_+S+4]=jge.x,f[_+S+5]=jge.y,f[_+S+6]=jge.z,f[_+S+7]=0),!0===r&&(jge.fromBufferAttribute(x,w),f[_+S+8]=jge.x,f[_+S+9]=jge.y,f[_+S+10]=jge.z,f[_+S+11]=4===x.itemSize?jge.w:1)}}function v(){m.dispose(),Oge.delete(e),e.removeEventListener("dispose",v)}o={count:a,texture:m,stride:u,size:new mJ(d,h)},Oge.set(e,o),e.addEventListener("dispose",v)}return o}(t);!0===n&&nfe.mulAssign(this.morphBaseInfluence),!0===r&&pfe.mulAssign(this.morphBaseInfluence);const c=Fle(l.width);Rge(a,({i:e})=>{const t=Ble(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?t.assign(ape(this.mesh.morphTexture,Gle(Fle(e).add(1),Fle(vge))).r):t.assign(zfe("morphTargetInfluences","float").element(e).toVar()),jle(t.notEqual(0),()=>{!0===n&&nfe.addAssign(Dge({bufferMap:o,influence:t,stride:s,width:c,depth:e,offset:Fle(0)})),!0===r&&pfe.addAssign(Dge({bufferMap:o,influence:t,stride:s,width:c,depth:e,offset:Fle(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}const Bge=Mle(Ige).setParameterLength(1);class Fge extends Lse{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class zge extends Fge{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Uge extends qde{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n={directDiffuse:Hle().toVar("directDiffuse"),directSpecular:Hle().toVar("directSpecular"),indirectDiffuse:Hle().toVar("indirectDiffuse"),indirectSpecular:Hle().toVar("indirectSpecular")};return{radiance:Hle().toVar("radiance"),irradiance:Hle().toVar("irradiance"),iblIrradiance:Hle().toVar("iblIrradiance"),ambientOcclusion:Ble(1).toVar("ambientOcclusion"),reflectedLight:n,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Vge=Mle(Uge);class Gge extends Fge{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const qge=new mJ;class Wge extends npe{static get type(){return"ViewportTextureNode"}constructor(e=gpe,t=null,n=null){let r=null;null===n?(r=new H2,r.minFilter=dQ,n=r):r=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Tse.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),null===e)return t;if(!1===n.has(e)){const r=t.clone();n.set(e,r)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();null===n?t.getDrawingBufferSize(qge):qge.set(n.width,n.height);const r=this.getTextureForReference(n);r.image.width===qge.width&&r.image.height===qge.height||(r.image.width=qge.width,r.image.height=qge.height,r.needsUpdate=!0);const i=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const Hge=Mle(Wge).setParameterLength(0,3),$ge=Mle(Wge,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Kge=null;class Xge extends Wge{static get type(){return"ViewportDepthTextureNode"}constructor(e=gpe,t=null){null===Kge&&(Kge=new $2),super(e,t,Kge)}getTextureForReference(){return Kge}}const Yge=Mle(Xge).setParameterLength(0,2);class Qge extends Lse{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Qge.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===Qge.DEPTH_BASE)null!==n&&(r=nve().assign(n));else if(t===Qge.DEPTH)r=e.isPerspectiveCamera?Jge(ofe.z,Tpe,Cpe):Zge(ofe.z,Tpe,Cpe);else if(t===Qge.LINEAR_DEPTH)if(null!==n)if(e.isPerspectiveCamera){const e=eve(n,Tpe,Cpe);r=Zge(e,Tpe,Cpe)}else r=n;else r=Zge(ofe.z,Tpe,Cpe);return r}}Qge.DEPTH_BASE="depthBase",Qge.DEPTH="depth",Qge.LINEAR_DEPTH="linearDepth";const Zge=(e,t,n)=>e.add(t).div(t.sub(n)),Jge=(e,t,n)=>t.add(e).mul(n).div(n.sub(t).mul(e)),eve=(e,t,n)=>t.mul(n).div(n.sub(t).mul(e).sub(n)),tve=(e,t,n)=>{t=t.max(1e-6).toVar();const r=zue(e.negate().div(t)),i=zue(n.div(t));return r.div(i)},nve=Mle(Qge,Qge.DEPTH_BASE),rve=Ele(Qge,Qge.DEPTH),ive=Mle(Qge,Qge.LINEAR_DEPTH).setParameterLength(0,1),ave=ive(Yge());rve.assign=e=>nve(e);class ove extends Lse{static get type(){return"ClippingNode"}constructor(e=ove.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===ove.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===ove.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Rle(()=>{const n=Ble().toVar("distanceToPlane"),r=Ble().toVar("distanceToGradient"),i=Ble(1).toVar("clipOpacity"),a=t.length;if(!1===this.hardwareClipping&&a>0){const e=upe(t).setGroup(Vce);Rge(a,({i:t})=>{const a=e.element(t);n.assign(ofe.dot(a.xyz).negate().add(a.w)),r.assign(n.fwidth().div(2)),i.mulAssign(Lde(r.negate(),r,n))})}const o=e.length;if(o>0){const t=upe(e).setGroup(Vce),a=Ble(1).toVar("intersectionClipOpacity");Rge(o,({i:e})=>{const i=t.element(e);n.assign(ofe.dot(i.xyz).negate().add(i.w)),r.assign(n.fwidth().div(2)),a.mulAssign(Lde(r.negate(),r,n).oneMinus())}),i.mulAssign(a.oneMinus())}lce.a.mulAssign(i),lce.a.equal(0).discard()})()}setupDefault(e,t){return Rle(()=>{const n=t.length;if(!1===this.hardwareClipping&&n>0){const e=upe(t).setGroup(Vce);Rge(n,({i:t})=>{const n=e.element(t);ofe.dot(n.xyz).greaterThan(n.w).discard()})}const r=e.length;if(r>0){const t=upe(e).setGroup(Vce),n=Ule(!0).toVar("clipped");Rge(r,({i:e})=>{const r=t.element(e);n.assign(ofe.dot(r.xyz).greaterThan(r.w).and(n))}),n.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Rle(()=>{const r=upe(e).setGroup(Vce),i=dpe(t.getClipDistance());Rge(n,({i:e})=>{const t=r.element(e),n=ofe.dot(t.xyz).sub(t.w).negate();i.element(e).assign(n)})})()}}ove.ALPHA_TO_COVERAGE="alphaToCoverage",ove.DEFAULT="default",ove.HARDWARE="hardware";const sve=Rle(([e])=>Hue(nue(1e4,$ue(nue(17,e.x).add(nue(.1,e.y)))).mul(eue(.1,Jue($ue(nue(13,e.y).add(e.x))))))),lve=Rle(([e])=>sve(Vle(sve(e.xy),e.z))),cve=Rle(([e])=>{const t=mde(tde(ide(e.xyz)),tde(ade(e.xyz))),n=Ble(1).div(Ble(.05).mul(t)).toVar("pixScale"),r=Vle(Bue(Gue(zue(n))),Bue(que(zue(n)))),i=Vle(lve(Gue(r.x.mul(e.xyz))),lve(Gue(r.y.mul(e.xyz)))),a=Hue(zue(n)),o=eue(nue(a.oneMinus(),i.x),nue(a,i.y)),s=fde(a,a.oneMinus()),l=Hle(o.mul(o).div(nue(2,s).mul(tue(1,s))),o.sub(nue(.5,s)).div(tue(1,s)),tue(1,tue(1,o).mul(tue(1,o)).div(nue(2,s).mul(tue(1,s))))),c=o.lessThan(s.oneMinus()).select(o.lessThan(s).select(l.x,l.y),l.z);return Nde(c,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class uve extends Khe{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e);let n;return n=!0===e.hasGeometryAttribute(t)?super.generate(e):e.generateConst(this.nodeType,new DJ(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const dve=(e=0)=>new uve(e),hve=Rle(([e,t])=>fde(1,e.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),pve=Rle(([e,t])=>fde(e.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),fve=Rle(([e,t])=>e.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),mve=Rle(([e,t])=>Pde(e.mul(2).mul(t),e.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),gde(.5,e))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),gve=Rle(([e,t])=>{const n=t.a.add(e.a.mul(t.a.oneMinus()));return Yle(t.rgb.mul(t.a).add(e.rgb.mul(e.a).mul(t.a.oneMinus())).div(n),n)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),vve=Rle(([e])=>Yle(e.rgb.mul(e.a),e.a),{color:"vec4",return:"vec4"}),Ave=Rle(([e])=>(jle(e.a.equal(0),()=>Yle(0)),Yle(e.rgb.div(e.a),e.a)),{color:"vec4",return:"vec4"});class yve extends c1{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{eJ('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(!0===t.startsWith("_"))continue;const n=this[t];n&&!0===n.isNode&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(cse(t.slice(0,-4)),n.getCacheKey());return this.type+use(e)}build(e){this.setup(e)}setupObserver(e){return new sse(e)}setup(e){e.context.setupNormal=()=>rhe(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();!0===t.contextNode.isContextNode?e.context={...e.context,...t.contextNode.getFlowContextData()}:tJ('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),null!==this.contextNode&&(!0===this.contextNode.isContextNode?e.context={...e.context,...this.contextNode.getFlowContextData()}:tJ('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const r=rhe(this.setupVertex(e),"VERTEX"),i=this.vertexNode||r;let a;e.stack.outputNode=i,this.setupHardwareClipping(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();const o=this.setupClipping(e);if(!0!==this.depthWrite&&!0!==this.depthTest||(null!==n?!0===n.depthBuffer&&this.setupDepth(e):!0===t.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);const r=this.setupLighting(e);null!==o&&e.stack.addToStack(o);const i=Yle(r,lce.a).max(0);a=this.setupOutput(e,i),Ece.assign(a);const s=null!==this.outputNode;if(s&&(a=this.outputNode),e.context.getOutput&&(a=e.context.getOutput(a,e)),null!==n){const e=t.getMRT(),n=this.mrtNode;null!==e?(s&&Ece.assign(a),a=e,null!==n&&(a=e.merge(n))):null!==n&&(a=n)}}else{let t=this.fragmentNode;!0!==t.isOutputStructNode&&(t=Yle(t)),a=this.setupOutput(e,t)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const t=e.renderer.currentSamples;this.alphaToCoverage&&t>1?r=new ove(ove.ALPHA_TO_COVERAGE):e.stack.addToStack(new ove)}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(new ove(ove.HARDWARE)),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(null===r){const e=t.getMRT();e&&e.has("depth")?r=e.get("depth"):!0===t.logarithmicDepthBuffer&&(r=n.isPerspectiveCamera?tve(ofe.z,Tpe,Cpe):Zge(ofe.z,Tpe,Cpe))}null!==r&&rve.assign(r).toStack()}setupPositionView(){return Qpe.mul(nfe).xyz}setupModelViewProjection(){return Mpe.mul(ofe)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),uge}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Bge(t).toStack(),!0===t.isSkinnedMesh&&Nge(t).toStack(),this.displacementMap){const e=Gfe("displacementMap","texture"),t=Gfe("displacementScale","float"),n=Gfe("displacementBias","float");nfe.addAssign(pfe.normalize().mul(e.x.mul(t).add(n)))}return t.isBatchedMesh&&Mge(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&Tge(t).toStack(),null!==this.positionNode&&nfe.assign(rhe(this.positionNode,"POSITION","vec3")),nfe}setupDiffuseColor(e){const{object:t,geometry:n}=e;null!==this.maskNode&&Ule(this.maskNode).not().discard();let r=this.colorNode?Yle(this.colorNode):Mme;if(!0===this.vertexColors&&n.hasAttribute("color")&&(r=r.mul(dve())),t.instanceColor){r=sce("vec3","vInstanceColor").mul(r)}if(t.isBatchedMesh&&t._colorsTexture){r=sce("vec3","vBatchColor").mul(r)}lce.assign(r);const i=this.opacityNode?Ble(this.opacityNode):Nme;lce.a.assign(lce.a.mul(i));let a=null;(null!==this.alphaTestNode||this.alphaTest>0)&&(a=null!==this.alphaTestNode?Ble(this.alphaTestNode):Cme,!0===this.alphaToCoverage?(lce.a=Lde(a,a.add(cde(lce.a)),lce.a),lce.a.lessThanEqual(0).discard()):lce.a.lessThanEqual(a).discard()),!0===this.alphaHash&&lce.a.lessThan(cve(nfe)).discard(),e.isOpaque()&&lce.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?Hle(0):lce.rgb}setupNormal(){return this.normalNode?Hle(this.normalNode):Bme}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Gfe("envMap","cubeTexture"):Gfe("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Gge(sge)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);r&&r.isLightingNode&&t.push(r);let i=this.aoNode;null===i&&e.material.aoMap&&(i=lge),e.context.getAO&&(i=e.context.getAO(i,e)),i&&t.push(new zge(i));let a=this.lightsNode||e.lightsNode;return t.length>0&&(a=e.renderer.lighting.createNode([...a.getLights(),...t])),a}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,a=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null;let o=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const t=this.setupLightingModel(e)||null;o=Vge(a,t,n,r)}else null!==n&&(o=Hle(null!==r?Pde(o,n,r):n));return(i&&!0===i.isNode||t.emissive&&!0===t.emissive.isColor)&&(uce.assign(Hle(i||Pme)),o=o.add(uce)),o}setupFog(e,t){const n=e.fogNode;return n&&(Ece.assign(t),t=Yle(n.toVar())),t}setupPremultipliedAlpha(e,t){return vve(t)}setupOutput(e,t){return!0===this.fog&&(t=this.setupFog(e,t)),!0===this.premultipliedAlpha&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const t=e[n];void 0===this[n]&&(this[n]=t,t&&t.clone&&(this[n]=t.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,n)&&void 0!==t[n].get&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{},nodes:{}});const n=c1.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:i,childNode:a}of this._getNodeChildren())n.inputNodes[i]=a.toJSON(e).uuid;function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(t){const t=r(e.textures),i=r(e.images),a=r(e.nodes);t.length>0&&(n.textures=t),i.length>0&&(n.images=i),a.length>0&&(n.nodes=a)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const bve=new C2;class xve extends yve{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(bve),this.setValues(e)}}const _ve=new h4;class wve extends yve{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(_ve),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Ble(this.offsetNode):ige,t=this.dashScaleNode?Ble(this.dashScaleNode):ege,n=this.dashSizeNode?Ble(this.dashSizeNode):tge,r=this.gapSizeNode?Ble(this.gapSizeNode):nge;Pce.assign(n),Nce.assign(r);const i=ahe(Xhe("lineDistance").mul(t));(e?i.add(e):i).mod(Pce.add(Nce)).greaterThan(Pce).discard()}}let Sve=null;class Tve extends Wge{static get type(){return"ViewportSharedTextureNode"}constructor(e=gpe,t=null){null===Sve&&(Sve=new H2),super(e,t,Sve)}getTextureForReference(){return Sve}updateReference(){return this}}const Cve=Mle(Tve).setParameterLength(0,2);const Mve=new s4;class Eve extends yve{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Mve),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Ble(this.opacityNode):Nme;lce.assign(hhe(Yle(gme(vfe),e),MZ))}}const Pve=Rle(([e=afe])=>{const t=e.z.atan(e.x).mul(1/(2*Math.PI)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Vle(t,n)});class Nve extends i2{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new q1(5,5,5),a=Pve(afe),o=new yve;o.colorNode=ipe(t,a,0),o.side=1,o.blending=0;const s=new V1(i,o),l=new l2;l.add(s),t.minFilter===dQ&&(t.minFilter=cQ);const c=new n2(1,10,this),u=e.getMRT();return e.setMRT(null),c.update(e,l),e.setMRT(u),t.minFilter=n,t.currentGenerateMipmaps=r,s.geometry.dispose(),s.material.dispose(),this}}const kve=new WeakMap;class Rve extends Dse{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Ife(null);const t=new r2;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Tse.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const e=r.isTextureNode?r.value:n[r.property];if(e&&e.isTexture){const n=e.mapping;if(n===eQ||n===tQ){if(kve.has(e)){const t=kve.get(e);Ove(t,e.mapping),this._cubeTexture=t}else{const n=e.image;if(function(e){return null!==e&&void 0!==e&&e.height>0}(n)){const r=new Nve(n.height);r.fromEquirectangularTexture(t,e),Ove(r.texture,e.mapping),this._cubeTexture=r.texture,kve.set(e,r.texture),e.addEventListener("dispose",Lve)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Lve(e){const t=e.target;t.removeEventListener("dispose",Lve);const n=kve.get(t);void 0!==n&&(kve.delete(t),n.dispose())}function Ove(e,t){t===eQ?e.mapping=ZY:t===tQ&&(e.mapping=JY)}const jve=Mle(Rve).setParameterLength(1);class Dve extends Fge{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=jve(this.envNode)}}class Ive extends Fge{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Ble(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Bve{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class Fve extends Bve{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(Yle(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(Yle(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(lce.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case 0:r.rgb.assign(Pde(r.rgb,r.rgb.mul(i.rgb),Ome.mul(jme)));break;case 1:r.rgb.assign(Pde(r.rgb,i.rgb,Ome.mul(jme)));break;case 2:r.rgb.addAssign(i.rgb.mul(Ome.mul(jme)));break;default:eJ("BasicLightingModel: Unsupported .combine value:",t.combine)}}}const zve=new u1;class Uve extends yve{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(zve),this.setValues(e)}setupNormal(){return dfe(mfe)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Dve(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Ive(sge)),t}setupOutgoingLight(){return lce.rgb}setupLightingModel(){return new Fve}}const Vve=Rle(({f0:e,f90:t,dotVH:n})=>{const r=n.mul(-5.55473).sub(6.98316).mul(n).exp2();return e.mul(r.oneMinus()).add(t.mul(r))}),Gve=Rle(e=>e.diffuseColor.mul(1/Math.PI)),qve=Rle(({dotNH:e})=>Mce.mul(Ble(.5)).add(1).mul(Ble(1/Math.PI)).mul(e.pow(Mce))),Wve=Rle(({lightDirection:e})=>{const t=e.add(sfe).normalize(),n=vfe.dot(t).clamp(),r=sfe.dot(t).clamp(),i=Vve({f0:Sce,f90:1,dotVH:r}),a=Ble(.25),o=qve({dotNH:n});return i.mul(a).mul(o)});class Hve extends Fve{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=vfe.dot(e).clamp().mul(t);n.directDiffuse.addAssign(r.mul(Gve({diffuseColor:lce.rgb}))),!0===this.specular&&n.directSpecular.addAssign(r.mul(Wve({lightDirection:e})).mul(Ome))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Gve({diffuseColor:lce}))),r.indirectDiffuse.mulAssign(t)}}const $ve=new l4;class Kve extends yve{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues($ve),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Dve(t):null}setupLightingModel(){return new Hve(!1)}}const Xve=new a4;class Yve extends yve{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Xve),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Dve(t):null}setupLightingModel(){return new Hve}setupVariants(){const e=(this.shininessNode?Ble(this.shininessNode):Eme).max(1e-4);Mce.assign(e);const t=this.specularNode||kme;Sce.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const Qve=Rle(e=>{if(!1===e.geometry.hasAttribute("normal"))return Ble(0);const t=mfe.dFdx().abs().max(mfe.dFdy().abs());return t.x.max(t.y).max(t.z)}),Zve=Rle(e=>{const{roughness:t}=e,n=Qve();let r=t.max(.0525);return r=r.add(n),r=r.min(1),r}),Jve=Rle(({alpha:e,dotNL:t,dotNV:n})=>{const r=e.pow2(),i=t.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt()),a=n.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt());return rue(.5,i.add(a).max(Mue))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),eAe=Rle(({alphaT:e,alphaB:t,dotTV:n,dotBV:r,dotTL:i,dotBL:a,dotNV:o,dotNL:s})=>{const l=s.mul(Hle(e.mul(n),t.mul(r),o).length()),c=o.mul(Hle(e.mul(i),t.mul(a),s).length());return rue(.5,l.add(c))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),tAe=Rle(({alpha:e,dotNH:t})=>{const n=e.pow2(),r=t.pow2().mul(n.oneMinus()).oneMinus();return n.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),nAe=Ble(1/Math.PI),rAe=Rle(({alphaT:e,alphaB:t,dotNH:n,dotTH:r,dotBH:i})=>{const a=e.mul(t),o=Hle(t.mul(r),e.mul(i),a.mul(n)),s=o.dot(o),l=a.div(s);return nAe.mul(a.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),iAe=Rle(({lightDirection:e,f0:t,f90:n,roughness:r,f:i,normalView:a=vfe,USE_IRIDESCENCE:o,USE_ANISOTROPY:s})=>{const l=r.pow2(),c=e.add(sfe).normalize(),u=a.dot(e).clamp(),d=a.dot(sfe).clamp(),h=a.dot(c).clamp(),p=sfe.dot(c).clamp();let f,m,g=Vve({f0:t,f90:n,dotVH:p});if(ble(o)&&(g=vce.mix(g,i)),ble(s)){const t=_ce.dot(e),n=_ce.dot(sfe),r=_ce.dot(c),i=wce.dot(e),a=wce.dot(sfe),o=wce.dot(c);f=eAe({alphaT:bce,alphaB:l,dotTV:n,dotBV:a,dotTL:t,dotBL:i,dotNV:d,dotNL:u}),m=rAe({alphaT:bce,alphaB:l,dotNH:h,dotTH:r,dotBH:o})}else f=Jve({alpha:l,dotNL:u,dotNV:d}),m=tAe({alpha:l,dotNH:h});return g.mul(f).mul(m)}),aAe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let oAe=null;const sAe=Rle(({roughness:e,dotNV:t})=>{null===oAe&&(oAe=new p2(aAe,16,16,RQ,yQ),oAe.name="DFG_LUT",oAe.minFilter=cQ,oAe.magFilter=cQ,oAe.wrapS=iQ,oAe.wrapT=iQ,oAe.generateMipmaps=!1,oAe.needsUpdate=!0);const n=Vle(e,t);return ipe(oAe,n).rg}),lAe=Rle(({lightDirection:e,f0:t,f90:n,roughness:r,f:i,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const s=iAe({lightDirection:e,f0:t,f90:n,roughness:r,f:i,USE_IRIDESCENCE:a,USE_ANISOTROPY:o}),l=vfe.dot(e).clamp(),c=vfe.dot(sfe).clamp(),u=sAe({roughness:r,dotNV:c}),d=sAe({roughness:r,dotNV:l}),h=t.mul(u.x).add(n.mul(u.y)),p=t.mul(d.x).add(n.mul(d.y)),f=u.x.add(u.y),m=d.x.add(d.y),g=Ble(1).sub(f),v=Ble(1).sub(m),A=t.add(t.oneMinus().mul(.047619)),y=h.mul(p).mul(A).div(Ble(1).sub(g.mul(v).mul(A).mul(A)).add(Mue)),b=g.mul(v),x=y.mul(b);return s.add(x)}),cAe=Rle(e=>{const{dotNV:t,specularColor:n,specularF90:r,roughness:i}=e,a=sAe({dotNV:t,roughness:i});return n.mul(a.x).add(r.mul(a.y))}),uAe=Rle(({f:e,f90:t,dotVH:n})=>{const r=n.oneMinus().saturate(),i=r.mul(r),a=r.mul(i,i).clamp(0,.9999);return e.sub(Hle(t).mul(a)).div(a.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),dAe=Rle(({roughness:e,dotNH:t})=>{const n=e.pow2(),r=Ble(1).div(n),i=t.pow2().oneMinus().max(.0078125);return Ble(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),hAe=Rle(({dotNV:e,dotNL:t})=>Ble(1).div(Ble(4).mul(t.add(e).sub(t.mul(e))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),pAe=Rle(({lightDirection:e})=>{const t=e.add(sfe).normalize(),n=vfe.dot(e).clamp(),r=vfe.dot(sfe).clamp(),i=vfe.dot(t).clamp(),a=dAe({roughness:gce,dotNH:i}),o=hAe({dotNV:r,dotNL:n});return mce.mul(a).mul(o)}),fAe=Rle(({N:e,V:t,roughness:n})=>{const r=e.dot(t).saturate(),i=Vle(n,r.oneMinus().sqrt());return i.assign(i.mul(.984375).add(.0078125)),i}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),mAe=Rle(({f:e})=>{const t=e.length();return mde(t.mul(t).add(e.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),gAe=Rle(({v1:e,v2:t})=>{const n=e.dot(t),r=n.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),a=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(a),s=n.greaterThan(0).select(o,mde(n.mul(n).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return e.cross(t).mul(s)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),vAe=Rle(({N:e,V:t,P:n,mInv:r,p0:i,p1:a,p2:o,p3:s})=>{const l=a.sub(i).toVar(),c=s.sub(i).toVar(),u=l.cross(c),d=Hle().toVar();return jle(u.dot(n.sub(i)).greaterThanEqual(0),()=>{const l=t.sub(e.mul(t.dot(e))).normalize(),c=e.cross(l).negate(),u=r.mul(tce(l,c,e).transpose()).toVar(),h=u.mul(i.sub(n)).normalize().toVar(),p=u.mul(a.sub(n)).normalize().toVar(),f=u.mul(o.sub(n)).normalize().toVar(),m=u.mul(s.sub(n)).normalize().toVar(),g=Hle(0).toVar();g.addAssign(gAe({v1:h,v2:p})),g.addAssign(gAe({v1:p,v2:f})),g.addAssign(gAe({v1:f,v2:m})),g.addAssign(gAe({v1:m,v2:h})),d.assign(Hle(mAe({f:g})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),AAe=1/6,yAe=e=>nue(AAe,nue(e,nue(e,e.negate().add(3)).sub(3)).add(1)),bAe=e=>nue(AAe,nue(e,nue(e,nue(3,e).sub(6))).add(4)),xAe=e=>nue(AAe,nue(e,nue(e,nue(-3,e).add(3)).add(3)).add(1)),_Ae=e=>nue(AAe,_de(e,3)),wAe=e=>yAe(e).add(bAe(e)),SAe=e=>xAe(e).add(_Ae(e)),TAe=e=>eue(-1,bAe(e).div(yAe(e).add(bAe(e)))),CAe=e=>eue(1,_Ae(e).div(xAe(e).add(_Ae(e)))),MAe=(e,t,n)=>{const r=e.uvNode,i=nue(r,t.zw).add(.5),a=Gue(i),o=Hue(i),s=wAe(o.x),l=SAe(o.x),c=TAe(o.x),u=CAe(o.x),d=TAe(o.y),h=CAe(o.y),p=Vle(a.x.add(c),a.y.add(d)).sub(.5).mul(t.xy),f=Vle(a.x.add(u),a.y.add(d)).sub(.5).mul(t.xy),m=Vle(a.x.add(c),a.y.add(h)).sub(.5).mul(t.xy),g=Vle(a.x.add(u),a.y.add(h)).sub(.5).mul(t.xy),v=wAe(o.y).mul(eue(s.mul(e.sample(p).level(n)),l.mul(e.sample(f).level(n)))),A=SAe(o.y).mul(eue(s.mul(e.sample(m).level(n)),l.mul(e.sample(g).level(n))));return v.add(A)},EAe=Rle(([e,t])=>{const n=Vle(e.size(Fle(t))),r=Vle(e.size(Fle(t.add(1)))),i=rue(1,n),a=rue(1,r),o=MAe(e,Yle(i,n),Gue(t)),s=MAe(e,Yle(a,r),que(t));return Hue(t).mix(o,s)}),PAe=Rle(([e,t])=>{const n=t.mul(epe(e));return EAe(e,n)}),NAe=Rle(([e,t,n,r,i])=>{const a=Hle(Rde(t.negate(),Wue(e),rue(1,r))),o=Hle(tde(i[0].xyz),tde(i[1].xyz),tde(i[2].xyz));return Wue(a).mul(n.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),kAe=Rle(([e,t])=>e.mul(Nde(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),RAe=$ge(),LAe=$ge(),OAe=Rle(([e,t,n],{material:r})=>{const i=(1===r.side?RAe:LAe).sample(e),a=zue(vpe.x).mul(kAe(t,n));return EAe(i,a)}),jAe=Rle(([e,t,n])=>(jle(n.notEqual(0),()=>{const r=Fue(t).negate().div(n);return Iue(r.negate().mul(e))}),Hle(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),DAe=Rle(([e,t,n,r,i,a,o,s,l,c,u,d,h,p,f])=>{let m,g;if(f){m=Yle().toVar(),g=Hle().toVar();const i=u.sub(1).mul(f.mul(.025)),a=Hle(u.sub(i),u,u.add(i));Rge({start:0,end:3},({i:i})=>{const u=a.element(i),f=NAe(e,t,d,u,s),v=o.add(f),A=c.mul(l.mul(Yle(v,1))),y=Vle(A.xy.div(A.w)).toVar();y.addAssign(1),y.divAssign(2),y.assign(Vle(y.x,y.y.oneMinus()));const b=OAe(y,n,u);m.element(i).assign(b.element(i)),m.a.addAssign(b.a),g.element(i).assign(r.element(i).mul(jAe(tde(f),h,p).element(i)))}),m.a.divAssign(3)}else{const i=NAe(e,t,d,u,s),a=o.add(i),f=c.mul(l.mul(Yle(a,1))),v=Vle(f.xy.div(f.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign(Vle(v.x,v.y.oneMinus())),m=OAe(v,n,u),g=r.mul(jAe(tde(i),h,p))}const v=g.rgb.mul(m.rgb),A=e.dot(t).clamp(),y=Hle(cAe({dotNV:A,specularColor:i,specularF90:a,roughness:n})),b=g.r.add(g.g,g.b).div(3);return Yle(y.oneMinus().mul(v),m.a.oneMinus().mul(b).oneMinus())}),IAe=tce(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),BAe=(e,t)=>e.sub(t).div(e.add(t)).pow2(),FAe=Rle(({outsideIOR:e,eta2:t,cosTheta1:n,thinFilmThickness:r,baseF0:i})=>{const a=Pde(e,t,Lde(0,.03,r)),o=e.div(a).pow2().mul(n.pow2().oneMinus()).oneMinus();jle(o.lessThan(0),()=>Hle(1));const s=o.sqrt(),l=BAe(a,e),c=Vve({f0:l,f90:1,dotVH:n}),u=c.oneMinus(),d=a.lessThan(e).select(Math.PI,0),h=Ble(Math.PI).sub(d),p=(e=>{const t=e.sqrt();return Hle(1).add(t).div(Hle(1).sub(t))})(i.clamp(0,.9999)),f=BAe(p,a.toVec3()),m=Vve({f0:f,f90:1,dotVH:s}),g=Hle(p.x.lessThan(a).select(Math.PI,0),p.y.lessThan(a).select(Math.PI,0),p.z.lessThan(a).select(Math.PI,0)),v=a.mul(r,s,2),A=Hle(h).add(g),y=c.mul(m).clamp(1e-5,.9999),b=y.sqrt(),x=u.pow2().mul(m).div(Hle(1).sub(y)),_=c.add(x).toVar(),w=x.sub(u).toVar();return Rge({start:1,end:2,condition:"<=",name:"m"},({m:e})=>{w.mulAssign(b);const t=((e,t)=>{const n=e.mul(2*Math.PI*1e-9),r=Hle(54856e-17,44201e-17,52481e-17),i=Hle(1681e3,1795300,2208400),a=Hle(43278e5,93046e5,66121e5),o=Ble(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(t.x).cos()).mul(n.pow2().mul(-45282e5).exp());let s=r.mul(a.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(t).cos()).mul(n.pow2().negate().mul(a).exp());return s=Hle(s.x.add(o),s.y,s.z).div(1.0685e-7),IAe.mul(s)})(Ble(e).mul(v),Ble(e).mul(A)).mul(2);_.addAssign(w.mul(t))}),_.max(Hle(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),zAe=Rle(({normal:e,viewDir:t,roughness:n})=>{const r=e.dot(t).saturate(),i=n.mul(n),a=n.add(.1).reciprocal(),o=Ble(-1.9362).add(n.mul(1.0678)).add(i.mul(.4573)).sub(a.mul(.8469)),s=Ble(-.6014).add(n.mul(.5538)).sub(i.mul(.467)).sub(a.mul(.1255));return o.mul(r).add(s).exp().saturate()}),UAe=Hle(.04),VAe=Ble(1);class GAe extends Bve{constructor(e=!1,t=!1,n=!1,r=!1,i=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=Hle().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Hle().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Hle().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=Hle().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Hle().toVar("sheenSpecularIndirect")),!0===this.iridescence){const e=vfe.dot(sfe).clamp(),t=FAe({outsideIOR:Ble(1),eta2:Ace,cosTheta1:e,thinFilmThickness:yce,baseF0:Sce}),n=FAe({outsideIOR:Ble(1),eta2:Ace,cosTheta1:e,thinFilmThickness:yce,baseF0:lce.rgb});this.iridescenceFresnel=Pde(t,n,hce),this.iridescenceF0Dielectric=uAe({f:t,f90:1,dotVH:e}),this.iridescenceF0Metallic=uAe({f:n,f90:1,dotVH:e}),this.iridescenceF0=Pde(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,hce)}if(!0===this.transmission){const t=ife,n=Rpe.sub(ife).normalize(),r=Afe,i=e.context;i.backdrop=DAe(r,n,dce,cce,Tce,Cce,t,qpe,Ppe,Mpe,Rce,Oce,Dce,jce,this.dispersion?Ice:null),i.backdropAlpha=Lce,lce.a.mulAssign(Pde(1,i.backdrop.a,Lce))}super.start(e)}computeMultiscattering(e,t,n,r,i=null){const a=vfe.dot(sfe).clamp(),o=sAe({roughness:dce,dotNV:a}),s=i?vce.mix(r,i):r,l=s.mul(o.x).add(n.mul(o.y)),c=o.x.add(o.y).oneMinus(),u=s.add(s.oneMinus().mul(.047619)),d=l.mul(u).div(c.mul(u).oneMinus());e.addAssign(l),t.addAssign(d.mul(c))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=vfe.dot(e).clamp().mul(t).toVar();if(!0===this.sheen){this.sheenSpecularDirect.addAssign(r.mul(pAe({lightDirection:e})));const t=zAe({normal:vfe,viewDir:sfe,roughness:gce}),n=zAe({normal:vfe,viewDir:e,roughness:gce}),i=mce.r.max(mce.g).max(mce.b).mul(t.max(n)).oneMinus();r.mulAssign(i)}if(!0===this.clearcoat){const n=yfe.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(n.mul(iAe({lightDirection:e,f0:UAe,f90:VAe,roughness:fce,normalView:yfe})))}n.directDiffuse.addAssign(r.mul(Gve({diffuseColor:cce}))),n.directSpecular.addAssign(r.mul(lAe({lightDirection:e,f0:Tce,f90:1,roughness:dce,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:i,ltc_1:a,ltc_2:o}){const s=t.add(n).sub(r),l=t.sub(n).sub(r),c=t.sub(n).add(r),u=t.add(n).add(r),d=vfe,h=sfe,p=ofe.toVar(),f=fAe({N:d,V:h,roughness:dce}),m=a.sample(f).toVar(),g=o.sample(f).toVar(),v=tce(Hle(m.x,0,m.y),Hle(0,1,0),Hle(m.z,0,m.w)).toVar(),A=Tce.mul(g.x).add(Tce.oneMinus().mul(g.y)).toVar();i.directSpecular.addAssign(e.mul(A).mul(vAe({N:d,V:h,P:p,mInv:v,p0:s,p1:l,p2:c,p3:u}))),i.directDiffuse.addAssign(e.mul(cce).mul(vAe({N:d,V:h,P:p,mInv:tce(1,0,0,0,1,0,0,0,1),p0:s,p1:l,p2:c,p3:u})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context,r=t.mul(Gve({diffuseColor:cce})).toVar();if(!0===this.sheen){const e=zAe({normal:vfe,viewDir:sfe,roughness:gce}),t=mce.r.max(mce.g).max(mce.b).mul(e).oneMinus();r.mulAssign(t)}n.indirectDiffuse.addAssign(r)}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(n.mul(mce,zAe({normal:vfe,viewDir:sfe,roughness:gce}))),!0===this.clearcoat){const e=yfe.dot(sfe).clamp(),t=cAe({dotNV:e,specularColor:UAe,specularF90:VAe,roughness:fce});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(t))}const i=Hle().toVar("singleScatteringDielectric"),a=Hle().toVar("multiScatteringDielectric"),o=Hle().toVar("singleScatteringMetallic"),s=Hle().toVar("multiScatteringMetallic");this.computeMultiscattering(i,a,Cce,Sce,this.iridescenceF0Dielectric),this.computeMultiscattering(o,s,Cce,lce.rgb,this.iridescenceF0Metallic);const l=Pde(i,o,hce),c=Pde(a,s,hce),u=i.add(a),d=cce.mul(u.oneMinus()),h=n.mul(1/Math.PI),p=t.mul(l).add(c.mul(h)).toVar(),f=d.mul(h).toVar();if(!0===this.sheen){const e=zAe({normal:vfe,viewDir:sfe,roughness:gce}),t=mce.r.max(mce.g).max(mce.b).mul(e).oneMinus();p.mulAssign(t),f.mulAssign(t)}r.indirectSpecular.addAssign(p),r.indirectDiffuse.addAssign(f)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,r=vfe.dot(sfe).clamp().add(t),i=dce.mul(-16).oneMinus().negate().exp2(),a=t.sub(r.pow(i).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(!0===this.clearcoat){const e=yfe.dot(sfe).clamp(),n=Vve({dotVH:e,f0:UAe,f90:VAe}),r=t.mul(pce.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(pce));t.assign(r)}if(!0===this.sheen){const e=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(e)}}}const qAe=Ble(1),WAe=Ble(-2),HAe=Ble(.8),$Ae=Ble(-1),KAe=Ble(.4),XAe=Ble(2),YAe=Ble(.305),QAe=Ble(3),ZAe=Ble(.21),JAe=Ble(4),eye=Ble(4),tye=Ble(16),nye=Rle(([e])=>{const t=Hle(Jue(e)).toVar(),n=Ble(-1).toVar();return jle(t.x.greaterThan(t.z),()=>{jle(t.x.greaterThan(t.y),()=>{n.assign(Gde(e.x.greaterThan(0),0,3))}).Else(()=>{n.assign(Gde(e.y.greaterThan(0),1,4))})}).Else(()=>{jle(t.z.greaterThan(t.y),()=>{n.assign(Gde(e.z.greaterThan(0),2,5))}).Else(()=>{n.assign(Gde(e.y.greaterThan(0),1,4))})}),n}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),rye=Rle(([e,t])=>{const n=Vle().toVar();return jle(t.equal(0),()=>{n.assign(Vle(e.z,e.y).div(Jue(e.x)))}).ElseIf(t.equal(1),()=>{n.assign(Vle(e.x.negate(),e.z.negate()).div(Jue(e.y)))}).ElseIf(t.equal(2),()=>{n.assign(Vle(e.x.negate(),e.y).div(Jue(e.z)))}).ElseIf(t.equal(3),()=>{n.assign(Vle(e.z.negate(),e.y).div(Jue(e.x)))}).ElseIf(t.equal(4),()=>{n.assign(Vle(e.x.negate(),e.z).div(Jue(e.y)))}).Else(()=>{n.assign(Vle(e.x,e.y).div(Jue(e.z)))}),nue(.5,n.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),iye=Rle(([e])=>{const t=Ble(0).toVar();return jle(e.greaterThanEqual(HAe),()=>{t.assign(qAe.sub(e).mul($Ae.sub(WAe)).div(qAe.sub(HAe)).add(WAe))}).ElseIf(e.greaterThanEqual(KAe),()=>{t.assign(HAe.sub(e).mul(XAe.sub($Ae)).div(HAe.sub(KAe)).add($Ae))}).ElseIf(e.greaterThanEqual(YAe),()=>{t.assign(KAe.sub(e).mul(QAe.sub(XAe)).div(KAe.sub(YAe)).add(XAe))}).ElseIf(e.greaterThanEqual(ZAe),()=>{t.assign(YAe.sub(e).mul(JAe.sub(QAe)).div(YAe.sub(ZAe)).add(QAe))}).Else(()=>{t.assign(Ble(-2).mul(zue(nue(1.16,e))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),aye=Rle(([e,t])=>{const n=e.toVar();n.assign(nue(2,n).sub(1));const r=Hle(n,1).toVar();return jle(t.equal(0),()=>{r.assign(r.zyx)}).ElseIf(t.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),oye=Rle(([e,t,n,r,i,a])=>{const o=Ble(n),s=Hle(t),l=Nde(iye(o),WAe,a),c=Hue(l),u=Gue(l),d=Hle(sye(e,s,u,r,i,a)).toVar();return jle(c.notEqual(0),()=>{const t=Hle(sye(e,s,u.add(1),r,i,a)).toVar();d.assign(Pde(d,t,c))}),d}),sye=Rle(([e,t,n,r,i,a])=>{const o=Ble(n).toVar(),s=Hle(t),l=Ble(nye(s)).toVar(),c=Ble(mde(eye.sub(o),0)).toVar();o.assign(mde(o,eye));const u=Ble(Bue(o)).toVar(),d=Vle(rye(s,l).mul(u.sub(2)).add(1)).toVar();return jle(l.greaterThan(2),()=>{d.y.addAssign(u),l.subAssign(3)}),d.x.addAssign(l.mul(u)),d.x.addAssign(c.mul(nue(3,tye))),d.y.addAssign(nue(4,Bue(a).sub(u))),d.x.mulAssign(r),d.y.mulAssign(i),e.sample(d).grad(Vle(),Vle())}),lye=Rle(({envMap:e,mipInt:t,outputDirection:n,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:s})=>{const l=Kue(r),c=n.mul(l).add(i.cross(n).mul($ue(r))).add(i.mul(i.dot(n).mul(l.oneMinus())));return sye(e,c,t,a,o,s)}),cye=Rle(({n:e,latitudinal:t,poleAxis:n,outputDirection:r,weights:i,samples:a,dTheta:o,mipInt:s,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})=>{const h=Hle(Gde(t,n,xde(n,r))).toVar();jle(h.equal(Hle(0)),()=>{h.assign(Hle(r.z,0,r.x.negate()))}),h.assign(Wue(h));const p=Hle().toVar();return p.addAssign(i.element(0).mul(lye({theta:0,axis:h,outputDirection:r,mipInt:s,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),Rge({start:Fle(1),end:e},({i:e})=>{jle(e.greaterThanEqual(a),()=>{Lge()});const t=Ble(o.mul(Ble(e))).toVar();p.addAssign(i.element(e).mul(lye({theta:t.mul(-1),axis:h,outputDirection:r,mipInt:s,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),p.addAssign(i.element(e).mul(lye({theta:t,axis:h,outputDirection:r,mipInt:s,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})))}),Yle(p,1)}),uye=Rle(([e])=>{const t=zle(e).toVar();return t.assign(t.shiftLeft(zle(16)).bitOr(t.shiftRight(zle(16)))),t.assign(t.bitAnd(zle(1431655765)).shiftLeft(zle(1)).bitOr(t.bitAnd(zle(2863311530)).shiftRight(zle(1)))),t.assign(t.bitAnd(zle(858993459)).shiftLeft(zle(2)).bitOr(t.bitAnd(zle(3435973836)).shiftRight(zle(2)))),t.assign(t.bitAnd(zle(252645135)).shiftLeft(zle(4)).bitOr(t.bitAnd(zle(4042322160)).shiftRight(zle(4)))),t.assign(t.bitAnd(zle(16711935)).shiftLeft(zle(8)).bitOr(t.bitAnd(zle(4278255360)).shiftRight(zle(8)))),Ble(t).mul(2.3283064365386963e-10)}),dye=Rle(([e,t])=>Vle(Ble(e).div(Ble(t)),uye(e))),hye=Rle(([e,t,n])=>{const r=Hle(t).toVar(),i=Ble(n),a=i.mul(i).toVar(),o=Wue(Hle(a.mul(r.x),a.mul(r.y),r.z)).toVar(),s=o.x.mul(o.x).add(o.y.mul(o.y)),l=Gde(s.greaterThan(0),Hle(o.y.negate(),o.x,0).div(Uue(s)),Hle(1,0,0)).toVar(),c=xde(o,l).toVar(),u=Uue(e.x),d=nue(2,3.14159265359).mul(e.y),h=u.mul(Kue(d)).toVar(),p=u.mul($ue(d)).toVar(),f=nue(.5,o.z.add(1));p.assign(f.oneMinus().mul(Uue(h.mul(h).oneMinus())).add(f.mul(p)));const m=l.mul(h).add(c.mul(p)).add(o.mul(Uue(mde(0,h.mul(h).add(p.mul(p)).oneMinus()))));return Wue(Hle(a.mul(m.x),a.mul(m.y),mde(0,m.z)))}),pye=Rle(({roughness:e,mipInt:t,envMap:n,N_immutable:r,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:s})=>{const l=Hle(r).toVar(),c=Hle(0).toVar(),u=Ble(0).toVar();return jle(e.lessThan(.001),()=>{c.assign(sye(n,l,t,a,o,s))}).Else(()=>{const r=Gde(Jue(l.z).lessThan(.999),Hle(0,0,1),Hle(1,0,0)),d=Wue(xde(r,l)).toVar(),h=xde(l,d).toVar();Rge({start:zle(0),end:i},({i:r})=>{const p=dye(r,i),f=hye(p,Hle(0,0,1),e),m=Wue(d.mul(f.x).add(h.mul(f.y)).add(l.mul(f.z))),g=Wue(m.mul(bde(l,m).mul(2)).sub(l)),v=mde(bde(l,g),0);jle(v.greaterThan(0),()=>{const e=sye(n,g,t,a,o,s);c.addAssign(e.mul(v)),u.addAssign(v)})}),jle(u.greaterThan(0),()=>{c.assign(c.div(u))})}),Yle(c,1)}),fye=[.125,.215,.35,.446,.526,.582],mye=20,gye=new G4(-1,1,1,-1,0,1),vye=new e2(90,1),Aye=new o1;let yye=null,bye=0,xye=0;const _ye=new vJ,wye=new WeakMap,Sye=[3,1,5,0,4,2],Tye=aye(Yhe(),Xhe("faceIndex")).normalize(),Cye=Hle(Tye.x,Tye.y,Tye.z);class Mye{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,i={}){const{size:a=256,position:o=_ye,renderTarget:s=null}=i;if(this._setSize(a),!1===this._hasInitialized){eJ('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const a=s||this._allocateTarget();return i.renderTarget=a,this.fromSceneAsync(e,t,n,r,i),a}yye=this._renderer.getRenderTarget(),bye=this._renderer.getActiveCubeFace(),xye=this._renderer.getActiveMipmapLevel();const l=s||this._allocateTarget();return l.depthBuffer=!0,this._init(l),this._sceneToCubeUV(e,n,r,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}async fromSceneAsync(e,t=0,n=.1,r=100,i={}){return nJ('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,n,r,i)}fromEquirectangular(e,t=null){if(!1===this._hasInitialized){eJ('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return nJ('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(!1===this._hasInitialized){eJ("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return nJ('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=kye(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Rye(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===ZY||e.mapping===JY?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(yye,bye,xye),e.scissorTest=!1,Pye(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),yye=this._renderer.getRenderTarget(),bye=this._renderer.getActiveCubeFace(),xye=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){return Eye(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(e){if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Eye(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+fye.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);t.push(a);let s=1/a;o>e-4?s=fye[o-e+4-1]:0===o&&(s=0),n.push(s);const l=1/(a-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*h),A=new Float32Array(m*p*h),y=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0],i=Sye[e];v.set(r,f*p*i),A.set(d,m*p*i);const a=[i,i,i,i,i,i];y.set(a,g*p*i)}const b=new N1;b.setAttribute("position",new A1(v,f)),b.setAttribute("uv",new A1(A,m)),b.setAttribute("faceIndex",new A1(y,g)),r.push(new V1(b,null)),i>4&&i--}return{lodMeshes:r,sizeLods:t,sigmas:n}}(t)),this._blurMaterial=function(e,t,n){const r=upe(new Array(mye).fill(0)),i=Wce(new vJ(0,1,0)),a=Wce(0),o=Ble(mye),s=Wce(0),l=Wce(1),c=ipe(),u=Wce(0),d=Ble(1/t),h=Ble(1/n),p=Ble(e),f={n:o,latitudinal:s,weights:r,poleAxis:i,outputDirection:Cye,dTheta:a,samples:l,envMap:c,mipInt:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p},m=Nye("blur");return m.fragmentNode=cye({...f,latitudinal:s.equal(1)}),wye.set(m,f),m}(t,e.width,e.height),this._ggxMaterial=function(e,t,n){const r=ipe(),i=Wce(0),a=Wce(0),o=Ble(1/t),s=Ble(1/n),l=Ble(e),c={envMap:r,roughness:i,mipInt:a,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:s,CUBEUV_MAX_MIP:l},u=Nye("ggx");return u.fragmentNode=pye({...c,N_immutable:Cye,GGX_SAMPLES:zle(512)}),wye.set(u,c),u}(t,e.width,e.height)}}async _compileMaterial(e){const t=new V1(new N1,e);await this._renderer.compile(t,gye)}_sceneToCubeUV(e,t,n,r,i){const a=vye;a.near=t,a.far=n;const o=[1,1,1,1,-1,1],s=[1,-1,1,-1,1,-1],l=this._renderer,c=l.autoClear;l.getClearColor(Aye),l.autoClear=!1,null===this._backgroundBox&&(this._backgroundBox=new V1(new q1,new u1({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1})));const u=this._backgroundBox,d=u.material;let h=!1;const p=e.background;p?p.isColor&&(d.color.copy(p),e.background=null,h=!0):(d.color.copy(Aye),h=!0),l.setRenderTarget(r),l.clear(),h&&l.render(u,a);for(let f=0;f<6;f++){const t=f%3;0===t?(a.up.set(0,o[f],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+s[f],i.y,i.z)):1===t?(a.up.set(0,0,o[f]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+s[f],i.z)):(a.up.set(0,o[f],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+s[f]));const n=this._cubeSize;Pye(r,t*n,f>2?n:0,n,n),l.render(e,a)}l.autoClear=c,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ZY||e.mapping===JY;r?null===this._cubemapMaterial&&(this._cubemapMaterial=kye(e)):null===this._equirectMaterial&&(this._equirectMaterial=Rye(e));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=i;const o=this._cubeSize;Pye(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,gye)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let i=1;i<r;i++)this._applyGGXFilter(e,i-1,i);t.autoClear=n}_applyGGXFilter(e,t,n){const r=this._renderer,i=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const s=wye.get(a),l=n/(this._lodMeshes.length-1),c=t/(this._lodMeshes.length-1),u=Math.sqrt(l*l-c*c)*(0+1.25*l),{_lodMax:d}=this,h=this._sizeLods[n],p=3*h*(n>d-4?n-d+4:0),f=4*(this._cubeSize-h);e.texture.frame=(e.texture.frame||0)+1,s.envMap.value=e.texture,s.roughness.value=u,s.mipInt.value=d-t,Pye(i,p,f,3*h,2*h),r.setRenderTarget(i),r.render(o,gye),i.texture.frame=(i.texture.frame||0)+1,s.envMap.value=i.texture,s.roughness.value=0,s.mipInt.value=d-n,Pye(e,p,f,3*h,2*h),r.setRenderTarget(e),r.render(o,gye)}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&tJ("blur direction must be either latitudinal or longitudinal!");const c=this._lodMeshes[r];c.material=l;const u=wye.get(l),d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,p=i/h,f=isFinite(i)?1+Math.floor(3*p):mye;f>mye&&eJ(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let y=0;y<mye;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;e.texture.frame=(e.texture.frame||0)+1,u.envMap.value=e.texture,u.samples.value=f,u.weights.array=m,u.latitudinal.value="latitudinal"===a?1:0,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=h,u.mipInt.value=v-n;const A=this._sizeLods[r];Pye(t,3*A*(r>v-4?r-v+4:0),4*(this._cubeSize-A),3*A,2*A),s.setRenderTarget(t),s.render(c,gye)}}function Eye(e,t){const n=new IJ(e,t,{magFilter:cQ,minFilter:cQ,generateMipmaps:!1,type:yQ,format:MQ,colorSpace:EZ});return n.texture.mapping=nQ,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Pye(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Nye(e){const t=new yve;return t.depthTest=!1,t.depthWrite=!1,t.blending=0,t.name=`PMREM_${e}`,t}function kye(e){const t=Nye("cubemap");return t.fragmentNode=Ife(e,Cye),t}function Rye(e){const t=Nye("equirect");return t.fragmentNode=ipe(e,Pve(Cye),0),t}const Lye=new WeakMap;function Oye(e,t,n){const r=function(e){let t=Lye.get(e);void 0===t&&(t=new WeakMap,Lye.set(e,t));return t}(t);let i=r.get(e);if((void 0!==i?i.pmremVersion:-1)!==e.pmremVersion){const t=e.image;if(e.isCubeTexture){if(!function(e){if(null===e||void 0===e)return!1;let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(t))return null;i=n.fromCubemap(e,i)}else{if(!function(e){return null!==e&&void 0!==e&&e.height>0}(t))return null;i=n.fromEquirectangular(e,i)}i.pmremVersion=e.pmremVersion,r.set(e,i)}return i.texture}class jye extends Dse{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new jJ;r.isRenderTargetTexture=!0,this._texture=ipe(r),this._width=Wce(0),this._height=Wce(0),this._maxMip=Wce(0),this.updateBeforeType=Tse.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=function(e){const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(t=!0===r.isPMREMTexture?r:Oye(r,e.renderer,this._generator),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){null===this._generator&&(this._generator=new Mye(e.renderer)),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this,e)),t=Pfe.mul(Hle(t.x,t.y.negate(),t.z));let n=this.levelNode;return null===n&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),oye(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}const Dye=Mle(jye).setParameterLength(1,3),Iye=new WeakMap;class Bye extends Fge{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const e=n.isTextureNode?n.value:t[n.property];let r=Iye.get(e);void 0===r&&(r=Dye(e),Iye.set(e,r)),n=r}const r=!0===t.useAnisotropy||t.anisotropy>0?mme:vfe,i=n.context(Fye(dce,r)).mul(Efe),a=n.context(zye(Afe)).mul(Math.PI).mul(Efe),o=khe(i),s=khe(a);e.context.radiance.addAssign(o),e.context.iblIrradiance.addAssign(s);const l=e.context.lightingModel.clearcoatRadiance;if(l){const e=n.context(Fye(fce,yfe)).mul(Efe),t=khe(e);l.addAssign(t)}}}const Fye=(e,t)=>{let n=null;return{getUV:()=>(null===n&&(n=sfe.negate().reflect(t),n=Tde(e).mix(n,t).normalize(),n=n.transformDirection(Ppe)),n),getTextureLevel:()=>e}},zye=e=>({getUV:()=>e,getTextureLevel:()=>Ble(1)}),Uye=new r4;class Vye extends yve{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Uye),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return null===t&&e.environmentNode&&(t=e.environmentNode),t?new Bye(t):null}setupLightingModel(){return new GAe}setupSpecular(){const e=Pde(Hle(.04),lce.rgb,hce);Sce.assign(Hle(.04)),Tce.assign(e),Cce.assign(1)}setupVariants(){const e=this.metalnessNode?Ble(this.metalnessNode):Ime;hce.assign(e);let t=this.roughnessNode?Ble(this.roughnessNode):Dme;t=Zve({roughness:t}),dce.assign(t),this.setupSpecular(),cce.assign(lce.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Gye=new i4;class qye extends Vye{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Gye),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const e=this.iorNode?Ble(this.iorNode):Qme;Rce.assign(e),Sce.assign(fde(wde(Rce.sub(1).div(Rce.add(1))).mul(Lme),Hle(1)).mul(Rme)),Tce.assign(Pde(Sce,lce.rgb,hce)),Cce.assign(Pde(Rme,1,hce))}setupLightingModel(){return new GAe(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const e=this.clearcoatNode?Ble(this.clearcoatNode):Fme,t=this.clearcoatRoughnessNode?Ble(this.clearcoatRoughnessNode):zme;pce.assign(e),fce.assign(Zve({roughness:t}))}if(this.useSheen){const e=this.sheenNode?Hle(this.sheenNode):Gme,t=this.sheenRoughnessNode?Ble(this.sheenRoughnessNode):qme;mce.assign(e),gce.assign(t)}if(this.useIridescence){const e=this.iridescenceNode?Ble(this.iridescenceNode):Hme,t=this.iridescenceIORNode?Ble(this.iridescenceIORNode):$me,n=this.iridescenceThicknessNode?Ble(this.iridescenceThicknessNode):Kme;vce.assign(e),Ace.assign(t),yce.assign(n)}if(this.useAnisotropy){const e=(this.anisotropyNode?Vle(this.anisotropyNode):Wme).toVar();xce.assign(e.length()),jle(xce.equal(0),()=>{e.assign(Vle(1,0))}).Else(()=>{e.divAssign(Vle(xce)),xce.assign(xce.saturate())}),bce.assign(xce.pow2().mix(dce.pow2(),1)),_ce.assign(pme[0].mul(e.x).add(pme[1].mul(e.y))),wce.assign(pme[1].mul(e.x).sub(pme[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?Ble(this.transmissionNode):Xme,t=this.thicknessNode?Ble(this.thicknessNode):Yme,n=this.attenuationDistanceNode?Ble(this.attenuationDistanceNode):Zme,r=this.attenuationColorNode?Hle(this.attenuationColorNode):Jme;if(Lce.assign(e),Oce.assign(t),jce.assign(n),Dce.assign(r),this.useDispersion){const e=this.dispersionNode?Ble(this.dispersionNode):oge;Ice.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Hle(this.clearcoatNormalNode):Ume}setup(e){e.context.setupClearcoatNormal=()=>rhe(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const Wye=Rle(({normal:e,lightDirection:t,builder:n})=>{const r=e.dot(t),i=Vle(r.mul(.5).add(.5),0);if(n.material.gradientMap){const e=Gfe("gradientMap","texture").context({getUV:()=>i});return Hle(e.r)}{const e=i.fwidth().mul(.5);return Pde(Hle(.7),Hle(1),Lde(Ble(.7).sub(e.x),Ble(.7).add(e.x),i.x))}});class Hye extends Bve{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const i=Wye({normal:hfe,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(i.mul(Gve({diffuseColor:lce.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Gve({diffuseColor:lce}))),r.indirectDiffuse.mulAssign(t)}}const $ye=new o4;class Kye extends yve{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues($ye),this.setValues(e)}setupLightingModel(){return new Hye}}const Xye=Rle(()=>{const e=Hle(sfe.z,0,sfe.x.negate()).normalize(),t=sfe.cross(e);return Vle(e.dot(vfe),t.dot(vfe)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),Yye=new d4;class Qye extends yve{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Yye),this.setValues(e)}setupVariants(e){const t=Xye;let n;n=e.material.matcap?Gfe("matcap","texture").context({getUV:()=>t}):Hle(Pde(.2,.8,t.y)),lce.rgb.mulAssign(n.rgb)}}class Zye extends Dse{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if("vec2"===this.getNodeType(e)){const e=t.cos(),r=t.sin();return ece(e,r,r.negate(),e).mul(n)}{const e=t,r=nce(Yle(1,0,0,0),Yle(0,Kue(e.x),$ue(e.x).negate(),0),Yle(0,$ue(e.x),Kue(e.x),0),Yle(0,0,0,1)),i=nce(Yle(Kue(e.y),0,$ue(e.y),0),Yle(0,1,0,0),Yle($ue(e.y).negate(),0,Kue(e.y),0),Yle(0,0,0,1)),a=nce(Yle(Kue(e.z),$ue(e.z).negate(),0,0),Yle($ue(e.z),Kue(e.z),0,0),Yle(0,0,1,0),Yle(0,0,0,1));return r.mul(i).mul(a).mul(Yle(n,1)).xyz}}}const Jye=Mle(Zye).setParameterLength(2),ebe=new h2;class tbe extends yve{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(ebe),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,{positionNode:r,rotationNode:i,scaleNode:a,sizeAttenuation:o}=this,s=Qpe.mul(Hle(r||0));let l=Vle(qpe[0].xyz.length(),qpe[1].xyz.length());null!==a&&(l=l.mul(Vle(a))),n.isPerspectiveCamera&&!1===o&&(l=l.mul(s.z.negate()));let c=tfe.xy;if(t.center&&!0===t.center.isVector2){const e=((e,t,n)=>new fhe(e,t,n))("center","vec2",t);c=c.sub(e.sub(.5))}c=c.mul(l);const u=Ble(i||Vme),d=Jye(c,u);return Yle(s.xy.add(d),s.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const nbe=new F2,rbe=new mJ;class ibe extends tbe{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(nbe),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Qpe.mul(Hle(e||nfe)).xyz}setupVertexSprite(e){const{material:t,camera:n}=e,{rotationNode:r,scaleNode:i,sizeNode:a,sizeAttenuation:o}=this;let s=super.setupVertex(e);if(!0!==t.isNodeMaterial)return s;let l=null!==a?Vle(a):age;l=l.mul(mpe),n.isPerspectiveCamera&&!0===o&&(l=l.mul(abe.div(ofe.z.negate()))),i&&i.isNode&&(l=l.mul(Vle(i)));let c=tfe.xy;if(r&&r.isNode){const e=Ble(r);c=Jye(c,e)}return c=c.mul(l),c=c.div(bpe.div(2)),c=c.mul(s.w),s=s.add(Yle(c,0,0)),s}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const abe=Wce(1).onFrameUpdate(function({renderer:e}){const t=e.getSize(rbe);this.value=.5*t.y});class obe extends Bve{constructor(){super(),this.shadowNode=Ble(1).toVar("shadowMask")}direct({lightNode:e}){null!==e.shadowNode&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){lce.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(lce.rgb)}}const sbe=new t4;class lbe extends yve{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(sbe),this.setValues(e)}setupLightingModel(){return new obe}}oce("vec3"),oce("vec3"),oce("vec3");class cbe{constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context="undefined"!==typeof self?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),null!==this._animationLoop&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class ube{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let n=this.weakMaps[t];return void 0===n&&(n=new WeakMap,this.weakMaps[t]=n),n}get(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return;return t.get(e[e.length-1])}set(e,t){let n=this._getWeakMap(e);for(let r=0;r<e.length-1;r++){const t=e[r];!1===n.has(t)&&n.set(t,new WeakMap),n=n.get(t)}return n.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return!1;return t.delete(e[e.length-1])}}let dbe=0;class hbe{constructor(e,t,n,r,i,a,o,s,l,c){this.id=dbe++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=i,this.scene=a,this.camera=o,this.lightsNode=s,this.context=l,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=null!==c?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(null!==this.attributes)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set,i={};for(const a of e){let e;if(a.node&&a.node.attribute?e=a.node.attribute:(e=t.getAttribute(a.name),i[a.name]=e.version),void 0===e)continue;n.push(e);const o=e.isInterleavedBufferAttribute?e.data:e;r.add(o)}return this.attributes=n,this.attributesId=i,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:i}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),s=null!==o;let l=1;if(!0===n.isInstancedBufferGeometry?l=n.instanceCount:void 0!==e.count&&(l=Math.max(0,e.count)),0===l)return null;if(a.instanceCount=l,!0===e.isBatchedMesh)return a;let c=1;!0!==t.wireframe||e.isPoints||e.isLineSegments||e.isLine||e.isLineLoop||(c=2);let u=i.start*c,d=(i.start+i.count)*c;null!==r&&(u=Math.max(u,r.start*c),d=Math.min(d,(r.start+r.count)*c));const h=n.attributes.position;let p=1/0;s?p=o.count:void 0!==h&&null!==h&&(p=h.count),u=Math.max(u,0),d=Math.min(d,p);const f=d-u;return f<0||f===1/0?null:(a.vertexCount=f,a.firstVertex=u,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let e=0,n=r.length;e<n;e++){t+=r[e].id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:n}=this;let r=t.customProgramCacheKey();for(const i of function(e){const t=Object.keys(e);let n=Object.getPrototypeOf(e);for(;n;){const e=Object.getOwnPropertyDescriptors(n);for(const n in e)if(void 0!==e[n]){const r=e[n];r&&"function"===typeof r.get&&t.push(n)}n=Object.getPrototypeOf(n)}return t}(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const e=t[i];let a;if(null!==e){const t=typeof e;"number"===t?a=0!==e?"1":"0":"object"===t?(a="{",e.isTexture&&(a+=e.mapping,!0===n.backend.isWebGPUBackend&&(a+=e.magFilter,a+=e.minFilter,a+=e.wrapS,a+=e.wrapT,a+=e.wrapR)),a+="}"):a=String(e)}else a=String(e);r+=a+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",null!==e._colorsTexture&&(r+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(r+=e.uuid+","),r+=this.context.id+",",r+=e.receiveShadow+",",cse(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(null!==this.attributes){const e=this.attributesId;for(const t in e){const n=this.geometry.getAttribute(t);if(void 0===n||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return!0!==this.material.isShadowPassMaterial&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=dse(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=dse(e,1)),e=dse(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const pbe=[];class fbe{constructor(e,t,n,r,i,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=a,this.chainMaps={}}get(e,t,n,r,i,a,o,s){const l=this.getChainMap(s);pbe[0]=e,pbe[1]=t,pbe[2]=a,pbe[3]=i;let c=l.get(pbe);return void 0===c?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,i,a,o,s),l.set(pbe,c)):(c.updateClipping(o),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,n,r,i,a,o,s)):c.version=t.version)),pbe.length=0,c}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new ube)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,i,a,o,s,l,c,u){const d=this.getChainMap(u),h=new hbe(e,t,n,r,i,a,o,s,l,c);return h.onDispose=()=>{this.pipelines.delete(h),this.bindings.deleteForRender(h),this.nodes.delete(h),d.delete(h.getChainArray())},h}}class mbe{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const gbe=1,vbe=2,Abe=3,ybe=4,bbe=16;class xbe extends mbe{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return null!==t&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(void 0===n.version)t===gbe?this.backend.createAttribute(e):t===vbe?this.backend.createIndexAttribute(e):t===Abe?this.backend.createStorageAttribute(e):t===ybe&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const t=this._getBufferAttribute(e);(n.version<t.version||t.usage===UZ)&&(this.backend.updateAttribute(e),n.version=t.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function _be(e){return null!==e.index?e.index.version:e.attributes.position.version}function wbe(e){const t=[],n=e.index,r=e.attributes.position;if(null!==n){const e=n.array;for(let n=0,r=e.length;n<r;n+=3){const r=e[n+0],i=e[n+1],a=e[n+2];t.push(r,i,i,a,a,r)}}else{for(let e=0,n=r.array.length/3-1;e<n;e+=3){const n=e+0,r=e+1,i=e+2;t.push(n,r,r,i,i,n)}}const i=new($Z(t)?b1:y1)(t,1);return i.version=_be(e),i}class Sbe extends mbe{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&!0===this.get(t).initialized}updateForRender(e){!1===this.has(e)&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry;this.get(t).initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const r=t.index,i=e.getAttributes();null!==r&&this.attributes.delete(r);for(const e of i)this.attributes.delete(e);const a=this.wireframes.get(t);void 0!==a&&this.attributes.delete(a),t.removeEventListener("dispose",n),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",n),this._geometryDisposeListeners.set(t,n)}updateAttributes(e){const t=e.getAttributes();for(const i of t)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,Abe):this.updateAttribute(i,gbe);const n=this.getIndex(e);null!==n&&this.updateAttribute(n,vbe);const r=e.geometry.indirect;null!==r&&this.updateAttribute(r,ybe)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?void 0===this.attributeCall.get(e)?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(!0===n.wireframe){const e=this.wireframes;let n=e.get(t);void 0===n?(n=wbe(t),e.set(t,n)):n.version!==_be(t)&&(this.attributes.delete(n),n=wbe(t),e.set(t,n)),r=n}return r}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class Tbe{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):tJ("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class Cbe{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Mbe extends Cbe{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class Ebe extends Cbe{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let Pbe=0;class Nbe{constructor(e,t,n,r=null,i=null){this.id=Pbe++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=i,this.usedTimes=0}}class kbe extends mbe{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);void 0===o&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),o=new Nbe(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),n.createProgram(o));const s=this._getComputeCacheKey(e,o);let l=this.caches.get(s);void 0===l&&(i&&0===i.usedTimes&&this._releasePipeline(i),l=this._getComputePipeline(e,o,s,t)),l.usedTimes++,o.usedTimes++,r.version=e.version,r.pipeline=l}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let s=this.programs.vertex.get(a.vertexShader);void 0===s&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),s=new Nbe(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,s),n.createProgram(s));let l=this.programs.fragment.get(a.fragmentShader);void 0===l&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),l=new Nbe(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,l),n.createProgram(l));const c=this._getRenderCacheKey(e,s,l);let u=this.caches.get(c);void 0===u?(i&&0===i.usedTimes&&this._releasePipeline(i),u=this._getRenderPipeline(e,s,l,c,t)):e.pipeline=u,u.usedTimes++,s.usedTimes++,l.usedTimes++,r.pipeline=u}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,0===t.usedTimes&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,0===t.computeProgram.usedTimes&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,0===t.vertexProgram.usedTimes&&this._releaseProgram(t.vertexProgram),0===t.fragmentProgram.usedTimes&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let i=this.caches.get(n);return void 0===i&&(i=new Ebe(n,t),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(e,t,n,r,i){r=r||this._getRenderCacheKey(e,t,n);let a=this.caches.get(r);return void 0===a&&(a=new Mbe(r,t,n),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,i)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return void 0===t.pipeline||t.version!==e.version}_needsRenderUpdate(e){return void 0===this.get(e).pipeline||this.backend.needsRenderUpdate(e)}}class Rbe extends mbe{constructor(e,t,n,r,i,a){super(),this.backend=e,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const e=this.get(n);void 0===e.bindGroup&&(this._init(n),this.backend.createBindings(n,t,0),e.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const e=this.get(n);void 0===e.bindGroup&&(this._init(n),this.backend.createBindings(n,t,0),e.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(e){const t=e.getBindings();for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const e=t.attribute,n=e.isIndirectStorageBufferAttribute?ybe:Abe;this.attributes.update(e,n)}}_update(e,t){const{backend:n}=this;let r=!1,i=!0,a=0,o=0;for(const s of e.bindings){if(!1!==this.nodes.updateGroup(s)){if(s.isStorageBuffer){const e=s.attribute,t=e.isIndirectStorageBufferAttribute?ybe:Abe;this.attributes.update(e,t)}if(s.isUniformBuffer){s.update()&&n.updateBinding(s)}else if(s.isSampledTexture){const e=s.update(),t=s.texture,l=this.textures.get(t);e&&(this.textures.updateTexture(t),s.generation!==l.generation&&(s.generation=l.generation,r=!0,i=!1));if(void 0!==n.get(t).externalTexture||l.isDefaultTexture?i=!1:(a=10*a+t.id,o+=t.version),!0===t.isStorageTexture&&!0===t.mipmapsAutoUpdate){const e=this.get(t);!0===s.store?e.needsMipmap=!0:this.textures.needsMipmaps(t)&&!0===e.needsMipmap&&(this.backend.generateMipmaps(t),e.needsMipmap=!1)}}else if(s.isSampler){if(s.update()){const e=this.textures.updateSampler(s.texture);s.samplerKey!==e&&(s.samplerKey=e,r=!0,i=!1)}}}}!0===r&&this.backend.updateBindings(e,t,i?a:0,o)}}function Lbe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function Obe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function jbe(e){return(e.transmission>0||e.transmissionNode&&e.transmissionNode.isNode)&&2===e.side&&!1===e.forceSinglePass}class Dbe{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,i,a,o){let s=this.renderItems[this.renderItemsIndex];return void 0===s?(s={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:i,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=s):(s.id=e.id,s.object=e,s.geometry=t,s.material=n,s.groupOrder=r,s.renderOrder=e.renderOrder,s.z=i,s.group=a,s.clippingContext=o),this.renderItemsIndex++,s}push(e,t,n,r,i,a,o){const s=this.getNextRenderItem(e,t,n,r,i,a,o);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(jbe(n)&&this.transparentDoublePass.push(s),this.transparent.push(s)):this.opaque.push(s)}unshift(e,t,n,r,i,a,o){const s=this.getNextRenderItem(e,t,n,r,i,a,o);!0===n.transparent||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(jbe(n)&&this.transparentDoublePass.unshift(s),this.transparent.unshift(s)):this.opaque.unshift(s)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Lbe),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||Obe),this.transparent.length>1&&this.transparent.sort(t||Obe)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const t=this.renderItems[e];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.groupOrder=null,t.renderOrder=null,t.z=null,t.group=null,t.clippingContext=null}}}const Ibe=[];class Bbe{constructor(e){this.lighting=e,this.lists=new ube}get(e,t){const n=this.lists;Ibe[0]=e,Ibe[1]=t;let r=n.get(Ibe);return void 0===r&&(r=new Dbe(this.lighting,e,t),n.set(Ibe,r)),Ibe.length=0,r}dispose(){this.lists=new ube}}let Fbe=0;class zbe{constructor(){this.id=Fbe++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new DJ,this.scissor=!1,this.scissorValue=new DJ,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return Ube(this)}}function Ube(e){const{textures:t,activeCubeFace:n,activeMipmapLevel:r}=e,i=[n,r];for(const a of t)i.push(a.id);return use(i)}const Vbe=[],Gbe=new l2,qbe=new Y1;class Wbe{constructor(){this.chainMaps={}}get(e,t,n=null,r=null){let i;if(Vbe[0]=e,Vbe[1]=t,null!==r&&(Vbe[2]=r),null===n)i="default";else{const e=n.texture.format;i=`${n.textures.length}:${e}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const a=this._getChainMap(i);let o=a.get(Vbe);return void 0===o&&(o=new zbe,a.set(Vbe,o)),Vbe.length=0,null!==n&&(o.sampleCount=0===n.samples?1:n.samples),o}getForClear(e=null){return this.get(Gbe,qbe,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new ube)}dispose(){this.chainMaps={}}}const Hbe=new vJ;class $be extends mbe{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=0===e.samples?1:e.samples,i=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),s=o.width>>t,l=o.height>>t;let c=e.depthTexture||i[t];const u=!0===e.depthBuffer||!0===e.stencilBuffer;let d=!1;void 0===c&&u&&(c=new $2,c.format=e.stencilBuffer?PQ:EQ,c.type=e.stencilBuffer?_Q:vQ,c.image.width=s,c.image.height=l,c.image.depth=o.depth,c.renderTarget=e,c.isArrayTexture=!0===e.multiview&&o.depth>1,i[t]=c),n.width===o.width&&o.height===n.height||(d=!0,c&&(c.needsUpdate=!0,c.image.width=s,c.image.height=l,c.image.depth=c.isArrayTexture?c.image.depth:1)),n.width=o.width,n.height=o.height,n.textures=a,n.depthTexture=c||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(d=!0,c&&(c.needsUpdate=!0),n.sampleCount=r);const h={sampleCount:r};if(!0!==e.isXRRenderTarget){for(let e=0;e<a.length;e++){const t=a[e];d&&(t.needsUpdate=!0),this.updateTexture(t,h)}c&&this.updateTexture(c,h)}!0!==n.initialized&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",n.onDispose))}updateTexture(e,t={}){const n=this.get(e);if(!0===n.initialized&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(r&&!0===n.initialized&&i.destroyTexture(e),e.isFramebufferTexture){const t=this.renderer.getRenderTarget();e.type=t?t.texture.type:hQ}const{width:a,height:o,depth:s}=this.getSize(e);if(t.width=a,t.height=o,t.depth=s,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||!0===e.isStorageTexture||!0===e.isExternalTexture)i.createTexture(e,t),n.generation=e.version;else if(e.version>0){const r=e.image;if(void 0===r)eJ("Renderer: Texture marked for update but image is undefined.");else if(!1===r.complete)eJ("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const n=[];for(const t of e.images)n.push(t);t.images=n}else t.image=r;void 0!==n.isDefaultTexture&&!0!==n.isDefaultTexture||(i.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),!0===e.source.dataReady&&i.updateTexture(e,t);const a=!0===e.isStorageTexture&&!1===e.mipmapsAutoUpdate;t.needsMipmaps&&0===e.mipmaps.length&&!a&&i.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else i.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;!0!==n.initialized&&(n.initialized=!0,n.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&!0===TJ.enabled&&TJ.getTransfer(e.colorSpace)!==NZ&&eJ("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=Hbe){let n=e.images?e.images[0]:e.image;return n?(void 0!==n.image&&(n=n.image),"undefined"!==typeof HTMLVideoElement&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):"undefined"!==typeof VideoFrame&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return r=e.mipmaps.length>0?e.mipmaps.length:!0===e.isCompressedTexture?1:Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return!0===e.generateMipmaps||e.mipmaps.length>0}_destroyRenderTarget(e){if(!0===this.has(e)){const t=this.get(e),n=t.textures,r=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let e=0;e<n.length;e++)this._destroyTexture(n[e]);r&&this._destroyTexture(r),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(!0===this.has(e)){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const n=t.isDefaultTexture;this.backend.destroyTexture(e,n),this.delete(e),this.info.memory.textures--}}}class Kbe extends o1{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return void 0!==e.a&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class Xbe extends ace{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const n=this.getNodeType(e),r=e.getStructTypeNode(n);let i;return null!==r?i=r.getMemberType(e,t):(tJ(`TSL: Member "${t}" not found in struct "${n}".`),i="float"),i}getHash(){return this.uuid}generate(){return this.name}}class Ybe extends Lse{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return!0!==e.isNode?(tJ("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const n=new _le(t);return this._currentCond=Gde(e,n),this.addToStack(this._currentCond)}ElseIf(e,t){const n=new _le(t),r=Gde(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new _le(e),this}Switch(e){return this._expressionNode=wle(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(wle(e[a])));else tJ("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=new _le(e[e.length-1]);let r=t[0];for(let a=1;a<t.length;a++)r=r.or(t[a]);const i=Gde(r,n);return null===this._currentCond?(this._currentCond=i,this.addToStack(this._currentCond)):(this._currentCond.elseNode=i,this._currentCond=i,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())r.isVarNode&&r.isIntent(e)&&!0!==r.isAssign(e)||(t["node"+n++]=r);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const n=Ole(),r=e.buildStage;Lle(this),e.setActiveStack(this);const i=t=>{if(this._currentNode=t,!t.isVarNode||!t.isIntent(e)||!0===t.isAssign(e))if("setup"===r)t.build(e);else if("analyze"===r)t.build(e,this);else if("generate"===r){const n=e.getDataFromNode(t,"any").stages,r=n&&n[e.shaderStage];if(t.isVarNode&&r&&1===r.length&&r[0]&&r[0].isStackNode)return;t.build(e,"void")}},a=[...this.nodes];for(const l of a)i(l);this._currentNode=null;const o=this.nodes.filter(e=>-1===a.indexOf(e));for(const l of o)i(l);let s;return s=this.hasOutput?this.outputNode.build(e,...t):super.build(e,...t),Lle(n),e.removeActiveStack(this),s}}const Qbe=Mle(Ybe).setParameterLength(0,1);class Zbe extends Lse{static get type(){return"StructTypeNode"}constructor(e,t=null){var n;super("struct"),this.membersLayout=(n=e,Object.entries(n).map(([e,t])=>"string"===typeof t?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,n=0;for(const r of this.membersLayout){const i=r.type,a=vse(i),o=Ase(i)/e;t=Math.max(t,o);const s=n%t%o;0!==s&&(n+=o-s),n+=a}return Math.ceil(n/t)*t}getMemberType(e,t){const n=this.membersLayout.find(e=>e.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class Jbe extends Lse{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),n=t.type,r=e.getPropertyName(t);return e.addLineFlowCode(`${r} = ${e.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}class exe extends Lse{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(void 0===t.membersLayout){const n=this.members,r=[];for(let t=0;t<n.length;t++){const i="m"+t,a=n[t].getNodeType(e);r.push({name:i,type:a,index:t})}t.membersLayout=r,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),n=this.members,r=""!==t?t+".":"";for(let i=0;i<n.length;i++){const t=n[i].build(e);e.addLineFlowCode(`${r}m${i} = ${t}`,this)}return t}}const txe=Mle(exe);function nxe(e,t){for(let n=0;n<e.length;n++)if(e[n].name===t)return n;return-1}class rxe extends exe{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return void 0!==this.outputNodes[e]}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return ixe(t)}setup(e){const t=this.outputNodes,n=[],r=e.renderer.getRenderTarget().textures;for(const i in t){n[nxe(r,i)]=Yle(t[i])}return this.members=n,super.setup(e)}}const ixe=Mle(rxe);class axe extends Dse{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(null!==this.inputType){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(null!==this.inputType){const t=this.valueNode.getNodeType(e);n=1===e.getTypeLength(t)?this.inputType:e.changeComponentType(t,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}}const oxe=Ple(axe).setParameterLength(2),sxe=e=>new axe(e,"uint","float"),lxe={};class cxe extends Cue{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,n){"int"===n?t.assign(oxe(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return zle;case"int":return Fle;case"uvec2":return qle;case"uvec3":return Kle;case"uvec4":return Zle;case"ivec2":return Gle;case"ivec3":return $le;case"ivec4":return Qle}}_createTrailingZerosBaseLayout(e,t){const n=this._returnDataNode(t),r=Rle(([e])=>{const r=zle(0);this._resolveElementType(e,r,t);const i=Ble(r.bitAnd(nde(r))),a=sxe(i).shiftRight(23).sub(127);return n(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]});return r}_createLeadingZerosBaseLayout(e,t){const n=this._returnDataNode(t),r=Rle(([e])=>{jle(e.equal(zle(0)),()=>zle(32));const r=zle(0),i=zle(0);return this._resolveElementType(e,r,t),jle(r.shiftRight(16).equal(0),()=>{i.addAssign(16),r.shiftLeftAssign(16)}),jle(r.shiftRight(24).equal(0),()=>{i.addAssign(8),r.shiftLeftAssign(8)}),jle(r.shiftRight(28).equal(0),()=>{i.addAssign(4),r.shiftLeftAssign(4)}),jle(r.shiftRight(30).equal(0),()=>{i.addAssign(2),r.shiftLeftAssign(2)}),jle(r.shiftRight(31).equal(0),()=>{i.addAssign(1)}),n(i)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]});return r}_createOneBitsBaseLayout(e,t){const n=this._returnDataNode(t),r=Rle(([e])=>{const r=zle(0);this._resolveElementType(e,r,t),r.assign(r.sub(r.shiftRight(zle(1)).bitAnd(zle(1431655765)))),r.assign(r.bitAnd(zle(858993459)).add(r.shiftRight(zle(2)).bitAnd(zle(858993459))));const i=r.add(r.shiftRight(zle(4))).bitAnd(zle(252645135)).mul(zle(16843009)).shiftRight(zle(24));return n(i)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]});return r}_createMainLayout(e,t,n,r){const i=this._returnDataNode(t),a=Rle(([e])=>{if(1===n)return i(r(e));{const t=i(0),a=["x","y","z","w"];for(let i=0;i<n;i++){const n=a[i];t[n].assign(r(e[n]))}return t}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]});return a}setup(e){const{method:t,aNode:n}=this,{renderer:r}=e;if(r.backend.isWebGPUBackend)return super.setup(e);const i=this.getInputType(e),a=e.getElementType(i),o=e.getTypeLength(i),s=`${t}_base_${a}`,l=`${t}_${i}`;let c=lxe[s];if(void 0===c){switch(t){case cxe.COUNT_LEADING_ZEROS:c=this._createLeadingZerosBaseLayout(s,a);break;case cxe.COUNT_TRAILING_ZEROS:c=this._createTrailingZerosBaseLayout(s,a);break;case cxe.COUNT_ONE_BITS:c=this._createOneBitsBaseLayout(s,a)}lxe[s]=c}let u=lxe[l];void 0===u&&(u=this._createMainLayout(l,i,o,c),lxe[l]=u);return Rle(()=>u(n))()}}cxe.COUNT_TRAILING_ZEROS="countTrailingZeros",cxe.COUNT_LEADING_ZEROS="countLeadingZeros",cxe.COUNT_ONE_BITS="countOneBits";const uxe=Ple(cxe,cxe.COUNT_TRAILING_ZEROS).setParameterLength(1),dxe=Ple(cxe,cxe.COUNT_LEADING_ZEROS).setParameterLength(1),hxe=Ple(cxe,cxe.COUNT_ONE_BITS).setParameterLength(1),pxe=Rle(([e])=>{const t=e.toUint().mul(747796405).add(2891336453),n=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return n.shiftRight(22).bitXor(n).toFloat().mul(1/2**32)}),fxe=(e,t)=>_de(nue(4,e.mul(tue(1,e))),t);class mxe extends Dse{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const gxe=Ple(mxe,"snorm").setParameterLength(1),vxe=Ple(mxe,"unorm").setParameterLength(1),Axe=Ple(mxe,"float16").setParameterLength(1);class yxe extends Dse{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const bxe=Ple(yxe,"snorm").setParameterLength(1),xxe=Ple(yxe,"unorm").setParameterLength(1),_xe=Ple(yxe,"float16").setParameterLength(1),wxe=Rle(([e])=>e.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),Sxe=Rle(([e])=>Hle(wxe(e.z.add(wxe(e.y.mul(1)))),wxe(e.z.add(wxe(e.x.mul(1)))),wxe(e.y.add(wxe(e.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Txe=Rle(([e,t,n])=>{const r=Hle(e).toVar(),i=Ble(1.4).toVar(),a=Ble(0).toVar(),o=Hle(r).toVar();return Rge({start:Ble(0),end:Ble(3),type:"float",condition:"<="},()=>{const e=Hle(Sxe(o.mul(2))).toVar();r.addAssign(e.add(n.mul(Ble(.1).mul(t)))),o.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);const s=Ble(wxe(r.z.add(wxe(r.x.add(wxe(r.y)))))).toVar();a.addAssign(s.div(i)),o.addAssign(.14)}),a}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class Cxe extends Lse{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let n=this._candidateFn;if(null===n){let r=null,i=-1;for(const n of this.functionNodes){const a=n.shaderNode.layout;if(null===a)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const o=a.inputs;if(t.length===o.length){let a=0;for(let n=0;n<t.length;n++){const r=t[n],i=o[n];r.getNodeType(e)===i.type&&a++}a>i&&(r=n,i=a)}}this._candidateFn=n=r}return n}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const Mxe=Mle(Cxe),Exe=e=>(...t)=>Mxe(e,...t),Pxe=Wce(0).setGroup(Vce).onRenderUpdate(e=>e.time),Nxe=Wce(0).setGroup(Vce).onRenderUpdate(e=>e.deltaTime),kxe=Wce(0,"uint").setGroup(Vce).onRenderUpdate(e=>e.frameId);const Rxe=Rle(([e,t,n=Vle(.5)])=>Jye(e.sub(n),t).add(n)),Lxe=Rle(([e,t,n=Vle(.5)])=>{const r=e.sub(n),i=r.dot(r),a=i.mul(i).mul(t);return e.add(r.mul(a))}),Oxe=Rle(({position:e=null,horizontal:t=!0,vertical:n=!1})=>{let r;null!==e?(r=qpe.toVar(),r[3][0]=e.x,r[3][1]=e.y,r[3][2]=e.z):r=qpe;const i=Ppe.mul(r);return ble(t)&&(i[0][0]=qpe[0].length(),i[0][1]=0,i[0][2]=0),ble(n)&&(i[1][0]=0,i[1][1]=qpe[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,Mpe.mul(i).mul(nfe)}),jxe=Rle(([e=null])=>{const t=ive();return ive(Yge(e)).sub(t).lessThan(0).select(gpe,e)});class Dxe extends Lse{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Yhe(),n=Ble(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){const{frameNode:e,uvNode:t,countNode:n}=this,{width:r,height:i}=n,a=e.mod(r.mul(i)).floor(),o=a.mod(r),s=i.sub(a.add(1).div(r).ceil()),l=n.reciprocal(),c=Vle(o,s);return t.add(c).mul(l)}}const Ixe=Mle(Dxe).setParameterLength(3),Bxe=Rle(([e,t=null,n=null,r=Ble(1),i=nfe,a=pfe])=>{let o=a.abs().normalize();o=o.div(o.dot(Hle(1)));const s=i.yz.mul(r),l=i.zx.mul(r),c=i.xy.mul(r),u=e.value,d=null!==t?t.value:u,h=null!==n?n.value:u,p=ipe(u,s).mul(o.x),f=ipe(d,l).mul(o.y),m=ipe(h,c).mul(o.z);return eue(p,f,m)}),Fxe=new A2,zxe=new vJ,Uxe=new vJ,Vxe=new vJ,Gxe=new f0,qxe=new vJ(0,0,-1),Wxe=new DJ,Hxe=new vJ,$xe=new vJ,Kxe=new DJ,Xxe=new mJ,Yxe=new IJ,Qxe=gpe.flipX();Yxe.depthTexture=new $2(1,1);let Zxe=!1;class Jxe extends npe{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||Yxe.texture,Qxe),this._reflectorBaseNode=e.reflector||new e_e(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(null===this._depthNode){if(!0!==this._reflectorBaseNode.depth)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=wle(new Jxe({defaultTexture:Yxe.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class e_e extends Lse{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new U0,resolutionScale:r=1,generateMipmaps:i=!1,bounces:a=!0,depth:o=!1,samples:s=0}=t;this.textureNode=e,this.target=n,this.resolutionScale=r,void 0!==t.resolution&&(nJ('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=i,this.bounces=a,this.depth=o,this.samples=s,this.updateBeforeType=a?Tse.RENDER:Tse.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const n=this.resolutionScale;t.getDrawingBufferSize(Xxe),e.setSize(Math.round(Xxe.width*n),Math.round(Xxe.height*n))}setup(e){return this._updateResolution(Yxe,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return void 0===t&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return void 0===t&&(t=new IJ(0,0,{type:yQ,samples:this.samples}),!0===this.generateMipmaps&&(t.texture.minFilter=1008,t.texture.generateMipmaps=!0),!0===this.depth&&(t.depthTexture=new $2),this.renderTargets.set(e,t)),t}updateBefore(e){if(!1===this.bounces&&Zxe)return!1;Zxe=!0;const{scene:t,camera:n,renderer:r,material:i}=e,{target:a}=this,o=this.getVirtualCamera(n),s=this.getRenderTarget(o);r.getDrawingBufferSize(Xxe),this._updateResolution(s,r),Uxe.setFromMatrixPosition(a.matrixWorld),Vxe.setFromMatrixPosition(n.matrixWorld),Gxe.extractRotation(a.matrixWorld),zxe.set(0,0,1),zxe.applyMatrix4(Gxe),Hxe.subVectors(Uxe,Vxe);let l=!1;if(!0===Hxe.dot(zxe)>0&&!1===this.forceUpdate){if(!1===this.hasOutput)return void(Zxe=!1);l=!0}Hxe.reflect(zxe).negate(),Hxe.add(Uxe),Gxe.extractRotation(n.matrixWorld),qxe.set(0,0,-1),qxe.applyMatrix4(Gxe),qxe.add(Vxe),$xe.subVectors(Uxe,qxe),$xe.reflect(zxe).negate(),$xe.add(Uxe),o.coordinateSystem=n.coordinateSystem,o.position.copy(Hxe),o.up.set(0,1,0),o.up.applyMatrix4(Gxe),o.up.reflect(zxe),o.lookAt($xe),o.near=n.near,o.far=n.far,o.updateMatrixWorld(),o.projectionMatrix.copy(n.projectionMatrix),Fxe.setFromNormalAndCoplanarPoint(zxe,Uxe),Fxe.applyMatrix4(o.matrixWorldInverse),Wxe.set(Fxe.normal.x,Fxe.normal.y,Fxe.normal.z,Fxe.constant);const c=o.projectionMatrix;Kxe.x=(Math.sign(Wxe.x)+c.elements[8])/c.elements[0],Kxe.y=(Math.sign(Wxe.y)+c.elements[9])/c.elements[5],Kxe.z=-1,Kxe.w=(1+c.elements[10])/c.elements[14],Wxe.multiplyScalar(1/Wxe.dot(Kxe));c.elements[2]=Wxe.x,c.elements[6]=Wxe.y,c.elements[10]=r.coordinateSystem===qZ?Wxe.z-0:Wxe.z+1-0,c.elements[14]=Wxe.w,this.textureNode.value=s.texture,!0===this.depth&&(this.textureNode.getDepthNode().value=s.depthTexture),i.visible=!1;const u=r.getRenderTarget(),d=r.getMRT(),h=r.autoClear;r.setMRT(null),r.setRenderTarget(s),r.autoClear=!0;const p=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",l?(r.clear(),this.hasOutput=!1):(r.render(t,o),this.hasOutput=!0),t.name=p,r.setMRT(d),r.setRenderTarget(u),r.autoClear=h,i.visible=!0,Zxe=!1,this.forceUpdate=!1}get resolution(){return nJ('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){nJ('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const t_e=new G4(-1,1,1,-1,0,1);class n_e extends N1{constructor(e=!1){super();const t=!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new _1([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _1(t,2))}}const r_e=new n_e;class i_e extends V1{constructor(e=null){super(r_e,e),this.camera=t_e,this.isQuadMesh=!0}async renderAsync(e){nJ('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,t_e)}render(e){e.render(this,t_e)}}const a_e=new mJ;class o_e extends npe{static get type(){return"RTTNode"}constructor(e,t=null,n=null,r={type:yQ}){const i=new IJ(t,n,r);super(i.texture,Yhe()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new i_e(new yve),this.updateBeforeType=Tse.RENDER}get autoResize(){return null===this.width}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,r=t*this.pixelRatio;this.renderTarget.setSize(n,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(!1===this.textureNeedsUpdate&&!1===this.autoUpdate)return;if(this.textureNeedsUpdate=!1,!0===this.autoResize){const t=e.getPixelRatio(),n=e.getSize(a_e),r=Math.floor(n.width*t),i=Math.floor(n.height*t);r===this.renderTarget.width&&i===this.renderTarget.height||(this.renderTarget.setSize(r,i),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(n)}clone(){const e=new npe(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const s_e=(e,...t)=>wle(new o_e(wle(e),...t)),l_e=Rle(([e,t,n],r)=>{let i;r.renderer.coordinateSystem===qZ?(e=Vle(e.x,e.y.oneMinus()).mul(2).sub(1),i=Yle(Hle(e,t),1)):i=Yle(Hle(e.x,e.y.oneMinus(),t).mul(2).sub(1),1);const a=Yle(n.mul(i));return a.xyz.div(a.w)}),c_e=Rle(([e,t])=>{const n=t.mul(Yle(e,1)),r=n.xy.div(n.w).mul(.5).add(.5).toVar();return Vle(r.x,r.y.oneMinus())}),u_e=Rle(([e,t,n])=>{const r=Zhe(ape(t)),i=Gle(e.mul(r)).toVar(),a=ape(t,i).toVar(),o=ape(t,i.sub(Gle(2,0))).toVar(),s=ape(t,i.sub(Gle(1,0))).toVar(),l=ape(t,i.add(Gle(1,0))).toVar(),c=ape(t,i.add(Gle(2,0))).toVar(),u=ape(t,i.add(Gle(0,2))).toVar(),d=ape(t,i.add(Gle(0,1))).toVar(),h=ape(t,i.sub(Gle(0,1))).toVar(),p=ape(t,i.sub(Gle(0,2))).toVar(),f=Jue(tue(Ble(2).mul(s).sub(o),a)).toVar(),m=Jue(tue(Ble(2).mul(l).sub(c),a)).toVar(),g=Jue(tue(Ble(2).mul(d).sub(u),a)).toVar(),v=Jue(tue(Ble(2).mul(h).sub(p),a)).toVar(),A=l_e(e,a,n).toVar(),y=f.lessThan(m).select(A.sub(l_e(e.sub(Vle(Ble(1).div(r.x),0)),s,n)),A.negate().add(l_e(e.add(Vle(Ble(1).div(r.x),0)),l,n))),b=g.lessThan(v).select(A.sub(l_e(e.add(Vle(0,Ble(1).div(r.y))),d,n)),A.negate().add(l_e(e.sub(Vle(0,Ble(1).div(r.y))),h,n)));return Wue(xde(y,b))}),d_e=Rle(([e])=>Hue(Ble(52.9829189).mul(Hue(bde(e,Vle(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),h_e=Rle(([e,t,n])=>{const r=Ble(2.399963229728653),i=Uue(Ble(e).add(.5).div(Ble(t))),a=Ble(e).mul(r).add(n);return Vle(Kue(a),$ue(a)).mul(i)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class p_e extends Lse{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(Yhe())}sample(e){return this.callback(e)}}class f_e extends Lse{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===f_e.OBJECT?this.updateType=Tse.OBJECT:e===f_e.MATERIAL?this.updateType=Tse.RENDER:e===f_e.BEFORE_OBJECT?this.updateBeforeType=Tse.OBJECT:e===f_e.BEFORE_MATERIAL&&(this.updateBeforeType=Tse.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}f_e.OBJECT="object",f_e.MATERIAL="material",f_e.BEFORE_OBJECT="beforeObject",f_e.BEFORE_MATERIAL="beforeMaterial";const m_e=(e,t)=>new f_e(e,t).toStack();class g_e extends f2{constructor(e,t,n=Float32Array){super(ArrayBuffer.isView(e)?e:new n(e*t),t),this.isStorageInstancedBufferAttribute=!0}}class v_e extends A1{constructor(e,t,n=Float32Array){super(ArrayBuffer.isView(e)?e:new n(e*t),t),this.isStorageBufferAttribute=!0}}class A_e extends Lse{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const y_e=Ele(A_e),b_e=new S0,x_e=new f0;class __e extends Lse{static get type(){return"SceneNode"}constructor(e=__e.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=null!==this.scene?this.scene:e.scene;let r;return t===__e.BACKGROUND_BLURRINESS?r=zfe("backgroundBlurriness","float",n):t===__e.BACKGROUND_INTENSITY?r=zfe("backgroundIntensity","float",n):t===__e.BACKGROUND_ROTATION?r=Wce("mat4").setName("backgroundRotation").setGroup(Vce).onRenderUpdate(()=>{const e=n.background;return null!==e&&e.isTexture&&e.mapping!==QY?(b_e.copy(n.backgroundRotation),b_e.x*=-1,b_e.y*=-1,b_e.z*=-1,x_e.makeRotationFromEuler(b_e)):x_e.identity(),x_e}):tJ("SceneNode: Unknown scope:",t),r}}__e.BACKGROUND_BLURRINESS="backgroundBlurriness",__e.BACKGROUND_INTENSITY="backgroundIntensity",__e.BACKGROUND_ROTATION="backgroundRotation";const w_e=Ele(__e,__e.BACKGROUND_BLURRINESS),S_e=Ele(__e,__e.BACKGROUND_INTENSITY),T_e=Ele(__e,__e.BACKGROUND_ROTATION);class C_e extends npe{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=Cse.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let n;return n=null!==this.storeNode?this.generateStore(e):super.generate(e,t),n}toReadWrite(){return this.setAccess(Cse.READ_WRITE)}toReadOnly(){return this.setAccess(Cse.READ_ONLY)}toWriteOnly(){return this.setAccess(Cse.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:r,depthNode:i}=t,a=super.generate(e,"property"),o=n.build(e,!0===this.value.is3DTexture?"uvec3":"uvec2"),s=r.build(e,"vec4"),l=i?i.build(e,"int"):null,c=e.generateTextureStore(e,a,o,l,s);e.addLineFlowCode(c,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const M_e=Mle(C_e).setParameterLength(1,3),E_e=Rle(({texture:e,uv:t})=>{const n=1e-4,r=Hle().toVar();return jle(t.x.lessThan(n),()=>{r.assign(Hle(1,0,0))}).ElseIf(t.y.lessThan(n),()=>{r.assign(Hle(0,1,0))}).ElseIf(t.z.lessThan(n),()=>{r.assign(Hle(0,0,1))}).ElseIf(t.x.greaterThan(.9999),()=>{r.assign(Hle(-1,0,0))}).ElseIf(t.y.greaterThan(.9999),()=>{r.assign(Hle(0,-1,0))}).ElseIf(t.z.greaterThan(.9999),()=>{r.assign(Hle(0,0,-1))}).Else(()=>{const n=.01,i=e.sample(t.add(Hle(-.01,0,0))).r.sub(e.sample(t.add(Hle(n,0,0))).r),a=e.sample(t.add(Hle(0,-.01,0))).r.sub(e.sample(t.add(Hle(0,n,0))).r),o=e.sample(t.add(Hle(0,0,-.01))).r.sub(e.sample(t.add(Hle(0,0,n))).r);r.assign(Hle(i,a,o))}),r.normalize()});class P_e extends npe{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Hle(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return!e.isFlipY()||!0!==n.isRenderTargetTexture&&!0!==n.isFramebufferTexture||(t=this.sampler?t.flipY():t.setY(Fle(Zhe(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,!0===this.sampler?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return E_e({texture:this,uv:e})}}const N_e=Mle(P_e).setParameterLength(1,3);class k_e extends Ffe{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=null!==this.userData?this.userData:e.object.userData,this.reference}}const R_e=new WeakMap;class L_e extends Dse{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Tse.OBJECT,this.updateAfterType=Tse.OBJECT,this.previousModelWorldMatrix=Wce(new f0),this.previousProjectionMatrix=Wce(new f0).setGroup(Vce),this.previousCameraViewMatrix=Wce(new f0)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const r=j_e(n);this.previousModelWorldMatrix.value.copy(r);const i=O_e(t);i.frameId!==e&&(i.frameId=e,void 0===i.previousProjectionMatrix?(i.previousProjectionMatrix=new f0,i.previousCameraViewMatrix=new f0,i.currentProjectionMatrix=new f0,i.currentCameraViewMatrix=new f0,i.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:e}){j_e(e).copy(e.matrixWorld)}setup(){const e=null===this.projectionMatrix?Mpe:Wce(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(Qpe).mul(nfe),r=this.previousProjectionMatrix.mul(t).mul(rfe),i=n.xy.div(n.w),a=r.xy.div(r.w);return tue(i,a)}}function O_e(e){let t=R_e.get(e);return void 0===t&&(t={},R_e.set(e,t)),t}function j_e(e,t=0){const n=O_e(e);let r=n[t];return void 0===r&&(n[t]=r=new f0,n[t].copy(e.matrixWorld)),r}const D_e=Ele(L_e),I_e=Rle(([e])=>U_e(e.rgb)),B_e=Rle(([e,t=Ble(1)])=>t.mix(U_e(e.rgb),e.rgb)),F_e=Rle(([e,t=Ble(1)])=>{const n=eue(e.r,e.g,e.b).div(3),r=e.r.max(e.g.max(e.b)),i=r.sub(n).mul(t).mul(-3);return Pde(e.rgb,r,i)}),z_e=Rle(([e,t=Ble(1)])=>{const n=Hle(.57735,.57735,.57735),r=t.cos();return Hle(e.rgb.mul(r).add(n.cross(e.rgb).mul(t.sin()).add(n.mul(bde(n,e.rgb).mul(r.oneMinus())))))}),U_e=(e,t=Hle(TJ.getLuminanceCoefficients(new vJ)))=>bde(e,t),V_e=Rle(([e,t=Hle(1),n=Hle(0),r=Hle(1),i=Ble(1),a=Hle(TJ.getLuminanceCoefficients(new vJ,EZ))])=>{const o=e.rgb.dot(Hle(a)),s=mde(e.rgb.mul(t).add(n),0).toVar(),l=s.pow(r).toVar();return jle(s.r.greaterThan(0),()=>{s.r.assign(l.r)}),jle(s.g.greaterThan(0),()=>{s.g.assign(l.g)}),jle(s.b.greaterThan(0),()=>{s.b.assign(l.b)}),s.assign(o.add(s.sub(o).mul(i))),Yle(s.rgb,e.a)});class G_e extends Dse{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const q_e=Mle(G_e).setParameterLength(2),W_e=new mJ;class H_e extends npe{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class $_e extends H_e{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class K_e extends Dse{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new $2;i.isRenderTargetTexture=!0,i.name="depth";const a=new IJ(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:yQ,...r});a.texture.name="output",a.depthTexture=i,this.renderTarget=a,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:a.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Wce(0),this._cameraFar=Wce(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Tse.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return eJ("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return eJ("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];if(void 0===t){t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)}return t}getPreviousTexture(e){let t=this._previousTextures[e];return void 0===t&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(void 0!==t){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return void 0===t&&(t=new $_e(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return void 0===t&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),t=new $_e(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(void 0===t){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=eve(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(void 0===t){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=Zge(i,n,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=void 0===this.options.samples?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===K_e.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,i;const a=t.getOutputRenderTarget();a&&!0===a.isXRRenderTarget?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),W_e.set(a.width,a.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize(W_e)),this._pixelRatio=i,this.setSize(W_e.width,W_e.height);const o=t.getRenderTarget(),s=t.getMRT(),l=t.autoClear,c=t.transparent,u=t.opaque,d=r.layers.mask,h=t.contextNode,p=n.overrideMaterial;this._cameraNear.value=r.near,this._cameraFar.value=r.far,null!==this._layers&&(r.layers.mask=this._layers.mask);for(const m in this._previousTextures)this.toggleTexture(m);null!==this.overrideMaterial&&(n.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,null!==this.contextNode&&(null!==this._contextNodeCache&&this._contextNodeCache.version===this.version||(this._contextNodeCache={version:this.version,context:Wde({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const f=n.name;n.name=this.name?this.name:n.name,t.render(n,r),n.name=f,n.overrideMaterial=p,t.setRenderTarget(o),t.setMRT(s),t.autoClear=l,t.transparent=c,t.opaque=u,t.contextNode=h,r.layers.mask=d}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,r),null!==this._scissor&&this.renderTarget.scissor.copy(this._scissor),null!==this._viewport&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,r){null===e?this._scissor=null:(null===this._scissor&&(this._scissor=new DJ),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,r){null===e?this._viewport=null:(null===this._viewport&&(this._viewport=new DJ),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}K_e.COLOR="color",K_e.DEPTH="depth";class X_e extends K_e{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,r,i){super(K_e.COLOR,e,t),this.colorNode=n,this.thicknessNode=r,this.alphaNode=i,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((e,n,r,i,a,o,s,l)=>{if((a.isMeshToonMaterial||a.isMeshToonNodeMaterial)&&!1===a.wireframe){const c=this._getOutlineMaterial(a);t.renderObject(e,n,r,i,c,o,s,l)}t.renderObject(e,n,r,i,a,o,s,l)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new yve;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=1;const t=pfe.negate(),n=Mpe.mul(Qpe),r=Ble(1),i=n.mul(Yle(nfe,1)),a=n.mul(Yle(nfe.add(t),1)),o=Wue(i.sub(a));return e.vertexNode=i.add(o.mul(this.thicknessNode).mul(i.w).mul(r)),e.colorNode=Yle(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return void 0===t&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const Y_e=Rle(([e,t])=>e.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Q_e=Rle(([e,t])=>(e=e.mul(t)).div(e.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Z_e=Rle(([e,t])=>{const n=(e=(e=e.mul(t)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),r=e.mul(e.mul(6.2).add(1.7)).add(.06);return n.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),J_e=Rle(([e])=>{const t=e.mul(e.add(.0245786)).sub(90537e-9),n=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(n)}),ewe=Rle(([e,t])=>{const n=tce(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=tce(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=n.mul(e),e=J_e(e),(e=r.mul(e)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),twe=tce(Hle(1.6605,-.1246,-.0182),Hle(-.5876,1.1329,-.1006),Hle(-.0728,-.0083,1.1187)),nwe=tce(Hle(.6274,.0691,.0164),Hle(.3293,.9195,.088),Hle(.0433,.0113,.8956)),rwe=Rle(([e])=>{const t=Hle(e).toVar(),n=Hle(t.mul(t)).toVar(),r=Hle(n.mul(n)).toVar();return Ble(15.5).mul(r.mul(n)).sub(nue(40.14,r.mul(t))).add(nue(31.96,r).sub(nue(6.868,n.mul(t))).add(nue(.4298,n).add(nue(.1191,t).sub(.00232))))}),iwe=Rle(([e,t])=>{const n=Hle(e).toVar(),r=tce(Hle(.856627153315983,.137318972929847,.11189821299995),Hle(.0951212405381588,.761241990602591,.0767994186031903),Hle(.0482516061458583,.101439036467562,.811302368396859)),i=tce(Hle(1.1271005818144368,-.1413297634984383,-.14132976349843826),Hle(-.11060664309660323,1.157823702216272,-.11060664309660294),Hle(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=Ble(-12.47393),o=Ble(4.026069);return n.mulAssign(t),n.assign(nwe.mul(n)),n.assign(r.mul(n)),n.assign(mde(n,1e-10)),n.assign(zue(n)),n.assign(n.sub(a).div(o.sub(a))),n.assign(Nde(n,0,1)),n.assign(rwe(n)),n.assign(i.mul(n)),n.assign(_de(mde(Hle(0),n),Hle(2.2))),n.assign(twe.mul(n)),n.assign(Nde(n,0,1)),n}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),awe=Rle(([e,t])=>{const n=Ble(.76),r=Ble(.15);e=e.mul(t);const i=fde(e.r,fde(e.g,e.b)),a=Gde(i.lessThan(.08),i.sub(nue(6.25,i.mul(i))),.04);e.subAssign(a);const o=mde(e.r,mde(e.g,e.b));jle(o.lessThan(n),()=>e);const s=tue(1,n),l=tue(1,s.mul(s).div(o.add(s.sub(n))));e.mulAssign(l.div(o));const c=tue(1,rue(1,r.mul(o.sub(l)).add(1)));return Pde(e,Hle(l),c)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class owe extends Lse{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const swe=Mle(owe).setParameterLength(1,3);class lwe extends owe{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return void 0===n&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,i=n.type,a=e.getCodeFromNode(this,i);""!==r&&(a.name=r);const o=e.getPropertyName(a),s=this.getNodeFunction(e).getCode(o);return a.code=s+"\n","property"===t?o:e.format(`${o}()`,i,t)}}const cwe=(e,t=[],n="")=>{for(let a=0;a<t.length;a++){const e=t[a];"function"===typeof e&&(t[a]=e.functionNode)}const r=new lwe(e,t,n),i=(...e)=>r.call(...e);return i.functionNode=r,i};class uwe extends Lse{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new rJ,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(e){this._value!==e&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&null===this._cache&&"URL"===this.inputType&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&null!==e.value&&void 0!==e.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"===typeof e.value||"Number"===this.inputType&&"number"===typeof e.value||"Vector2"===this.inputType&&e.value.isVector2||"Vector3"===this.inputType&&e.value.isVector3||"Vector4"===this.inputType&&e.value.isVector4||"Color"===this.inputType&&e.value.isColor||"Matrix3"===this.inputType&&e.value.isMatrix3||"Matrix4"===this.inputType&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:Ble()}serialize(e){super.serialize(e),null!==this.value?"ArrayBuffer"===this.inputType?e.value=_se(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;null!==e.value&&(t="ArrayBuffer"===e.inputType?wse(e.value):"Texture"===e.inputType?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const dwe=Mle(uwe).setParameterLength(1);class hwe extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(null!==t){const r=t(...n);return this.set(e,r),r}}}class pwe{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const fwe=new hwe;class mwe extends Lse{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new hwe,this._output=dwe(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const n=this._outputs;return void 0===n[e]?n[e]=dwe(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener("refresh",this.onRefresh)):void 0===n[e]?(n[e]=dwe(t),n[e].events.addEventListener("refresh",this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const n=this.getObject()[e];if("function"===typeof n)return n(...t)}async callAsync(e,...t){const n=this.getObject()[e];if("function"===typeof n)return"AsyncFunction"===n.constructor.name?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){null!==e?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;const e=new pwe(this),t=fwe.get("THREE"),n=fwe.get("TSL"),r=this.getMethod(),i=[e,this._local,fwe,()=>this.refresh(),(e,t)=>this.setOutput(e,t),t,n];this._object=r(...i);const a=this._object.layout;if(a&&(!1===a.cache&&this._local.clear(),this._output.outputType=a.outputType||null,Array.isArray(a.elements)))for(const o of a.elements){const e=o.id||o.name;o.inputType&&(void 0===this.getParameter(e)&&this.setParameter(e,null),this.getParameter(e).inputType=o.inputType),o.outputType&&(void 0===this.getOutput(e)&&this.setOutput(e,null),this.getOutput(e).outputType=o.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let e=this.parameters[t];e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:Ble()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;const e=["layout","init","main","dispose"].join(", "),t="\nreturn { ...output, "+e+" };",n="var "+e+"; var output = {};\n"+this.codeNode.code+t;return this._method=new Function(...["parameters","local","global","refresh","setOutput","THREE","TSL"],n),this._method}dispose(){null!==this._method&&(this._object&&"function"===typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[cse(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return use(t)}set needsUpdate(e){!0===e&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const gwe=Mle(mwe).setParameterLength(1,2);function vwe(e){let t;const n=e.context.getViewZ;return void 0!==n&&(t=n(this)),(t||ofe.z).negate()}const Awe=Rle(([e,t],n)=>{const r=vwe(n);return Lde(e,t,r)}),ywe=Rle(([e],t)=>{const n=vwe(t);return e.mul(e,n,n).negate().exp().oneMinus()}),bwe=Rle(([e,t])=>Yle(t.toFloat().mix(Ece.rgb,e.toVec3()),Ece.a));let xwe=null,_we=null;class wwe extends Lse{static get type(){return"RangeNode"}constructor(e=Ble(),t=Ble()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),r=e.getTypeLength(yse(t.value)),i=e.getTypeLength(yse(n.value));return r>i?r:i}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(e=>{!0===e.isConstNode&&(t=e)}),null===t)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let n=null;if(t.count>1){const r=this.getConstNode(this.minNode),i=this.getConstNode(this.maxNode),a=r.value,o=i.value,s=e.getTypeLength(yse(a)),l=e.getTypeLength(yse(o));xwe=xwe||new DJ,_we=_we||new DJ,xwe.setScalar(0),_we.setScalar(0),1===s?xwe.setScalar(a):a.isColor?xwe.set(a.r,a.g,a.b,1):xwe.set(a.x,a.y,a.z||0,a.w||0),1===l?_we.setScalar(o):o.isColor?_we.set(o.r,o.g,o.b,1):_we.set(o.x,o.y,o.z||0,o.w||0);const c=4,u=c*t.count,d=new Float32Array(u);for(let e=0;e<u;e++){const t=e%c,n=xwe.getComponent(t),r=_we.getComponent(t);d[e]=fJ.lerp(n,r,Math.random())}const h=this.getNodeType(e);if(t.count<=4096)n=spe(d,"vec4",t.count).element(vge).convert(h);else{const t=new f2(d,4);e.geometry.setAttribute("__range"+this.id,t),n=The(t).convert(h)}}else n=Ble(0);return n}}const Swe=Mle(wwe).setParameterLength(2);class Twe extends Lse{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),r=this.getNodeType(e);return"compute"===e.shaderStage?e.format(n,r,t):(eJ(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(r))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const Cwe=(e,t)=>new Twe(e,t),Mwe=Cwe("numWorkgroups","uvec3"),Ewe=Cwe("workgroupId","uvec3"),Pwe=Cwe("globalId","uvec3"),Nwe=Cwe("localId","uvec3"),kwe=Cwe("subgroupSize","uint");const Rwe=Mle(class extends Lse{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;!0===n.backend.isWebGLBackend?e.addFlowCode(`\t// ${t}Barrier \n`):e.addLineFlowCode(`${t}Barrier()`,this)}});class Lwe extends Ose{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const r=e.context.assign;if(n=super.generate(e),!0!==r){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}class Owe extends Lse{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return eJ('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new Lwe(this,e)}generate(e){const t=""!==this.name?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}class jwe extends Lse{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,i=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,s=this.valueNode,l=[];l.push(`&${o.build(e,a)}`),null!==s&&l.push(s.build(e,a));const c=`${e.getMethod(r,i)}( ${l.join(", ")} )`;if(!(!!n&&(1===n.length&&!0===n[0].isStackNode)))return void 0===t.constNode&&(t.constNode=Fhe(c,i).toConst()),t.constNode.build(e);e.addLineFlowCode(c,this)}}jwe.ATOMIC_LOAD="atomicLoad",jwe.ATOMIC_STORE="atomicStore",jwe.ATOMIC_ADD="atomicAdd",jwe.ATOMIC_SUB="atomicSub",jwe.ATOMIC_MAX="atomicMax",jwe.ATOMIC_MIN="atomicMin",jwe.ATOMIC_AND="atomicAnd",jwe.ATOMIC_OR="atomicOr",jwe.ATOMIC_XOR="atomicXor";const Dwe=Mle(jwe),Iwe=(e,t,n)=>Dwe(e,t,n).toStack();class Bwe extends Dse{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null;return(e.isMatrix(t)?0:e.getTypeLength(t))>(e.isMatrix(n)?0:e.getTypeLength(n))?t:n}getNodeType(e){const t=this.method;return t===Bwe.SUBGROUP_ELECT?"bool":t===Bwe.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,r=this.getNodeType(e),i=this.getInputType(e),a=this.aNode,o=this.bNode,s=[];if(n===Bwe.SUBGROUP_BROADCAST||n===Bwe.SUBGROUP_SHUFFLE||n===Bwe.QUAD_BROADCAST){const t=o.getNodeType(e);s.push(a.build(e,r),o.build(e,"float"===t?"int":r))}else n===Bwe.SUBGROUP_SHUFFLE_XOR||n===Bwe.SUBGROUP_SHUFFLE_DOWN||n===Bwe.SUBGROUP_SHUFFLE_UP?s.push(a.build(e,r),o.build(e,"uint")):(null!==a&&s.push(a.build(e,i)),null!==o&&s.push(o.build(e,i)));const l=0===s.length?"()":`( ${s.join(", ")} )`;return e.format(`${e.getMethod(n,r)}${l}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Bwe.SUBGROUP_ELECT="subgroupElect",Bwe.SUBGROUP_BALLOT="subgroupBallot",Bwe.SUBGROUP_ADD="subgroupAdd",Bwe.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd",Bwe.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd",Bwe.SUBGROUP_MUL="subgroupMul",Bwe.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul",Bwe.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul",Bwe.SUBGROUP_AND="subgroupAnd",Bwe.SUBGROUP_OR="subgroupOr",Bwe.SUBGROUP_XOR="subgroupXor",Bwe.SUBGROUP_MIN="subgroupMin",Bwe.SUBGROUP_MAX="subgroupMax",Bwe.SUBGROUP_ALL="subgroupAll",Bwe.SUBGROUP_ANY="subgroupAny",Bwe.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst",Bwe.QUAD_SWAP_X="quadSwapX",Bwe.QUAD_SWAP_Y="quadSwapY",Bwe.QUAD_SWAP_DIAGONAL="quadSwapDiagonal",Bwe.SUBGROUP_BROADCAST="subgroupBroadcast",Bwe.SUBGROUP_SHUFFLE="subgroupShuffle",Bwe.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor",Bwe.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp",Bwe.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown",Bwe.QUAD_BROADCAST="quadBroadcast";const Fwe=Ple(Bwe,Bwe.SUBGROUP_ELECT).setParameterLength(0),zwe=Ple(Bwe,Bwe.SUBGROUP_BALLOT).setParameterLength(1),Uwe=Ple(Bwe,Bwe.SUBGROUP_ADD).setParameterLength(1),Vwe=Ple(Bwe,Bwe.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),Gwe=Ple(Bwe,Bwe.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),qwe=Ple(Bwe,Bwe.SUBGROUP_MUL).setParameterLength(1),Wwe=Ple(Bwe,Bwe.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),Hwe=Ple(Bwe,Bwe.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),$we=Ple(Bwe,Bwe.SUBGROUP_AND).setParameterLength(1),Kwe=Ple(Bwe,Bwe.SUBGROUP_OR).setParameterLength(1),Xwe=Ple(Bwe,Bwe.SUBGROUP_XOR).setParameterLength(1),Ywe=Ple(Bwe,Bwe.SUBGROUP_MIN).setParameterLength(1),Qwe=Ple(Bwe,Bwe.SUBGROUP_MAX).setParameterLength(1),Zwe=Ple(Bwe,Bwe.SUBGROUP_ALL).setParameterLength(0),Jwe=Ple(Bwe,Bwe.SUBGROUP_ANY).setParameterLength(0),eSe=Ple(Bwe,Bwe.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),tSe=Ple(Bwe,Bwe.QUAD_SWAP_X).setParameterLength(1),nSe=Ple(Bwe,Bwe.QUAD_SWAP_Y).setParameterLength(1),rSe=Ple(Bwe,Bwe.QUAD_SWAP_DIAGONAL).setParameterLength(1),iSe=Ple(Bwe,Bwe.SUBGROUP_BROADCAST).setParameterLength(2),aSe=Ple(Bwe,Bwe.SUBGROUP_SHUFFLE).setParameterLength(2),oSe=Ple(Bwe,Bwe.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),sSe=Ple(Bwe,Bwe.SUBGROUP_SHUFFLE_UP).setParameterLength(2),lSe=Ple(Bwe,Bwe.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),cSe=Ple(Bwe,Bwe.QUAD_BROADCAST).setParameterLength(1);let uSe;function dSe(e){uSe=uSe||new WeakMap;let t=uSe.get(e);return void 0===t&&uSe.set(e,t={}),t}function hSe(e){const t=dSe(e);return t.shadowMatrix||(t.shadowMatrix=Wce("mat4").setGroup(Vce).onRenderUpdate(t=>(!0===e.castShadow&&!1!==t.renderer.shadowMap.enabled||(e.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(e.shadow.camera.coordinateSystem=t.camera.coordinateSystem,e.shadow.camera.updateProjectionMatrix()),e.shadow.updateMatrices(e)),e.shadow.matrix)))}function pSe(e,t=ife){const n=hSe(e).mul(t);return n.xyz.div(n.w)}function fSe(e){const t=dSe(e);return t.position||(t.position=Wce(new vJ).setGroup(Vce).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.matrixWorld)))}function mSe(e){const t=dSe(e);return t.targetPosition||(t.targetPosition=Wce(new vJ).setGroup(Vce).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.target.matrixWorld)))}function gSe(e){const t=dSe(e);return t.viewPosition||(t.viewPosition=Wce(new vJ).setGroup(Vce).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new vJ,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const vSe=e=>Ppe.transformDirection(fSe(e).sub(mSe(e))),ASe=(e,t)=>{for(const n of t)if(n.isAnalyticLightNode&&n.light.id===e)return n;return null},ySe=new WeakMap,bSe=[];class xSe extends Lse{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=oce("vec3","totalDiffuse"),this.totalSpecularNode=oce("vec3","totalSpecular"),this.outgoingLightNode=oce("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const t=e[n];if(bSe.push(t.id),bSe.push(t.castShadow?1:0),!0===t.isSpotLight){const e=null!==t.map?t.map.id:-1,n=t.colorNode?t.colorNode.getCacheKey():-1;bSe.push(e,n)}}const t=use(bSe);return bSe.length=0,t}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);const t=[];for(const e of this._lightNodes)t.push(e.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=(e=>e.sort((e,t)=>e.id-t.id))(this._lights),i=e.renderer.library;for(const a of r)if(a.isNode)t.push(wle(a));else{let e=null;if(null!==n&&(e=ASe(a.id,n)),null===e){const e=i.getLightNodeClass(a.constructor);if(null===e){eJ(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let n=null;ySe.has(a)?n=ySe.get(a):(n=new e(a),ySe.set(a,n)),t.push(n)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.direct({...n,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return null===this._lightNodes&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,i=r.lightingModel,a=e.getNodeProperties(this);if(i){const{totalDiffuseNode:t,totalSpecularNode:o}=this;r.outgoingLight=n;const s=e.addStack();a.nodes=s.nodes,i.start(e);const{backdrop:l,backdropAlpha:c}=r,{directDiffuse:u,directSpecular:d,indirectDiffuse:h,indirectSpecular:p}=r.reflectedLight;let f=u.add(h);null!==l&&(f=Hle(null!==c?c.mix(f,l):l)),t.assign(f),o.assign(d.add(p)),n.assign(t.add(o)),i.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class _Se extends Lse{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Tse.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){wSe.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||ife)}}const wSe=oce("vec3","shadowPositionWorld");function SSe(e,t={}){return t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.renderTarget=e.getRenderTarget(),t.activeCubeFace=e.getActiveCubeFace(),t.activeMipmapLevel=e.getActiveMipmapLevel(),t.renderObjectFunction=e.getRenderObjectFunction(),t.pixelRatio=e.getPixelRatio(),t.mrt=e.getMRT(),t.clearColor=e.getClearColor(t.clearColor||new o1),t.clearAlpha=e.getClearAlpha(),t.autoClear=e.autoClear,t.scissorTest=e.getScissorTest(),t}function TSe(e,t){return t=SSe(e,t),e.setMRT(null),e.setRenderObjectFunction(null),e.setClearColor(0,1),e.autoClear=!0,t}function CSe(e,t){e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),e.setRenderObjectFunction(t.renderObjectFunction),e.setPixelRatio(t.pixelRatio),e.setMRT(t.mrt),e.setClearColor(t.clearColor,t.clearAlpha),e.autoClear=t.autoClear,e.setScissorTest(t.scissorTest)}function MSe(e,t={}){return t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial,t}function ESe(e,t){return t=MSe(e,t),e.background=null,e.backgroundNode=null,e.overrideMaterial=null,t}function PSe(e,t){e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial}function NSe(e,t,n){return n=ESe(t,n=TSe(e,n))}function kSe(e,t,n){CSe(e,n),PSe(t,n)}const RSe=new WeakMap,LSe=Rle(({depthTexture:e,shadowCoord:t,depthLayer:n})=>{let r=ipe(e,t.xy).setName("t_basic");return e.isArrayTexture&&(r=r.depth(n)),r.compare(t.z)}),OSe=Rle(({depthTexture:e,shadowCoord:t,shadow:n,depthLayer:r})=>{const i=(t,n)=>{let i=ipe(e,t);return e.isArrayTexture&&(i=i.depth(r)),i.compare(n)},a=zfe("mapSize","vec2",n).setGroup(Vce),o=zfe("radius","float",n).setGroup(Vce),s=Vle(1).div(a),l=o.mul(s.x),c=d_e(Ape.xy).mul(6.28318530718);return eue(i(t.xy.add(h_e(0,5,c).mul(l)),t.z),i(t.xy.add(h_e(1,5,c).mul(l)),t.z),i(t.xy.add(h_e(2,5,c).mul(l)),t.z),i(t.xy.add(h_e(3,5,c).mul(l)),t.z),i(t.xy.add(h_e(4,5,c).mul(l)),t.z)).mul(.2)}),jSe=Rle(({depthTexture:e,shadowCoord:t,shadow:n,depthLayer:r})=>{const i=(t,n)=>{let i=ipe(e,t);return e.isArrayTexture&&(i=i.depth(r)),i.compare(n)},a=zfe("mapSize","vec2",n).setGroup(Vce),o=Vle(1).div(a),s=o.x,l=o.y,c=t.xy,u=Hue(c.mul(a).add(.5));return c.subAssign(u.mul(o)),eue(i(c,t.z),i(c.add(Vle(s,0)),t.z),i(c.add(Vle(0,l)),t.z),i(c.add(o),t.z),Pde(i(c.add(Vle(s.negate(),0)),t.z),i(c.add(Vle(s.mul(2),0)),t.z),u.x),Pde(i(c.add(Vle(s.negate(),l)),t.z),i(c.add(Vle(s.mul(2),l)),t.z),u.x),Pde(i(c.add(Vle(0,l.negate())),t.z),i(c.add(Vle(0,l.mul(2))),t.z),u.y),Pde(i(c.add(Vle(s,l.negate())),t.z),i(c.add(Vle(s,l.mul(2))),t.z),u.y),Pde(Pde(i(c.add(Vle(s.negate(),l.negate())),t.z),i(c.add(Vle(s.mul(2),l.negate())),t.z),u.x),Pde(i(c.add(Vle(s.negate(),l.mul(2))),t.z),i(c.add(Vle(s.mul(2),l.mul(2))),t.z),u.x),u.y)).mul(1/9)}),DSe=Rle(({depthTexture:e,shadowCoord:t,depthLayer:n})=>{let r=ipe(e).sample(t.xy);e.isArrayTexture&&(r=r.depth(n)),r=r.rg;const i=r.x,a=mde(1e-7,r.y.mul(r.y)),o=gde(t.z,i);jle(o.equal(1),()=>Ble(1));const s=t.z.sub(i);let l=a.div(a.add(s.mul(s)));return l=Nde(tue(l,.3).div(.65)),mde(o,l)}),ISe=Rle(([e,t,n])=>{let r=ife.sub(e).length();return r=r.sub(t).div(n.sub(t)),r=r.saturate(),r}),BSe=e=>{let t=RSe.get(e);if(void 0===t){const n=e.isPointLight?(e=>{const t=e.shadow.camera,n=zfe("near","float",t).setGroup(Vce),r=zfe("far","float",t).setGroup(Vce),i=Bpe(e);return ISe(i,n,r)})(e):null;t=new yve,t.colorNode=Yle(0,0,0,1),t.depthNode=n,t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.fog=!1,RSe.set(e,t)}return t},FSe=e=>{const t=RSe.get(e);void 0!==t&&(t.dispose(),RSe.delete(e))},zSe=new ube,USe=[],VSe=(e,t,n,r)=>{USe[0]=e,USe[1]=t;let i=zSe.get(USe);return void 0!==i&&i.shadowType===n&&i.useVelocity===r||(i=(i,a,o,s,l,c,...u)=>{(!0===i.castShadow||i.receiveShadow&&3===n)&&(r&&(xse(i).useVelocity=!0),i.onBeforeShadow(e,i,o,t.camera,s,a.overrideMaterial,c),e.renderObject(i,a,o,s,l,c,...u),i.onAfterShadow(e,i,o,t.camera,s,a.overrideMaterial,c))},i.shadowType=n,i.useVelocity=r,zSe.set(USe,i)),USe[0]=null,USe[1]=null,i},GSe=Rle(({samples:e,radius:t,size:n,shadowPass:r,depthLayer:i})=>{const a=Ble(0).toVar("meanVertical"),o=Ble(0).toVar("squareMeanVertical"),s=e.lessThanEqual(Ble(1)).select(Ble(0),Ble(2).div(e.sub(1))),l=e.lessThanEqual(Ble(1)).select(Ble(0),Ble(-1));Rge({start:Fle(0),end:Fle(e),type:"int",condition:"<"},({i:e})=>{const c=l.add(Ble(e).mul(s));let u=r.sample(eue(Ape.xy,Vle(0,c).mul(t)).div(n));r.value.isArrayTexture&&(u=u.depth(i)),u=u.x,a.addAssign(u),o.addAssign(u.mul(u))}),a.divAssign(e),o.divAssign(e);const c=Uue(o.sub(a.mul(a)).max(0));return Vle(a,c)}),qSe=Rle(({samples:e,radius:t,size:n,shadowPass:r,depthLayer:i})=>{const a=Ble(0).toVar("meanHorizontal"),o=Ble(0).toVar("squareMeanHorizontal"),s=e.lessThanEqual(Ble(1)).select(Ble(0),Ble(2).div(e.sub(1))),l=e.lessThanEqual(Ble(1)).select(Ble(0),Ble(-1));Rge({start:Fle(0),end:Fle(e),type:"int",condition:"<"},({i:e})=>{const c=l.add(Ble(e).mul(s));let u=r.sample(eue(Ape.xy,Vle(c,0).mul(t)).div(n));r.value.isArrayTexture&&(u=u.depth(i)),a.addAssign(u.x),o.addAssign(eue(u.y.mul(u.y),u.x.mul(u.x)))}),a.divAssign(e),o.divAssign(e);const c=Uue(o.sub(a.mul(a)).max(0));return Vle(a,c)}),WSe=[LSe,OSe,jSe,DSe];let HSe;const $Se=new i_e;class KSe extends _Se{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i,depthLayer:a}){const o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),s=t({depthTexture:n,shadowCoord:r,shadow:i,depthLayer:a});return o.select(s,Ble(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,i=zfe("bias","float",n).setGroup(Vce);let a,o=t;if(n.camera.isOrthographicCamera||!0!==r.logarithmicDepthBuffer)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===qZ&&(a=a.mul(2).sub(1));else{const e=o.w;o=o.xy.div(e);const t=zfe("near","float",n.camera).setGroup(Vce),r=zfe("far","float",n.camera).setGroup(Vce);a=tve(e.negate(),t,r)}return o=Hle(o.x,o.y.oneMinus(),a.add(i)),o}getShadowFilterFn(e){return WSe[e]}setupRenderTarget(e,t){const n=new $2(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=LZ;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t,camera:n}=e,{light:r,shadow:i}=this,a=t.shadowMap.type,{depthTexture:o,shadowMap:s}=this.setupRenderTarget(i,e);if(i.camera.coordinateSystem=n.coordinateSystem,i.camera.updateProjectionMatrix(),3===a&&!0!==i.isPointLightShadow){o.compareFunction=null,s.depth>1?(s._vsmShadowMapVertical||(s._vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:RQ,type:yQ,depth:s.depth,depthBuffer:!1}),s._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=s._vsmShadowMapVertical,s._vsmShadowMapHorizontal||(s._vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:RQ,type:yQ,depth:s.depth,depthBuffer:!1}),s._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=s._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:RQ,type:yQ,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:RQ,type:yQ,depthBuffer:!1}));let t=ipe(o);o.isArrayTexture&&(t=t.depth(this.depthLayer));let n=ipe(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(n=n.depth(this.depthLayer));const r=zfe("blurSamples","float",i).setGroup(Vce),a=zfe("radius","float",i).setGroup(Vce),l=zfe("mapSize","vec2",i).setGroup(Vce);let c=this.vsmMaterialVertical||(this.vsmMaterialVertical=new yve);c.fragmentNode=GSe({samples:r,radius:a,size:l,shadowPass:t,depthLayer:this.depthLayer}).context(e.getSharedContext()),c.name="VSMVertical",c=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new yve),c.fragmentNode=qSe({samples:r,radius:a,size:l,shadowPass:n,depthLayer:this.depthLayer}).context(e.getSharedContext()),c.name="VSMHorizontal"}const l=zfe("intensity","float",i).setGroup(Vce),c=zfe("normalBias","float",i).setGroup(Vce),u=hSe(r).mul(wSe.add(Afe.mul(c))),d=this.setupShadowCoord(e,u),h=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(null===h)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const p=3===a&&!0!==i.isPointLightShadow?this.vsmShadowMapHorizontal.texture:o,f=this.setupShadowFilter(e,{filterFn:h,shadowTexture:s.texture,depthTexture:p,shadowCoord:d,shadow:i,depthLayer:this.depthLayer});let m;s.texture.isCubeTexture?m=Ife(s.texture,d.xyz):(m=ipe(s.texture,d),o.isArrayTexture&&(m=m.depth(this.depthLayer)));const g=Pde(1,f.rgb.mix(m,1),l.mul(m.a)).toVar();this.shadowMap=s,this.shadow.map=s;const v=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return g.toInspector(`${v} / Color`,()=>this.shadowMap.texture.isCubeTexture?Ife(this.shadowMap.texture):ipe(this.shadowMap.texture)).toInspector(`${v} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Ife(this.shadowMap.texture).r.oneMinus():ape(this.shadowMap.depthTexture,Yhe().mul(Zhe(ipe(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(!1!==e.renderer.shadowMap.enabled)return Rle(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),null===n&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&eJ('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:a}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);const o=a.name;a.name=`Shadow Map [ ${r.name||"ID: "+r.id} ]`,i.render(a,t.camera),a.name=o}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:i,scene:a,camera:o}=e,s=i.shadowMap.type,l=t.depthTexture.version;this._depthVersionCached=l;const c=r.camera.layers.mask;0===(4294967294&r.camera.layers.mask)&&(r.camera.layers.mask=o.layers.mask);const u=i.getRenderObjectFunction(),d=i.getMRT(),h=!!d&&d.has("velocity");HSe=NSe(i,a,HSe),a.overrideMaterial=BSe(n),i.setRenderObjectFunction(VSe(i,r,s,h)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(u),3===s&&!0!==r.isPointLightShadow&&this.vsmPass(i),r.camera.layers.mask=c,kSe(i,a,HSe)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),$Se.material=this.vsmMaterialVertical,$Se.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),$Se.material=this.vsmMaterialHorizontal,$Se.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,FSe(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const XSe=(e,t)=>new KSe(e,t),YSe=new o1,QSe=new f0,ZSe=new vJ,JSe=new vJ,eTe=[new vJ(1,0,0),new vJ(-1,0,0),new vJ(0,-1,0),new vJ(0,1,0),new vJ(0,0,1),new vJ(0,0,-1)],tTe=[new vJ(0,-1,0),new vJ(0,-1,0),new vJ(0,0,-1),new vJ(0,0,1),new vJ(0,-1,0),new vJ(0,-1,0)],nTe=[new vJ(1,0,0),new vJ(-1,0,0),new vJ(0,1,0),new vJ(0,-1,0),new vJ(0,0,1),new vJ(0,0,-1)],rTe=[new vJ(0,-1,0),new vJ(0,-1,0),new vJ(0,0,1),new vJ(0,0,-1),new vJ(0,-1,0),new vJ(0,-1,0)],iTe=Rle(({depthTexture:e,bd3D:t,dp:n})=>Ife(e,t).compare(n)),aTe=Rle(({depthTexture:e,bd3D:t,dp:n,shadow:r})=>{const i=zfe("radius","float",r).setGroup(Vce),a=zfe("mapSize","vec2",r).setGroup(Vce),o=i.div(a.x),s=Jue(t),l=Wue(xde(t,s.x.greaterThan(s.z).select(Hle(0,1,0),Hle(1,0,0)))),c=xde(t,l),u=d_e(Ape.xy).mul(6.28318530718),d=h_e(0,5,u),h=h_e(1,5,u),p=h_e(2,5,u),f=h_e(3,5,u),m=h_e(4,5,u);return Ife(e,t.add(l.mul(d.x).add(c.mul(d.y)).mul(o))).compare(n).add(Ife(e,t.add(l.mul(h.x).add(c.mul(h.y)).mul(o))).compare(n)).add(Ife(e,t.add(l.mul(p.x).add(c.mul(p.y)).mul(o))).compare(n)).add(Ife(e,t.add(l.mul(f.x).add(c.mul(f.y)).mul(o))).compare(n)).add(Ife(e,t.add(l.mul(m.x).add(c.mul(m.y)).mul(o))).compare(n)).mul(.2)}),oTe=Rle(({filterFn:e,depthTexture:t,shadowCoord:n,shadow:r})=>{const i=n.xyz.toVar(),a=i.length(),o=Wce("float").setGroup(Vce).onRenderUpdate(()=>r.camera.near),s=Wce("float").setGroup(Vce).onRenderUpdate(()=>r.camera.far),l=zfe("bias","float",r).setGroup(Vce),c=Ble(1).toVar();return jle(a.sub(s).lessThanEqual(0).and(a.sub(o).greaterThanEqual(0)),()=>{const n=a.sub(o).div(s.sub(o)).toVar();n.addAssign(l);const u=i.normalize();c.assign(e({depthTexture:t,bd3D:u,dp:n,shadow:r}))}),c});class sTe extends KSe{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return 0===e?iTe:aTe}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i}){return oTe({filterFn:t,depthTexture:n,shadowCoord:r,shadow:i})}setupRenderTarget(e,t){const n=new K2(e.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=LZ;const r=t.createCubeRenderTarget(e.mapSize.width);return r.texture.name="PointShadowMap",r.depthTexture=n,{shadowMap:r,depthTexture:n}}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:a}=e,o=t.camera,s=t.matrix,l=i.coordinateSystem===qZ,c=l?eTe:nTe,u=l?tTe:rTe;n.setSize(t.mapSize.width,t.mapSize.width);const d=i.autoClear,h=i.getClearColor(YSe),p=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha);for(let f=0;f<6;f++){i.setRenderTarget(n,f),i.clear();const e=r.distance||o.far;e!==o.far&&(o.far=e,o.updateProjectionMatrix()),ZSe.setFromMatrixPosition(r.matrixWorld),o.position.copy(ZSe),JSe.copy(o.position),JSe.add(c[f]),o.up.copy(u[f]),o.lookAt(JSe),o.updateMatrixWorld(),s.makeTranslation(-ZSe.x,-ZSe.y,-ZSe.z),QSe.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),t._frustum.setFromProjectionMatrix(QSe,o.coordinateSystem,o.reversedDepth);const l=a.name;a.name=`Point Light Shadow [ ${r.name||"ID: "+r.id} ] - Face ${f+1}`,i.render(a,o),a.name=l}i.autoClear=d,i.setClearColor(h,p)}}const lTe=(e,t)=>new sTe(e,t);class cTe extends Fge{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new o1,this.colorNode=e&&e.colorNode||Wce(this.color).setGroup(Vce),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Tse.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,null!==this.baseColorNode&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return gSe(this.light).sub(e.context.positionView||ofe)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return XSe(this.light)}setupShadow(e){const{renderer:t}=e;if(!1===t.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){const e=this.light.shadow.shadowNode;let t;t=void 0!==e?wle(e):this.setupShadowNode(),this.shadowNode=t,this.shadowColorNode=n=this.colorNode.mul(t),this.baseColorNode=this.colorNode}e.context.getShadow&&(n=e.context.getShadow(this,e)),this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const uTe=Rle(({lightDistance:e,cutoffDistance:t,decayExponent:n})=>{const r=e.pow(n).max(.01).reciprocal();return t.greaterThan(0).select(r.mul(e.div(t).pow4().oneMinus().clamp().pow2()),r)}),dTe=({color:e,lightVector:t,cutoffDistance:n,decayExponent:r})=>{const i=t.normalize(),a=t.length(),o=uTe({lightDistance:a,cutoffDistance:n,decayExponent:r});return{lightDirection:i,lightColor:e.mul(o)}};class hTe extends cTe{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Wce(0).setGroup(Vce),this.decayExponentNode=Wce(2).setGroup(Vce)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return lTe(this.light)}setupDirect(e){return dTe({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const pTe=Rle(([e=Yhe()])=>{const t=e.mul(2),n=t.x.floor(),r=t.y.floor();return n.add(r).mod(2).sign()}),fTe=Rle(([e=Yhe()],{renderer:t,material:n})=>{const r=Ede(e.mul(2).sub(1));let i;if(n.alphaToCoverage&&t.currentSamples>0){const e=Ble(r.fwidth()).toVar();i=Lde(e.oneMinus(),e.add(1),r).oneMinus()}else i=Gde(r.greaterThan(1),0,1);return i}),mTe=Rle(([e,t,n])=>{const r=Ble(n).toVar(),i=Ble(t).toVar(),a=Ule(e).toVar();return Gde(a,i,r)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),gTe=Rle(([e,t])=>{const n=Ule(t).toVar(),r=Ble(e).toVar();return Gde(n,r.negate(),r)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),vTe=Rle(([e])=>{const t=Ble(e).toVar();return Fle(Gue(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),ATe=Rle(([e,t])=>{const n=Ble(e).toVar();return t.assign(vTe(n)),n.sub(Ble(t))}),yTe=Rle(([e,t,n,r,i,a])=>{const o=Ble(a).toVar(),s=Ble(i).toVar(),l=Ble(r).toVar(),c=Ble(n).toVar(),u=Ble(t).toVar(),d=Ble(e).toVar(),h=Ble(tue(1,s)).toVar();return tue(1,o).mul(d.mul(h).add(u.mul(s))).add(o.mul(c.mul(h).add(l.mul(s))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),bTe=Rle(([e,t,n,r,i,a])=>{const o=Ble(a).toVar(),s=Ble(i).toVar(),l=Hle(r).toVar(),c=Hle(n).toVar(),u=Hle(t).toVar(),d=Hle(e).toVar(),h=Ble(tue(1,s)).toVar();return tue(1,o).mul(d.mul(h).add(u.mul(s))).add(o.mul(c.mul(h).add(l.mul(s))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),xTe=Exe([yTe,bTe]),_Te=Rle(([e,t,n,r,i,a,o,s,l,c,u])=>{const d=Ble(u).toVar(),h=Ble(c).toVar(),p=Ble(l).toVar(),f=Ble(s).toVar(),m=Ble(o).toVar(),g=Ble(a).toVar(),v=Ble(i).toVar(),A=Ble(r).toVar(),y=Ble(n).toVar(),b=Ble(t).toVar(),x=Ble(e).toVar(),_=Ble(tue(1,p)).toVar(),w=Ble(tue(1,h)).toVar();return Ble(tue(1,d)).toVar().mul(w.mul(x.mul(_).add(b.mul(p))).add(h.mul(y.mul(_).add(A.mul(p))))).add(d.mul(w.mul(v.mul(_).add(g.mul(p))).add(h.mul(m.mul(_).add(f.mul(p))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),wTe=Rle(([e,t,n,r,i,a,o,s,l,c,u])=>{const d=Ble(u).toVar(),h=Ble(c).toVar(),p=Ble(l).toVar(),f=Hle(s).toVar(),m=Hle(o).toVar(),g=Hle(a).toVar(),v=Hle(i).toVar(),A=Hle(r).toVar(),y=Hle(n).toVar(),b=Hle(t).toVar(),x=Hle(e).toVar(),_=Ble(tue(1,p)).toVar(),w=Ble(tue(1,h)).toVar();return Ble(tue(1,d)).toVar().mul(w.mul(x.mul(_).add(b.mul(p))).add(h.mul(y.mul(_).add(A.mul(p))))).add(d.mul(w.mul(v.mul(_).add(g.mul(p))).add(h.mul(m.mul(_).add(f.mul(p))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),STe=Exe([_Te,wTe]),TTe=Rle(([e,t,n])=>{const r=Ble(n).toVar(),i=Ble(t).toVar(),a=zle(e).toVar(),o=zle(a.bitAnd(zle(7))).toVar(),s=Ble(mTe(o.lessThan(zle(4)),i,r)).toVar(),l=Ble(nue(2,mTe(o.lessThan(zle(4)),r,i))).toVar();return gTe(s,Ule(o.bitAnd(zle(1)))).add(gTe(l,Ule(o.bitAnd(zle(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),CTe=Rle(([e,t,n,r])=>{const i=Ble(r).toVar(),a=Ble(n).toVar(),o=Ble(t).toVar(),s=zle(e).toVar(),l=zle(s.bitAnd(zle(15))).toVar(),c=Ble(mTe(l.lessThan(zle(8)),o,a)).toVar(),u=Ble(mTe(l.lessThan(zle(4)),a,mTe(l.equal(zle(12)).or(l.equal(zle(14))),o,i))).toVar();return gTe(c,Ule(l.bitAnd(zle(1)))).add(gTe(u,Ule(l.bitAnd(zle(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),MTe=Exe([TTe,CTe]),ETe=Rle(([e,t,n])=>{const r=Ble(n).toVar(),i=Ble(t).toVar(),a=Kle(e).toVar();return Hle(MTe(a.x,i,r),MTe(a.y,i,r),MTe(a.z,i,r))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),PTe=Rle(([e,t,n,r])=>{const i=Ble(r).toVar(),a=Ble(n).toVar(),o=Ble(t).toVar(),s=Kle(e).toVar();return Hle(MTe(s.x,o,a,i),MTe(s.y,o,a,i),MTe(s.z,o,a,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),NTe=Exe([ETe,PTe]),kTe=Rle(([e])=>{const t=Ble(e).toVar();return nue(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),RTe=Rle(([e])=>{const t=Ble(e).toVar();return nue(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),LTe=Rle(([e])=>{const t=Hle(e).toVar();return nue(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),OTe=Exe([kTe,LTe]),jTe=Rle(([e])=>{const t=Hle(e).toVar();return nue(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),DTe=Exe([RTe,jTe]),ITe=Rle(([e,t])=>{const n=Fle(t).toVar(),r=zle(e).toVar();return r.shiftLeft(n).bitOr(r.shiftRight(Fle(32).sub(n)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),BTe=Rle(([e,t,n])=>{e.subAssign(n),e.bitXorAssign(ITe(n,Fle(4))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ITe(e,Fle(6))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(ITe(t,Fle(8))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ITe(n,Fle(16))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ITe(e,Fle(19))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(ITe(t,Fle(4))),t.addAssign(e)}),FTe=Rle(([e,t,n])=>{const r=zle(n).toVar(),i=zle(t).toVar(),a=zle(e).toVar();return r.bitXorAssign(i),r.subAssign(ITe(i,Fle(14))),a.bitXorAssign(r),a.subAssign(ITe(r,Fle(11))),i.bitXorAssign(a),i.subAssign(ITe(a,Fle(25))),r.bitXorAssign(i),r.subAssign(ITe(i,Fle(16))),a.bitXorAssign(r),a.subAssign(ITe(r,Fle(4))),i.bitXorAssign(a),i.subAssign(ITe(a,Fle(14))),r.bitXorAssign(i),r.subAssign(ITe(i,Fle(24))),r}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),zTe=Rle(([e])=>{const t=zle(e).toVar();return Ble(t).div(Ble(zle(Fle(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),UTe=Rle(([e])=>{const t=Ble(e).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),VTe=Rle(([e])=>{const t=Fle(e).toVar(),n=zle(zle(1)).toVar(),r=zle(zle(Fle(3735928559)).add(n.shiftLeft(zle(2))).add(zle(13))).toVar();return FTe(r.add(zle(t)),r,r)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),GTe=Rle(([e,t])=>{const n=Fle(t).toVar(),r=Fle(e).toVar(),i=zle(zle(2)).toVar(),a=zle().toVar(),o=zle().toVar(),s=zle().toVar();return a.assign(o.assign(s.assign(zle(Fle(3735928559)).add(i.shiftLeft(zle(2))).add(zle(13))))),a.addAssign(zle(r)),o.addAssign(zle(n)),FTe(a,o,s)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),qTe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Fle(t).toVar(),a=Fle(e).toVar(),o=zle(zle(3)).toVar(),s=zle().toVar(),l=zle().toVar(),c=zle().toVar();return s.assign(l.assign(c.assign(zle(Fle(3735928559)).add(o.shiftLeft(zle(2))).add(zle(13))))),s.addAssign(zle(a)),l.addAssign(zle(i)),c.addAssign(zle(r)),FTe(s,l,c)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),WTe=Rle(([e,t,n,r])=>{const i=Fle(r).toVar(),a=Fle(n).toVar(),o=Fle(t).toVar(),s=Fle(e).toVar(),l=zle(zle(4)).toVar(),c=zle().toVar(),u=zle().toVar(),d=zle().toVar();return c.assign(u.assign(d.assign(zle(Fle(3735928559)).add(l.shiftLeft(zle(2))).add(zle(13))))),c.addAssign(zle(s)),u.addAssign(zle(o)),d.addAssign(zle(a)),BTe(c,u,d),c.addAssign(zle(i)),FTe(c,u,d)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),HTe=Rle(([e,t,n,r,i])=>{const a=Fle(i).toVar(),o=Fle(r).toVar(),s=Fle(n).toVar(),l=Fle(t).toVar(),c=Fle(e).toVar(),u=zle(zle(5)).toVar(),d=zle().toVar(),h=zle().toVar(),p=zle().toVar();return d.assign(h.assign(p.assign(zle(Fle(3735928559)).add(u.shiftLeft(zle(2))).add(zle(13))))),d.addAssign(zle(c)),h.addAssign(zle(l)),p.addAssign(zle(s)),BTe(d,h,p),d.addAssign(zle(o)),h.addAssign(zle(a)),FTe(d,h,p)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),$Te=Exe([VTe,GTe,qTe,WTe,HTe]),KTe=Rle(([e,t])=>{const n=Fle(t).toVar(),r=Fle(e).toVar(),i=zle($Te(r,n)).toVar(),a=Kle().toVar();return a.x.assign(i.bitAnd(Fle(255))),a.y.assign(i.shiftRight(Fle(8)).bitAnd(Fle(255))),a.z.assign(i.shiftRight(Fle(16)).bitAnd(Fle(255))),a}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),XTe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Fle(t).toVar(),a=Fle(e).toVar(),o=zle($Te(a,i,r)).toVar(),s=Kle().toVar();return s.x.assign(o.bitAnd(Fle(255))),s.y.assign(o.shiftRight(Fle(8)).bitAnd(Fle(255))),s.z.assign(o.shiftRight(Fle(16)).bitAnd(Fle(255))),s}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),YTe=Exe([KTe,XTe]),QTe=Rle(([e])=>{const t=Vle(e).toVar(),n=Fle().toVar(),r=Fle().toVar(),i=Ble(ATe(t.x,n)).toVar(),a=Ble(ATe(t.y,r)).toVar(),o=Ble(UTe(i)).toVar(),s=Ble(UTe(a)).toVar(),l=Ble(xTe(MTe($Te(n,r),i,a),MTe($Te(n.add(Fle(1)),r),i.sub(1),a),MTe($Te(n,r.add(Fle(1))),i,a.sub(1)),MTe($Te(n.add(Fle(1)),r.add(Fle(1))),i.sub(1),a.sub(1)),o,s)).toVar();return OTe(l)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),ZTe=Rle(([e])=>{const t=Hle(e).toVar(),n=Fle().toVar(),r=Fle().toVar(),i=Fle().toVar(),a=Ble(ATe(t.x,n)).toVar(),o=Ble(ATe(t.y,r)).toVar(),s=Ble(ATe(t.z,i)).toVar(),l=Ble(UTe(a)).toVar(),c=Ble(UTe(o)).toVar(),u=Ble(UTe(s)).toVar(),d=Ble(STe(MTe($Te(n,r,i),a,o,s),MTe($Te(n.add(Fle(1)),r,i),a.sub(1),o,s),MTe($Te(n,r.add(Fle(1)),i),a,o.sub(1),s),MTe($Te(n.add(Fle(1)),r.add(Fle(1)),i),a.sub(1),o.sub(1),s),MTe($Te(n,r,i.add(Fle(1))),a,o,s.sub(1)),MTe($Te(n.add(Fle(1)),r,i.add(Fle(1))),a.sub(1),o,s.sub(1)),MTe($Te(n,r.add(Fle(1)),i.add(Fle(1))),a,o.sub(1),s.sub(1)),MTe($Te(n.add(Fle(1)),r.add(Fle(1)),i.add(Fle(1))),a.sub(1),o.sub(1),s.sub(1)),l,c,u)).toVar();return DTe(d)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),JTe=Exe([QTe,ZTe]),eCe=Rle(([e])=>{const t=Vle(e).toVar(),n=Fle().toVar(),r=Fle().toVar(),i=Ble(ATe(t.x,n)).toVar(),a=Ble(ATe(t.y,r)).toVar(),o=Ble(UTe(i)).toVar(),s=Ble(UTe(a)).toVar(),l=Hle(xTe(NTe(YTe(n,r),i,a),NTe(YTe(n.add(Fle(1)),r),i.sub(1),a),NTe(YTe(n,r.add(Fle(1))),i,a.sub(1)),NTe(YTe(n.add(Fle(1)),r.add(Fle(1))),i.sub(1),a.sub(1)),o,s)).toVar();return OTe(l)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),tCe=Rle(([e])=>{const t=Hle(e).toVar(),n=Fle().toVar(),r=Fle().toVar(),i=Fle().toVar(),a=Ble(ATe(t.x,n)).toVar(),o=Ble(ATe(t.y,r)).toVar(),s=Ble(ATe(t.z,i)).toVar(),l=Ble(UTe(a)).toVar(),c=Ble(UTe(o)).toVar(),u=Ble(UTe(s)).toVar(),d=Hle(STe(NTe(YTe(n,r,i),a,o,s),NTe(YTe(n.add(Fle(1)),r,i),a.sub(1),o,s),NTe(YTe(n,r.add(Fle(1)),i),a,o.sub(1),s),NTe(YTe(n.add(Fle(1)),r.add(Fle(1)),i),a.sub(1),o.sub(1),s),NTe(YTe(n,r,i.add(Fle(1))),a,o,s.sub(1)),NTe(YTe(n.add(Fle(1)),r,i.add(Fle(1))),a.sub(1),o,s.sub(1)),NTe(YTe(n,r.add(Fle(1)),i.add(Fle(1))),a,o.sub(1),s.sub(1)),NTe(YTe(n.add(Fle(1)),r.add(Fle(1)),i.add(Fle(1))),a.sub(1),o.sub(1),s.sub(1)),l,c,u)).toVar();return DTe(d)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),nCe=Exe([eCe,tCe]),rCe=Rle(([e])=>{const t=Ble(e).toVar(),n=Fle(vTe(t)).toVar();return zTe($Te(n))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),iCe=Rle(([e])=>{const t=Vle(e).toVar(),n=Fle(vTe(t.x)).toVar(),r=Fle(vTe(t.y)).toVar();return zTe($Te(n,r))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),aCe=Rle(([e])=>{const t=Hle(e).toVar(),n=Fle(vTe(t.x)).toVar(),r=Fle(vTe(t.y)).toVar(),i=Fle(vTe(t.z)).toVar();return zTe($Te(n,r,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),oCe=Rle(([e])=>{const t=Yle(e).toVar(),n=Fle(vTe(t.x)).toVar(),r=Fle(vTe(t.y)).toVar(),i=Fle(vTe(t.z)).toVar(),a=Fle(vTe(t.w)).toVar();return zTe($Te(n,r,i,a))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),sCe=Exe([rCe,iCe,aCe,oCe]),lCe=Rle(([e])=>{const t=Ble(e).toVar(),n=Fle(vTe(t)).toVar();return Hle(zTe($Te(n,Fle(0))),zTe($Te(n,Fle(1))),zTe($Te(n,Fle(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),cCe=Rle(([e])=>{const t=Vle(e).toVar(),n=Fle(vTe(t.x)).toVar(),r=Fle(vTe(t.y)).toVar();return Hle(zTe($Te(n,r,Fle(0))),zTe($Te(n,r,Fle(1))),zTe($Te(n,r,Fle(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),uCe=Rle(([e])=>{const t=Hle(e).toVar(),n=Fle(vTe(t.x)).toVar(),r=Fle(vTe(t.y)).toVar(),i=Fle(vTe(t.z)).toVar();return Hle(zTe($Te(n,r,i,Fle(0))),zTe($Te(n,r,i,Fle(1))),zTe($Te(n,r,i,Fle(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),dCe=Rle(([e])=>{const t=Yle(e).toVar(),n=Fle(vTe(t.x)).toVar(),r=Fle(vTe(t.y)).toVar(),i=Fle(vTe(t.z)).toVar(),a=Fle(vTe(t.w)).toVar();return Hle(zTe($Te(n,r,i,a,Fle(0))),zTe($Te(n,r,i,a,Fle(1))),zTe($Te(n,r,i,a,Fle(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),hCe=Exe([lCe,cCe,uCe,dCe]),pCe=Rle(([e,t,n,r])=>{const i=Ble(r).toVar(),a=Ble(n).toVar(),o=Fle(t).toVar(),s=Hle(e).toVar(),l=Ble(0).toVar(),c=Ble(1).toVar();return Rge(o,()=>{l.addAssign(c.mul(JTe(s))),c.mulAssign(i),s.mulAssign(a)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),fCe=Rle(([e,t,n,r])=>{const i=Ble(r).toVar(),a=Ble(n).toVar(),o=Fle(t).toVar(),s=Hle(e).toVar(),l=Hle(0).toVar(),c=Ble(1).toVar();return Rge(o,()=>{l.addAssign(c.mul(nCe(s))),c.mulAssign(i),s.mulAssign(a)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),mCe=Rle(([e,t,n,r])=>{const i=Ble(r).toVar(),a=Ble(n).toVar(),o=Fle(t).toVar(),s=Hle(e).toVar();return Vle(pCe(s,o,a,i),pCe(s.add(Hle(Fle(19),Fle(193),Fle(17))),o,a,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),gCe=Rle(([e,t,n,r])=>{const i=Ble(r).toVar(),a=Ble(n).toVar(),o=Fle(t).toVar(),s=Hle(e).toVar(),l=Hle(fCe(s,o,a,i)).toVar(),c=Ble(pCe(s.add(Hle(Fle(19),Fle(193),Fle(17))),o,a,i)).toVar();return Yle(l,c)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vCe=Rle(([e,t,n,r,i,a,o])=>{const s=Fle(o).toVar(),l=Ble(a).toVar(),c=Fle(i).toVar(),u=Fle(r).toVar(),d=Fle(n).toVar(),h=Fle(t).toVar(),p=Vle(e).toVar(),f=Hle(hCe(Vle(h.add(u),d.add(c)))).toVar(),m=Vle(f.x,f.y).toVar();m.subAssign(.5),m.mulAssign(l),m.addAssign(.5);const g=Vle(Vle(Ble(h),Ble(d)).add(m)).toVar(),v=Vle(g.sub(p)).toVar();return jle(s.equal(Fle(2)),()=>Jue(v.x).add(Jue(v.y))),jle(s.equal(Fle(3)),()=>mde(Jue(v.x),Jue(v.y))),bde(v,v)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ACe=Rle(([e,t,n,r,i,a,o,s,l])=>{const c=Fle(l).toVar(),u=Ble(s).toVar(),d=Fle(o).toVar(),h=Fle(a).toVar(),p=Fle(i).toVar(),f=Fle(r).toVar(),m=Fle(n).toVar(),g=Fle(t).toVar(),v=Hle(e).toVar(),A=Hle(hCe(Hle(g.add(p),m.add(h),f.add(d)))).toVar();A.subAssign(.5),A.mulAssign(u),A.addAssign(.5);const y=Hle(Hle(Ble(g),Ble(m),Ble(f)).add(A)).toVar(),b=Hle(y.sub(v)).toVar();return jle(c.equal(Fle(2)),()=>Jue(b.x).add(Jue(b.y)).add(Jue(b.z))),jle(c.equal(Fle(3)),()=>mde(Jue(b.x),Jue(b.y),Jue(b.z))),bde(b,b)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),yCe=Exe([vCe,ACe]),bCe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Ble(t).toVar(),a=Vle(e).toVar(),o=Fle().toVar(),s=Fle().toVar(),l=Vle(ATe(a.x,o),ATe(a.y,s)).toVar(),c=Ble(1e6).toVar();return Rge({start:-1,end:Fle(1),name:"x",condition:"<="},({x:e})=>{Rge({start:-1,end:Fle(1),name:"y",condition:"<="},({y:t})=>{const n=Ble(yCe(l,e,t,o,s,i,r)).toVar();c.assign(fde(c,n))})}),jle(r.equal(Fle(0)),()=>{c.assign(Uue(c))}),c}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),xCe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Ble(t).toVar(),a=Vle(e).toVar(),o=Fle().toVar(),s=Fle().toVar(),l=Vle(ATe(a.x,o),ATe(a.y,s)).toVar(),c=Vle(1e6,1e6).toVar();return Rge({start:-1,end:Fle(1),name:"x",condition:"<="},({x:e})=>{Rge({start:-1,end:Fle(1),name:"y",condition:"<="},({y:t})=>{const n=Ble(yCe(l,e,t,o,s,i,r)).toVar();jle(n.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(n)}).ElseIf(n.lessThan(c.y),()=>{c.y.assign(n)})})}),jle(r.equal(Fle(0)),()=>{c.assign(Uue(c))}),c}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),_Ce=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Ble(t).toVar(),a=Vle(e).toVar(),o=Fle().toVar(),s=Fle().toVar(),l=Vle(ATe(a.x,o),ATe(a.y,s)).toVar(),c=Hle(1e6,1e6,1e6).toVar();return Rge({start:-1,end:Fle(1),name:"x",condition:"<="},({x:e})=>{Rge({start:-1,end:Fle(1),name:"y",condition:"<="},({y:t})=>{const n=Ble(yCe(l,e,t,o,s,i,r)).toVar();jle(n.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(n)}).ElseIf(n.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(n)}).ElseIf(n.lessThan(c.z),()=>{c.z.assign(n)})})}),jle(r.equal(Fle(0)),()=>{c.assign(Uue(c))}),c}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),wCe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Ble(t).toVar(),a=Hle(e).toVar(),o=Fle().toVar(),s=Fle().toVar(),l=Fle().toVar(),c=Hle(ATe(a.x,o),ATe(a.y,s),ATe(a.z,l)).toVar(),u=Ble(1e6).toVar();return Rge({start:-1,end:Fle(1),name:"x",condition:"<="},({x:e})=>{Rge({start:-1,end:Fle(1),name:"y",condition:"<="},({y:t})=>{Rge({start:-1,end:Fle(1),name:"z",condition:"<="},({z:n})=>{const a=Ble(yCe(c,e,t,n,o,s,l,i,r)).toVar();u.assign(fde(u,a))})})}),jle(r.equal(Fle(0)),()=>{u.assign(Uue(u))}),u}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),SCe=Exe([bCe,wCe]),TCe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Ble(t).toVar(),a=Hle(e).toVar(),o=Fle().toVar(),s=Fle().toVar(),l=Fle().toVar(),c=Hle(ATe(a.x,o),ATe(a.y,s),ATe(a.z,l)).toVar(),u=Vle(1e6,1e6).toVar();return Rge({start:-1,end:Fle(1),name:"x",condition:"<="},({x:e})=>{Rge({start:-1,end:Fle(1),name:"y",condition:"<="},({y:t})=>{Rge({start:-1,end:Fle(1),name:"z",condition:"<="},({z:n})=>{const a=Ble(yCe(c,e,t,n,o,s,l,i,r)).toVar();jle(a.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(a)}).ElseIf(a.lessThan(u.y),()=>{u.y.assign(a)})})})}),jle(r.equal(Fle(0)),()=>{u.assign(Uue(u))}),u}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),CCe=Exe([xCe,TCe]),MCe=Rle(([e,t,n])=>{const r=Fle(n).toVar(),i=Ble(t).toVar(),a=Hle(e).toVar(),o=Fle().toVar(),s=Fle().toVar(),l=Fle().toVar(),c=Hle(ATe(a.x,o),ATe(a.y,s),ATe(a.z,l)).toVar(),u=Hle(1e6,1e6,1e6).toVar();return Rge({start:-1,end:Fle(1),name:"x",condition:"<="},({x:e})=>{Rge({start:-1,end:Fle(1),name:"y",condition:"<="},({y:t})=>{Rge({start:-1,end:Fle(1),name:"z",condition:"<="},({z:n})=>{const a=Ble(yCe(c,e,t,n,o,s,l,i,r)).toVar();jle(a.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(a)}).ElseIf(a.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(a)}).ElseIf(a.lessThan(u.z),()=>{u.z.assign(a)})})})}),jle(r.equal(Fle(0)),()=>{u.assign(Uue(u))}),u}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ECe=Exe([_Ce,MCe]),PCe=Rle(([e,t,n,r,i,a,o,s,l,c,u])=>{const d=Fle(e).toVar(),h=Vle(t).toVar(),p=Vle(n).toVar(),f=Vle(r).toVar(),m=Ble(i).toVar(),g=Ble(a).toVar(),v=Ble(o).toVar(),A=Ule(s).toVar(),y=Fle(l).toVar(),b=Ble(c).toVar(),x=Ble(u).toVar(),_=h.mul(p).add(f),w=Ble(0).toVar();return jle(d.equal(Fle(0)),()=>{w.assign(nCe(_))}),jle(d.equal(Fle(1)),()=>{w.assign(hCe(_))}),jle(d.equal(Fle(2)),()=>{w.assign(ECe(_,m,Fle(0)))}),jle(d.equal(Fle(3)),()=>{w.assign(fCe(Hle(_,0),y,b,x))}),w.assign(w.mul(v.sub(g)).add(g)),jle(A,()=>{w.assign(Nde(w,g,v))}),w}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),NCe=Rle(([e,t,n,r,i,a,o,s,l,c,u])=>{const d=Fle(e).toVar(),h=Hle(t).toVar(),p=Hle(n).toVar(),f=Hle(r).toVar(),m=Ble(i).toVar(),g=Ble(a).toVar(),v=Ble(o).toVar(),A=Ule(s).toVar(),y=Fle(l).toVar(),b=Ble(c).toVar(),x=Ble(u).toVar(),_=h.mul(p).add(f),w=Ble(0).toVar();return jle(d.equal(Fle(0)),()=>{w.assign(nCe(_))}),jle(d.equal(Fle(1)),()=>{w.assign(hCe(_))}),jle(d.equal(Fle(2)),()=>{w.assign(ECe(_,m,Fle(0)))}),jle(d.equal(Fle(3)),()=>{w.assign(fCe(_,y,b,x))}),w.assign(w.mul(v.sub(g)).add(g)),jle(A,()=>{w.assign(Nde(w,g,v))}),w}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),kCe=Rle(([e])=>{const t=e.y,n=e.z,r=Hle().toVar();return jle(t.lessThan(1e-4),()=>{r.assign(Hle(n,n,n))}).Else(()=>{let i=e.x;i=i.sub(Gue(i)).mul(6).toVar();const a=Fle(lde(i)),o=i.sub(Ble(a)),s=n.mul(t.oneMinus()),l=n.mul(t.mul(o).oneMinus()),c=n.mul(t.mul(o.oneMinus()).oneMinus());jle(a.equal(Fle(0)),()=>{r.assign(Hle(n,c,s))}).ElseIf(a.equal(Fle(1)),()=>{r.assign(Hle(l,n,s))}).ElseIf(a.equal(Fle(2)),()=>{r.assign(Hle(s,n,c))}).ElseIf(a.equal(Fle(3)),()=>{r.assign(Hle(s,l,n))}).ElseIf(a.equal(Fle(4)),()=>{r.assign(Hle(c,s,n))}).Else(()=>{r.assign(Hle(n,s,l))})}),r}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),RCe=Rle(([e])=>{const t=Hle(e).toVar(),n=Ble(t.x).toVar(),r=Ble(t.y).toVar(),i=Ble(t.z).toVar(),a=Ble(fde(n,fde(r,i))).toVar(),o=Ble(mde(n,mde(r,i))).toVar(),s=Ble(o.sub(a)).toVar(),l=Ble().toVar(),c=Ble().toVar(),u=Ble().toVar();return u.assign(o),jle(o.greaterThan(0),()=>{c.assign(s.div(o))}).Else(()=>{c.assign(0)}),jle(c.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{jle(n.greaterThanEqual(o),()=>{l.assign(r.sub(i).div(s))}).ElseIf(r.greaterThanEqual(o),()=>{l.assign(eue(2,i.sub(n).div(s)))}).Else(()=>{l.assign(eue(4,n.sub(r).div(s)))}),l.mulAssign(1/6),jle(l.lessThan(0),()=>{l.addAssign(1)})}),Hle(l,c,u)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),LCe=Rle(([e])=>{const t=Hle(e).toVar(),n=Xle(lue(t,Hle(.04045))).toVar(),r=Hle(t.div(12.92)).toVar(),i=Hle(_de(mde(t.add(Hle(.055)),Hle(0)).div(1.055),Hle(2.4))).toVar();return Pde(r,i,n)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),OCe=(e,t)=>{e=Ble(e),t=Ble(t);const n=Vle(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return Lde(e.sub(n),e.add(n),t)},jCe=(e,t,n,r)=>Pde(e,t,n[r].clamp()),DCe=(e,t,n,r,i)=>Pde(e,t,OCe(n,r[i])),ICe=Rle(([e,t,n])=>{const r=Wue(e).toVar(),i=tue(Ble(.5).mul(t.sub(n)),ife).div(r).toVar(),a=tue(Ble(-.5).mul(t.sub(n)),ife).div(r).toVar(),o=Hle().toVar();o.x=r.x.greaterThan(Ble(0)).select(i.x,a.x),o.y=r.y.greaterThan(Ble(0)).select(i.y,a.y),o.z=r.z.greaterThan(Ble(0)).select(i.z,a.z);const s=fde(o.x,o.y,o.z).toVar();return ife.add(r.mul(s)).toVar().sub(n)}),BCe=Rle(([e,t])=>{const n=e.x,r=e.y,i=e.z;let a=t.element(0).mul(.886227);return a=a.add(t.element(1).mul(1.023328).mul(r)),a=a.add(t.element(2).mul(1.023328).mul(i)),a=a.add(t.element(3).mul(1.023328).mul(n)),a=a.add(t.element(4).mul(.858086).mul(n).mul(r)),a=a.add(t.element(5).mul(.858086).mul(r).mul(i)),a=a.add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),a=a.add(t.element(7).mul(.858086).mul(n).mul(i)),a=a.add(t.element(8).mul(.429043).mul(nue(n,n).sub(nue(r,r)))),a});var FCe=Object.freeze({__proto__:null,BRDF_GGX:iAe,BRDF_Lambert:Gve,BasicPointShadowFilter:iTe,BasicShadowFilter:LSe,Break:Lge,Const:ehe,Continue:()=>Fhe("continue").toStack(),DFGLUT:sAe,D_GGX:tAe,Discard:zhe,EPSILON:Mue,F_Schlick:Vve,Fn:Rle,HALF_PI:Rue,INFINITY:Eue,If:jle,Loop:Rge,NodeAccess:Cse,NodeShaderStage:Sse,NodeType:{BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},NodeUpdateType:Tse,OnBeforeMaterialUpdate:e=>m_e(f_e.BEFORE_MATERIAL,e),OnBeforeObjectUpdate:e=>m_e(f_e.BEFORE_OBJECT,e),OnMaterialUpdate:e=>m_e(f_e.MATERIAL,e),OnObjectUpdate:e=>m_e(f_e.OBJECT,e),PCFShadowFilter:OSe,PCFSoftShadowFilter:jSe,PI:Pue,PI2:Nue,PointShadowFilter:aTe,Return:()=>Fhe("return").toStack(),Schlick_to_F0:uAe,ScriptableNodeResources:fwe,ShaderNode:_le,Stack:Dle,Switch:(...e)=>Hse.Switch(...e),TBNViewMatrix:pme,TWO_PI:kue,VSMShadowFilter:DSe,V_GGX_SmithCorrelated:Jve,Var:Jde,VarIntent:the,abs:Jue,acesFilmicToneMapping:ewe,acos:Que,add:eue,addMethodChaining:Kse,addNodeElement:function(e){eJ("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",e)},agxToneMapping:iwe,all:Lue,alphaT:bce,and:due,anisotropy:xce,anisotropyB:wce,anisotropyT:_ce,any:Oue,append:e=>(eJ("TSL: append() has been renamed to Stack()."),Dle(e)),array:$ce,arrayBuffer:e=>new qse(e,"ArrayBuffer"),asin:Yue,assign:Xce,atan:Zue,atan2:Fde,atomicAdd:(e,t)=>Iwe(jwe.ATOMIC_ADD,e,t),atomicAnd:(e,t)=>Iwe(jwe.ATOMIC_AND,e,t),atomicFunc:Iwe,atomicLoad:e=>Iwe(jwe.ATOMIC_LOAD,e,null),atomicMax:(e,t)=>Iwe(jwe.ATOMIC_MAX,e,t),atomicMin:(e,t)=>Iwe(jwe.ATOMIC_MIN,e,t),atomicOr:(e,t)=>Iwe(jwe.ATOMIC_OR,e,t),atomicStore:(e,t)=>Iwe(jwe.ATOMIC_STORE,e,t),atomicSub:(e,t)=>Iwe(jwe.ATOMIC_SUB,e,t),atomicXor:(e,t)=>Iwe(jwe.ATOMIC_XOR,e,t),attenuationColor:Dce,attenuationDistance:jce,attribute:Xhe,attributeArray:(e,t="float")=>{let n,r;!0===t.isStruct?(n=t.layout.getLength(),r=mse("float")):(n=gse(t),r=mse(t));const i=new v_e(e,n,r);return fge(i,t,e)},backgroundBlurriness:w_e,backgroundIntensity:S_e,backgroundRotation:T_e,batch:Mge,bentNormalView:mme,billboarding:Oxe,bitAnd:mue,bitNot:gue,bitOr:vue,bitXor:Aue,bitangentGeometry:cme,bitangentLocal:ume,bitangentView:dme,bitangentWorld:hme,bitcast:oxe,blendBurn:hve,blendColor:gve,blendDodge:pve,blendOverlay:mve,blendScreen:fve,blur:cye,bool:Ule,buffer:spe,bufferAttribute:She,builtin:dpe,builtinAOContext:Xde,builtinShadowContext:Kde,bumpMap:wme,burn:(...e)=>(eJ('TSL: "burn" has been renamed. Use "blendBurn" instead.'),hve(e)),bvec2:Wle,bvec3:Xle,bvec4:Jle,bypass:Ohe,cache:Rhe,call:Qce,cameraFar:Cpe,cameraIndex:Spe,cameraNear:Tpe,cameraNormalMatrix:kpe,cameraPosition:Rpe,cameraProjectionMatrix:Mpe,cameraProjectionMatrixInverse:Epe,cameraViewMatrix:Ppe,cameraViewport:Lpe,cameraWorldMatrix:Npe,cbrt:Mde,cdl:V_e,ceil:que,checker:pTe,cineonToneMapping:Z_e,clamp:Nde,clearcoat:pce,clearcoatNormalView:yfe,clearcoatRoughness:fce,code:swe,color:Ile,colorSpaceToWorking:hhe,colorToDirection:e=>wle(e).mul(2).sub(1),compute:Phe,computeKernel:Ehe,computeSkinning:(e,t=null)=>{const n=new Pge(e);return n.positionNode=fge(new f2(e.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(vge).toVar(),n.skinIndexNode=fge(new f2(new Uint32Array(e.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(vge).toVar(),n.skinWeightNode=fge(new f2(e.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(vge).toVar(),n.bindMatrixNode=Wce(e.bindMatrix,"mat4"),n.bindMatrixInverseNode=Wce(e.bindMatrixInverse,"mat4"),n.boneMatricesNode=spe(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length),n.toPositionNode=t,wle(n)},context:Wde,convert:ice,convertColorSpace:(e,t,n)=>wle(new uhe(wle(e),t,n)),convertToTexture:(e,...t)=>e.isSampleNode||e.isTextureNode?e:e.isPassNode?e.getTextureNode():s_e(e,...t),cos:Kue,countLeadingZeros:dxe,countOneBits:hxe,countTrailingZeros:uxe,cross:xde,cubeTexture:Ife,cubeTextureBase:Dfe,dFdx:ide,dFdy:ade,dashSize:Pce,debug:qhe,decrement:Sue,decrementBefore:_ue,defaultBuildStages:Ese,defaultShaderStages:Mse,defined:ble,degrees:Due,deltaTime:Nxe,densityFog:function(e,t){return eJ('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),bwe(e,ywe(t))},densityFogFactor:ywe,depth:rve,depthPass:(e,t,n)=>new K_e(K_e.DEPTH,e,t,n),determinant:dde,difference:yde,diffuseColor:lce,diffuseContribution:cce,directPointLight:dTe,directionToColor:gme,directionToFaceDirection:dfe,dispersion:Ice,disposeShadowMaterial:FSe,distance:Ade,div:rue,dodge:(...e)=>(eJ('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),pve(e)),dot:bde,drawIndex:xge,dynamicBufferAttribute:(e,t=null,n=0,r=0)=>whe(e,t,n,r,UZ),element:rce,emissive:uce,equal:aue,equals:pde,equirectUV:Pve,exp:Iue,exp2:Bue,expression:Fhe,faceDirection:ufe,faceForward:Ode,faceforward:zde,float:Ble,floatBitsToInt:e=>new axe(e,"int","float"),floatBitsToUint:sxe,floor:Gue,fog:bwe,fract:Hue,frameGroup:Uce,frameId:kxe,frontFacing:cfe,fwidth:cde,gain:(e,t)=>e.lessThan(.5)?fxe(e.mul(2),t).div(2):tue(1,fxe(nue(tue(1,e),2),t).div(2)),gapSize:Nce,getConstNodeType:xle,getCurrentStack:Ole,getDirection:aye,getDistanceAttenuation:uTe,getGeometryRoughness:Qve,getNormalFromDepth:u_e,getParallaxCorrectNormal:ICe,getRoughness:Zve,getScreenPosition:c_e,getShIrradianceAt:BCe,getShadowMaterial:BSe,getShadowRenderObjectFunction:VSe,getTextureIndex:nxe,getViewPosition:l_e,ggxConvolution:pye,globalId:Pwe,glsl:(e,t)=>swe(e,t,"glsl"),glslFn:(e,t)=>cwe(e,t,"glsl"),grayscale:I_e,greaterThan:lue,greaterThanEqual:uue,hash:pxe,highpModelNormalViewMatrix:efe,highpModelViewMatrix:Jpe,hue:z_e,increment:wue,incrementBefore:xue,inspector:$he,instance:wge,instanceIndex:vge,instancedArray:(e,t="float")=>{let n,r;!0===t.isStruct?(n=t.layout.getLength(),r=mse("float")):(n=gse(t),r=mse(t));const i=new g_e(e,n,r);return fge(i,t,e)},instancedBufferAttribute:The,instancedDynamicBufferAttribute:Che,instancedMesh:Tge,int:Fle,intBitsToFloat:e=>new axe(e,"float","int"),interleavedGradientNoise:d_e,inverse:hde,inverseSqrt:Vue,inversesqrt:Ude,invocationLocalIndex:bge,invocationSubgroupIndex:yge,ior:Rce,iridescence:vce,iridescenceIOR:Ace,iridescenceThickness:yce,isolate:khe,ivec2:Gle,ivec3:$le,ivec4:Qle,js:(e,t)=>swe(e,t,"js"),label:Yde,length:tde,lengthSq:Ede,lessThan:sue,lessThanEqual:cue,lightPosition:fSe,lightProjectionUV:pSe,lightShadowMatrix:hSe,lightTargetDirection:vSe,lightTargetPosition:mSe,lightViewPosition:gSe,lightingContext:Vge,lights:(e=[])=>(new xSe).setLights(e),linearDepth:ive,linearToneMapping:Y_e,localId:Nwe,log:Fue,log2:zue,logarithmicDepthToViewZ:(e,t,n)=>{const r=e.mul(Fue(n.div(t)));return Ble(Math.E).pow(r).mul(t).negate()},luminance:U_e,mat2:ece,mat3:tce,mat4:nce,matcapUV:Xye,materialAO:lge,materialAlphaTest:Cme,materialAnisotropy:Wme,materialAnisotropyVector:cge,materialAttenuationColor:Jme,materialAttenuationDistance:Zme,materialClearcoat:Fme,materialClearcoatNormal:Ume,materialClearcoatRoughness:zme,materialColor:Mme,materialDispersion:oge,materialEmissive:Pme,materialEnvIntensity:Efe,materialEnvRotation:Pfe,materialIOR:Qme,materialIridescence:Hme,materialIridescenceIOR:$me,materialIridescenceThickness:Kme,materialLightMap:sge,materialLineDashOffset:ige,materialLineDashSize:tge,materialLineGapSize:nge,materialLineScale:ege,materialLineWidth:rge,materialMetalness:Ime,materialNormal:Bme,materialOpacity:Nme,materialPointSize:age,materialReference:Gfe,materialReflectivity:jme,materialRefractionRatio:Mfe,materialRotation:Vme,materialRoughness:Dme,materialSheen:Gme,materialSheenRoughness:qme,materialShininess:Eme,materialSpecular:kme,materialSpecularColor:Lme,materialSpecularIntensity:Rme,materialSpecularStrength:Ome,materialThickness:Yme,materialTransmission:Xme,max:mde,maxMipLevel:epe,mediumpModelViewMatrix:Zpe,metalness:hce,min:fde,mix:Pde,mixElement:Dde,mod:iue,modInt:Tue,modelDirection:Gpe,modelNormalMatrix:Xpe,modelPosition:Wpe,modelRadius:Kpe,modelScale:Hpe,modelViewMatrix:Qpe,modelViewPosition:$pe,modelViewProjection:uge,modelWorldMatrix:qpe,modelWorldMatrixInverse:Ype,morphReference:Bge,mrt:ixe,mul:nue,mx_aastep:OCe,mx_add:(e,t=Ble(0))=>eue(e,t),mx_atan2:(e=Ble(0),t=Ble(1))=>Zue(e,t),mx_cell_noise_float:(e=Yhe())=>sCe(e.convert("vec2|vec3")),mx_contrast:(e,t=1,n=.5)=>Ble(e).sub(n).mul(t).add(n),mx_divide:(e,t=Ble(1))=>rue(e,t),mx_fractal_noise_float:(e=Yhe(),t=3,n=2,r=.5,i=1)=>pCe(e,Fle(t),n,r).mul(i),mx_fractal_noise_vec2:(e=Yhe(),t=3,n=2,r=.5,i=1)=>mCe(e,Fle(t),n,r).mul(i),mx_fractal_noise_vec3:(e=Yhe(),t=3,n=2,r=.5,i=1)=>fCe(e,Fle(t),n,r).mul(i),mx_fractal_noise_vec4:(e=Yhe(),t=3,n=2,r=.5,i=1)=>gCe(e,Fle(t),n,r).mul(i),mx_frame:()=>kxe,mx_heighttonormal:(e,t)=>(e=Hle(e),t=Ble(t),wme(e,t)),mx_hsvtorgb:kCe,mx_ifequal:(e,t,n,r)=>e.equal(t).mix(n,r),mx_ifgreater:(e,t,n,r)=>e.greaterThan(t).mix(n,r),mx_ifgreatereq:(e,t,n,r)=>e.greaterThanEqual(t).mix(n,r),mx_invert:(e,t=Ble(1))=>tue(t,e),mx_modulo:(e,t=Ble(1))=>iue(e,t),mx_multiply:(e,t=Ble(1))=>nue(e,t),mx_noise_float:(e=Yhe(),t=1,n=0)=>JTe(e.convert("vec2|vec3")).mul(t).add(n),mx_noise_vec3:(e=Yhe(),t=1,n=0)=>nCe(e.convert("vec2|vec3")).mul(t).add(n),mx_noise_vec4:(e=Yhe(),t=1,n=0)=>{e=e.convert("vec2|vec3");return Yle(nCe(e),JTe(e.add(Vle(19,73)))).mul(t).add(n)},mx_place2d:(e,t=Vle(.5,.5),n=Vle(1,1),r=Ble(0),i=Vle(0,0))=>{let a=e;if(t&&(a=a.sub(t)),n&&(a=a.mul(n)),r){const e=r.mul(Math.PI/180),t=e.cos(),n=e.sin();a=Vle(a.x.mul(t).sub(a.y.mul(n)),a.x.mul(n).add(a.y.mul(t)))}return t&&(a=a.add(t)),i&&(a=a.add(i)),a},mx_power:(e,t=Ble(1))=>_de(e,t),mx_ramp4:(e,t,n,r,i=Yhe())=>{const a=i.x.clamp(),o=i.y.clamp(),s=Pde(e,t,a),l=Pde(n,r,a);return Pde(s,l,o)},mx_ramplr:(e,t,n=Yhe())=>jCe(e,t,n,"x"),mx_ramptb:(e,t,n=Yhe())=>jCe(e,t,n,"y"),mx_rgbtohsv:RCe,mx_rotate2d:(e,t)=>{e=Vle(e);const n=(t=Ble(t)).mul(Math.PI/180);return Jye(e,n)},mx_rotate3d:(e,t,n)=>{e=Hle(e),t=Ble(t),n=Hle(n);const r=t.mul(Math.PI/180),i=n.normalize(),a=r.cos(),o=r.sin(),s=Ble(1).sub(a);return e.mul(a).add(i.cross(e).mul(o)).add(i.mul(i.dot(e)).mul(s))},mx_safepower:(e,t=1)=>(e=Ble(e)).abs().pow(t).mul(e.sign()),mx_separate:(e,t=null)=>{if("string"===typeof t){const n={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},r=t.replace(/^out/,"").toLowerCase();if(void 0!==n[r])return e.element(n[r])}if("number"===typeof t)return e.element(t);if("string"===typeof t&&1===t.length){const n={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(void 0!==n[t])return e.element(n[t])}return e},mx_splitlr:(e,t,n,r=Yhe())=>DCe(e,t,n,r,"x"),mx_splittb:(e,t,n,r=Yhe())=>DCe(e,t,n,r,"y"),mx_srgb_texture_to_lin_rec709:LCe,mx_subtract:(e,t=Ble(0))=>tue(e,t),mx_timer:()=>Pxe,mx_transform_uv:(e=1,t=0,n=Yhe())=>n.mul(e).add(t),mx_unifiednoise2d:(e,t=Yhe(),n=Vle(1,1),r=Vle(0,0),i=1,a=0,o=1,s=!1,l=1,c=2,u=.5)=>PCe(e,t.convert("vec2|vec3"),n,r,i,a,o,s,l,c,u),mx_unifiednoise3d:(e,t=Yhe(),n=Vle(1,1),r=Vle(0,0),i=1,a=0,o=1,s=!1,l=1,c=2,u=.5)=>NCe(e,t.convert("vec2|vec3"),n,r,i,a,o,s,l,c,u),mx_worley_noise_float:(e=Yhe(),t=1)=>SCe(e.convert("vec2|vec3"),t,Fle(1)),mx_worley_noise_vec2:(e=Yhe(),t=1)=>CCe(e.convert("vec2|vec3"),t,Fle(1)),mx_worley_noise_vec3:(e=Yhe(),t=1)=>ECe(e.convert("vec2|vec3"),t,Fle(1)),negate:nde,neutralToneMapping:awe,nodeArray:Cle,nodeImmutable:Ele,nodeObject:wle,nodeObjectIntent:Sle,nodeObjects:Tle,nodeProxy:Mle,nodeProxyIntent:Ple,normalFlat:ffe,normalGeometry:hfe,normalLocal:pfe,normalMap:yme,normalView:vfe,normalViewGeometry:mfe,normalWorld:Afe,normalWorldGeometry:gfe,normalize:Wue,not:pue,notEqual:oue,numWorkgroups:Mwe,objectDirection:Dpe,objectGroup:Gce,objectPosition:Bpe,objectRadius:Upe,objectScale:Fpe,objectViewPosition:zpe,objectWorldMatrix:Ipe,oneMinus:rde,or:hue,orthographicDepthToViewZ:(e,t,n)=>t.sub(n).mul(e).sub(t),oscSawtooth:(e=Pxe)=>e.fract(),oscSine:(e=Pxe)=>e.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5),oscSquare:(e=Pxe)=>e.fract().round(),oscTriangle:(e=Pxe)=>e.add(.5).fract().mul(2).sub(1).abs(),output:Ece,outputStruct:txe,overlay:(...e)=>(eJ('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),mve(e)),overloadingFn:Exe,packHalf2x16:Axe,packSnorm2x16:gxe,packUnorm2x16:vxe,parabola:fxe,parallaxDirection:fme,parallaxUV:(e,t)=>e.sub(fme.mul(t)),parameter:(e,t)=>new Xbe(e,t),pass:(e,t,n)=>new K_e(K_e.COLOR,e,t,n),passTexture:(e,t)=>new H_e(e,t),pcurve:(e,t,n)=>_de(rue(_de(e,t),eue(_de(e,t),_de(tue(1,e),n))),1/t),perspectiveDepthToViewZ:eve,pmremTexture:Dye,pointShadow:lTe,pointUV:y_e,pointWidth:kce,positionGeometry:tfe,positionLocal:nfe,positionPrevious:rfe,positionView:ofe,positionViewDirection:sfe,positionWorld:ife,positionWorldDirection:afe,posterize:q_e,pow:_de,pow2:wde,pow3:Sde,pow4:Tde,premultiplyAlpha:vve,property:oce,quadBroadcast:cSe,quadSwapDiagonal:rSe,quadSwapX:tSe,quadSwapY:nSe,radians:jue,rand:jde,range:Swe,rangeFog:function(e,t,n){return eJ('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),bwe(e,Awe(t,n))},rangeFogFactor:Awe,reciprocal:sde,reference:zfe,referenceBuffer:Ufe,reflect:vde,reflectVector:Rfe,reflectView:Nfe,reflector:e=>new Jxe(e),refract:Rde,refractVector:Lfe,refractView:kfe,reinhardToneMapping:Q_e,remap:Dhe,remapClamp:Ihe,renderGroup:Vce,renderOutput:Vhe,rendererReference:ghe,replaceDefaultUV:function(e,t=null){return Wde(t,{getUV:e})},rotate:Jye,rotateUV:Rxe,roughness:dce,round:ode,rtt:s_e,sRGBTransferEOTF:she,sRGBTransferOETF:lhe,sample:(e,t=null)=>new p_e(e,wle(t)),sampler:e=>(!0===e.isNode?e:ipe(e)).convert("sampler"),samplerComparison:e=>(!0===e.isNode?e:ipe(e)).convert("samplerComparison"),saturate:kde,saturation:B_e,screen:(...e)=>(eJ('TSL: "screen" has been renamed. Use "blendScreen" instead.'),fve(e)),screenCoordinate:Ape,screenDPR:mpe,screenSize:vpe,screenUV:gpe,scriptable:gwe,scriptableValue:dwe,select:Gde,setCurrentStack:Lle,setName:$de,shaderStages:Pse,shadow:XSe,shadowPositionWorld:wSe,shapeCircle:fTe,sharedUniformGroup:zce,sheen:mce,sheenRoughness:gce,shiftLeft:yue,shiftRight:bue,shininess:Mce,sign:ede,sin:$ue,sinc:(e,t)=>$ue(Pue.mul(t.mul(e).sub(1))).div(Pue.mul(t.mul(e).sub(1))),skinning:Nge,smoothstep:Lde,smoothstepElement:Ide,specularColor:Sce,specularColorBlended:Tce,specularF90:Cce,spherizeUV:Lxe,split:(e,t)=>wle(new Fse(wle(e),t)),spritesheetUV:Ixe,sqrt:Uue,stack:Qbe,step:gde,stepElement:Bde,storage:fge,storageBarrier:()=>Rwe("storage").toStack(),storageObject:(e,t,n)=>(eJ('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),fge(e,t,n).setPBO(!0)),storageTexture:M_e,string:(e="")=>new qse(e,"string"),struct:(e,t=null)=>{const n=new Zbe(e,t),r=(...t)=>{let r=null;if(t.length>0)if(t[0].isNode){r={};const n=Object.keys(e);for(let e=0;e<t.length;e++)r[n[e]]=t[e]}else r=t[0];return new Jbe(n,r)};return r.layout=n,r.isStruct=!0,r},sub:tue,subBuild:rhe,subgroupAdd:Uwe,subgroupAll:Zwe,subgroupAnd:$we,subgroupAny:Jwe,subgroupBallot:zwe,subgroupBroadcast:iSe,subgroupBroadcastFirst:eSe,subgroupElect:Fwe,subgroupExclusiveAdd:Gwe,subgroupExclusiveMul:Hwe,subgroupInclusiveAdd:Vwe,subgroupInclusiveMul:Wwe,subgroupIndex:Age,subgroupMax:Qwe,subgroupMin:Ywe,subgroupMul:qwe,subgroupOr:Kwe,subgroupShuffle:aSe,subgroupShuffleDown:lSe,subgroupShuffleUp:sSe,subgroupShuffleXor:oSe,subgroupSize:kwe,subgroupXor:Xwe,tan:Xue,tangentGeometry:ime,tangentLocal:ame,tangentView:ome,tangentWorld:sme,texture:ipe,texture3D:N_e,texture3DLevel:(e,t,n)=>N_e(e,t).level(n),texture3DLoad:(...e)=>N_e(...e).setSampler(!1),textureBarrier:()=>Rwe("texture").toStack(),textureBicubic:PAe,textureBicubicLevel:EAe,textureCubeUV:oye,textureLevel:(e,t,n)=>ipe(e,t).level(n),textureLoad:ape,textureSize:Zhe,textureStore:(e,t,n)=>{const r=M_e(e,t,n);return null!==n&&r.toStack(),r},thickness:Oce,time:Pxe,toneMapping:Ahe,toneMappingExposure:yhe,toonOutlinePass:(e,t,n=new o1(0,0,0),r=.003,i=1)=>wle(new X_e(e,t,wle(n),wle(r),wle(i))),transformDirection:Cde,transformNormal:bfe,transformNormalToView:xfe,transformedClearcoatNormalView:Sfe,transformedNormalView:_fe,transformedNormalWorld:wfe,transmission:Lce,transpose:ude,triNoise3D:Txe,triplanarTexture:(...e)=>Bxe(...e),triplanarTextures:Bxe,trunc:lde,uint:zle,uintBitsToFloat:e=>new axe(e,"float","uint"),uniform:Wce,uniformArray:upe,uniformCubeTexture:(e=Ofe)=>Dfe(e),uniformFlow:Hde,uniformGroup:Fce,uniformTexture:(e=tpe)=>ipe(e),unpackHalf2x16:_xe,unpackNormal:vme,unpackSnorm2x16:bxe,unpackUnorm2x16:xxe,unpremultiplyAlpha:Ave,userData:(e,t,n)=>new k_e(e,t,n),uv:Yhe,uvec2:qle,uvec3:Kle,uvec4:Zle,varying:ahe,varyingProperty:sce,vec2:Vle,vec3:Hle,vec4:Yle,vectorComponents:Nse,velocity:D_e,vertexColor:dve,vertexIndex:gge,vertexStage:ohe,vibrance:F_e,viewZToLogarithmicDepth:tve,viewZToOrthographicDepth:Zge,viewZToPerspectiveDepth:Jge,viewport:ype,viewportCoordinate:xpe,viewportDepthTexture:Yge,viewportLinearDepth:ave,viewportMipTexture:$ge,viewportResolution:wpe,viewportSafeUV:jxe,viewportSharedTexture:Cve,viewportSize:bpe,viewportTexture:Hge,viewportUV:_pe,vogelDiskSample:h_e,wgsl:(e,t)=>swe(e,t,"wgsl"),wgslFn:(e,t)=>cwe(e,t,"wgsl"),workgroupArray:(e,t)=>new Owe("Workgroup",e,t),workgroupBarrier:()=>Rwe("workgroup").toStack(),workgroupId:Ewe,workingToColorSpace:dhe,xor:fue});const zCe=new Kbe;class UCe extends mbe{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(null===i)r._clearColor.getRGB(zCe),zCe.a=r._clearColor.a;else if(!0===i.isColor)i.getRGB(zCe),zCe.a=1,a=!0;else if(!0===i.isNode){const s=this.get(e),l=i;zCe.copy(r._clearColor);let c=s.backgroundMesh;if(void 0===c){const d=Yle(l).mul(S_e).context({getUV:()=>T_e.mul(gfe),getTextureLevel:()=>w_e}),h=Mpe.element(3).element(3).equal(1),p=rue(1,Mpe.element(1).element(1)).mul(3),f=h.select(nfe.mul(p),nfe);let m=Mpe.mul(Qpe.mul(Yle(f,0)));m=m.setZ(m.w);const g=new yve;function v(){i.removeEventListener("dispose",v),c.material.dispose(),c.geometry.dispose()}g.name="Background.material",g.side=1,g.depthTest=!1,g.depthWrite=!1,g.allowOverride=!1,g.fog=!1,g.lights=!1,g.vertexNode=m,g.colorNode=d,s.backgroundMeshNode=d,s.backgroundMesh=c=new V1(new Q3(1,32,32),g),c.frustumCulled=!1,c.name="Background.mesh",i.addEventListener("dispose",v)}const u=l.getCacheKey();s.backgroundCacheKey!==u&&(s.backgroundMeshNode.node=Yle(l).mul(S_e),s.backgroundMeshNode.needsUpdate=!0,c.material.needsUpdate=!0,s.backgroundCacheKey=u),t.unshift(c,c.geometry,c.material,0,0,null,null)}else tJ("Renderer: Unsupported background configuration.",i);const o=r.xr.getEnvironmentBlendMode();if("additive"===o?zCe.set(0,0,0,1):"alpha-blend"===o&&zCe.set(0,0,0,0),!0===r.autoClear||!0===a){const A=n.clearColorValue;A.r=zCe.r,A.g=zCe.g,A.b=zCe.b,A.a=zCe.a,!0!==r.backend.isWebGLBackend&&!0!==r.alpha||(A.r*=A.a,A.g*=A.a,A.b*=A.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let VCe=0;class GCe{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=VCe++}}class qCe{constructor(e,t,n,r,i,a,o,s,l,c=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=c,this.nodeAttributes=r,this.bindings=i,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=s,this.observer=l,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings){if(!0!==t.bindings[0].groupNode.shared){const n=new GCe(t.name,[],t.index,t.bindingsReference);e.push(n);for(const e of t.bindings)n.bindings.push(e.clone())}else e.push(t)}return e}}class WCe{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class HCe{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class $Ce{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class KCe extends $Ce{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}}class XCe{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let YCe=0;class QCe{constructor(e=null){this.id=YCe++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return void 0===t&&null!==this.parent&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class ZCe{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class JCe{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class eMe extends JCe{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class tMe extends JCe{constructor(e,t=new mJ){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class nMe extends JCe{constructor(e,t=new vJ){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class rMe extends JCe{constructor(e,t=new DJ){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class iMe extends JCe{constructor(e,t=new o1){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class aMe extends JCe{constructor(e,t=new d5){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class oMe extends JCe{constructor(e,t=new bJ){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class sMe extends JCe{constructor(e,t=new f0){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class lMe extends eMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class cMe extends tMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class uMe extends nMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class dMe extends rMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class hMe extends iMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class pMe extends aMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class fMe extends oMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class mMe extends sMe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let gMe=0;const vMe=new WeakMap,AMe=new WeakMap,yMe=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),bMe=e=>/e/g.test(e)?String(e).replace(/\+/g,""):(e=Number(e))+(e%1?"":".0");class xMe{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Qbe(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new QCe,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:gMe++})}isOpaque(){const e=this.material;return!1===e.transparent&&1===e.blending&&!1===e.alphaToCoverage}getBindGroupsCache(){let e=AMe.get(this.renderer);return void 0===e&&(e=new ube,AMe.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new IJ(e,t,n)}createCubeRenderTarget(e,t){return new Nve(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let i,a=!0;for(const o of t)r.push(o),a=a&&!0!==o.groupNode.shared;return a?(i=n.get(r),void 0===i&&(i=new GCe(e,r,this.bindingsIndexes[e].group,r),n.set(r,i))):i=new GCe(e,r,this.bindingsIndexes[e].group,r),i}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return void 0===r&&(void 0===this.bindingsIndexes[e]&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(null===e){const t={},n=this.bindings;for(const e of Pse)for(const r in n[e]){const i=n[e][r];(t[r]||(t[r]=[])).push(...i)}e=[];for(const r in t){const n=t[r],i=this._getBindGroup(r,n);e.push(i)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((e,t)=>e.bindings[0].groupNode.order-t.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){!1===this.nodes.includes(e)&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){!1===this.sequentialNodes.includes(e)&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes){e.getUpdateType()!==Tse.NONE&&this.updateNodes.push(e)}for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Tse.NONE&&this.updateBeforeNodes.push(e),n!==Tse.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===cQ||e.magFilter===uQ||e.magFilter===lQ||e.magFilter===dQ||e.minFilter===cQ||e.minFilter===uQ||e.minFilter===lQ||e.minFilter===dQ}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return void 0===n.cache&&(n.cache=new QCe(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){eJ("Abstract function.")}getInstanceIndex(){eJ("Abstract function.")}getDrawIndex(){eJ("Abstract function.")}getFrontFacing(){eJ("Abstract function.")}getFragCoord(){eJ("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=void 0===t.usageCount?1:t.usageCount+1,t.usageCount}generateTexture(){eJ("Abstract function.")}generateTextureLod(){eJ("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const a=n?n[i]:null;r+=null!==a?a.build(this,e):this.generateConst(e),i<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const i of t){const{name:e,type:t}=i;n&&n[e]&&n[e].isNode?r.push(n[e].build(this,t)):r.push(this.generateConst(t))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new o1:"vec2"===e||"uvec2"===e||"ivec2"===e?t=new mJ:"vec3"===e||"uvec3"===e||"ivec3"===e?t=new vJ:"vec4"!==e&&"uvec4"!==e&&"ivec4"!==e||(t=new DJ)),"float"===e)return bMe(t);if("int"===e)return`${Math.round(t)}`;if("uint"===e)return t>=0?`${Math.round(t)}u`:"0u";if("bool"===e)return t?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${bMe(t.r)}, ${bMe(t.g)}, ${bMe(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),i=e=>this.generateConst(r,e);if(2===n)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)} )`;if(3===n)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)} )`;if(4===n&&"mat2"!==e)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)}, ${i(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return"color"===e?"vec3":e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,t){const n=this.attributes;for(const i of n)if(i.name===e)return i;const r=new WCe(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"samplerComparison"===e||"texture"===e||"cubeTexture"===e||"storageTexture"===e||"depthTexture"===e||"texture3D"===e}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===gQ)return"int";if(t===vQ)return"uint"}return"float"}getElementType(e){return"mat2"===e?"vec2":"mat3"===e?"vec3":"mat4"===e?"vec4":this.getComponentType(e)}getComponentType(e){if("float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e)return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===t?null:"b"===t[1]?"bool":"i"===t[1]?"int":"u"===t[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e?"vec4":e}getTypeFromLength(e,t="float"){if(1===e)return t;let n=fse(e);const r="float"===t?"":t[0];return!0===/mat2/.test(t)&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return yMe.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,i=e.normalized;let a;return e instanceof x1||!0===i||(a=this.getTypeFromArray(n)),this.getTypeFromLength(r,a)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return null!==n?Number(n[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat2/.test(e)?4:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return"int"===t||"uint"===t?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]!==e)throw new Error("NodeBuilder: Invalid active stack removal.");this.activeStacks.pop()}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=Qbe(this.stack);const e=Ole();return this.stacks.push(e),Lle(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){this.getDataFromNode(t).stack=e}return this.stack=e.parent,Lle(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){let r=(n=null===n?e.isGlobal(this)?this.globalCache:this.cache:n).getData(e);void 0===r&&(r={},n.setData(e,r)),void 0===r[t]&&(r[t]={});let i=r[t];const a=r.any?r.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(void 0===i.subBuildsCache&&(i.subBuildsCache={}),i=i.subBuildsCache[o]||(i.subBuildsCache[o]={}),i.subBuilds=a),i}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e,"vertex");let r=n.bufferAttribute;if(void 0===r){const i=this.uniforms.index++;r=new WCe("nodeAttribute"+i,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const i=this.getDataFromNode(e,r,this.globalCache);let a=i.structType;if(void 0===a){const o=this.structs.index++;null===n&&(n="StructType"+o),a=new ZCe(n,t),this.structs[r].push(a),this.types[r][n]=e,i.structType=a}return a}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const i=this.getDataFromNode(e,n,this.globalCache);let a=i.uniform;if(void 0===a){const o=this.uniforms.index++;a=new HCe(r||"nodeUniform"+o,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),i.uniform=a}return a}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,i=!1){const a=this.getDataFromNode(e,r),o=this.getSubBuildProperty("variable",a.subBuilds);let s=a[o];if(void 0===s){const l=i?"_const":"_var",c=this.vars[r]||(this.vars[r]=[]),u=this.vars[l]||(this.vars[l]=0);null===t&&(t=(i?"nodeConst":"nodeVar")+u,this.vars[l]++),"variable"!==o&&(t=this.getSubBuildProperty(t,a.subBuilds));const d=e.getArrayCount(this);s=new $Ce(t,n,i,d),i||c.push(s),this.registerDeclaration(s),a[o]=s}return s}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode))&&(!e.cNode||this.isDeterministic(e.cNode));if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode));if(e.isArrayNode){if(null!==e.values)for(const t of e.values)if(!this.isDeterministic(t))return!1;return!0}return!!e.isConstNode}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,i=null){const a=this.getDataFromNode(e,"any"),o=this.getSubBuildProperty("varying",a.subBuilds);let s=a[o];if(void 0===s){const e=this.varyings,l=e.length;null===t&&(t="nodeVarying"+l),"varying"!==o&&(t=this.getSubBuildProperty(t,a.subBuilds)),s=new KCe(t,n,r,i),e.push(s),this.registerDeclaration(s),a[o]=s}return s}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let i=1,a=r;for(;void 0!==n[a];)a=r+"_"+i++;i>1&&(e.name=a,eJ(`TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${a}'.`)),n[a]=e}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let i=r.code;if(void 0===i){const e=this.codes[n]||(this.codes[n]=[]),a=e.length;i=new XCe("nodeCode"+a,t),e.push(i),r.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let i=!0,a=t;for(;a;){if(!0===r.get(a)){i=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(i)for(const o of n)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),i=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(t),a.set(n,!0)}addLineFlowCode(e,t=null){return""===e||(null!==t&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new lwe,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let e=0;const t=Object.values(this);return{next:()=>({value:t[e],done:e++>=t.length})}}};for(const a of t.inputs)n[a.name]=new Xbe(a.type,a.name);e.layout=null;const r=e.call(n),i=this.flowStagesNode(r,t.type);return e.layout=t,i}flowBuildStage(e,t,n=null){const r=this.getBuildStage();this.setBuildStage(t);const i=e.build(this,n);return this.setBuildStage(r),i}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,i=this.declarations,a=this.cache,o=this.buildStage,s=this.stack,l={code:""};this.flow=l,this.vars={},this.declarations={},this.cache=new QCe,this.stack=Qbe();for(const c of Ese)this.setBuildStage(c),l.result=e.build(this,t);return l.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=i,this.cache=a,this.stack=s,this.setBuildStage(o),l}getFunctionOperator(){return null}buildFunctionCode(){eJ("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const i=this.tab,a=this.cache,o=this.shaderStage,s=this.context;this.setShaderStage(e);const l={...this.context};delete l.nodeBlock,this.cache=this.globalCache,this.tab="\t",this.context=l;let c=null;if("generate"===this.buildStage){const i=this.flowChildNode(t,n);null!==r&&(i.code+=`${this.tab+r} = ${i.result};\n`),this.flowCode[e]=this.flowCode[e]+i.code,c=i}else c=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=i,this.context=s,c}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){eJ("Abstract function.")}getVaryings(){eJ("Abstract function.")}getVar(e,t,n=null){return`${null!==n?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(void 0!==n)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){eJ("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(void 0!==t)for(const r of t)n+=r.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){eJ("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(t=e&&e.isNode?e.isShaderCallNodeInternal?e.shaderNode.subBuilds:e.isStackNode?[e.subBuild]:this.getDataFromNode(e,"any").subBuilds:e instanceof Set?[...e]:e,!t)return null;const n=this.subBuildLayers;for(let r=t.length-1;r>=0;r--){const e=t[r];if(n.includes(e))return e}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let n,r;return n=null!==t?this.getClosestSubBuild(t):this.subBuildFn,r=n?e?n+"_"+e:n:e,r}build(){const{object:e,material:t,renderer:n}=this;if(null!==t){let e=n.library.fromMaterial(t);null===e&&(tJ(`NodeMaterial: Material "${t.type}" is not compatible.`),e=new yve),e.build(this)}else this.addFlow("compute",e);for(const r of Ese){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const e of Pse){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)"generate"===r?this.flowNode(e):e.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=vMe.get(e);return void 0===t&&(t={}),t}getNodeUniform(e,t){const n=this.getSharedDataFromNode(e);let r=n.cache;if(void 0===r){if("float"===t||"int"===t||"uint"===t)r=new lMe(e);else if("vec2"===t||"ivec2"===t||"uvec2"===t)r=new cMe(e);else if("vec3"===t||"ivec3"===t||"uvec3"===t)r=new uMe(e);else if("vec4"===t||"ivec4"===t||"uvec4"===t)r=new dMe(e);else if("color"===t)r=new hMe(e);else if("mat2"===t)r=new pMe(e);else if("mat3"===t)r=new fMe(e);else{if("mat4"!==t)throw new Error(`Uniform "${t}" not implemented.`);r=new mMe(e)}n.cache=r}return r}format(e,t,n){if((t=this.getVectorType(t))===(n=this.getVectorType(n))||null===n||this.isReference(n))return e;const r=this.getTypeLength(t),i=this.getTypeLength(n);return 16===r&&9===i?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:9===r&&4===i?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||i>4||0===i?e:r===i?`${this.getType(n)}( ${e} )`:r>i?(e="bool"===n?`all( ${e} )`:`${e}.${"xyz".slice(0,i)}`,this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),n)):4===i&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:2===r?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(1===r&&i>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${nY} - Node System\n`}}class _Me{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return void 0===n&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Tse.FRAME){const t=this._getMaps(this.updateBeforeMap,n);if(t.frameId!==this.frameId){const n=t.frameId;t.frameId=this.frameId,!1===e.updateBefore(this)&&(t.frameId=n)}}else if(t===Tse.RENDER){const t=this._getMaps(this.updateBeforeMap,n);if(t.renderId!==this.renderId){const n=t.renderId;t.renderId=this.renderId,!1===e.updateBefore(this)&&(t.renderId=n)}}else t===Tse.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Tse.FRAME){const t=this._getMaps(this.updateAfterMap,n);t.frameId!==this.frameId&&!1!==e.updateAfter(this)&&(t.frameId=this.frameId)}else if(t===Tse.RENDER){const t=this._getMaps(this.updateAfterMap,n);t.renderId!==this.renderId&&!1!==e.updateAfter(this)&&(t.renderId=this.renderId)}else t===Tse.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Tse.FRAME){const t=this._getMaps(this.updateMap,n);t.frameId!==this.frameId&&!1!==e.update(this)&&(t.frameId=this.frameId)}else if(t===Tse.RENDER){const t=this._getMaps(this.updateMap,n);t.renderId!==this.renderId&&!1!==e.update(this)&&(t.renderId=this.renderId)}else t===Tse.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class wMe{constructor(e,t,n=null,r="",i=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=i}}wMe.isNodeFunctionInput=!0;class SMe extends cTe{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:vSe(this.light),lightColor:e}}}const TMe=new f0,CMe=new f0;let MMe=null;class EMe extends cTe{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Wce(new vJ).setGroup(Vce),this.halfWidth=Wce(new vJ).setGroup(Vce),this.updateType=Tse.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;CMe.identity(),TMe.copy(t.matrixWorld),TMe.premultiply(n),CMe.extractRotation(TMe),this.halfWidth.value.set(.5*t.width,0,0),this.halfHeight.value.set(0,.5*t.height,0),this.halfWidth.value.applyMatrix4(CMe),this.halfHeight.value.applyMatrix4(CMe)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=ipe(MMe.LTC_FLOAT_1),n=ipe(MMe.LTC_FLOAT_2)):(t=ipe(MMe.LTC_HALF_1),n=ipe(MMe.LTC_HALF_2));const{colorNode:r,light:i}=this;return{lightColor:r,lightPosition:gSe(i),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){MMe=e}}class PMe extends cTe{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Wce(0).setGroup(Vce),this.penumbraCosNode=Wce(0).setGroup(Vce),this.cutoffDistanceNode=Wce(0).setGroup(Vce),this.decayExponentNode=Wce(0).setGroup(Vce),this.colorNode=Wce(this.color).setGroup(Vce)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return Lde(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return void 0===n&&(n=pSe(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:i}=this,a=this.getLightVector(e),o=a.normalize(),s=o.dot(vSe(i)),l=this.getSpotAttenuation(e,s),c=a.length(),u=uTe({lightDistance:c,cutoffDistance:n,decayExponent:r});let d,h,p=t.mul(l).mul(u);if(i.colorNode?(h=this.getLightCoord(e),d=i.colorNode(h)):i.map&&(h=this.getLightCoord(e),d=ipe(i.map,h.xy).onRenderUpdate(()=>i.map)),d){p=h.mul(2).sub(1).abs().lessThan(1).all().select(p.mul(d),p)}return{lightColor:p,lightDirection:o}}}class NMe extends PMe{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&!0===n.isTexture){const e=t.acos().mul(1/Math.PI);r=ipe(n,Vle(e,0),0).r}else r=super.getSpotAttenuation(t);return r}}const kMe=Rle(([e,t])=>{const n=e.abs().sub(t);return tde(mde(n,0)).add(fde(mde(n.x,n.y),0))});class RMe extends PMe{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),null===t.aspect){let e=1;null!==t.map&&(e=t.map.width/t.map.height),t.shadow.aspect=e}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=Ble(0),n=this.penumbraCosNode,r=hSe(this.light).mul(e.context.positionWorld||ife);return jle(r.w.greaterThan(0),()=>{const e=r.xyz.div(r.w),i=kMe(e.xy.sub(Vle(.5)),Vle(.5)),a=rue(-1,tue(1,Que(n)).sub(1));t.assign(kde(i.mul(-2).mul(a)))}),t}}class LMe extends cTe{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class OMe extends cTe{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=fSe(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Wce(new o1).setGroup(Vce)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,i=Afe.dot(r).mul(.5).add(.5),a=Pde(n,t,i);e.context.irradiance.addAssign(a)}}class jMe extends cTe{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new vJ);this.lightProbe=upe(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=BCe(Afe,this.lightProbe);e.context.irradiance.addAssign(t)}}class DMe{parseFunction(){eJ("Abstract function.")}}class IMe{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){eJ("Abstract function.")}}IMe.isNodeFunction=!0;const BMe=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,FMe=/[a-z_0-9]+/gi,zMe="#pragma main";class UMe extends IMe{constructor(e){const{type:t,inputs:n,name:r,precision:i,inputsCode:a,blockCode:o,headerCode:s}=(e=>{const t=(e=e.trim()).indexOf(zMe),n=-1!==t?e.slice(t+12):e,r=n.match(BMe);if(null!==r&&5===r.length){const i=r[4],a=[];let o=null;for(;null!==(o=FMe.exec(i));)a.push(o);const s=[];let l=0;for(;l<a.length;){const e="const"===a[l][0];!0===e&&l++;let t=a[l][0];"in"===t||"out"===t||"inout"===t?l++:t="";const n=a[l++][0];let r=Number.parseInt(a[l][0]);!1===Number.isNaN(r)?l++:r=null;const i=a[l++][0];s.push(new wMe(n,i,r,t,e))}const c=n.substring(r[0].length),u=void 0!==r[3]?r[3]:"";return{type:r[2],inputs:s,name:u,precision:void 0!==r[1]?r[1]:"",inputsCode:i,blockCode:c,headerCode:-1!==t?e.slice(0,t):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(e);super(t,n,r,i),this.inputsCode=a,this.blockCode=o,this.headerCode=s}getCode(e=this.name){let t;const n=this.blockCode;if(""!==n){const{type:r,inputsCode:i,headerCode:a,precision:o}=this;let s=`${r} ${e} ( ${i.trim()} )`;""!==o&&(s=`${o} ${s}`),t=a+s+n}else t="";return t}}class VMe extends DMe{parseFunction(e){return new UMe(e)}}const GMe=new WeakMap,qMe=[],WMe=[];class HMe extends mbe{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new _Me,this.nodeBuilderCache=new Map,this.callHashCache=new ube,this.groupsData=new ube,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===Gce.name)return!0;if(n===Vce.name){const t=this.get(e),n=this.nodeFrame.renderId;return t.renderId!==n&&(t.renderId=n,!0)}if(n===Uce.name){const t=this.get(e),n=this.nodeFrame.frameId;return t.frameId!==n&&(t.frameId=n,!0)}qMe[0]=t,qMe[1]=e;let r=this.groupsData.get(qMe);return void 0===r&&this.groupsData.set(qMe,r={}),qMe.length=0,r.version!==t.version&&(r.version=t.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(e);if(n=r.get(i),void 0===n){const t=t=>{const n=this.backend.createNodeBuilder(e.object,this.renderer);return n.scene=e.scene,n.material=t,n.camera=e.camera,n.context.material=t,n.lightsNode=e.lightsNode,n.environmentNode=this.getEnvironmentNode(e.scene),n.fogNode=this.getFogNode(e.scene),n.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&n.enableMultiview(),n};let a=t(e.material);try{a.build()}catch(or){a=t(new yve),a.build(),tJ("TSL: "+or)}n=this._createNodeBuilderState(a),r.set(i,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,0===t.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new qCe(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){qMe[0]=e,qMe[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(qMe)||{};if(r.callId!==n){const i=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&WMe.push(t.getCacheKey(!0)),i&&WMe.push(i.getCacheKey()),a&&WMe.push(a.getCacheKey()),WMe.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),WMe.push(this.renderer.shadowMap.enabled?1:0),WMe.push(this.renderer.shadowMap.type),r.callId=n,r.cacheKey=use(WMe),this.callHashCache.set(qMe,r),WMe.length=0}return qMe.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=0===e.backgroundBlurriness&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&0===t.backgroundBlurriness;if(t.background!==n||r){const i=this.getCacheNode("background",n,()=>{if(!0===n.isCubeTexture||n.mapping===eQ||n.mapping===tQ||n.mapping===nQ){if(e.backgroundBlurriness>0||n.mapping===nQ)return Dye(n);{let e;return e=!0===n.isCubeTexture?Ife(n):ipe(n),jve(e)}}if(!0===n.isTexture)return ipe(n,gpe.flipY()).setUpdateMatrix(!0);!0!==n.isColor&&tJ("WebGPUNodes: Unsupported background configuration.",n)},r);t.backgroundNode=i,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=i.get(t);return(void 0===a||r)&&(a=n(),i.set(t,a)),a}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const e=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const e=zfe("color","color",n).setGroup(Vce),t=zfe("density","float",n).setGroup(Vce);return bwe(e,ywe(t))}if(n.isFog){const e=zfe("color","color",n).setGroup(Vce),t=zfe("near","float",n).setGroup(Vce),r=zfe("far","float",n).setGroup(Vce);return bwe(e,Awe(t,r))}tJ("Renderer: Unsupported fog configuration.",n)});t.fogNode=e,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const e=this.getCacheNode("environment",n,()=>!0===n.isCubeTexture?Ife(n):!0===n.isTexture?ipe(n):void tJ("Nodes: Unsupported environment configuration.",n));t.environmentNode=e,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,i=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=r,a.material=i,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return GMe.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?N_e(e,Hle(gpe,dpe("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):ipe(e,gpe).renderOutput(t.toneMapping,t.currentColorSpace);return GMe.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new _Me,this.nodeBuilderCache=new Map,this.cacheLib={}}}const $Me=new A2;class KMe{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new bJ,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==e&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let i=0;i<r;i++){$Me.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const r=t[n+i],a=$Me.normal;r.x=-a.x,r.y=-a.y,r.z=-a.z,r.w=$Me.constant}}updateGlobal(e,t){this.shadowPass=null!==e.overrideMaterial&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,i=r.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+i){a.length=o+i;for(let e=0;e<i;e++)a[o+e]=new DJ;n=!0}this.projectPlanes(r,a,o),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return void 0===t&&(t=new KMe(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class XMe{constructor(e,t){this.bundleGroup=e,this.camera=t}}const YMe=[];class QMe{constructor(){this.bundles=new ube}get(e,t){const n=this.bundles;YMe[0]=e,YMe[1]=t;let r=n.get(YMe);return void 0===r&&(r=new XMe(e,t),n.set(YMe,r)),YMe.length=0,r}dispose(){this.bundles=new ube}}class ZMe{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(null!==n){t=new n;for(const n in e)t[n]=e[n]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t))eJ(`Redefinition of node ${t}`);else{if("function"!==typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"===typeof t||"object"===typeof t)throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}}addClass(e,t,n){if(n.has(t))eJ(`Redefinition of node ${t.name}`);else{if("function"!==typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"!==typeof t)throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}}const JMe=new xSe,eEe=[];class tEe extends ube{constructor(){super()}createNode(e=[]){return(new xSe).setLights(e)}getNode(e,t){if(e.isQuadMesh)return JMe;eEe[0]=e,eEe[1]=t;let n=this.get(eEe);return void 0===n&&(n=this.createNode(),this.set(eEe,n)),eEe.length=0,n}}class nEe extends IJ{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const rEe=new vJ,iEe=new vJ;class aEe extends rJ{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new e2,this._cameraL.viewport=new DJ,this._cameraR=new e2,this._cameraR.viewport=new DJ,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new Q4,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding="undefined"!==typeof XRWebGLBinding,this._frameBufferTargets=null,this._createXRLayer=uEe.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new mJ,this._onSessionEvent=sEe.bind(this),this._onSessionEnd=lEe.bind(this),this._onInputSourcesChange=cEe.bind(this),this._onAnimationFrame=dEe.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(e){this._foveation=e,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=e),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,!0===this.isPresenting&&eJ("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,!0===this.isPresenting&&eJ("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getBinding(){return null===this._glBinding&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,i,a,o,s={}){const l=new Y3(e,t),c=new nEe(i,a,{format:MQ,type:hQ,depthTexture:new $2(i,a,s.stencil?_Q:vQ,void 0,void 0,void 0,void 0,void 0,void 0,s.stencil?PQ:EQ),stencilBuffer:s.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});c._autoAllocateDepthBuffer=!0;const u=new u1({color:16777215,side:0});u.map=c.texture,u.map.offset.y=1,u.map.repeat.y=-1;const d=new V1(l,u);d.position.copy(n),d.quaternion.copy(r);const h={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:i,pixelheight:a,plane:d,material:u,rendercall:o,renderTarget:c};if(this._layers.push(h),null!==this._session){h.plane.material=new u1({color:16777215,side:0}),h.plane.material.blending=5,h.plane.material.blendEquation=mY,h.plane.material.blendSrc=AY,h.plane.material.blendDst=AY,h.xrlayer=this._createXRLayer(h);const e=this._session.renderState.layers;e.unshift(h.xrlayer),this._session.updateRenderState({layers:e})}else c.isXRRenderTarget=!1;return d}createCylinderLayer(e,t,n,r,i,a,o,s,l={}){const c=new Q2(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),u=new nEe(a,o,{format:MQ,type:hQ,depthTexture:new $2(a,o,l.stencil?_Q:vQ,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?PQ:EQ),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});u._autoAllocateDepthBuffer=!0;const d=new u1({color:16777215,side:1});d.map=u.texture,d.map.offset.y=1,d.map.repeat.y=-1;const h=new V1(c,d);h.position.copy(r),h.quaternion.copy(i);const p={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:i,pixelwidth:a,pixelheight:o,plane:h,material:d,rendercall:s,renderTarget:u};if(this._layers.push(p),null!==this._session){p.plane.material=new u1({color:16777215,side:1}),p.plane.material.blending=5,p.plane.material.blendEquation=mY,p.plane.material.blendSrc=AY,p.plane.material.blendDst=AY,p.xrlayer=this._createXRLayer(p);const e=this._session.renderState.layers;e.unshift(p.xrlayer),this._session.updateRenderState({layers:e})}else u.isXRRenderTarget=!1;return h}renderLayers(){const e=new vJ,t=new gJ,n=this._renderer,r=this.isPresenting,i=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const o=new mJ;n.getSize(o);const s=n._quad;for(const l of this._layers)if(l.renderTarget.isXRRenderTarget=null!==this._session,l.renderTarget._hasExternalTextures=l.renderTarget.isXRRenderTarget,l.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){l.xrlayer.transform=new XRRigidTransform(l.plane.getWorldPosition(e),l.plane.getWorldQuaternion(t));const r=this._glBinding.getSubImage(l.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(l.renderTarget,r.colorTexture,void 0),n._setXRLayerSize(l.renderTarget.width,l.renderTarget.height),n.setOutputRenderTarget(l.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:i,quad:a}=this._frameBufferTargets.get(l.renderTarget)||{frameBufferTarget:null,quad:null};i?(n._frameBufferTarget=i,n._quad=a):(n._quad=new i_e(new yve),this._frameBufferTargets.set(l.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),l.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(l.renderTarget),l.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(i),n._frameBufferTarget=a,n._setXRLayerSize(o.x,o.y),n._quad=s,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,i=r.getContextAttributes();if(this._session=e,null!==e){if(!0===n.isWebGPUBackend)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),!0===this._supportsLayers){let n=null,a=null,o=null;t.depth&&(o=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,n=t.stencil?PQ:EQ,a=t.stencil?_Q:vQ);const s={colorFormat:r.RGBA8,depthFormat:o,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(s.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const l=this._glBinding.createProjectionLayer(s),c=[l];this._glProjLayer=l,t.setPixelRatio(1),t._setXRLayerSize(l.textureWidth,l.textureHeight);const u=this._useMultiview?2:1,d=new $2(l.textureWidth,l.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n,u);if(this._xrRenderTarget=new nEe(l.textureWidth,l.textureHeight,{format:MQ,type:hQ,colorSpace:t.outputColorSpace,depthTexture:d,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:!1===l.ignoreDepthValues,resolveStencilBuffer:!1===l.ignoreDepthValues,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const e of this._layers)e.plane.material=new u1({color:16777215,side:"cylinder"===e.type?1:0}),e.plane.material.blending=5,e.plane.material.blendEquation=mY,e.plane.material.blendSrc=AY,e.plane.material.blendDst=AY,e.xrlayer=this._createXRLayer(e),c.unshift(e.xrlayer);e.updateRenderState({layers:c})}else{const n={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},i=new XRWebGLLayer(e,r,n);this._glBaseLayer=i,e.updateRenderState({baseLayer:i}),t.setPixelRatio(1),t._setXRLayerSize(i.framebufferWidth,i.framebufferHeight),this._xrRenderTarget=new nEe(i.framebufferWidth,i.framebufferHeight,{format:MQ,type:hQ,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:!1===i.ignoreDepthValues,resolveStencilBuffer:!1===i.ignoreDepthValues}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(null===t)return;const n=e.near,r=e.far,i=this._cameraXR,a=this._cameraL,o=this._cameraR;i.near=o.near=a.near=n,i.far=o.far=a.far=r,i.isMultiViewCamera=this._useMultiview,this._currentDepthNear===i.near&&this._currentDepthFar===i.far||(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=6|e.layers.mask,a.layers.mask=3&i.layers.mask,o.layers.mask=5&i.layers.mask;const s=e.parent,l=i.cameras;oEe(i,s);for(let c=0;c<l.length;c++)oEe(l[c],s);2===l.length?function(e,t,n){rEe.setFromMatrixPosition(t.matrixWorld),iEe.setFromMatrixPosition(n.matrixWorld);const r=rEe.distanceTo(iEe),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(a[8]+1)/a[0],h=o*u,p=o*d,f=r/(-u+d),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=o+f,n=s+f,i=h-m,a=p+(r-m),u=l*s/n*t,d=c*s/n*t;e.projectionMatrix.makePerspective(i,a,u,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(i,a,o):i.projectionMatrix.copy(a.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*sJ*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,i,s)}_getController(e){let t=this._controllers[e];return void 0===t&&(t=new s2,this._controllers[e]=t),t}}function oEe(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}function sEe(e){const t=this._controllerInputSources.indexOf(e.inputSource);if(-1===t)return;const n=this._controllers[t];if(void 0!==n){const t=this.getReferenceSpace();n.update(e.inputSource,e.frame,t),n.dispatchEvent({type:e.type,data:e.inputSource})}}function lEe(){const e=this._session,t=this._renderer;e.removeEventListener("select",this._onSessionEvent),e.removeEventListener("selectstart",this._onSessionEvent),e.removeEventListener("selectend",this._onSessionEvent),e.removeEventListener("squeeze",this._onSessionEvent),e.removeEventListener("squeezestart",this._onSessionEvent),e.removeEventListener("squeezeend",this._onSessionEvent),e.removeEventListener("end",this._onSessionEnd),e.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let n=0;n<this._controllers.length;n++){const e=this._controllerInputSources[n];null!==e&&(this._controllerInputSources[n]=null,this._controllers[n].disconnect(e))}if(this._currentDepthNear=null,this._currentDepthFar=null,t._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,!0===this._sessionUsesLayers)for(const n of this._layers)n.renderTarget=new nEe(n.pixelwidth,n.pixelheight,{format:MQ,type:hQ,depthTexture:new $2(n.pixelwidth,n.pixelheight,n.stencilBuffer?_Q:vQ,void 0,void 0,void 0,void 0,void 0,void 0,n.stencilBuffer?PQ:EQ),stencilBuffer:n.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),n.renderTarget.isXRRenderTarget=!1,n.plane.material=n.material,n.material.map=n.renderTarget.texture,n.material.map.offset.y=1,n.material.map.repeat.y=-1,delete n.xrlayer;this.isPresenting=!1,this._useMultiview=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function cEe(e){const t=this._controllers,n=this._controllerInputSources;for(let r=0;r<e.removed.length;r++){const i=e.removed[r],a=n.indexOf(i);a>=0&&(n[a]=null,t[a].disconnect(i))}for(let r=0;r<e.added.length;r++){const i=e.added[r];let a=n.indexOf(i);if(-1===a){for(let e=0;e<t.length;e++){if(e>=n.length){n.push(i),a=e;break}if(null===n[e]){n[e]=i,a=e;break}}if(-1===a)break}const o=t[a];o&&o.connect(i)}}function uEe(e){return"quad"===e.type?this._glBinding.createQuadLayer({transform:new XRRigidTransform(e.translation,e.quaternion),width:e.width/2,height:e.height/2,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(e.translation,e.quaternion),radius:e.radius,centralAngle:e.centralAngle,aspectRatio:e.aspectRatio,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1})}function dEe(e,t){if(void 0===t)return;const n=this._cameraXR,r=this._renderer,i=r.backend,a=this._glBaseLayer,o=this.getReferenceSpace(),s=t.getViewerPose(o);if(this._xrFrame=t,null!==s){const e=s.views;null!==this._glBaseLayer&&i.setXRTarget(a.framebuffer);let t=!1;e.length!==n.cameras.length&&(n.cameras.length=0,t=!0);for(let r=0;r<e.length;r++){const o=e[r];let s;if(!0===this._supportsLayers){const e=this._glBinding.getViewSubImage(this._glProjLayer,o);s=e.viewport,0===r&&i.setXRRenderTargetTextures(this._xrRenderTarget,e.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:e.depthStencilTexture)}else s=a.getViewport(o);let l=this._cameras[r];void 0===l&&(l=new e2,l.layers.enable(r),l.viewport=new DJ,this._cameras[r]=l),l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.quaternion,l.scale),l.projectionMatrix.fromArray(o.projectionMatrix),l.projectionMatrixInverse.copy(l.projectionMatrix).invert(),l.viewport.set(s.x,s.y,s.width,s.height),0===r&&(n.matrix.copy(l.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),!0===t&&n.cameras.push(l)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const e=this._controllerInputSources[l],n=this._controllers[l];null!==e&&void 0!==n&&n.update(e,t,o)}this._currentAnimationLoop&&this._currentAnimationLoop(e,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}class hEe extends rJ{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new DJ(0,0,this._width,this._height),this._scissor=new DJ(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new H2,this.depthTexture=new $2}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),!0===n&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,i=0,a=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,n,r),o.minDepth=i,o.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const pEe=new l2,fEe=new mJ,mEe=new DJ,gEe=new _2,vEe=new T2,AEe=new f0,yEe=new DJ;class bEe{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:i=!0,stencil:a=!1,antialias:o=!1,samples:s=0,getFallback:l=null,outputBufferType:c=yQ,multiview:u=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=MZ,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=a,this.info=new Tbe,this.contextNode=Wde(),this.library=new ZMe,this.lighting=new tEe,this._samples=s||!0===o?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new hEe(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new Whe,this._inspector.setRenderer(this),this._getFallback=l,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new i_e(new yve),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const d=!0===this.alpha?0:1;this._clearColor=new Kbe(0,0,0,d),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=c,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr=new aEe(this,u),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,t,n)=>{await this.compileAsync(e,t);const r=this._renderLists.get(e,t),i=this._renderContexts.get(e,t,this._renderTarget,this._mrt),a=e.overrideMaterial||n.material,o=this._objects.get(n,a,e,t,r.lightsNode,i,i.clippingContext),{fragmentShader:s,vertexShader:l}=o.getNodeBuilderState();return{fragmentShader:s,vertexShader:l}}}}async init(){return null!==this._initPromise||(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(tJ){if(null===this._getFallback)return void t(tJ);try{this.backend=n=this._getFallback(tJ),await n.init(this)}catch(tJ){return void t(tJ)}}this._nodes=new HMe(this,n),this._animation=new cbe(this,this._nodes,this.info),this._attributes=new xbe(n),this._background=new UCe(this,this._nodes),this._geometries=new Sbe(this._attributes,this.info),this._textures=new $be(this,n,this.info),this._pipelines=new kbe(n,this._nodes),this._bindings=new Rbe(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new fbe(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Bbe(this.lighting),this._bundles=new QMe,this._renderContexts=new Wbe,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)})),this._initPromise}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,s=this._compilationPromises,l=!0===e.isScene?e:pEe;null===n&&(n=e);const c=this._renderTarget,u=this._renderContexts.get(n,t,c,this._mrt),d=this._activeMipmapLevel,h=[];this._currentRenderContext=u,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=h,r.renderId++,r.update(),u.depth=this.depth,u.stencil=this.stencil,u.clippingContext||(u.clippingContext=new KMe),u.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,c);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,u.clippingContext),n!==e&&n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&p.pushLight(e)}),p.finish(),null!==c){this._textures.updateRenderTarget(c,d);const e=this._textures.get(c);u.textures=e.textures,u.depthTexture=e.depthTexture}else u.textures=null,u.depthTexture=null;this._background.update(l,p,u);const f=p.opaque,m=p.transparent,g=p.transparentDoublePass,v=p.lightsNode;!0===this.opaque&&f.length>0&&this._renderObjects(f,t,l,v),!0===this.transparent&&m.length>0&&this._renderTransparents(m,g,t,l,v),r.renderId=i,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=s,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(h)}async renderAsync(e,t){nJ('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){tJ("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){null!==this._inspector&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;!0===e?(t.modelViewMatrix=Jpe,t.modelNormalViewMatrix=efe):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===Jpe&&e.modelNormalViewMatrix===efe}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return nJ('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:\n\nMessage: ${e.message}`;e.reason&&(t+=`\nReason: ${e.reason}`),tJ(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:i,renderList:a}=e,o=this._currentRenderContext,s=this._bundles.get(r,i),l=this.backend.get(s);void 0===l.renderContexts&&(l.renderContexts=new Set);const c=r.version!==l.version,u=!1===l.renderContexts.has(o)||c;if(l.renderContexts.add(o),u){this.backend.beginBundle(o),(void 0===l.renderObjects||c)&&(l.renderObjects=[]),this._currentRenderBundle=s;const{transparentDoublePass:e,transparent:u,opaque:d}=a;!0===this.opaque&&d.length>0&&this._renderObjects(d,i,t,n),!0===this.transparent&&u.length>0&&this._renderTransparents(u,e,i,t,n),this._currentRenderBundle=null,this.backend.finishBundle(o,s),l.version=r.version}else{const{renderObjects:e}=l;for(let t=0,n=e.length;t<n;t++){const n=e[t];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(o,s)}render(e,t){if(!1===this._initialized)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=0!==e,r=t!==TJ.workingColorSpace;if(!1===n&&!1===r)return null;const{width:i,height:a}=this.getDrawingBufferSize(fEe),{depth:o,stencil:s}=this;let l=this._frameBufferTarget;null===l&&(l=new IJ(i,a,{depthBuffer:o,stencilBuffer:s,type:this._outputBufferType,format:MQ,colorSpace:TJ.workingColorSpace,generateMipmaps:!1,minFilter:cQ,magFilter:cQ,samples:this.samples}),l.isPostProcessingRenderTarget=!0,this._frameBufferTarget=l);const c=this.getOutputRenderTarget();l.depthBuffer=o,l.stencilBuffer=s,null!==c?l.setSize(c.width,c.height,c.depth):l.setSize(i,a,1);const u=this._canvasTarget;return l.viewport.copy(u._viewport),l.scissor.copy(u._scissor),l.viewport.multiplyScalar(u._pixelRatio),l.scissor.multiplyScalar(u._pixelRatio),l.scissorTest=u._scissorTest,l.multiview=null!==c&&c.multiview,l.resolveDepthBuffer=null===c||c.resolveDepthBuffer,l._autoAllocateDepthBuffer=null!==c&&c._autoAllocateDepthBuffer,l}_renderScene(e,t,n=!0){if(!0===this._isDeviceLost)return;const r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,a=i.renderId,o=this._currentRenderContext,s=this._currentRenderObjectFunction,l=!0===e.isScene?e:pEe,c=this._renderTarget||this._outputRenderTarget,u=this._activeCubeFace,d=this._activeMipmapLevel;let h;null!==r?(h=r,this.setRenderTarget(h)):h=c;const p=this._renderContexts.get(e,t,h,this._mrt);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(p),this.inspector.beginRender(this.backend.getTimestampUID(p),e,t,h);const f=this.coordinateSystem,m=this.xr;if(t.coordinateSystem!==f&&!1===m.isPresenting&&(t.coordinateSystem=f,t.updateProjectionMatrix(),t.isArrayCamera))for(const P of t.cameras)P.coordinateSystem=f,P.updateProjectionMatrix();!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===m.enabled&&!0===m.isPresenting&&(!0===m.cameraAutoUpdate&&m.updateCamera(t),t=m.getCamera());const g=this._canvasTarget;let v=g._viewport,A=g._scissor,y=g._pixelRatio;null!==h&&(v=h.viewport,A=h.scissor,y=1),this.getDrawingBufferSize(fEe),mEe.set(0,0,fEe.width,fEe.height);const b=void 0===v.minDepth?0:v.minDepth,x=void 0===v.maxDepth?1:v.maxDepth;p.viewportValue.copy(v).multiplyScalar(y).floor(),p.viewportValue.width>>=d,p.viewportValue.height>>=d,p.viewportValue.minDepth=b,p.viewportValue.maxDepth=x,p.viewport=!1===p.viewportValue.equals(mEe),p.scissorValue.copy(A).multiplyScalar(y).floor(),p.scissor=g._scissorTest&&!1===p.scissorValue.equals(mEe),p.scissorValue.width>>=d,p.scissorValue.height>>=d,p.clippingContext||(p.clippingContext=new KMe),p.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,h);const _=t.isArrayCamera?vEe:gEe;t.isArrayCamera||(AEe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),_.setFromProjectionMatrix(AEe,t.coordinateSystem,t.reversedDepth));const w=this._renderLists.get(e,t);if(w.begin(),this._projectObject(e,t,0,w,p.clippingContext),w.finish(),!0===this.sortObjects&&w.sort(this._opaqueSort,this._transparentSort),null!==h){this._textures.updateRenderTarget(h,d);const e=this._textures.get(h);p.textures=e.textures,p.depthTexture=e.depthTexture,p.width=e.width,p.height=e.height,p.renderTarget=h,p.depth=h.depthBuffer,p.stencil=h.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=fEe.width,p.height=fEe.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=d,p.height>>=d,p.activeCubeFace=u,p.activeMipmapLevel=d,p.occlusionQueryCount=w.occlusionQueryCount,p.scissorValue.max(yEe.set(0,0,0,0)),p.scissorValue.x+p.scissorValue.width>p.width&&(p.scissorValue.width=Math.max(p.width-p.scissorValue.x,0)),p.scissorValue.y+p.scissorValue.height>p.height&&(p.scissorValue.height=Math.max(p.height-p.scissorValue.y,0)),this._background.update(l,w,p),p.camera=t,this.backend.beginRender(p);const{bundles:S,lightsNode:T,transparentDoublePass:C,transparent:M,opaque:E}=w;return S.length>0&&this._renderBundles(S,l,T),!0===this.opaque&&E.length>0&&this._renderObjects(E,t,l,T),!0===this.transparent&&M.length>0&&this._renderTransparents(M,C,t,l,T),this.backend.finishRender(p),i.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=s,null!==r&&(this.setRenderTarget(c,u,d),this._renderOutput(h)),l.onAfterRender(this,e,t,h),this.inspector.finishRender(this.backend.getTimestampUID(p)),p}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,r){this._canvasTarget.setScissor(e,t,n,r)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,r,i=0,a=1){this._canvasTarget.setViewport(e,t,n,r,i,a)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(!1===this._initialized)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(null!==r){this._textures.updateRenderTarget(r);const e=this._textures.get(r);i=this._renderContexts.getForClear(r),i.textures=e.textures,i.depthTexture=e.depthTexture,i.width=e.width,i.height=e.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer,i.clearColorValue=this.backend.getClearColor(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,i),null!==r&&null===this._renderTarget&&this._renderOutput(r)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){nJ('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,n)}async clearColorAsync(){nJ('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){nJ('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){nJ('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=0!==this.currentToneMapping,t=this.currentColorSpace!==TJ.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return null!==this._renderTarget?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:0}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:TJ.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||null===this._renderTarget}dispose(){!0===this._initialized&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{null!==e&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return eJ("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const n=this._nodes.nodeFrame,r=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const i=this.backend,a=this._pipelines,o=this._bindings,s=this._nodes,l=Array.isArray(e)?e:[e];if(void 0===l[0]||!0!==l[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const c of l){if(!1===a.has(c)){const e=()=>{c.removeEventListener("dispose",e),a.delete(c),o.deleteForCompute(c),s.delete(c)};c.addEventListener("dispose",e);const t=c.onInitFunction;null!==t&&t.call(c,{renderer:this})}s.updateForCompute(c),o.updateForCompute(c);const n=o.getForCompute(c),r=a.getForCompute(c,n);i.compute(e,c,n,r,t)}i.finishCompute(e),n.renderId=r,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){!1===this._initialized&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return nJ('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(!1===this._initialized)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){nJ('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(!1===this._initialized)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(null!==t)if(t.isVector2)t=yEe.set(t.x,t.y,e.image.width,e.image.height).floor();else{if(!t.isVector4)return void tJ("Renderer.copyFramebufferToTexture: Invalid rectangle.");t=yEe.copy(t).floor()}else t=yEe.set(0,0,e.image.width,e.image.height);let n,r=this._currentRenderContext;null!==r?n=r.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),null!==n&&(this._textures.updateRenderTarget(n),r=this._textures.get(n))),this._textures.updateTexture(e,{renderTarget:n}),this.backend.copyFramebufferToTexture(e,r,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,i,a),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,r,i,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,n,r,i,o)}_projectObject(e,t,n,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const a=t.isArrayCamera?vEe:gEe;if(!e.frustumCulled||a.intersectsSprite(e,t)){!0===this.sortObjects&&yEe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(AEe);const{geometry:t,material:a}=e;a.visible&&r.push(e,t,a,n,yEe.z,null,i)}}else if(e.isLineLoop)tJ("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const a=t.isArrayCamera?vEe:gEe;if(!e.frustumCulled||a.intersectsObject(e,t)){const{geometry:t,material:a}=e;if(!0===this.sortObjects&&(null===t.boundingSphere&&t.computeBoundingSphere(),yEe.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(AEe)),Array.isArray(a)){const o=t.groups;for(let s=0,l=o.length;s<l;s++){const l=o[s],c=a[l.materialIndex];c&&c.visible&&r.push(e,t,c,n,yEe.z,l,i)}}else a.visible&&r.push(e,t,a,n,yEe.z,null,i)}}if(!0===e.isBundleGroup&&void 0!==this.backend.beginBundle){const n=r;(r=this._renderLists.get(e,t)).begin(),n.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let o=0,s=a.length;o<s;o++)this._projectObject(a[o],t,n,r,i)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,i){if(t.length>0){for(const{material:e}of t)e.side=1;this._renderObjects(t,n,r,i,"backSide");for(const{material:e}of t)e.side=0;this._renderObjects(e,n,r,i);for(const{material:e}of t)e.side=2}else this._renderObjects(e,n,r,i)}_renderObjects(e,t,n,r,i=null){for(let a=0,o=e.length;a<o;a++){const{object:o,geometry:s,material:l,group:c,clippingContext:u}=e[a];this._currentRenderObjectFunction(o,n,t,s,l,c,r,u,i)}}_getShadowNodes(e){const t=e.version;let n=this._cacheShadowNodes.get(e);if(void 0===n||n.version!==t){const r=null!==e.map,i=e.colorNode&&e.colorNode.isNode,a=e.castShadowNode&&e.castShadowNode.isNode;let o=null,s=null,l=null;if(r||i||a){let t,n;a?(t=e.castShadowNode.rgb,n=e.castShadowNode.a):(t=Hle(0),n=Ble(1)),r&&(n=n.mul(zfe("map","texture",e).a)),i&&(n=n.mul(e.colorNode.a)),s=Yle(t,n)}e.depthNode&&e.depthNode.isNode&&(l=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?o=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(o=e.positionNode),n={version:t,colorNode:s,depthNode:l,positionNode:o},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,r,i,a,o,s=null,l=null){let c,u,d,h,p=!1;if(e.onBeforeRender(this,t,n,r,i,a),!0===i.allowOverride&&null!==t.overrideMaterial){const e=t.overrideMaterial;if(p=!0,c=t.overrideMaterial.colorNode,u=t.overrideMaterial.depthNode,d=t.overrideMaterial.positionNode,h=t.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(e.positionNode=i.positionNode),e.alphaTest=i.alphaTest,e.alphaMap=i.alphaMap,e.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,e.isShadowPassMaterial){const{colorNode:t,depthNode:n,positionNode:r}=this._getShadowNodes(i);e.side=null===i.shadowSide?i.side:i.shadowSide,null!==t&&(e.colorNode=t),null!==n&&(e.depthNode=n),null!==r&&(e.positionNode=r)}i=e}!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,this._handleObjectFunction(e,i,t,n,o,a,s,"backSide"),i.side=0,this._handleObjectFunction(e,i,t,n,o,a,s,l),i.side=2):this._handleObjectFunction(e,i,t,n,o,a,s,l),p&&(t.overrideMaterial.colorNode=c,t.overrideMaterial.depthNode=u,t.overrideMaterial.positionNode=d,t.overrideMaterial.side=h),e.onAfterRender(this,t,n,r,i,a)}_renderObjectDirect(e,t,n,r,i,a,o,s){const l=this._objects.get(e,t,n,r,i,this._currentRenderContext,o,s);l.drawRange=e.geometry.drawRange,l.group=a;const c=this._nodes.needsRefresh(l);if(c&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.bundleGroup}this.backend.draw(l,this.info),c&&this._nodes.updateAfter(l)}_createObjectPipeline(e,t,n,r,i,a,o,s){const l=this._objects.get(e,t,n,r,i,this._currentRenderContext,o,s);l.drawRange=e.geometry.drawRange,l.group=a,this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l),this._pipelines.getForRender(l,this._compilationPromises),this._nodes.updateAfter(l)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class xEe{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}class _Ee extends xEe{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return(e=this._buffer.byteLength)+(bbe-e%bbe)%bbe;var e}get buffer(){return this._buffer}update(){return!0}}class wEe extends _Ee{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let SEe=0;class TEe extends wEe{constructor(e,t){super("UniformBuffer_"+SEe++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class CEe extends wEe{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(null===e){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const r=this.uniforms[n],i=r.boundary,a=r.itemSize*e,o=t%bbe,s=o%i,l=o+s;t+=s,0!==l&&bbe-l<a&&(t+=bbe-l),r.offset=t/e,t+=a}return Math.ceil(t/bbe)*bbe}update(){let e=!1;for(const t of this.uniforms)!0===this.updateByType(t)&&(e=!0);return e}updateByType(e){return e.isNumberUniform?this.updateNumber(e):e.isVector2Uniform?this.updateVector2(e):e.isVector3Uniform?this.updateVector3(e):e.isVector4Uniform?this.updateVector4(e):e.isColorUniform?this.updateColor(e):e.isMatrix3Uniform?this.updateMatrix3(e):e.isMatrix4Uniform?this.updateMatrix4(e):void tJ("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i]!==r){this._getBufferForType(a)[i]=n[i]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y){const e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){const e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){const e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,e[i+3]=n[i+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){const e=this.buffer;e[i+0]=n[i+0]=r.r,e[i+1]=n[i+1]=r.g,e[i+2]=n[i+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){const e=this.buffer;e[i+0]=n[i+0]=r[0],e[i+1]=n[i+1]=r[1],e[i+2]=n[i+2]=r[2],e[i+4]=n[i+4]=r[3],e[i+5]=n[i+5]=r[4],e[i+6]=n[i+6]=r[5],e[i+8]=n[i+8]=r[6],e[i+9]=n[i+9]=r[7],e[i+10]=n[i+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(!1===function(e,t,n){for(let r=0,i=t.length;r<i;r++)if(e[n+r]!==t[r])return!1;return!0}(n,r,i)){this.buffer.set(r,i),function(e,t,n){for(let r=0,i=t.length;r<i;r++)e[n+r]=t[r]}(n,r,i),t=!0}return t}_getBufferForType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e?new Int32Array(this.buffer.buffer):"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e?new Uint32Array(this.buffer.buffer):this.buffer}}let MEe=0;class EEe extends CEe{constructor(e,t){super(e),this.id=MEe++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class PEe extends xEe{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version&&(this.version=e.version,!0)}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let NEe=0;class kEe extends PEe{constructor(e,t){super(e,t),this.id=NEe++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class REe extends kEe{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class LEe extends REe{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class OEe extends REe{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const jEe={bitcast_int_uint:new owe("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new owe("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},DEe={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},IEe={low:"lowp",medium:"mediump",high:"highp"},BEe={swizzleAssign:!0,storageBuffer:!1},FEe={perspective:"smooth",linear:"noperspective"},zEe={centroid:"centroid"},UEe="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\nprecision lowp sampler2DArrayShadow;\nprecision lowp samplerCubeShadow;\n";class VEe extends xMe{constructor(e,t){super(e,t,new VMe),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==CZ}_include(e){const t=jEe[e];return t.build(this),this.addInclude(t),t}getMethod(e){return void 0!==jEe[e]&&this._include(e),DEe[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const i of t.inputs)r.push(this.getType(i.type)+" "+i.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {\n\n\t${n.vars}\n\n${n.code}\n\treturn ${n.result};\n\n}`}setupPBO(e){const t=e.value;if(void 0===t.pbo){const e=t.array,n=t.count*t.itemSize,{itemSize:r}=t,i=t.array.constructor.name.toLowerCase().includes("int");let a=i?kQ:NQ;2===r?a=i?LQ:RQ:3===r?a=i?1032:CQ:4===r&&(a=i?OQ:MQ);const o={Float32Array:AQ,Uint8Array:hQ,Uint16Array:mQ,Uint32Array:vQ,Int8Array:pQ,Int16Array:fQ,Int32Array:gQ,Uint8ClampedArray:hQ},s=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/r))));let l=Math.ceil(n/r/s);s*l*r<n&&l++;const c=s*l*r,u=new e.constructor(c);u.set(e,0),t.array=u;const d=new p2(t.array,s,l,a,o[t.array.constructor.name]||AQ);d.needsUpdate=!0,d.isPBOTexture=!0;const h=new npe(d,null,null);h.setPrecision("high"),t.pboNode=h,t.pbo=h.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&!0!==e.node.isTextureNode&&!0!==e.node.isBufferNode?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){this.renderer.backend.get(r).pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(i);this.increaseUsage(n);const o=n.build(this,"uint"),s=this.getDataFromNode(e);let l=s.propertyName;if(void 0===l){const n=this.getVarFromNode(e);l=this.getPropertyName(n);const i=this.getDataFromNode(t);let c=i.propertySizeName;void 0===c&&(c=l+"Size",this.getVarFromNode(t,c,"uint"),this.addLineFlowCode(`${c} = uint( textureSize( ${a}, 0 ).x )`,e),i.propertySizeName=c);const{itemSize:u}=r,d="."+Nse.join("").slice(0,u),h=`ivec2(${o} % ${c}, ${o} / ${c})`,p=this.generateTextureLoad(null,a,h,"0",null,null);let f="vec4";r.pbo.type===vQ?f="uvec4":r.pbo.type===gQ&&(f="ivec4"),this.addLineFlowCode(`${l} = ${f}(${p})${d}`,e),s.propertyName=l}return l}generateTextureLoad(e,t,n,r,i,a){let o;return null===r&&(r="0"),o=i?a?`texelFetchOffset( ${t}, ivec3( ${n}, ${i} ), ${r}, ${a} )`:`texelFetch( ${t}, ivec3( ${n}, ${i} ), ${r} )`:a?`texelFetchOffset( ${t}, ${n}, ${r}, ${a} )`:`texelFetch( ${t}, ${n}, ${r} )`,null!==e&&e.isDepthTexture&&(o+=".x"),o}generateTexture(e,t,n,r,i){return r&&(n=`vec3( ${n}, ${r} )`),e.isDepthTexture?i?`textureOffset( ${t}, ${n}, ${i} ).x`:`texture( ${t}, ${n} ).x`:i?`textureOffset( ${t}, ${n}, ${i} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,r,i){return i?`textureLodOffset( ${t}, ${n}, ${r}, ${i} )`:`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r,i){return i?`textureOffset( ${t}, ${n}, ${i}, ${r} )`:`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r,i){return i?`textureGradOffset( ${t}, ${n}, ${r[0]}, ${r[1]}, ${i} )`:`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,i,a,o=this.shaderStage){if("fragment"===o)return e.isCubeTexture?`texture( ${t}, vec4( ${n}, ${r} ) )`:i?a?`textureOffset( ${t}, vec4( ${n}, ${i}, ${r} ), ${a} )`:`texture( ${t}, vec4( ${n}, ${i}, ${r} ) )`:a?`textureOffset( ${t}, vec3( ${n}, ${r} ), ${a} )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;tJ(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join("\n\t")}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const a of t){let t=null,i=!1;if("texture"===a.type||"texture3D"===a.type){const e=a.node.value;let n="";!0!==e.isDataTexture&&!0!==e.isData3DTexture||(e.type===vQ?n="u":e.type===gQ&&(n="i")),t="texture3D"===a.type&&!1===e.isArrayTexture?`${n}sampler3D ${a.name};`:e.compareFunction?!0===e.isArrayTexture?`sampler2DArrayShadow ${a.name};`:`sampler2DShadow ${a.name};`:!0===e.isArrayTexture||!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?`${n}sampler2DArray ${a.name};`:`${n}sampler2D ${a.name};`}else if("cubeTexture"===a.type)t=`samplerCube ${a.name};`;else if("cubeDepthTexture"===a.type)t=`samplerCubeShadow ${a.name};`;else if("buffer"===a.type){const e=a.node,n=this.getType(e.bufferType),r=e.bufferCount,i=r>0?r:"";t=`${e.name} {\n\t${n} ${a.name}[${i}];\n};\n`}else{t=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,i=!0}const o=a.node.precision;if(null!==o&&(t=IEe[o]+" "+t),i){t="\t"+t;const e=a.groupNode.name;(r[e]||(r[e]=[])).push(t)}else t="uniform "+t,n.push(t)}let i="";for(const a in r){const t=r[a];i+=this._getGLSLUniformStruct(e+"_"+a,t.join("\n"))+"\n"}return i+=n.join("\n"),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==gQ){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;!1===(r instanceof Uint32Array||r instanceof Int32Array)&&(t=t.slice(1))}return t}getAttributes(e){let t="";if("vertex"===e||"compute"===e){const e=this.getAttributesArray();let n=0;for(const r of e)t+=`layout( location = ${n++} ) in ${r.type} ${r.name};\n`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`\t${n.type} ${n.name};`);return t.join("\n")}getStructs(e){const t=[],n=this.structs[e],r=[];for(const i of n)if(i.output)for(const e of i.members)r.push(`layout( location = ${e.index} ) out ${e.type} ${e.name};`);else{let e="struct "+i.name+" {\n";e+=this.getStructMembers(i),e+="\n};\n",t.push(e)}return 0===r.length&&r.push("layout( location = 0 ) out vec4 fragColor;"),"\n"+r.join("\n")+"\n\n"+t.join("\n")}getVaryings(e){let t="";const n=this.varyings;if("vertex"===e||"compute"===e)for(const r of n){"compute"===e&&(r.needsInterpolation=!0);const n=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){t+=`${FEe[r.interpolationType]||r.interpolationType} ${zEe[r.interpolationSampling]||""} out ${n} ${r.name};\n`}else{t+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""}out ${n} ${r.name};\n`}else t+=`${n} ${r.name};\n`}else if("fragment"===e)for(const r of n)if(r.needsInterpolation){const e=this.getType(r.type);if(r.interpolationType){t+=`${FEe[r.interpolationType]||r.interpolationType} ${zEe[r.interpolationSampling]||""} in ${e} ${r.name};\n`}else{t+=`${e.includes("int")||e.includes("uv")||e.includes("iv")?"flat ":""}in ${e} ${r.name};\n`}}for(const r of this.builtins[e])t+=`${r};\n`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,t)=>e*t,1)}u`}getSubgroupSize(){tJ("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){tJ("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){tJ("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);!1===r.has(e)&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if("vertex"===e){const t=this.renderer.backend.extensions;this.object.isBatchedMesh&&t.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(void 0!==n)for(const{name:r,behavior:i}of n.values())t.push(`#extension ${r} : ${i}`);return t.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=BEe[e];if(void 0===t){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance"}if(void 0!==n){const e=this.renderer.backend.extensions;e.has(n)&&(e.get(n),t=!0)}BEe[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],i=this.getPropertyName(r.attributeNode);i&&(t+=`${r.varyingName} = ${i};\n\t`)}return t}_getGLSLUniformStruct(e,t){return`\nlayout( std140 ) uniform ${e} {\n${t}\n};`}_getGLSLVertexCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions\n${e.extensions}\n\n// precision\n${UEe}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// attributes\n${e.attributes}\n\n// codes\n${e.codes}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// transforms\n\t${e.transforms}\n\n\t// flow\n\t${e.flow}\n\n\tgl_PointSize = 1.0;\n\n}\n`}_getGLSLFragmentCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions\n${e.extensions}\n\n// precision\n${UEe}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// codes\n${e.codes}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n="// code\n\n";n+=this.flowCode[t];const r=this.flowNodes[t],i=r[r.length-1];for(const e of r){const r=this.getFlowData(e),a=e.name;a&&(n.length>0&&(n+="\n"),n+=`\t// flow -> ${a}\n\t`),n+=`${r.code}\n\t`,e===i&&"compute"!==t&&(n+="// result\n\t","vertex"===t?(n+="gl_Position = ",n+=`${r.result};`):"fragment"===t&&(e.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${r.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const i=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);let o=a.uniformGPU;if(void 0===o){const r=e.groupNode,s=r.name,l=this.getBindGroupArray(s,n);if("texture"===t)o=new REe(i.name,i.node,r),l.push(o);else if("cubeTexture"===t||"cubeDepthTexture"===t)o=new LEe(i.name,i.node,r),l.push(o);else if("texture3D"===t)o=new OEe(i.name,i.node,r),l.push(o);else if("buffer"===t){i.name=`buffer${e.id}`;const t=this.getSharedDataFromNode(e);let n=t.buffer;void 0===n&&(e.name=`NodeBuffer_${e.id}`,n=new TEe(e,r),n.name=e.name,t.buffer=n),l.push(n),o=n}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let a=e[s];void 0===a&&(a=new EEe(n+"_"+s,r),e[s]=a,l.push(a)),o=this.getNodeUniform(i,t),a.addUniform(o)}a.uniformGPU=o}return i}}let GEe=null,qEe=null;class WEe{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[HZ]:null,[WZ]:null},this.trackTimestamp=!0===e.trackTimestamp}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),n=this.renderer.info.frame;let r;r=!0===e.isComputeNode?"c:"+this.renderer.info.compute.frameCalls:"r:"+this.renderer.info.render.frameCalls,t.timestampUID=r+":"+e.id+":f"+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?WZ:HZ;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp)return void nJ("WebGPURenderer: Timestamp tracking is disabled.");const t=this.timestampQueryPool[e];if(!t)return;const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return GEe=GEe||new mJ,this.renderer.getDrawingBufferSize(GEe)}setScissorTest(){}getClearColor(){const e=this.renderer;return qEe=qEe||new Kbe,e.getClearColor(qEe),qEe.getRGB(qEe),qEe}getDomElement(){let e=this.domElement;return null===e&&(e=void 0!==this.parameters.canvas?this.parameters.canvas:YZ(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${nY} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let HEe,$Ee,KEe=0;class XEe{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class YEe{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,i=e.array,a=e.usage||r.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,s=n.get(o);let l,c=s.bufferGPU;if(void 0===c&&(c=this._createBuffer(r,t,i,a),s.bufferGPU=c,s.bufferType=t,s.version=o.version),i instanceof Float32Array)l=r.FLOAT;else if("undefined"!==typeof Float16Array&&i instanceof Float16Array)l=r.HALF_FLOAT;else if(i instanceof Uint16Array)l=e.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=r.SHORT;else if(i instanceof Uint32Array)l=r.UNSIGNED_INT;else if(i instanceof Int32Array)l=r.INT;else if(i instanceof Int8Array)l=r.BYTE;else if(i instanceof Uint8Array)l=r.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);l=r.UNSIGNED_BYTE}let u={bufferGPU:c,bufferType:t,type:l,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:l===r.INT||l===r.UNSIGNED_INT||e.gpuType===gQ,id:KEe++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const e=this._createBuffer(r,t,i,a);u=new XEe(u,e)}n.set(e,u)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,i=e.isInterleavedBufferAttribute?e.data:e,a=t.get(i),o=a.bufferType,s=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,a.bufferGPU),0===s.length)n.bufferSubData(o,0,r);else{for(let e=0,t=s.length;e<t;e++){const t=s[e];n.bufferSubData(o,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}i.clearUpdateRanges()}n.bindBuffer(o,null),a.version=i.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(r),a=e.array,o=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const s=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,s),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const l=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,s),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,l),n.deleteBuffer(s),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(e,t,n,r){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,n,r),e.bindBuffer(t,null),i}}class QEe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;HEe={[mY]:e.FUNC_ADD,[gY]:e.FUNC_SUBTRACT,[vY]:e.FUNC_REVERSE_SUBTRACT},$Ee={[AY]:e.ZERO,[yY]:e.ONE,[bY]:e.SRC_COLOR,[_Y]:e.SRC_ALPHA,[EY]:e.SRC_ALPHA_SATURATE,[CY]:e.DST_COLOR,[SY]:e.DST_ALPHA,[xY]:e.ONE_MINUS_SRC_COLOR,[wY]:e.ONE_MINUS_SRC_ALPHA,[MY]:e.ONE_MINUS_DST_COLOR,[TY]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=(new DJ).fromArray(t),this.currentViewport=(new DJ).fromArray(n),this._tempVec4=new DJ}enable(e){const{enabled:t}=this;!0!==t[e]&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;!1!==t[e]&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;0!==e?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,n=this.backend.drawBuffersIndexedExt;if(n)for(let r=1;r<e.length;r++)n.blendFuncSeparateiOES(r,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,n,r,i,a,o,s){const{gl:l}=this;if(0!==e){if(!1===this.currentBlendingEnabled&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),5===e)i=i||t,a=a||n,o=o||r,t===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(l.blendEquationSeparate(HEe[t],HEe[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),n===this.currentBlendSrc&&r===this.currentBlendDst&&a===this.currentBlendSrcAlpha&&o===this.currentBlendDstAlpha||(l.blendFuncSeparate($Ee[n],$Ee[r],$Ee[a],$Ee[o]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1;else if(e!==this.currentBlending||s!==this.currentPremultipledAlpha){if(this.currentBlendEquation===mY&&this.currentBlendEquationAlpha===mY||(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=mY,this.currentBlendEquationAlpha=mY),s)switch(e){case 1:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.ONE,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFuncSeparate(l.DST_COLOR,l.ONE_MINUS_SRC_ALPHA,l.ZERO,l.ONE);break;default:tJ("WebGLState: Invalid blending: ",e)}else switch(e){case 1:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE,l.ONE,l.ONE);break;case 3:tJ("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:tJ("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:tJ("WebGLState: Invalid blending: ",e)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=s}}else!0===this.currentBlendingEnabled&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1)}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(!1===this.currentScissor.equals(i)){const{gl:e}=this;e.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(!1===this.currentViewport.equals(i)){const{gl:e}=this;e.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){this.currentStencilFunc===e&&this.currentStencilRef===t&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){this.currentStencilFail===e&&this.currentStencilZFail===t&&this.currentStencilZPass===n||(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;2===e.side?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=1===e.side;t&&(i=!i),this.setFlipSided(i),1===e.blending&&!1===e.transparent?this.setBlending(0):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage&&this.backend.renderer.currentSamples>0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n){const e=12288;for(let t=0;t<8;t++)t<n?this.enable(e+t):this.disable(e+t)}}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===t&&this.currentPolygonOffsetUnits===n||(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e&&(this.gl.useProgram(e),this.currentProgram=e,!0)}setVertexState(e,t=null){const n=this.gl;return(this.currentVAO!==e||this.currentIndex!==t)&&(n.bindVertexArray(e),null!==t&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0)}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t&&(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0)}drawBuffers(e,t){const{gl:n}=this;let r=[],i=!1;if(null!==e.textures){r=this.currentDrawbuffers.get(t),void 0===r&&(r=[],this.currentDrawbuffers.set(t,r));const a=e.textures;if(r.length!==a.length||r[0]!==n.COLOR_ATTACHMENT0){for(let e=0,t=a.length;e<t;e++)r[e]=n.COLOR_ATTACHMENT0+e;r.length=a.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;void 0===e&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:i,currentBoundTextures:a,maxTextures:o}=this;void 0===n&&(n=null===i?r.TEXTURE0+o-1:i);let s=a[n];void 0===s&&(s={type:void 0,texture:void 0},a[n]=s),s.type===e&&s.texture===t||(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),s.type=e,s.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]!==n&&(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[i]=n,!0)}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];void 0!==r&&void 0!==r.type&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class ZEe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=""){const{gl:n,extensions:r}=this;let i;const a=TJ.getTransfer(t);if(e===hQ)return n.UNSIGNED_BYTE;if(e===bQ)return n.UNSIGNED_SHORT_4_4_4_4;if(e===xQ)return n.UNSIGNED_SHORT_5_5_5_1;if(e===wQ)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===SQ)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===pQ)return n.BYTE;if(e===fQ)return n.SHORT;if(e===mQ)return n.UNSIGNED_SHORT;if(e===gQ)return n.INT;if(e===vQ)return n.UNSIGNED_INT;if(e===AQ)return n.FLOAT;if(e===yQ)return n.HALF_FLOAT;if(e===TQ)return n.ALPHA;if(e===CQ)return n.RGB;if(e===MQ)return n.RGBA;if(e===EQ)return n.DEPTH_COMPONENT;if(e===PQ)return n.DEPTH_STENCIL;if(e===NQ)return n.RED;if(e===kQ)return n.RED_INTEGER;if(e===RQ)return n.RG;if(e===LQ)return n.RG_INTEGER;if(e===OQ)return n.RGBA_INTEGER;if(e===jQ||e===DQ||e===IQ||e===BQ)if(a===NZ){if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(e===jQ)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===DQ)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===IQ)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===BQ)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=r.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===jQ)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===DQ)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===IQ)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===BQ)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===FQ||e===zQ||e===UQ||e===VQ){if(i=r.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===FQ)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===zQ)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===UQ)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===VQ)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===GQ||e===qQ||e===WQ||e===HQ||e===$Q||e===KQ||e===XQ){if(i=r.get("WEBGL_compressed_texture_etc"),null===i)return null;if(e===GQ||e===qQ)return a===NZ?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===WQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(e===HQ)return i.COMPRESSED_R11_EAC;if(e===$Q)return i.COMPRESSED_SIGNED_R11_EAC;if(e===KQ)return i.COMPRESSED_RG11_EAC;if(e===XQ)return i.COMPRESSED_SIGNED_RG11_EAC}if(e===YQ||e===QQ||e===ZQ||e===JQ||e===eZ||e===tZ||e===nZ||e===rZ||e===iZ||e===aZ||e===oZ||e===sZ||e===lZ||e===cZ){if(i=r.get("WEBGL_compressed_texture_astc"),null===i)return null;if(e===YQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===QQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===ZQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===JQ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===eZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===tZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===nZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===rZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===iZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===aZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===oZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===sZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===lZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===cZ)return a===NZ?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===uZ){if(i=r.get("EXT_texture_compression_bptc"),null===i)return null;if(e===uZ)return a===NZ?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===pZ||e===fZ||e===mZ||e===gZ){if(i=r.get("EXT_texture_compression_rgtc"),null===i)return null;if(e===pZ)return i.COMPRESSED_RED_RGTC1_EXT;if(e===fZ)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===mZ)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===gZ)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===_Q?n.UNSIGNED_INT_24_8:void 0!==n[e]?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{!function i(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED)return e.deleteSync(t),void r();a!==e.TIMEOUT_EXPIRED?(e.deleteSync(t),n()):requestAnimationFrame(i)}()})}}let JEe,ePe,tPe,nPe=!1;class rPe{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,!1===nPe&&(this._init(),nPe=!0)}_init(){const e=this.gl;JEe={[rQ]:e.REPEAT,[iQ]:e.CLAMP_TO_EDGE,[aQ]:e.MIRRORED_REPEAT},ePe={[oQ]:e.NEAREST,[sQ]:e.NEAREST_MIPMAP_NEAREST,[lQ]:e.NEAREST_MIPMAP_LINEAR,[cQ]:e.LINEAR,[uQ]:e.LINEAR_MIPMAP_NEAREST,[dQ]:e.LINEAR_MIPMAP_LINEAR},tPe={[RZ]:e.NEVER,[FZ]:e.ALWAYS,[LZ]:e.LESS,[jZ]:e.LEQUAL,[OZ]:e.EQUAL,[BZ]:e.GEQUAL,[DZ]:e.GREATER,[IZ]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return n=!0===e.isCubeTexture?t.TEXTURE_CUBE_MAP:!0===e.isArrayTexture||!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:!0===e.isData3DTexture?t.TEXTURE_3D:t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,i=!1){const{gl:a,extensions:o}=this;if(null!==e){if(void 0!==a[e])return a[e];eJ("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let s=t;if(t===a.RED&&(n===a.FLOAT&&(s=a.R32F),n===a.HALF_FLOAT&&(s=a.R16F),n===a.UNSIGNED_BYTE&&(s=a.R8),n===a.UNSIGNED_SHORT&&(s=a.R16),n===a.UNSIGNED_INT&&(s=a.R32UI),n===a.BYTE&&(s=a.R8I),n===a.SHORT&&(s=a.R16I),n===a.INT&&(s=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.R8UI),n===a.UNSIGNED_SHORT&&(s=a.R16UI),n===a.UNSIGNED_INT&&(s=a.R32UI),n===a.BYTE&&(s=a.R8I),n===a.SHORT&&(s=a.R16I),n===a.INT&&(s=a.R32I)),t===a.RG&&(n===a.FLOAT&&(s=a.RG32F),n===a.HALF_FLOAT&&(s=a.RG16F),n===a.UNSIGNED_BYTE&&(s=a.RG8),n===a.UNSIGNED_SHORT&&(s=a.RG16),n===a.UNSIGNED_INT&&(s=a.RG32UI),n===a.BYTE&&(s=a.RG8I),n===a.SHORT&&(s=a.RG16I),n===a.INT&&(s=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RG8UI),n===a.UNSIGNED_SHORT&&(s=a.RG16UI),n===a.UNSIGNED_INT&&(s=a.RG32UI),n===a.BYTE&&(s=a.RG8I),n===a.SHORT&&(s=a.RG16I),n===a.INT&&(s=a.RG32I)),t===a.RGB){const e=i?PZ:TJ.getTransfer(r);n===a.FLOAT&&(s=a.RGB32F),n===a.HALF_FLOAT&&(s=a.RGB16F),n===a.UNSIGNED_BYTE&&(s=a.RGB8),n===a.UNSIGNED_SHORT&&(s=a.RGB16),n===a.UNSIGNED_INT&&(s=a.RGB32UI),n===a.BYTE&&(s=a.RGB8I),n===a.SHORT&&(s=a.RGB16I),n===a.INT&&(s=a.RGB32I),n===a.UNSIGNED_BYTE&&(s=e===NZ?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(s=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(s=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(s=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(s=a.RGB9_E5),n===a.UNSIGNED_INT_10F_11F_11F_REV&&(s=a.R11F_G11F_B10F)}if(t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RGB8UI),n===a.UNSIGNED_SHORT&&(s=a.RGB16UI),n===a.UNSIGNED_INT&&(s=a.RGB32UI),n===a.BYTE&&(s=a.RGB8I),n===a.SHORT&&(s=a.RGB16I),n===a.INT&&(s=a.RGB32I)),t===a.RGBA){const e=i?PZ:TJ.getTransfer(r);n===a.FLOAT&&(s=a.RGBA32F),n===a.HALF_FLOAT&&(s=a.RGBA16F),n===a.UNSIGNED_BYTE&&(s=a.RGBA8),n===a.UNSIGNED_SHORT&&(s=a.RGBA16),n===a.UNSIGNED_INT&&(s=a.RGBA32UI),n===a.BYTE&&(s=a.RGBA8I),n===a.SHORT&&(s=a.RGBA16I),n===a.INT&&(s=a.RGBA32I),n===a.UNSIGNED_BYTE&&(s=e===NZ?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(s=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(s=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(s=a.RGBA16UI),n===a.UNSIGNED_INT&&(s=a.RGBA32UI),n===a.BYTE&&(s=a.RGBA8I),n===a.SHORT&&(s=a.RGBA16I),n===a.INT&&(s=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(s=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(s=a.DEPTH_COMPONENT24),n===a.FLOAT&&(s=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(s=a.DEPTH24_STENCIL8),s!==a.R16F&&s!==a.R32F&&s!==a.RG16F&&s!==a.RG32F&&s!==a.RGBA16F&&s!==a.RGBA32F||o.get("EXT_color_buffer_float"),s}setTextureParameters(e,t){const{gl:n,extensions:r,backend:i}=this,a=TJ.getPrimaries(TJ.workingColorSpace),o=t.colorSpace===CZ?null:TJ.getPrimaries(t.colorSpace),s=t.colorSpace===CZ||a===o?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,s),n.texParameteri(e,n.TEXTURE_WRAP_S,JEe[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,JEe[t.wrapT]),e!==n.TEXTURE_3D&&e!==n.TEXTURE_2D_ARRAY||t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,JEe[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,ePe[t.magFilter]);const l=void 0!==t.mipmaps&&t.mipmaps.length>0,c=t.minFilter===cQ&&l?dQ:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,ePe[c]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,tPe[t.compareFunction])),!0===r.has("EXT_texture_filter_anisotropic")){if(t.magFilter===oQ)return;if(t.minFilter!==lQ&&t.minFilter!==dQ)return;if(t.type===AQ&&!1===r.has("OES_texture_float_linear"))return;if(t.anisotropy>1){const a=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(e);let a=r[i];void 0===a&&(a=t.createTexture(),n.state.bindTexture(i,a),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),r[i]=a),n.set(e,{textureGPU:a,glTextureType:i})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:i,width:a,height:o,depth:s}=t,l=r.utils.convert(e.format,e.colorSpace),c=r.utils.convert(e.type),u=this.getInternalFormat(e.internalFormat,l,c,e.colorSpace,e.isVideoTexture),d=n.createTexture(),h=this.getGLTextureType(e);r.state.bindTexture(h,d),this.setTextureParameters(h,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,u,a,o,s):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,u,a,o,s):e.isVideoTexture||n.texStorage2D(h,i,u,a,o),r.set(e,{textureGPU:d,glTextureType:h,glFormat:l,glType:c,glInternalFormat:u})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:i,glTextureType:a,glFormat:o,glType:s}=r.get(t),{width:l,height:c}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,l,c,o,s,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:i}=t,{textureGPU:a,glTextureType:o,glFormat:s,glType:l,glInternalFormat:c}=this.backend.get(e);if(!e.isRenderTargetTexture&&void 0!==a)if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const r=e.mipmaps,i=t.image;for(let t=0;t<r.length;t++){const a=r[t];e.isCompressedArrayTexture?e.format!==n.RGBA?null!==s?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,a.width,a.height,i.depth,s,a.data):eJ("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,a.width,a.height,i.depth,s,l,a.data):null!==s?n.compressedTexSubImage2D(n.TEXTURE_2D,t,0,0,a.width,a.height,s,a.data):eJ("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const a=t.images,o=e.mipmaps;for(let e=0;e<6;e++){const t=iPe(a[e]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,r,i,s,l,t);for(let r=0;r<o.length;r++){const t=iPe(o[r].images[e]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,t.width,t.height,s,l,t)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const r=t.image;if(e.layerUpdates.size>0){const t=x5(r.width,r.height,e.format,e.type);for(const i of e.layerUpdates){const e=r.data.subarray(i*t/r.data.BYTES_PER_ELEMENT,(i+1)*t/r.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,i,r.width,r.height,1,s,l,e)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,r.width,r.height,r.depth,s,l,r.data)}else if(e.isData3DTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,s,l,e.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,c,s,l,t.image);else{const a=e.mipmaps;if(a.length>0)for(let e=0,t=a.length;e<t;e++){const t=a[e],r=iPe(t);n.texSubImage2D(o,e,0,0,t.width,t.height,s,l,r)}else{const e=iPe(t.image);n.texSubImage2D(o,0,0,0,r,i,s,l,e)}}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(e);n.state.bindTexture(i,r),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const e in r.framebuffers)t.deleteFramebuffer(r.framebuffers[e]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let e=0;e<r.msaaRenderbuffers.length;e++)t.deleteRenderbuffer(r.msaaRenderbuffers[e]);delete r.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:n,backend:r}=this,{textureGPU:i,renderTarget:a}=r.get(e);this.deallocateRenderBuffers(a),!1===t&&n.deleteTexture(i),r.delete(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){const{gl:o,backend:s}=this,{state:l}=this.backend,{textureGPU:c,glTextureType:u,glType:d,glFormat:h}=s.get(t);let p,f,m,g,v,A,y,b,x;l.bindTexture(u,c);const _=e.isCompressedTexture?e.mipmaps[a]:e.image;if(null!==n)p=n.max.x-n.min.x,f=n.max.y-n.min.y,m=n.isBox3?n.max.z-n.min.z:1,g=n.min.x,v=n.min.y,A=n.isBox3?n.min.z:0;else{const t=Math.pow(2,-i);p=Math.floor(_.width*t),f=Math.floor(_.height*t),m=e.isDataArrayTexture||e.isArrayTexture?_.depth:e.isData3DTexture?Math.floor(_.depth*t):1,g=0,v=0,A=0}null!==r?(y=r.x,b=r.y,x=r.z):(y=0,b=0,x=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const w=o.getParameter(o.UNPACK_ROW_LENGTH),S=o.getParameter(o.UNPACK_IMAGE_HEIGHT),T=o.getParameter(o.UNPACK_SKIP_PIXELS),C=o.getParameter(o.UNPACK_SKIP_ROWS),M=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,_.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,_.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,g),o.pixelStorei(o.UNPACK_SKIP_ROWS,v),o.pixelStorei(o.UNPACK_SKIP_IMAGES,A);const E=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,P=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const n=s.get(e),r=s.get(t),u=s.get(n.renderTarget),d=s.get(r.renderTarget),h=u.framebuffers[n.cacheKey],_=d.framebuffers[r.cacheKey];l.bindFramebuffer(o.READ_FRAMEBUFFER,h),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,_);for(let e=0;e<m;e++)E&&(o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,n.textureGPU,i,A+e),o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,c,a,x+e)),o.blitFramebuffer(g,v,p,f,y,b,p,f,o.DEPTH_BUFFER_BIT,o.NEAREST);l.bindFramebuffer(o.READ_FRAMEBUFFER,null),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else if(0!==i||e.isRenderTargetTexture||s.has(e)){const t=s.get(e);null===this._srcFramebuffer&&(this._srcFramebuffer=o.createFramebuffer()),null===this._dstFramebuffer&&(this._dstFramebuffer=o.createFramebuffer()),l.bindFramebuffer(o.READ_FRAMEBUFFER,this._srcFramebuffer),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let e=0;e<m;e++)E?o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,t.textureGPU,i,A+e):o.framebufferTexture2D(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t.textureGPU,i),P?o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,c,a,x+e):o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,c,a),0!==i?o.blitFramebuffer(g,v,p,f,y,b,p,f,o.COLOR_BUFFER_BIT,o.NEAREST):P?o.copyTexSubImage3D(u,a,y,b,x+e,g,v,p,f):o.copyTexSubImage2D(u,a,y,b,g,v,p,f);l.bindFramebuffer(o.READ_FRAMEBUFFER,null),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else P?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(u,a,y,b,x,p,f,m,h,d,_.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(u,a,y,b,x,p,f,m,h,_.data):o.texSubImage3D(u,a,y,b,x,p,f,m,h,d,_):e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,a,y,b,p,f,h,d,_.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,a,y,b,_.width,_.height,h,_.data):o.texSubImage2D(o.TEXTURE_2D,a,y,b,p,f,h,d,_);o.pixelStorei(o.UNPACK_ROW_LENGTH,w),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,S),o.pixelStorei(o.UNPACK_SKIP_PIXELS,T),o.pixelStorei(o.UNPACK_SKIP_ROWS,C),o.pixelStorei(o.UNPACK_SKIP_IMAGES,M),0===a&&t.generateMipmaps&&o.generateMipmap(u),l.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:i}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:s,z:l,w:c}=n,u=!0===e.isDepthTexture||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(u){const n=0!==o||0!==s;let u,h;if(!0===e.isDepthTexture?(u=r.DEPTH_BUFFER_BIT,h=r.DEPTH_ATTACHMENT,t.stencil&&(u|=r.STENCIL_BUFFER_BIT)):(u=r.COLOR_BUFFER_BIT,h=r.COLOR_ATTACHMENT0),n){const e=this.backend.get(t.renderTarget),n=e.framebuffers[t.getCacheKey()],h=e.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,n),i.bindFramebuffer(r.READ_FRAMEBUFFER,h);const p=d-s-c;r.blitFramebuffer(o,p,o+l,p+c,o,p,o+l,p+c,u,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,n),i.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,p,l,c),i.unbindTexture()}else{const e=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,e),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,h,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,l,c,0,0,l,c,u,r.NEAREST),r.deleteFramebuffer(e)}}else i.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,d-c-s,l,c),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:i}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:s,stencilBuffer:l,width:c,height:u}=a;if(i.bindRenderbuffer(i.RENDERBUFFER,e),s&&!l){let t=i.DEPTH_COMPONENT24;if(!0===r){this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,a.samples,t,c,u)}else n>0?(o&&o.isDepthTexture&&o.type===i.FLOAT&&(t=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,t,c,u)):i.renderbufferStorage(i.RENDERBUFFER,t,c,u);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else s&&l&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,c,u):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,c,u),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,r,i,a){const{backend:o,gl:s}=this,{textureGPU:l,glFormat:c,glType:u}=this.backend.get(e),d=s.createFramebuffer();o.state.bindFramebuffer(s.READ_FRAMEBUFFER,d);const h=e.isCubeTexture?s.TEXTURE_CUBE_MAP_POSITIVE_X+a:s.TEXTURE_2D;s.framebufferTexture2D(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,h,l,0);const p=this._getTypedArrayType(u),f=r*i*this._getBytesPerTexel(u,c),m=s.createBuffer();s.bindBuffer(s.PIXEL_PACK_BUFFER,m),s.bufferData(s.PIXEL_PACK_BUFFER,f,s.STREAM_READ),s.readPixels(t,n,r,i,c,u,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const g=new p(f/p.BYTES_PER_ELEMENT);return s.bindBuffer(s.PIXEL_PACK_BUFFER,m),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,g),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),o.state.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.deleteFramebuffer(d),g}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;return e===n.UNSIGNED_BYTE&&(r=1),e!==n.UNSIGNED_SHORT_4_4_4_4&&e!==n.UNSIGNED_SHORT_5_5_5_1&&e!==n.UNSIGNED_SHORT_5_6_5&&e!==n.UNSIGNED_SHORT&&e!==n.HALF_FLOAT||(r=2),e!==n.UNSIGNED_INT&&e!==n.FLOAT||(r=4),t===n.RGBA?4*r:t===n.RGB?3*r:t===n.ALPHA?r:void 0}dispose(){const{gl:e}=this;null!==this._srcFramebuffer&&e.deleteFramebuffer(this._srcFramebuffer),null!==this._dstFramebuffer&&e.deleteFramebuffer(this._dstFramebuffer)}}function iPe(e){return e.isDataTexture?e.image.data:"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e:e.data}class aPe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return void 0===t&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class oPe{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const sPe={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class lPe{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:i,type:a,info:o,index:s}=this;0!==s?n.drawElements(r,t,a,e):n.drawArrays(r,e,t),o.update(i,t,1)}renderInstances(e,t,n){const{gl:r,mode:i,type:a,index:o,object:s,info:l}=this;0!==n&&(0!==o?r.drawElementsInstanced(i,t,a,e,n):r.drawArraysInstanced(i,e,t,n),l.update(s,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:i,object:a,info:o}=this;if(0===n)return;const s=r.get("WEBGL_multi_draw");if(null===s)for(let l=0;l<n;l++)this.render(e[l],t[l]);else{0!==this.index?s.multiDrawElementsWEBGL(i,t,0,this.type,e,0,n):s.multiDrawArraysWEBGL(i,e,0,t,0,n);let r=0;for(let e=0;e<n;e++)r+=t[e];o.update(a,r,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:i,mode:a,object:o,info:s}=this;if(0===n)return;const l=i.get("WEBGL_multi_draw");if(null===l)for(let c=0;c<n;c++)this.renderInstances(e[c],t[c],r[c]);else{0!==this.index?l.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,r,0,n):l.multiDrawArraysInstancedWEBGL(a,e,0,t,0,r,0,n);let i=0;for(let e=0;e<n;e++)i+=t[e]*r[e];s.update(o,i,1)}}}class cPe{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return void 0===t&&(eJ(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class uPe extends cPe{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext)return eJ("EXT_disjoint_timer_query not supported; timestamps will be disabled."),void(this.trackTimestamp=!1);this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return nJ(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(null==t)return;if(null!==this.activeQuery)return;const n=this.queries[t];if(n)try{"inactive"===this.queryStates.get(t)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(or){tJ("Error in beginQuery:",or),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(null!=t&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(or){tJ("Error in endQuery:",or),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[i,a]of this.queryOffsets){if("ended"===this.queryStates.get(a)){const t=this.queries[a];e.set(i,this.resolveQuery(t))}}if(0===e.size)return this.lastValue;const t={},n=[];for(const[i,a]of e){const e=i.match(/^(.*):f(\d+)$/),r=parseInt(e[2]);!1===n.includes(r)&&n.push(r),void 0===t[r]&&(t[r]=0);const o=await a;this.timestamps.set(i,o),t[r]+=o}const r=t[n[n.length-1]];return this.lastValue=r,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(or){return tJ("Error resolving queries:",or),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed)return void t(this.lastValue);let n,r=!1;const i=e=>{r||(r=!0,n&&(clearTimeout(n),n=null),t(e))},a=()=>{if(this.isDisposed)i(this.lastValue);else try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void i(this.lastValue);if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE))return void(n=setTimeout(a,1));const r=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(r)/1e6)}catch(or){tJ("Error checking query:",or),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class dPe extends WEe{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=void 0!==t.context?t.context:e.domElement.getContext("webgl2",n);function i(t){t.preventDefault();const n={api:"WebGL",message:t.statusMessage||"Unknown reason",reason:null,originalEvent:t};e.onDeviceLost(n)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=r,this.extensions=new aPe(this),this.capabilities=new oPe(this),this.attributeUtils=new YEe(this),this.textureUtils=new rPe(this),this.bufferRenderer=new lPe(this),this.state=new QEe(this),this.utils=new ZEe(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return GZ}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),null!==n){const t=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:t}),!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!0===e._autoAllocateDepthBuffer&&!1===e.multiview&&eJ("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new uPe(this.gl,e,2048));const n=this.timestampQueryPool[e];null!==n.allocateQueriesForContext(t)&&n.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:e,height:n}=this.getDrawingBufferSize();t.viewport(0,0,e,n)}if(e.scissor){const{x:n,y:r,width:i,height:a}=e.scissorValue;t.scissor(n,e.height-a-r,i,a)}this.initTimestampQuery(HZ,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),i=r.previousContext;n.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(null!==o)for(let s=0;s<o.length;s++){const e=o[s];e.generateMipmaps&&this.generateMipmaps(e)}if(this._currentContext=i,this._resolveRenderTarget(e),null!==i)if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:e,height:t}=this.getDrawingBufferSize();n.viewport(0,0,e,t)}this.prepareTimestampBuffer(HZ,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const e=new WeakSet,{gl:i}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let o=0;for(let t=0;t<n.length;t++){const a=n[t];null!==a&&(i.getQueryParameter(a,i.QUERY_RESULT_AVAILABLE)&&(0===i.getQueryParameter(a,i.QUERY_RESULT)&&e.add(r[t]),n[t]=null,i.deleteQuery(a),o++))}o<n.length?requestAnimationFrame(a):t.occluded=e};a()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:i,height:a}=e.viewportValue;t.viewport(n,e.height-a-r,i,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,i=!0,a=!0){const{gl:o,renderer:s}=this;if(null===r){r={textures:null,clearColorValue:this.getClearColor()}}let l=0;if(e&&(l|=o.COLOR_BUFFER_BIT),t&&(l|=o.DEPTH_BUFFER_BIT),n&&(l|=o.STENCIL_BUFFER_BIT),0!==l){let c;c=r.clearColorValue?r.clearColorValue:this.getClearColor();const u=s.getClearDepth(),d=s.getClearStencil();if(t&&this.state.setDepthMask(!0),null===r.textures)o.clearColor(c.r,c.g,c.b,c.a),o.clear(l);else{if(i&&this._setFramebuffer(r),e)for(let e=0;e<r.textures.length;e++)0===e?o.clearBufferfv(o.COLOR,e,[c.r,c.g,c.b,c.a]):o.clearBufferfv(o.COLOR,e,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,u,d):t?o.clearBufferfv(o.DEPTH,0,[u]):n&&o.clearBufferiv(o.STENCIL,0,[d]),i&&a&&this._resolveRenderTarget(r)}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(WZ,this.getTimestampUID(e))}compute(e,t,n,r,i=null){const{state:a,gl:o}=this;!1===this.discard&&(a.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:s,transformBuffers:l,attributes:c}=this.get(r),u=this._getVaoKey(c),d=this.vaoCache[u];void 0===d?this.vaoCache[u]=this._createVao(c):a.setVertexState(d),a.useProgram(s),this._bindUniforms(n);const h=this._getTransformFeedback(l);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,h),o.beginTransformFeedback(o.POINTS),i=null!==i?i:t.count,Array.isArray(i)?(nJ("WebGLBackend.compute(): The count parameter must be a single number, not an array."),i=i[0]):i&&"object"===typeof i&&i.isIndirectStorageBufferAttribute&&(nJ("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),i=t.count),c[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,i):o.drawArrays(o.POINTS,0,i),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let p=0;p<l.length;p++){const e=l[p];e.pbo&&this.has(e.pbo)&&this.textureUtils.copyBufferToTexture(e.transformBuffer,e.pbo),e.switchBuffers()}}finishCompute(e){const{state:t,gl:n}=this;this.discard=!1,t.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(WZ,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:i,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(n),{gl:s,state:l}=this,c=this.get(i),u=e.getDrawParameters();if(null===u)return;this._bindUniforms(e.getBindings());const d=t.isMesh&&t.matrixWorld.determinant()<0;l.setMaterial(r,d,a),null!==i.textures&&i.textures.length>1&&l.setMRTBlending(i.textures),l.useProgram(o);const h=e.getAttributes(),p=this.get(h);let f=p.vaoGPU;if(void 0===f){const e=this._getVaoKey(h);f=this.vaoCache[e],void 0===f&&(f=this._createVao(h),this.vaoCache[e]=f,p.vaoGPU=f)}const m=e.getIndex(),g=null!==m?this.get(m).bufferGPU:null;l.setVertexState(f,g);const v=c.lastOcclusionObject;if(v!==t&&void 0!==v){if(null!==v&&!0===v.occlusionTest&&(s.endQuery(s.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),!0===t.occlusionTest){const e=s.createQuery();s.beginQuery(s.ANY_SAMPLES_PASSED,e),c.occlusionQueries[c.occlusionQueryIndex]=e,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const A=this.bufferRenderer;t.isPoints?A.mode=s.POINTS:t.isLineSegments?A.mode=s.LINES:t.isLine?A.mode=s.LINE_STRIP:t.isLineLoop?A.mode=s.LINE_LOOP:!0===r.wireframe?(l.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),A.mode=s.LINES):A.mode=s.TRIANGLES;const{vertexCount:y,instanceCount:b}=u;let{firstVertex:x}=u;if(A.object=t,null!==m){x*=m.array.BYTES_PER_ELEMENT;const e=this.get(m);A.index=m.count,A.type=e.type}else A.index=0;const _=()=>{t.isBatchedMesh?null!==t._multiDrawInstances?(nJ("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),A.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?A.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):nJ("WebGLBackend: WEBGL_multi_draw not supported."):b>1?A.renderInstances(x,y,b):A.render(x,y)};if(!0===e.camera.isArrayCamera&&e.camera.cameras.length>0&&!1===e.camera.isMultiViewCamera){const n=this.get(e.camera),r=e.camera.cameras,i=e.getBindingGroup("cameraIndex").bindings[0];if(void 0===n.indexesGPU||n.indexesGPU.length!==r.length){const e=new Uint32Array([0,0,0,0]),t=[];for(let n=0,i=r.length;n<i;n++){const r=s.createBuffer();e[0]=n,s.bindBuffer(s.UNIFORM_BUFFER,r),s.bufferData(s.UNIFORM_BUFFER,e,s.STATIC_DRAW),t.push(r)}n.indexesGPU=t}const a=this.get(i),o=this.renderer.getPixelRatio(),c=this._currentContext.renderTarget,u=this._isRenderCameraDepthArray(this._currentContext),d=this._currentContext.activeCubeFace;if(u){const e=this.get(c.depthTexture);if(e.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){e.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:t}=c;for(let e=0,n=r.length;e<n;e++)this.renderer._activeCubeFace=e,this._currentContext.activeCubeFace=e,this._setFramebuffer(this._currentContext),this.clear(!1,!0,t,this._currentContext,!1,!1);this.renderer._activeCubeFace=d,this._currentContext.activeCubeFace=d}}for(let h=0,p=r.length;h<p;h++){const i=r[h];if(t.layers.test(i.layers)){u&&(this.renderer._activeCubeFace=h,this._currentContext.activeCubeFace=h,this._setFramebuffer(this._currentContext));const t=i.viewport;if(void 0!==t){const n=t.x*o,r=t.y*o,i=t.width*o,a=t.height*o;l.viewport(Math.floor(n),Math.floor(e.context.height-a-r),Math.floor(i),Math.floor(a))}l.bindBufferBase(s.UNIFORM_BUFFER,a.index,n.indexesGPU[h]),_()}this._currentContext.activeCubeFace=d,this.renderer._activeCubeFace=d}}else _()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,i,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,a)}updateSampler(){return""}createNodeBuilder(e,t){return new VEe(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,i="fragment"===n?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:i,vertexProgram:a}=r,o=n.createProgram(),s=this.get(i).shaderGPU,l=this.get(a).shaderGPU;if(n.attachShader(o,s),n.attachShader(o,l),n.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:s,vertexShader:l}),null!==t&&this.parallel){const i=new Promise(t=>{const i=this.parallel,a=()=>{n.getProgramParameter(o,i.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),t()):requestAnimationFrame(a)};a()});return void t.push(i)}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push(`${e===t?">":" "} ${e}: ${n[o]}`)}return r.join("\n")}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=(e.getShaderInfoLog(t)||"").trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+this._handleSource(e.getShaderSource(t),r)}return i}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,i=(r.getProgramInfoLog(e)||"").trim();if(!1===r.getProgramParameter(e,r.LINK_STATUS))if("function"===typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(r,e,n,t);else{const a=this._getShaderErrors(r,n,"vertex"),o=this._getShaderErrors(r,t,"fragment");tJ("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+a+"\n"+o)}else""!==i&&eJ("WebGLProgram: Program Info Log:",i)}}_completeCompile(e,t){const{state:n,gl:r}=this,i=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:s}=i;!1===r.getProgramParameter(a,r.LINK_STATUS)&&this._logProgramError(a,o,s),n.useProgram(a);const l=e.getBindings();this._setupBindings(l,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:n,gl:r}=this,i={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(i);const{computeProgram:a}=e,o=r.createProgram(),s=this.get(i).shaderGPU,l=this.get(a).shaderGPU,c=a.transforms,u=[],d=[];for(let m=0;m<c.length;m++){const e=c[m];u.push(e.varyingName),d.push(e.attributeNode)}r.attachShader(o,s),r.attachShader(o,l),r.transformFeedbackVaryings(o,u,r.SEPARATE_ATTRIBS),r.linkProgram(o),!1===r.getProgramParameter(o,r.LINK_STATUS)&&this._logProgramError(o,s,l),n.useProgram(o),this._setupBindings(t,o);const h=a.attributes,p=[],f=[];for(let m=0;m<h.length;m++){const e=h[m].node.attribute;p.push(e),this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER)}for(let m=0;m<d.length;m++){const e=d[m].attribute;this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER);const t=this.get(e);f.push(t)}this.set(e,{programGPU:o,transformBuffers:f,attributes:p})}createBindings(e,t){if(!1===this._knownBindings.has(t)){this._knownBindings.add(t);let e=0,n=0;for(const r of t){this.set(r,{textures:n,uniformBuffers:e});for(const t of r.bindings)t.isUniformBuffer&&e++,t.isSampledTexture&&n++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,i=n.textures;for(const a of e.bindings){const e=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const n=a.buffer;let{bufferGPU:i}=this.get(n);void 0===i?(i=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,n.byteLength,t.DYNAMIC_DRAW),this.set(n,{bufferGPU:i})):t.bindBuffer(t.UNIFORM_BUFFER,i);const o=a.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,i),0===o.length)t.bufferData(t.UNIFORM_BUFFER,n,t.DYNAMIC_DRAW);else{const e=KZ(n),r=e?1:n.BYTES_PER_ELEMENT;for(let i=0,a=o.length;i<a;i++){const a=o[i],s=a.start*r,l=a.count*r,c=s*(e?n.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,c,n,s,l)}}e.index=r++,e.bufferGPU=i,this.set(a,e)}else if(a.isSampledTexture){const{textureGPU:t,glTextureType:n}=this.get(a.texture);e.index=i++,e.textureGPU=t,e.glTextureType=n,this.set(a,e)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,r=e.buffer,i=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,n),0===i.length)t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW);else{const e=KZ(r),n=e?1:r.BYTES_PER_ELEMENT;for(let a=0,o=i.length;a<o;a++){const o=i[a],s=o.start*n,l=o.count*n,c=s*(e?r.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,c,r,s,l)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(sPe).filter(t=>sPe[t]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){this.textureUtils.copyTextureToTexture(e,t,n,r,i,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(null!==e.textures){const i=e.renderTarget,a=this.get(i),{samples:o,depthBuffer:s,stencilBuffer:l}=i,c=!0===i.isWebGLCubeRenderTarget,u=!0===i.isRenderTarget3D,d=i.depth>1,h=!0===i.isXRRenderTarget,p=!0===h&&!0===i._hasExternalTextures;let f=a.msaaFrameBuffer,m=a.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),v=this.extensions.get("OVR_multiview2"),A=this._useMultisampledExtension(i),y=Ube(e);let b;if(c?(a.cubeFramebuffers||(a.cubeFramebuffers={}),b=a.cubeFramebuffers[y]):h&&!1===p?b=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),b=a.framebuffers[y]),void 0===b){b=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,b);const r=e.textures,s=[];if(c){a.cubeFramebuffers[y]=b;const{textureGPU:e}=this.get(r[0]),n=this.renderer._activeCubeFace,i=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,e,i)}else{a.framebuffers[y]=b;for(let n=0;n<r.length;n++){const a=r[n],s=this.get(a);s.renderTarget=e.renderTarget,s.cacheKey=y;const l=t.COLOR_ATTACHMENT0+n;if(i.multiview)v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,l,s.textureGPU,0,o,0,2);else if(u||d){const e=this.renderer._activeCubeFace,n=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,l,s.textureGPU,n,e)}else if(A)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,t.TEXTURE_2D,s.textureGPU,0,o);else{const e=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,l,t.TEXTURE_2D,s.textureGPU,e)}}}const h=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i._autoAllocateDepthBuffer){const n=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(n,e,0,A),a.xrDepthRenderbuffer=n,s.push(l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,n),t.framebufferRenderbuffer(t.FRAMEBUFFER,h,t.RENDERBUFFER,n)}else if(null!==e.depthTexture){s.push(l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const n=this.get(e.depthTexture);if(n.renderTarget=e.renderTarget,n.cacheKey=y,i.multiview)v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,h,n.textureGPU,0,o,0,2);else if(p&&A)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,h,t.TEXTURE_2D,n.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,h,n.textureGPU,0,e)}else if(e.depthTexture.isCubeTexture){const e=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,h,t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,h,t.TEXTURE_2D,n.textureGPU,0)}a.depthInvalidationArray=s}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,b);const r=this.renderer._activeCubeFace,i=this.get(e.depthTexture),a=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,a,i.textureGPU,0,r)}if((h||A||i.multiview)&&!0!==i._isOpaqueFramebuffer){n.bindFramebuffer(t.FRAMEBUFFER,b);const r=this.get(e.textures[0]);i.multiview?v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,r.textureGPU,0,o,0,2):A?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0);const s=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i._autoAllocateDepthBuffer){const e=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,e)}else{const n=this.get(e.depthTexture);i.multiview?v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,s,n.textureGPU,0,o,0,2):A?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,s,t.TEXTURE_2D,n.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,s,t.TEXTURE_2D,n.textureGPU,0)}}}if(o>0&&!1===A&&!i.multiview){if(void 0===f){const r=[];f=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,f);const i=[],c=e.textures;for(let n=0;n<c.length;n++){i[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i[n]),r.push(t.COLOR_ATTACHMENT0+n);const a=e.textures[n],s=this.get(a);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,s.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,i[n])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=f,a.msaaRenderbuffers=i,s&&void 0===m){m=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e,o),a.depthRenderbuffer=m;const n=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r.push(n)}a.invalidationArray=r}r=a.msaaFrameBuffer}else r=b;n.drawBuffers(e,b)}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){t+=":"+this.get(e[n]).id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let r=0;r<e.length;r++){const n=e[r],i=this.get(n);let a,o;t.bindBuffer(t.ARRAY_BUFFER,i.bufferGPU),t.enableVertexAttribArray(r),!0===n.isInterleavedBufferAttribute?(a=n.data.stride*i.bytesPerElement,o=n.offset*i.bytesPerElement):(a=0,o=0),i.isInteger?t.vertexAttribIPointer(r,n.itemSize,i.type,a,o):t.vertexAttribPointer(r,n.itemSize,i.type,n.normalized,a,o),n.isInstancedBufferAttribute&&!n.isInterleavedBufferAttribute?t.vertexAttribDivisor(r,n.meshPerAttribute):n.isInterleavedBufferAttribute&&n.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(r,n.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t="";for(let i=0;i<e.length;i++)t+=":"+e[i].id;let n=this.transformFeedbackCache[t];if(void 0!==n)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let i=0;i<e.length;i++){const t=e[i];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,i,t.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const e of r.bindings){const r=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){const i=n.getUniformBlockIndex(t,e.name);n.uniformBlockBinding(t,i,r)}else if(e.isSampledTexture){const i=n.getUniformLocation(t,e.name);n.uniform1i(i,r)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const e of r.bindings){const r=this.get(e),i=r.index;e.isUniformsGroup||e.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,i,r.bufferGPU):e.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,t.TEXTURE0+i)}}_resolveRenderTarget(e){const{gl:t,state:n}=this,r=e.renderTarget;if(null!==e.textures&&r){const i=this.get(r);if(r.samples>0&&!1===this._useMultisampledExtension(r)){const a=i.framebuffers[e.getCacheKey()];let o=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT));const s=i.msaaFrameBuffer,l=i.msaaRenderbuffers,c=e.textures,u=c.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,s),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),u)for(let e=0;e<c.length;e++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);for(let n=0;n<c.length;n++){if(u){const{textureGPU:e}=this.get(c[n]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,l[n]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}if(e.scissor){const{x:n,y:r,width:i,height:a}=e.scissorValue,s=e.height-a-r;t.blitFramebuffer(n,s,n+i,s+a,n,s,n+i,s+a,o,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST)}if(u)for(let e=0;e<c.length;e++){const{textureGPU:n}=this.get(c[e]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,l[e]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,n,0)}!0===this._supportsInvalidateFramebuffer&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray)}else if(!1===r.resolveDepthBuffer&&i.framebuffers){const r=i.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,r),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(e){return!0===e.multiview||e.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==e._autoAllocateDepthBuffer}dispose(){null!==this.textureUtils&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const hPe="point-list",pPe="line-list",fPe="line-strip",mPe="triangle-list",gPe="triangle-strip",vPe="undefined"!==typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},APe="never",yPe="less",bPe="equal",xPe="less-equal",_Pe="greater",wPe="not-equal",SPe="greater-equal",TPe="always",CPe="store",MPe="load",EPe="clear",PPe="ccw",NPe="cw",kPe="none",RPe="back",LPe="uint16",OPe="uint32",jPe="r8unorm",DPe="r8snorm",IPe="r8uint",BPe="r8sint",FPe="r16uint",zPe="r16sint",UPe="r16float",VPe="rg8unorm",GPe="rg8snorm",qPe="rg8uint",WPe="rg8sint",HPe="r32uint",$Pe="r32sint",KPe="r32float",XPe="rg16uint",YPe="rg16sint",QPe="rg16float",ZPe="rgba8unorm",JPe="rgba8unorm-srgb",eNe="rgba8snorm",tNe="rgba8uint",nNe="rgba8sint",rNe="bgra8unorm",iNe="bgra8unorm-srgb",aNe="rgb9e5ufloat",oNe="rgb10a2unorm",sNe="rg11b10ufloat",lNe="rg32uint",cNe="rg32sint",uNe="rg32float",dNe="rgba16uint",hNe="rgba16sint",pNe="rgba16float",fNe="rgba32uint",mNe="rgba32sint",gNe="rgba32float",vNe="depth16unorm",ANe="depth24plus",yNe="depth24plus-stencil8",bNe="depth32float",xNe="depth32float-stencil8",_Ne="bc1-rgba-unorm",wNe="bc1-rgba-unorm-srgb",SNe="bc2-rgba-unorm",TNe="bc2-rgba-unorm-srgb",CNe="bc3-rgba-unorm",MNe="bc3-rgba-unorm-srgb",ENe="bc4-r-unorm",PNe="bc4-r-snorm",NNe="bc5-rg-unorm",kNe="bc5-rg-snorm",RNe="bc6h-rgb-ufloat",LNe="bc6h-rgb-float",ONe="bc7-rgba-unorm",jNe="bc7-rgba-unorm-srgb",DNe="etc2-rgb8unorm",INe="etc2-rgb8unorm-srgb",BNe="etc2-rgb8a1unorm",FNe="etc2-rgb8a1unorm-srgb",zNe="etc2-rgba8unorm",UNe="etc2-rgba8unorm-srgb",VNe="eac-r11unorm",GNe="eac-r11snorm",qNe="eac-rg11unorm",WNe="eac-rg11snorm",HNe="astc-4x4-unorm",$Ne="astc-4x4-unorm-srgb",KNe="astc-5x4-unorm",XNe="astc-5x4-unorm-srgb",YNe="astc-5x5-unorm",QNe="astc-5x5-unorm-srgb",ZNe="astc-6x5-unorm",JNe="astc-6x5-unorm-srgb",eke="astc-6x6-unorm",tke="astc-6x6-unorm-srgb",nke="astc-8x5-unorm",rke="astc-8x5-unorm-srgb",ike="astc-8x6-unorm",ake="astc-8x6-unorm-srgb",oke="astc-8x8-unorm",ske="astc-8x8-unorm-srgb",lke="astc-10x5-unorm",cke="astc-10x5-unorm-srgb",uke="astc-10x6-unorm",dke="astc-10x6-unorm-srgb",hke="astc-10x8-unorm",pke="astc-10x8-unorm-srgb",fke="astc-10x10-unorm",mke="astc-10x10-unorm-srgb",gke="astc-12x10-unorm",vke="astc-12x10-unorm-srgb",Ake="astc-12x12-unorm",yke="astc-12x12-unorm-srgb",bke="clamp-to-edge",xke="repeat",_ke="mirror-repeat",wke="linear",Ske="nearest",Tke="zero",Cke="one",Mke="src",Eke="one-minus-src",Pke="src-alpha",Nke="one-minus-src-alpha",kke="dst",Rke="one-minus-dst",Lke="dst-alpha",Oke="one-minus-dst-alpha",jke="src-alpha-saturated",Dke="constant",Ike="one-minus-constant",Bke="add",Fke="subtract",zke="reverse-subtract",Uke="min",Vke="max",Gke=0,qke=15,Wke="keep",Hke="zero",$ke="replace",Kke="invert",Xke="increment-clamp",Yke="decrement-clamp",Qke="increment-wrap",Zke="decrement-wrap",Jke="storage",eRe="read-only-storage",tRe="write-only",nRe="read-only",rRe="read-write",iRe="non-filtering",aRe="comparison",oRe="float",sRe="unfilterable-float",lRe="depth",cRe="sint",uRe="uint",dRe="2d",hRe="3d",pRe="2d",fRe="2d-array",mRe="cube",gRe="3d",vRe="all",ARe="vertex",yRe="instance",bRe={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},xRe={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class _Re extends PEe{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class wRe extends _Ee{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let SRe=0;class TRe extends wRe{constructor(e,t){super("StorageBuffer_"+SRe++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Cse.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class CRe extends mbe{constructor(e){super(),this.device=e;this.mipmapSampler=e.createSampler({minFilter:wke}),this.flipYSampler=e.createSampler({minFilter:Ske}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(e){let t=this.transferPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:gPe,stripIndexFormat:OPe},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:gPe,stripIndexFormat:OPe},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:i,height:a}=t.size,o=this.getTransferPipeline(r),s=this.getFlipYPipeline(r),l=this.device.createTexture({size:{width:i,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:pRe,baseArrayLayer:n}),u=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:pRe,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),h=(e,t,n)=>{const r=e.getBindGroupLayout(0),i=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:t}]}),a=d.beginRenderPass({colorAttachments:[{view:n,loadOp:EPe,storeOp:CPe,clearValue:[0,0,0,0]}]});a.setPipeline(e),a.setBindGroup(0,i),a.draw(4,1,0,0),a.end()};h(o,c,u),h(s,u,c),this.device.queue.submit([d.finish()]),l.destroy()}generateMipmaps(e,t,n=0,r=null){const i=this.get(e);void 0===i.layers&&(i.layers=[]);const a=i.layers[n]||this._mipmapCreateBundles(e,t,n),o=r||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(o,a),null===r&&this.device.queue.submit([o.finish()]),i.layers[n]=a}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),i=r.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:pRe,baseArrayLayer:n});const o=[];for(let s=1;s<t.mipLevelCount;s++){const l=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),c=e.createView({baseMipLevel:s,mipLevelCount:1,dimension:pRe,baseArrayLayer:n}),u={colorAttachments:[{view:c,loadOp:EPe,storeOp:CPe,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(r),d.setBindGroup(0,l),d.draw(4,1,0,0),o.push({renderBundles:[d.finish()],passDescriptor:u}),a=c}return o}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const n=t[r],i=e.beginRenderPass(n.passDescriptor);i.executeBundles(n.renderBundles),i.end()}}}const MRe={[RZ]:"never",[LZ]:"less",[OZ]:"equal",[jZ]:"less-equal",[DZ]:"greater",[BZ]:"greater-equal",[FZ]:"always",[IZ]:"not-equal"},ERe=[0,1,3,2,4,5];class PRe{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,n=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let r=this._samplerCache.get(n);if(void 0===r){const i={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};i.magFilter===wke&&i.minFilter===wke&&i.mipmapFilter===wke&&(i.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(i.compare=MRe[e.compareFunction]);r={sampler:t.device.createSampler(i),usedTimes:0},this._samplerCache.set(n,r)}const i=t.get(e);if(i.sampler!==r.sampler){if(void 0!==i.sampler){const e=this._samplerCache.get(i.samplerKey);e.usedTimes--,0===e.usedTimes&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=n,i.sampler=r.sampler,r.usedTimes++}return n}createDefaultTexture(e){let t;const n=NRe(e);t=e.isCubeTexture?this._getDefaultCubeTextureGPU(n):this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture)return r.texture=e.sourceTexture,void(r.initialized=!0);void 0===t.needsMipmaps&&(t.needsMipmaps=!1),void 0===t.levels&&(t.levels=1),void 0===t.depth&&(t.depth=1);const{width:i,height:a,depth:o,levels:s}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(e),c=e.internalFormat||t.format||NRe(e,n.device);r.format=c;const{samples:u,primarySamples:d,isMSAA:h}=n.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(p|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&c!==aNe&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const f={label:e.name,size:{width:i,height:a,depthOrArrayLayers:o},mipLevelCount:s,sampleCount:d,dimension:l,format:c,usage:p};if(void 0===c)return eJ("WebGPURenderer: Texture format not supported."),void this.createDefaultTexture(e);if(e.isCubeTexture&&(f.textureBindingViewDimension=mRe),r.texture=n.device.createTexture(f),h){const e=Object.assign({},f);e.label=e.label+"-msaa",e.sampleCount=u,e.mipLevelCount=1,r.msaaTexture=n.device.createTexture(e)}r.initialized=!0,r.textureDescriptorGPU=f}destroyTexture(e,t=!1){const n=this.backend,r=n.get(e);void 0!==r.texture&&!1===t&&r.texture.destroy(),void 0!==r.msaaTexture&&r.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){const n=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,r,t);else{const r=e.image.depth||1;for(let e=0;e<r;e++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,e,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:r}=e.getDrawingBufferSize(),i=e.renderer.currentSamples,a=t.colorTexture,o=e.get(a);if(a.width===n&&a.height===r&&a.samples===i)return o.texture;let s=o.texture;return s&&s.destroy(),s=e.device.createTexture({label:"colorBuffer",size:{width:n,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=n,a.source.height=r,a.samples=i,o.texture=s,s}getDepthBuffer(e=!0,t=!1){const n=this.backend,r=n.renderer.getCanvasTarget(),{width:i,height:a}=n.getDrawingBufferSize(),o=n.renderer.currentSamples,s=r.depthTexture;if(s.width===i&&s.height===a&&s.samples===o&&s.depth===e&&s.stencil===t)return n.get(s).texture;const l=n.get(s).texture;let c,u;if(t?(c=PQ,u=_Q):e&&(c=EQ,u=vQ),void 0!==l){if(s.image.width===i&&s.image.height===a&&s.format===c&&s.type===u&&s.samples===o)return l;this.destroyTexture(s)}return s.name="depthBuffer",s.format=c,s.type=u,s.image.width=i,s.image.height=a,s.samples=o,this.createTexture(s,{width:i,height:a}),n.get(s).texture}updateTexture(e,t){const n=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:i}=n;if(!e.isRenderTargetTexture&&void 0!==i){if(e.isDataTexture)if(r.length>0)for(let t=0,a=r.length;t<a;t++){const a=r[t];this._copyBufferToTexture(a,n.texture,i,0,e.flipY,0,t)}else this._copyBufferToTexture(t.image,n.texture,i,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let r=0;r<t.image.depth;r++)this._copyBufferToTexture(t.image,n.texture,i,r,e.flipY,r);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,i);else if(r.length>0)for(let t=0,a=r.length;t<a;t++){const a=r[t];this._copyImageToTexture(a,n.texture,i,0,e.flipY,e.premultiplyAlpha,t)}else this._copyImageToTexture(t.image,n.texture,i,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,r,i,a){const o=this.backend.device,s=this.backend.get(e),l=s.texture,c=s.textureDescriptorGPU.format,u=this._getBytesPerTexel(c);let d=r*u;d=256*Math.ceil(d/256);const h=o.createBuffer({size:(i-1)*d+r*u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=o.createCommandEncoder();p.copyTextureToBuffer({texture:l,origin:{x:t,y:n,z:a}},{buffer:h,bytesPerRow:d},{width:r,height:i});const f=this._getTypedArrayType(c);o.queue.submit([p.finish()]),await h.mapAsync(GPUMapMode.READ);return new f(h.getMappedRange())}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new jJ;n.minFilter=oQ,n.magFilter=oQ,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(void 0===t){const n=new r2;n.minFilter=oQ,n.magFilter=oQ,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){const r=e.images,i=e.mipmaps;for(let a=0;a<6;a++){const o=r[a],s=!0===e.flipY?ERe[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,s,e.flipY):this._copyImageToTexture(o,t,n,s,e.flipY,e.premultiplyAlpha);for(let r=0;r<i.length;r++){const o=i[r].images[a];o.isDataTexture?this._copyBufferToTexture(o.image,t,n,s,e.flipY,0,r+1):this._copyImageToTexture(o,t,n,s,e.flipY,e.premultiplyAlpha,r+1)}}}_copyImageToTexture(e,t,n,r,i,a,o=0){const s=this.backend.device,l=o>0?e.width:n.size.width,c=o>0?e.height:n.size.height;try{s.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:o,origin:{x:0,y:0,z:r},premultipliedAlpha:a},{width:l,height:c,depthOrArrayLayers:1})}catch(Zr){}}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new CRe(this.backend.device)),e}_generateMipmaps(e,t,n=0,r=null){this._getPassUtils().generateMipmaps(e,t,n,r)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,i,a=0,o=0){const s=this.backend.device,l=e.data,c=this._getBytesPerTexel(n.format),u=e.width*c;s.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:r}},l,{offset:e.width*e.height*c*a,bytesPerRow:u},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===i&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,i=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const s=e[o],l=s.width,c=s.height,u=a?n.size.depthOrArrayLayers:1,d=Math.ceil(l/i.width)*i.byteLength,h=d*Math.ceil(c/i.height);for(let e=0;e<u;e++)r.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:e}},s.data,{offset:e*h,bytesPerRow:d,rowsPerImage:Math.ceil(c/i.height)},{width:Math.ceil(l/i.width)*i.width,height:Math.ceil(c/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===_Ne||e===wNe?{byteLength:8,width:4,height:4}:e===SNe||e===TNe||e===CNe||e===MNe?{byteLength:16,width:4,height:4}:e===ENe||e===PNe?{byteLength:8,width:4,height:4}:e===NNe||e===kNe||e===RNe||e===LNe||e===ONe||e===jNe?{byteLength:16,width:4,height:4}:e===DNe||e===INe||e===BNe||e===FNe?{byteLength:8,width:4,height:4}:e===zNe||e===UNe?{byteLength:16,width:4,height:4}:e===VNe||e===GNe?{byteLength:8,width:4,height:4}:e===qNe||e===WNe||e===HNe||e===$Ne?{byteLength:16,width:4,height:4}:e===KNe||e===XNe?{byteLength:16,width:5,height:4}:e===YNe||e===QNe?{byteLength:16,width:5,height:5}:e===ZNe||e===JNe?{byteLength:16,width:6,height:5}:e===eke||e===tke?{byteLength:16,width:6,height:6}:e===nke||e===rke?{byteLength:16,width:8,height:5}:e===ike||e===ake?{byteLength:16,width:8,height:6}:e===oke||e===ske?{byteLength:16,width:8,height:8}:e===lke||e===cke?{byteLength:16,width:10,height:5}:e===uke||e===dke?{byteLength:16,width:10,height:6}:e===hke||e===pke?{byteLength:16,width:10,height:8}:e===fke||e===mke?{byteLength:16,width:10,height:10}:e===gke||e===vke?{byteLength:16,width:12,height:10}:e===Ake||e===yke?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let t=bke;return e===rQ?t=xke:e===aQ&&(t=_ke),t}_convertFilterMode(e){let t=wke;return e!==oQ&&e!==sQ&&e!==lQ||(t=Ske),t}_getBytesPerTexel(e){return e===jPe||e===DPe||e===IPe||e===BPe?1:e===FPe||e===zPe||e===UPe||e===VPe||e===GPe||e===qPe||e===WPe?2:e===HPe||e===$Pe||e===KPe||e===XPe||e===YPe||e===QPe||e===ZPe||e===JPe||e===eNe||e===tNe||e===nNe||e===rNe||e===iNe||e===aNe||e===oNe||e===sNe||e===bNe||e===ANe||e===yNe||e===xNe?4:e===lNe||e===cNe||e===uNe||e===dNe||e===hNe||e===pNe?8:e===fNe||e===mNe||e===gNe?16:void 0}_getTypedArrayType(e){return e===IPe?Uint8Array:e===BPe?Int8Array:e===jPe?Uint8Array:e===DPe?Int8Array:e===qPe?Uint8Array:e===WPe?Int8Array:e===VPe?Uint8Array:e===GPe?Int8Array:e===tNe?Uint8Array:e===nNe?Int8Array:e===ZPe||e===JPe?Uint8Array:e===eNe?Int8Array:e===FPe?Uint16Array:e===zPe?Int16Array:e===XPe?Uint16Array:e===YPe?Int16Array:e===dNe?Uint16Array:e===hNe?Int16Array:e===UPe||e===QPe||e===pNe?Uint16Array:e===HPe?Uint32Array:e===$Pe?Int32Array:e===KPe?Float32Array:e===lNe?Uint32Array:e===cNe?Int32Array:e===uNe?Float32Array:e===fNe?Uint32Array:e===mNe?Int32Array:e===gNe?Float32Array:e===rNe||e===iNe?Uint8Array:e===oNe||e===aNe||e===sNe?Uint32Array:e===bNe?Float32Array:e===ANe||e===yNe?Uint32Array:e===xNe?Float32Array:void 0}_getDimension(e){let t;return t=e.is3DTexture||e.isData3DTexture?hRe:dRe,t}}function NRe(e,t=null){const n=e.format,r=e.type,i=e.colorSpace,a=TJ.getTransfer(i);let o;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(n){case jQ:case DQ:o=a===NZ?wNe:_Ne;break;case IQ:o=a===NZ?TNe:SNe;break;case BQ:o=a===NZ?MNe:CNe;break;case pZ:o=ENe;break;case fZ:o=PNe;break;case mZ:o=NNe;break;case gZ:o=kNe;break;case uZ:o=a===NZ?jNe:ONe;break;case qQ:case GQ:o=a===NZ?INe:DNe;break;case WQ:o=a===NZ?UNe:zNe;break;case HQ:o=VNe;break;case $Q:o=GNe;break;case KQ:o=qNe;break;case XQ:o=WNe;break;case YQ:o=a===NZ?$Ne:HNe;break;case QQ:o=a===NZ?XNe:KNe;break;case ZQ:o=a===NZ?QNe:YNe;break;case JQ:o=a===NZ?JNe:ZNe;break;case eZ:o=a===NZ?tke:eke;break;case tZ:o=a===NZ?rke:nke;break;case nZ:o=a===NZ?ake:ike;break;case rZ:o=a===NZ?ske:oke;break;case iZ:o=a===NZ?cke:lke;break;case aZ:o=a===NZ?dke:uke;break;case oZ:o=a===NZ?pke:hke;break;case sZ:o=a===NZ?mke:fke;break;case lZ:o=a===NZ?vke:gke;break;case cZ:o=a===NZ?yke:Ake;break;case MQ:o=a===NZ?JPe:ZPe;break;default:tJ("WebGPURenderer: Unsupported texture format.",n)}else switch(n){case MQ:switch(r){case pQ:o=eNe;break;case fQ:o=hNe;break;case mQ:o=dNe;break;case vQ:o=fNe;break;case gQ:o=mNe;break;case hQ:o=a===NZ?JPe:ZPe;break;case yQ:o=pNe;break;case AQ:o=gNe;break;default:tJ("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case CQ:switch(r){case wQ:o=aNe;break;case SQ:o=sNe;break;default:tJ("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case NQ:switch(r){case pQ:o=DPe;break;case fQ:o=zPe;break;case mQ:o=FPe;break;case vQ:o=HPe;break;case gQ:o=$Pe;break;case hQ:o=jPe;break;case yQ:o=UPe;break;case AQ:o=KPe;break;default:tJ("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case RQ:switch(r){case pQ:o=GPe;break;case fQ:o=YPe;break;case mQ:o=XPe;break;case vQ:o=lNe;break;case gQ:o=cNe;break;case hQ:o=VPe;break;case yQ:o=QPe;break;case AQ:o=uNe;break;default:tJ("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case EQ:switch(r){case mQ:o=vNe;break;case vQ:o=ANe;break;case AQ:o=bNe;break;default:tJ("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case PQ:switch(r){case _Q:o=yNe;break;case AQ:t&&!1===t.features.has(bRe.Depth32FloatStencil8)&&tJ('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=xNe;break;default:tJ("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case kQ:switch(r){case gQ:o=$Pe;break;case vQ:o=HPe;break;default:tJ("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case LQ:switch(r){case gQ:o=cNe;break;case vQ:o=lNe;break;default:tJ("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case OQ:switch(r){case gQ:o=mNe;break;case vQ:o=fNe;break;default:tJ("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:tJ("WebGPURenderer: Unsupported texture format.",n)}return o}const kRe=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,RRe=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,LRe={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class ORe extends IMe{constructor(e){const{type:t,inputs:n,name:r,inputsCode:i,blockCode:a,outputType:o}=(e=>{const t=(e=e.trim()).match(kRe);if(null!==t&&4===t.length){const n=t[2],r=[];let i=null;for(;null!==(i=RRe.exec(n));)r.push({name:i[1],type:i[2]});const a=[];for(let e=0;e<r.length;e++){const{name:t,type:n}=r[e];let i=n;i.startsWith("ptr")?i="pointer":(i.startsWith("texture")&&(i=n.split("<")[0]),i=LRe[i]),a.push(new wMe(i,t))}const o=e.substring(t[0].length),s=t[3]||"void",l=void 0!==t[1]?t[1]:"";return{type:LRe[s]||s,inputs:a,name:l,inputsCode:n,blockCode:o,outputType:s}}throw new Error("FunctionNode: Function is not a WGSL code.")})(e);super(t,n,r),this.inputsCode=i,this.blockCode=a,this.outputType=o}getCode(e=this.name){const t="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class jRe extends DMe{parseFunction(e){return new ORe(e)}}const DRe={[Cse.READ_ONLY]:"read",[Cse.WRITE_ONLY]:"write",[Cse.READ_WRITE]:"read_write"},IRe={[rQ]:"repeat",[iQ]:"clamp",[aQ]:"mirror"},BRe={vertex:vPe.VERTEX,fragment:vPe.FRAGMENT,compute:vPe.COMPUTE},FRe={instance:!0,swizzleAssign:!1,storageBuffer:!0},zRe={"^^":"tsl_xor"},URe={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},VRe={},GRe={tsl_xor:new owe("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new owe("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new owe("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new owe("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new owe("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new owe("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new owe("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new owe("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new owe("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new owe("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new owe("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new owe("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new owe("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {\n\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},qRe={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let WRe="";!0!==("undefined"!==typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(WRe+="diagnostic( off, derivative_uniformity );\n");class HRe extends xMe{constructor(e,t){super(e,t,new jRe),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,r,i,a=this.shaderStage){return"fragment"===a?r?i?`textureSample( ${t}, ${t}_sampler, ${n}, ${r}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:i?`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,"0",r)}generateTextureSampleLevel(e,t,n,r,i,a){return!1===this.isUnfilterable(e)?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,r):this.generateTextureLod(e,t,n,i,a,r)}generateWrapFunction(e){const t=`tsl_coord_${IRe[e.wrapS]}S_${IRe[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let n=VRe[t];if(void 0===n){const r=[],i=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${i} ) -> ${i} {\n\n\treturn ${i}(\n`;const o=(e,t)=>{e===rQ?(r.push(GRe.repeatWrapping_float),a+=`\t\ttsl_repeatWrapping_float( coord.${t} )`):e===iQ?(r.push(GRe.clampWrapping_float),a+=`\t\ttsl_clampWrapping_float( coord.${t} )`):e===aQ?(r.push(GRe.mirrorWrapping_float),a+=`\t\ttsl_mirrorWrapping_float( coord.${t} )`):(a+=`\t\tcoord.${t}`,eJ(`WebGPURenderer: Unsupported texture wrap type "${e}" for vertex shader.`))};o(e.wrapS,"x"),a+=",\n",o(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(a+=",\n",o(e.wrapR,"z")),a+="\n\t);\n\n}\n",VRe[t]=n=new owe(a,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);void 0===r.dimensionsSnippet&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[n];if(void 0===r.dimensionsSnippet[n]){let a,o;const{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(e),l=s>1;o=e.is3DTexture||e.isData3DTexture?"vec3<u32>":"vec2<u32>",a=l||e.isStorageTexture?t:`${t}${n?`, u32( ${n} )`:""}`,i=new Qde(new Bhe(`textureDimensions( ${a} )`,o)),r.dimensionsSnippet[n]=i,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(r.arrayLayerCount=new Qde(new Bhe(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new Qde(new Bhe("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,n,r,i="0u"){this._include("biquadraticTexture");const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,i);return r&&(n=`${n} + vec2<f32>(${r}) / ${o}`),`tsl_biquadraticTexture( ${t}, ${a}( ${n} ), ${o}, u32( ${i} ) )`}generateTextureLod(e,t,n,r,i,a="0u"){const o=this.generateWrapFunction(e),s=this.generateTextureDimension(e,t,a),l=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";i&&(n=`${n} + ${l}<f32>(${i}) / ${l}<f32>( ${s} )`);const c=`${l}<u32>( ${o}( ${n} ) * ${l}<f32>( ${s} ) )`;return this.generateTextureLoad(e,t,c,a,r,null)}generateTextureLoad(e,t,n,r,i,a){let o;return null===r&&(r="0u"),a&&(n=`${n} + ${a}`),i?o=`textureLoad( ${t}, ${n}, ${i}, u32( ${r} ) )`:(o=`textureLoad( ${t}, ${n}, u32( ${r} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,n,r,i){let a;return a=r?`textureStore( ${t}, ${n}, ${r}, ${i} )`:`textureStore( ${t}, ${n}, ${i} )`,a}isSampleCompare(e){return!0===e.isDepthTexture&&null!==e.compareFunction}isUnfilterable(e){return"float"!==this.getComponentTypeFromTexture(e)||!this.isAvailable("float32Filterable")&&!0===e.isDataTexture&&e.type===AQ||!1===this.isSampleCompare(e)&&e.minFilter===oQ&&e.magFilter===oQ||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,i,a=this.shaderStage){let o=null;return o=this.isUnfilterable(e)?this.generateTextureLod(e,t,n,r,i,"0",a):this._generateTextureSample(e,t,n,r,i,a),o}generateTextureGrad(e,t,n,r,i,a,o=this.shaderStage){if("fragment"===o)return a?`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]}, ${a} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;tJ(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,r,i,a,o=this.shaderStage){if("fragment"===o)return!0===e.isDepthTexture&&!0===e.isArrayTexture?a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;tJ(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,r,i,a){return!1===this.isUnfilterable(e)?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,r):this.generateTextureLod(e,t,n,i,a,r)}generateTextureBias(e,t,n,r,i,a,o=this.shaderStage){if("fragment"===o)return a?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;tJ(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(!0===e.isNodeVarying&&!0===e.needsInterpolation){if("vertex"===t)return`varyings.${e.name}`}else if(!0===e.isNodeUniform){const t=e.name,n=e.type;return"texture"===n||"cubeTexture"===n||"cubeDepthTexture"===n||"storageTexture"===n||"texture3D"===n?t:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?this.isCustomStruct(e)?t:t+".value":e.groupNode.name+"."+t}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=zRe[e];return void 0!==t?(this._include(t),t):null}getNodeAccess(e,t){return"compute"!==t?!0===e.isAtomic?(eJ("WebGPURenderer: Atomic operations are only supported in compute shaders."),Cse.READ_WRITE):Cse.READ_ONLY:e.access}getStorageAccess(e,t){return DRe[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const i=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);if(void 0===a.uniformGPU){let o;const s=e.groupNode,l=s.name,c=this.getBindGroupArray(l,n);if("texture"===t||"cubeTexture"===t||"cubeDepthTexture"===t||"storageTexture"===t||"texture3D"===t){let r=null;const a=this.getNodeAccess(e,n);if("texture"===t||"storageTexture"===t?r=!0===e.value.is3DTexture?new OEe(i.name,i.node,s,a):new REe(i.name,i.node,s,a):"cubeTexture"===t||"cubeDepthTexture"===t?r=new LEe(i.name,i.node,s,a):"texture3D"===t&&(r=new OEe(i.name,i.node,s,a)),r.store=!0===e.isStorageTextureNode,r.mipLevel=r.store?e.mipLevel:0,r.setVisibility(BRe[n]),!1===this.isUnfilterable(e.value)&&!1===r.store){const e=new _Re(`${i.name}_sampler`,i.node,s);e.setVisibility(BRe[n]),c.push(e,r),o=[e,r]}else c.push(r),o=[r]}else if("buffer"===t||"storageBuffer"===t||"indirectStorageBuffer"===t){const a=this.getSharedDataFromNode(e);let l=a.buffer;if(void 0===l){l=new("buffer"===t?TEe:TRe)(e,s),a.buffer=l}l.setVisibility(l.getVisibility()|BRe[n]),c.push(l),o=l,i.name=r||"NodeBuffer_"+i.id}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let r=e[l];void 0===r&&(r=new EEe(l,s),r.setVisibility(BRe[n]),e[l]=r,c.push(r)),o=this.getNodeUniform(i,t),r.addUniform(o)}a.uniformGPU=o}return i}getBuiltin(e,t,n,r=this.shaderStage){const i=this.builtins[r]||(this.builtins[r]=new Map);return!1===i.has(e)&&i.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return void 0!==this.builtins[t]&&this.builtins[t].has(e)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(a.name+" : "+this.getType(a.type));let i=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {\n${n.vars}\n${n.code}\n`;return n.result&&(i+=`\treturn ${n.result};\n`),i+="\n}\n",i}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(void 0!==n)for(const r of n)t.push(`enable ${r};`);return t.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(void 0!==n)for(const{name:r,property:i,type:a}of n.values())t.push(`@builtin( ${r} ) ${i} : ${a}`);return t.join(",\n\t")}getScopedArray(e,t,n,r){return!1===this.scopedArrays.has(e)&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if("compute"!==e)return;const t=[];for(const{name:n,scope:r,bufferType:i,bufferCount:a}of this.scopedArrays.values()){const e=this.getType(i);t.push(`var<${r}> ${n}: array< ${e}, ${a} >;`)}return t.join("\n")}getAttributes(e){const t=[];if("compute"===e&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===e||"compute"===e){const e=this.getBuiltins("attribute");e&&t.push(e);const n=this.getAttributesArray();for(let r=0,i=n.length;r<i;r++){const e=n[r],i=e.name,a=this.getType(e.type);t.push(`@location( ${r} ) ${i} : ${a}`)}}return t.join(",\n\t")}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),t.push(`\t${r+n.name} : ${i}`)}return e.output&&t.push(`\t${this.getBuiltins("output")}`),t.join(",\n")}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const e=[];for(const t of n){let n=`struct ${t.name} {\n`;n+=this.getStructMembers(t),n+="\n};",e.push(n)}t="\n"+e.join("\n\n")+"\n"}return t}getVar(e,t,n=null){let r=`var ${t} : `;return r+=null!==n?this.generateArrayDeclaration(e,n):this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const r of n)t.push(`\t${this.getVar(r.type,r.name,r.count)};`);return`\n${t.join("\n")}\n`}getVaryings(e){const t=[];if("vertex"===e&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===e||"fragment"===e){const n=this.varyings,r=this.vars[e];for(let i=0;i<n.length;i++){const a=n[i];if(a.needsInterpolation){let e=`@location( ${i} )`;if(a.interpolationType){const t=null!==a.interpolationSampling?`, ${a.interpolationSampling} )`:" )";e+=` @interpolate( ${a.interpolationType}${t}`}else/^(int|uint|ivec|uvec)/.test(a.type)&&(e+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${e} ${a.name} : ${this.getType(a.type)}`)}else"vertex"===e&&!1===r.includes(a)&&r.push(a)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(",\n\t");return"vertex"===e?this._getWGSLStruct("VaryingsStruct","\t"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&null!==n.structTypeNode,i=n.value&&n.value.array&&"number"===typeof n.value.itemSize&&n.value.array.length>n.value.itemSize;return r&&!i}getUniforms(e){const t=this.uniforms[e],n=[],r=[],i=[],a={};for(const o of t){const t=o.groupNode.name,i=this.bindingsIndexes[t];if("texture"===o.type||"cubeTexture"===o.type||"cubeDepthTexture"===o.type||"storageTexture"===o.type||"texture3D"===o.type){const t=o.node.value;let r;!1===this.isUnfilterable(t)&&!0!==o.node.isStorageTextureNode&&(this.isSampleCompare(t)?n.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var ${o.name}_sampler : sampler_comparison;`):n.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var ${o.name}_sampler : sampler;`));let a="";const{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(t);if(s>1&&(a="_multisampled"),!0===t.isCubeTexture&&!0===t.isDepthTexture)r="texture_depth_cube";else if(!0===t.isCubeTexture)r="texture_cube<f32>";else if(!0===t.isDepthTexture)r=this.renderer.backend.compatibilityMode&&null===t.compareFunction?`texture${a}_2d<f32>`:`texture_depth${a}_2d${!0===t.isArrayTexture?"_array":""}`;else if(!0===o.node.isStorageTextureNode){const n=NRe(t),i=this.getStorageAccess(o.node,e),a=o.node.value.is3DTexture,s=o.node.value.isArrayTexture;r=`texture_storage_${a?"3d":"2d"+(s?"_array":"")}<${n}, ${i}>`}else if(!0===t.isArrayTexture||!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture)r="texture_2d_array<f32>";else if(!0===t.is3DTexture||!0===t.isData3DTexture)r="texture_3d<f32>";else{r=`texture${a}_2d<${this.getComponentTypeFromTexture(t).charAt(0)}32>`}n.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var ${o.name} : ${r};`)}else if("buffer"===o.type||"storageBuffer"===o.type||"indirectStorageBuffer"===o.type){const t=o.node,n=this.getType(t.getNodeType(this)),a=t.bufferCount,s=a>0&&"buffer"===o.type?", "+a:"",l=t.isStorageBufferNode?`storage, ${this.getStorageAccess(t,e)}`:"uniform";if(this.isCustomStruct(o))r.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var<${l}> ${o.name} : ${n};`);else{const e=`\tvalue : array< ${t.isAtomic?`atomic<${n}>`:`${n}`}${s} >`;r.push(this._getWGSLStructBinding(o.name,e,l,i.binding++,i.group))}}else{const e=this.getType(this.getVectorType(o.type)),t=o.groupNode.name;(a[t]||(a[t]={index:i.binding++,id:i.group,snippets:[]})).snippets.push(`\t${o.name} : ${e}`)}}for(const o in a){const e=a[o];i.push(this._getWGSLStructBinding(o,e.snippets.join(",\n"),"uniform",e.index,e.id))}return[...n,...r,...i].join("\n")}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r="// code\n\n";r+=this.flowCode[t];const i=this.flowNodes[t],a=i[i.length-1],o=a.outputNode,s=void 0!==o&&!0===o.isOutputStructNode;for(const e of i){const i=this.getFlowData(e),l=e.name;if(l&&(r.length>0&&(r+="\n"),r+=`\t// flow -> ${l}\n`),r+=`${i.code}\n\t`,e===a&&"compute"!==t)if(r+="// result\n\n\t","vertex"===t)r+=`varyings.Vertex = ${i.result};`;else if("fragment"===t)if(s)n.returnType=o.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${i.result};`;else{let e="\t@location(0) color: vec4<f32>";const t=this.getBuiltins("output");t&&(e+=",\n\t"+t),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",e),n.structs+="\nvar<private> output : OutputStruct;",r+=`output.color = ${i.result};\n\n\treturn output;`}}n.flow=r}if(this.shaderStage=null,null!==this.material)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return null!==t&&(n=this._getWGSLMethod(e+"_"+t)),void 0===n&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return URe[e]||e}isAvailable(e){let t=FRe[e];return void 0===t&&("float32Filterable"===e?t=this.renderer.hasFeature("float32-filterable"):"clipDistance"===e&&(t=this.renderer.hasFeature("clip-distances")),FRe[e]=t),t}_getWGSLMethod(e){return void 0!==GRe[e]&&this._include(e),qRe[e]}_include(e){const t=GRe[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\nvar<private> varyings : VaryingsStruct;\n\n// codes\n${e.codes}\n\n@vertex\nfn main( ${e.attributes} ) -> VaryingsStruct {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n\treturn varyings;\n\n}\n`}_getWGSLFragmentCode(e){return`${this.getSignature()}\n// global\n${WRe}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@fragment\nfn main( ${e.varyings} ) -> ${e.returnType} {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLComputeCode(e,t){const[n,r,i]=t;return`${this.getSignature()}\n// directives\n${e.directives}\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n${e.scopedArrays}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@compute @workgroup_size( ${n}, ${r}, ${i} )\nfn main( ${e.attributes} ) {\n\n\t// system\n\tinstanceIndex = globalId.x\n\t\t+ globalId.y * ( ${n} * numWorkgroups.x )\n\t\t+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLStruct(e,t){return`\nstruct ${e} {\n${t}\n};`}_getWGSLStructBinding(e,t,n,r=0,i=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}\n@binding( ${r} ) @group( ${i} )\nvar<${n}> ${e} : ${a};`}}class $Re{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return null!==e.depthTexture?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=yNe:e.depth&&(t=ANe),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const e=this.backend.renderer,n=e.getRenderTarget();t=n?n.samples:e.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&null!==e.renderTarget&&!0!==e.isDepthTexture&&!0!==e.isFramebufferTexture;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return t=null!==e.textures?this.getTextureFormatGPU(e.textures[0]):this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return null!==e.textures?e.textures.map(e=>this.getTextureFormatGPU(e)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return null!==e.textures?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){return e.isPoints?hPe:e.isLineSegments||e.isMesh&&!0===t.wireframe?pPe:e.isLine?fPe:e.isMesh?mPe:void 0}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return null!==e.textures?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(void 0===e)return navigator.gpu.getPreferredCanvasFormat();if(e===hQ)return rNe;if(e===yQ)return pNe;throw new Error("Unsupported output buffer type.")}}const KRe=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);"undefined"!==typeof Float16Array&&KRe.set(Float16Array,["float16"]);const XRe=new Map([[x1,["float16"]]]),YRe=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class QRe{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,i=r.get(n);let a=i.buffer;if(void 0===a){const o=r.device;let s=n.array;if(!1===e.normalized)if(s.constructor===Int16Array||s.constructor===Int8Array)s=new Int32Array(s);else if((s.constructor===Uint16Array||s.constructor===Uint8Array)&&(s=new Uint32Array(s),t&GPUBufferUsage.INDEX))for(let e=0;e<s.length;e++)65535===s[e]&&(s[e]=4294967295);if(n.array=s,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){s=new s.constructor(4*n.count);for(let e=0;e<n.count;e++)s.set(n.array.subarray(3*e,3*e+3),4*e);n.itemSize=4,n.array=s,i._force3to4BytesAlignment=!0}const l=s.byteLength,c=l+(4-l%4)%4;a=o.createBuffer({label:n.name,size:c,usage:t,mappedAtCreation:!0}),new s.constructor(a.getMappedRange()).set(s),a.unmap(),i.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,i=n.get(t),a=n.get(t).buffer;let o=t.array;if(!0===i._force3to4BytesAlignment){o=new o.constructor(4*t.count);for(let e=0;e<t.count;e++)o.set(t.array.subarray(3*e,3*e+3),4*e);t.array=o}const s=t.updateRanges;if(0===s.length)r.queue.writeBuffer(a,0,o,0);else{const e=KZ(o),n=e?1:o.BYTES_PER_ELEMENT;for(let t=0,l=s.length;t<l;t++){const l=s[t];let c,u;if(!0===i._force3to4BytesAlignment){c=4*Math.floor(l.start/3)*n,u=4*Math.ceil(l.count/3)*n}else c=l.start*n,u=l.count*n;const d=c*(e?o.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(a,d,o,c,u)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const e=t[r],i=e.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(e);let o=n.get(a);if(void 0===o){let t,r;!0===e.isInterleavedBufferAttribute?(t=e.data.stride*i,r=e.data.isInstancedInterleavedBuffer?yRe:ARe):(t=e.itemSize*i,r=e.isInstancedBufferAttribute?yRe:ARe),!1!==e.normalized||e.array.constructor!==Int16Array&&e.array.constructor!==Uint16Array||(t=4),o={arrayStride:t,attributes:[],stepMode:r},n.set(a,o)}const s=this._getVertexFormat(e),l=!0===e.isInterleavedBufferAttribute?e.offset*i:0;o.attributes.push({shaderLocation:r,offset:l,format:s})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,i=r.size,a=n.createBuffer({label:`${e.name}_readback`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o=n.createCommandEncoder({label:`readback_encoder_${e.name}`});o.copyBufferToBuffer(r,0,a,0,i);const s=o.finish();n.queue.submit([s]),await a.mapAsync(GPUMapMode.READ);const l=a.getMappedRange(),c=new e.array.constructor(l.slice(0));return a.unmap(),c.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,i=e.constructor;let a;if(1===t)a=YRe.get(r);else{const e=(XRe.get(i)||KRe.get(r))[n?1:0];if(e){const n=r.BYTES_PER_ELEMENT*t,i=4*Math.floor((n+3)/4)/r.BYTES_PER_ELEMENT;if(i%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${e}x${i}`}}return a||tJ("WebGPUAttributeUtils: Vertex format not supported yet."),a}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class ZRe{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class JRe{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,n=t.device,r=t.get(e);if(r.layout)return r.layout.layoutGPU;const i=this._createLayoutEntries(e),a=JSON.stringify(i);let o=this._bindGroupLayoutCache.get(a);return void 0===o&&(o=new ZRe(n.createBindGroupLayout({entries:i})),this._bindGroupLayoutCache.set(a,o)),o.usedTimes++,r.layout=o,r.layoutKey=a,o.layoutGPU}createBindings(e,t,n,r=0){const{backend:i}=this,a=i.get(e),o=this.createBindingsLayout(e);let s;n>0&&(void 0===a.groups&&(a.groups=[],a.versions=[]),a.versions[n]===r&&(s=a.groups[n])),void 0===s&&(s=this.createBindGroup(e,o),n>0&&(a.groups[n]=s,a.versions[n]=r)),a.group=s}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,i=t.get(e).buffer,a=e.updateRanges;if(0===a.length)n.queue.writeBuffer(i,0,r,0);else{const t=KZ(r),o=t?1:r.BYTES_PER_ELEMENT;for(let e=0,s=a.length;e<s;e++){const s=a[e],l=s.start*o,c=s.count*o,u=l*(t?r.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(i,u,r,l,c)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const n=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=e[0],a=n.createBuffer({label:"bindingCameraIndex_"+i,size:16,usage:r});n.queue.writeBuffer(a,0,e,0);const o=[{binding:0,resource:{buffer:a}}];return n.createBindGroup({label:"bindGroupCameraIndex_"+i,layout:t,entries:o})}createBindGroup(e,t){const n=this.backend,r=n.device;let i=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const e=n.get(o);if(void 0===e.buffer){const t=o.byteLength,n=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=[];o.visibility&vPe.VERTEX&&i.push("vertex"),o.visibility&vPe.FRAGMENT&&i.push("fragment"),o.visibility&vPe.COMPUTE&&i.push("compute");const a=`(${i.join(",")})`,s=r.createBuffer({label:`bindingBuffer${o.id}_${o.name}_${a}`,size:t,usage:n});e.buffer=s}a.push({binding:i,resource:{buffer:e.buffer}})}else if(o.isStorageBuffer){const e=n.get(o);if(void 0===e.buffer){const t=o.attribute;e.buffer=n.get(t).buffer}a.push({binding:i,resource:{buffer:e.buffer}})}else if(o.isSampledTexture){const e=n.get(o.texture);let t;if(void 0!==e.externalTexture)t=r.importExternalTexture({source:e.externalTexture});else{const n=o.store?1:e.texture.mipLevelCount,r=o.store?o.mipLevel:0;let i=`view-${e.texture.width}-${e.texture.height}`;if(e.texture.depthOrArrayLayers>1&&(i+=`-${e.texture.depthOrArrayLayers}`),i+=`-${n}-${r}`,t=e[i],void 0===t){const a=vRe;let s;s=o.isSampledCubeTexture?mRe:o.isSampledTexture3D?gRe:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?fRe:pRe,t=e[i]=e.texture.createView({aspect:a,dimension:s,mipLevelCount:n,baseMipLevel:r})}}a.push({binding:i,resource:t})}else if(o.isSampler){const e=n.get(o.texture);a.push({binding:i,resource:e.sampler})}i++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}_createLayoutEntries(e){const t=[];let n=0;for(const r of e.bindings){const e=this.backend,i={binding:n,visibility:r.visibility};if(r.isUniformBuffer||r.isStorageBuffer){const e={};r.isStorageBuffer&&(r.visibility&vPe.COMPUTE&&(r.access===Cse.READ_WRITE||r.access===Cse.WRITE_ONLY)?e.type=Jke:e.type=eRe),i.buffer=e}else if(r.isSampledTexture&&r.store){const e={};e.format=this.backend.get(r.texture).texture.format;const t=r.access;e.access=t===Cse.READ_WRITE?rRe:t===Cse.WRITE_ONLY?tRe:nRe,r.texture.isArrayTexture?e.viewDimension=fRe:r.texture.is3DTexture&&(e.viewDimension=gRe),i.storageTexture=e}else if(r.isSampledTexture){const t={},{primarySamples:n}=e.utils.getTextureSampleData(r.texture);if(n>1&&(t.multisampled=!0,r.texture.isDepthTexture||(t.sampleType=sRe)),r.texture.isDepthTexture)e.compatibilityMode&&null===r.texture.compareFunction?t.sampleType=sRe:t.sampleType=lRe;else if(r.texture.isDataTexture||r.texture.isDataArrayTexture||r.texture.isData3DTexture){const e=r.texture.type;e===gQ?t.sampleType=cRe:e===vQ?t.sampleType=uRe:e===AQ&&(this.backend.hasFeature("float32-filterable")?t.sampleType=oRe:t.sampleType=sRe)}r.isSampledCubeTexture?t.viewDimension=mRe:r.texture.isArrayTexture||r.texture.isDataArrayTexture||r.texture.isCompressedArrayTexture?t.viewDimension=fRe:r.isSampledTexture3D&&(t.viewDimension=gRe),i.texture=t}else if(r.isSampler){const t={};r.texture.isDepthTexture&&(null!==r.texture.compareFunction?t.type=aRe:e.compatibilityMode&&(t.type=iRe)),i.sampler=t}else tJ(`WebGPUBindingUtils: Unsupported binding "${r}".`);t.push(i),n++}return t}deleteBindGroupData(e){const{backend:t}=this,n=t.get(e);n.layout&&(n.layout.usedTimes--,0===n.layout.usedTimes&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class eLe{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:i,pipeline:a}=e,{vertexProgram:o,fragmentProgram:s}=a,l=this.backend,c=l.device,u=l.utils,d=l.get(a),h=[];for(const E of e.getBindings()){const e=l.get(E),{layoutGPU:t}=e.layout;h.push(t)}const p=l.attributeUtils.createShaderVertexBuffers(e);let f;0===r.blending||1===r.blending&&!1===r.transparent||(f=this._getBlending(r));let m={};!0===r.stencilWrite&&(m={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const g=this._getColorWriteMask(r),v=[];if(null!==e.context.textures){const t=e.context.textures;for(let e=0;e<t.length;e++){const n=u.getTextureFormatGPU(t[e]);0===e?v.push({format:n,blend:f,writeMask:g}):v.push({format:n,writeMask:g})}}else{const t=u.getCurrentColorFormat(e.context);v.push({format:t,blend:f,writeMask:g})}const A=l.get(o).module,y=l.get(s).module,b=this._getPrimitiveState(n,i,r),x=this._getDepthCompare(r),_=u.getCurrentDepthStencilFormat(e.context),w=this._getSampleCount(e.context),S={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},A,{buffers:p}),fragment:Object.assign({},y,{targets:v}),primitive:b,multisample:{count:w,alphaToCoverageEnabled:r.alphaToCoverage&&w>1},layout:c.createPipelineLayout({bindGroupLayouts:h})},T={},C=e.context.depth,M=e.context.stencil;if(!0!==C&&!0!==M||(!0===C&&(T.format=_,T.depthWriteEnabled=r.depthWrite,T.depthCompare=x),!0===M&&(T.stencilFront=m,T.stencilBack={},T.stencilReadMask=r.stencilFuncMask,T.stencilWriteMask=r.stencilWriteMask),!0===r.polygonOffset&&(T.depthBias=r.polygonOffsetUnits,T.depthBiasSlopeScale=r.polygonOffsetFactor,T.depthBiasClamp=0),S.depthStencil=T),c.pushErrorScope("validation"),null===t)d.pipeline=c.createRenderPipeline(S),c.popErrorScope().then(e=>{null!==e&&(d.error=!0,tJ(e.message))});else{const e=new Promise(async e=>{try{d.pipeline=await c.createRenderPipelineAsync(S)}catch(n){}const t=await c.popErrorScope();null!==t&&(d.error=!0,tJ(t.message)),e()});t.push(e)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:r,device:i}=n,a=r.getCurrentDepthStencilFormat(e),o={label:t,colorFormats:r.getCurrentColorFormats(e),depthStencilFormat:a,sampleCount:this._getSampleCount(e)};return i.createRenderBundleEncoder(o)}createComputePipeline(e,t){const n=this.backend,r=n.device,i=n.get(e.computeProgram).module,a=n.get(e),o=[];for(const s of t){const e=n.get(s),{layoutGPU:t}=e.layout;o.push(t)}a.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,n;const r=e.blending,i=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(5===r){const r=null!==e.blendSrcAlpha?e.blendSrcAlpha:i,s=null!==e.blendDstAlpha?e.blendDstAlpha:a,l=null!==e.blendEquationAlpha?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(l)}}else{const i=(e,r,i,a)=>{t={srcFactor:e,dstFactor:r,operation:Bke},n={srcFactor:i,dstFactor:a,operation:Bke}};if(e.premultipliedAlpha)switch(r){case 1:i(Cke,Nke,Cke,Nke);break;case 2:i(Cke,Cke,Cke,Cke);break;case 3:i(Tke,Eke,Tke,Cke);break;case 4:i(kke,Nke,Tke,Cke)}else switch(r){case 1:i(Pke,Nke,Cke,Nke);break;case 2:i(Pke,Cke,Cke,Cke);break;case 3:tJ("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:tJ("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true")}}if(void 0!==t&&void 0!==n)return{color:t,alpha:n};tJ("WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case AY:t=Tke;break;case 201:t=Cke;break;case 202:t=Mke;break;case 203:t=Eke;break;case _Y:t=Pke;break;case wY:t=Nke;break;case 208:t=kke;break;case 209:t=Rke;break;case 206:t=Lke;break;case 207:t=Oke;break;case 210:t=jke;break;case 211:t=Dke;break;case 212:t=Ike;break;default:tJ("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case 512:t=APe;break;case 519:t=TPe;break;case 513:t=yPe;break;case 515:t=xPe;break;case 514:t=bPe;break;case 518:t=SPe;break;case 516:t=_Pe;break;case 517:t=wPe;break;default:tJ("WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case kZ:t=Wke;break;case 0:t=Hke;break;case 7681:t=$ke;break;case 5386:t=Kke;break;case 7682:t=Xke;break;case 7683:t=Yke;break;case 34055:t=Qke;break;case 34056:t=Zke;break;default:tJ("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case mY:t=Bke;break;case 101:t=Fke;break;case 102:t=zke;break;case 103:t=Uke;break;case 104:t=Vke;break;default:tJ("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},i=this.backend.utils;r.topology=i.getPrimitiveTopology(e,n),null!==t.index&&!0===e.isLine&&!0!==e.isLineSegments&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?LPe:OPe);let a=1===n.side;return e.isMesh&&e.matrixWorld.determinant()<0&&(a=!a),r.frontFace=!0===a?NPe:PPe,r.cullMode=2===n.side?kPe:RPe,r}_getColorWriteMask(e){return!0===e.colorWrite?qke:Gke}_getDepthCompare(e){let t;if(!1===e.depthTest)t=TPe;else{const n=e.depthFunc;switch(n){case 0:t=APe;break;case 1:t=TPe;break;case 2:t=yPe;break;case 3:t=xPe;break;case 4:t=bPe;break;case 5:t=SPe;break;case 6:t=_Pe;break;case 7:t=wPe;break;default:tJ("WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class tLe extends cPe{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return nJ(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=8*t;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=r.finish();if(this.device.queue.submit([i]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),o={},s=[];for(const[c,u]of e){const e=c.match(/^(.*):f(\d+)$/),t=parseInt(e[2]);!1===s.includes(t)&&s.push(t),void 0===o[t]&&(o[t]=0);const n=a[u],r=a[u+1],i=Number(r-n)/1e6;this.timestamps.set(c,i),o[t]+=i}const l=o[s[s.length-1]];return this.resultBuffer.unmap(),this.lastValue=l,this.frames=s,l}catch(or){return tJ("Error resolving queries:",or),"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(or){tJ("Error waiting for pending resolve:",or)}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(or){tJ("Error unmapping buffer:",or)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class nLe extends WEe{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===e.alpha||e.alpha,this.parameters.compatibilityMode=void 0!==e.compatibilityMode&&e.compatibilityMode,this.parameters.requiredLimits=void 0===e.requiredLimits?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new $Re(this),this.attributeUtils=new QRe(this),this.bindingUtils=new JRe(this),this.pipelineUtils=new eLe(this),this.textureUtils=new PRe(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(void 0===t.device){const e={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},r="undefined"!==typeof navigator?await navigator.gpu.requestAdapter(e):null;if(null===r)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const i=Object.values(bRe),a=[];for(const t of i)r.features.has(t)&&a.push(t);const o={requiredFeatures:a,requiredLimits:t.requiredLimits};n=await r.requestDevice(o)}else n=t.device;n.lost.then(t=>{if("destroyed"===t.reason)return;const n={api:"WebGPU",message:t.message||"Unknown reason",reason:t.reason||null,originalEvent:t};e.onDeviceLost(n)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(bRe.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let n=t.context;if(void 0===n){const r=this.parameters;n=!0===e.isDefaultCanvasTarget&&void 0!==r.context?r.context:e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${nY} webgpu`);const i=r.alpha?"premultiplied":"opaque",a=r.outputType===yQ?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:a}}),t.context=n}return n}get coordinateSystem(){return qZ}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),r=e.currentSamples;let i=n.descriptor;if(void 0===i||n.samples!==r){i={colorAttachments:[{view:null}]},!0!==e.depth&&!0!==e.stencil||(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const t=i.colorAttachments[0];r>0?t.view=this.textureUtils.getColorBuffer().createView():t.resolveTarget=void 0,n.descriptor=i,n.samples=r}const a=i.colorAttachments[0];return r>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let i=r.descriptors;void 0!==i&&r.width===n.width&&r.height===n.height&&r.samples===n.samples||(i={},r.descriptors=i);const a=e.getCacheKey();let o=i[a];if(void 0===o){const t=e.textures,s=[];let l;const c=this._isRenderCameraDepthArray(e);for(let r=0;r<t.length;r++){const i=this.get(t[r]),a={label:`colorAttachment_${r}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:pRe};if(n.isRenderTarget3D)l=e.activeCubeFace,a.baseArrayLayer=0,a.dimension=gRe,a.depthOrArrayLayers=t[r].image.depth;else if(n.isRenderTarget&&t[r].image.depth>1)if(!0===c){const t=e.camera.cameras;for(let e=0;e<t.length;e++){const t={...a,baseArrayLayer:e,arrayLayerCount:1,dimension:pRe},n=i.texture.createView(t);s.push({view:n,resolveTarget:void 0,depthSlice:void 0})}}else a.dimension=fRe,a.depthOrArrayLayers=t[r].image.depth;if(!0!==c){const e=i.texture.createView(a);let t,n;void 0!==i.msaaTexture?(t=i.msaaTexture.createView(),n=e):(t=e,n=void 0),s.push({view:t,resolveTarget:n,depthSlice:l})}}if(o={textureViews:s},e.depth){const t=this.get(e.depthTexture),n={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(n.dimension=pRe,n.arrayLayerCount=1,n.baseArrayLayer=e.activeCubeFace),o.depthStencilView=t.texture.createView(n)}i[a]=o,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}const s={colorAttachments:[]};for(let l=0;l<o.textureViews.length;l++){const e=o.textureViews[l];let n={r:0,g:0,b:0,a:1};0===l&&t.clearValue&&(n=t.clearValue),s.colorAttachments.push({view:e.view,depthSlice:e.depthSlice,resolveTarget:e.resolveTarget,loadOp:t.loadOp||MPe,storeOp:t.storeOp||CPe,clearValue:n})}return o.depthStencilView&&(s.depthStencilAttachment={view:o.depthStencilView}),s}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let i,a;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null),a=null===e.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:MPe}),this.initTimestampQuery(HZ,this.getTimestampUID(e),a),a.occlusionQuerySet=i;const o=a.depthStencilAttachment;if(null!==e.textures){const t=a.colorAttachments;for(let n=0;n<t.length;n++){const r=t[n];e.clearColor?(r.clearValue=0===n?e.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=EPe):r.loadOp=MPe,r.storeOp=CPe}}else{const t=a.colorAttachments[0];e.clearColor?(t.clearValue=e.clearColorValue,t.loadOp=EPe):t.loadOp=MPe,t.storeOp=CPe}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=EPe):o.depthLoadOp=MPe,o.depthStoreOp=CPe),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=EPe):o.stencilLoadOp=MPe,o.stencilStoreOp=CPe);const s=n.createCommandEncoder({label:"renderContext_"+e.id});if(!0===this._isRenderCameraDepthArray(e)){const n=e.camera.cameras;t.layerDescriptors&&t.layerDescriptors.length===n.length?this._updateDepthLayerDescriptors(e,t,n):this._createDepthLayerDescriptors(e,t,a,n),t.bundleEncoders=[],t.bundleSets=[];for(let r=0;r<n.length;r++){const n=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+r),i={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(n),t.bundleSets.push(i)}t.currentPass=null}else{const n=s.beginRenderPass(a);t.currentPass=n,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=a,t.encoder=s,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const i=n.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<r.length;o++){const r={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[o].view}]};if(n.depthStencilAttachment){const t=o;a.viewCache[t]||(a.viewCache[t]=a.texture.createView({dimension:pRe,baseArrayLayer:o,arrayLayerCount:1})),r.depthStencilAttachment={view:a.viewCache[t],depthLoadOp:i.depthLoadOp||EPe,depthStoreOp:i.depthStoreOp||CPe,depthClearValue:i.depthClearValue||1},e.stencil&&(r.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,r.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,r.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else r.depthStencilAttachment={...i};t.layerDescriptors.push(r)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const n=t.layerDescriptors[r];if(n.depthStencilAttachment){const t=n.depthStencilAttachment;e.depth&&(e.clearDepth?(t.depthClearValue=e.clearDepthValue,t.depthLoadOp=EPe):t.depthLoadOp=MPe),e.stencil&&(e.clearStencil?(t.stencilClearValue=e.clearStencilValue,t.stencilLoadOp=EPe):t.stencilLoadOp=MPe)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(!0===this._isRenderCameraDepthArray(e)){const n=[];for(let e=0;e<t.bundleEncoders.length;e++){const r=t.bundleEncoders[e];n.push(r.finish())}for(let i=0;i<t.layerDescriptors.length;i++)if(i<n.length){const a=t.layerDescriptors[i],o=r.beginRenderPass(a);if(e.viewport){const{x:t,y:n,width:r,height:i,minDepth:a,maxDepth:s}=e.viewportValue;o.setViewport(t,n,r,i,a,s)}if(e.scissor){const{x:t,y:n,width:r,height:i}=e.scissorValue;o.setScissorRect(t,n,r,i)}o.executeBundles([n[i]]),o.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const r=8*n;let i=this.occludedResolveCache.get(r);void 0===i&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));const a=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,i,0),t.encoder.copyBufferToBuffer(i,0,a,0,r),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),null!==e.textures){const t=e.textures;for(let e=0;e<t.length;e++){const n=t[e];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const e=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const i=n.getMappedRange(),a=new BigUint64Array(i);for(let t=0;t<r.length;t++)a[t]===BigInt(0)&&e.add(r[t]);n.destroy(),t.occluded=e}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:a,minDepth:o,maxDepth:s}=e.viewportValue;t.setViewport(n,r,i,a,o,s)}updateScissor(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:a}=e.scissorValue;t.setScissorRect(n,r,i,a)}getClearColor(){const e=super.getClearColor();return!0===this.renderer.alpha&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const i=this.device,a=this.renderer;let o,s,l,c,u=[];if(e){const e=this.getClearColor();s={r:e.r,g:e.g,b:e.b,a:e.a}}if(null===r){l=a.depth,c=a.stencil;const t=this._getDefaultRenderPassDescriptor();if(e){u=t.colorAttachments;const e=u[0];e.clearValue=s,e.loadOp=EPe,e.storeOp=CPe}(l||c)&&(o=t.depthStencilAttachment)}else{l=r.depth,c=r.stencil;const i={loadOp:e?EPe:MPe,clearValue:e?s:void 0};l&&(i.depthLoadOp=t?EPe:MPe,i.depthClearValue=t?a.getClearDepth():void 0,i.depthStoreOp=CPe),c&&(i.stencilLoadOp=n?EPe:MPe,i.stencilClearValue=n?a.getClearStencil():void 0,i.stencilStoreOp=CPe);const d=this._getRenderPassDescriptor(r,i);u=d.colorAttachments,o=d.depthStencilAttachment}l&&o&&(t?(o.depthLoadOp=EPe,o.depthClearValue=a.getClearDepth(),o.depthStoreOp=CPe):(o.depthLoadOp=MPe,o.depthStoreOp=CPe)),c&&o&&(n?(o.stencilLoadOp=EPe,o.stencilClearValue=a.getClearStencil(),o.stencilStoreOp=CPe):(o.stencilLoadOp=MPe,o.stencilStoreOp=CPe));const d=i.createCommandEncoder({label:"clear"});d.beginRenderPass({colorAttachments:u,depthStencilAttachment:o}).end(),i.queue.submit([d.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(WZ,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r,i=null){const a=this.get(t),{passEncoderGPU:o}=this.get(e),s=this.get(r).pipeline;this.pipelineUtils.setPipeline(o,s);for(let l=0,c=n.length;l<c;l++){const e=n[l],t=this.get(e);o.setBindGroup(l,t.group)}if(null===i&&(i=t.count),i&&"object"===typeof i&&i.isIndirectStorageBufferAttribute){const e=this.get(i).buffer;return void o.dispatchWorkgroupsIndirect(e,0)}if("number"===typeof i){const e=i;if(void 0===a.dispatchSize||a.count!==e){a.dispatchSize=[0,1,1],a.count=e;const n=t.workgroupSize;let r=n[0];for(let e=1;e<n.length;e++)r*=n[e];const o=Math.ceil(e/r),s=this.device.limits.maxComputeWorkgroupsPerDimension;i=[o,1,1],o>s&&(i[0]=Math.min(o,s),i[1]=Math.ceil(o/s)),a.dispatchSize=i}i=a.dispatchSize}o.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:n,material:r,context:i,pipeline:a}=e,o=e.getBindings(),s=this.get(i),l=this.get(a),c=l.pipeline;if(!0===l.error)return;const u=e.getIndex(),d=null!==u,h=e.getDrawParameters();if(null===h)return;const p=(t,n)=>{this.pipelineUtils.setPipeline(t,c),n.pipeline=c;const a=n.bindingGroups;for(let e=0,r=o.length;e<r;e++){const n=o[e],r=this.get(n);a[n.index]!==n.id&&(t.setBindGroup(n.index,r.group),a[n.index]=n.id)}if(!0===d&&n.index!==u){const e=this.get(u).buffer,r=u.array instanceof Uint16Array?LPe:OPe;t.setIndexBuffer(e,r),n.index=u}const l=e.getVertexBuffers();for(let e=0,r=l.length;e<r;e++){const r=l[e];if(n.attributes[e]!==r){const i=this.get(r).buffer;t.setVertexBuffer(e,i),n.attributes[e]=r}}!0===i.stencil&&!0===r.stencilWrite&&s.currentStencilRef!==r.stencilRef&&(t.setStencilReference(r.stencilRef),s.currentStencilRef=r.stencilRef)},f=(r,i)=>{if(p(r,i),!0===n.isBatchedMesh){const e=n._multiDrawStarts,i=n._multiDrawCounts,a=n._multiDrawCount,o=n._multiDrawInstances;null!==o&&nJ("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let s=0;s<a;s++){const a=o?o[s]:1,l=a>1?0:s;!0===d?r.drawIndexed(i[s],a,e[s]/u.array.BYTES_PER_ELEMENT,0,l):r.draw(i[s],a,e[s],l),t.update(n,i[s],a)}}else if(!0===d){const{vertexCount:i,instanceCount:a,firstVertex:o}=h,s=e.getIndirect();if(null!==s){const t=this.get(s).buffer,n=e.getIndirectOffset(),i=Array.isArray(n)?n:[n];for(let e=0;e<i.length;e++)r.drawIndexedIndirect(t,i[e])}else r.drawIndexed(i,a,o,0,0);t.update(n,i,a)}else{const{vertexCount:i,instanceCount:a,firstVertex:o}=h,s=e.getIndirect();if(null!==s){const t=this.get(s).buffer,n=e.getIndirectOffset(),i=Array.isArray(n)?n:[n];for(let e=0;e<i.length;e++)r.drawIndirect(t,i[e])}else r.draw(i,a,o,0);t.update(n,i,a)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const t=this.get(e.camera),r=e.camera.cameras,a=e.getBindingGroup("cameraIndex");if(void 0===t.indexesGPU||t.indexesGPU.length!==r.length){const e=this.get(a),n=[],i=new Uint32Array([0,0,0,0]);for(let t=0,a=r.length;t<a;t++){i[0]=t;const{layoutGPU:r}=e.layout,a=this.bindingUtils.createBindGroupIndex(i,r);n.push(a)}t.indexesGPU=n}const o=this.renderer.getPixelRatio();for(let e=0,l=r.length;e<l;e++){const l=r[e];if(n.layers.test(l.layers)){const n=l.viewport;let r=s.currentPass,c=s.currentSets;if(s.bundleEncoders){r=s.bundleEncoders[e],c=s.bundleSets[e]}n&&r.setViewport(Math.floor(n.x*o),Math.floor(n.y*o),Math.floor(n.width*o),Math.floor(n.height*o),i.viewportValue.minDepth,i.viewportValue.maxDepth),a&&t.indexesGPU&&(r.setBindGroup(a.index,t.indexesGPU[e]),c.bindingGroups[a.index]=a.id),f(r,c)}}}else if(s.currentPass){if(void 0!==s.occlusionQuerySet){const e=s.lastOcclusionObject;e!==n&&(null!==e&&!0===e.occlusionTest&&(s.currentPass.endOcclusionQuery(),s.occlusionQueryIndex++),!0===n.occlusionTest&&(s.currentPass.beginOcclusionQuery(s.occlusionQueryIndex),s.occlusionQueryObjects[s.occlusionQueryIndex]=n),s.lastOcclusionObject=n)}f(s.currentPass,s.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,i=this.utils,a=i.getSampleCountRenderContext(e.context),o=i.getCurrentColorSpace(e.context),s=i.getCurrentColorFormat(e.context),l=i.getCurrentDepthStencilFormat(e.context),c=i.getPrimitiveTopology(n,r);let u=!1;return t.material===r&&t.materialVersion===r.version&&t.transparent===r.transparent&&t.blending===r.blending&&t.premultipliedAlpha===r.premultipliedAlpha&&t.blendSrc===r.blendSrc&&t.blendDst===r.blendDst&&t.blendEquation===r.blendEquation&&t.blendSrcAlpha===r.blendSrcAlpha&&t.blendDstAlpha===r.blendDstAlpha&&t.blendEquationAlpha===r.blendEquationAlpha&&t.colorWrite===r.colorWrite&&t.depthWrite===r.depthWrite&&t.depthTest===r.depthTest&&t.depthFunc===r.depthFunc&&t.stencilWrite===r.stencilWrite&&t.stencilFunc===r.stencilFunc&&t.stencilFail===r.stencilFail&&t.stencilZFail===r.stencilZFail&&t.stencilZPass===r.stencilZPass&&t.stencilFuncMask===r.stencilFuncMask&&t.stencilWriteMask===r.stencilWriteMask&&t.side===r.side&&t.alphaToCoverage===r.alphaToCoverage&&t.sampleCount===a&&t.colorSpace===o&&t.colorFormat===s&&t.depthStencilFormat===l&&t.primitiveTopology===c&&t.clippingContextCacheKey===e.clippingContextCacheKey||(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=s,t.depthStencilFormat=l,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,u=!0),u}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,i=e.context,a=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,a,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,i,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,a)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new tLe(this.device,e,2048));const r=this.timestampQueryPool[e],i=r.allocateQueriesForContext(t);n.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new HRe(e,t)}createProgram(e){this.get(e).module={module:this.device.createShaderModule({code:e.code,label:e.stage+(""!==e.name?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return void 0!==xRe[e]&&(e=xRe[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){let o=0,s=0,l=0,c=0,u=0,d=0,h=e.image.width,p=e.image.height,f=1;null!==n&&(!0===n.isBox3?(c=n.min.x,u=n.min.y,d=n.min.z,h=n.max.x-n.min.x,p=n.max.y-n.min.y,f=n.max.z-n.min.z):(c=n.min.x,u=n.min.y,h=n.max.x-n.min.x,p=n.max.y-n.min.y,f=1)),null!==r&&(o=r.x,s=r.y,l=r.z||0);const m=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),g=this.get(e).texture,v=this.get(t).texture;m.copyTextureToTexture({texture:g,mipLevel:i,origin:{x:c,y:u,z:d}},{texture:v,mipLevel:a,origin:{x:o,y:s,z:l}},[h,p,f]),this.device.queue.submit([m.finish()]),0===a&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let i=null;i=t.renderTarget?e.isDepthTexture?this.get(t.depthTexture).texture:this.get(t.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(t.depth,t.stencil):this.context.getCurrentTexture();const a=this.get(e).texture;if(i.format!==a.format)return void tJ("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,a.format);let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,o),r.currentPass){const{descriptor:e}=r;for(let t=0;t<e.colorAttachments.length;t++)e.colorAttachments[t].loadOp=MPe;t.depth&&(e.depthStencilAttachment.depthLoadOp=MPe),t.stencil&&(e.depthStencilAttachment.stencilLoadOp=MPe),r.currentPass=o.beginRenderPass(e),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([o.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))null!==e&&e.dispose();void 0===this.parameters.device&&null!==this.device&&this.device.destroy()}}class rLe extends z4{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class iLe extends z4{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class aLe extends ZMe{constructor(){super(),this.addMaterial(Yve,"MeshPhongMaterial"),this.addMaterial(Vye,"MeshStandardMaterial"),this.addMaterial(qye,"MeshPhysicalMaterial"),this.addMaterial(Kye,"MeshToonMaterial"),this.addMaterial(Uve,"MeshBasicMaterial"),this.addMaterial(Kve,"MeshLambertMaterial"),this.addMaterial(Eve,"MeshNormalMaterial"),this.addMaterial(Qye,"MeshMatcapMaterial"),this.addMaterial(xve,"LineBasicMaterial"),this.addMaterial(wve,"LineDashedMaterial"),this.addMaterial(ibe,"PointsMaterial"),this.addMaterial(tbe,"SpriteMaterial"),this.addMaterial(lbe,"ShadowMaterial"),this.addLight(hTe,V4),this.addLight(SMe,W4),this.addLight(EMe,$4),this.addLight(PMe,z4),this.addLight(LMe,H4),this.addLight(OMe,O4),this.addLight(jMe,X4),this.addLight(NMe,rLe),this.addLight(RMe,iLe),this.addToneMapping(Y_e,1),this.addToneMapping(Q_e,2),this.addToneMapping(Z_e,3),this.addToneMapping(ewe,4),this.addToneMapping(iwe,6),this.addToneMapping(awe,7)}}class oLe extends bEe{constructor(e={}){let t;e.forceWebGL?t=dPe:(t=nLe,e.getFallback=()=>(eJ("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new dPe(e)));super(new t(e),e),this.library=new aLe,this.isWebGPURenderer=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}FCe.BRDF_GGX,FCe.BRDF_Lambert,FCe.BasicPointShadowFilter,FCe.BasicShadowFilter,FCe.Break,FCe.Const,FCe.Continue,FCe.DFGLUT,FCe.D_GGX,FCe.Discard,FCe.EPSILON,FCe.F_Schlick;const sLe=FCe.Fn,lLe=(FCe.INFINITY,FCe.If),cLe=FCe.Loop,uLe=(FCe.NodeAccess,FCe.NodeShaderStage,FCe.NodeType,FCe.NodeUpdateType,FCe.PCFShadowFilter,FCe.PCFSoftShadowFilter,FCe.PI,FCe.PI2,FCe.TWO_PI,FCe.HALF_PI,FCe.PointShadowFilter,FCe.Return,FCe.Schlick_to_F0,FCe.ScriptableNodeResources,FCe.ShaderNode,FCe.Stack,FCe.Switch,FCe.TBNViewMatrix,FCe.VSMShadowFilter,FCe.V_GGX_SmithCorrelated,FCe.Var,FCe.VarIntent,FCe.abs,FCe.acesFilmicToneMapping,FCe.acos,FCe.add,FCe.addMethodChaining,FCe.addNodeElement,FCe.agxToneMapping,FCe.all,FCe.alphaT,FCe.and,FCe.anisotropy,FCe.anisotropyB,FCe.anisotropyT,FCe.any,FCe.append,FCe.array,FCe.arrayBuffer,FCe.asin),dLe=(FCe.assign,FCe.atan,FCe.atan2,FCe.atomicAdd,FCe.atomicAnd,FCe.atomicFunc,FCe.atomicLoad,FCe.atomicMax,FCe.atomicMin,FCe.atomicOr,FCe.atomicStore,FCe.atomicSub,FCe.atomicXor,FCe.attenuationColor,FCe.attenuationDistance,FCe.attribute,FCe.attributeArray,FCe.backgroundBlurriness,FCe.backgroundIntensity,FCe.backgroundRotation,FCe.batch,FCe.bentNormalView,FCe.billboarding,FCe.bitAnd,FCe.bitNot,FCe.bitOr,FCe.bitXor,FCe.bitangentGeometry,FCe.bitangentLocal,FCe.bitangentView,FCe.bitangentWorld,FCe.bitcast,FCe.blendBurn,FCe.blendColor,FCe.blendDodge,FCe.blendOverlay,FCe.blendScreen,FCe.blur,FCe.bool,FCe.buffer,FCe.bufferAttribute,FCe.bumpMap,FCe.burn,FCe.builtin,FCe.builtinAOContext,FCe.builtinShadowContext,FCe.bvec2,FCe.bvec3,FCe.bvec4,FCe.bypass,FCe.cache,FCe.call,FCe.cameraFar,FCe.cameraIndex,FCe.cameraNear,FCe.cameraNormalMatrix,FCe.cameraPosition,FCe.cameraProjectionMatrix,FCe.cameraProjectionMatrixInverse,FCe.cameraViewMatrix,FCe.cameraViewport,FCe.cameraWorldMatrix,FCe.cbrt,FCe.cdl,FCe.ceil,FCe.checker,FCe.cineonToneMapping,FCe.clamp,FCe.clearcoat,FCe.clearcoatNormalView,FCe.clearcoatRoughness,FCe.code,FCe.color,FCe.colorSpaceToWorking,FCe.colorToDirection,FCe.compute,FCe.computeKernel,FCe.computeSkinning,FCe.context,FCe.convert,FCe.convertColorSpace,FCe.convertToTexture,FCe.countLeadingZeros,FCe.countOneBits,FCe.countTrailingZeros,FCe.cos),hLe=(FCe.cross,FCe.cubeTexture,FCe.cubeTextureBase,FCe.dFdx,FCe.dFdy,FCe.dashSize,FCe.debug,FCe.decrement,FCe.decrementBefore,FCe.defaultBuildStages,FCe.defaultShaderStages,FCe.defined,FCe.degrees,FCe.deltaTime,FCe.densityFog,FCe.densityFogFactor,FCe.depth,FCe.depthPass,FCe.determinant,FCe.difference,FCe.diffuseColor,FCe.directPointLight,FCe.directionToColor,FCe.directionToFaceDirection,FCe.dispersion,FCe.distance,FCe.div,FCe.dodge,FCe.dot,FCe.drawIndex,FCe.dynamicBufferAttribute,FCe.element,FCe.emissive,FCe.equal,FCe.equals,FCe.equirectUV,FCe.exp),pLe=(FCe.exp2,FCe.expression,FCe.faceDirection,FCe.faceForward,FCe.faceforward,FCe.float),fLe=(FCe.floatBitsToInt,FCe.floatBitsToUint,FCe.floor,FCe.fog,FCe.fract,FCe.frameGroup,FCe.frameId,FCe.frontFacing,FCe.fwidth,FCe.gain,FCe.gapSize,FCe.getConstNodeType,FCe.getCurrentStack,FCe.getDirection,FCe.getDistanceAttenuation,FCe.getGeometryRoughness,FCe.getNormalFromDepth,FCe.interleavedGradientNoise,FCe.vogelDiskSample,FCe.getParallaxCorrectNormal,FCe.getRoughness,FCe.getScreenPosition,FCe.getShIrradianceAt,FCe.getShadowMaterial,FCe.getShadowRenderObjectFunction,FCe.getTextureIndex,FCe.getViewPosition,FCe.globalId,FCe.glsl,FCe.glslFn,FCe.grayscale,FCe.greaterThan,FCe.greaterThanEqual,FCe.hash,FCe.highpModelNormalViewMatrix,FCe.highpModelViewMatrix,FCe.hue,FCe.increment,FCe.incrementBefore,FCe.instance,FCe.instanceIndex),mLe=(FCe.instancedArray,FCe.instancedBufferAttribute,FCe.instancedDynamicBufferAttribute,FCe.instancedMesh,FCe.int,FCe.intBitsToFloat,FCe.inverse,FCe.inverseSqrt,FCe.inversesqrt,FCe.invocationLocalIndex,FCe.invocationSubgroupIndex,FCe.ior,FCe.iridescence,FCe.iridescenceIOR,FCe.iridescenceThickness,FCe.ivec2,FCe.ivec3,FCe.ivec4,FCe.js,FCe.label,FCe.length,FCe.lengthSq,FCe.lessThan,FCe.lessThanEqual,FCe.lightPosition,FCe.lightProjectionUV,FCe.lightShadowMatrix,FCe.lightTargetDirection,FCe.lightTargetPosition,FCe.lightViewPosition,FCe.lightingContext,FCe.lights,FCe.linearDepth,FCe.linearToneMapping,FCe.localId,FCe.log,FCe.log2,FCe.logarithmicDepthToViewZ,FCe.luminance,FCe.mat2,FCe.mat3,FCe.mat4,FCe.matcapUV,FCe.materialAO,FCe.materialAlphaTest,FCe.materialAnisotropy,FCe.materialAnisotropyVector,FCe.materialAttenuationColor,FCe.materialAttenuationDistance,FCe.materialClearcoat,FCe.materialClearcoatNormal,FCe.materialClearcoatRoughness,FCe.materialColor,FCe.materialDispersion,FCe.materialEmissive,FCe.materialEnvIntensity,FCe.materialEnvRotation,FCe.materialIOR,FCe.materialIridescence,FCe.materialIridescenceIOR,FCe.materialIridescenceThickness,FCe.materialLightMap,FCe.materialLineDashOffset,FCe.materialLineDashSize,FCe.materialLineGapSize,FCe.materialLineScale,FCe.materialLineWidth,FCe.materialMetalness,FCe.materialNormal,FCe.materialOpacity,FCe.materialPointSize,FCe.materialReference,FCe.materialReflectivity,FCe.materialRefractionRatio,FCe.materialRotation,FCe.materialRoughness,FCe.materialSheen,FCe.materialSheenRoughness,FCe.materialShininess,FCe.materialSpecular,FCe.materialSpecularColor,FCe.materialSpecularIntensity,FCe.materialSpecularStrength,FCe.materialThickness,FCe.materialTransmission,FCe.max,FCe.maxMipLevel,FCe.mediumpModelViewMatrix,FCe.metalness,FCe.min,FCe.mix,FCe.mixElement,FCe.mod,FCe.modInt,FCe.modelDirection,FCe.modelNormalMatrix,FCe.modelPosition,FCe.modelRadius,FCe.modelScale,FCe.modelViewMatrix,FCe.modelViewPosition,FCe.modelViewProjection,FCe.modelWorldMatrix,FCe.modelWorldMatrixInverse,FCe.morphReference,FCe.mrt,FCe.mul,FCe.mx_aastep,FCe.mx_add,FCe.mx_atan2,FCe.mx_cell_noise_float,FCe.mx_contrast,FCe.mx_divide,FCe.mx_fractal_noise_float,FCe.mx_fractal_noise_vec2,FCe.mx_fractal_noise_vec3,FCe.mx_fractal_noise_vec4,FCe.mx_frame,FCe.mx_heighttonormal,FCe.mx_hsvtorgb,FCe.mx_ifequal,FCe.mx_ifgreater,FCe.mx_ifgreatereq,FCe.mx_invert,FCe.mx_modulo,FCe.mx_multiply,FCe.mx_noise_float,FCe.mx_noise_vec3,FCe.mx_noise_vec4,FCe.mx_place2d,FCe.mx_power,FCe.mx_ramp4,FCe.mx_ramplr,FCe.mx_ramptb,FCe.mx_rgbtohsv,FCe.mx_rotate2d,FCe.mx_rotate3d,FCe.mx_safepower,FCe.mx_separate,FCe.mx_splitlr,FCe.mx_splittb,FCe.mx_srgb_texture_to_lin_rec709,FCe.mx_subtract,FCe.mx_timer,FCe.mx_transform_uv,FCe.mx_unifiednoise2d,FCe.mx_unifiednoise3d,FCe.mx_worley_noise_float,FCe.mx_worley_noise_vec2,FCe.mx_worley_noise_vec3,FCe.negate),gLe=(FCe.neutralToneMapping,FCe.nodeArray,FCe.nodeImmutable,FCe.nodeObject,FCe.nodeObjectIntent,FCe.nodeObjects,FCe.nodeProxy,FCe.nodeProxyIntent,FCe.normalFlat,FCe.normalGeometry,FCe.normalLocal,FCe.normalMap,FCe.normalView,FCe.normalViewGeometry,FCe.normalWorld,FCe.normalWorldGeometry,FCe.normalize,FCe.not,FCe.notEqual,FCe.numWorkgroups,FCe.objectDirection,FCe.objectGroup,FCe.objectPosition,FCe.objectRadius,FCe.objectScale,FCe.objectViewPosition,FCe.objectWorldMatrix,FCe.OnBeforeObjectUpdate,FCe.OnBeforeMaterialUpdate,FCe.OnObjectUpdate,FCe.OnMaterialUpdate,FCe.oneMinus,FCe.or,FCe.orthographicDepthToViewZ,FCe.oscSawtooth,FCe.oscSine,FCe.oscSquare,FCe.oscTriangle,FCe.output,FCe.outputStruct,FCe.overlay,FCe.overloadingFn,FCe.packHalf2x16,FCe.packSnorm2x16,FCe.packUnorm2x16,FCe.parabola,FCe.parallaxDirection,FCe.parallaxUV,FCe.parameter,FCe.pass,FCe.passTexture,FCe.pcurve,FCe.perspectiveDepthToViewZ,FCe.pmremTexture,FCe.pointShadow,FCe.pointUV,FCe.pointWidth,FCe.positionGeometry,FCe.positionLocal,FCe.positionPrevious,FCe.positionView,FCe.positionViewDirection,FCe.positionWorld,FCe.positionWorldDirection,FCe.posterize,FCe.pow,FCe.pow2,FCe.pow3,FCe.pow4,FCe.premultiplyAlpha,FCe.property,FCe.radians,FCe.rand,FCe.range,FCe.rangeFog,FCe.rangeFogFactor,FCe.reciprocal,FCe.reference,FCe.referenceBuffer,FCe.reflect,FCe.reflectVector,FCe.reflectView,FCe.reflector,FCe.refract,FCe.refractVector,FCe.refractView,FCe.reinhardToneMapping,FCe.remap,FCe.remapClamp,FCe.renderGroup,FCe.renderOutput,FCe.rendererReference,FCe.replaceDefaultUV,FCe.rotate,FCe.rotateUV,FCe.roughness,FCe.round,FCe.rtt,FCe.sRGBTransferEOTF,FCe.sRGBTransferOETF,FCe.sample,FCe.sampler,FCe.samplerComparison,FCe.saturate,FCe.saturation,FCe.screen,FCe.screenCoordinate,FCe.screenDPR,FCe.screenSize,FCe.screenUV,FCe.scriptable,FCe.scriptableValue,FCe.select,FCe.setCurrentStack,FCe.setName,FCe.shaderStages,FCe.shadow,FCe.shadowPositionWorld,FCe.shapeCircle,FCe.sharedUniformGroup,FCe.sheen,FCe.sheenRoughness,FCe.shiftLeft,FCe.shiftRight,FCe.shininess,FCe.sign,FCe.sin),vLe=(FCe.sinc,FCe.skinning,FCe.smoothstep,FCe.smoothstepElement,FCe.specularColor,FCe.specularF90,FCe.spherizeUV,FCe.split,FCe.spritesheetUV,FCe.sqrt),ALe=(FCe.stack,FCe.step,FCe.stepElement,FCe.storage),yLe=(FCe.storageBarrier,FCe.storageObject,FCe.storageTexture,FCe.string,FCe.struct,FCe.sub,FCe.subgroupAdd,FCe.subgroupAll,FCe.subgroupAnd,FCe.subgroupAny,FCe.subgroupBallot,FCe.subgroupBroadcast,FCe.subgroupBroadcastFirst,FCe.subBuild,FCe.subgroupElect,FCe.subgroupExclusiveAdd,FCe.subgroupExclusiveMul,FCe.subgroupInclusiveAdd,FCe.subgroupInclusiveMul,FCe.subgroupIndex,FCe.subgroupMax,FCe.subgroupMin,FCe.subgroupMul,FCe.subgroupOr,FCe.subgroupShuffle,FCe.subgroupShuffleDown,FCe.subgroupShuffleUp,FCe.subgroupShuffleXor,FCe.subgroupSize,FCe.subgroupXor,FCe.tan,FCe.tangentGeometry,FCe.tangentLocal,FCe.tangentView,FCe.tangentWorld,FCe.texture,FCe.texture3D,FCe.textureBarrier,FCe.textureBicubic,FCe.textureBicubicLevel,FCe.textureCubeUV,FCe.textureLoad,FCe.textureSize,FCe.textureLevel,FCe.textureStore,FCe.thickness,FCe.time,FCe.toneMapping,FCe.toneMappingExposure,FCe.toonOutlinePass,FCe.transformDirection,FCe.transformNormal,FCe.transformNormalToView,FCe.transformedClearcoatNormalView,FCe.transformedNormalView,FCe.transformedNormalWorld,FCe.transmission,FCe.transpose,FCe.triNoise3D,FCe.triplanarTexture,FCe.triplanarTextures,FCe.trunc,FCe.uint,FCe.uintBitsToFloat,FCe.uniform),bLe=(FCe.uniformArray,FCe.uniformCubeTexture,FCe.uniformGroup,FCe.uniformFlow,FCe.uniformTexture,FCe.unpackHalf2x16,FCe.unpackSnorm2x16,FCe.unpackUnorm2x16,FCe.unpremultiplyAlpha,FCe.userData,FCe.uv,FCe.uvec2,FCe.uvec3,FCe.uvec4,FCe.varying,FCe.varyingProperty,FCe.vec2,FCe.vec3,FCe.vec4,FCe.vectorComponents,FCe.velocity,FCe.vertexColor,FCe.vertexIndex,FCe.vertexStage,FCe.vibrance,FCe.viewZToLogarithmicDepth,FCe.viewZToOrthographicDepth,FCe.viewZToPerspectiveDepth,FCe.viewport,FCe.viewportCoordinate,FCe.viewportDepthTexture,FCe.viewportLinearDepth,FCe.viewportMipTexture,FCe.viewportResolution,FCe.viewportSafeUV,FCe.viewportSharedTexture,FCe.viewportSize,FCe.viewportTexture,FCe.viewportUV,FCe.wgsl,FCe.wgslFn,FCe.workgroupArray,FCe.workgroupBarrier,FCe.workgroupId,FCe.workingToColorSpace,FCe.xor,new UJ),xLe=new vJ;class _Le extends Y4{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new _1([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new _1([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new o5(t,6,1);return this.setAttribute("instanceStart",new d2(n,3,0)),this.setAttribute("instanceEnd",new d2(n,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new o5(t,6,1);return this.setAttribute("instanceColorStart",new d2(n,3,0)),this.setAttribute("instanceColorEnd",new d2(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new J3(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new UJ);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),bLe.setFromBufferAttribute(t),this.boundingBox.union(bLe))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new a0),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,a=e.count;i<a;i++)xLe.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(xLe)),xLe.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(xLe));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}N5.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new mJ(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},k5.line={uniforms:K1.merge([N5.common,N5.fog,N5.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );\n\t\t\t\tvec3 worldUp = normalize( cross( worldDir, tmpFwd ) );\n\t\t\t\tvec3 worldFwd = cross( worldDir, worldUp );\n\t\t\t\tworldPos = position.y < 0.5 ? start: end;\n\n\t\t\t\t// height offset\n\t\t\t\tfloat hw = linewidth * 0.5;\n\t\t\t\tworldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// cap extension\n\t\t\t\t\tworldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;\n\n\t\t\t\t\t// add width to the box\n\t\t\t\t\tworldPos.xyz += worldFwd * hw;\n\n\t\t\t\t\t// endcaps\n\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\tworldPos.xyz -= worldFwd * 2.0 * hw;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat alpha = opacity;\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class wLe extends X1{constructor(e){super({type:"LineMaterial",uniforms:K1.clone(k5.line.uniforms),vertexShader:k5.line.vertexShader,fragmentShader:k5.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){!0===e!==this.dashed&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(!0===e!==this.alphaToCoverage&&(this.needsUpdate=!0),!0===e?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const SLe=new DJ,TLe=new vJ,CLe=new vJ,MLe=new DJ,ELe=new DJ,PLe=new DJ,NLe=new vJ,kLe=new f0,RLe=new class{constructor(e=new vJ,t=new vJ){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){h5.subVectors(e,this.start),p5.subVectors(this.end,this.start);const n=p5.dot(p5);let r=p5.dot(h5)/n;return t&&(r=cJ(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}distanceSqToLine3(e,t=v5,n=A5){const r=1e-8*1e-8;let i,a;const o=this.start,s=e.start,l=this.end,c=e.end;f5.subVectors(l,o),m5.subVectors(c,s),g5.subVectors(o,s);const u=f5.dot(f5),d=m5.dot(m5),h=m5.dot(g5);if(u<=r&&d<=r)return t.copy(o),n.copy(s),t.sub(n),t.dot(t);if(u<=r)i=0,a=h/d,a=cJ(a,0,1);else{const e=f5.dot(g5);if(d<=r)a=0,i=cJ(-e/u,0,1);else{const t=f5.dot(m5),n=u*d-t*t;i=0!==n?cJ((t*h-e*d)/n,0,1):0,a=(t*i+h)/d,a<0?(a=0,i=cJ(-e/u,0,1)):a>1&&(a=1,i=cJ((t-e)/u,0,1))}}return t.copy(o).add(f5.multiplyScalar(i)),n.copy(s).add(m5.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},LLe=new vJ,OLe=new UJ,jLe=new a0,DLe=new DJ;let ILe,BLe;function FLe(e,t,n){return DLe.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),DLe.multiplyScalar(1/DLe.w),DLe.x=BLe/n.width,DLe.y=BLe/n.height,DLe.applyMatrix4(e.projectionMatrixInverse),DLe.multiplyScalar(1/DLe.w),Math.abs(Math.max(DLe.x,DLe.y))}class zLe extends V1{constructor(e=new _Le,t=new wLe({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let a=0,o=0,s=t.count;a<s;a++,o+=2)TLe.fromBufferAttribute(t,a),CLe.fromBufferAttribute(n,a),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+TLe.distanceTo(CLe);const i=new o5(r,2,1);return e.setAttribute("instanceDistanceStart",new d2(i,1,0)),e.setAttribute("instanceDistanceEnd",new d2(i,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;null!==r||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const i=void 0!==e.params.Line2&&e.params.Line2.threshold||0;ILe=e.ray;const a=this.matrixWorld,o=this.geometry,s=this.material;let l,c;if(BLe=s.linewidth+i,null===o.boundingSphere&&o.computeBoundingSphere(),jLe.copy(o.boundingSphere).applyMatrix4(a),n)l=.5*BLe;else{l=FLe(r,Math.max(r.near,jLe.distanceToPoint(ILe.origin)),s.resolution)}if(jLe.radius+=l,!1!==ILe.intersectsSphere(jLe)){if(null===o.boundingBox&&o.computeBoundingBox(),OLe.copy(o.boundingBox).applyMatrix4(a),n)c=.5*BLe;else{c=FLe(r,Math.max(r.near,OLe.distanceToPoint(ILe.origin)),s.resolution)}OLe.expandByScalar(c),!1!==ILe.intersectsBox(OLe)&&(n?function(e,t){const n=e.matrixWorld,r=e.geometry,i=r.attributes.instanceStart,a=r.attributes.instanceEnd;for(let o=0,s=Math.min(r.instanceCount,i.count);o<s;o++){RLe.start.fromBufferAttribute(i,o),RLe.end.fromBufferAttribute(a,o),RLe.applyMatrix4(n);const r=new vJ,s=new vJ;ILe.distanceSqToSegment(RLe.start,RLe.end,s,r),s.distanceTo(r)<.5*BLe&&t.push({point:s,pointOnLine:r,distance:ILe.origin.distanceTo(s),object:e,face:null,faceIndex:o,uv:null,uv1:null})}}(this,t):function(e,t,n){const r=t.projectionMatrix,i=e.material.resolution,a=e.matrixWorld,o=e.geometry,s=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,s.count),u=-t.near;ILe.at(1,PLe),PLe.w=1,PLe.applyMatrix4(t.matrixWorldInverse),PLe.applyMatrix4(r),PLe.multiplyScalar(1/PLe.w),PLe.x*=i.x/2,PLe.y*=i.y/2,PLe.z=0,NLe.copy(PLe),kLe.multiplyMatrices(t.matrixWorldInverse,a);for(let d=0,h=c;d<h;d++){if(MLe.fromBufferAttribute(s,d),ELe.fromBufferAttribute(l,d),MLe.w=1,ELe.w=1,MLe.applyMatrix4(kLe),ELe.applyMatrix4(kLe),MLe.z>u&&ELe.z>u)continue;if(MLe.z>u){const e=MLe.z-ELe.z,t=(MLe.z-u)/e;MLe.lerp(ELe,t)}else if(ELe.z>u){const e=ELe.z-MLe.z,t=(ELe.z-u)/e;ELe.lerp(MLe,t)}MLe.applyMatrix4(r),ELe.applyMatrix4(r),MLe.multiplyScalar(1/MLe.w),ELe.multiplyScalar(1/ELe.w),MLe.x*=i.x/2,MLe.y*=i.y/2,ELe.x*=i.x/2,ELe.y*=i.y/2,RLe.start.copy(MLe),RLe.start.z=0,RLe.end.copy(ELe),RLe.end.z=0;const t=RLe.closestPointToPointParameter(NLe,!0);RLe.at(t,LLe);const o=fJ.lerp(MLe.z,ELe.z,t),c=o>=-1&&o<=1,h=NLe.distanceTo(LLe)<.5*BLe;if(c&&h){RLe.start.fromBufferAttribute(s,d),RLe.end.fromBufferAttribute(l,d),RLe.start.applyMatrix4(a),RLe.end.applyMatrix4(a);const t=new vJ,r=new vJ;ILe.distanceSqToSegment(RLe.start,RLe.end,r,t),n.push({point:r,pointOnLine:t,distance:ILe.origin.distanceTo(r),object:e,face:null,faceIndex:d,uv:null,uv1:null})}}}(this,r,t))}}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(SLe),this.material.uniforms.resolution.value.set(SLe.z,SLe.w))}}class ULe extends _Le{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}setFromPoints(e){const t=e.length-1,n=new Float32Array(6*t);for(let r=0;r<t;r++)n[6*r]=e[r].x,n[6*r+1]=e[r].y,n[6*r+2]=e[r].z||0,n[6*r+3]=e[r+1].x,n[6*r+4]=e[r+1].y,n[6*r+5]=e[r+1].z||0;return super.setPositions(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class VLe extends zLe{constructor(e=new ULe,t=new wLe({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class GLe extends K3{constructor(e,t={}){const n=t.font;if(void 0===n)super();else{const r=n.generateShapes(e,t.size,t.direction);void 0===t.depth&&(t.depth=50),void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t)}this.type="TextGeometry"}}class qLe{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100,n="ltr"){const r=[],i=function(e,t,n,r){const i=Array.from(e),a=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*a,s=[];let l=0,c=0;"rtl"!=r&&"tb"!=r||i.reverse();for(let u=0;u<i.length;u++){const e=i[u];if("\n"===e)l=0,c-=o;else{const t=WLe(e,a,l,c,n);"tb"==r?(l=0,c+=n.ascender*a):l+=t.offsetX,s.push(t.path)}}return s}(e,t,this.data,n);for(let a=0,o=i.length;a<o;a++)r.push(...i[a].toShapes());return r}}function WLe(e,t,n,r,i){const a=i.glyphs[e]||i.glyphs["?"];if(!a)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const o=new y5;let s,l,c,u,d,h,p,f;if(a.o){const e=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let i=0,a=e.length;i<a;){switch(e[i++]){case"m":s=e[i++]*t+n,l=e[i++]*t+r,o.moveTo(s,l);break;case"l":s=e[i++]*t+n,l=e[i++]*t+r,o.lineTo(s,l);break;case"q":c=e[i++]*t+n,u=e[i++]*t+r,d=e[i++]*t+n,h=e[i++]*t+r,o.quadraticCurveTo(d,h,c,u);break;case"b":c=e[i++]*t+n,u=e[i++]*t+r,d=e[i++]*t+n,h=e[i++]*t+r,p=e[i++]*t+n,f=e[i++]*t+r,o.bezierCurveTo(d,h,p,f,c,u)}}}return{offsetX:a.ha*t,path:o}}function HLe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function $Le(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function KLe(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function XLe(e,t,n){return t=iOe(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,oOe()?Reflect.construct(t,n||[],iOe(e).constructor):t.apply(e,n))}function YLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function QLe(e,t){return e.get($Le(e,t))}function ZLe(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function JLe(e,t,n){return e.set($Le(e,t),n),n}function eOe(e,t,n){if(oOe())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,t),new(e.bind.apply(e,r))}function tOe(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mOe(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function nOe(e,t,n){return(t=mOe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rOe(){return rOe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=iOe(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},rOe.apply(null,arguments)}function iOe(e){return iOe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},iOe(e)}function aOe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dOe(e,t)}function oOe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(oOe=function(){return!!e})()}function sOe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lOe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sOe(Object(n),!0).forEach(function(t){nOe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sOe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function cOe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return uOe(c,"_invoke",function(n,r,i){var a,s,l,c=0,u=i||[],d=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,l=e,h.n=n,o}};function p(n,r){for(s=n,l=r,t=0;!d&&c&&!i&&t<u.length;t++){var i,a=u[t],p=h.p,f=a[2];n>3?(i=f===r)&&(l=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<f&&(i=n<3||a[0]>r||r>f)&&(a[4]=n,a[5]=r,h.n=f,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,u,f){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,f),s=u,l=f;(t=s<2?e:l)||!d;){a||(s?s<3?(s>1&&(h.n=-1),p(s,l)):h.n=l:h.v=l);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(d=h.n<0)?l:n.call(r,h))!==o)break}catch(t){a=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(n,i,a),!0),c}var o={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(uOe(t={},r,function(){return this}),t),d=c.prototype=s.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,uOe(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,uOe(d,"constructor",c),uOe(c,"constructor",l),l.displayName="GeneratorFunction",uOe(c,i,"GeneratorFunction"),uOe(d),uOe(d,i,"Generator"),uOe(d,r,function(){return this}),uOe(d,"toString",function(){return"[object Generator]"}),(cOe=function(){return{w:a,m:h}})()}function uOe(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}uOe=function(e,t,n,r){function a(t,n){uOe(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},uOe(e,t,n,r)}function dOe(e,t){return dOe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dOe(e,t)}function hOe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||gOe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pOe(e,t,n,r){var i=rOe(iOe(e.prototype),t,n);return"function"==typeof i?function(e){return i.apply(n,e)}:i}function fOe(e){return function(e){if(Array.isArray(e))return HLe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||gOe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mOe(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function gOe(e,t){if(e){if("string"==typeof e)return HLe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?HLe(e,t):void 0}}var vOe=function(e){e instanceof Array?e.forEach(vOe):(e.map&&e.map.dispose(),e.dispose())},AOe=function(e){e.geometry&&e.geometry.dispose(),e.material&&vOe(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(AOe)},yOe=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),AOe(t)}};function bOe(e,t){var n=new t;return{linkProp:function(t){return{default:n[t](),onChange:function(n,r){r[e][t](n)},triggerUpdate:!1}},linkMethod:function(t){return function(n){for(var r=n[e],i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=r[t].apply(r,a);return s===r?this:s}}}}var xOe=100;function _Oe(){return xOe}function wOe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180,a=xOe*(1+n),o=Math.sin(r);return{x:a*o*Math.cos(i),y:a*Math.cos(r),z:a*o*Math.sin(i)}}function SOe(e){var t=e.x,n=e.y,r=e.z,i=Math.sqrt(t*t+n*n+r*r),a=Math.acos(n/i),o=Math.atan2(r,t);return{lat:90-180*a/Math.PI,lng:90-180*o/Math.PI-(o<-Math.PI/2?360:0),altitude:i/xOe-1}}function TOe(e){return e*Math.PI/180}var COe=window.THREE?window.THREE:{BackSide:1,BufferAttribute:A1,Color:o1,Mesh:V1,ShaderMaterial:X1};var MOe=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.color,a=void 0===i?"gold":i,o=r.size,s=void 0===o?2:o,l=r.coefficient,c=void 0===l?.5:l,u=r.power,d=void 0===u?1:u,h=r.hollowRadius,p=void 0===h?0:h,f=r.backside,m=void 0===f||f;YLe(this,t),n=XLe(this,t);var g=function(e,t){for(var n=e.clone(),r=new Float32Array(3*e.attributes.position.count),i=0,a=r.length;i<a;i++){var o=e.attributes.normal.array[i],s=e.attributes.position.array[i];r[i]=s+o*t}return n.setAttribute("position",new COe.BufferAttribute(r,3)),n}(e,s),v=function(e,t,n,r){return new COe.ShaderMaterial({depthWrite:!1,transparent:!0,vertexShader:"\nuniform float hollowRadius;\n\nvarying vec3 vVertexWorldPosition;\nvarying vec3 vVertexNormal;\nvarying float vCameraDistanceToObjCenter;\nvarying float vVertexAngularDistanceToHollowRadius;\n\nvoid main() {    \n  vVertexNormal\t= normalize(normalMatrix * normal);\n  vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n  \n  vec4 objCenterViewPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n  vCameraDistanceToObjCenter = length(objCenterViewPosition);\n  \n  float edgeAngle = atan(hollowRadius / vCameraDistanceToObjCenter);\n  float vertexAngle = acos(dot(normalize(modelViewMatrix * vec4(position, 1.0)), normalize(objCenterViewPosition)));\n  vVertexAngularDistanceToHollowRadius = vertexAngle - edgeAngle;\n\n  gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"\nuniform vec3 color;\nuniform float coefficient;\nuniform float power;\nuniform float hollowRadius;\n\nvarying vec3 vVertexNormal;\nvarying vec3 vVertexWorldPosition;\nvarying float vCameraDistanceToObjCenter;\nvarying float vVertexAngularDistanceToHollowRadius;\n\nvoid main() {\n  if (vCameraDistanceToObjCenter < hollowRadius) discard; // inside the hollowRadius\n  if (vVertexAngularDistanceToHollowRadius < 0.0) discard; // frag position is within the hollow radius\n\n  vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;\n  vec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;\n  viewCameraToVertex = normalize(viewCameraToVertex);\n  float intensity\t= pow(\n    coefficient + dot(vVertexNormal, viewCameraToVertex),\n    power\n  );\n  gl_FragColor = vec4(color, intensity);\n}",uniforms:{coefficient:{value:e},color:{value:new COe.Color(t)},power:{value:n},hollowRadius:{value:r}}})}(c,a,d,p);return m&&(v.side=COe.BackSide),n.geometry=g,n.material=v,n}return aOe(t,e),tOe(t)}(COe.Mesh),EOe=window.THREE?window.THREE:{Color:o1,Group:a2,LineBasicMaterial:C2,LineSegments:B2,Mesh:V1,MeshPhongMaterial:a4,SphereGeometry:Q3,SRGBColorSpace:MZ,TextureLoader:R4},POe=J7({props:{globeImageUrl:{},bumpImageUrl:{},showGlobe:{default:!0,onChange:function(e,t){t.globeGroup.visible=!!e},triggerUpdate:!1},showGraticules:{default:!1,onChange:function(e,t){t.graticulesObj.visible=!!e},triggerUpdate:!1},showAtmosphere:{default:!0,onChange:function(e,t){t.atmosphereObj&&(t.atmosphereObj.visible=!!e)},triggerUpdate:!1},atmosphereColor:{default:"lightskyblue"},atmosphereAltitude:{default:.15},globeCurvatureResolution:{default:4},globeTileEngineUrl:{onChange:function(e,t){t.tileEngine.tileUrl=e}},globeTileEngineMaxLevel:{default:17,onChange:function(e,t){t.tileEngine.maxLevel=e},triggerUpdate:!1},updatePov:{onChange:function(e,t){t.tileEngine.updatePov(e)},triggerUpdate:!1},onReady:{default:function(){},triggerUpdate:!1}},methods:{globeMaterial:function(e,t){return void 0!==t?(e.globeObj.material=t||e.defaultGlobeMaterial,this):e.globeObj.material},globeTileEngineClearCache:function(e){e.tileEngine.clearTiles()},_destructor:function(e){yOe(e.globeObj),yOe(e.tileEngine),yOe(e.graticulesObj)}},stateInit:function(){var e=new EOe.MeshPhongMaterial({color:0}),t=new EOe.Mesh(void 0,e);t.rotation.y=-Math.PI/2;var n=new _ee(xOe),r=new EOe.Group;return r.__globeObjType="globe",r.add(t),r.add(n),{globeGroup:r,globeObj:t,graticulesObj:new EOe.LineSegments(new Nte(Dte(),xOe,2),new EOe.LineBasicMaterial({color:"lightgrey",transparent:!0,opacity:.1})),defaultGlobeMaterial:e,tileEngine:n}},init:function(e,t){yOe(e),t.scene=e,t.scene.add(t.globeGroup),t.scene.add(t.graticulesObj),t.ready=!1},update:function(e,t){var n=e.globeObj.material;if(e.tileEngine.visible=!(e.globeObj.visible=!e.globeTileEngineUrl),t.hasOwnProperty("globeCurvatureResolution")){var r;null===(r=e.globeObj.geometry)||void 0===r||r.dispose();var i=Math.max(4,Math.round(360/e.globeCurvatureResolution));e.globeObj.geometry=new EOe.SphereGeometry(xOe,i,i/2),e.tileEngine.curvatureResolution=e.globeCurvatureResolution}if(t.hasOwnProperty("globeImageUrl")&&(e.globeImageUrl?(new EOe.TextureLoader).load(e.globeImageUrl,function(t){t.colorSpace=EOe.SRGBColorSpace,n.map=t,n.color=null,n.needsUpdate=!0,!e.ready&&(e.ready=!0)&&setTimeout(e.onReady)}):!n.color&&(n.color=new EOe.Color(0))),t.hasOwnProperty("bumpImageUrl")&&(e.bumpImageUrl?e.bumpImageUrl&&(new EOe.TextureLoader).load(e.bumpImageUrl,function(e){n.bumpMap=e,n.needsUpdate=!0}):(n.bumpMap=null,n.needsUpdate=!0)),(t.hasOwnProperty("atmosphereColor")||t.hasOwnProperty("atmosphereAltitude"))&&(e.atmosphereObj&&(e.scene.remove(e.atmosphereObj),yOe(e.atmosphereObj)),e.atmosphereColor&&e.atmosphereAltitude)){var a=e.atmosphereObj=new MOe(e.globeObj.geometry,{color:e.atmosphereColor,size:xOe*e.atmosphereAltitude,hollowRadius:xOe,coefficient:.1,power:3.5});a.visible=!!e.showAtmosphere,a.__globeObjType="atmosphere",e.scene.add(a)}e.ready||e.globeImageUrl&&!e.globeTileEngineUrl||(e.ready=!0,e.onReady())}}),NOe=function(e){return isNaN(e)?parseInt(ene(e).toHex(),16):e},kOe=function(e){return e&&isNaN(e)?sC(e).opacity:1},ROe=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1,a=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.eE+-]+)\s*\)$/.exec(e.trim().toLowerCase());if(a){var o=hOe(a.slice(1),4),s=o[0],l=o[1],c=o[2],u=o[3];t=new o1("rgb(".concat(+s,",").concat(+l,",").concat(+c,")")),i=Math.min(+u,1)}else t=new o1(e);r&&t.convertLinearToSRGB();var d=t.toArray();return n?[].concat(fOe(d),[i]):d};var LOe=window.THREE?window.THREE:{BufferAttribute:A1};function OOe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float32Array;if(1===t)return new LOe.BufferAttribute(new n(e),t);for(var r=new LOe.BufferAttribute(new n(e.length*t),t),i=0,a=e.length;i<a;i++)r.set(e[i],i*t);return r}var jOe=new WeakMap,DOe=new WeakMap,IOe=new WeakMap,BOe=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.dataBindAttr,a=void 0===i?"__data":i,o=r.objBindAttr,s=void 0===o?"__threeObj":o,l=r.removeDelay,c=void 0===l?0:l;return YLe(this,t),nOe(n=XLe(this,t),"scene",void 0),ZLe(n,jOe,void 0),ZLe(n,DOe,void 0),ZLe(n,IOe,void 0),n.scene=e,JLe(jOe,n,a),JLe(DOe,n,s),JLe(IOe,n,c),n.onRemoveObj(function(){}),n}return aOe(t,e),tOe(t,[{key:"onCreateObj",value:function(e){var n=this;return pOe(t,"onCreateObj",this)([function(t){var r=e(t);return t[QLe(DOe,n)]=r,r[QLe(jOe,n)]=t,n.scene.add(r),r}]),this}},{key:"onRemoveObj",value:function(e){var n=this;return pOe(t,"onRemoveObj",this)([function(r,i){var a=pOe(t,"getData",n)([r]);e(r,i);var o=function(){n.scene.remove(r),yOe(r),delete a[QLe(DOe,n)]};QLe(IOe,n)?setTimeout(o,QLe(IOe,n)):o()}]),this}}])}(Wne),FOe=window.THREE?window.THREE:{BufferGeometry:N1,CylinderGeometry:Q2,Matrix4:f0,Mesh:V1,MeshLambertMaterial:l4,Object3D:U0,Vector3:vJ},zOe=Object.assign({},t),UOe=zOe.BufferGeometryUtils||zOe,VOe=J7({props:{pointsData:{default:[]},pointLat:{default:"lat"},pointLng:{default:"lng"},pointColor:{default:function(){return"#ffffaa"}},pointAltitude:{default:.1},pointRadius:{default:.25},pointResolution:{default:12,triggerUpdate:!1},pointsMerge:{default:!1},pointsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjPoint"})},update:function(e,t){var n=Yte(e.pointLat),r=Yte(e.pointLng),i=Yte(e.pointAltitude),a=Yte(e.pointRadius),o=Yte(e.pointColor),s=new FOe.CylinderGeometry(1,1,1,e.pointResolution);s.applyMatrix4((new FOe.Matrix4).makeRotationX(Math.PI/2)),s.applyMatrix4((new FOe.Matrix4).makeTranslation(0,0,-.5));var l=2*Math.PI*xOe/360,c={};if(!e.pointsMerge&&t.hasOwnProperty("pointsMerge")&&yOe(e.scene),e.dataMapper.scene=e.pointsMerge?new FOe.Object3D:e.scene,e.dataMapper.onCreateObj(function(){var e=new FOe.Mesh(s);return e.__globeObjType="point",e}).onUpdateObj(function(t,s){var u=function(n){var r=t.__currentTargetD=n,i=r.r,a=r.alt,o=r.lat,s=r.lng;Object.assign(t.position,wOe(o,s));var c=e.pointsMerge?new FOe.Vector3(0,0,0):e.scene.localToWorld(new FOe.Vector3(0,0,0));t.lookAt(c),t.scale.x=t.scale.y=Math.min(30,i)*l,t.scale.z=Math.max(a*xOe,.1)},d={alt:+i(s),r:+a(s),lat:+n(s),lng:+r(s)},h=t.__currentTargetD||Object.assign({},d,{alt:-.001});Object.keys(d).some(function(e){return h[e]!==d[e]})&&(e.pointsMerge||!e.pointsTransitionDuration||e.pointsTransitionDuration<0?u(d):e.tweenGroup.add(new o9(h).to(d,e.pointsTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(u).start()));if(!e.pointsMerge){var p=o(s),f=p?kOe(p):0,m=!!f;t.visible=m,m&&(c.hasOwnProperty(p)||(c[p]=new FOe.MeshLambertMaterial({color:NOe(p),transparent:f<1,opacity:f})),t.material=c[p])}}).digest(e.pointsData),e.pointsMerge){var u=e.pointsData.length?(UOe.mergeGeometries||UOe.mergeBufferGeometries)(e.pointsData.map(function(t){var n=e.dataMapper.getObj(t),r=n.geometry.clone();n.updateMatrix(),r.applyMatrix4(n.matrix);var i=ROe(o(t));return r.setAttribute("color",OOe(Array(r.getAttribute("position").count).fill(i),4)),r})):new FOe.BufferGeometry,d=new FOe.Mesh(u,new FOe.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0}));d.__globeObjType="points",d.__data=e.pointsData,e.dataMapper.clear(),yOe(e.scene),e.scene.add(d)}}}),GOe=function(){return{uniforms:{dashOffset:{value:0},dashSize:{value:1},gapSize:{value:0},dashTranslate:{value:0}},vertexShader:"\n    ".concat(P5.common,"\n    ").concat(P5.logdepthbuf_pars_vertex,"\n  \n    uniform float dashTranslate; \n\n    attribute vec4 color;\n    varying vec4 vColor;\n    \n    attribute float relDistance;\n    varying float vRelDistance;\n\n    void main() {\n      // pass through colors and distances\n      vColor = color;\n      vRelDistance = relDistance + dashTranslate;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  \n      ").concat(P5.logdepthbuf_vertex,"\n    }\n  "),fragmentShader:"\n    ".concat(P5.logdepthbuf_pars_fragment,"\n\n    uniform float dashOffset; \n    uniform float dashSize;\n    uniform float gapSize; \n    \n    varying vec4 vColor;\n    varying float vRelDistance;\n    \n    void main() {\n      // ignore pixels in the gap\n      if (vRelDistance < dashOffset) discard;\n      if (mod(vRelDistance - dashOffset, dashSize + gapSize) > dashSize) discard;\n    \n      // set px color: [r, g, b, a], interpolated between vertices \n      gl_FragColor = vColor; \n  \n      ").concat(P5.logdepthbuf_fragment,"\n    }\n  ")}},qOe=function(e){return e.uniforms.uSurfaceRadius={type:"float",value:0},e.vertexShader=("attribute float surfaceRadius;\nvarying float vSurfaceRadius;\nvarying vec3 vPos;\n"+e.vertexShader).replace("void main() {",["void main() {","vSurfaceRadius = surfaceRadius;","vPos = position;"].join("\n")),e.fragmentShader=("uniform float uSurfaceRadius;\nvarying float vSurfaceRadius;\nvarying vec3 vPos;\n"+e.fragmentShader).replace("void main() {",["void main() {","if (length(vPos) < max(uSurfaceRadius, vSurfaceRadius)) discard;"].join("\n")),e},WOe=function(e){return e.vertexShader="\n    attribute float r;\n    \n    const float PI = 3.1415926535897932384626433832795;\n    float toRad(in float a) {\n      return a * PI / 180.0;\n    }\n    \n    vec3 Polar2Cartesian(in vec3 c) { // [lat, lng, r]\n      float phi = toRad(90.0 - c.x);\n      float theta = toRad(90.0 - c.y);\n      float r = c.z;\n      return vec3( // x,y,z\n        r * sin(phi) * cos(theta),\n        r * cos(phi),\n        r * sin(phi) * sin(theta)\n      );\n    }\n    \n    vec2 Cartesian2Polar(in vec3 p) {\n      float r = sqrt(p.x * p.x + p.y * p.y + p.z * p.z);\n      float phi = acos(p.y / r);\n      float theta = atan(p.z, p.x);\n      return vec2( // lat,lng\n        90.0 - phi * 180.0 / PI,\n        90.0 - theta * 180.0 / PI - (theta < -PI / 2.0 ? 360.0 : 0.0)\n      );\n    }\n    ".concat(e.vertexShader.replace("}","                  \n        vec3 pos = Polar2Cartesian(vec3(Cartesian2Polar(position), r));\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n      }\n    "),"\n  "),e},HOe=function(e,t){return e.onBeforeCompile=function(n){e.userData.shader=t(n)},e},$Oe=["stroke"],KOe=window.THREE?window.THREE:{BufferGeometry:N1,CubicBezierCurve3:c3,Curve:Z2,Group:a2,Line:O2,Mesh:V1,NormalBlending:1,ShaderMaterial:X1,TubeGeometry:Z3,Vector3:vJ},XOe=Hne.default||Hne,YOe=J7({props:{arcsData:{default:[]},arcStartLat:{default:"startLat"},arcStartLng:{default:"startLng"},arcStartAltitude:{default:0},arcEndLat:{default:"endLat"},arcEndLng:{default:"endLng"},arcEndAltitude:{default:0},arcColor:{default:function(){return"#ffffaa"}},arcAltitude:{},arcAltitudeAutoScale:{default:.5},arcStroke:{},arcCurveResolution:{default:64,triggerUpdate:!1},arcCircularResolution:{default:6,triggerUpdate:!1},arcDashLength:{default:1},arcDashGap:{default:0},arcDashInitialGap:{default:0},arcDashAnimateTime:{default:0},arcsTransitionDuration:{default:1e3,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.pause()},resumeAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.resume()},_destructor:function(e){var t;e.sharedMaterial.dispose(),null===(t=e.ticker)||void 0===t||t.dispose()}},stateInit:function(e){return{tweenGroup:e.tweenGroup,ticker:new XOe,sharedMaterial:new KOe.ShaderMaterial(lOe(lOe({},GOe()),{},{transparent:!0,blending:KOe.NormalBlending}))}},init:function(e,t){yOe(e),t.scene=e,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjArc"}).onCreateObj(function(){var e=new KOe.Group;return e.__globeObjType="arc",e}),t.ticker.onTick.add(function(e,n){t.dataMapper.entries().map(function(e){return hOe(e,2)[1]}).filter(function(e){return e.children.length&&e.children[0].material&&e.children[0].__dashAnimateStep}).forEach(function(e){var t=e.children[0],r=t.__dashAnimateStep*n,i=t.material.uniforms.dashTranslate.value%1e9;t.material.uniforms.dashTranslate.value=i+r})})},update:function(e){var t=Yte(e.arcStartLat),n=Yte(e.arcStartLng),r=Yte(e.arcStartAltitude),i=Yte(e.arcEndLat),a=Yte(e.arcEndLng),o=Yte(e.arcEndAltitude),s=Yte(e.arcAltitude),l=Yte(e.arcAltitudeAutoScale),c=Yte(e.arcStroke),u=Yte(e.arcColor),d=Yte(e.arcDashLength),h=Yte(e.arcDashGap),p=Yte(e.arcDashInitialGap),f=Yte(e.arcDashAnimateTime);e.dataMapper.onUpdateObj(function(m,g){var v=c(g),A=null!==v&&void 0!==v;if(!m.children.length||A!==("Mesh"===m.children[0].type)){yOe(m);var y=A?new KOe.Mesh:new KOe.Line(new KOe.BufferGeometry);y.material=e.sharedMaterial.clone(),m.add(y)}var b=m.children[0];Object.assign(b.material.uniforms,{dashSize:{value:d(g)},gapSize:{value:h(g)},dashOffset:{value:p(g)}});var x=f(g);b.__dashAnimateStep=x>0?1e3/x:0;var _=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t+1;if(e instanceof Array||e instanceof Function){var a=e instanceof Array?fM().domain(e.map(function(t,n){return n/(e.length-1)})).range(e):e;n=function(e){return ROe(a(e),!0,!0)}}else{var o=ROe(e,!0,!0);n=function(){return o}}for(var s=[],l=0,c=i;l<c;l++)for(var u=n(l/(c-1)),d=0;d<r;d++)s.push(u);return OOe(s,4)}(u(g),e.arcCurveResolution,A?e.arcCircularResolution+1:1),w=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=0,a=e+1;i<a;i++)for(var o=i/(a-1),s=0;s<t;s++)r.push(o);return n&&r.reverse(),OOe(r,1)}(e.arcCurveResolution,A?e.arcCircularResolution+1:1,!0);b.geometry.setAttribute("color",_),b.geometry.setAttribute("relDistance",w);var S=function(t){var n=m.__currentTargetD=t,r=n.stroke,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(n,$Oe),a=function(e){var t=e.alt,n=e.altAutoScale,r=e.startLat,i=e.startLng,a=e.startAlt,o=e.endLat,s=e.endLng,l=e.endAlt,c=function(e){var t=hOe(e,3),n=t[0],r=wOe(t[1],n,t[2]),i=r.x,a=r.y,o=r.z;return new KOe.Vector3(i,a,o)},u=[i,r],d=[s,o],h=t;if((null===h||void 0===h)&&(h=vte(u,d)/2*n+Math.max(a,l)),h||a||l){var p=Ate(u,d),f=function(e,t){return t+(t-e)*(e<t?.5:.25)},m=[.25,.75].map(function(e){return[].concat(fOe(p(e)),[f(e<.5?a:l,h)])}),g=hOe(m,2),v=g[0],A=g[1];return eOe(KOe.CubicBezierCurve3,fOe([[].concat(u,[a]),v,A,[].concat(d,[l])].map(c)))}var y=.001;return b.apply(void 0,fOe([[].concat(u,[y]),[].concat(d,[y])].map(c)));function b(e,t){var n=e.angleTo(t),r=0===n?function(){return e.clone()}:function(r){return(new KOe.Vector3).addVectors(e.clone().multiplyScalar(Math.sin((1-r)*n)),t.clone().multiplyScalar(Math.sin(r*n))).divideScalar(Math.sin(n))},i=new KOe.Curve;return i.getPoint=r,i}}(i);A?(b.geometry&&b.geometry.dispose(),b.geometry=new KOe.TubeGeometry(a,e.arcCurveResolution,r/2,e.arcCircularResolution),b.geometry.setAttribute("color",_),b.geometry.setAttribute("relDistance",w)):b.geometry.setFromPoints(a.getPoints(e.arcCurveResolution))},T={stroke:v,alt:s(g),altAutoScale:+l(g),startLat:+t(g),startLng:+n(g),startAlt:+r(g),endLat:+i(g),endLng:+a(g),endAlt:+o(g)},C=m.__currentTargetD||Object.assign({},T,{altAutoScale:-.001});Object.keys(T).some(function(e){return C[e]!==T[e]})&&(!e.arcsTransitionDuration||e.arcsTransitionDuration<0?S(T):e.tweenGroup.add(new o9(C).to(T,e.arcsTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(S).start()))}).digest(e.arcsData)}}),QOe=window.THREE?window.THREE:{BufferGeometry:N1,DoubleSide:2,Mesh:V1,MeshLambertMaterial:l4,Object3D:U0},ZOe=Object.assign({},t),JOe=ZOe.BufferGeometryUtils||ZOe,eje=J7({props:{hexBinPointsData:{default:[]},hexBinPointLat:{default:"lat"},hexBinPointLng:{default:"lng"},hexBinPointWeight:{default:1},hexBinResolution:{default:4},hexMargin:{default:.2},hexTopCurvatureResolution:{default:5},hexTopColor:{default:function(){return"#ffffaa"}},hexSideColor:{default:function(){return"#ffffaa"}},hexAltitude:{default:function(e){return.01*e.sumWeight}},hexBinMerge:{default:!1},hexTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjHexbin"})},update:function(e,t){var n=Yte(e.hexBinPointLat),r=Yte(e.hexBinPointLng),i=Yte(e.hexBinPointWeight),a=Yte(e.hexAltitude),o=Yte(e.hexTopColor),s=Yte(e.hexSideColor),l=Yte(e.hexMargin),c=boe(e.hexBinPointsData.map(function(t){return lOe(lOe({},t),{},{h3Idx:ese(n(t),r(t),e.hexBinResolution)})}),"h3Idx"),u=Object.entries(c).map(function(e){var t=hOe(e,2),n=t[0],r=t[1];return{h3Idx:n,points:r,sumWeight:r.reduce(function(e,t){return e+ +i(t)},0)}}),d={};if(!e.hexBinMerge&&t.hasOwnProperty("hexBinMerge")&&yOe(e.scene),e.dataMapper.scene=e.hexBinMerge?new QOe.Object3D:e.scene,e.dataMapper.id(function(e){return e.h3Idx}).onCreateObj(function(e){var t=new QOe.Mesh;t.__hexCenter=tse(e.h3Idx),t.__hexGeoJson=nse(e.h3Idx,!0).reverse();var n=t.__hexCenter[1];return t.__hexGeoJson.forEach(function(e){var t=e[0];Math.abs(n-t)>170&&(e[0]+=n>t?360:-360)}),t.__globeObjType="hexbin",t}).onUpdateObj(function(t,n){var r=Math.max(0,Math.min(1,+l(n))),i=hOe(t.__hexCenter,2),c=i[0],u=i[1],h=0===r?t.__hexGeoJson:t.__hexGeoJson.map(function(e){var t=hOe(e,2),n=t[0],i=t[1];return[[n,u],[i,c]].map(function(e){var t=hOe(e,2);return function(e,t,n){return e-(e-t)*n}(t[0],t[1],r)})}),p=e.hexTopCurvatureResolution;t.geometry&&t.geometry.dispose(),t.geometry=new foe([h],0,xOe,!1,!0,!0,p);var f={alt:+a(n)},m=function(e){var n=(t.__currentTargetD=e).alt;t.scale.x=t.scale.y=t.scale.z=1+n;var r=xOe/(n+1);t.geometry.setAttribute("surfaceRadius",OOe(Array(t.geometry.getAttribute("position").count).fill(r),1))},g=t.__currentTargetD||Object.assign({},f,{alt:-.001});Object.keys(f).some(function(e){return g[e]!==f[e]})&&(e.hexBinMerge||!e.hexTransitionDuration||e.hexTransitionDuration<0?m(f):e.tweenGroup.add(new o9(g).to(f,e.hexTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(m).start()));if(!e.hexBinMerge){var v=s(n),A=o(n);[v,A].forEach(function(e){if(!d.hasOwnProperty(e)){var t=kOe(e);d[e]=HOe(new QOe.MeshLambertMaterial({color:NOe(e),transparent:t<1,opacity:t,side:QOe.DoubleSide}),qOe)}}),t.material=[v,A].map(function(e){return d[e]})}}).digest(u),e.hexBinMerge){var h=u.length?(JOe.mergeGeometries||JOe.mergeBufferGeometries)(u.map(function(t){var n=e.dataMapper.getObj(t),r=n.geometry.toNonIndexed();n.updateMatrix(),r.applyMatrix4(n.matrix);var i=ROe(o(t)),a=ROe(s(t)),l=r.getAttribute("position").count,c=r.groups[0].count;return r.setAttribute("color",OOe(fOe(new Array(l)).map(function(e,t){return t>=c?i:a}),4)),r})):new QOe.BufferGeometry,p=new QOe.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0,side:QOe.DoubleSide});p.onBeforeCompile=function(e){p.userData.shader=qOe(e)};var f=new QOe.Mesh(h,p);f.__globeObjType="hexBinPoints",f.__data=u,e.dataMapper.clear(),yOe(e.scene),e.scene.add(f)}}}),tje=function(e){return e*e},nje=function(e){return e*Math.PI/180};var rje=Math.sqrt(2*Math.PI);var ije=function(e){var t=hOe(e,2),n=t[0],r=t[1],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.lngAccessor,s=void 0===o?function(e){return e[0]}:o,l=a.latAccessor,c=void 0===l?function(e){return e[1]}:l,u=a.weightAccessor,d=void 0===u?function(){return 1}:u,h=a.bandwidth,p=[n,r],f=h*Math.PI/180;return function(e,t){let n=0;if(void 0===t)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}(i.map(function(e){var t=d(e);if(!t)return 0;var n=function(e,t){var n=Math.sqrt,r=Math.cos,i=function(e){return tje(Math.sin(e/2))},a=nje(e[1]),o=nje(t[1]),s=nje(e[0]),l=nje(t[0]);return 2*Math.asin(n(i(o-a)+r(a)*r(o)*i(l-s)))}(p,[s(e),c(e)]);return function(e,t){return Math.exp(-tje(e/t)/2)/(t*rje)}(n,f)*t}))},aje=function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){KLe(a,r,i,o,s,"next",e)}function s(e){KLe(a,r,i,o,s,"throw",e)}o(void 0)})}}(cOe().m(function e(t){var n,r,i,a,o,s,l,c,u,d,h,p,f,m,g,v,A,y,b,x,_,w,S,T,C,M,E,P,N,k,R,L,O,j,D,I,B,F,z,U,V,G,q=arguments;return cOe().w(function(e){for(;;)switch(e.n){case 0:if(r=q.length>1&&void 0!==q[1]?q[1]:[],a=(i=q.length>2&&void 0!==q[2]?q[2]:{}).lngAccessor,o=void 0===a?function(e){return e[0]}:a,s=i.latAccessor,l=void 0===s?function(e){return e[1]}:s,c=i.weightAccessor,u=void 0===c?function(){return 1}:c,d=i.bandwidth,null!==(n=navigator)&&void 0!==n&&n.gpu){e.n=1;break}return console.warn("WebGPU not enabled in browser. Please consider enabling it to improve performance."),e.a(2,t.map(function(e){return ije(e,r,{lngAccessor:o,latAccessor:l,weightAccessor:u,bandwidth:d})}));case 1:return h=sLe,p=lLe,f=yLe,g=pLe,v=fLe,A=cLe,y=vLe,b=gLe,x=dLe,_=uLe,w=hLe,S=mLe,T=(m=ALe)(new g_e(new Float32Array(t.flat().map(nje)),2),"vec2",t.length),C=m(new g_e(new Float32Array(r.map(function(e){return[nje(o(e)),nje(l(e)),u(e)]}).flat()),3),"vec3",r.length),M=new g_e(t.length,1),E=m(M,"float",t.length),P=g(Math.PI),N=y(P.mul(2)),k=function(e){return e.mul(e)},R=function(e){return k(b(e.div(2)))},L=function(e,t){var n=g(e[1]),r=g(t[1]),i=g(e[0]),a=g(t[0]);return g(2).mul(_(y(R(r.sub(n)).add(x(n).mul(x(r)).mul(R(a.sub(i)))))))},O=function(e,t){return w(S(k(e.div(t)).div(2))).div(t.mul(N))},j=f(nje(d)),D=f(nje(4*d)),I=f(r.length),B=h(function(){var e=T.element(v),t=E.element(v);t.assign(0),A(I,function(n){var r=n.i,i=C.element(r),a=i.z;p(a,function(){var n=L(i.xy,e.xy);p(n&&n.lessThan(D),function(){t.addAssign(O(n,j).mul(a))})})})}),F=B().compute(t.length),z=new oLe,e.n=2,z.computeAsync(F);case 2:return U=Array,V=Float32Array,e.n=3,z.getArrayBufferAsync(M);case 3:return G=e.v,e.a(2,U.from.call(U,new V(G)))}},e)}));return function(t){return e.apply(this,arguments)}}(),oje=window.THREE?window.THREE:{Mesh:V1,MeshLambertMaterial:l4,SphereGeometry:Q3},sje=function(e){var t=sC(function(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-14825.05*e)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+707.56*e)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-6838.66*e)))))))+")"}(e));return t.opacity=Math.cbrt(e),t.formatRgb()},lje=J7({props:{heatmapsData:{default:[]},heatmapPoints:{default:function(e){return e}},heatmapPointLat:{default:function(e){return e[0]}},heatmapPointLng:{default:function(e){return e[1]}},heatmapPointWeight:{default:1},heatmapBandwidth:{default:2.5},heatmapColorFn:{default:function(){return sje}},heatmapColorSaturation:{default:1.5},heatmapBaseAltitude:{default:.01},heatmapTopAltitude:{},heatmapsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjHeatmap"}).onCreateObj(function(){var e=new oje.Mesh(new oje.SphereGeometry(xOe),HOe(new oje.MeshLambertMaterial({vertexColors:!0,transparent:!0}),WOe));return e.__globeObjType="heatmap",e})},update:function(e){var t=Yte(e.heatmapPoints),n=Yte(e.heatmapPointLat),r=Yte(e.heatmapPointLng),i=Yte(e.heatmapPointWeight),a=Yte(e.heatmapBandwidth),o=Yte(e.heatmapColorFn),s=Yte(e.heatmapColorSaturation),l=Yte(e.heatmapBaseAltitude),c=Yte(e.heatmapTopAltitude);e.dataMapper.onUpdateObj(function(u,d){var h=a(d),p=o(d),f=s(d),m=l(d),g=c(d),v=t(d).map(function(e){var t=n(e),a=r(e),o=wOe(t,a);return{x:o.x,y:o.y,z:o.z,lat:t,lng:a,weight:i(e)}}),A=Math.max(.1,h/3.5),y=Math.ceil(360/(A||-1));u.geometry.parameters.widthSegments!==y&&(u.geometry.dispose(),u.geometry=new oje.SphereGeometry(xOe,y,y/2));var b=function(e){for(var t=e.itemSize,n=[],r=0;r<e.count;r++)n.push(e.array.slice(r*t,(r+1)*t));return n}(u.geometry.getAttribute("position")),x=b.map(function(e){var t=hOe(e,3),n=SOe({x:t[0],y:t[1],z:t[2]});return[n.lng,n.lat]});aje(x,v,{latAccessor:function(e){return e.lat},lngAccessor:function(e){return e.lng},weightAccessor:function(e){return e.weight},bandwidth:h}).then(function(t){var n=fOe(new Array(100)).map(function(e,t){return ROe(p(t/99))}),r=function(e){var t=u.__currentTargetD=e,r=t.kdeVals,i=t.topAlt,a=t.saturation,o=IM(r.map(Math.abs))||1e-15,s=HM([0,o/a],n);u.geometry.setAttribute("color",OOe(r.map(function(e){return s(Math.abs(e))}),4));var l=fM([0,o],[xOe*(1+m),xOe*(1+(i||m))]);u.geometry.setAttribute("r",OOe(r.map(l)))},i={kdeVals:t,topAlt:g,saturation:f},a=u.__currentTargetD||Object.assign({},i,{kdeVals:t.map(function(){return 0}),topAlt:g?m:g,saturation:.5});a.kdeVals.length!==t.length&&(a.kdeVals=t.slice()),Object.keys(i).some(function(e){return a[e]!==i[e]})&&(!e.heatmapsTransitionDuration||e.heatmapsTransitionDuration<0?r(i):e.tweenGroup.add(new o9(a).to(i,e.heatmapsTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(r).start()))})}).digest(e.heatmapsData)}}),cje=window.THREE?window.THREE:{DoubleSide:2,Group:a2,LineBasicMaterial:C2,LineSegments:B2,Mesh:V1,MeshBasicMaterial:u1},uje=J7({props:{polygonsData:{default:[]},polygonGeoJsonGeometry:{default:"geometry"},polygonSideColor:{default:function(){return"#ffffaa"}},polygonSideMaterial:{},polygonCapColor:{default:function(){return"#ffffaa"}},polygonCapMaterial:{},polygonStrokeColor:{},polygonAltitude:{default:.01},polygonCapCurvatureResolution:{default:5},polygonsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjPolygon"}).id(function(e){return e.id}).onCreateObj(function(){var e=new cje.Group;return e.__defaultSideMaterial=HOe(new cje.MeshBasicMaterial({side:cje.DoubleSide,depthWrite:!0}),qOe),e.__defaultCapMaterial=new cje.MeshBasicMaterial({side:cje.DoubleSide,depthWrite:!0}),e.add(new cje.Mesh(void 0,[e.__defaultSideMaterial,e.__defaultCapMaterial])),e.add(new cje.LineSegments(void 0,new cje.LineBasicMaterial)),e.__globeObjType="polygon",e})},update:function(e){var t=Yte(e.polygonGeoJsonGeometry),n=Yte(e.polygonAltitude),r=Yte(e.polygonCapCurvatureResolution),i=Yte(e.polygonCapColor),a=Yte(e.polygonCapMaterial),o=Yte(e.polygonSideColor),s=Yte(e.polygonSideMaterial),l=Yte(e.polygonStrokeColor),c=[];e.polygonsData.forEach(function(e){var u={data:e,capColor:i(e),capMaterial:a(e),sideColor:o(e),sideMaterial:s(e),strokeColor:l(e),altitude:+n(e),capCurvatureResolution:+r(e)},d=t(e),h=e.__id||"".concat(Math.round(1e9*Math.random()));e.__id=h,"Polygon"===d.type?c.push(lOe({id:"".concat(h,"_0"),coords:d.coordinates},u)):"MultiPolygon"===d.type?c.push.apply(c,fOe(d.coordinates.map(function(e,t){return lOe({id:"".concat(h,"_").concat(t),coords:e},u)}))):console.warn("Unsupported GeoJson geometry type: ".concat(d.type,". Skipping geometry..."))}),e.dataMapper.onUpdateObj(function(t,n){var r=n.coords,i=n.capColor,a=n.capMaterial,o=n.sideColor,s=n.sideMaterial,l=n.strokeColor,c=n.altitude,u=n.capCurvatureResolution,d=hOe(t.children,2),h=d[0],p=d[1],f=!!l;p.visible=f;var m=!(!i&&!a),g=!(!o&&!s);(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return function(e,t){return e===t}};return Object.entries(t).every(function(t){var r=hOe(t,2),i=r[0],a=r[1];return e.hasOwnProperty(i)&&n(i)(e[i],a)})})(h.geometry.parameters||{},{polygonGeoJson:r,curvatureResolution:u,closedTop:m,includeSides:g})||(h.geometry&&h.geometry.dispose(),h.geometry=new foe(r,0,xOe,!1,m,g,u)),!f||p.geometry.parameters&&p.geometry.parameters.geoJson.coordinates===r&&p.geometry.parameters.resolution===u||(p.geometry&&p.geometry.dispose(),p.geometry=new Nte({type:"Polygon",coordinates:r},xOe,u));var v=g?0:-1,A=m?g?1:0:-1;if(v>=0&&(h.material[v]=s||t.__defaultSideMaterial),A>=0&&(h.material[A]=a||t.__defaultCapMaterial),[[!s&&o,v],[!a&&i,A]].forEach(function(e){var t=hOe(e,2),n=t[0],r=t[1];if(n&&!(r<0)){var i=h.material[r],a=kOe(n);i.color.set(NOe(n)),i.transparent=a<1,i.opacity=a}}),f){var y=p.material,b=kOe(l);y.color.set(NOe(l)),y.transparent=b<1,y.opacity=b}var x={alt:c},_=function(e){var n=(t.__currentTargetD=e).alt;h.scale.x=h.scale.y=h.scale.z=1+n,f&&(p.scale.x=p.scale.y=p.scale.z=1+n+1e-4),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};if(e.userData.shader)t(e.userData.shader.uniforms);else{var n=e.onBeforeCompile;e.onBeforeCompile=function(e){n(e),t(e.uniforms)}}}(t.__defaultSideMaterial,function(e){return e.uSurfaceRadius.value=xOe/(n+1)})},w=t.__currentTargetD||Object.assign({},x,{alt:-.001});Object.keys(x).some(function(e){return w[e]!==x[e]})&&(!e.polygonsTransitionDuration||e.polygonsTransitionDuration<0||w.alt===x.alt?_(x):e.tweenGroup.add(new o9(w).to(x,e.polygonsTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(_).start()))}).digest(c)}});var dje=window.THREE?window.THREE:{BufferGeometry:N1,DoubleSide:2,Mesh:V1,MeshLambertMaterial:l4,Vector3:vJ},hje=Object.assign({},t),pje=hje.BufferGeometryUtils||hje,fje=J7({props:{hexPolygonsData:{default:[]},hexPolygonGeoJsonGeometry:{default:"geometry"},hexPolygonColor:{default:function(){return"#ffffaa"}},hexPolygonAltitude:{default:.001},hexPolygonResolution:{default:3},hexPolygonMargin:{default:.2},hexPolygonUseDots:{default:!1},hexPolygonCurvatureResolution:{default:5},hexPolygonDotResolution:{default:12},hexPolygonsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjHexPolygon"}).onCreateObj(function(){var e=new dje.Mesh(void 0,new dje.MeshLambertMaterial({side:dje.DoubleSide}));return e.__globeObjType="hexPolygon",e})},update:function(e){var t=Yte(e.hexPolygonGeoJsonGeometry),n=Yte(e.hexPolygonColor),r=Yte(e.hexPolygonAltitude),i=Yte(e.hexPolygonResolution),a=Yte(e.hexPolygonMargin),o=Yte(e.hexPolygonUseDots),s=Yte(e.hexPolygonCurvatureResolution),l=Yte(e.hexPolygonDotResolution);e.dataMapper.onUpdateObj(function(c,u){var d=t(u),h=i(u),p=r(u),f=Math.max(0,Math.min(1,+a(u))),m=o(u),g=s(u),v=l(u),A=n(u),y=kOe(A);c.material.color.set(NOe(A)),c.material.transparent=y<1,c.material.opacity=y;var b={alt:p,margin:f,curvatureResolution:g},x={geoJson:d,h3Res:h},_=c.__currentTargetD||Object.assign({},b,{alt:-.001}),w=c.__currentMemD||x;if(Object.keys(b).some(function(e){return _[e]!==b[e]})||Object.keys(x).some(function(e){return w[e]!==x[e]})){c.__currentMemD=x;var S=[];"Polygon"===d.type?rse(d.coordinates,h,!0).forEach(function(e){return S.push(e)}):"MultiPolygon"===d.type?d.coordinates.forEach(function(e){return rse(e,h,!0).forEach(function(e){return S.push(e)})}):console.warn("Unsupported GeoJson geometry type: ".concat(d.type,". Skipping geometry..."));var T=S.map(function(e){var t=tse(e),n=nse(e,!0).reverse(),r=t[1];return n.forEach(function(e){var t=e[0];Math.abs(r-t)>170&&(e[0]+=r>t?360:-360)}),{h3Idx:e,hexCenter:t,hexGeoJson:n}}),C=function(e){var t=c.__currentTargetD=e,n=t.alt,r=t.margin,i=t.curvatureResolution;c.geometry&&c.geometry.dispose(),c.geometry=T.length?(pje.mergeGeometries||pje.mergeBufferGeometries)(T.map(function(e){var t=hOe(e.hexCenter,2),a=t[0],o=t[1];if(m){var s=wOe(a,o,n),l=wOe(e.hexGeoJson[0][1],e.hexGeoJson[0][0],n),c=.85*(1-r)*new dje.Vector3(s.x,s.y,s.z).distanceTo(new dje.Vector3(l.x,l.y,l.z)),u=new Y2(c,v);return u.rotateX(TOe(-a)),u.rotateY(TOe(o)),u.translate(s.x,s.y,s.z),u}var d=0===r?e.hexGeoJson:e.hexGeoJson.map(function(e){var t=hOe(e,2),n=t[0],i=t[1];return[[n,o],[i,a]].map(function(e){var t=hOe(e,2);return function(e,t,n){return e-(e-t)*n}(t[0],t[1],r)})});return new foe([d],xOe,xOe*(1+n),!1,!0,!1,i)})):new dje.BufferGeometry};!e.hexPolygonsTransitionDuration||e.hexPolygonsTransitionDuration<0?C(b):e.tweenGroup.add(new o9(_).to(b,e.hexPolygonsTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(C).start())}}).digest(e.hexPolygonsData)}}),mje=window.THREE?window.THREE:{Vector3:vJ};function gje(e,t){var n=Math.max(e.length,t.length),r=RC.apply(void 0,fOe([e,t].map(function(e){return e.map(function(e){return[e.x,e.y,e.z]})}).map(function(e){return function(e,t){var n=e[e.length-1];return[].concat(fOe(e),fOe(Array(t-e.length).fill(n)))}(e,n)})));return function(n){return 0===n?e:1===n?t:r(n).map(function(e){var t=hOe(e,3),n=t[0],r=t[1],i=t[2];return new mje.Vector3(n,r,i)})}}var vje=window.THREE?window.THREE:{BufferGeometry:N1,Color:o1,Group:a2,Line:O2,NormalBlending:1,ShaderMaterial:X1,Vector3:vJ},Aje=Hne.default||Hne,yje=J7({props:{pathsData:{default:[]},pathPoints:{default:function(e){return e}},pathPointLat:{default:function(e){return e[0]}},pathPointLng:{default:function(e){return e[1]}},pathPointAlt:{default:.001},pathResolution:{default:2},pathColor:{default:function(){return"#ffffaa"}},pathStroke:{},pathDashLength:{default:1},pathDashGap:{default:0},pathDashInitialGap:{default:0},pathDashAnimateTime:{default:0},pathTransitionDuration:{default:1e3,triggerUpdate:!1},rendererSize:{}},methods:{pauseAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.pause()},resumeAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.resume()},_destructor:function(e){var t;null===(t=e.ticker)||void 0===t||t.dispose()}},stateInit:function(e){return{tweenGroup:e.tweenGroup,ticker:new Aje,sharedMaterial:new vje.ShaderMaterial(lOe(lOe({},GOe()),{},{transparent:!0,blending:vje.NormalBlending}))}},init:function(e,t){yOe(e),t.scene=e,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjPath"}).onCreateObj(function(){var e=new vje.Group;return e.__globeObjType="path",e}),t.ticker.onTick.add(function(e,n){t.dataMapper.entries().map(function(e){return hOe(e,2)[1]}).filter(function(e){return e.children.length&&e.children[0].material&&e.children[0].__dashAnimateStep}).forEach(function(e){var t=e.children[0],r=t.__dashAnimateStep*n;if("Line"===t.type){var i=t.material.uniforms.dashTranslate.value%1e9;t.material.uniforms.dashTranslate.value=i+r}else if("Line2"===t.type){for(var a=t.material.dashOffset-r,o=t.material.dashSize+t.material.gapSize;a<=-o;)a+=o;t.material.dashOffset=a}})})},update:function(e){var t=Yte(e.pathPoints),n=Yte(e.pathPointLat),r=Yte(e.pathPointLng),i=Yte(e.pathPointAlt),a=Yte(e.pathStroke),o=Yte(e.pathColor),s=Yte(e.pathDashLength),l=Yte(e.pathDashGap),c=Yte(e.pathDashInitialGap),u=Yte(e.pathDashAnimateTime);function d(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t+1;if(e instanceof Array||e instanceof Function){var o=e instanceof Array?fM().domain(e.map(function(t,n){return n/(e.length-1)})).range(e):e;n=function(e){return ROe(o(e),i,!0)}}else{var s=ROe(e,i,!0);n=function(){return s}}for(var l=[],c=0,u=a;c<u;c++)for(var d=n(c/(u-1)),h=0;h<r;h++)l.push(d);return OOe(l,i?4:3)}e.dataMapper.onUpdateObj(function(h,p){var f=a(p),m=null!==f&&void 0!==f;if(!h.children.length||m===("Line"===h.children[0].type)){yOe(h);var g=m?new VLe(new ULe,new wLe):new vje.Line(new vje.BufferGeometry,e.sharedMaterial.clone());h.add(g)}var v=h.children[0],A=function(e,t,n,r,i){var a=function(e,t,n){for(var r=[],i=1;i<=n;i++)r.push(e+(t-e)*i/(n+1));return r},o=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=[],n=null;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(r){if(n){for(;Math.abs(n[1]-r[1])>180;)n[1]+=360*(n[1]<r[1]?1:-1);var i=Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2));if(i>e)for(var o=Math.floor(i/e),s=a(n[0],r[0],o),l=a(n[1],r[1],o),c=a(n[2],r[2],o),u=0,d=s.length;u<d;u++)t.push([s[u],l[u],c[u]])}t.push(n=r)}),t},s=function(e){var t=hOe(e,3),n=wOe(t[0],t[1],t[2]),r=n.x,i=n.y,a=n.z;return new vje.Vector3(r,i,a)};return o(e.map(function(e){return[t(e),n(e),r(e)]}),i).map(s)}(t(p),n,r,i,e.pathResolution),y=u(p);if(v.__dashAnimateStep=y>0?1e3/y:0,m){v.material.resolution=e.rendererSize;var b=s(p),x=l(p),_=c(p);v.material.dashed=x>0,v.material.dashed?v.material.defines.USE_DASH="":delete v.material.defines.USE_DASH,v.material.dashed&&(v.material.dashScale=1/function(e){var t,n=0;return e.forEach(function(e){t&&(n+=t.distanceTo(e)),t=e}),n}(A),v.material.dashSize=b,v.material.gapSize=x,v.material.dashOffset=-_);var w=o(p);if(w instanceof Array){var S=d(o(p),A.length-1,1,!1);v.geometry.setColors(S.array),v.material.vertexColors=!0}else{var T=w,C=kOe(T);v.material.color=new vje.Color(NOe(T)),v.material.transparent=C<1,v.material.opacity=C,v.material.vertexColors=!1}v.material.needsUpdate=!0}else{Object.assign(v.material.uniforms,{dashSize:{value:s(p)},gapSize:{value:l(p)},dashOffset:{value:c(p)}});var M=d(o(p),A.length),E=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=0,a=e+1;i<a;i++)for(var o=i/(a-1),s=0;s<t;s++)r.push(o);return n&&r.reverse(),OOe(r,1)}(A.length,1,!0);v.geometry.setAttribute("color",M),v.geometry.setAttribute("relDistance",E)}var P=gje(h.__currentTargetD&&h.__currentTargetD.points||[A[0]],A),N=function(e){var t,n=h.__currentTargetD=e,r=n.stroke,i=n.interpolK,a=h.__currentTargetD.points=P(i);m?(v.geometry.setPositions((t=[]).concat.apply(t,fOe(a.map(function(e){return[e.x,e.y,e.z]})))),v.material.linewidth=r,v.material.dashed&&v.computeLineDistances()):(v.geometry.setFromPoints(a),v.geometry.computeBoundingSphere())},k={stroke:f,interpolK:1},R=Object.assign({},h.__currentTargetD||k,{interpolK:0});Object.keys(k).some(function(e){return R[e]!==k[e]})&&(!e.pathTransitionDuration||e.pathTransitionDuration<0?N(k):e.tweenGroup.add(new o9(R).to(k,e.pathTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(N).start()))}).digest(e.pathsData)}}),bje=window.THREE?window.THREE:{Euler:S0,Mesh:V1,MeshLambertMaterial:l4,SphereGeometry:Q3},xje=J7({props:{tilesData:{default:[]},tileLat:{default:"lat"},tileLng:{default:"lng"},tileAltitude:{default:.01},tileWidth:{default:1},tileHeight:{default:1},tileUseGlobeProjection:{default:!0},tileMaterial:{default:function(){return new bje.MeshLambertMaterial({color:"#ffbb88",opacity:.4,transparent:!0})}},tileCurvatureResolution:{default:5},tilesTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjTile"}).onCreateObj(function(){var e=new bje.Mesh;return e.__globeObjType="tile",e})},update:function(e){var t=Yte(e.tileLat),n=Yte(e.tileLng),r=Yte(e.tileAltitude),i=Yte(e.tileWidth),a=Yte(e.tileHeight),o=Yte(e.tileUseGlobeProjection),s=Yte(e.tileMaterial),l=Yte(e.tileCurvatureResolution);e.dataMapper.onUpdateObj(function(c,u){c.material=s(u);var d=o(u),h=l(u),p=function(e){var t=c.__currentTargetD=e,n=t.lat,r=t.lng,i=t.alt,a=t.width,o=t.height,s=_je(r),l=_je(-n);c.geometry&&c.geometry.dispose(),c.geometry=new bje.SphereGeometry(xOe*(1+i),Math.ceil(a/(h||-1)),Math.ceil(o/(h||-1)),_je(90-a/2)+(d?s:0),_je(a),_je(90-o/2)+(d?l:0),_je(o)),d||c.setRotationFromEuler(new bje.Euler(l,s,0,"YXZ"))},f={lat:+t(u),lng:+n(u),alt:+r(u),width:+i(u),height:+a(u)},m=c.__currentTargetD||Object.assign({},f,{width:0,height:0});Object.keys(f).some(function(e){return m[e]!==f[e]})&&(!e.tilesTransitionDuration||e.tilesTransitionDuration<0?p(f):e.tweenGroup.add(new o9(m).to(f,e.tilesTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(p).start()))}).digest(e.tilesData)}}),_je=function(e){return e*Math.PI/180},wje=window.THREE?window.THREE:{BufferGeometry:N1,Color:o1,Points:q2,PointsMaterial:F2},Sje=J7({props:{particlesData:{default:[]},particlesList:{default:function(e){return e}},particleLat:{default:"lat"},particleLng:{default:"lng"},particleAltitude:{default:.01},particlesSize:{default:.5},particlesSizeAttenuation:{default:!0},particlesColor:{default:function(){return"white"}},particlesTexture:{}},init:function(e,t){yOe(e),t.scene=e,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjParticles"}).onCreateObj(function(){var e=new wje.Points(new wje.BufferGeometry,new wje.PointsMaterial);return e.__globeObjType="particles",e}).onUpdateObj(function(e,n){var r=Yte(t.particlesList),i=Yte(t.particleLat),a=Yte(t.particleLng),o=Yte(t.particleAltitude);e.geometry.setAttribute("position",OOe(r(n).map(function(e){return Object.values(wOe(i(e),a(e),o(e)))}),3))})},update:function(e,t){["particlesData","particlesList","particleLat","particleLng","particleAltitude"].some(function(e){return t.hasOwnProperty(e)})&&e.dataMapper.digest(e.particlesData);var n=Yte(e.particlesColor),r=Yte(e.particlesSize),i=Yte(e.particlesSizeAttenuation),a=Yte(e.particlesTexture);e.dataMapper.entries().forEach(function(t){var o=hOe(t,2),s=o[0],l=o[1];if(l.material.size=r(s),l.material.sizeAttenuation=i(s),e.particlesTexture)l.material.color=new wje.Color(16777215),l.material.transparent=!1,l.material.alphaTest=.5,l.material.map=a(s);else{var c=n(s),u=kOe(c);l.material.color=new wje.Color(NOe(c)),l.material.transparent=u<1,l.material.opacity=u,l.material.alphaTest=0}})}}),Tje=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;YLe(this,t),(e=XLe(this,t)).type="CircleLineGeometry",e.parameters={radius:n,segmentCount:r};for(var i=[],a=0;a<=r;a++){var o=(a/r-.25)*Math.PI*2;i.push({x:Math.cos(o)*n,y:Math.sin(o)*n,z:0})}return e.setFromPoints(i),e}return aOe(t,e),tOe(t)}((window.THREE?window.THREE:{BufferGeometry:N1}).BufferGeometry),Cje=window.THREE?window.THREE:{Color:o1,Group:a2,Line:O2,LineBasicMaterial:C2,Vector3:vJ},Mje=Hne.default||Hne,Eje=J7({props:{ringsData:{default:[]},ringLat:{default:"lat"},ringLng:{default:"lng"},ringAltitude:{default:.0015},ringColor:{default:function(){return"#ffffaa"},triggerUpdate:!1},ringResolution:{default:64,triggerUpdate:!1},ringMaxRadius:{default:2,triggerUpdate:!1},ringPropagationSpeed:{default:1,triggerUpdate:!1},ringRepeatPeriod:{default:700,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.pause()},resumeAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.resume()},_destructor:function(e){var t;null===(t=e.ticker)||void 0===t||t.dispose()}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjRing",removeDelay:3e4}).onCreateObj(function(){var e=new Cje.Group;return e.__globeObjType="ring",e}),t.ticker=new Mje,t.ticker.onTick.add(function(e){if(t.ringsData.length){var n=Yte(t.ringColor),r=Yte(t.ringAltitude),i=Yte(t.ringMaxRadius),a=Yte(t.ringPropagationSpeed),o=Yte(t.ringRepeatPeriod);t.dataMapper.entries().filter(function(e){return hOe(e,2)[1]}).forEach(function(s){var l=hOe(s,2),c=l[0],u=l[1];if((u.__nextRingTime||0)<=e){var d=o(c)/1e3;u.__nextRingTime=e+(d<=0?1/0:d);var h,p=new Cje.Line(new Tje(1,t.ringResolution),new Cje.LineBasicMaterial),f=n(c),m=f instanceof Array||f instanceof Function;m?f instanceof Array?(h=fM().domain(f.map(function(e,t){return t/(f.length-1)})).range(f),p.material.transparent=f.some(function(e){return kOe(e)<1})):(h=f,p.material.transparent=!0):(p.material.color=new Cje.Color(NOe(f)),function(e,t){e.opacity=t,e.transparent=t<1,e.depthWrite=t>=1}(p.material,kOe(f)));var g=xOe*(1+r(c)),v=i(c),A=v*Math.PI/180,y=a(c),b=y<=0,x=function(e){var t=e.t,n=(b?1-t:t)*A;if(p.scale.x=p.scale.y=g*Math.sin(n),p.position.z=g*(1-Math.cos(n)),m){var r=h(t);p.material.color=new Cje.Color(NOe(r)),p.material.transparent&&(p.material.opacity=kOe(r))}};if(0===y)x({t:0}),u.add(p);else{var _=1e3*Math.abs(v/y);t.tweenGroup.add(new o9({t:0}).to({t:1},_).onUpdate(x).onStart(function(){return u.add(p)}).onComplete(function(){u.remove(p),AOe(p)}).start())}}})}})},update:function(e){var t=Yte(e.ringLat),n=Yte(e.ringLng),r=Yte(e.ringAltitude),i=e.scene.localToWorld(new Cje.Vector3(0,0,0));e.dataMapper.onUpdateObj(function(e,a){var o=t(a),s=n(a),l=r(a);Object.assign(e.position,wOe(o,s,l)),e.lookAt(i)}).digest(e.ringsData)}}),Pje={glyphs:{0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},"\u03bf":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"\xa6":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"\u03a4":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"\u03a0":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"\u0390":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"\xb2":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"\u2013":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"\u039a":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"\u0192":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"\u03cc":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"\xbb":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"\xa9":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"\u03ce":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"\xab":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"\u2219":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"\xff":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"\xb5":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"\u0399":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"\u038e":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"\u2019":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"\u039d":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"\u03c2":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"\u03a8":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"\u03b9":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"\u0386":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"\u03b5":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"\u0394":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"\u2030":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"\u2014":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"\u03c1":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},"\xaf":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"\u0397":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"\u0391":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"\u2026":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"\u03bd":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"\xb6":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"\u03b2":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"\u039c":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"\u038c":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"\u0389":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"\u2022":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"\xa5":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"\u03b3":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"\u03b1":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"\xad":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"\u03a7":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"\u2020":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"\xb0":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"\u039e":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "},"\xa0":{x_min:0,x_max:0,ha:853},"\u03ab":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},"\u201d":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"\u038a":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"\u0392":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"\u03c5":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"\u03c7":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},"\u03af":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"\u0396":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"\xa8":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"\u2039":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"\u201e":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"\u03b4":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"\u03ad":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"\u03c9":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"\xb4":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"\xb1":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"\u03cb":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"\xa7":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"\u03a9":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"\u03cd":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"\u2122":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"\u03ae":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"\u0398":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"\xae":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"\u0395":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"\xb3":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"\u03c3":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"\u03b6":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"\u03b8":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"\u039f":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"\u0393":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"\u0388":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"\u038f":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"\u03aa":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"\xbd":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"\u03a1":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"\xaa":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"\u0385":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"\u03a6":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"\u204b":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"\u03a3":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},"\u203a":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"\xa3":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"\xac":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"\u03bb":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"\u03c4":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"\u03be":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"\u039b":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"\u03b0":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"\xb7":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"\u03a5":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"\u03bc":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"\u03c6":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"\u201c":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},"\u2018":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"\u03ca":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"\u03c0":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"\u03ac":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"\xa4":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"\u03ba":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"\u2021":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"\u03c8":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"\u03b7":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) \u039cagenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"\u039cagenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"\u039cagenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50},Nje=lOe(lOe({},window.THREE?window.THREE:{BoxGeometry:q1,CircleGeometry:Y2,DoubleSide:2,Group:a2,Mesh:V1,MeshLambertMaterial:l4,TextGeometry:GLe,Vector3:vJ}),{},{Font:qLe,TextGeometry:GLe}),kje=J7({props:{labelsData:{default:[]},labelLat:{default:"lat"},labelLng:{default:"lng"},labelAltitude:{default:.002},labelText:{default:"text"},labelSize:{default:.5},labelTypeFace:{default:Pje,onChange:function(e,t){t.font=new Nje.Font(e)}},labelColor:{default:function(){return"lightgrey"}},labelRotation:{default:0},labelResolution:{default:3},labelIncludeDot:{default:!0},labelDotRadius:{default:.1},labelDotOrientation:{default:function(){return"bottom"}},labelsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r;var i=new Nje.CircleGeometry(1,32);t.dataMapper=new BOe(e,{objBindAttr:"__threeObjLabel"}).onCreateObj(function(){var e=new Nje.MeshLambertMaterial;e.side=2;var t=new Nje.Group;t.add(new Nje.Mesh(i,e));var n=new Nje.Mesh(void 0,e);t.add(n);var r=new Nje.Mesh;return r.visible=!1,n.add(r),t.__globeObjType="label",t})},update:function(e){var t=Yte(e.labelLat),n=Yte(e.labelLng),r=Yte(e.labelAltitude),i=Yte(e.labelText),a=Yte(e.labelSize),o=Yte(e.labelRotation),s=Yte(e.labelColor),l=Yte(e.labelIncludeDot),c=Yte(e.labelDotRadius),u=Yte(e.labelDotOrientation),d=new Set(["right","top","bottom"]),h=2*Math.PI*xOe/360;e.dataMapper.onUpdateObj(function(p,f){var m=hOe(p.children,2),g=m[0],v=m[1],A=hOe(v.children,1)[0],y=s(f),b=kOe(y);v.material.color.set(NOe(y)),v.material.transparent=b<1,v.material.opacity=b;var x=l(f),_=u(f);!x||!d.has(_)&&(_="bottom");var w=x?+c(f)*h:1e-12;g.scale.x=g.scale.y=w;var S=+a(f)*h;if(v.geometry&&v.geometry.dispose(),v.geometry=new Nje.TextGeometry(i(f),{font:e.font,size:S,depth:0,bevelEnabled:!0,bevelThickness:0,bevelSize:0,curveSegments:e.labelResolution}),A.geometry&&A.geometry.dispose(),v.geometry.computeBoundingBox(),A.geometry=eOe(Nje.BoxGeometry,fOe((new Nje.Vector3).subVectors(v.geometry.boundingBox.max,v.geometry.boundingBox.min).clampScalar(0,1/0).toArray())),"right"!==_&&v.geometry.center(),x){var T=w+S/2;"right"===_&&(v.position.x=T),v.position.y={right:-S/2,top:T+S/2,bottom:-T-S/2}[_]}var C=function(t){var n=p.__currentTargetD=t,r=n.lat,i=n.lng,a=n.alt,o=n.rot,s=n.scale;Object.assign(p.position,wOe(r,i,a)),p.lookAt(e.scene.localToWorld(new Nje.Vector3(0,0,0))),p.rotateY(Math.PI),p.rotateZ(-o*Math.PI/180),p.scale.x=p.scale.y=p.scale.z=s},M={lat:+t(f),lng:+n(f),alt:+r(f),rot:+o(f),scale:1},E=p.__currentTargetD||Object.assign({},M,{scale:1e-12});Object.keys(M).some(function(e){return E[e]!==M[e]})&&(!e.labelsTransitionDuration||e.labelsTransitionDuration<0?C(M):e.tweenGroup.add(new o9(E).to(M,e.labelsTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(C).start()))}).digest(e.labelsData)}}),Rje=lOe(lOe({},window.THREE?window.THREE:{}),{},{CSS2DObject:class extends U0{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new mJ(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element&&e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}}),Lje=J7({props:{htmlElementsData:{default:[]},htmlLat:{default:"lat"},htmlLng:{default:"lng"},htmlAltitude:{default:0},htmlElement:{},htmlElementVisibilityModifier:{triggerUpdate:!1},htmlTransitionDuration:{default:1e3,triggerUpdate:!1},isBehindGlobe:{onChange:function(){this.updateObjVisibility()},triggerUpdate:!1}},methods:{updateObjVisibility:function(e,t){if(e.dataMapper){var n=t?[t]:e.dataMapper.entries().map(function(e){return hOe(e,2)[1]}).filter(function(e){return e});n.forEach(function(t){var n=!e.isBehindGlobe||!e.isBehindGlobe(t.position);e.htmlElementVisibilityModifier?(t.visible=!0,e.htmlElementVisibilityModifier(t.element,n)):t.visible=n})}}},init:function(e,t,n){var r=n.tweenGroup;yOe(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjHtml"}).onCreateObj(function(e){var n=Yte(t.htmlElement)(e),r=new Rje.CSS2DObject(n);return r.__globeObjType="html",r})},update:function(e,t){var n=this,r=Yte(e.htmlLat),i=Yte(e.htmlLng),a=Yte(e.htmlAltitude);t.hasOwnProperty("htmlElement")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(t,o){var s=function(e){var r=t.__currentTargetD=e,i=r.alt,a=r.lat,o=r.lng;Object.assign(t.position,wOe(a,o,i)),n.updateObjVisibility(t)},l={lat:+r(o),lng:+i(o),alt:+a(o)};!e.htmlTransitionDuration||e.htmlTransitionDuration<0||!t.__currentTargetD?s(l):e.tweenGroup.add(new o9(t.__currentTargetD).to(l,e.htmlTransitionDuration).easing(e9.Quadratic.InOut).onUpdate(s).start())}).digest(e.htmlElementsData)}}),Oje=window.THREE?window.THREE:{Group:a2,Mesh:V1,MeshLambertMaterial:l4,SphereGeometry:Q3},jje=J7({props:{objectsData:{default:[]},objectLat:{default:"lat"},objectLng:{default:"lng"},objectAltitude:{default:.01},objectFacesSurface:{default:!0},objectRotation:{},objectThreeObject:{default:new Oje.Mesh(new Oje.SphereGeometry(1,16,8),new Oje.MeshLambertMaterial({color:"#ffffaa",transparent:!0,opacity:.7}))}},init:function(e,t){yOe(e),t.scene=e,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjObject"}).onCreateObj(function(e){var n=Yte(t.objectThreeObject)(e);t.objectThreeObject===n&&(n=n.clone());var r=new Oje.Group;return r.add(n),r.__globeObjType="object",r})},update:function(e,t){var n=Yte(e.objectLat),r=Yte(e.objectLng),i=Yte(e.objectAltitude),a=Yte(e.objectFacesSurface),o=Yte(e.objectRotation);t.hasOwnProperty("objectThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(e,t){var s=+n(t),l=+r(t),c=+i(t);Object.assign(e.position,wOe(s,l,c)),a(t)?e.setRotationFromEuler(new S0(TOe(-s),TOe(l),0,"YXZ")):e.rotation.set(0,0,0);var u=e.children[0],d=o(t);d&&u.setRotationFromEuler(new S0(TOe(d.x||0),TOe(d.y||0),TOe(d.z||0)))}).digest(e.objectsData)}}),Dje=J7({props:{customLayerData:{default:[]},customThreeObject:{},customThreeObjectUpdate:{triggerUpdate:!1}},init:function(e,t){yOe(e),t.scene=e,t.dataMapper=new BOe(e,{objBindAttr:"__threeObjCustom"}).onCreateObj(function(e){var n=Yte(t.customThreeObject)(e,xOe);return n&&(t.customThreeObject===n&&(n=n.clone()),n.__globeObjType="custom"),n})},update:function(e,t){e.customThreeObjectUpdate||yOe(e.scene);var n=Yte(e.customThreeObjectUpdate);t.hasOwnProperty("customThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(e,t){return n(e,t,xOe)}).digest(e.customLayerData)}}),Ije=window.THREE?window.THREE:{Camera:Y1,Group:a2,Vector2:mJ,Vector3:vJ},Bje=["globeLayer","pointsLayer","arcsLayer","hexBinLayer","heatmapsLayer","polygonsLayer","hexedPolygonsLayer","pathsLayer","tilesLayer","particlesLayer","ringsLayer","labelsLayer","htmlElementsLayer","objectsLayer","customLayer"],Fje=bOe("globeLayer",POe),zje=Object.assign.apply(Object,fOe(["globeImageUrl","bumpImageUrl","globeCurvatureResolution","globeTileEngineUrl","globeTileEngineMaxLevel","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude"].map(function(e){return nOe({},e,Fje.linkProp(e))}))),Uje=Object.assign.apply(Object,fOe(["globeMaterial","globeTileEngineClearCache"].map(function(e){return nOe({},e,Fje.linkMethod(e))}))),Vje=bOe("pointsLayer",VOe),Gje=Object.assign.apply(Object,fOe(["pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration"].map(function(e){return nOe({},e,Vje.linkProp(e))}))),qje=bOe("arcsLayer",YOe),Wje=Object.assign.apply(Object,fOe(["arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration"].map(function(e){return nOe({},e,qje.linkProp(e))}))),Hje=bOe("hexBinLayer",eje),$je=Object.assign.apply(Object,fOe(["hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration"].map(function(e){return nOe({},e,Hje.linkProp(e))}))),Kje=bOe("heatmapsLayer",lje),Xje=Object.assign.apply(Object,fOe(["heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration"].map(function(e){return nOe({},e,Kje.linkProp(e))}))),Yje=bOe("hexedPolygonsLayer",fje),Qje=Object.assign.apply(Object,fOe(["hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration"].map(function(e){return nOe({},e,Yje.linkProp(e))}))),Zje=bOe("polygonsLayer",uje),Jje=Object.assign.apply(Object,fOe(["polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration"].map(function(e){return nOe({},e,Zje.linkProp(e))}))),eDe=bOe("pathsLayer",yje),tDe=Object.assign.apply(Object,fOe(["pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration"].map(function(e){return nOe({},e,eDe.linkProp(e))}))),nDe=bOe("tilesLayer",xje),rDe=Object.assign.apply(Object,fOe(["tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration"].map(function(e){return nOe({},e,nDe.linkProp(e))}))),iDe=bOe("particlesLayer",Sje),aDe=Object.assign.apply(Object,fOe(["particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture"].map(function(e){return nOe({},e,iDe.linkProp(e))}))),oDe=bOe("ringsLayer",Eje),sDe=Object.assign.apply(Object,fOe(["ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod"].map(function(e){return nOe({},e,oDe.linkProp(e))}))),lDe=bOe("labelsLayer",kje),cDe=Object.assign.apply(Object,fOe(["labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration"].map(function(e){return nOe({},e,lDe.linkProp(e))}))),uDe=bOe("htmlElementsLayer",Lje),dDe=Object.assign.apply(Object,fOe(["htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration"].map(function(e){return nOe({},e,uDe.linkProp(e))}))),hDe=bOe("objectsLayer",jje),pDe=Object.assign.apply(Object,fOe(["objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject"].map(function(e){return nOe({},e,hDe.linkProp(e))}))),fDe=bOe("customLayer",Dje),mDe=Object.assign.apply(Object,fOe(["customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(e){return nOe({},e,fDe.linkProp(e))}))),gDe=J7({props:lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe(lOe({onGlobeReady:{triggerUpdate:!1},rendererSize:{default:new Ije.Vector2(window.innerWidth,window.innerHeight),onChange:function(e,t){t.pathsLayer.rendererSize(e)},triggerUpdate:!1}},zje),Gje),Wje),$je),Xje),Jje),Qje),tDe),rDe),aDe),sDe),cDe),dDe),pDe),mDe),methods:lOe({getGlobeRadius:_Oe,getCoords:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return wOe.apply(void 0,n)},toGeoCoords:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return SOe.apply(void 0,n)},setPointOfView:function(e,t){var n,r,i,a,o=t instanceof Ije.Camera?t.position:t,s=_Oe(),l=void 0;e.scene&&o&&(l=function(t){void 0===n&&(n=o.clone().applyMatrix4(e.scene.matrixWorld.clone().invert())),void 0===r&&(r=n.length()),void 0===i&&(i=Math.sqrt(Math.pow(r,2)-Math.pow(s,2))),void 0===a&&(a=Math.acos(i/r));var l=n.distanceTo(t);if(l<i)return!1;var c=t.length();return Math.acos((Math.pow(r,2)+Math.pow(l,2)-Math.pow(c,2))/(2*r*l))<a});e.layersThatNeedUpdatePov.forEach(function(e){return e.updatePov(t)}),e.layersThatNeedBehindGlobeChecker.forEach(function(e){return e.isBehindGlobe(l)})},pauseAnimation:function(e){return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),e.pausableLayers.forEach(function(e){var t;return null===(t=e.pauseAnimation)||void 0===t?void 0:t.call(e)}),this},resumeAnimation:function(e){return null===e.animationFrameRequestId&&this._animationCycle(),e.pausableLayers.forEach(function(e){var t;return null===(t=e.resumeAnimation)||void 0===t?void 0:t.call(e)}),this},_animationCycle:function(e){e.animationFrameRequestId=requestAnimationFrame(this._animationCycle),e.tweenGroup.update()},_destructor:function(e){this.pauseAnimation(),e.destructableLayers.forEach(function(e){return e._destructor()})}},Uje),stateInit:function(){var e=new n9,t={tweenGroup:e},n={globeLayer:POe(t),pointsLayer:VOe(t),arcsLayer:YOe(t),hexBinLayer:eje(t),heatmapsLayer:lje(t),polygonsLayer:uje(t),hexedPolygonsLayer:fje(t),pathsLayer:yje(t),tilesLayer:xje(t),particlesLayer:Sje(t),ringsLayer:Eje(t),labelsLayer:kje(t),htmlElementsLayer:Lje(t),objectsLayer:jje(t),customLayer:Dje(t)};return lOe(lOe({tweenGroup:e},n),{},{layersThatNeedUpdatePov:Object.values(n).filter(function(e){return e.hasOwnProperty("updatePov")}),layersThatNeedBehindGlobeChecker:Object.values(n).filter(function(e){return e.hasOwnProperty("isBehindGlobe")}),destructableLayers:Object.values(n).filter(function(e){return e.hasOwnProperty("_destructor")}),pausableLayers:Object.values(n).filter(function(e){return e.hasOwnProperty("pauseAnimation")})})},init:function(e,t,n){var r=n.animateIn,i=void 0===r||r,a=n.waitForGlobeReady,o=void 0===a||a;yOe(e),t.scene=e,t.scene.visible=!1,Bje.forEach(function(e){var n=new Ije.Group;t.scene.add(n),t[e](n)});var s=function(){if(i){t.scene.scale.set(1e-6,1e-6,1e-6),t.tweenGroup.add(new o9({k:1e-6}).to({k:1},600).easing(e9.Quadratic.Out).onUpdate(function(e){var n=e.k;return t.scene.scale.set(n,n,n)}).start());var e=new Ije.Vector3(0,1,0);t.tweenGroup.add(new o9({rot:2*Math.PI}).to({rot:0},1200).easing(e9.Quintic.Out).onUpdate(function(n){var r=n.rot;return t.scene.setRotationFromAxisAngle(e,r)}).start())}t.scene.visible=!0,t.onGlobeReady&&t.onGlobeReady()};o?t.globeLayer.onReady(s):s(),this._animationCycle()},update:function(e){}});var vDe=function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(n){function r(){var n;YLe(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(n=XLe(this,r,[].concat(a))).__kapsuleInstance=eOe(e,[].concat(fOe(t?[n]:[]),a)),n}return aOe(r,n),tOe(r)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(e()).forEach(function(e){return n.prototype[e]=function(){var t,n=(t=this.__kapsuleInstance)[e].apply(t,arguments);return n===this.__kapsuleInstance?this:n}}),n}(gDe,(window.THREE?window.THREE:{Group:a2}).Group,!0);const ADe={type:"change"},yDe={type:"start"},bDe={type:"end"},xDe=1e-6,_De=-1,wDe=0,SDe=1,TDe=2,CDe=3,MDe=4,EDe=new mJ,PDe=new mJ,NDe=new vJ,kDe=new vJ,RDe=new vJ,LDe=new gJ,ODe=new vJ,jDe=new vJ,DDe=new vJ,IDe=new vJ;class BDe extends b5{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:rY,MIDDLE:iY,RIGHT:aY},this.target=new vJ,this.state=_De,this.keyState=_De,this._lastPosition=new vJ,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new vJ,this._movePrev=new mJ,this._moveCurr=new mJ,this._lastAxis=new vJ,this._zoomStart=new mJ,this._zoomEnd=new mJ,this._panStart=new mJ,this._panEnd=new mJ,this._pointers=[],this._pointerPositions={},this._onPointerMove=zDe.bind(this),this._onPointerDown=FDe.bind(this),this._onPointerUp=UDe.bind(this),this._onPointerCancel=VDe.bind(this),this._onContextMenu=XDe.bind(this),this._onMouseWheel=KDe.bind(this),this._onKeyDown=qDe.bind(this),this._onKeyUp=GDe.bind(this),this._onTouchStart=YDe.bind(this),this._onTouchMove=QDe.bind(this),this._onTouchEnd=ZDe.bind(this),this._onMouseDown=WDe.bind(this),this._onMouseMove=HDe.bind(this),this._onMouseUp=$De.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==t&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>xDe&&(this.dispatchEvent(ADe),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>xDe||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(ADe),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=_De,this.keyState=_De,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(ADe),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(PDe.copy(this._panEnd).sub(this._panStart),PDe.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;PDe.x*=e,PDe.y*=t}PDe.multiplyScalar(this._eye.length()*this.panSpeed),kDe.copy(this._eye).cross(this.object.up).setLength(PDe.x),kDe.add(NDe.copy(this.object.up).setLength(PDe.y)),this.object.position.add(kDe),this.target.add(kDe),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(PDe.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){IDe.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=IDe.length();e?(this._eye.copy(this.object.position).sub(this.target),ODe.copy(this._eye).normalize(),jDe.copy(this.object.up).normalize(),DDe.crossVectors(jDe,ODe).normalize(),jDe.setLength(this._moveCurr.y-this._movePrev.y),DDe.setLength(this._moveCurr.x-this._movePrev.x),IDe.copy(jDe.add(DDe)),RDe.crossVectors(IDe,this._eye).normalize(),e*=this.rotateSpeed,LDe.setFromAxisAngle(RDe,e),this._eye.applyQuaternion(LDe),this.object.up.applyQuaternion(LDe),this._lastAxis.copy(RDe),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),LDe.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(LDe),this.object.up.applyQuaternion(LDe)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===MDe?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=fJ.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,1!==e&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=fJ.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return EDe.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),EDe}_getMouseOnCircle(e,t){return EDe.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),EDe}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId)return void this._pointers.splice(t,1)}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new mJ,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function FDe(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e))}function zDe(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function UDe(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchEnd(e):this._onMouseUp(),this._removePointer(e),0===this._pointers.length&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp)))}function VDe(e){this._removePointer(e)}function GDe(){!1!==this.enabled&&(this.keyState=_De,window.addEventListener("keydown",this._onKeyDown))}function qDe(e){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===_De&&(e.code!==this.keys[wDe]||this.noRotate?e.code!==this.keys[SDe]||this.noZoom?e.code!==this.keys[TDe]||this.noPan||(this.keyState=TDe):this.keyState=SDe:this.keyState=wDe))}function WDe(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case iY:this.state=SDe;break;case rY:this.state=wDe;break;case aY:this.state=TDe;break;default:this.state=_De}const n=this.keyState!==_De?this.keyState:this.state;n!==wDe||this.noRotate?n!==SDe||this.noZoom?n!==TDe||this.noPan||(this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(yDe)}function HDe(e){const t=this.keyState!==_De?this.keyState:this.state;t!==wDe||this.noRotate?t!==SDe||this.noZoom?t!==TDe||this.noPan||this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)))}function $De(){this.state=_De,this.dispatchEvent(bDe)}function KDe(e){if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.dispatchEvent(yDe),this.dispatchEvent(bDe)}}function XDe(e){!1!==this.enabled&&e.preventDefault()}function YDe(e){if(this._trackPointer(e),1===this._pointers.length)this.state=CDe,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=MDe;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart)}this.dispatchEvent(yDe)}function QDe(e){if(this._trackPointer(e),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));else{const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y;this._touchZoomDistanceEnd=Math.sqrt(n*n+r*r);const i=(e.pageX+t.x)/2,a=(e.pageY+t.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,a))}}function ZDe(e){switch(this._pointers.length){case 0:this.state=_De;break;case 1:this.state=CDe,this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=MDe;for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId!==e.pointerId){const e=this._pointerPositions[this._pointers[t].pointerId];this._moveCurr.copy(this._getMouseOnCircle(e.x,e.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(bDe)}const JDe={type:"change"},eIe={type:"start"},tIe={type:"end"},nIe=new p0,rIe=new A2,iIe=Math.cos(70*fJ.DEG2RAD),aIe=new vJ,oIe=2*Math.PI,sIe=-1,lIe=0,cIe=1,uIe=2,dIe=3,hIe=4,pIe=5,fIe=6,mIe=1e-6;class gIe extends b5{constructor(e,t=null){super(e,t),this.state=sIe,this.target=new vJ,this.cursor=new vJ,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:rY,MIDDLE:iY,RIGHT:aY},this.touches={ONE:oY,TWO:lY},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new vJ,this._lastQuaternion=new gJ,this._lastTargetPosition=new vJ,this._quat=(new gJ).setFromUnitVectors(e.up,new vJ(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new u5,this._sphericalDelta=new u5,this._scale=1,this._panOffset=new vJ,this._rotateStart=new mJ,this._rotateEnd=new mJ,this._rotateDelta=new mJ,this._panStart=new mJ,this._panEnd=new mJ,this._panDelta=new mJ,this._dollyStart=new mJ,this._dollyEnd=new mJ,this._dollyDelta=new mJ,this._dollyDirection=new vJ,this._mouse=new mJ,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=AIe.bind(this),this._onPointerDown=vIe.bind(this),this._onPointerUp=yIe.bind(this),this._onContextMenu=CIe.bind(this),this._onMouseWheel=_Ie.bind(this),this._onKeyDown=wIe.bind(this),this._onTouchStart=SIe.bind(this),this._onTouchMove=TIe.bind(this),this._onMouseDown=bIe.bind(this),this._onMouseMove=xIe.bind(this),this._interceptControlDown=MIe.bind(this),this._interceptControlUp=EIe.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(JDe),this.update(),this.state=sIe}update(e=null){const t=this.object.position;aIe.copy(t).sub(this.target),aIe.applyQuaternion(this._quat),this._spherical.setFromVector3(aIe),this.autoRotate&&this.state===sIe&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=oIe:n>Math.PI&&(n-=oIe),r<-Math.PI?r+=oIe:r>Math.PI&&(r-=oIe),this._spherical.theta=n<=r?Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=e!=this._spherical.radius}if(aIe.setFromSpherical(this._spherical),aIe.applyQuaternion(this._quatInverse),t.copy(this.target).add(aIe),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=aIe.length();e=this._clampDistance(t*this._scale);const n=t-e;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),i=!!n}else if(this.object.isOrthographicCamera){const t=new vJ(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=n!==this.object.zoom;const r=new vJ(this._mouse.x,this._mouse.y,0);r.unproject(this.object),this.object.position.sub(r).add(t),this.object.updateMatrixWorld(),e=aIe.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(nIe.origin.copy(this.object.position),nIe.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(nIe.direction))<iIe?this.object.lookAt(this.target):(rIe.setFromNormalAndCoplanarPoint(this.object.up,this.target),nIe.intersectPlane(rIe,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,!!(i||this._lastPosition.distanceToSquared(this.object.position)>mIe||8*(1-this._lastQuaternion.dot(this.object.quaternion))>mIe||this._lastTargetPosition.distanceToSquared(this.target)>mIe)&&(this.dispatchEvent(JDe),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?oIe/60*this.autoRotateSpeed*e:oIe/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){aIe.setFromMatrixColumn(t,0),aIe.multiplyScalar(-e),this._panOffset.add(aIe)}_panUp(e,t){!0===this.screenSpacePanning?aIe.setFromMatrixColumn(t,1):(aIe.setFromMatrixColumn(t,0),aIe.crossVectors(this.object.up,aIe)),aIe.multiplyScalar(e),this._panOffset.add(aIe)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;aIe.copy(r).sub(this.target);let i=aIe.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/n.clientHeight,this.object.matrix),this._panUp(2*t*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,i=t-n.top,a=n.width,o=n.height;this._mouse.x=r/a*2-1,this._mouse.y=-i/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(oIe*this._rotateDelta.x/t.clientHeight),this._rotateUp(oIe*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(oIe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-oIe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(oIe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-oIe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(oIe*this._rotateDelta.x/t.clientHeight),this._rotateUp(oIe*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._updateZoomParameters(a,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new mJ,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function vIe(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(e)||(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function AIe(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function yIe(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(tIe),this.state=sIe;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y})}}function bIe(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case iY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=cIe;break;case rY:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=uIe}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=lIe}break;case aY:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=lIe}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=uIe}break;default:this.state=sIe}this.state!==sIe&&this.dispatchEvent(eIe)}function xIe(e){switch(this.state){case lIe:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case cIe:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case uIe:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function _Ie(e){!1!==this.enabled&&!1!==this.enableZoom&&this.state===sIe&&(e.preventDefault(),this.dispatchEvent(eIe),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(tIe))}function wIe(e){!1!==this.enabled&&this._handleKeyDown(e)}function SIe(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case oY:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=dIe;break;case sY:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=hIe;break;default:this.state=sIe}break;case 2:switch(this.touches.TWO){case lY:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=pIe;break;case cY:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=fIe;break;default:this.state=sIe}break;default:this.state=sIe}this.state!==sIe&&this.dispatchEvent(eIe)}function TIe(e){switch(this._trackPointer(e),this.state){case dIe:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case hIe:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case pIe:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case fIe:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=sIe}}function CIe(e){!1!==this.enabled&&e.preventDefault()}function MIe(e){if("Control"===e.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function EIe(e){if("Control"===e.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const PIe={type:"change"},NIe=1e-6,kIe=new gJ;class RIe extends b5{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new vJ(0,0,0),this._rotationVector=new vJ(0,0,0),this._lastQuaternion=new gJ,this._lastPosition=new vJ,this._status=0,this._onKeyDown=LIe.bind(this),this._onKeyUp=OIe.bind(this),this._onPointerMove=DIe.bind(this),this._onPointerDown=jIe.bind(this),this._onPointerUp=IIe.bind(this),this._onPointerCancel=BIe.bind(this),this._onContextMenu=FIe.bind(this),null!==t&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(!1===this.enabled)return;const t=this.object,n=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),kIe.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(kIe),(this._lastPosition.distanceToSquared(t.position)>NIe||8*(1-this._lastQuaternion.dot(t.quaternion))>NIe)&&(this.dispatchEvent(PIe),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function LIe(e){if(!e.altKey&&!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function OIe(e){if(!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function jIe(e){if(!1!==this.enabled)if(this.dragToLook)this._status++;else{switch(e.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}function DIe(e){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){const t=this._getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this._moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this._moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this._updateRotationVector()}}function IIe(e){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(e.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function BIe(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function FIe(e){!1!==this.enabled&&e.preventDefault()}const zIe={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class UIe{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const VIe=new G4(-1,1,1,-1,0,1);const GIe=new class extends N1{constructor(){super(),this.setAttribute("position",new _1([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _1([0,2,0,0,2,0],2))}};class qIe{constructor(e){this._mesh=new V1(GIe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,VIe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class WIe extends UIe{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof X1?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=K1.clone(e.uniforms),this.material=new X1({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new qIe(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class HIe extends UIe{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let a,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(a=0,o=1):(a=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class $Ie extends UIe{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class KIe{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const n=e.getSize(new mJ);this._width=n.width,this._height=n.height,(t=new BJ(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:yQ})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new WIe(zIe),this.copyPass.material.blending=0,this.clock=new Z4}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,i=this.passes.length;r<i;r++){const t=this.passes[r];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==HIe&&(t instanceof HIe?n=!0:t instanceof $Ie&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new mJ);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class XIe extends UIe{constructor(e,t,n=null,r=null,i=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this.isRenderPass=!0,this._oldClearColor=new o1}render(e,t,n){const r=e.autoClear;let i,a;e.autoClear=!1,null!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=r}}function YIe(e){return YIe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},YIe(e)}function QIe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(QIe=function(){return!!e})()}function ZIe(e){var t="function"==typeof Map?new Map:void 0;return ZIe=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(cr){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(QIe())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&mg(i,n.prototype),i}(e,arguments,YIe(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),mg(n,e)},ZIe(e)}var JIe=function(e){function t(t){return fg(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return gg(t,e),t}(ZIe(Error));function eBe(e,t){return e.substr(-t.length)===t}var tBe=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function nBe(e){return"string"!==typeof e?e:e.match(tBe)?parseFloat(e):e}var rBe=function(e){return function(t,n){void 0===n&&(n="16px");var r=t,i=n;if("string"===typeof t){if(!eBe(t,"px"))throw new JIe(69,e,t);r=nBe(t)}if("string"===typeof n){if(!eBe(n,"px"))throw new JIe(70,e,n);i=nBe(n)}if("string"===typeof r)throw new JIe(71,t,e);if("string"===typeof i)throw new JIe(72,n,e);return""+r/i+e}};rBe("em");rBe("rem");function iBe(e){return Math.round(255*e)}function aBe(e,t,n){return iBe(e)+","+iBe(t)+","+iBe(n)}function oBe(e,t,n,r){if(void 0===r&&(r=aBe),0===t)return r(n,n,n);var i=(e%360+360)%360/60,a=(1-Math.abs(2*n-1))*t,o=a*(1-Math.abs(i%2-1)),s=0,l=0,c=0;i>=0&&i<1?(s=a,l=o):i>=1&&i<2?(s=o,l=a):i>=2&&i<3?(l=a,c=o):i>=3&&i<4?(l=o,c=a):i>=4&&i<5?(s=o,c=a):i>=5&&i<6&&(s=a,c=o);var u=n-a/2;return r(s+u,l+u,c+u)}var sBe={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var lBe=/^#[a-fA-F0-9]{6}$/,cBe=/^#[a-fA-F0-9]{8}$/,uBe=/^#[a-fA-F0-9]{3}$/,dBe=/^#[a-fA-F0-9]{4}$/,hBe=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,pBe=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,fBe=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,mBe=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function gBe(e){if("string"!==typeof e)throw new JIe(3);var t=function(e){if("string"!==typeof e)return e;var t=e.toLowerCase();return sBe[t]?"#"+sBe[t]:e}(e);if(t.match(lBe))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(cBe)){var n=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:n}}if(t.match(uBe))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(dBe)){var r=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:r}}var i=hBe.exec(t);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var a=pBe.exec(t.substring(0,50));if(a)return{red:parseInt(""+a[1],10),green:parseInt(""+a[2],10),blue:parseInt(""+a[3],10),alpha:parseFloat(""+a[4])>1?parseFloat(""+a[4])/100:parseFloat(""+a[4])};var o=fBe.exec(t);if(o){var s="rgb("+oBe(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=hBe.exec(s);if(!l)throw new JIe(4,t,s);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var c=mBe.exec(t.substring(0,50));if(c){var u="rgb("+oBe(parseInt(""+c[1],10),parseInt(""+c[2],10)/100,parseInt(""+c[3],10)/100)+")",d=hBe.exec(u);if(!d)throw new JIe(4,t,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10),alpha:parseFloat(""+c[4])>1?parseFloat(""+c[4])/100:parseFloat(""+c[4])}}throw new JIe(5)}function vBe(e){return function(e){var t,n=e.red/255,r=e.green/255,i=e.blue/255,a=Math.max(n,r,i),o=Math.min(n,r,i),s=(a+o)/2;if(a===o)return void 0!==e.alpha?{hue:0,saturation:0,lightness:s,alpha:e.alpha}:{hue:0,saturation:0,lightness:s};var l=a-o,c=s>.5?l/(2-a-o):l/(a+o);switch(a){case n:t=(r-i)/l+(r<i?6:0);break;case r:t=(i-n)/l+2;break;default:t=(n-r)/l+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:c,lightness:s,alpha:e.alpha}:{hue:t,saturation:c,lightness:s}}(gBe(e))}var ABe=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function yBe(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function bBe(e){return yBe(Math.round(255*e))}function xBe(e,t,n){return ABe("#"+bBe(e)+bBe(t)+bBe(n))}function _Be(e,t,n){return oBe(e,t,n,xBe)}function wBe(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return _Be(e,t,n);if("object"===typeof e&&void 0===t&&void 0===n)return _Be(e.hue,e.saturation,e.lightness);throw new JIe(1)}function SBe(e,t,n,r){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n&&"number"===typeof r)return r>=1?_Be(e,t,n):"rgba("+oBe(e,t,n)+","+r+")";if("object"===typeof e&&void 0===t&&void 0===n&&void 0===r)return e.alpha>=1?_Be(e.hue,e.saturation,e.lightness):"rgba("+oBe(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new JIe(2)}function TBe(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return ABe("#"+yBe(e)+yBe(t)+yBe(n));if("object"===typeof e&&void 0===t&&void 0===n)return ABe("#"+yBe(e.red)+yBe(e.green)+yBe(e.blue));throw new JIe(6)}function CBe(e,t,n,r){if("string"===typeof e&&"number"===typeof t){var i=gBe(e);return"rgba("+i.red+","+i.green+","+i.blue+","+t+")"}if("number"===typeof e&&"number"===typeof t&&"number"===typeof n&&"number"===typeof r)return r>=1?TBe(e,t,n):"rgba("+e+","+t+","+n+","+r+")";if("object"===typeof e&&void 0===t&&void 0===n&&void 0===r)return e.alpha>=1?TBe(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new JIe(7)}function MBe(e){if("object"!==typeof e)throw new JIe(8);if(function(e){return"number"===typeof e.red&&"number"===typeof e.green&&"number"===typeof e.blue&&"number"===typeof e.alpha}(e))return CBe(e);if(function(e){return"number"===typeof e.red&&"number"===typeof e.green&&"number"===typeof e.blue&&("number"!==typeof e.alpha||"undefined"===typeof e.alpha)}(e))return TBe(e);if(function(e){return"number"===typeof e.hue&&"number"===typeof e.saturation&&"number"===typeof e.lightness&&"number"===typeof e.alpha}(e))return SBe(e);if(function(e){return"number"===typeof e.hue&&"number"===typeof e.saturation&&"number"===typeof e.lightness&&("number"!==typeof e.alpha||"undefined"===typeof e.alpha)}(e))return wBe(e);throw new JIe(8)}function EBe(e,t,n){return function(){var r=n.concat(Array.prototype.slice.call(arguments));return r.length>=t?e.apply(this,r):EBe(e,t,r)}}function PBe(e){return EBe(e,e.length,[])}PBe(function(e,t){if("transparent"===t)return t;var n=vBe(t);return MBe(pg({},n,{hue:n.hue+parseFloat(e)}))});function NBe(e,t,n){return Math.max(e,Math.min(t,n))}PBe(function(e,t){if("transparent"===t)return t;var n=vBe(t);return MBe(pg({},n,{lightness:NBe(0,1,n.lightness-parseFloat(e))}))});PBe(function(e,t){if("transparent"===t)return t;var n=vBe(t);return MBe(pg({},n,{saturation:NBe(0,1,n.saturation-parseFloat(e))}))});PBe(function(e,t){if("transparent"===t)return t;var n=vBe(t);return MBe(pg({},n,{lightness:NBe(0,1,n.lightness+parseFloat(e))}))});var kBe=PBe(function(e,t,n){if("transparent"===t)return n;if("transparent"===n)return t;if(0===e)return n;var r=gBe(t),i=pg({},r,{alpha:"number"===typeof r.alpha?r.alpha:1}),a=gBe(n),o=pg({},a,{alpha:"number"===typeof a.alpha?a.alpha:1}),s=i.alpha-o.alpha,l=2*parseFloat(e)-1,c=((l*s===-1?l:l+s)/(1+l*s)+1)/2,u=1-c;return CBe({red:Math.floor(i.red*c+o.red*u),green:Math.floor(i.green*c+o.green*u),blue:Math.floor(i.blue*c+o.blue*u),alpha:i.alpha*parseFloat(e)+o.alpha*(1-parseFloat(e))})}),RBe=kBe;var LBe=PBe(function(e,t){if("transparent"===t)return t;var n=gBe(t);return CBe(pg({},n,{alpha:NBe(0,1,(100*("number"===typeof n.alpha?n.alpha:1)+100*parseFloat(e))/100)}))}),OBe=LBe;PBe(function(e,t){if("transparent"===t)return t;var n=vBe(t);return MBe(pg({},n,{saturation:NBe(0,1,n.saturation+parseFloat(e))}))});PBe(function(e,t){return"transparent"===t?t:MBe(pg({},vBe(t),{hue:parseFloat(e)}))});PBe(function(e,t){return"transparent"===t?t:MBe(pg({},vBe(t),{lightness:parseFloat(e)}))});PBe(function(e,t){return"transparent"===t?t:MBe(pg({},vBe(t),{saturation:parseFloat(e)}))});PBe(function(e,t){return"transparent"===t?t:RBe(parseFloat(e),"rgb(0, 0, 0)",t)});PBe(function(e,t){return"transparent"===t?t:RBe(parseFloat(e),"rgb(255, 255, 255)",t)});PBe(function(e,t){if("transparent"===t)return t;var n=gBe(t);return CBe(pg({},n,{alpha:NBe(0,1,+(100*("number"===typeof n.alpha?n.alpha:1)-100*parseFloat(e)).toFixed(2)/100)}))});function jBe(){}function DBe(e){return null==e?jBe:function(){return this.querySelector(e)}}function IBe(){return[]}function BBe(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function FBe(e){return function(t){return t.matches(e)}}var zBe=Array.prototype.find;function UBe(){return this.firstElementChild}var VBe=Array.prototype.filter;function GBe(){return Array.from(this.children)}function qBe(e){return new Array(e.length)}function WBe(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function HBe(e,t,n,r,i,a){for(var o,s=0,l=t.length,c=a.length;s<c;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new WBe(e,a[s]);for(;s<l;++s)(o=t[s])&&(i[s]=o)}function $Be(e,t,n,r,i,a,o){var s,l,c,u=new Map,d=t.length,h=a.length,p=new Array(d);for(s=0;s<d;++s)(l=t[s])&&(p[s]=c=o.call(l,l.__data__,s,t)+"",u.has(c)?i[s]=l:u.set(c,l));for(s=0;s<h;++s)c=o.call(e,a[s],s,a)+"",(l=u.get(c))?(r[s]=l,l.__data__=a[s],u.delete(c)):n[s]=new WBe(e,a[s]);for(s=0;s<d;++s)(l=t[s])&&u.get(p[s])===l&&(i[s]=l)}function KBe(e){return e.__data__}function XBe(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function YBe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}WBe.prototype={constructor:WBe,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var QBe="http://www.w3.org/1999/xhtml",ZBe={svg:"http://www.w3.org/2000/svg",xhtml:QBe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function JBe(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),ZBe.hasOwnProperty(t)?{space:ZBe[t],local:e}:e}function eFe(e){return function(){this.removeAttribute(e)}}function tFe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function nFe(e,t){return function(){this.setAttribute(e,t)}}function rFe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function iFe(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function aFe(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function oFe(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function sFe(e){return function(){this.style.removeProperty(e)}}function lFe(e,t,n){return function(){this.style.setProperty(e,t,n)}}function cFe(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function uFe(e){return function(){delete this[e]}}function dFe(e,t){return function(){this[e]=t}}function hFe(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function pFe(e){return e.trim().split(/^|\s+/)}function fFe(e){return e.classList||new mFe(e)}function mFe(e){this._node=e,this._names=pFe(e.getAttribute("class")||"")}function gFe(e,t){for(var n=fFe(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function vFe(e,t){for(var n=fFe(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function AFe(e){return function(){gFe(this,e)}}function yFe(e){return function(){vFe(this,e)}}function bFe(e,t){return function(){(t.apply(this,arguments)?gFe:vFe)(this,e)}}function xFe(){this.textContent=""}function _Fe(e){return function(){this.textContent=e}}function wFe(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function SFe(){this.innerHTML=""}function TFe(e){return function(){this.innerHTML=e}}function CFe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function MFe(){this.nextSibling&&this.parentNode.appendChild(this)}function EFe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function PFe(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===QBe&&t.documentElement.namespaceURI===QBe?t.createElement(e):t.createElementNS(n,e)}}function NFe(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function kFe(e){var t=JBe(e);return(t.local?NFe:PFe)(t)}function RFe(){return null}function LFe(){var e=this.parentNode;e&&e.removeChild(this)}function OFe(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function jFe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function DFe(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function IFe(e,t,n){return function(){var r,i=this.__on,a=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var o=0,s=i.length;o<s;++o)if((r=i[o]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),void(r.value=t);this.addEventListener(e.type,a,n),r={type:e.type,name:e.name,value:t,listener:a,options:n},i?i.push(r):this.__on=[r]}}function BFe(e,t,n){var r=oFe(e),i=r.CustomEvent;"function"===typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function FFe(e,t){return function(){return BFe(this,e,t)}}function zFe(e,t){return function(){return BFe(this,e,t.apply(this,arguments))}}mFe.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var UFe=[null];function VFe(e,t){this._groups=e,this._parents=t}function GFe(){return new VFe([[document.documentElement]],UFe)}VFe.prototype=GFe.prototype={constructor:VFe,select:function(e){"function"!==typeof e&&(e=DBe(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],l=s.length,c=r[i]=new Array(l),u=0;u<l;++u)(a=s[u])&&(o=e.call(a,a.__data__,u,s))&&("__data__"in a&&(o.__data__=a.__data__),c[u]=o);return new VFe(r,this._parents)},selectAll:function(e){e="function"===typeof e?BBe(e):function(e){return null==e?IBe:function(){return this.querySelectorAll(e)}}(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],l=s.length,c=0;c<l;++c)(o=s[c])&&(r.push(e.call(o,o.__data__,c,s)),i.push(o));return new VFe(r,i)},selectChild:function(e){return this.select(null==e?UBe:function(e){return function(){return zBe.call(this.children,e)}}("function"===typeof e?e:FBe(e)))},selectChildren:function(e){return this.selectAll(null==e?GBe:function(e){return function(){return VBe.call(this.children,e)}}("function"===typeof e?e:FBe(e)))},filter:function(e){"function"!==typeof e&&(e=function(e){return function(){return this.matches(e)}}(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,l=r[i]=[],c=0;c<s;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&l.push(a);return new VFe(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,KBe);var n=t?$Be:HBe,r=this._parents,i=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var a=i.length,o=new Array(a),s=new Array(a),l=new Array(a),c=0;c<a;++c){var u=r[c],d=i[c],h=d.length,p=XBe(e.call(u,u&&u.__data__,c,r)),f=p.length,m=s[c]=new Array(f),g=o[c]=new Array(f);n(u,d,m,g,l[c]=new Array(h),p,t);for(var v,A,y=0,b=0;y<f;++y)if(v=m[y]){for(y>=b&&(b=y+1);!(A=g[b])&&++b<f;);v._next=A||null}}return(o=new VFe(o,r))._enter=s,o._exit=l,o},enter:function(){return new VFe(this._enter||this._groups.map(qBe),this._parents)},exit:function(){return new VFe(this._exit||this._groups.map(qBe),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,a=this.exit();return"function"===typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),l=0;l<o;++l)for(var c,u=n[l],d=r[l],h=u.length,p=s[l]=new Array(h),f=0;f<h;++f)(c=u[f]||d[f])&&(p[f]=c);for(;l<i;++l)s[l]=n[l];return new VFe(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=YBe);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],l=s.length,c=i[a]=new Array(l),u=0;u<l;++u)(o=s[u])&&(c[u]=o);c.sort(t)}return new VFe(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=JBe(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?tFe:eFe:"function"===typeof t?n.local?aFe:iFe:n.local?rFe:nFe)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?sFe:"function"===typeof t?cFe:lFe)(e,t,null==n?"":n)):function(e,t){return e.style.getPropertyValue(t)||oFe(e).getComputedStyle(e,null).getPropertyValue(t)}(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?uFe:"function"===typeof t?hFe:dFe)(e,t)):this.node()[e]},classed:function(e,t){var n=pFe(e+"");if(arguments.length<2){for(var r=fFe(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"===typeof t?bFe:t?AFe:yFe)(n,t))},text:function(e){return arguments.length?this.each(null==e?xFe:("function"===typeof e?wFe:_Fe)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?SFe:("function"===typeof e?CFe:TFe)(e)):this.node().innerHTML},raise:function(){return this.each(MFe)},lower:function(){return this.each(EFe)},append:function(e){var t="function"===typeof e?e:kFe(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"===typeof e?e:kFe(e),r=null==t?RFe:"function"===typeof t?t:DBe(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(LFe)},clone:function(e){return this.select(e?jFe:OFe)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?IFe:DFe,r=0;r<o;++r)this.each(s(a[r],t,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(r=0,l=s[c];r<o;++r)if((i=a[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"===typeof t?zFe:FFe)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],a=0,o=i.length;a<o;++a)(r=i[a])&&(yield r)}};var qFe,WFe,HFe,$Fe,KFe,XFe,YFe,QFe,ZFe,JFe,eze,tze,nze={},rze=[],ize=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,aze=Array.isArray;function oze(e,t){for(var n in t)e[n]=t[n];return e}function sze(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function lze(e,t,n,r,i){var a={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==i?++HFe:i,__i:-1,__u:0};return null==i&&null!=WFe.vnode&&WFe.vnode(a),a}function cze(e){return e.children}function uze(e,t){this.props=e,this.context=t}function dze(e,t){if(null==t)return e.__?dze(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?dze(e):null}function hze(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return hze(e)}}function pze(e){(!e.__d&&(e.__d=!0)&&KFe.push(e)&&!fze.__r++||XFe!=WFe.debounceRendering)&&((XFe=WFe.debounceRendering)||YFe)(fze)}function fze(){for(var e,t,n,r,i,a,o,s=1;KFe.length;)KFe.length>s&&KFe.sort(QFe),e=KFe.shift(),s=KFe.length,e.__d&&(n=void 0,r=void 0,i=(r=(t=e).__v).__e,a=[],o=[],t.__P&&((n=oze({},r)).__v=r.__v+1,WFe.vnode&&WFe.vnode(n),xze(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[i]:null,a,null==i?dze(r):i,!!(32&r.__u),o),n.__v=r.__v,n.__.__k[n.__i]=n,wze(a,n,o),r.__e=r.__=null,n.__e!=i&&hze(n)));fze.__r=0}function mze(e,t,n,r,i,a,o,s,l,c,u){var d,h,p,f,m,g,v,A=r&&r.__k||rze,y=t.length;for(l=function(e,t,n,r,i){var a,o,s,l,c,u=n.length,d=u,h=0;for(e.__k=new Array(i),a=0;a<i;a++)null!=(o=t[a])&&"boolean"!=typeof o&&"function"!=typeof o?("string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?o=e.__k[a]=lze(null,o,null,null,null):aze(o)?o=e.__k[a]=lze(cze,{children:o},null,null,null):void 0===o.constructor&&o.__b>0?o=e.__k[a]=lze(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):e.__k[a]=o,l=a+h,o.__=e,o.__b=e.__b+1,s=null,-1!=(c=o.__i=vze(o,n,l,d))&&(d--,(s=n[c])&&(s.__u|=2)),null==s||null==s.__v?(-1==c&&(i>u?h--:i<u&&h++),"function"!=typeof o.type&&(o.__u|=4)):c!=l&&(c==l-1?h--:c==l+1?h++:(c>l?h--:h++,o.__u|=4))):e.__k[a]=null;if(d)for(a=0;a<u;a++)null!=(s=n[a])&&0==(2&s.__u)&&(s.__e==r&&(r=dze(s)),Cze(s,s));return r}(n,t,A,l,y),d=0;d<y;d++)null!=(p=n.__k[d])&&(h=-1==p.__i?nze:A[p.__i]||nze,p.__i=d,g=xze(e,p,h,i,a,o,s,l,c,u),f=p.__e,p.ref&&h.ref!=p.ref&&(h.ref&&Tze(h.ref,null,p),u.push(p.ref,p.__c||f,p)),null==m&&null!=f&&(m=f),(v=!!(4&p.__u))||h.__k===p.__k?l=gze(p,l,e,v):"function"==typeof p.type&&void 0!==g?l=g:f&&(l=f.nextSibling),p.__u&=-7);return n.__e=m,l}function gze(e,t,n,r){var i,a;if("function"==typeof e.type){for(i=e.__k,a=0;i&&a<i.length;a++)i[a]&&(i[a].__=e,t=gze(i[a],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=dze(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function vze(e,t,n,r){var i,a,o,s=e.key,l=e.type,c=t[n],u=null!=c&&0==(2&c.__u);if(null===c&&null==s||u&&s==c.key&&l==c.type)return n;if(r>(u?1:0))for(i=n-1,a=n+1;i>=0||a<t.length;)if(null!=(c=t[o=i>=0?i--:a++])&&0==(2&c.__u)&&s==c.key&&l==c.type)return o;return-1}function Aze(e,t,n){"-"==t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||ize.test(t)?n:n+"px"}function yze(e,t,n,r,i){var a,o;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||Aze(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||Aze(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])a=t!=(t=t.replace(ZFe,"$1")),o=t.toLowerCase(),t=o in e||"onFocusOut"==t||"onFocusIn"==t?o.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?r?n.u=r.u:(n.u=JFe,e.addEventListener(t,a?tze:eze,a)):e.removeEventListener(t,a?tze:eze,a);else{if("http://www.w3.org/2000/svg"==i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function bze(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.t)t.t=JFe++;else if(t.t<n.u)return;return n(WFe.event?WFe.event(t):t)}}}function xze(e,t,n,r,i,a,o,s,l,c){var u,d,h,p,f,m,g,v,A,y,b,x,_,w,S,T,C,M=t.type;if(void 0!==t.constructor)return null;128&n.__u&&(l=!!(32&n.__u),a=[s=t.__e=n.__e]),(u=WFe.__b)&&u(t);e:if("function"==typeof M)try{if(v=t.props,A="prototype"in M&&M.prototype.render,y=(u=M.contextType)&&r[u.__c],b=u?y?y.props.value:u.__:r,n.__c?g=(d=t.__c=n.__c).__=d.__E:(A?t.__c=d=new M(v,b):(t.__c=d=new uze(v,b),d.constructor=M,d.render=Mze),y&&y.sub(d),d.state||(d.state={}),d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),A&&null==d.__s&&(d.__s=d.state),A&&null!=M.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=oze({},d.__s)),oze(d.__s,M.getDerivedStateFromProps(v,d.__s))),p=d.props,f=d.state,d.__v=t,h)A&&null==M.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),A&&null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(A&&null==M.getDerivedStateFromProps&&v!==p&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(v,b),t.__v==n.__v||!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(v,d.__s,b)){for(t.__v!=n.__v&&(d.props=v,d.state=d.__s,d.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(e){e&&(e.__=t)}),x=0;x<d._sb.length;x++)d.__h.push(d._sb[x]);d._sb=[],d.__h.length&&o.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(v,d.__s,b),A&&null!=d.componentDidUpdate&&d.__h.push(function(){d.componentDidUpdate(p,f,m)})}if(d.context=b,d.props=v,d.__P=e,d.__e=!1,_=WFe.__r,w=0,A){for(d.state=d.__s,d.__d=!1,_&&_(t),u=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do{d.__d=!1,_&&_(t),u=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++w<25);d.state=d.__s,null!=d.getChildContext&&(r=oze(oze({},r),d.getChildContext())),A&&!h&&null!=d.getSnapshotBeforeUpdate&&(m=d.getSnapshotBeforeUpdate(p,f)),T=u,null!=u&&u.type===cze&&null==u.key&&(T=Sze(u.props.children)),s=mze(e,aze(T)?T:[T],t,n,r,i,a,o,s,l,c),d.base=t.__e,t.__u&=-161,d.__h.length&&o.push(d),g&&(d.__E=d.__=null)}catch(e){if(t.__v=null,l||null!=a)if(e.then){for(t.__u|=l?160:128;s&&8==s.nodeType&&s.nextSibling;)s=s.nextSibling;a[a.indexOf(s)]=null,t.__e=s}else{for(C=a.length;C--;)sze(a[C]);_ze(t)}else t.__e=n.__e,t.__k=n.__k,e.then||_ze(t);WFe.__e(e,t,n)}else null==a&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):s=t.__e=function(e,t,n,r,i,a,o,s,l){var c,u,d,h,p,f,m,g=n.props||nze,v=t.props,A=t.type;if("svg"==A?i="http://www.w3.org/2000/svg":"math"==A?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),null!=a)for(c=0;c<a.length;c++)if((p=a[c])&&"setAttribute"in p==!!A&&(A?p.localName==A:3==p.nodeType)){e=p,a[c]=null;break}if(null==e){if(null==A)return document.createTextNode(v);e=document.createElementNS(i,A,v.is&&v),s&&(WFe.__m&&WFe.__m(t,a),s=!1),a=null}if(null==A)g===v||s&&e.data==v||(e.data=v);else{if(a=a&&qFe.call(e.childNodes),!s&&null!=a)for(g={},c=0;c<e.attributes.length;c++)g[(p=e.attributes[c]).name]=p.value;for(c in g)if(p=g[c],"children"==c);else if("dangerouslySetInnerHTML"==c)d=p;else if(!(c in v)){if("value"==c&&"defaultValue"in v||"checked"==c&&"defaultChecked"in v)continue;yze(e,c,null,p,i)}for(c in v)p=v[c],"children"==c?h=p:"dangerouslySetInnerHTML"==c?u=p:"value"==c?f=p:"checked"==c?m=p:s&&"function"!=typeof p||g[c]===p||yze(e,c,p,g[c],i);if(u)s||d&&(u.__html==d.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(d&&(e.innerHTML=""),mze("template"==t.type?e.content:e,aze(h)?h:[h],t,n,r,"foreignObject"==A?"http://www.w3.org/1999/xhtml":i,a,o,a?a[0]:n.__k&&dze(n,0),s,l),null!=a)for(c=a.length;c--;)sze(a[c]);s||(c="value","progress"==A&&null==f?e.removeAttribute("value"):null!=f&&(f!==e[c]||"progress"==A&&!f||"option"==A&&f!=g[c])&&yze(e,c,f,g[c],i),c="checked",null!=m&&m!=e[c]&&yze(e,c,m,g[c],i))}return e}(n.__e,t,n,r,i,a,o,l,c);return(u=WFe.diffed)&&u(t),128&t.__u?void 0:s}function _ze(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(_ze)}function wze(e,t,n){for(var r=0;r<n.length;r++)Tze(n[r],n[++r],n[++r]);WFe.__c&&WFe.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){WFe.__e(e,t.__v)}})}function Sze(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:aze(e)?e.map(Sze):oze({},e)}function Tze(e,t,n){try{if("function"==typeof e){var r="function"==typeof e.__u;r&&e.__u(),r&&null==t||(e.__u=e(t))}else e.current=t}catch(e){WFe.__e(e,n)}}function Cze(e,t,n){var r,i;if(WFe.unmount&&WFe.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||Tze(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){WFe.__e(e,t)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&Cze(r[i],t,n||"function"!=typeof e.type);n||sze(e.__e),e.__c=e.__=e.__e=void 0}function Mze(e,t,n){return this.constructor(e,n)}function Eze(e,t,n){var r,i,a,o;t==document&&(t=document.documentElement),WFe.__&&WFe.__(e,t),i=(r="function"==typeof n)?null:n&&n.__k||t.__k,a=[],o=[],xze(t,e=(!r&&n||t).__k=function(e,t,n){var r,i,a,o={};for(a in t)"key"==a?r=t[a]:"ref"==a?i=t[a]:o[a]=t[a];if(arguments.length>2&&(o.children=arguments.length>3?qFe.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===o[a]&&(o[a]=e.defaultProps[a]);return lze(e,o,r,i,null)}(cze,null,[e]),i||nze,nze,t.namespaceURI,!r&&n?[n]:i?null:t.firstChild?qFe.call(t.childNodes):null,a,!r&&n?n:i?i.__e:t.firstChild,r,o),wze(a,e,o)}function Pze(e,t,n){var r,i,a,o,s=oze({},e.props);for(a in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),t)"key"==a?r=t[a]:"ref"==a?i=t[a]:s[a]=void 0===t[a]&&null!=o?o[a]:t[a];return arguments.length>2&&(s.children=arguments.length>3?qFe.call(arguments,2):n),lze(e.type,s,r||e.key,i||e.ref,null)}function Nze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function kze(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Lze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Nze(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nze(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oze(e){return Oze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oze(e)}qFe=rze.slice,WFe={__e:function(e,t,n,r){for(var i,a,o;t=t.__;)if((i=t.__c)&&!i.__)try{if((a=i.constructor)&&null!=a.getDerivedStateFromError&&(i.setState(a.getDerivedStateFromError(e)),o=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e,r||{}),o=i.__d),o)return i.__E=i}catch(t){e=t}throw e}},HFe=0,$Fe=function(e){return null!=e&&void 0===e.constructor},uze.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=oze({},this.state),"function"==typeof e&&(e=e(oze({},n),this.props)),e&&oze(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),pze(this))},uze.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),pze(this))},uze.prototype.render=cze,KFe=[],YFe="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,QFe=function(e,t){return e.__v.__b-t.__v.__b},fze.__r=0,ZFe=/(PointerCapture)$|Capture$/i,JFe=0,eze=bze(!1),tze=bze(!0);var jze=function(e){if("object"!==Oze(e))return e;var t,n=Pze(e);n.props&&(n.props=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rze(Object(n),!0).forEach(function(t){kze(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n.props),null!==n&&void 0!==n&&null!==(t=n.props)&&void 0!==t&&t.children&&(n.props.children=Array.isArray(n.props.children)?n.props.children.map(jze):jze(n.props.children)));return n};!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var Dze=J7({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).style,r=void 0===n?{}:n,i=function(e){return"string"===typeof e?new VFe([[document.querySelector(e)]],[document.documentElement]):new VFe([[e]],UFe)}(!!e&&"object"===Oze(e)&&!!e.node&&"function"===typeof e.node?e.node():e);"static"===i.style("position")&&i.style("position","relative"),t.tooltipEl=i.append("div").attr("class","float-tooltip-kap"),Object.entries(r).forEach(function(e){var n=Lze(e,2),r=n[0],i=n[1];return t.tooltipEl.style(r,i)}),t.tooltipEl.style("left","-10000px").style("display","none");var a="tooltip-".concat(Math.round(1e12*Math.random()));t.mouseInside=!1,i.on("mousemove.".concat(a),function(e){t.mouseInside=!0;var n=function(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}(e),r=i.node(),a=r.offsetWidth,o=r.offsetHeight,s=[null===t.offsetX||void 0===t.offsetX?"-".concat(n[0]/a*100,"%"):"number"===typeof t.offsetX?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,null===t.offsetY||void 0===t.offsetY?o>130&&o-n[1]<100?"calc(-100% - 6px)":"21px":"number"===typeof t.offsetY?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",n[0]+"px").style("top",n[1]+"px").style("transform","translate(".concat(s.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),i.on("mouseover.".concat(a),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),i.on("mouseout.".concat(a),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):"string"===typeof e.content?e.tooltipEl.html(e.content):function(e){return $Fe(Pze(e))}(e.content)?(e.tooltipEl.text(""),function(e,t){delete t.__k,Eze(jze(e),t)}(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function Ize(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Bze(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||Uze(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zze(e){return function(e){if(Array.isArray(e))return Ize(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Uze(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uze(e,t){if(e){if("string"==typeof e)return Ize(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ize(e,t):void 0}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".scene-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var Vze=window.THREE?window.THREE:{WebGLRenderer:class{constructor(e={}){const{canvas:t=YZ(),context:n=null,depth:r=!0,stencil:i=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:d=!1,outputBufferType:h=hQ}=e;let p;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=n.getContextAttributes().alpha}else p=a;const f=h,m=new Set([OQ,LQ,kQ]),g=new Set([hQ,vQ,mQ,_Q,bQ,xQ]),v=new Uint32Array(4),A=new Int32Array(4);let y=null,b=null;const x=[],_=[];let w=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const S=this;let T=!1;this._outputColorSpace=MZ;let C=0,M=0,E=null,P=-1,N=null;const k=new DJ,R=new DJ;let L=null;const O=new o1(0);let j=0,D=t.width,I=t.height,B=1,F=null,z=null;const U=new DJ(0,0,D,I),V=new DJ(0,0,D,I);let G=!1;const q=new _2;let W=!1,H=!1;const $=new f0,K=new vJ,X=new DJ,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Q=!1;function Z(){return null===E?B:1}let J,ee,te,ne,re,ie,ae,oe,se,le,ce,ue,de,he,pe,fe,me,ge,ve,Ae,ye,be,xe,_e,we=n;function Se(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${nY}`),t.addEventListener("webglcontextlost",Me,!1),t.addEventListener("webglcontextrestored",Ee,!1),t.addEventListener("webglcontextcreationerror",Pe,!1),null===we){const t="webgl2";if(we=Se(t,e),null===we)throw Se(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(or){throw tJ("WebGLRenderer: "+or.message),or}function Te(){J=new r6(we),J.init(),be=new d7(we,J),ee=new B5(we,J,e,be),te=new c7(we,J),ee.reversedDepthBuffer&&d&&te.buffers.depth.setReversed(!0),ne=new o6(we),re=new W8,ie=new u7(we,J,te,re,ee,be,ne),ae=new z5(S),oe=new n6(S),se=new E5(we),xe=new D5(we,se),le=new i6(we,se,ne,xe),ce=new l6(we,le,se,ne),ve=new s6(we,ee,ie),fe=new F5(re),ue=new q8(S,ae,oe,J,ee,xe,fe),de=new g7(S,re),he=new X8,pe=new t7(J),ge=new j5(S,ae,oe,te,ce,p,s),me=new s7(S,ce,ee),_e=new v7(we,ne,ee,te),Ae=new I5(we,J,ne),ye=new a6(we,J,ne),ne.programs=ue.programs,S.capabilities=ee,S.extensions=J,S.properties=re,S.renderLists=he,S.shadowMap=me,S.state=te,S.info=ne}Te(),f!==hQ&&(w=new u6(f,t.width,t.height,r,i));const Ce=new p7(S,we);function Me(e){e.preventDefault(),JZ("WebGLRenderer: Context Lost."),T=!0}function Ee(){JZ("WebGLRenderer: Context Restored."),T=!1;const e=ne.autoReset,t=me.enabled,n=me.autoUpdate,r=me.needsUpdate,i=me.type;Te(),ne.autoReset=e,me.enabled=t,me.autoUpdate=n,me.needsUpdate=r,me.type=i}function Pe(e){tJ("WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ne(e){const t=e.target;t.removeEventListener("dispose",Ne),function(e){(function(e){const t=re.get(e).programs;void 0!==t&&(t.forEach(function(e){ue.releaseProgram(e)}),e.isShaderMaterial&&ue.releaseShaderCache(e))})(e),re.remove(e)}(t)}function ke(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ue(e,t,n),e.side=0,e.needsUpdate=!0,Ue(e,t,n),e.side=2):Ue(e,t,n)}this.xr=Ce,this.getContext=function(){return we},this.getContextAttributes=function(){return we.getContextAttributes()},this.forceContextLoss=function(){const e=J.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=J.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(e){void 0!==e&&(B=e,this.setSize(D,I,!1))},this.getSize=function(e){return e.set(D,I)},this.setSize=function(e,n,r=!0){Ce.isPresenting?eJ("WebGLRenderer: Can't change size while VR device is presenting."):(D=e,I=n,t.width=Math.floor(e*B),t.height=Math.floor(n*B),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),null!==w&&w.setSize(t.width,t.height),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(D*B,I*B).floor()},this.setDrawingBufferSize=function(e,n,r){D=e,I=n,B=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.setEffects=function(e){if(f!==hQ){if(e)for(let t=0;t<e.length;t++)if(!0===e[t].isOutputPass){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}w.setEffects(e||[])}else console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.")},this.getCurrentViewport=function(e){return e.copy(k)},this.getViewport=function(e){return e.copy(U)},this.setViewport=function(e,t,n,r){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,r),te.viewport(k.copy(U).multiplyScalar(B).round())},this.getScissor=function(e){return e.copy(V)},this.setScissor=function(e,t,n,r){e.isVector4?V.set(e.x,e.y,e.z,e.w):V.set(e,t,n,r),te.scissor(R.copy(V).multiplyScalar(B).round())},this.getScissorTest=function(){return G},this.setScissorTest=function(e){te.setScissorTest(G=e)},this.setOpaqueSort=function(e){F=e},this.setTransparentSort=function(e){z=e},this.getClearColor=function(e){return e.copy(ge.getClearColor())},this.setClearColor=function(){ge.setClearColor(...arguments)},this.getClearAlpha=function(){return ge.getClearAlpha()},this.setClearAlpha=function(){ge.setClearAlpha(...arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==E){const t=E.texture.format;e=m.has(t)}if(e){const e=E.texture.type,t=g.has(e),n=ge.getClearColor(),r=ge.getClearAlpha(),i=n.r,a=n.g,o=n.b;t?(v[0]=i,v[1]=a,v[2]=o,v[3]=r,we.clearBufferuiv(we.COLOR,0,v)):(A[0]=i,A[1]=a,A[2]=o,A[3]=r,we.clearBufferiv(we.COLOR,0,A))}else r|=we.COLOR_BUFFER_BIT}t&&(r|=we.DEPTH_BUFFER_BIT),n&&(r|=we.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),we.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Me,!1),t.removeEventListener("webglcontextrestored",Ee,!1),t.removeEventListener("webglcontextcreationerror",Pe,!1),ge.dispose(),he.dispose(),pe.dispose(),re.dispose(),ae.dispose(),oe.dispose(),ce.dispose(),xe.dispose(),_e.dispose(),ue.dispose(),Ce.dispose(),Ce.removeEventListener("sessionstart",Le),Ce.removeEventListener("sessionend",Oe),je.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=Y);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=Y);ie.resetTextureUnits();const a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===E?S.outputColorSpace:!0===E.isXRRenderTarget?E.texture.colorSpace:EZ,l=(r.isMeshStandardMaterial?oe:ae).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;r.toneMapped&&(null!==E&&!0!==E.isXRRenderTarget||(f=S.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,v=re.get(r),A=b.state.lights;if(!0===W&&(!0===H||e!==N)){const t=e===N&&r.id===P;fe.setState(r,e,t)}let y=!1;r.version===v.__version?v.needsLights&&v.lightsStateVersion!==A.state.version||v.outputColorSpace!==s||i.isBatchedMesh&&!1===v.batching?y=!0:i.isBatchedMesh||!0!==v.batching?i.isBatchedMesh&&!0===v.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===v.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===v.instancing?y=!0:i.isInstancedMesh||!0!==v.instancing?i.isSkinnedMesh&&!1===v.skinning?y=!0:i.isSkinnedMesh||!0!==v.skinning?i.isInstancedMesh&&!0===v.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===v.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===v.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===v.instancingMorph&&null!==i.morphTexture||v.envMap!==l||!0===r.fog&&v.fog!==a?y=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===fe.numPlanes&&v.numIntersection===fe.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==d||v.morphNormals!==h||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==g)&&(y=!0):y=!0:y=!0:y=!0:y=!0:(y=!0,v.__version=r.version);let x=v.currentProgram;!0===y&&(x=Ue(r,t,i));let _=!1,w=!1,T=!1;const C=x.getUniforms(),M=v.uniforms;te.useProgram(x.program)&&(_=!0,w=!0,T=!0);r.id!==P&&(P=r.id,w=!0);if(_||N!==e){te.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),C.setValue(we,"projectionMatrix",e.projectionMatrix),C.setValue(we,"viewMatrix",e.matrixWorldInverse);const t=C.map.cameraPosition;void 0!==t&&t.setValue(we,K.setFromMatrixPosition(e.matrixWorld)),ee.logarithmicDepthBuffer&&C.setValue(we,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&C.setValue(we,"isOrthographic",!0===e.isOrthographicCamera),N!==e&&(N=e,w=!0,T=!0)}v.needsLights&&(A.state.directionalShadowMap.length>0&&C.setValue(we,"directionalShadowMap",A.state.directionalShadowMap,ie),A.state.spotShadowMap.length>0&&C.setValue(we,"spotShadowMap",A.state.spotShadowMap,ie),A.state.pointShadowMap.length>0&&C.setValue(we,"pointShadowMap",A.state.pointShadowMap,ie));if(i.isSkinnedMesh){C.setOptional(we,i,"bindMatrix"),C.setOptional(we,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),C.setValue(we,"boneTexture",e.boneTexture,ie))}i.isBatchedMesh&&(C.setOptional(we,i,"batchingTexture"),C.setValue(we,"batchingTexture",i._matricesTexture,ie),C.setOptional(we,i,"batchingIdTexture"),C.setValue(we,"batchingIdTexture",i._indirectTexture,ie),C.setOptional(we,i,"batchingColorTexture"),null!==i._colorsTexture&&C.setValue(we,"batchingColorTexture",i._colorsTexture,ie));const k=n.morphAttributes;void 0===k.position&&void 0===k.normal&&void 0===k.color||ve.update(i,n,x);(w||v.receiveShadow!==i.receiveShadow)&&(v.receiveShadow=i.receiveShadow,C.setValue(we,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(M.envMap.value=l,M.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(M.envMapIntensity.value=t.environmentIntensity);void 0!==M.dfgLUT&&(M.dfgLUT.value=(null===y7&&(y7=new p2(A7,16,16,RQ,yQ),y7.name="DFG_LUT",y7.minFilter=cQ,y7.magFilter=cQ,y7.wrapS=iQ,y7.wrapT=iQ,y7.generateMipmaps=!1,y7.needsUpdate=!0),y7));w&&(C.setValue(we,"toneMappingExposure",S.toneMappingExposure),v.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(M,T),a&&!0===r.fog&&de.refreshFogUniforms(M,a),de.refreshMaterialUniforms(M,r,B,I,b.state.transmissionRenderTarget[e.id]),m8.upload(we,Ve(v),M,ie));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(m8.upload(we,Ve(v),M,ie),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&C.setValue(we,"center",i.center);if(C.setValue(we,"modelViewMatrix",i.modelViewMatrix),C.setValue(we,"normalMatrix",i.normalMatrix),C.setValue(we,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];_e.update(n,x),_e.bind(n,x)}}return x}(e,t,n,r,i);te.setMaterial(r,o);let l=n.index,c=1;if(!0===r.wireframe){if(l=le.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,p=(u.start+u.count)*c;null!==a&&(h=Math.max(h,a.start*c),p=Math.min(p,(a.start+a.count)*c)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):void 0!==d&&null!==d&&(h=Math.max(h,0),p=Math.min(p,d.count));const f=p-h;if(f<0||f===1/0)return;let m;xe.setup(i,r,s,n,l);let g=Ae;if(null!==l&&(m=se.get(l),g=ye,g.setIndex(m)),i.isMesh)!0===r.wireframe?(te.setLineWidth(r.wireframeLinewidth*Z()),g.setMode(we.LINES)):g.setMode(we.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),te.setLineWidth(e*Z()),i.isLineSegments?g.setMode(we.LINES):i.isLineLoop?g.setMode(we.LINE_LOOP):g.setMode(we.LINE_STRIP)}else i.isPoints?g.setMode(we.POINTS):i.isSprite&&g.setMode(we.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)nJ("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),g.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(J.get("WEBGL_multi_draw"))g.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,a=l?se.get(l).bytesPerElement:1,o=re.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)o.setValue(we,"_gl_DrawID",r),g.render(e[r]/a,t[r])}else if(i.isInstancedMesh)g.renderInstances(h,f,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(h,f,t)}else g.render(h,f)},this.compile=function(e,t,n=null){null===n&&(n=e),b=pe.get(n),b.init(t),_.push(b),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(b.pushLight(e),e.castShadow&&b.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(b.pushLight(e),e.castShadow&&b.pushShadow(e))}),b.setupLights();const r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];ke(a,n,e),r.add(a)}else ke(t,n,e),r.add(t)}),b=_.pop(),r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){re.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==J.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Re=null;function Le(){je.stop()}function Oe(){je.start()}const je=new M5;function De(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)b.pushLight(e),e.castShadow&&b.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||q.intersectsSprite(e)){r&&X.setFromMatrixPosition(e.matrixWorld).applyMatrix4($);const t=ce.update(e),i=e.material;i.visible&&y.push(e,t,i,n,X.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||q.intersectsObject(e))){const t=ce.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),X.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),X.copy(t.boundingSphere.center)),X.applyMatrix4(e.matrixWorld).applyMatrix4($)),Array.isArray(i)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=i[o.materialIndex];s&&s.visible&&y.push(e,t,s,n,X.z,o)}}else i.visible&&y.push(e,t,i,n,X.z,null)}const i=e.children;for(let a=0,o=i.length;a<o;a++)De(i[a],t,n,r)}function Ie(e,t,n,r){const{opaque:i,transmissive:a,transparent:o}=e;b.setupLightsView(n),!0===W&&fe.setGlobalState(S.clippingPlanes,n),r&&te.viewport(k.copy(r)),i.length>0&&Fe(i,t,n),a.length>0&&Fe(a,t,n),o.length>0&&Fe(o,t,n),te.buffers.depth.setTest(!0),te.buffers.depth.setMask(!0),te.buffers.color.setMask(!0),te.setPolygonOffset(!1)}function Be(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;if(void 0===b.state.transmissionRenderTarget[r.id]){const e=J.has("EXT_color_buffer_half_float")||J.has("EXT_color_buffer_float");b.state.transmissionRenderTarget[r.id]=new BJ(1,1,{generateMipmaps:!0,type:e?yQ:hQ,minFilter:dQ,samples:ee.samples,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:TJ.workingColorSpace})}const a=b.state.transmissionRenderTarget[r.id],o=r.viewport||k;a.setSize(o.z*S.transmissionResolutionScale,o.w*S.transmissionResolutionScale);const s=S.getRenderTarget(),l=S.getActiveCubeFace(),c=S.getActiveMipmapLevel();S.setRenderTarget(a),S.getClearColor(O),j=S.getClearAlpha(),j<1&&S.setClearColor(16777215,.5),S.clear(),Q&&ge.render(n);const u=S.toneMapping;S.toneMapping=0;const d=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),b.setupLightsView(r),!0===W&&fe.setGlobalState(S.clippingPlanes,r),Fe(e,n,r),ie.updateMultisampleRenderTarget(a),ie.updateRenderTargetMipmap(a),!1===J.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,a=t.length;i<a;i++){const a=t[i],{object:o,geometry:s,material:l,group:c}=a;if(2===l.side&&o.layers.test(r.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,ze(o,n,r,s,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(ie.updateMultisampleRenderTarget(a),ie.updateRenderTargetMipmap(a))}S.setRenderTarget(s,l,c),S.setClearColor(O,j),void 0!==d&&(r.viewport=d),S.toneMapping=u}function Fe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],{object:o,geometry:s,group:l}=a;let c=a.material;!0===c.allowOverride&&null!==r&&(c=r),o.layers.test(n.layers)&&ze(o,t,n,s,c,l)}}function ze(e,t,n,r,i,a){e.onBeforeRender(S,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(S,t,n,r,e,a),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,S.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,S.renderBufferDirect(n,t,r,i,e,a),i.side=2):S.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(S,t,n,r,i,a)}function Ue(e,t,n){!0!==t.isScene&&(t=Y);const r=re.get(e),i=b.state.lights,a=b.state.shadowsArray,o=i.state.version,s=ue.getParameters(e,i.state,a,t,n),l=ue.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?oe:ae).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ne),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return Ge(e,s),u}else s.uniforms=ue.getUniforms(e),e.onBeforeCompile(s,S),u=ue.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;const d=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=fe.uniform),Ge(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotLightMatrix.value=i.state.spotLightMatrix,d.spotLightMap.value=i.state.spotLightMap,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Ve(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=m8.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ge(e,t){const n=re.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}je.setAnimationLoop(function(e){Re&&Re(e)}),"undefined"!==typeof self&&je.setContext(self),this.setAnimationLoop=function(e){Re=e,Ce.setAnimationLoop(e),null===e?je.stop():je.start()},Ce.addEventListener("sessionstart",Le),Ce.addEventListener("sessionend",Oe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void tJ("WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===T)return;const n=!0===Ce.enabled&&!0===Ce.isPresenting,r=null!==w&&(null===E||n)&&w.begin(S,E);if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0!==Ce.enabled||!0!==Ce.isPresenting||null!==w&&!1!==w.isCompositing()||(!0===Ce.cameraAutoUpdate&&Ce.updateCamera(t),t=Ce.getCamera()),!0===e.isScene&&e.onBeforeRender(S,e,t,E),b=pe.get(e,_.length),b.init(t),_.push(b),$.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),q.setFromProjectionMatrix($,GZ,t.reversedDepth),H=this.localClippingEnabled,W=fe.init(this.clippingPlanes,H),y=he.get(e,x.length),y.init(),x.push(y),!0===Ce.enabled&&!0===Ce.isPresenting){const e=S.xr.getDepthSensingMesh();null!==e&&De(e,t,-1/0,S.sortObjects)}De(e,t,0,S.sortObjects),y.finish(),!0===S.sortObjects&&y.sort(F,z),Q=!1===Ce.enabled||!1===Ce.isPresenting||!1===Ce.hasDepthSensing(),Q&&ge.addToRenderList(y,e),this.info.render.frame++,!0===W&&fe.beginShadows();const i=b.state.shadowsArray;me.render(i,e,t),!0===W&&fe.endShadows(),!0===this.info.autoReset&&this.info.reset();if(!1===(r&&w.hasRenderPass())){const n=y.opaque,r=y.transmissive;if(b.setupLights(),t.isArrayCamera){const i=t.cameras;if(r.length>0)for(let t=0,a=i.length;t<a;t++){Be(n,r,e,i[t])}Q&&ge.render(e);for(let t=0,n=i.length;t<n;t++){const n=i[t];Ie(y,e,n,n.viewport)}}else r.length>0&&Be(n,r,e,t),Q&&ge.render(e),Ie(y,e,t)}null!==E&&0===M&&(ie.updateMultisampleRenderTarget(E),ie.updateRenderTargetMipmap(E)),r&&w.end(S),!0===e.isScene&&e.onAfterRender(S,e,t),xe.resetDefaultState(),P=-1,N=null,_.pop(),_.length>0?(b=_[_.length-1],!0===W&&fe.setGlobalState(S.clippingPlanes,b.state.camera)):b=null,x.pop(),y=x.length>0?x[x.length-1]:null},this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,n){const r=re.get(e);r.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===r.__autoAllocateDepthBuffer&&(r.__useRenderToTexture=!1),re.get(e.texture).__webglTexture=t,re.get(e.depthTexture).__webglTexture=r.__autoAllocateDepthBuffer?void 0:n,r.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=re.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const qe=we.createFramebuffer();this.setRenderTarget=function(e,t=0,n=0){E=e,C=t,M=n;let r=null,i=!1,a=!1;if(e){const o=re.get(e);if(void 0!==o.__useDefaultFramebuffer)return te.bindFramebuffer(we.FRAMEBUFFER,o.__webglFramebuffer),k.copy(e.viewport),R.copy(e.scissor),L=e.scissorTest,te.viewport(k),te.scissor(R),te.setScissorTest(L),void(P=-1);if(void 0===o.__webglFramebuffer)ie.setupRenderTarget(e);else if(o.__hasExternalTextures)ie.rebindTextures(e,re.get(e.texture).__webglTexture,re.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&re.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ie.setupDepthRenderbuffer(e)}}const s=e.texture;(s.isData3DTexture||s.isDataArrayTexture||s.isCompressedArrayTexture)&&(a=!0);const l=re.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(l[t])?l[t][n]:l[t],i=!0):r=e.samples>0&&!1===ie.useMultisampledRTT(e)?re.get(e).__webglMultisampledFramebuffer:Array.isArray(l)?l[n]:l,k.copy(e.viewport),R.copy(e.scissor),L=e.scissorTest}else k.copy(U).multiplyScalar(B).floor(),R.copy(V).multiplyScalar(B).floor(),L=G;0!==n&&(r=qe);if(te.bindFramebuffer(we.FRAMEBUFFER,r)&&te.drawBuffers(e,r),te.viewport(k),te.scissor(R),te.setScissorTest(L),i){const r=re.get(e.texture);we.framebufferTexture2D(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(a){const r=t;for(let t=0;t<e.textures.length;t++){const i=re.get(e.textures[t]);we.framebufferTextureLayer(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0+t,i.__webglTexture,n,r)}}else if(null!==e&&0!==n){const t=re.get(e.texture);we.framebufferTexture2D(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_2D,t.__webglTexture,n)}P=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o,s=0){if(!e||!e.isWebGLRenderTarget)return void tJ("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=re.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){te.bindFramebuffer(we.FRAMEBUFFER,l);try{const o=e.textures[s],l=o.format,c=o.type;if(!ee.textureFormatReadable(l))return void tJ("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!ee.textureTypeReadable(c))return void tJ("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&(e.textures.length>1&&we.readBuffer(we.COLOR_ATTACHMENT0+s),we.readPixels(t,n,r,i,be.convert(l),be.convert(c),a))}finally{const e=null!==E?re.get(E).__webglFramebuffer:null;te.bindFramebuffer(we.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,i,a,o,s=0){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=re.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){te.bindFramebuffer(we.FRAMEBUFFER,l);const o=e.textures[s],c=o.format,u=o.type;if(!ee.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ee.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const d=we.createBuffer();we.bindBuffer(we.PIXEL_PACK_BUFFER,d),we.bufferData(we.PIXEL_PACK_BUFFER,a.byteLength,we.STREAM_READ),e.textures.length>1&&we.readBuffer(we.COLOR_ATTACHMENT0+s),we.readPixels(t,n,r,i,be.convert(c),be.convert(u),0);const h=null!==E?re.get(E).__webglFramebuffer:null;te.bindFramebuffer(we.FRAMEBUFFER,h);const p=we.fenceSync(we.SYNC_GPU_COMMANDS_COMPLETE,0);return we.flush(),await function(e,t,n){return new Promise(function(r,i){setTimeout(function a(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:r()}},n)})}(we,p,4),we.bindBuffer(we.PIXEL_PACK_BUFFER,d),we.getBufferSubData(we.PIXEL_PACK_BUFFER,0,a),we.deleteBuffer(d),we.deleteSync(p),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),a=Math.floor(e.image.height*r),o=null!==t?t.x:0,s=null!==t?t.y:0;ie.setTexture2D(e,0),we.copyTexSubImage2D(we.TEXTURE_2D,n,0,0,o,s,i,a),te.unbindTexture()};const We=we.createFramebuffer(),He=we.createFramebuffer();this.copyTextureToTexture=function(e,t,n=null,r=null,i=0,a=null){let o,s,l,c,u,d,h,p,f;null===a&&(0!==i?(nJ("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),a=i,i=0):a=0);const m=e.isCompressedTexture?e.mipmaps[a]:e.image;if(null!==n)o=n.max.x-n.min.x,s=n.max.y-n.min.y,l=n.isBox3?n.max.z-n.min.z:1,c=n.min.x,u=n.min.y,d=n.isBox3?n.min.z:0;else{const t=Math.pow(2,-i);o=Math.floor(m.width*t),s=Math.floor(m.height*t),l=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,c=0,u=0,d=0}null!==r?(h=r.x,p=r.y,f=r.z):(h=0,p=0,f=0);const g=be.convert(t.format),v=be.convert(t.type);let A;t.isData3DTexture?(ie.setTexture3D(t,0),A=we.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(ie.setTexture2DArray(t,0),A=we.TEXTURE_2D_ARRAY):(ie.setTexture2D(t,0),A=we.TEXTURE_2D),we.pixelStorei(we.UNPACK_FLIP_Y_WEBGL,t.flipY),we.pixelStorei(we.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),we.pixelStorei(we.UNPACK_ALIGNMENT,t.unpackAlignment);const y=we.getParameter(we.UNPACK_ROW_LENGTH),b=we.getParameter(we.UNPACK_IMAGE_HEIGHT),x=we.getParameter(we.UNPACK_SKIP_PIXELS),_=we.getParameter(we.UNPACK_SKIP_ROWS),w=we.getParameter(we.UNPACK_SKIP_IMAGES);we.pixelStorei(we.UNPACK_ROW_LENGTH,m.width),we.pixelStorei(we.UNPACK_IMAGE_HEIGHT,m.height),we.pixelStorei(we.UNPACK_SKIP_PIXELS,c),we.pixelStorei(we.UNPACK_SKIP_ROWS,u),we.pixelStorei(we.UNPACK_SKIP_IMAGES,d);const S=e.isDataArrayTexture||e.isData3DTexture,T=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const n=re.get(e),r=re.get(t),m=re.get(n.__renderTarget),g=re.get(r.__renderTarget);te.bindFramebuffer(we.READ_FRAMEBUFFER,m.__webglFramebuffer),te.bindFramebuffer(we.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<l;v++)S&&(we.framebufferTextureLayer(we.READ_FRAMEBUFFER,we.COLOR_ATTACHMENT0,re.get(e).__webglTexture,i,d+v),we.framebufferTextureLayer(we.DRAW_FRAMEBUFFER,we.COLOR_ATTACHMENT0,re.get(t).__webglTexture,a,f+v)),we.blitFramebuffer(c,u,o,s,h,p,o,s,we.DEPTH_BUFFER_BIT,we.NEAREST);te.bindFramebuffer(we.READ_FRAMEBUFFER,null),te.bindFramebuffer(we.DRAW_FRAMEBUFFER,null)}else if(0!==i||e.isRenderTargetTexture||re.has(e)){const n=re.get(e),r=re.get(t);te.bindFramebuffer(we.READ_FRAMEBUFFER,We),te.bindFramebuffer(we.DRAW_FRAMEBUFFER,He);for(let e=0;e<l;e++)S?we.framebufferTextureLayer(we.READ_FRAMEBUFFER,we.COLOR_ATTACHMENT0,n.__webglTexture,i,d+e):we.framebufferTexture2D(we.READ_FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_2D,n.__webglTexture,i),T?we.framebufferTextureLayer(we.DRAW_FRAMEBUFFER,we.COLOR_ATTACHMENT0,r.__webglTexture,a,f+e):we.framebufferTexture2D(we.DRAW_FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_2D,r.__webglTexture,a),0!==i?we.blitFramebuffer(c,u,o,s,h,p,o,s,we.COLOR_BUFFER_BIT,we.NEAREST):T?we.copyTexSubImage3D(A,a,h,p,f+e,c,u,o,s):we.copyTexSubImage2D(A,a,h,p,c,u,o,s);te.bindFramebuffer(we.READ_FRAMEBUFFER,null),te.bindFramebuffer(we.DRAW_FRAMEBUFFER,null)}else T?e.isDataTexture||e.isData3DTexture?we.texSubImage3D(A,a,h,p,f,o,s,l,g,v,m.data):t.isCompressedArrayTexture?we.compressedTexSubImage3D(A,a,h,p,f,o,s,l,g,m.data):we.texSubImage3D(A,a,h,p,f,o,s,l,g,v,m):e.isDataTexture?we.texSubImage2D(we.TEXTURE_2D,a,h,p,o,s,g,v,m.data):e.isCompressedTexture?we.compressedTexSubImage2D(we.TEXTURE_2D,a,h,p,m.width,m.height,g,m.data):we.texSubImage2D(we.TEXTURE_2D,a,h,p,o,s,g,v,m);we.pixelStorei(we.UNPACK_ROW_LENGTH,y),we.pixelStorei(we.UNPACK_IMAGE_HEIGHT,b),we.pixelStorei(we.UNPACK_SKIP_PIXELS,x),we.pixelStorei(we.UNPACK_SKIP_ROWS,_),we.pixelStorei(we.UNPACK_SKIP_IMAGES,w),0===a&&t.generateMipmaps&&we.generateMipmap(A),te.unbindTexture()},this.initRenderTarget=function(e){void 0===re.get(e).__webglFramebuffer&&ie.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?ie.setTextureCube(e,0):e.isData3DTexture?ie.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ie.setTexture2DArray(e,0):ie.setTexture2D(e,0),te.unbindTexture()},this.resetState=function(){C=0,M=0,E=null,te.reset(),xe.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return GZ}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=TJ._getDrawingBufferColorSpace(e),t.unpackColorSpace=TJ._getUnpackColorSpace()}},Scene:l2,PerspectiveCamera:e2,Raycaster:class{constructor(e,t,n=0,r=1/0){this.ray=new p0(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new T0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):tJ("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return s5.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(s5),this}intersectObject(e,t=!0,n=[]){return c5(e,this,n,t),n.sort(l5),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)c5(e[r],this,n,t);return n.sort(l5),n}},SRGBColorSpace:MZ,TextureLoader:R4,Vector2:mJ,Vector3:vJ,Box3:UJ,Color:o1,Mesh:V1,SphereGeometry:Q3,MeshBasicMaterial:u1,BackSide:1,Clock:Z4},Gze=J7({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(t){return t.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var n=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(t,n){return e.hoverOrderComparator(t.object,n.object)});var i=r.find(function(t){return e.hoverFilter(t.object)})||null;n=i?i.object:null,e.intersection=i||null}n!==e.hoverObj&&(e.onHover(n,e.hoverObj,e.intersection),e.tooltip.content(n&&Yte(e.tooltipContent)(n,e.intersection)||null),e.hoverObj=n)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos;return{x:t.x,y:t.y}},cameraPosition:function(e,t,n,r){var i=e.camera;if(t&&e.initialised){var a=t,o=n||{x:0,y:0,z:0};if(r){var s=Object.assign({},i.position),l=d();e.tweenGroup.add(new o9(s).to(a,r).easing(e9.Quadratic.Out).onUpdate(c).start()),e.tweenGroup.add(new o9(l).to(o,r/3).easing(e9.Quadratic.Out).onUpdate(u).start())}else c(a),u(o);return this}return Object.assign({},i.position,{lookAt:d()});function c(e){var t=e.x,n=e.y,r=e.z;void 0!==t&&(i.position.x=t),void 0!==n&&(i.position.y=n),void 0!==r&&(i.position.z=r)}function u(t){var n=new Vze.Vector3(t.x,t.y,t.z);e.controls.enabled&&e.controls.target?e.controls.target=n:i.lookAt(n)}function d(){return Object.assign(new Vze.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];return this.fitToBbox(this.getBbox.apply(this,i),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=e.camera;if(t){var a=new Vze.Vector3(0,0,0),o=2*Math.max.apply(Math,zze(Object.entries(t).map(function(e){var t=Fze(e,2),n=t[0],r=t[1];return Math.max.apply(Math,zze(r.map(function(e){return Math.abs(a[n]-e)})))}))),s=(1-2*r/e.height)*i.fov,l=o/Math.atan(s*Math.PI/180),c=l/i.aspect,u=Math.max(l,c);if(u>0){var d=a.clone().sub(i.position).normalize().multiplyScalar(-u);this.cameraPosition(d,a,n)}}return this},getBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new Vze.Box3(new Vze.Vector3(0,0,0),new Vze.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(e){return n.expandByObject(e)}),Object.assign.apply(Object,zze(["x","y","z"].map(function(e){return Bze({},e,[n.min[e],n.max[e]])})))):null},getScreenCoords:function(e,t,n,r){var i=new Vze.Vector3(t,n,r);return i.project(this.camera()),{x:(i.x+1)*e.width/2,y:-(i.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new Vze.Vector2(t/e.width*2-1,-n/e.height*2+1),a=new Vze.Raycaster;return a.setFromCamera(i,e.camera),Object.assign({},a.ray.at(r,new Vze.Vector3))},intersectingObjects:function(e,t,n){var r=new Vze.Vector2(t/e.width*2-1,-n/e.height*2+1),i=new Vze.Raycaster;return i.params.Line.threshold=e.lineHoverPrecision,i.params.Points.threshold=e.pointsHoverPrecision,i.setFromCamera(r,e.camera),i.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Vze.Scene,camera:new Vze.PerspectiveCamera,clock:new Vze.Clock,tweenGroup:new n9,lastRaycasterCheck:0}},init:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.controlType,i=void 0===r?"trackball":r,a=n.useWebGPU,o=void 0!==a&&a,s=n.rendererConfig,l=void 0===s?{}:s,c=n.extraRenderers,u=void 0===c?[]:c,d=n.waitForLoadComplete,h=void 0===d||d;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new Dze(t.container),t.pointerPos=new Vze.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(e){return t.container.addEventListener(e,function(n){if("pointerdown"===e&&(t.isPointerPressed=!0),!t.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||t.isPointerPressed)&&("mouse"===n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some(function(e){return Math.abs(e)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var r=function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+r,left:t.left+n}}(t.container);t.pointerPos.x=n.pageX-r.left,t.pointerPos.y=n.pageY-r.top}},{passive:!0})}),t.container.addEventListener("pointerup",function(e){t.isPointerPressed&&(t.isPointerPressed=!1,t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag)||requestAnimationFrame(function(){0===e.button&&t.onClick(t.hoverObj||null,e,t.intersection),2===e.button&&t.onRightClick&&t.onRightClick(t.hoverObj||null,e,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(e){t.onRightClick&&e.preventDefault()}),t.renderer=new(o?oLe:Vze.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},l)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=u,t.extraRenderers.forEach(function(e){e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.pointerEvents="none",t.container.appendChild(e.domElement)}),t.postProcessingComposer=new KIe(t.renderer),t.postProcessingComposer.addPass(new XIe(t.scene,t.camera)),t.controls=new{trackball:BDe,orbit:gIe,fly:RIe}[i](t.camera,t.renderer.domElement),"fly"===i&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),"trackball"!==i&&"orbit"!==i||(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(zze(t.extraRenderers)).forEach(function(e){return e.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Vze.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!h,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,r=e.width,i=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(i,"px"),[e.renderer,e.postProcessingComposer].concat(zze(e.extraRenderers)).forEach(function(e){return e.setSize(r,i)}),e.camera.aspect=r/i;var a=e.viewOffset.slice(0,2);a.some(function(e){return e})&&(n=e.camera).setViewOffset.apply(n,[r,i].concat(zze(a),[r,i])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var o,s=e.width,l=e.height,c=e.viewOffset.slice(0,2);c.some(function(e){return e})?(o=e.camera).setViewOffset.apply(o,[s,l].concat(zze(c),[s,l])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=2.5*e.skyRadius,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Vze.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var u=gBe(e.backgroundColor).alpha;void 0===u&&(u=1),e.renderer.setClearColor(new Vze.Color(OBe(1,e.backgroundColor)),u)}function d(){e.loadComplete=e.scene.visible=!0}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?(new Vze.TextureLoader).load(e.backgroundImageUrl,function(t){t.colorSpace=Vze.SRGBColorSpace,e.skysphere.material=new Vze.MeshBasicMaterial({map:t,side:Vze.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&d()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&d())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(t){return e.scene.remove(t)}),e.lights.forEach(function(t){return e.scene.add(t)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(t){return e.scene.remove(t)}),e.objects.forEach(function(t){return e.scene.add(t)}))}});function qze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Wze(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hze(Object(n),!0).forEach(function(t){Wze(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Kze(e){return function(e){if(Array.isArray(e))return qze(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return qze(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qze(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xze(e,t){var n=new t;return n._destructor&&n._destructor(),{linkProp:function(t){return{default:n[t](),onChange:function(n,r){r[e][t](n)},triggerUpdate:!1}},linkMethod:function(t){return function(n){for(var r=n[e],i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=r[t].apply(r,a);return s===r?this:s}}}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".scene-container .clickable {\n  cursor: pointer;\n}");var Yze=["rendererConfig","waitForGlobeReady"],Qze=$ze($ze({},window.THREE?window.THREE:{AmbientLight:H4,DirectionalLight:W4,Vector2:mJ,REVISION:nY}),{},{CSS2DRenderer:class{constructor(e={}){const t=this;let n,r,i,a;const o={objects:new WeakMap},s=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,n=e.children.length;t<n;t++)l(e.children[t])}function c(e,n,r){if(!1!==e.visible){if(e.isCSS2DObject){_5.setFromMatrixPosition(e.matrixWorld),_5.applyMatrix4(S5);const l=_5.z>=-1&&_5.z<=1&&!0===e.layers.test(r.layers),c=e.element;c.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,n,r),c.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(_5.x*i+i)+"px,"+(-_5.y*a+a)+"px)",c.parentNode!==s&&s.appendChild(c),e.onAfterRender(t,n,r));const d={distanceToCameraSquared:u(r,e)};o.objects.set(e,d)}for(let t=0,i=e.children.length;t<i;t++)c(e.children[t],n,r)}else l(e)}function u(e,t){return T5.setFromMatrixPosition(e.matrixWorld),C5.setFromMatrixPosition(t.matrixWorld),T5.distanceToSquared(C5)}s.style.overflow="hidden",this.domElement=s,this.sortObjects=!0,this.getSize=function(){return{width:n,height:r}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),w5.copy(t.matrixWorldInverse),S5.multiplyMatrices(t.projectionMatrix,w5),c(e,e,t),this.sortObjects&&function(e){const t=function(e){const t=[];return e.traverseVisible(function(e){e.isCSS2DObject&&t.push(e)}),t}(e).sort(function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),n=t.length;for(let r=0,i=t.length;r<i;r++)t[r].element.style.zIndex=n-r}(e)},this.setSize=function(e,t){n=e,r=t,i=n/2,a=r/2,s.style.width=e+"px",s.style.height=t+"px"}}}}),Zze=Xze("globe",vDe),Jze=Object.assign.apply(Object,Kze(["globeImageUrl","bumpImageUrl","globeTileEngineUrl","globeTileEngineMaxLevel","globeCurvatureResolution","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude","onGlobeReady","pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration","arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration","polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration","pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration","heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration","hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration","hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration","tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration","particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture","ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod","labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration","htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration","objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject","customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(e){return Wze({},e,Zze.linkProp(e))}))),eUe=Object.assign.apply(Object,Kze(["globeMaterial","globeTileEngineClearCache","getGlobeRadius","getCoords","toGeoCoords"].map(function(e){return Wze({},e,Zze.linkMethod(e))}))),tUe=Xze("renderObjs",Gze),nUe=Object.assign.apply(Object,Kze(["width","height","backgroundColor","backgroundImageUrl","enablePointerInteraction"].map(function(e){return Wze({},e,tUe.linkProp(e))}))),rUe=Object.assign.apply(Object,Kze(["lights","postProcessingComposer"].map(function(e){return Wze({},e,tUe.linkMethod(e))}))),iUe=J7({props:$ze($ze({onZoom:{triggerUpdate:!1},onGlobeClick:{triggerUpdate:!1},onGlobeRightClick:{triggerUpdate:!1},pointLabel:{default:"name",triggerUpdate:!1},onPointClick:{triggerUpdate:!1},onPointRightClick:{triggerUpdate:!1},onPointHover:{triggerUpdate:!1},arcLabel:{default:"name",triggerUpdate:!1},onArcClick:{triggerUpdate:!1},onArcRightClick:{triggerUpdate:!1},onArcHover:{triggerUpdate:!1},polygonLabel:{default:"name",triggerUpdate:!1},onPolygonClick:{triggerUpdate:!1},onPolygonRightClick:{triggerUpdate:!1},onPolygonHover:{triggerUpdate:!1},pathLabel:{default:"name",triggerUpdate:!1},onPathClick:{triggerUpdate:!1},onPathRightClick:{triggerUpdate:!1},onPathHover:{triggerUpdate:!1},onHeatmapClick:{triggerUpdate:!1},onHeatmapRightClick:{triggerUpdate:!1},onHeatmapHover:{triggerUpdate:!1},hexLabel:{triggerUpdate:!1},onHexClick:{triggerUpdate:!1},onHexRightClick:{triggerUpdate:!1},onHexHover:{triggerUpdate:!1},hexPolygonLabel:{triggerUpdate:!1},onHexPolygonClick:{triggerUpdate:!1},onHexPolygonRightClick:{triggerUpdate:!1},onHexPolygonHover:{triggerUpdate:!1},tileLabel:{default:"name",triggerUpdate:!1},onTileClick:{triggerUpdate:!1},onTileRightClick:{triggerUpdate:!1},onTileHover:{triggerUpdate:!1},particleLabel:{default:"name",triggerUpdate:!1},onParticleClick:{triggerUpdate:!1},onParticleRightClick:{triggerUpdate:!1},onParticleHover:{triggerUpdate:!1},labelLabel:{triggerUpdate:!1},onLabelClick:{triggerUpdate:!1},onLabelRightClick:{triggerUpdate:!1},onLabelHover:{triggerUpdate:!1},objectLabel:{default:"name",triggerUpdate:!1},onObjectClick:{triggerUpdate:!1},onObjectRightClick:{triggerUpdate:!1},onObjectHover:{triggerUpdate:!1},customLayerLabel:{default:"name",triggerUpdate:!1},onCustomLayerClick:{triggerUpdate:!1},onCustomLayerRightClick:{triggerUpdate:!1},onCustomLayerHover:{triggerUpdate:!1},pointerEventsFilter:{default:function(){return!0},triggerUpdate:!1},lineHoverPrecision:{default:.2,triggerUpdate:!1,onChange:function(e,t){t.renderObjs.lineHoverPrecision(e),t.renderObjs.pointsHoverPrecision(e)}},showPointerCursor:{default:!0,triggerUpdate:!1},globeOffset:{default:[0,0],triggerUpdate:!1,onChange:function(e,t){return Array.isArray(e)&&2===e.length&&t.renderObjs.viewOffset(e.map(function(e){return-e}))}}},Jze),nUe),methods:$ze($ze({pauseAnimation:function(e){var t;return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),null===(t=e.globe)||void 0===t||t.pauseAnimation(),this},resumeAnimation:function(e){var t;return null===e.animationFrameRequestId&&this._animationCycle(),null===(t=e.globe)||void 0===t||t.resumeAnimation(),this},_animationCycle:function(e){e.renderObjs.tick(),e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},pointOfView:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.globe.toGeoCoords(e.renderObjs.cameraPosition());if(void 0===t.lat&&void 0===t.lng&&void 0===t.altitude)return r;var i=Object.assign({},r,t);if(["lat","lng","altitude"].forEach(function(e){return i[e]=+i[e]}),n){for(;r.lng-i.lng>180;)r.lng-=360;for(;r.lng-i.lng<-180;)r.lng+=360;e.tweenGroup.add(new o9(r).to(i,n).easing(e9.Cubic.InOut).onUpdate(a).start())}else a(i);return this;function a(t){var n=t.lat,r=t.lng,i=t.altitude;e.renderObjs.cameraPosition(e.globe.getCoords(n,r,i)),e.globe.setPointOfView(e.renderObjs.camera())}},getScreenCoords:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=(t=e.globe).getCoords.apply(t,r);return e.renderObjs.getScreenCoords(a.x,a.y,a.z)},toGlobeCoords:function(e,t,n){var r=e.renderObjs.intersectingObjects(t,n).find(function(e){return"globe"===(e.object.__globeObjType||e.object.parent.__globeObjType)});if(!r)return null;var i=e.globe.toGeoCoords(r.point);return{lat:i.lat,lng:i.lng}},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},_destructor:function(e){e.globe._destructor(),this.pauseAnimation(),this.pointsData([]),this.arcsData([]),this.polygonsData([]),this.pathsData([]),this.heatmapsData([]),this.hexBinPointsData([]),this.hexPolygonsData([]),this.tilesData([]),this.particlesData([]),this.labelsData([]),this.htmlElementsData([]),this.objectsData([]),this.customLayerData([])}},eUe),rUe),stateInit:function(e){var t=e.rendererConfig,n=e.waitForGlobeReady,r=void 0===n||n,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,Yze),a=new vDe($ze({waitForGlobeReady:r},i));return{globe:a,renderObjs:Gze({controlType:"orbit",rendererConfig:t,waitForLoadComplete:r,extraRenderers:[new Qze.CSS2DRenderer]}).skyRadius(500*a.getGlobeRadius()).showNavInfo(!1).objects([a]).lights([new Qze.AmbientLight(13421772,Math.PI),new Qze.DirectionalLight(16777215,.6*Math.PI)]),tweenGroup:new n9}},init:function(e,t){var n=this;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var r=document.createElement("div");t.container.appendChild(r),t.renderObjs(r),t.globe.rendererSize(t.renderObjs.renderer().getSize(new Qze.Vector2)),this.pointOfView({altitude:2.5});var i=t.globe.getGlobeRadius(),a=t.renderObjs.controls();t.renderObjs.camera().near=.05,a.minDistance=i+Math.max(.001,1.1*t.renderObjs.camera().near),a.maxDistance=100*i,a.enablePan=!1,a.enableDamping=!0,a.dampingFactor=.1,a.rotateSpeed=.3,a.zoomSpeed=.3,a.zoomToCursor=!0,a.addEventListener("change",function(){a.target.setScalar(0);var e=n.pointOfView();a.rotateSpeed=.3*e.altitude,a.zoomSpeed=.5*Math.sqrt(e.altitude),t.globe.setPointOfView(t.renderObjs.camera()),t.onZoom&&t.onZoom(e)});var o=function(e){for(var t=e;t&&!t.hasOwnProperty("__globeObjType");)t=t.parent;return t},s={point:function(e){return e},arc:function(e){return e},polygon:function(e){return e.data},path:function(e){return e},heatmap:function(e){return e},hexbin:function(e){return e},hexPolygon:function(e){return e},tile:function(e){return e},particles:function(e,t){return!t||!t.hasOwnProperty("index")||e.length<=t.index?e:e[t.index]},label:function(e){return e},object:function(e){return e},custom:function(e){return e}};Qze.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverFilter(function(e){var n=o(e);if(!n)return!1;var r=n.__globeObjType;if("globe"!==r&&!s.hasOwnProperty(r))return!1;var i=s.hasOwnProperty(r)&&n.__data?s[r](n.__data):null;return(!["points","hexBinPoints"].some(function(e){return e===r})||!Array.isArray(i))&&t.pointerEventsFilter(n,i)}).tooltipContent(function(e,n){var r={point:t.pointLabel,arc:t.arcLabel,polygon:t.polygonLabel,path:t.pathLabel,hexbin:t.hexLabel,hexPolygon:t.hexPolygonLabel,tile:t.tileLabel,particles:t.particleLabel,label:t.labelLabel,object:t.objectLabel,custom:t.customLayerLabel},i=o(e),a=i&&i.__globeObjType;return i&&a&&r.hasOwnProperty(a)&&s.hasOwnProperty(a)&&Yte(r[a])(s[a](i.__data,n))||""}).onHover(function(e,n,r){var i={point:t.onPointHover,arc:t.onArcHover,polygon:t.onPolygonHover,path:t.onPathHover,heatmap:t.onHeatmapHover,hexbin:t.onHexHover,hexPolygon:t.onHexPolygonHover,tile:t.onTileHover,particles:t.onParticleHover,label:t.onLabelHover,object:t.onObjectHover,custom:t.onCustomLayerHover},a={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},l=o(e);if(l&&!i.hasOwnProperty(l.__globeObjType)&&(l=null),l!==t.hoverObj){var c,u=t.hoverObj?t.hoverObj.__globeObjType:null,d=t.hoverData,h=l?l.__globeObjType:null,p=null!==(c=l)&&void 0!==c&&c.__data?s[h](l.__data,r):null;u&&u!==h&&i[u]&&i[u](null,d||null),h&&i[h]&&i[h](p,u===h?d:null),t.renderObjs.renderer().domElement.classList[h&&a[h]&&Yte(t.showPointerCursor)(h,p)?"add":"remove"]("clickable"),t.hoverObj=l,t.hoverData=p}}).onClick(function(e,r,i){if(e){var a={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},l=o(e),c=l.__globeObjType;if(l&&a.hasOwnProperty(c)&&a[c]){var u=[r],d=null!==i&&void 0!==i&&i.isVector3?i:null===i||void 0===i?void 0:i.point;if("globe"===c){var h=n.toGeoCoords(d),p=h.lat,f=h.lng;u.unshift({lat:p,lng:f})}else u.push(n.toGeoCoords(d));s.hasOwnProperty(c)&&u.unshift(s[c](l.__data,i)),a[c].apply(a,u)}}}).onRightClick(function(e,r,i){if(e){var a={globe:t.onGlobeRightClick,point:t.onPointRightClick,arc:t.onArcRightClick,polygon:t.onPolygonRightClick,path:t.onPathRightClick,heatmap:t.onHeatmapRightClick,hexbin:t.onHexRightClick,hexPolygon:t.onHexPolygonRightClick,tile:t.onTileRightClick,particles:t.onParticleRightClick,label:t.onLabelRightClick,object:t.onObjectRightClick,custom:t.onCustomLayerRightClick},l=o(e),c=l.__globeObjType;if(l&&a.hasOwnProperty(c)&&a[c]){var u=[r],d=null!==i&&void 0!==i&&i.isVector3?i:null===i||void 0===i?void 0:i.point;if("globe"===c){var h=n.toGeoCoords(d),p=h.lat,f=h.lng;u.unshift({lat:p,lng:f})}else u.push(n.toGeoCoords(d));s.hasOwnProperty(c)&&u.unshift(s[c](l.__data,i)),a[c].apply(a,u)}}}),this._animationCycle()}}),aUe=n(5173),oUe={width:aUe.number,height:aUe.number,globeOffset:aUe.arrayOf(aUe.number),backgroundColor:aUe.string,backgroundImageUrl:aUe.string,globeImageUrl:aUe.string,bumpImageUrl:aUe.string,globeTileEngineUrl:aUe.func,showGlobe:aUe.bool,showGraticules:aUe.bool,showAtmosphere:aUe.bool,atmosphereColor:aUe.string,atmosphereAltitude:aUe.number,globeMaterial:aUe.object,onGlobeReady:aUe.func,onGlobeClick:aUe.func,onGlobeRightClick:aUe.func,pointsData:aUe.arrayOf(aUe.object),pointLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pointLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pointColor:aUe.oneOfType([aUe.string,aUe.func]),pointAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pointRadius:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pointResolution:aUe.number,pointsMerge:aUe.bool,pointsTransitionDuration:aUe.number,pointLabel:aUe.oneOfType([aUe.string,aUe.func]),onPointClick:aUe.func,onPointRightClick:aUe.func,onPointHover:aUe.func,arcsData:aUe.arrayOf(aUe.object),arcStartLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcStartLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcEndLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcEndLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcColor:aUe.oneOfType([aUe.string,aUe.arrayOf(aUe.string),aUe.func]),arcAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcAltitudeAutoScale:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcStroke:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcCurveResolution:aUe.number,arcCircularResolution:aUe.number,arcDashLength:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcDashGap:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcDashInitialGap:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcDashAnimateTime:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),arcsTransitionDuration:aUe.number,arcLabel:aUe.oneOfType([aUe.string,aUe.func]),onArcClick:aUe.func,onArcRightClick:aUe.func,onArcHover:aUe.func,polygonsData:aUe.arrayOf(aUe.object),polygonGeoJsonGeometry:aUe.oneOfType([aUe.string,aUe.func]),polygonCapColor:aUe.oneOfType([aUe.string,aUe.func]),polygonCapMaterial:aUe.oneOfType([aUe.object,aUe.string,aUe.func]),polygonSideColor:aUe.oneOfType([aUe.string,aUe.func]),polygonSideMaterial:aUe.oneOfType([aUe.object,aUe.string,aUe.func]),polygonStrokeColor:aUe.oneOfType([aUe.string,aUe.func]),polygonAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),polygonCapCurvatureResolution:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),polygonsTransitionDuration:aUe.number,polygonLabel:aUe.oneOfType([aUe.string,aUe.func]),onPolygonClick:aUe.func,onPolygonRightClick:aUe.func,onPolygonHover:aUe.func,pathsData:aUe.array,pathPoints:aUe.oneOfType([aUe.array,aUe.string,aUe.func]),pathPointLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathPointLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathPointAlt:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathResolution:aUe.number,pathColor:aUe.oneOfType([aUe.string,aUe.arrayOf(aUe.string),aUe.func]),pathStroke:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathDashLength:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathDashGap:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathDashInitialGap:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathDashAnimateTime:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),pathTransitionDuration:aUe.number,pathLabel:aUe.oneOfType([aUe.string,aUe.func]),onPathClick:aUe.func,onPathRightClick:aUe.func,onPathHover:aUe.func,heatmapsData:aUe.array,heatmapPoints:aUe.oneOfType([aUe.array,aUe.string,aUe.func]),heatmapPointLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapPointLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapPointWeight:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapBandwidth:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapColorFn:aUe.oneOfType([aUe.string,aUe.func]),heatmapColorSaturation:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapBaseAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapTopAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),heatmapsTransitionDuration:aUe.number,onHeatmapClick:aUe.func,onHeatmapRightClick:aUe.func,onHeatmapHover:aUe.func,hexBinPointsData:aUe.arrayOf(aUe.object),hexBinPointLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexBinPointLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexBinPointWeight:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexBinResolution:aUe.number,hexMargin:aUe.oneOfType([aUe.number,aUe.func]),hexTopColor:aUe.func,hexSideColor:aUe.func,hexAltitude:aUe.oneOfType([aUe.number,aUe.func]),hexTopCurvatureResolution:aUe.number,hexBinMerge:aUe.bool,hexTransitionDuration:aUe.number,hexLabel:aUe.oneOfType([aUe.string,aUe.func]),onHexClick:aUe.func,onHexRightClick:aUe.func,onHexHover:aUe.func,hexPolygonsData:aUe.arrayOf(aUe.object),hexPolygonGeoJsonGeometry:aUe.oneOfType([aUe.string,aUe.func]),hexPolygonColor:aUe.oneOfType([aUe.string,aUe.func]),hexPolygonAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexPolygonResolution:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexPolygonMargin:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexPolygonUseDots:aUe.oneOfType([aUe.bool,aUe.string,aUe.func]),hexPolygonCurvatureResolution:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexPolygonDotResolution:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),hexPolygonsTransitionDuration:aUe.number,hexPolygonLabel:aUe.oneOfType([aUe.string,aUe.func]),onHexPolygonClick:aUe.func,onHexPolygonRightClick:aUe.func,onHexPolygonHover:aUe.func,tilesData:aUe.arrayOf(aUe.object),tileLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),tileLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),tileAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),tileWidth:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),tileHeight:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),tileUseGlobeProjection:aUe.oneOfType([aUe.bool,aUe.string,aUe.func]),tileMaterial:aUe.oneOfType([aUe.object,aUe.string,aUe.func]),tileCurvatureResolution:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),tilesTransitionDuration:aUe.number,tileLabel:aUe.oneOfType([aUe.string,aUe.func]),onTileClick:aUe.func,onTileRightClick:aUe.func,onTileHover:aUe.func,particlesData:aUe.arrayOf(aUe.object),particlesList:aUe.oneOfType([aUe.string,aUe.func]),particleLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),particleLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),particleAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),particlesSize:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),particlesSizeAttenuation:aUe.oneOfType([aUe.bool,aUe.string,aUe.func]),particlesColor:aUe.oneOfType([aUe.string,aUe.func]),particlesTexture:aUe.oneOfType([aUe.string,aUe.func]),particleLabel:aUe.oneOfType([aUe.string,aUe.func]),onParticleClick:aUe.func,onParticleRightClick:aUe.func,onParticleHover:aUe.func,ringsData:aUe.arrayOf(aUe.object),ringLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),ringLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),ringAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),ringColor:aUe.oneOfType([aUe.string,aUe.arrayOf(aUe.string),aUe.func]),ringResolution:aUe.number,ringMaxRadius:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),ringPropagationSpeed:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),ringRepeatPeriod:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelsData:aUe.arrayOf(aUe.object),labelLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelRotation:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelText:aUe.oneOfType([aUe.string,aUe.func]),labelSize:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelTypeFace:aUe.object,labelColor:aUe.oneOfType([aUe.string,aUe.func]),labelResolution:aUe.number,labelIncludeDot:aUe.oneOfType([aUe.bool,aUe.string,aUe.func]),labelDotRadius:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),labelDotOrientation:aUe.oneOfType([aUe.string,aUe.func]),labelsTransitionDuration:aUe.number,labelLabel:aUe.oneOfType([aUe.string,aUe.func]),onLabelClick:aUe.func,onLabelRightClick:aUe.func,onLabelHover:aUe.func,htmlElementsData:aUe.arrayOf(aUe.object),htmlLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),htmlLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),htmlAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),htmlElement:aUe.oneOfType([aUe.string,aUe.func]),htmlElementVisibilityModifier:aUe.func,htmlTransitionDuration:aUe.number,objectsData:aUe.arrayOf(aUe.object),objectLat:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),objectLng:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),objectAltitude:aUe.oneOfType([aUe.number,aUe.string,aUe.func]),objectRotation:aUe.oneOfType([aUe.shape({x:aUe.number,y:aUe.number,z:aUe.number}),aUe.string,aUe.func]),objectFacesSurface:aUe.oneOfType([aUe.bool,aUe.string,aUe.func]),objectThreeObject:aUe.oneOfType([aUe.object,aUe.string,aUe.func]),objectLabel:aUe.oneOfType([aUe.string,aUe.func]),onObjectClick:aUe.func,onObjectRightClick:aUe.func,onObjectHover:aUe.func,customLayerData:aUe.arrayOf(aUe.object),customThreeObject:aUe.oneOfType([aUe.object,aUe.string,aUe.func]),customThreeObjectUpdate:aUe.oneOfType([aUe.string,aUe.func]),customLayerLabel:aUe.oneOfType([aUe.string,aUe.func]),onCustomLayerClick:aUe.func,onCustomLayerRightClick:aUe.func,onCustomLayerHover:aUe.func,enablePointerInteraction:aUe.bool,pointerEventsFilter:aUe.func,lineHoverPrecision:aUe.number,showPointerCursor:aUe.oneOfType([aUe.bool,aUe.func]),onZoom:aUe.func},sUe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.wrapperElementType,i=void 0===n?"div":n,a=t.nodeMapper,o=void 0===a?function(e){return e}:a,s=t.methodNames,l=void 0===s?[]:s,c=t.initPropNames,u=void 0===c?[]:c;return(0,r.forwardRef)(function(t,n){var a=(0,r.useRef)(),s=(0,r.useMemo)(function(){var n=Object.fromEntries(u.filter(function(e){return t.hasOwnProperty(e)}).map(function(e){return[e,t[e]]}));return e(n)},[]);tY(function(){s(o(a.current))},r.useLayoutEffect),tY(function(){return s._destructor instanceof Function?s._destructor:void 0});var c=(0,r.useCallback)(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s[e]instanceof Function?s[e].apply(s,n):void 0},[s]),d=(0,r.useRef)({});return Object.keys(function(e,t){var n=new Set(t);return Object.assign.apply(Object,[{}].concat(KX(Object.entries(e).filter(function(e){var t=$X(e,1)[0];return!n.has(t)}).map(function(e){var t=$X(e,2);return HX({},t[0],t[1])}))))}(t,[].concat(JX(l),JX(u)))).filter(function(e){return d.current[e]!==t[e]}).forEach(function(e){return c(e,t[e])}),d.current=t,(0,r.useImperativeHandle)(n,function(){return Object.fromEntries(l.map(function(e){return[e,function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return c.apply(void 0,[e].concat(n))}]}))},[c]),r.createElement(i,{ref:a})})}(iUe,{methodNames:["pauseAnimation","resumeAnimation","pointOfView","lights","scene","camera","renderer","postProcessingComposer","controls","getGlobeRadius","getCoords","getScreenCoords","toGeoCoords","toGlobeCoords","globeTileEngineClearCache"],initPropNames:["animateIn","waitForGlobeReady","rendererConfig"]});sUe.displayName="Globe",sUe.propTypes=oUe;const lUe=(e,t)=>{const n=document.createElement("div");n.className="globe-marker",n.style.cssText="\n    width: 48px;\n    height: 48px;\n    border-radius: 50%;\n    overflow: hidden;\n    border: 2px solid #fff;\n    box-shadow: 0 2px 12px rgba(0,0,0,0.5);\n    cursor: pointer;\n    transition: transform 0.15s ease, box-shadow 0.15s ease;\n    background: #2a2a2a;\n    position: relative;\n  ";const r=e.photos[0]?(e=>{const t=e.positive_thumb_rel_path||e.thumb_rel_path||e.negative_thumb_rel_path;if(t)return`${(0,bn.Gi)()}/uploads/${t}`;return null})(e.photos[0]):null;if(r){const e=document.createElement("img");e.src=r,e.alt="",e.style.cssText="\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    ",e.loading="lazy",n.appendChild(e)}if(e.count>1){const t=document.createElement("div");t.className="globe-marker-count",t.textContent=e.count,t.style.cssText="\n      position: absolute;\n      top: -4px;\n      right: -4px;\n      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n      color: #000;\n      font-size: 11px;\n      font-weight: 700;\n      padding: 2px 5px;\n      border-radius: 10px;\n      min-width: 18px;\n      text-align: center;\n      box-shadow: 0 1px 4px rgba(0,0,0,0.3);\n    ",n.appendChild(t)}return n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.2)",n.style.boxShadow="0 4px 20px rgba(245, 158, 11, 0.6)",n.style.borderColor="#f59e0b",n.style.zIndex="1000"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)",n.style.boxShadow="0 2px 12px rgba(0,0,0,0.5)",n.style.borderColor="#fff",n.style.zIndex="auto"}),n.__clusterData=e,n};function cUe({photos:e=[],onZoomIn:t,width:n,height:i}){const a=(0,r.useRef)(),[o,s]=(0,r.useState)(null),l=(0,r.useMemo)(()=>e&&0!==e.length?((e,t=10)=>{const n=new Map;return e.forEach(e=>{const r=`${Math.floor(e.latitude/t)*t},${Math.floor(e.longitude/t)*t}`;n.has(r)||n.set(r,{photos:[],count:0,sumLat:0,sumLng:0});const i=n.get(r);i.photos.push(e),i.count++,i.sumLat+=e.latitude,i.sumLng+=e.longitude}),Array.from(n.values()).map(e=>({...e,lat:e.sumLat/e.count,lng:e.sumLng/e.count}))})(e,15):[],[e]);(0,r.useEffect)(()=>{a.current&&(a.current.pointOfView({lat:30,lng:0,altitude:2.5},0),a.current.controls().autoRotate=!0,a.current.controls().autoRotateSpeed=.3,a.current.controls().enableDamping=!0,a.current.controls().dampingFactor=.1)},[]);const c=(0,r.useCallback)(()=>{a.current&&(a.current.controls().autoRotate=!1)},[]),u=(0,r.useCallback)(e=>{const n=e.__clusterData;if(n&&n.photos&&n.photos.length>0){const e=1===n.count?14:10;t&&t({lat:n.lat,lng:n.lng,zoom:e})}},[t]),d=(0,r.useCallback)(e=>{const t=e?e.__clusterData:null;s(t),document.body.style.cursor=e?"pointer":"grab"},[]),h=(0,r.useCallback)(e=>lUe(e),[]);return(0,gt.jsxs)("div",{className:"photo-globe-wrapper",onMouseDown:c,onTouchStart:c,children:[(0,gt.jsx)(sUe,{ref:a,width:n,height:i,globeImageUrl:"https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg",bumpImageUrl:"https://unpkg.com/three-globe/example/img/earth-topology.png",backgroundImageUrl:"https://unpkg.com/three-globe/example/img/night-sky.png",htmlElementsData:l,htmlLat:"lat",htmlLng:"lng",htmlAltitude:.02,htmlElement:h,onHtmlElementClick:u,onHtmlElementHover:d,atmosphereColor:"#3a82f7",atmosphereAltitude:.15,animateIn:!0}),(0,gt.jsxs)("button",{className:"globe-zoom-flat-btn",onClick:()=>t&&t({lat:0,lng:0,zoom:3}),title:"Switch to flat map",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,gt.jsx)("path",{d:"M3 9h18M9 3v18"})]}),"Flat Map"]}),(0,gt.jsxs)("div",{className:"globe-photo-count",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,gt.jsx)("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),(0,gt.jsx)("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),(0,gt.jsxs)("span",{children:[e.length," photos across ",l.length," locations"]})]}),o&&(0,gt.jsxs)("div",{className:"globe-hover-info",children:[(0,gt.jsxs)("strong",{children:[o.count," photo",o.count>1?"s":""]}),(0,gt.jsxs)("span",{children:["Click to ",o.count>1?"explore":"view"]})]})]})}delete SX().Icon.Default.prototype._getIconUrl,SX().Icon.Default.mergeOptions({iconRetinaUrl:n(8249),iconUrl:n(7024),shadowUrl:n(1071)});const uUe=e=>{const t=e.positive_thumb_rel_path||e.thumb_rel_path||e.negative_thumb_rel_path;if(t){return`${(0,bn.Gi)()}/uploads/${t}`}return null},dUe={light:{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',name:"Light",options:{maxZoom:19,crossOrigin:"anonymous"}},dark:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',name:"Dark",options:{maxZoom:19,crossOrigin:"anonymous"}},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri",name:"Satellite",options:{maxZoom:19,crossOrigin:"anonymous"}}},hUe=[30,0],pUe=e=>{const t=e.getChildCount(),n=e.getAllChildMarkers().slice(0,4).map(e=>e.options.photo).filter(Boolean);let r=64,i=48,a=24;t>=50?(r=80,i=56,a=28):t>=10&&(r=72,i=52,a=26);let o="";if(n.length>0){const e=n[0],t=uUe(e);t&&(o+=`\n        <div class="cluster-main-thumb" style="\n          width: ${i}px;\n          height: ${i}px;\n          border-radius: 50%;\n          overflow: hidden;\n          border: 2px solid #fff;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          z-index: 2;\n        ">\n          <img src="${t}" alt="" style="width:100%;height:100%;object-fit:cover;" loading="lazy" />\n        </div>\n      `);const r=n.slice(1,4),s=[{top:"5%",left:"5%"},{top:"5%",right:"5%"},{bottom:"5%",left:"50%",transform:"translateX(-50%)"}];r.forEach((e,t)=>{const n=uUe(e);if(n&&s[t]){const e=s[t],r=Object.entries(e).map(([e,t])=>`${e}:${t}`).join(";");o+=`\n          <div class="cluster-mini-thumb" style="\n            width: ${a}px;\n            height: ${a}px;\n            border-radius: 50%;\n            overflow: hidden;\n            border: 1.5px solid #fff;\n            box-shadow: 0 1px 4px rgba(0,0,0,0.3);\n            position: absolute;\n            ${r};\n            z-index: 1;\n          ">\n            <img src="${n}" alt="" style="width:100%;height:100%;object-fit:cover;" loading="lazy" />\n          </div>\n        `}})}const s=`\n    <div class="cluster-count-badge" style="\n      position: absolute;\n      bottom: -4px;\n      right: -4px;\n      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n      color: #000;\n      font-size: ${t>=100?"10px":"11px"};\n      font-weight: 700;\n      padding: 2px 6px;\n      border-radius: 10px;\n      min-width: 20px;\n      text-align: center;\n      box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n      z-index: 3;\n    ">${t}</div>\n  `;return SX().divIcon({html:`\n      <div class="photo-cluster-mosaic" style="\n        width: ${r}px;\n        height: ${r}px;\n        position: relative;\n        cursor: pointer;\n        transition: transform 0.15s ease;\n      ">\n        ${o||`<div class="cluster-fallback" style="\n          width: ${i}px;\n          height: ${i}px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #374151 0%, #1f2937 100%);\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        ">\n          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">\n            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n            <circle cx="8.5" cy="8.5" r="1.5"/>\n            <polyline points="21,15 16,10 5,21"/>\n          </svg>\n        </div>`}\n        ${s}\n      </div>\n    `,className:"photo-cluster-container",iconSize:SX().point(r,r,!0)})};function fUe({onBoundsChange:e}){const t=function(e){const t=_X();return(0,r.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}({moveend:()=>{const n=t.getBounds();e({sw_lat:n.getSouthWest().lat,sw_lng:n.getSouthWest().lng,ne_lat:n.getNorthEast().lat,ne_lng:n.getNorthEast().lng})},zoomend:()=>{const n=t.getBounds();e({sw_lat:n.getSouthWest().lat,sw_lng:n.getSouthWest().lng,ne_lat:n.getNorthEast().lat,ne_lng:n.getNorthEast().lng})}});return null}function mUe({currentLayer:e,onChange:t}){return(0,gt.jsx)("div",{className:"map-layer-switcher",children:Object.entries(dUe).map(([n,r])=>(0,gt.jsx)("button",{className:"map-layer-btn "+(e===n?"active":""),onClick:()=>t(n),title:r.name,children:r.name},n))})}function gUe({photos:e}){const t=_X();return(0,r.useEffect)(()=>{if(e&&e.length>0){const n=e.filter(e=>e.latitude&&e.longitude);if(n.length>0){const e=SX().latLngBounds(n.map(e=>[e.latitude,e.longitude]));e.isValid()&&t.fitBounds(e,{padding:[50,50],maxZoom:12})}}},[e,t]),null}function vUe({filters:e,onPhotoClick:t,selectedPhoto:n}){const{theme:i}=Av(),[a,o]=(0,r.useState)("flat"),[s,l]=(0,r.useState)(()=>"dark"===i?"dark":"light");(0,r.useEffect)(()=>{l("dark"===i?"dark":"light")},[i]);const[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[m,g]=(0,r.useState)({center:hUe,zoom:2}),v=(0,r.useRef)(null),[A,y]=(0,r.useState)({width:800,height:600});(0,r.useEffect)(()=>{const e=()=>{v.current&&y({width:v.current.clientWidth,height:v.current.clientHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const{photos:b,isLoading:x,error:_,total:w}=hg({rollId:null===e||void 0===e?void 0:e.rollId,dateRange:null===e||void 0===e?void 0:e.dateRange,bounds:"flat"===a?c:null}),S=(0,r.useMemo)(()=>b?b.filter(e=>null!==e.latitude&&null!==e.longitude&&!isNaN(e.latitude)&&!isNaN(e.longitude)):[],[b]),T=(0,r.useCallback)(e=>{u(e)},[]),C=(0,r.useCallback)((e,n)=>{h(e),f(n),t&&t(e)},[t]),M=(0,r.useCallback)(()=>{h(null),f(null)},[]),E=(0,r.useCallback)(({lat:e,lng:t,zoom:n})=>{g({center:[e,t],zoom:n||6}),o("flat")},[]),P=dUe[s];return(0,gt.jsxs)("div",{className:"photo-map-wrapper",ref:v,children:[x&&(0,gt.jsx)("div",{className:"map-loading-overlay",children:(0,gt.jsxs)("div",{className:"map-loading-skeleton",children:[(0,gt.jsx)("div",{className:"map-skeleton-globe",children:(0,gt.jsx)("div",{className:"map-skeleton-pulse"})}),(0,gt.jsxs)("div",{className:"map-skeleton-text",children:[(0,gt.jsx)("div",{className:"map-loading-spinner"}),(0,gt.jsx)("span",{children:"Loading photo locations..."})]})]})}),_&&(0,gt.jsx)("div",{className:"map-error-message",children:(0,gt.jsxs)("span",{children:["Failed to load photos: ",_.message]})}),!x&&!_&&0===S.length&&(0,gt.jsxs)("div",{className:"map-empty-state",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,gt.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,gt.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),(0,gt.jsx)("h3",{children:"No photos with location data"}),(0,gt.jsx)("p",{children:"Upload photos with GPS coordinates or add location info manually to see them on the map."})]}),(0,gt.jsxs)("div",{className:"map-view-toggle",children:[(0,gt.jsxs)("button",{className:"map-view-btn "+("globe"===a?"active":""),onClick:()=>o("globe"),title:"3D Globe View",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,gt.jsx)("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),(0,gt.jsx)("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),"Globe"]}),(0,gt.jsxs)("button",{className:"map-view-btn "+("flat"===a?"active":""),onClick:()=>o("flat"),title:"Flat Map View",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,gt.jsx)("path",{d:"M3 9h18M9 3v18"})]}),"Flat"]})]}),(0,gt.jsxs)("div",{className:"map-photo-count",children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,gt.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,gt.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),(0,gt.jsxs)("span",{children:[S.length," photos with location"]}),w>S.length&&(0,gt.jsxs)("span",{className:"map-photo-count-total",children:[" / ",w," total"]})]}),"globe"===a&&S.length>0&&(0,gt.jsx)(cUe,{photos:S,onPhotoClick:C,onZoomIn:E,width:A.width,height:A.height}),"flat"===a&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(mUe,{currentLayer:s,onChange:l}),(0,gt.jsxs)(MX,{center:m.center,zoom:m.zoom,className:"photo-map",scrollWheelZoom:!0,zoomControl:!0,children:[(0,gt.jsx)(DX,{url:P.url,attribution:P.attribution,...P.options||{},eventHandlers:{tileerror:e=>{try{console.warn("Tile load error for layer",s,e),"satellite"===s&&l("dark")}catch(or){}}}}),(0,gt.jsx)(fUe,{onBoundsChange:T}),!x&&S.length>0&&2===m.zoom&&(0,gt.jsx)(gUe,{photos:S}),(0,gt.jsx)(UX,{chunkedLoading:!0,iconCreateFunction:pUe,maxClusterRadius:60,spiderfyOnMaxZoom:!0,disableClusteringAtZoom:16,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,spiderfyDistanceMultiplier:2,animate:!0,animateAddingMarkers:!1,removeOutsideVisibleBounds:!0,spiderLegPolylineOptions:{weight:1.5,color:"#666",opacity:.5},children:S.map(e=>(0,gt.jsx)(qX,{photo:e,onClick:C,isSelected:(null===n||void 0===n?void 0:n.id)===e.id},e.id))})]})]}),d&&(0,gt.jsx)(WX,{photo:d,position:p,onClose:M})]})}async function AUe(){const e=(0,bn.Gi)(),t=await fetch(`${e}/api/rolls`);if(!t.ok)throw new Error("Failed to fetch rolls");return t.json()}function yUe({filters:e,onChange:t,onClear:n,isOpen:r,onClose:i}){var a,o;const{data:s=[]}=Rn({queryKey:["rolls"],queryFn:AUe,staleTime:3e5}),l=(n,r)=>{const i={...e.dateRange}||{};i[n]=r||null,i.start||i.end?t({dateRange:i}):t({dateRange:null})},c=e.dateRange||e.rollId||e.locationId;return(0,gt.jsxs)("div",{className:"map-filter-panel "+(r?"open":""),children:[(0,gt.jsxs)("div",{className:"map-filter-header",children:[(0,gt.jsx)("h3",{children:"Filters"}),(0,gt.jsx)("button",{className:"map-filter-close",onClick:i,"aria-label":"Close filters",children:(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,gt.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,gt.jsxs)("div",{className:"map-filter-section",children:[(0,gt.jsx)("label",{className:"map-filter-label",children:"Date Range"}),(0,gt.jsxs)("div",{className:"map-filter-date-row",children:[(0,gt.jsx)("input",{type:"date",className:"map-filter-input",value:(null===(a=e.dateRange)||void 0===a?void 0:a.start)||"",onChange:e=>l("start",e.target.value),placeholder:"Start date"}),(0,gt.jsx)("span",{className:"map-filter-date-separator",children:"to"}),(0,gt.jsx)("input",{type:"date",className:"map-filter-input",value:(null===(o=e.dateRange)||void 0===o?void 0:o.end)||"",onChange:e=>l("end",e.target.value),placeholder:"End date"})]})]}),(0,gt.jsxs)("div",{className:"map-filter-section",children:[(0,gt.jsx)("label",{className:"map-filter-label",children:"Roll"}),(0,gt.jsxs)("select",{className:"map-filter-select",value:e.rollId||"",onChange:e=>{const n=e.target.value;t({rollId:n?parseInt(n,10):null})},children:[(0,gt.jsx)("option",{value:"",children:"All Rolls"}),s.map(e=>(0,gt.jsx)("option",{value:e.id,children:e.title||e.name||`Roll #${e.id}`},e.id))]})]}),c&&(0,gt.jsxs)("button",{className:"map-filter-clear",onClick:n,children:[(0,gt.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,gt.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,gt.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Clear Filters"]}),(0,gt.jsxs)("div",{className:"map-filter-help",children:[(0,gt.jsx)("p",{children:"Use filters to narrow down photos shown on the map."}),(0,gt.jsx)("p",{children:"Click on markers to see photo details."})]})]})}function bUe(){const[e,t]=(0,r.useState)({dateRange:null,rollId:null,locationId:null}),[n,i]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),s=(0,r.useCallback)(e=>{t(t=>({...t,...e}))},[]),l=(0,r.useCallback)(e=>{i(e)},[]),c=(0,r.useCallback)(()=>{t({dateRange:null,rollId:null,locationId:null})},[]);return(0,gt.jsxs)("div",{className:"map-page",children:[(0,gt.jsxs)("button",{className:"map-filter-toggle",onClick:()=>o(!a),"aria-label":"Toggle filters",children:[(0,gt.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,gt.jsx)("path",{d:"M22 3H2l8 9.46V19l4 2v-8.54L22 3z"})}),"Filters"]}),(0,gt.jsx)(yUe,{filters:e,onChange:s,onClear:c,isOpen:a,onClose:()=>o(!1)}),(0,gt.jsx)("div",{className:"map-container",children:(0,gt.jsx)(vUe,{filters:e,onPhotoClick:l,selectedPhoto:n})}),(0,gt.jsx)("div",{className:"map-status-bar",children:(0,gt.jsx)("span",{className:"map-status-text",children:"Drag and zoom to explore your photos"})})]})}var xUe=function({onRefresh:e}){return(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"shadow",size:"lg",radius:"full",onPress:e,"aria-label":"\u5f3a\u5236\u5237\u65b0\u5e76\u6e05\u9664\u7f13\u5b58",className:"\r fixed bottom-6 right-6 z-50\r bg-zinc-200/60 dark:bg-zinc-700/60\r hover:bg-zinc-300 dark:hover:bg-zinc-600\r text-zinc-600 dark:text-zinc-300\r hover:text-zinc-900 dark:hover:text-white\r backdrop-blur-sm\r opacity-40 hover:opacity-100\r transition-all duration-300 ease-out\r hover:scale-110\r shadow-lg hover:shadow-xl\r ",style:{width:"48px",height:"48px"},children:(0,gt.jsx)(Lm,{className:"w-5 h-5"})})};const _Ue=$n("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),wUe=$n("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),SUe=$n("chart-no-axes-column",[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]]),TUe=$n("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),CUe=$n("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]),MUe=1500,EUe=500;let PUe={},NUe=0,kUe=!1,RUe=null,LUe=null;function OUe(e={}){let{delay:t=MUe,closeDelay:n=EUe}=e,{isOpen:i,open:a,close:o}=(0,ro.T)(e),s=(0,r.useMemo)(()=>""+ ++NUe,[]),l=(0,r.useRef)(null),c=(0,r.useRef)(o),u=()=>{PUe[s]=p},d=()=>{for(let e in PUe)e!==s&&(PUe[e](!0),delete PUe[e])},h=()=>{l.current&&clearTimeout(l.current),l.current=null,d(),u(),kUe=!0,a(),RUe&&(clearTimeout(RUe),RUe=null),LUe&&(clearTimeout(LUe),LUe=null)},p=e=>{e||n<=0?(l.current&&clearTimeout(l.current),l.current=null,c.current()):l.current||(l.current=setTimeout(()=>{l.current=null,c.current()},n)),RUe&&(clearTimeout(RUe),RUe=null),kUe&&(LUe&&clearTimeout(LUe),LUe=setTimeout(()=>{delete PUe[s],LUe=null,kUe=!1},Math.max(EUe,n)))};return(0,r.useEffect)(()=>{c.current=o},[o]),(0,r.useEffect)(()=>()=>{l.current&&clearTimeout(l.current),PUe[s]&&delete PUe[s]},[s]),{isOpen:i,open:e=>{!e&&t>0&&!l.current?(d(),u(),i||RUe||kUe?i||h():RUe=setTimeout(()=>{RUe=null,kUe=!0,h()},t)):h()},close:p}}var jUe=n(3735);function DUe(e){var t,n;const i=(0,Bn.o)(),[a,o]=(0,Ln.rE)(e,qa.oO.variantKeys),{ref:s,as:l,isOpen:c,content:u,children:d,defaultOpen:h,onOpenChange:p,isDisabled:f,trigger:m,shouldFlip:g=!0,containerPadding:v=12,placement:A="top",delay:y=0,closeDelay:b=500,showArrow:x=!1,offset:_=7,crossOffset:w=0,isDismissable:S,shouldCloseOnBlur:T=!0,portalContainer:C,isKeyboardDismissDisabled:M=!1,updatePositionDeps:E=[],shouldCloseOnInteractOutside:P,className:N,onClose:k,motionProps:R,classNames:L,...O}=a,j=l||"div",D=null!=(n=null!=(t=null==e?void 0:e.disableAnimation)?t:null==i?void 0:i.disableAnimation)&&n,I=OUe({delay:y,closeDelay:b,isDisabled:f,defaultOpen:h,isOpen:c,onOpenChange:e=>{null==p||p(e),e||null==k||k()}}),B=(0,r.useRef)(null),F=(0,r.useRef)(null),z=(0,r.useId)(),U=I.isOpen&&!f;(0,r.useImperativeHandle)(s,()=>(0,Wa.mK)(F));const{triggerProps:V,tooltipProps:G}=function(e,t,n){let{isDisabled:i,trigger:a,shouldCloseOnPress:o=!0}=e,s=(0,oo.Bi)(),l=(0,r.useRef)(!1),c=(0,r.useRef)(!1),u=()=>{(l.current||c.current)&&t.open(c.current)},d=e=>{l.current||c.current||t.close(e)};(0,r.useEffect)(()=>{let e=e=>{n&&n.current&&"Escape"===e.key&&(e.stopPropagation(),t.close(!0))};if(t.isOpen)return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}},[n,t]);let h=()=>{o&&(c.current=!1,l.current=!1,d(!0))},{hoverProps:p}=(0,qo.M)({isDisabled:i,onHoverStart:()=>{"focus"!==a&&("pointer"===(0,Wo.ME)()?l.current=!0:l.current=!1,u())},onHoverEnd:()=>{"focus"!==a&&(c.current=!1,l.current=!1,d())}}),{focusableProps:f}=(0,Mf.Wc)({isDisabled:i,onFocus:()=>{(0,Wo.pP)()&&(c.current=!0,u())},onBlur:()=>{c.current=!1,l.current=!1,d(!0)}},n);return{triggerProps:{"aria-describedby":t.isOpen?s:void 0,...(0,go.v)(f,p,{onPointerDown:h,onKeyDown:h}),tabIndex:void 0},tooltipProps:{id:s}}}({isDisabled:f,trigger:m},I,B),{tooltipProps:q}=function(e,t){let n=(0,Io.$)(e,{labelable:!0}),{hoverProps:r}=(0,qo.M)({onHoverStart:()=>null===t||void 0===t?void 0:t.open(!0),onHoverEnd:()=>null===t||void 0===t?void 0:t.close()});return{tooltipProps:(0,go.v)(n,r,{role:"tooltip"})}}({isOpen:U,...(0,In.v6)(a,G)},I),{overlayProps:W,placement:H,updatePosition:$}=(0,jUe.v)({isOpen:U,targetRef:B,placement:(0,ff.VO)(A),overlayRef:F,offset:x?_+3:_,crossOffset:w,shouldFlip:g,containerPadding:v});(0,_p.U)(()=>{E.length&&$()},E);const{overlayProps:K}=(0,rd.P)({isOpen:U,onClose:I.close,isDismissable:S,shouldCloseOnBlur:T,isKeyboardDismissDisabled:M,shouldCloseOnInteractOutside:P},F),X=(0,r.useMemo)(()=>{var t,n,r;return(0,qa.oO)({...o,disableAnimation:D,radius:null!=(t=null==e?void 0:e.radius)?t:"md",size:null!=(n=null==e?void 0:e.size)?n:"md",shadow:null!=(r=null==e?void 0:e.shadow)?r:"sm"})},[(0,In.t6)(o),D,null==e?void 0:e.radius,null==e?void 0:e.size,null==e?void 0:e.shadow]),Y=(0,r.useCallback)((e={},t=null)=>({...(0,In.v6)(V,e),ref:_o(t,B),"aria-describedby":U?z:void 0}),[V,U,z,I]),Q=(0,r.useCallback)(()=>({ref:F,"data-slot":"base","data-open":(0,In.sE)(U),"data-arrow":(0,In.sE)(x),"data-disabled":(0,In.sE)(f),"data-placement":(0,ff.Fh)(H||"top",A),...(0,In.v6)(q,K,O),style:(0,In.v6)(W.style,O.style,a.style),className:X.base({class:null==L?void 0:L.base}),id:z}),[X,U,x,f,H,A,q,K,O,W,a,z]),Z=(0,r.useCallback)(()=>({"data-slot":"content","data-open":(0,In.sE)(U),"data-arrow":(0,In.sE)(x),"data-disabled":(0,In.sE)(f),"data-placement":(0,ff.Fh)(H||"top",A),className:X.content({class:(0,Dn.cn)(null==L?void 0:L.content,N)})}),[X,U,x,f,H,A,L]);return{Component:j,content:u,children:d,isOpen:U,triggerRef:B,showArrow:x,portalContainer:C,placement:A,disableAnimation:D,isDisabled:f,motionProps:R,getTooltipContentProps:Z,getTriggerProps:Y,getTooltipProps:Q}}var IUe=()=>n.e(707).then(n.bind(n,5707)).then(e=>e.default),BUe=(0,Ln.Rf)((e,t)=>{var n;const{Component:i,children:a,content:o,isOpen:s,portalContainer:l,placement:c,disableAnimation:u,motionProps:d,getTriggerProps:h,getTooltipProps:p,getTooltipContentProps:f}=DUe({...e,ref:t});let m;try{if(1!==r.Children.count(a))throw new Error;if((0,r.isValidElement)(a)){const e=a,t=null!=(n=e.props.ref)?n:e.ref;m=(0,r.cloneElement)(e,h(e.props,t))}else m=(0,gt.jsx)("p",{...h(),children:a})}catch{m=(0,gt.jsx)("span",{}),(0,In.R8)("Tooltip must have only one child node. Please, check your code.")}const{ref:g,id:v,style:A,...y}=p(),b=(0,gt.jsx)("div",{ref:g,id:v,style:A,children:(0,gt.jsx)(gd.m.div,{animate:"enter",exit:"exit",initial:"exit",variants:dd.zF.scaleSpring,...(0,In.v6)(d,y),style:{...(0,ff.kn)(c)},children:(0,gt.jsx)(i,{...f(),children:o})},`${v}-tooltip-inner`)},`${v}-tooltip-content`);return(0,gt.jsxs)(gt.Fragment,{children:[m,u?s&&(0,gt.jsx)(mv,{portalContainer:l,children:(0,gt.jsx)("div",{ref:g,id:v,style:A,...y,children:(0,gt.jsx)(i,{...f(),children:o})})}):(0,gt.jsx)(md.F,{features:IUe,children:(0,gt.jsx)(ld.N,{children:s&&(0,gt.jsx)(mv,{portalContainer:l,children:b})})})]})});BUe.displayName="HeroUI.Tooltip";var FUe=BUe;const zUe=(0,r.createContext)({isCollapsed:!1,toggleCollapsed:()=>{},setCollapsed:()=>{}});function UUe(){return(0,r.useContext)(zUe)}function VUe({children:e,defaultCollapsed:t=!1}){const[n,i]=(0,r.useState)(()=>{const e=localStorage.getItem("sidebar-collapsed");return e?JSON.parse(e):t}),a=(0,r.useCallback)(e=>{i(e),localStorage.setItem("sidebar-collapsed",JSON.stringify(e))},[]),o=(0,r.useCallback)(()=>{a(!n)},[n,a]);return(0,gt.jsx)(zUe.Provider,{value:{isCollapsed:n,toggleCollapsed:o,setCollapsed:a},children:e})}function GUe({to:e,icon:t,label:n,exact:i=!1,children:a,shortcut:o,badge:s}){const l=ie(),{isCollapsed:c}=UUe(),u=i?l.pathname===e:l.pathname.startsWith(e),d=r.Children.count(a)>0&&u&&!c,h=(0,gt.jsx)(ju.div,{whileHover:{x:2},whileTap:{scale:.98},transition:{duration:.15,ease:"easeOut"},children:(0,gt.jsxs)(lt,{to:e,className:`\n          flex items-center gap-3 px-3 py-2.5 rounded-xl\n          transition-all duration-200 ease-out\n          group relative\n          ${u?"bg-zinc-200/50 dark:bg-zinc-700/50 text-zinc-900 dark:text-zinc-100 font-semibold":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-100/50 dark:hover:bg-zinc-800/50"}\n          ${c?"justify-center px-2":""}\n        `,children:[u&&(0,gt.jsx)(ju.div,{layoutId:"sidebar-active-indicator",className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-zinc-900/80 dark:bg-zinc-100/80 rounded-r-full",initial:!1,transition:{type:"spring",stiffness:500,damping:30}}),(0,gt.jsx)("span",{className:`\n          flex-shrink-0 w-5 h-5\n          ${u?"text-zinc-900 dark:text-zinc-100":"text-zinc-400 dark:text-zinc-500 group-hover:text-zinc-600 dark:group-hover:text-zinc-300"}\n          transition-colors duration-200\n        `,children:t}),!c&&(0,gt.jsx)(ju.span,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},className:"flex-1 text-sm",children:n}),s&&!c&&(0,gt.jsx)("span",{className:"px-1.5 py-0.5 text-xs font-medium rounded-full bg-primary/20 text-primary",children:s})]})});return c?(0,gt.jsx)(FUe,{content:n,placement:"right",delay:300,children:(0,gt.jsx)("div",{children:h})}):(0,gt.jsxs)("div",{children:[h,d&&(0,gt.jsx)(ju.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"ml-3 mt-1",style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:"1px 2px"},children:a})]})}function qUe({to:e,label:t}){const n=ie().pathname===e;return(0,gt.jsx)(lt,{to:e,className:`\n        block px-2 py-1 rounded-md text-xs truncate\n        transition-colors duration-150\n        ${n?"text-blue-600 dark:text-blue-400 font-medium":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100"}\n      `,children:t})}function WUe({title:e,divider:t=!1,children:n}){const{isCollapsed:r}=UUe();return(0,gt.jsxs)("div",{className:"space-y-1",children:[t&&(0,gt.jsx)("div",{className:"py-2",children:(0,gt.jsx)(Ja,{})}),e&&!r&&(0,gt.jsx)("div",{className:"px-3 py-2",children:(0,gt.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wider text-zinc-400 dark:text-zinc-500",children:e})}),(0,gt.jsx)("div",{className:"space-y-0.5",children:n})]})}const HUe={1:"/",2:"/rolls",3:"/films",4:"/calendar",5:"/map",6:"/favorites",7:"/themes",8:"/stats",9:"/equipment",",":"/settings"};function $Ue({tags:e=[]}){const{isCollapsed:t,toggleCollapsed:n}=UUe(),{theme:i,toggleTheme:a}=Av(),o=se();return(0,r.useEffect)(()=>{const e=e=>{if(!(e.metaKey||e.ctrlKey))return;const t=e.target;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)return;const n=e.key;HUe[n]&&(e.preventDefault(),o(HUe[n]))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o]),(0,gt.jsxs)(ju.nav,{className:"\n        flex flex-col h-full flex-shrink-0\n        bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100\n        border-r border-zinc-200 dark:border-zinc-800\n        overflow-hidden\n      ",initial:!1,animate:{width:t?72:240},transition:{duration:.3,ease:[.4,0,.2,1]},children:[(0,gt.jsxs)("div",{className:"flex-1 overflow-y-auto pt-2 pb-4 px-3 space-y-6 custom-scrollbar",children:[(0,gt.jsxs)(WUe,{children:[(0,gt.jsx)(GUe,{to:"/",icon:(0,gt.jsx)(_Ue,{className:"w-5 h-5"}),label:"Overview",exact:!0,shortcut:"\u23181"}),(0,gt.jsx)(GUe,{to:"/rolls",icon:(0,gt.jsx)(Ia,{className:"w-5 h-5"}),label:"Rolls",shortcut:"\u23182"}),(0,gt.jsx)(GUe,{to:"/films",icon:(0,gt.jsx)(Da,{className:"w-5 h-5"}),label:"Films",shortcut:"\u23183"})]}),(0,gt.jsxs)(WUe,{title:"Browse",divider:!0,children:[(0,gt.jsx)(GUe,{to:"/calendar",icon:(0,gt.jsx)(ja,{className:"w-5 h-5"}),label:"Calendar",shortcut:"\u23184"}),(0,gt.jsx)(GUe,{to:"/map",icon:(0,gt.jsx)(wUe,{className:"w-5 h-5"}),label:"Map",shortcut:"\u23185"}),(0,gt.jsx)(GUe,{to:"/favorites",icon:(0,gt.jsx)(Im,{className:"w-5 h-5"}),label:"Favorites",shortcut:"\u23186"}),(0,gt.jsx)(GUe,{to:"/themes",icon:(0,gt.jsx)(zd,{className:"w-5 h-5"}),label:"Themes",shortcut:"\u23187",children:e.map(e=>(0,gt.jsx)(qUe,{to:`/themes/${e.id}`,label:e.name},e.id))})]}),(0,gt.jsxs)(WUe,{title:"Tools",divider:!0,children:[(0,gt.jsx)(GUe,{to:"/stats",icon:(0,gt.jsx)(SUe,{className:"w-5 h-5"}),label:"Statistics",shortcut:"\u23188"}),(0,gt.jsx)(GUe,{to:"/equipment",icon:(0,gt.jsx)(Ba,{className:"w-5 h-5"}),label:"Equipment",shortcut:"\u23189"}),(0,gt.jsx)(GUe,{to:"/luts",icon:(0,gt.jsx)(Da,{className:"w-5 h-5"}),label:"LUT Library"}),(0,gt.jsx)(GUe,{to:"/settings",icon:(0,gt.jsx)(hK,{className:"w-5 h-5"}),label:"Settings",shortcut:"\u2318,"})]})]}),(0,gt.jsxs)("div",{className:`\n        p-3\n        flex items-center gap-2\n        ${t?"flex-col":""}\n      `,children:[(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"light",size:"sm",radius:"lg",onPress:a,className:"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200","aria-label":"dark"===i?"\u5207\u6362\u5230\u6d45\u8272\u6a21\u5f0f":"\u5207\u6362\u5230\u6df1\u8272\u6a21\u5f0f",children:"dark"===i?(0,gt.jsx)(TUe,{className:"w-4 h-4"}):(0,gt.jsx)(CUe,{className:"w-4 h-4"})}),(0,gt.jsx)(La.T,{isIconOnly:!0,variant:"light",size:"sm",radius:"lg",onPress:n,className:`\n            text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200\n            ${t?"":"ml-auto"}\n          `,"aria-label":t?"\u5c55\u5f00\u4fa7\u8fb9\u680f":"\u6298\u53e0\u4fa7\u8fb9\u680f",children:t?(0,gt.jsx)(jm,{className:"w-4 h-4"}):(0,gt.jsx)(Om,{className:"w-4 h-4"})})]})]})}function KUe(){const[e,t]=(0,r.useState)([]),n=At(),i=(0,r.useCallback)(async()=>{try{const e=await(0,bn.Q2)(),n=(Array.isArray(e)?e:[]).filter(e=>e.photos_count>0);t(n)}catch(e){console.error("Failed to load tags",e),t([])}},[]);(0,r.useEffect)(()=>{i(),setTimeout(()=>{xn.add({queryKey:["films"],queryFn:bn.ip,priority:5,options:{staleTime:mn.STATIC.staleTime}}),xn.add({queryKey:["equipment","cameras"],queryFn:bn.RS,priority:5,options:{staleTime:mn.STATIC.staleTime}}),xn.add({queryKey:["locations"],queryFn:bn.Vs,priority:6,options:{staleTime:mn.SEMI_STATIC.staleTime}}),xn.add({queryKey:["tags"],queryFn:bn.Q2,priority:6,options:{staleTime:mn.SEMI_STATIC.staleTime}})},3e3);const e=()=>i();return window.addEventListener("refresh-tags",e),()=>window.removeEventListener("refresh-tags",e)},[i]);const a=(0,r.useCallback)(()=>{console.log("[App] Hard refresh: busting image cache + clearing query cache");try{(0,bn.Cz)(),n.clear(),i(),n.invalidateQueries()}catch(or){console.warn("Failed during hard refresh, falling back to page reload",or),window.location.reload()}},[n,i]);return(0,gt.jsx)(yv,{children:(0,gt.jsxs)(VUe,{children:[(0,gt.jsx)(BK,{}),(0,gt.jsxs)("div",{className:"app-shell bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 transition-colors duration-300",children:[(0,gt.jsx)(IK,{}),(0,gt.jsxs)("div",{className:"app-body",children:[(0,gt.jsx)($Ue,{tags:e}),(0,gt.jsx)("main",{className:"main flex-1 min-w-0 min-h-0 overflow-auto bg-transparent",children:(0,gt.jsxs)(Me,{children:[(0,gt.jsx)(Te,{path:"/",element:(0,gt.jsx)(Tv,{})}),(0,gt.jsx)(Te,{path:"/calendar",element:(0,gt.jsx)(dy,{})}),(0,gt.jsx)(Te,{path:"/map",element:(0,gt.jsx)(bUe,{})}),(0,gt.jsx)(Te,{path:"/stats",element:(0,gt.jsx)(tK,{})}),(0,gt.jsx)(Te,{path:"/spending",element:(0,gt.jsx)(tK,{mode:"spending"})}),(0,gt.jsx)(Te,{path:"/rolls",element:(0,gt.jsx)(tr,{})}),(0,gt.jsx)(Te,{path:"/rolls/new",element:(0,gt.jsx)(Pa,{})}),(0,gt.jsx)(Te,{path:"/rolls/:id",element:(0,gt.jsx)(tp,{})}),(0,gt.jsx)(Te,{path:"/films",element:(0,gt.jsx)(Sm,{})}),(0,gt.jsx)(Te,{path:"/favorites",element:(0,gt.jsx)(oK,{})}),(0,gt.jsx)(Te,{path:"/themes",element:(0,gt.jsx)(cK,{})}),(0,gt.jsx)(Te,{path:"/themes/:tagId",element:(0,gt.jsx)(cK,{})}),(0,gt.jsx)(Te,{path:"/equipment",element:(0,gt.jsx)(dX,{})}),(0,gt.jsx)(Te,{path:"/luts",element:(0,gt.jsx)(vX,{})}),(0,gt.jsx)(Te,{path:"/settings",element:(0,gt.jsx)(jK,{})})]})})]})]}),(0,gt.jsx)(xUe,{onRefresh:a})]})})}var XUe=function(){return(0,gt.jsx)(yt,{client:yn,children:(0,gt.jsx)(ot,{children:(0,gt.jsx)(KUe,{})})})};class YUe extends r.Component{constructor(e){super(e),this.handleReload=()=>{window.location.reload()},this.handleDismiss=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),console.error("[ErrorBoundary] Uncaught error in React tree:",e),console.error("[ErrorBoundary] Component stack:",null===t||void 0===t?void 0:t.componentStack);try{var n;null!==(n=window.electronAPI)&&void 0!==n&&n.log&&window.electronAPI.log(`[ErrorBoundary] ${(null===e||void 0===e?void 0:e.message)||e}`)}catch(Zr){}}render(){var e;return this.state.hasError?(0,gt.jsxs)("div",{style:{position:"fixed",inset:0,zIndex:99999,background:"rgba(10, 10, 10, 0.98)",color:"#eee",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',padding:"40px"},children:[(0,gt.jsx)("div",{style:{fontSize:48,marginBottom:16},children:"\u26a0\ufe0f"}),(0,gt.jsx)("h1",{style:{fontSize:20,fontWeight:600,marginBottom:8},children:"\u53d1\u751f\u4e86\u610f\u5916\u9519\u8bef / An unexpected error occurred"}),(0,gt.jsx)("p",{style:{fontSize:13,color:"#999",marginBottom:24,textAlign:"center",maxWidth:500},children:"\u5e94\u7528\u9047\u5230\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u4f46\u60a8\u7684\u6570\u636e\u662f\u5b89\u5168\u7684\u3002\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u6062\u590d\u6216\u91cd\u65b0\u52a0\u8f7d\u9875\u9762\u3002"}),this.state.error&&(0,gt.jsxs)("details",{style:{marginBottom:24,padding:"12px 16px",background:"rgba(255,0,0,0.1)",border:"1px solid rgba(255,0,0,0.3)",borderRadius:6,maxWidth:600,width:"100%",fontSize:12,color:"#f88",wordBreak:"break-word"},children:[(0,gt.jsx)("summary",{style:{cursor:"pointer",fontWeight:500,marginBottom:8},children:"\u9519\u8bef\u8be6\u60c5 / Error Details"}),(0,gt.jsxs)("pre",{style:{whiteSpace:"pre-wrap",margin:0,lineHeight:1.5},children:[this.state.error.toString(),(null===(e=this.state.errorInfo)||void 0===e?void 0:e.componentStack)&&"\n\nComponent Stack:"+this.state.errorInfo.componentStack]})]}),(0,gt.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,gt.jsx)("button",{onClick:this.handleDismiss,style:{padding:"8px 20px",borderRadius:6,border:"1px solid #555",background:"#333",color:"#eee",cursor:"pointer",fontSize:13,fontWeight:500},children:"\u5c1d\u8bd5\u6062\u590d / Try to Recover"}),(0,gt.jsx)("button",{onClick:this.handleReload,style:{padding:"8px 20px",borderRadius:6,border:"1px solid #1b5e20",background:"#2e7d32",color:"white",cursor:"pointer",fontSize:13,fontWeight:500},children:"\u91cd\u65b0\u52a0\u8f7d / Reload"})]})]}):this.props.children}}var QUe=YUe;window.onerror=(e,t,n,r,i)=>(console.error("[Global] Uncaught error:",e,"\n  at",t,`(${n}:${r})`,i),!1),window.onunhandledrejection=e=>{console.error("[Global] Unhandled promise rejection:",e.reason)},(0,a.H)(document.getElementById("root")).render((0,gt.jsx)(QUe,{children:(0,gt.jsx)(XUe,{})}))}()}();
//# sourceMappingURL=main.1c49ed4b.js.map